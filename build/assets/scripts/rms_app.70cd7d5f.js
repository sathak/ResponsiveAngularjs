(function() {
    'use strict';
    angular.module('app.core', [
        /*
         * Angular modules
         */
        'ngAnimate', 'ngRoute', 'ngSanitize',
        /*
         * Our reusable cross app code modules
         */
        'blocks.exception', 'blocks.logger', 'blocks.router',
        /*
         * 3rd Party modules
         */
        'ngplus'
    ]);

    angular.module('blocks.logger', []);
    angular.module('blocks.router', [
        'ngRoute',
        'blocks.logger'
    ]);
    angular.module('blocks.exception', ['blocks.logger']);

    angular.module("navconDashboard", ["gridster", "ui.bootstrap", "ng-fusioncharts"]);
    angular.module("navconFramework", ["navconMenu", "navconDashboard"]);
    angular.module("navconMenu", ["ngAnimate"]);

    angular.module('app.changepassword', []);
    angular.module('app.dashboard', []);
    angular.module('app.login', []);
    angular.module('app.userprofile', []);
    angular.module('app.rolemanagement', []);
    angular.module('app.tiles', []);
    angular.module('app.useraccessrights', []);
    angular.module('app.usermanagement', []);
    angular.module('app.photo', []);
    angular.module('app.news', []);
    angular.module('app.userimport', []);
})();
var navcon = (function () {

    var webUrl = function () {
        return window.document.URL;
    };

    var getAppScope = function () {
        var appElement = document.querySelector('[ng-app=app]');
        var appScope = angular.element(appElement).scope();
        return getAppScope;
    }
    var defaultFormat = function () {
        var formatData = {
            "date": "DD/MM/YYYY",
            "datetime": "DD/MM/YYYY hh:mm:ss A",
            "utc": "YYYY-MM-DD HH:mm:ss",
            "timeZone": ((-1) * (new Date().getTimezoneOffset())),
            "datetype": "date-uk",
            "dateDisplay": "MMMM D, YYYY",
            "kdate": "dd/MM/yyyy",
        };
        return formatData;
    };
    var getDistinctfromJSON = function (obj, key) {
        var distinctIds = [];
        var distinctArray = [];
        obj.filter(function (v, i) {
            if (distinctIds.indexOf(v[key]) == -1) {
                distinctIds.push(v[key]);
                distinctArray.push(v);
            }
        });
        obj = distinctArray;
        return obj;
    };

    var getFilterobjectfromJSON = function (obj, key1, value) {

        var MatchedArray = [];
        $.each(obj, function (v, i) {
            if (i[key1] == value) {
                MatchedArray.push(i);
            }
        });
        return MatchedArray;
    };

    var getMatchedobjectfromJSON = function (obj, key1, key2, value) {

        var distinctMatchedArray = [];
        var distinctIds = [];
        $.each(obj, function (v, i) {
            if (i[key1] == value && distinctIds.indexOf(i[key2]) == -1) {
                distinctIds.push(i[key2]);
                distinctMatchedArray.push(i);
            }
        });
        return distinctMatchedArray;
    };

    var tableSortDDMMYYYEExt = function () {
        jQuery.extend(jQuery.fn.dataTableExt.oSort, {
            "date-uk-pre": function (a) {
                var ukDatetimea = a.split(" ");

                var ukDatea = ukDatetimea[0].split('/');
                if (ukDatea.length === 1 && ukDatea[0] === "")
                    return 1;
                else {
                    if (ukDatetimea.length > 1) {
                        var uktimea = ukDatetimea[1].split(":");
                        var ukam = 1;
                        if (ukDatetimea.length > 2) ukam = ukDatetimea[2].toString() === "PM" ? 2 : 1;

                        return (ukDatea[2] + ukDatea[1] + ukDatea[0] + ukam + uktimea[0] + uktimea[1] + uktimea[2]) * 1;
                    } else {
                        return (ukDatea[2] + ukDatea[1] + ukDatea[0]) * 1;
                    }
                }
            },

            "date-uk-asc": function (a, b) {
                return ((a < b) ? -1 : ((a > b) ? 1 : 0));
            },

            "date-uk-desc": function (a, b) {

                return ((a < b) ? 1 : ((a > b) ? -1 : 0));
            }
        });
    }

    var tableSetting = function (el, options, scope) {

        var table = $($(el).find('table')[0]);

        var self = this;

        var filterBar = {};
        if (options != undefined && options.filterBar !== undefined) filterBar = options.filterBar;

        if (options.aoColumnDefs !== undefined) {
            options.aoColumnDefs.push({
                "render": function (data, type, row, pos) {
                    if (pos.settings.aoColumns[pos.col].time !== undefined && pos.settings.aoColumns[pos.col].time === true)
                        return dateFromUTCToLocal(data, (defaultFormat().datetime || 'DD/MM/YYYY HH:mm:ss'));
                    else
                        return dateFromUTCToLocal(data, (defaultFormat().date || "DD/MM/YYYY"));
                },
                "targets": options.dateFields
            });
        }

        var datatableDateColumType = function (options, colums) {
            if (options.dateFields !== undefined && options.dateFields !== null && options.dateFields.length !== 0) {
                $.map(colums, function (item, index) {
                    $.map(options.dateFields, function (data, i) {
                        if (data === index) {
                            item["type"] = defaultFormat().datetype;
                            item["sType"] = defaultFormat().datetype;
                        }
                    });
                });
            }
            return colums;
        };

        var oTable = table.DataTable({
            "oLanguage": {
                "sSearch": "<span class='input-inline dtFilterSearch'><i class='fa fa-search'></i></span>"
            },
            select: true,
            /*select: {
                style: 'single'
            },*/
            buttons: options.buttons,
            "bDestroy": true,
            "bPaginate": filterBar.paginate !== undefined ? filterBar.paginate : true, //hide pagination
            "bFilter": filterBar.filter !== undefined ? filterBar.filter : true, //hide Search bar
            "bInfo": filterBar.info !== undefined ? filterBar.info : true, // hide showing entries
            "bAutoWidth": options.autoWidth,
            "language": {
                "aria": {
                    "sortAscending": ": activate to sort column ascending",
                    "sortDescending": ": activate to sort column descending"
                },
                "emptyTable": "No data available in table",
                "info": "Showing _START_ to _END_ of _TOTAL_ entries",
                "infoEmpty": "No entries found",
                "infoFiltered": "(filtered1 from _MAX_ total entries)",
                "lengthMenu": "Show _MENU_ entries",
                "search": "Search:",
                "zeroRecords": "No matching records found"
            },
            "dom": "<'row' <'col-md-12'T>><'row'<'col-md-6 col-sm-12'l><'col-md-6 col-sm-12'f>r><'table-scrollable't><'row'<'col-md-5 col-sm-12'i><'col-md-7 col-sm-12'p>>",
            "aoColumnDefs": options.aoColumnDefs,
            "order": options.order,
            "lengthMenu": [[5, 10, 15, 20, -1], [5, 10, 15, 20, "All"]],// change per page values here
            "iDisplayLength": options.iDisplayLength,
            // set the initial value
            "pageLength": options.pageLength,
            data: options.data,
            columns: datatableDateColumType(options, options.columns),
            createdRow: function (row, data, index) {
                //setApprvoedTableColumnOptions(row, data, options);
                if (options.columns !== undefined && options.columns.length > 0) {
                    $.map(options.columns, function (item, colIndex) {
                        if (item.serialNoColumn !== undefined && item.serialNoColumn != null) {
                            $(row).children().eq(item.serialNoColumn).html((index + 1));
                        }
                    });
                }
                if (scope.navconData.tableRowUpdate !== undefined)
                    scope.navconData.tableRowUpdate(row, data, index, scope.type, this, oTable, options.columns);
            },
            initComplete: function (settings, json) {

                $(".dataTables_filter").find("input").addClass("form-control input-medium input-inline");
                var iTable = this.DataTable();

                if (options.buttons !== undefined) {
                    if ($("#DataTables_Table_0_filter").find('.dt-buttons').length === 0) {
                        var printObj = this.parents('.portlet').first().find(".tools:first");
                        iTable.buttons().container().appendTo(printObj);
                        printObj.find(".dt-buttons").children().unwrap();
                        var printBut = printObj.find('.dt-button');
                        printBut.css("background", "none");
                        printBut.css("background-image", "none");
                        printBut.css("border", "0px");
                        printBut.css("padding", "0px");
                        printBut.css("padding-top", "3px");
                        printBut.css("top", "-3px");
                        printBut.css("position", "relative");
                        printBut.addClass("fa fa-print");
                        printBut.find("span").text("");
                        var tableId = $(".tools:first").parents(".portlet:first").find("table:first").attr("id");
                    }

                    iTable.on('buttons-action', function (e, buttonApi, dataTable, node, config) {
                        //console.log('Button ' + buttonApi.text() + ' was activated');
                    });

                    if ($("#DataTables_Table_0_filter").find('.dt-buttons').length === 0)
                        iTable.buttons().container().appendTo($("#DataTables_Table_0_filter"))
                }

                if (options.columnFilter !== undefined) {
                    this.columnFilter({
                        sPlaceHolder: "head:after",
                        aoColumns: options.columnFilter.aoColumns
                    });
                }

                if (options.rowsGroup !== undefined) {
                    new $.fn.dataTable.RowsGroup(iTable, options.rowsGroup);
                }

                navcon.viewContentLoaded();


            },
            headerCallback: function () {
                //var ss = $(table).find('tbody');
            },
            drawCallback: function () {
                if (scope.navconData.rights !== undefined)
                    setDisabledEnabledByRights(scope.navconData.rights);

                //Empty row colspan and text assign
                //if ($(this).attr("aria-describedby") !== undefined && $(this).find("tbody tr td[class=dataTables_empty]").length == 0) {
                //    setApprvoedTableCollection($(this), options);
                //}
                var iTable = this.DataTable();
                $(".dataTables_filter").find("input").addClass("form-control input-medium input-inline");
                //  var iTable = this.DataTable();

                if (options.buttons !== undefined) {
                    if ($("#DataTables_Table_0_filter").find('.dt-buttons').length === 0) {
                        var printObj = this.parents('.portlet').first().find(".tools:first");
                        iTable.buttons().container().appendTo(printObj);
                        printObj.find(".dt-buttons").children().unwrap();
                        var printBut = printObj.find('.dt-button');
                        printBut.css("background", "none");
                        printBut.css("background-image", "none");
                        printBut.css("border", "0px");
                        printBut.css("padding", "0px");
                        printBut.css("padding-top", "3px");
                        printBut.css("top", "-3px");
                        printBut.css("position", "relative");
                        printBut.addClass("fa fa-print");
                        printBut.find("span").text("");
                        var tableId = $(".tools:first").parents(".portlet:first").find("table:first").attr("id");
                    }

                    iTable.on('buttons-action', function (e, buttonApi, dataTable, node, config) {
                        //console.log('Button ' + buttonApi.text() + ' was activated');
                    });

                    if ($("#DataTables_Table_0_filter").find('.dt-buttons').length === 0)
                        iTable.buttons().container().appendTo($("#DataTables_Table_0_filter"))
                }

                if (options.columnFilter !== undefined) {
                    this.columnFilter({
                        sPlaceHolder: "head:after",
                        aoColumns: options.columnFilter.aoColumns
                    });
                }



                navcon.viewContentLoaded();


                //Empty row colspan and text assign
                if ($(this).find("tbody tr td[class=dataTables_empty]").length == 1) {

                    var totalColumn = $(this).find("thead tr th").length;
                    $(this).find("tbody tr td[class=dataTables_empty]").attr("colspan", totalColumn);

                    var displayText = "No records found"; //"No data available in table";
                    if ($(this).parent() !== undefined
                        && $(this).parent().parent() !== undefined
                        && $(this).parent().parent().parent() !== undefined
                        && $(this).parent().parent().parent().parent() !== undefined) {
                        var settings = $(this).parent().parent().parent().parent().attr("table-settings");
                        if (settings.toString().lastIndexOf(".") > 0) {
                            var navdata = scope.navconData[settings.toString().substring(settings.toString().lastIndexOf(".") + 1)];
                            if (navdata !== undefined && navdata.emptyText !== undefined)
                                displayText = navdata.emptyText;
                        } else {
                            var navdata = scope.navconData[settings.toString()];
                            if (navdata !== undefined && navdata.emptyText !== undefined)
                                displayText = navdata.emptyText;
                        }
                    }

                    $(this).find("tbody tr td[class=dataTables_empty]").text(displayText);
                }

                // setTimeout(function(){
                $('.dataTables_paginate.paging_simple_numbers').first().parent().css("margin-left", "-15px");
                //$('.paginate_button.next').first().css("margin-left","3px");
                //},50)

            }
        });

        //focusout click
        $(table).find('tbody').on('change', 'td', function (el) {
            var tr = $(this).closest("tr");
            var row = tr.index();
            var index = oTable.cell(this).index();
            var column = index.column;
            var rowData = oTable.row(tr).data();
            var cellData = oTable.cell(this).data();
            var colHeader = $(oTable.column(column).header()).html();

            if (el.srcElement.type == "checkbox") {
                if (el.srcElement.checked === true) {
                    if (oTable.row(tr).data()[colHeader] !== undefined)
                        oTable.row(tr).data()[colHeader] = 1;
                    else
                        oTable.row(tr).data()[colHeader.toLowerCase()] = 1;
                }
                else {
                    if (oTable.row(tr).data()[colHeader] !== undefined)
                        oTable.row(tr).data()[colHeader] = 0;
                    else
                        oTable.row(tr).data()[colHeader.toLowerCase()] = 0;
                }


            } else if (el.srcElement.type == "text") {
                oTable.cell(this).data(setTableCellValue(cellData, el.srcElement));
                setTableTotalCellValue(oTable, this, options, column, colHeader);

            } else {
                oTable.cell(this).data(setTableCellValue(cellData, el.srcElement));
            }
        });
        //cell click
        $(table).find('tbody').on('click', 'td', function (el, tt) {

            $(".selected").removeClass("selected");
            $(el.currentTarget).parent().addClass("selected");
            var column, colHeader, data, headerTitle;
            $($(el.currentTarget).parents('table')[0]).find('tr:not(:first-child)').css("background-color", "transparent");
            var tr = $(this).closest("tr");
            var row = tr.index();

            //need to change static color
            setTimeout(function () {
                $(tr[0]).css("background-color", "#B0BED9");
            }, 200);

            if (tr === undefined || oTable.row(tr).data() === undefined) {
                data = oTable.row($(this).parent().prev()).data();
            } else {
                data = oTable.row(tr).data();
            }

            if (oTable.cell(this).index() === undefined && $(el.target).closest('li').length !== 0) {
                column = parseFloat($(el.target).closest('li').attr("data-dt-column"));
                colHeader = $(el.target).closest('li').find('span[class="dtr-title"]').text();
                headerTitle = $(el.target).closest('li').find('span[class="dtr-title"]').text().toLowerCase();
            } else {
                column = oTable.cell(this).index().column;
                colHeader = oTable.column(column).header();
                headerTitle = $(colHeader).html().toLowerCase();
            }

            if (scope.navconData.rights !== undefined && ((!scope.navconData.rights.Add && headerTitle === "add") || (!scope.navconData.rights.Edit && headerTitle === "edit") || ((!scope.navconData.rights.View && !scope.navconData.rights.Approve) && headerTitle === "view") || (!scope.navconData.rights.Delete && headerTitle === "delete"))) return false;

            /* if (scope.navconData.rights !== undefined && ((!scope.navconData.rights.Add && headerTitle === "add") || (!scope.navconData.rights.Edit && headerTitle === "edit") || (!scope.navconData.rights.Delete && headerTitle === "delete"))) return false;*/



            if (headerTitle === "add" || headerTitle === "edit" || headerTitle === "delete" || headerTitle === "view" || headerTitle === "manage" || headerTitle === "customer forms") {
                if ($(el.target.children).css("display") === "none" || $(el.target.children).attr("readOnly") === true || $(el.target.children).attr("disabled") === "disabled") return;

                if (scope.tableSettings.tableAction !== undefined) {
                    if (scope.tableSettings.tableAction === undefined) return;
                    scope.tableSettings.tableAction(headerTitle, row, column, data, scope.type, this, oTable);
                } else {
                    if (scope.navconData.tableAction === undefined) return;
                    scope.navconData.tableAction(headerTitle, row, column, data, scope.type, this, oTable);
                }
            } else {
                if (scope.tableSettings.tableCellClick !== undefined) {
                    if (scope.tableSettings.tableCellClick === undefined) return;
                    scope.tableSettings.tableCellClick(row, column, data, scope.type, this, oTable);
                } else {
                    if (scope.navconData.tableCellClick === undefined) return;
                    scope.navconData.tableCellClick(row, column, data, scope.type, this, oTable);
                }
            }
        });

        $(table).find('tbody').on('click', 'th', function () {
            var row = oTable.cell(this).index().row;
            var column = oTable.cell(this).index().column;
            var data = oTable.cell(this).data();

        });

        oTable.on('click', 'th', function () {
            var column = oTable.column(this).index();

            var colHeader = oTable.column(column).header();
            var data = $(colHeader).html().toLowerCase();


            if ($(oTable).context !== undefined && $(oTable).context.length > 0) {
                var tableData = $(oTable).context[0];
                if (tableData.aoColumns !== undefined && tableData.aoColumns.length > 0) {
                    $.map(tableData.aoColumns, function (columnData, colIndex) {
                        if (columnData.serialNoColumn !== undefined && columnData.serialNoColumn != null) {
                            var iLoop = 1;
                            $.map($(tableData.nTable).find("tr"), function (item, index) {
                                if (index > 0) {
                                    var row = $(item);
                                    $(row.find("td")[columnData.serialNoColumn]).text(iLoop)
                                    iLoop++;
                                }
                            });
                        }
                    });
                }
            }

            if (scope.navconData.tableHeaderCellClick === undefined) return;
            scope.navconData.tableHeaderCellClick(column, data, scope.type, this, oTable);
        });

        oTable.on('click', 'input[type="checkbox"]', function (e) {
            var $row = $(this).closest('tr');

            // Get row data
            var data = oTable.row($row).data();

            //if (this.checked && oTable.cell($(this).parent()).index().column === 0)
            if (oTable.cell($(this).parent()).index().column === 0)
                oTable.row($row).data()["Row_Checked"] = this.checked;

            if (oTable.row($row).data()["Check_Field"] !== undefined && oTable.row($row).data()["Check_Field"] !== null && oTable.row($row).data()["Check_Field"] !== "") {
                var field = oTable.row($row).data()["Check_Field"];
                oTable.row($row).data()[field] = this.checked
            }
            // Get row ID
            var rowId = data[0];
        });

        oTable.on('click', 'input[type="text"]', function (e) {
            //console.log($(this).value());
        });

        var tabWrapper = $(table).parent().parent();
        if ($(tabWrapper).find(".dataTables_filter").length === 0) {
            $(tabWrapper).css("margin-top", "-12px");
        }

        scope.navconData.oTable = oTable;
    };

    var PrintFunction = function (iTable, options) {

        $(".dataTables_filter").find("input").addClass("form-control input-medium input-inline");
        //  var iTable = this.DataTable();

        if (options.buttons !== undefined) {
            if ($("#DataTables_Table_0_filter").find('.dt-buttons').length === 0) {
                var printObj = this.parents('.portlet').first().find(".tools:first");
                iTable.buttons().container().appendTo(printObj);
                printObj.find(".dt-buttons").children().unwrap();
                var printBut = printObj.find('.dt-button');
                printBut.css("background", "none");
                printBut.css("background-image", "none");
                printBut.css("border", "0px");
                printBut.css("padding", "0px");
                printBut.css("padding-top", "3px");
                printBut.css("top", "-3px");
                printBut.css("position", "relative");
                printBut.addClass("fa fa-print");
                printBut.find("span").text("");
                var tableId = $(".tools:first").parents(".portlet:first").find("table:first").attr("id");
            }

            iTable.on('buttons-action', function (e, buttonApi, dataTable, node, config) {
                //console.log('Button ' + buttonApi.text() + ' was activated');
            });

            if ($("#DataTables_Table_0_filter").find('.dt-buttons').length === 0)
                iTable.buttons().container().appendTo($("#DataTables_Table_0_filter"))
        }

        if (options.columnFilter !== undefined) {
            this.columnFilter({
                sPlaceHolder: "head:after",
                aoColumns: options.columnFilter.aoColumns
            });
        }

        if (options.rowsGroup !== undefined) {
            new $.fn.dataTable.RowsGroup(iTable, options.rowsGroup);
        }

        navcon.viewContentLoaded();
    }

    var setTableTotalCellValue = function (oTable, ctrl, options, column, colHeader) {
        var columnTitle = "";

        //Total Calculation
        if (options.lastRowAsTotal !== undefined && options.lastRowAsTotal) {
            var lastTr = $(ctrl).parent().parent().children().last().closest("tr");
            var lastTrIndex = lastTr.index();

            var totalValue = 0;
            var trCollection = $(ctrl).parent().parent().find("tr");
            for (var iRow = 0; iRow < trCollection.length - 1; iRow++) {
                //var colValue = parseInt(oTable.row(trCollection[iRow]).data()[colHeader]);
                var colValue = parseFloat($($($(ctrl).parent().parent().children()[iRow]).children()[column]).children()[0].value);
                totalValue += isNaN(colValue) ? 0 : colValue;
            }

            //oTable.row(lastTrIndex).data()[columnTitle] = totalValue;
            var loopColumn = 0;
            for (var key in oTable.row(lastTrIndex).data()) {
                if (loopColumn === column) {
                    columnTitle = key;
                    $(oTable.row(lastTrIndex).data()[columnTitle]).val(totalValue);
                    $(oTable.row(lastTrIndex).data()[columnTitle]).text(totalValue);

                    oTable.row(lastTrIndex).data()[columnTitle] = "<input type='text' value='" + totalValue + "'>";
                    break;
                }
                loopColumn += 1;
            }


            $($(lastTr[0]).children()[column]).children()[0].value = totalValue;
            $($(lastTr[0]).children()[column]).children().text(totalValue);
            //$($(lastTr[0]).children()[column]).children()[0].readOnly = true;
            $($(lastTr[0]).children()[column]).children()[0].disabled = true;
        }
    };

    var setTableCellValue = function (value, targetVal) {
        var retVal = value;
        if (value.indexOf === undefined) return value;
        if (value.indexOf('<input') !== -1 || value.indexOf('<textarea') !== -1) {
            var valueObj = $(value);
            if (targetVal.type === "checkbox") {
                if (targetVal.checked)
                    $(valueObj).attr("checked", "checked");
                else
                    $(valueObj).removeAttr("checked");
            } else {
                $(valueObj).attr("value", targetVal.value)
            }
            var modStr = valueObj.prop('outerHTML');
            retVal = modStr.replace(/"/gi, "'");
        } else {
            retVal = value;
        }
        return retVal;
    };

    var getTableCellValue = function (value) {
        var retVal = value;
        if (value === null || value === undefined || value.indexOf === undefined) return value;
        if (value.indexOf('<input') !== -1 || value.indexOf('<textarea') !== -1) {
            var valueObj = $(value);
            retVal = $(valueObj).attr("value")
        } else {
            retVal = value;
        }
        return retVal;
    };

    var getTableInstance = function (type) {
        var navTable = $("navcon-table[type='" + type + "']");
        var table = $($(navTable).find('table')[0]);
        var oTable = table.DataTable();
        return oTable;
    };

    var clearTableData = function (type, data) {
        $.map(data, function (item, index) {
            for (var k in item) {
                item[k] = setTableCellValue(item[k], "");
            }
        });
        var oTable = getTableInstance(type);
        oTable.clear();
        oTable.rows.add(data).draw();
    };

    var updateTableData = function (type, data, targetData, id) {
        if (id === undefined || id === "")
            id = "row";

        for (var i = 0; i < data.length; i++) {
            for (var k in data[i]) {
                if (k === i) continue;
                var idVal = (id === "row" ? i : data[i][id]);
                var valuObj = getItemByKeyValue(targetData, id, idVal);
                if (valuObj !== -1)
                    data[i][k] = setTableCellValue(data[i][k], valuObj[k]);
            }
        }
        var oTable = getTableInstance(type);
        oTable.clear();
        oTable.rows.add(data).draw();
    };

    var getItemByProperty = function (items, key) {
        var value = $.grep(items, function (e) {
            return e.key === key;
        });

        if (value.length > 0)
            return value[0];
        else {
            //alert('item not found...');
            return -1;
        }
    };

    var getTableData = function (type, id, checked, key, checkedCol, oldData, mode) {
        if (id === undefined || id === "")
            id = "row";
        var data = [];
        var navTable = $("navcon-table[type='" + type + "']");
        var table = $($(navTable).find('table')[0]);
        var oTable = getTableInstance(type);
        $.map(oTable.rows().data(), function (item, index) {
            if (checked !== undefined && checked) {
                var colField = ""
                if (checkedCol !== undefined)
                    colField = checkedCol;
                if (item[colField] === undefined || !item[colField])
                    return false;
            }
            var obj = {};
            obj[id] = index;
            for (var k in item) {
                if (item.hasOwnProperty(k)) {
                    obj[k] = getTableCellValue(item[k]);
                }
            }
            if (item[key] === undefined) {
                item[key] = 0;
            }
            if (item[key] === null || item[key] === 0) {
                obj["ObjectState"] = (item["ObjectState"] !== undefined && item["ObjectState"] !== null && item["ObjectState"] !== "" && item["ObjectState"] !== "0" && item["ObjectState"] !== 0) ? parseInt(item["ObjectState"]) : 1;
            }
            else {
                obj["ObjectState"] = (item["ObjectState"] !== undefined && item["ObjectState"] !== null && item["ObjectState"] !== "" && item["ObjectState"] !== "0" && item["ObjectState"] !== 0) ? parseInt(item["ObjectState"]) : 2;
            }

            obj["Status"] = (item["Status"] !== undefined && item["Status"] !== null && item["Status"] !== "" && item["Status"] !== "0") ? parseInt(item["Status"]) : 0;

            data.push(obj);
        });
        if (mode.toLowerCase() == "save")
            return data;
        else
            return insertDeleteditems(data, oldData, key, "table");
    };

    var tableRefresh = function (el, setting, scope) {
        if (setting.data.length === 0) setting.data = [];
        var table = $($(el).find('table')[0]);
        var tabInst = table.DataTable.fnTables();
        if ($(tabInst).parents("navcon-table[type='" + $(el).attr("type") + "']").length === 0 || table.children().length === 0) {
            tableSetting(el, setting, scope);
            return;
        }
        var oTable = table.DataTable();
        oTable.clear();
        oTable.rows.add(setting.data).draw();
    };

    var tableCellEditSetting = function (row, column, data, cellObj, oTable, $scope, $compile) {

        var colHeader = oTable.column(column).header();
        var headerTitle = $(colHeader).html().toLowerCase();
        var columnSetting = oTable.settings()[0].aoColumns[column];
        if (columnSetting.edit === true && cellObj.children.length === 0) {
            var height = cellObj.offsetHeight + "px;";
            var width = cellObj.offsetWidth + "px;"
            $(cellObj).empty().append($("<navcon-dropdown select-options='vm.selectOptions'></navcon-dropdown>", {
                "style": "height:calc(100% + 12px);width:calc(100% + 12px); margin-left:-6px; margin-top:-6px;"
            }).append(function () {
                var options = [];
                $.each([], function (k, v) {
                    options.push($("<option></option>", {
                        "text": v,
                        "value": v
                    }))
                })
                return options;
            }));

            $compile($(cellObj))($scope);

        }
    };

    var calendarSetting = function (el, data, scope) {
        var calendar = $($(el).find("div[type='calendar']")[0]);
        calendar.fullCalendar("destroy");

        calendar.fullCalendar("destroy");
        setTimeout(function () {
            calendar.fullCalendar({
                now: data.now,
                editable: data.editable,
                contentHeight: data.contentHeight,
                dragScroll: data.dragScroll,
                header: data.header,
                defaultView: data.defaultView,
                views: data.views,
                resourceAreaWidth: data.resourceAreaWidth,
                resourceColumns: data.resourceColumns,
                resources: data.resources,
                events: data.events,
                eventStartEditable: false,
                eventDurationEditable: false,
                dayClick: function (calEvent, jsEvent, view) {
                    var resourceId = $(jsEvent.target).parent().parent().attr("data-resource-id");
                    scope.navconData.calenderActionClick("click", calEvent, resourceId, view);
                },
                eventRender: function (event, element, view) {
                    if (data.todayVisible !== undefined && !data.todayVisible) $(".fc-today").removeClass("fc-today");// remove for current date color display

                    if (data.numberDisplay !== undefined && data.numberDisplay) {
                        var iDay = 1;
                        $(".fc-widget-header ").each(function () {
                            if ($(this).attr("data-date") != undefined) {
                                if ($(this).attr("colspan") != undefined) {
                                    $(this).parent().hide();
                                }
                                else {
                                    $(this).find(".fc-cell-content").each(function () {
                                        if ($(this).children().length === 1) {
                                            $(this).find(".fc-cell-text").html("" + iDay.toString());
                                            iDay += 1;
                                            //if (iDay > 151) $(this).parent().hide();
                                        }
                                    });
                                }
                            }
                        });
                    }
                },
                eventClick: function (calEvent, jsEvent, view) {
                    //alert('Event: ' + calEvent.title);
                    //$(this).css('border-color', 'red');
                    scope.navconData.calenderActionClick("click", calEvent, calEvent.resourceId, view);
                },
                eventResizeStart: function (event, jsEvent, ui, view) {
                    scope.navconData.calenderActionClick("resizeStart", event, event.resourceId, view);
                },
                eventResize: function (event, delta, revertFunc) {
                    //alert(event.title + " end is now " + event.end.format());
                },
                eventOverlap: function (stillEvent, movingEvent) {
                    return true;
                }
            });
        }, 500);
    };

    var callPrint = function (report, reportId, callback) {
        if (report.reportFrom === undefined)
            report.reportFrom = "page";
        var dataservice = angular.element(document).injector().invoke(function (dataservice) { return dataservice; });
        var ngAuthSettings = angular.element(document).injector().invoke(function (ngAuthSettings) { return ngAuthSettings; });
        var reportURL = ngAuthSettings.appURL + "ViewsStatic/ReportForm.aspx?"
        var authService = angular.element(document).injector().invoke(function (authService) { return authService; });
        var userId = "0";
        if (authService.authentication !== undefined && authService.authentication.userId !== undefined && authService.authentication.userId !== "")
            userId = authService.authentication.userId.toString();
        var postData = { "ReportRequestId": "0", "ReportDetailId": reportId, "ObjectState": 1, "Status": 0, "Source": report.reportFrom };
        dataservice.postServerData("ReportsSave", postData).then(function (data) {
            report.title = data.title || report.title || "";
            report.export = report.export || "false";

            if (report.parameters !== undefined && report.parameters !== null && report.parameters.length !== 0)
                report.source = reportURL + "r=" + data.GuId + "&rp=" + JSON.stringify(report.parameters) + "&export=" + report.export + "&title=" + report.title + "&userid=" + userId;
            else
                report.source = reportURL + "r=" + data.GuId + "&export=" + report.export + "&title=" + report.title + "&userid=" + userId;

            callback(data);
        });
    };

    var chartSetting = function (el, data, scope) {
        org_chart = null;
        var chart = $($(el).find("div[type='orgChart']")[0]);
        //chart.orgChart("destroy");

        org_chart = chart.orgChart({
            modelId: data.modelId,
            data: data.data,
            showControls: data.showControls,
            allowEdit: data.allowEdit,
            newNodeText: data.newNodeText,
            dragAndDrop: data.dragAndDrop,
            panelHeight: data.panelHeight,
            entryType: data.entryType,
            firstLevel: data.firstLevel,
            nextLevel: data.nextLevel,
            onAddNode: function (event, element, view) {
                if (scope.navconData.chartActionClick !== null) {
                    scope.navconData.chartActionClick("Add", scope.type, event, org_chart.opts.data, org_chart, function (data) {
                        org_chart.newNode(event.data.id);
                    });
                }
                else
                    org_chart.newNode(event.data.id);
            },
            onUpdateNode: function (event, element, view) {
                if (scope.navconData.chartActionClick !== null) {
                    scope.navconData.chartActionClick("Save", scope.type, event, org_chart.opts.data, org_chart);
                }
            },
            onDeleteNode: function (node) {
                //log('Deleted node '+node.data.id);
                org_chart.deleteNode(node.data.id);

                if (scope.navconData.chartActionClick !== null) {
                    scope.navconData.chartActionClick("Delete", scope.type, node.data, org_chart.opts.data, org_chart);
                }
            },
            onClickNode: function (node) {
                //log('Clicked node '+node.data.id);
                //alert("test: node clicked");
            },
            onData: function (data) {
                this.data = data;
            }
        });
    };

    var treeSetting = function (el, options, scope, fields, isExpand) {
        var self = this;
        self.options = options;
        self.scope = scope;
        self.fields = fields;
        self.isExpand = isExpand;

        self.tree = $($(el).find("div[type='tree']")[0]);
        self.tree.jstree("destroy");

        self.tree.jstree({
            core: options.core,
            grid: options.grid,
            search: { "show_only_matches": true },
            plugins: options.plugins !== undefined ? options.plugins : ['grid', 'types', 'search'],
            checkbox: options.checkbox
        });



        self.tree.bind("select_node.jstree", function (evt, data) {
            self.scope.type = $(event.target).parents('navcon-tree').first().attr("type") || scope.type;

            var target = $(event.target);

            //setViewContentDisabled("");

            if (target.is('.fa-trash-o')) {
                //if (target.parent() !== null && target.parent().attr("disbled") === "disabled") return true;

                self.scope.navconData.treeActionClick("delete", self.scope.type, data, self.tree);
                return true;
            }
            else if (target.is('.fa-eye')) {
                self.scope.navconData.treeActionClick("view", self.scope.type, data, self.tree);
                //setViewContentDisabled("view");
                return true;
            }
            else if (target.is('.fa-file-o')) {
                self.scope.navconData.treeActionClick("add", self.scope.type, data, self.tree);
                return true;
            }
            else if (target.is('.fa-edit')) {
                //if (target.parent() !== null && target.parent().attr("disbled") === "disabled") return true;

                self.scope.navconData.treeActionClick("edit", self.scope.type, data, self.tree);
                return true;
            }
            else if (target.is('.fa-angle-down')) {
                if (target.parent().parent().parent().find(".dropdown") === undefined || target.parent().parent().parent().find(".dropdown").length === 0) {
                    target.wrap("<ul class='nav pull-right' ><li class='dropdown dropdown-extended dropdown-tasks'><a href='javascript:;' data-toggle='dropdown' data-hover='dropdown' data-close-others='true'></a><li></ul>");
                    target.parent().parent().append('<ul class="dropdown-menu extended tasks" id="' + self.scope.type + 'data"></ul>');
                    for (i = 0; i < data.node.data.actiondata.length; i++)
                        target.parent().parent().find("[id=" + self.scope.type + "data]").append('<li class="external"><div class="h4 text-center">' + data.node.data.actiondata[i] + '</div></li>');
                }

                $("[type=" + self.scope.type + "]").find('.nav').each(function () {
                    $(this).css("position", "inherit");
                });
                target.parent().parent().parent().css("position", "fixed");

                $("[type=" + self.scope.type + "]").find('.nav a').each(function () {
                    $(this).css("display", "block");
                });
                target.parent().css("display", "none");

            }
            else if (target.is('.h4.text-center')) {
                self.scope.navconData.treeActionClick("actiondata", target.text(), data, self.tree);
                return true;
            }
            else {
                if ($(event.target).find("OPTION").length > 0) {
                    $(event.target).focus();
                    return false;
                }
                if ($(event.target).find(".nav").children().length > 0) {
                    $("[type='" + self.scope.type + "']").find('.nav').each(function () {
                        $(this).css("position", "inherit");
                    });

                    $("[type='" + self.scope.type + "']").find('.nav a').each(function () {
                        $(this).css("display", "block");
                    });
                }
                if (self.scope.navconData.treeActionClick !== undefined)
                    self.scope.navconData.treeActionClick("cellClick", data.node.text, data, self.tree);
            }

            if (self.scope.navconData.treeActionClick !== undefined)
                self.scope.navconData.treeActionClick("cellClick", self.scope.type, data.node.text, data, self.tree, target);
        });

        self.tree.bind("init.jstree", function (event) {

        });

        //self.tree.bind("changed.jstree", function (event,data) {
        //    setApprvoedTreeeColumnOptions(self.scope.type, self.options);
        //});


        self.tree.bind("loaded.jstree", function (event, data) {
            self.treeClickEvent();

            if (self.isExpand === "true" || self.isExpand === true) {
                self.tree.jstree('open_all');
            } else {
                self.tree.jstree('close_all');
            }

            setDisabledEnabledByRights(scope.navconData.rights);
            var viewMode = scope.navconData[scope.fieldSet].mode === undefined ? "" : scope.navconData[scope.fieldSet].mode;
            setViewContentDisabled(viewMode.toLowerCase() === "print" ? "view" : viewMode);
            //setApprvoedTreeeColumnOptions(self.scope.type,self.options);
        });

        self.tree.bind("loaded_grid.jstree", function (event, data) {
            //console.log(data);
            //setApprvoedTreeeColumnOptions(self.scope.type, self.options);
        });

        self.tree.bind("after_open.jstree", function (event, data) {
            //console.log(event);
            self.treeClickEvent();

            setDisabledEnabledByRights(scope.navconData.rights);
            //setViewContentDisabled(scope.navconData[scope.fieldSet].mode);
            //setApprvoedTreeeColumnOptions(self.scope.type,self.options);
        });

        self.tree.bind("redraw.jstree", function (evt, data) {
            self.data = data;
            self.treeClickEvent();
            setDisabledEnabledByRights(scope.navconData.rights);
            //setViewContentDisabled(scope.navconData[scope.fieldSet].mode);
            //setApprvoedTreeeColumnOptions(self.scope.type, self.options);
        });

        self.tree.bind("create_node.jstree", function (evt, data) {
            self.data = data;
            self.treeClickEvent();
            setDisabledEnabledByRights(scope.navconData.rights);
            //setViewContentDisabled(scope.navconData[scope.fieldSet].mode);
            //setApprvoedTreeeColumnOptions(self.scope.type, self.options);
        });

        self.treeClickEvent = function () {

            $('.jstree-grid-midwrapper').find('input[type=checkbox]').click(function (event, tt) {
                //console.log("click-checkbox");
                var header = $($($(event.currentTarget.offsetParent).parent().children()[0]).find('div')[0]).text();
                var node = self.data.instance.get_node($(event.currentTarget.offsetParent).attr('data-jstreegrid'));
                var columns = self.data.instance._gridSettings.columns;
                var field = self.getColumnValue(header, columns);
                var value = false;
                if ($(event.target).attr("checked") === "checked")
                    value = true;
                var updValue = updateTreeData(self.data.instance.settings.core.data, (typeof node.id === "string" ? node.id : parseInt(node.id)), field, value);
                node.data[field] = value === true ? 1 : 0;
                if (self.scope.navconData !== undefined && self.scope.navconData.treeCellClick !== undefined)
                    self.scope.navconData.treeCellClick(node.id, field, value, node, self.tree, $(this))
            });

            $('.jstree-grid-midwrapper').find('input[type=text]').click(function (event, tt) {
                setTimeout(function () {
                    $(event.target).focus();
                })
            });

            $('.jstree-grid-midwrapper').find('textarea').click(function (event, tt) {
                //setTimeout(function () {
                //    $(event.target).focus();
                //})
            });

            $('.jstree-grid-midwrapper').find('select').click(function (event, tt) {
                setTimeout(function () {
                    $(event.target).focus();
                })
            });

            $('.jstree-grid-midwrapper').find('select').blur(function (event, tt) {
                $(this).attr("size", 1).css('z-index', '1');
            });

            $('.jstree-grid-midwrapper').find('select').focus(function (event, tt) {
                if ($(event.target).is('option')) return false;
                //$(event.target).css("left",$(event.target).parents('div').first().offset().left + "px");
                var expandto = $(event.target).find('option').length;
                if (expandto > 5) expandto = 5;
                $(this).attr("size", expandto).css('z-index', 2);
            });

            $('.jstree-grid-midwrapper').find('input[type=text]').blur(function (event, tt) {
                var header = $($($(event.currentTarget.offsetParent).parent().children()[0]).find('div')[0]).text();
                var node = self.data.instance.get_node($(event.currentTarget.offsetParent).attr('data-jstreegrid'));
                var columns = self.data.instance._gridSettings.columns;
                var field = self.getColumnValue(header, columns);
                var value = $(event.target).val();
                var updValue = updateTreeData(self.data.instance.settings.core.data, parseInt(node.id), field, value);
                node.data[field] = value;
                if (self.scope.navconData !== undefined && self.scope.navconData.treeCellClick !== undefined)
                    self.scope.navconData.treeCellClick(node.id, field, value, node, self.tree, $(this))
            });

            $('.jstree-grid-midwrapper').find('textarea').blur(function (event, tt) {
                var header = $($($(event.currentTarget.offsetParent).parent().children()[0]).find('div')[0]).text();
                var node = self.data.instance.get_node($(event.currentTarget.offsetParent).attr('data-jstreegrid'));
                var columns = self.data.instance._gridSettings.columns;
                var field = self.getColumnValue(header, columns);
                var value = $(event.target).val();
                var updValue = updateTreeData(self.data.instance.settings.core.data, parseInt(node.id), field, value);
                node.data[field] = value;
                if (self.scope.navconData !== undefined && self.scope.navconData.treeCellClick !== undefined)
                    self.scope.navconData.treeCellClick(node.id, field, value, node, self.tree, $(this))
            });

            $('.jstree-grid-midwrapper').find('select').change(function (event, tt) {
                $(this).attr("size", 1).css('z-index', '1');
                var header = $($(event.currentTarget.parentNode.parentNode).parent().children()[0]).text();
                var node = self.data.instance.get_node($(event.currentTarget.parentNode.parentNode).attr('data-jstreegrid'));
                var columns = self.data.instance._gridSettings.columns;
                var field = self.getColumnValue(header, columns);
                var value = $(event.target).val();
                var updValue = updateTreeData(self.data.instance.settings.core.data, parseInt(node.id), field, value);
                node.data[field] = value;
                if (self.scope.navconData !== undefined && self.scope.navconData.treeCellClick !== undefined)
                    self.scope.navconData.treeCellClick(node.id, field, value, node, self.tree, $(this))
            });

            //setApprvoedTreeeColumnOptions(self.scope.type, self.options);
        };

        self.getColumnValue = function (header, columns) {
            for (key in columns) {
                if (columns[key].value === undefined) continue;
                var colHeader = columns[key].header;
                var text = colHeader;
                if (colHeader.indexOf('<div') !== -1)
                    text = $(colHeader).text();
                if (text.toLowerCase().trim() === header.toLowerCase().trim()) {
                    if (!$.isFunction(columns[key].value))
                        return columns[key].value;
                    else
                        return columns[key].field;
                    break;
                }
            }
        };

        self.getTreeSelectedValue = function (value, targetValue) {
            if (value === undefined) return targetValue;
            var retVal = targetValue;
            if (value !== null && value.toString().indexOf('<input') !== -1) {
                var valueObj = $(value);
                if (valueObj.prop("type") === "checkbox") {
                    if ($(event.target).attr("checked") === "checked") {
                        $(valueObj).attr("checked", "checked");

                    } else {
                        if ($(valueObj).attr("checked") !== undefined) {
                            valueObj.removeAttr("checked");
                        }
                    }
                } else {
                    valueObj.attr("value", targetValue);
                }
                var modStr = valueObj.prop('outerHTML');
                retVal = modStr.replace(/"/gi, "'");
            }
            return retVal;
        };

    };

    var updateTreeData = function (data, id, field, value) {
        var returnValue = value;
        var items = data;
        if (items.length === 0) return;
        var treeData = getDataFromTree(items);
        for (var i = 0, len = treeData.length; i < len ; i++) {
            var item = treeData[i];
            if (!$.isEmptyObject(item)) {
                if (item.id !== undefined && (item.id === id || item.id.toString() === id.toString())) {
                    var retVal = self.getTreeSelectedValue(item.data[field], value);
                    item.data[field] = retVal;
                    return retVal;
                }
            }
        };
        return returnValue;
    };

    var getNodeFromTreeDataByField = function (items, field, value) {
        if (items.length === 0) return -1;
        var treeData = getDataFromTree(items);
        for (var i = 0, len = treeData.length; i < len ; i++) {
            var item = treeData[i];
            if (!$.isEmptyObject(item)) {
                if (item[field] !== undefined && item[field] !== null && (item[field] === value || item[field].toString() === value)) {
                    return item;
                }
            }
        }
        return -1;
    };

    var insertChildrenTreeData = function (data, id, node) {
        var items = data;
        if (items.length === 0) return;
        var treeData = getDataFromTree(items);
        for (var i = 0, len = treeData.length; i < len ; i++) {
            var item = treeData[i];
            if (!$.isEmptyObject(item)) {
                /*if (item.CommonId !== undefined)
                    item.id = item.CommonId;*/
                if (item.id !== undefined && (item.id === id || item.id.toString() === id)) {
                    if (item.children === undefined || item.children === null)
                        item.children = [];
                    item.children.push(node);
                    return true;
                }
            }
        }
        return false;
    };

    var chooseTree = function (type, checkedData, targetType, targetData, vm, callback, insNode) {
        var tree = navcon.treeInstance(type);
        var targetTree = navcon.treeInstance(targetType);
        $(checkedData).each(function (index) {
            var currNode = tree.jstree().get_node(this);
            var checkInTarget = targetTree.jstree().get_node(this);
            if (!checkInTarget) {
                var parents = currNode.parents;
                for (var i = parents.length - 1; i >= 0 ; i--) {
                    var nodeId = parents[i];
                    if (nodeId === "#") continue;
                    var newNode = tree.jstree().get_node(nodeId);
                    var targetParent = targetTree.jstree().get_node(nodeId);
                    if (!targetParent) {
                        //create parent node
                        createNewTreeNode(newNode, tree, targetType, targetTree, targetData, vm, callback, insNode);
                    }
                }
                //create node
                createNewTreeNode(currNode, tree, targetType, targetTree, targetData, vm, callback, insNode);
            }
        })

        function createNewTreeNode(node, tree, targetType, targetTree, targetData, vm, callback, insNode) {
            var insNode = angular.copy(vm.pageConfig.trees[insNode]);
            //insNode.id = parseInt(node.id);
            insNode.id = node.id;
            insNode.ParentId = node.parent;
            //insNode.data.id = parseInt(node.id);
            insNode.data.id = node.id;
            insNode.data.ParentId = node.parent;
            insNode.text = node.text;
            if (vm[callback] !== undefined)
                insNode = vm[callback](tree, targetTree, targetData, insNode, node);

            var idExists = getNodeFromTreeDataByField(targetData, 'id', node.id);
            if (idExists === -1) {
                if (node.parent !== "#") {
                    var childrenIns = navcon.insertChildrenTreeData(targetData, node.parent, insNode)
                    if (!childrenIns)
                        targetData.push(insNode);
                }
                else
                    targetData.push(insNode);
            }
        }
    }

    var updateTreeNode = function (type, data, updatedNode, callback) {
        var tree = $("navcon-tree[type='" + type + "']").find('.jstree').find("div[role='tree']").jstree(true);
        if (data.length === 0 && updatedNode === undefined) return;

        $.map(updatedNode, function (item, index) {
            //for (var k in item) {
            //if (k === "id" || item[k] === 0) continue;
            updateTreeDataByNode(data, item.id, item);
            //}
        });

        if (callback !== undefined) callback(data);

        return data;
    };

    var updateTreeDataByNode = function (items, id, targetNode, callback) {
        var retVal = 0;
        if (id !== undefined || id !== "")
            for (var i = 0; i < items.length; i++) {
                if (!$.isEmptyObject(items[i])) {
                    if (items[i].id.toString() === id.toString()) {
                        if (items[i] !== undefined && targetNode !== undefined)
                            items[i] = targetNode;

                        if (callback !== undefined) callback(true);
                        return 1;
                    }
                    if (items[i].children !== undefined && items[i].children !== null && items[i].children.length > 0) {
                        var found = updateTreeDataByNode(items[i].children, id, targetNode);
                        if (found === 1) {
                            retVal = 1;
                            break;
                        }
                    }
                }
            }
        return items;
    };

    //var removeNodeFromTree = function (type, items) {
    //    if (type !== undefined && items === undefined) {
    //        var targetTree = navcon.treeInstance(type);
    //        var insTree = targetTree.jstree();
    //        if (insTree !== undefined) {
    //            items = insTree.settings.core.data;
    //        }
    //    }

    //    var retVal = 0;
    //    for (var i = 0; i < items.length; i++) {
    //        if (!$.isEmptyObject(items[i])) {
    //            if (items[i].data !== undefined && items[i].data.Status !== undefined && items[i].data.Status.toString() === "1") {
    //                removeTreeNode(type, items[i]);
    //            }
    //            if (items[i].children !== undefined && items[i].children !== null && items[i].children.length > 0) {
    //                var found = reassignTreeData(type, items[i].children);
    //            }
    //        }
    //    }
    //    return items;
    //};

    var removeExistsTreeNode = function (sourceTreeType, targetTreeType, sourceTreeData, targetTreeData) {
        var targetTree = treeInstance(targetTreeType);
        var sourceTree = treeInstance(sourceTreeType);

        var treeData = getDataFromTree(targetTreeData);
        for (var i = 0, len = treeData.length; i < len ; i++) {
            var item = treeData[i];
            if (!$.isEmptyObject(item)) {
                /*if (item.CommonId !== undefined)
                    item.id = item.CommonId;*/
                if (item.id !== undefined) {
                    disableTreeNodeById(sourceTree, item.id, sourceTreeData);
                }
            }
        }
    };

    var disableTreeNodeById = function (sourceTree, id, sourceTreeData) {
        for (var i = 0; i < sourceTreeData.length; i++) {
            var item = sourceTreeData[i];
            if (item.id !== undefined && (item.id === id || item.id.toString() === id)) {
                if (item.state === undefined) item.state = {};
                item.state["disabled"] = true;
                if (item.children !== null && item.children.length <= 0)
                    item.state["selected"] = true;
                break;
            } else {
                if (item.children !== undefined && item.children !== null && item.children.length > 0) {
                    disableTreeNodeById(sourceTree, id, item.children);
                }
            }
        }
    };

    var getDataFromTree = function (items, data, seqNo) {
        if (data === undefined || data === "")
            data = [];
        $.map(items, function (item, index) {
            if (!$.isEmptyObject(item)) {
                if (seqNo !== undefined) {
                    item.data['SeqNo'] = seqNo;
                    seqNo++;
                }
                data.push(item)
                if (item.children !== undefined && item.children !== null && item.children.length > 0) {
                    getDataFromTree(item.children, data, 0);
                }
            }
        });

        return data;
    };


    var getTextFromTree = function (items, data, parent) {
        var text = "";
        $.map(items, function (item, index) {
            if (!$.isEmptyObject(item)) {
                var parentID = "";
                if (data === "") {
                    data = item.text;
                    parentID = "";
                } else if (parent === "#" && data !== "") {
                    data = data + ";" + item.text;
                    parentID = "";
                } else {
                    data = data + "\\" + item.text;
                    parentID = item.ParentId;
                }
                if (item.children !== undefined && item.children !== null && item.children.length > 0) {
                    data = getTextFromTree(item.children, data, parentID);
                }

            }
        });
        return data;
    };

    var updateTreeValueById = function (items, id, targetValue, key) {
        var retVal = 0;
        if (id !== undefined || id !== "")
            for (var i = 0; i < items.length; i++) {
                if (!$.isEmptyObject(items[i])) {
                    if (items[i].id === id) {
                        if (items[i].data[key] !== undefined && targetValue !== undefined)
                            items[i].data[key] = setCellControlValue(items[i].data[key], targetValue);
                        return 1;
                    }
                    if (items[i].children !== undefined && items[i].children !== null && items[i].children.length > 0) {
                        var found = updateTreeValueById(items[i].children, id, targetValue, key);
                        if (found === 1) {
                            retVal = 1;
                            break;
                        }
                    }
                }
            }
        return items;
    };

    var loadTreeData = function (type, data, targetData) {
        var tree = $("navcon-tree[type='" + type + "']").find('.jstree').find("div[role='tree']").jstree(true);
        if (data.length === 0) return;
        $.map(JSON.parse(targetData), function (item, index) {
            for (var k in item) {
                if (k === "id" || item[k] === 0) continue;
                updateTreeValueById(data, item["id"], item[k], k);
            }

        });
        return data;
    };

    var treeInstance = function (type) {
        var tree = $("navcon-tree[type='" + type + "']").find('.jstree').find("div[role='tree']");
        return tree;
    }

    var getCheckedTreeNodes = function (type) {
        var tree = treeInstance(type);
        var data = tree.jstree('get_checked');
        return data;
    }

    var setTreeGridColumnValue = function (columns, item, obj) {
        $.map(columns, function (prop, key) {
            if (prop["value"] === undefined || (prop["save"] !== undefined && prop["save"] === false)) return;
            var field = "";
            if (!$.isFunction(prop["value"]))
                field = prop["value"].charAt(0).toUpperCase() + prop["value"].slice(1);
            else
                field = prop["field"].charAt(0).toUpperCase() + prop["field"].slice(1);

            if (field !== undefined && item.data[field] !== undefined) {
                var value = getCellControlValue(item.data[field]);
                obj[field] = value;
            }
        });

        return obj;
    };

    var getTreeData = function (type, field, mode, fields) {
        if (mode === undefined)
            mode = "save";

        var dataList = [];
        var treeData;
        var columns = "";
        var seqData = [];

        if (type !== undefined && type !== null && type !== "") {
            var tree = $("navcon-tree[type='" + type + "']").find('.jstree').find("div[role='tree']").jstree(true);
            seqData = getDataFromTree(tree.get_json('#', { flat: false }), '', 0);
            treeData = getDataFromTree(tree.settings.core.data, '', 0);
            columns = tree._gridSettings.columns;
        } else {
            treeData = getDataFromTree(field.data, '', 0);
        }

        if (field.oldData !== undefined && field.oldData !== "") treeData = insertDeleteditems(treeData, getDataFromTree(field.oldData), "id", "tree");



        $.map(treeData, function (item, index) {
            var obj = {};
            if (!$.isEmptyObject(item)) {
                if (item['CommonId'] !== undefined && item['CommonId'] !== '')
                    item[field.id] = item['CommonId'];

                if (mode.toLowerCase() === "update") {
                    if (item[field.id] !== undefined)
                        obj[field.id] = item[field.id];
                    else
                        obj[field.id] = 0;

                    if (field.refkey !== undefined && item[field.refkey] !== undefined)
                        obj[field.refkey] = item[field.refkey];
                    else {
                        var refIndex = navcon.getItemIndexByProperty(fields, field.refkey);
                        if (refIndex !== undefined && refIndex !== -1) obj[field.refkey] = fields[refIndex].data;
                    }
                }
                else {
                    obj[field.id] = 0;
                }
                obj.id = item.id;
                obj.parentId = ((item.parent || item.ParentId) === "#" ? null : (item.parent || item.ParentId));
                obj.text = item.text || "";
                if (item.data !== undefined) {
                    if (columns !== undefined && columns !== "") {
                        obj = setTreeGridColumnValue(columns, item, obj);
                        if (mode.toLowerCase() === "update") {
                            if (field.refkey !== undefined && item[field.refkey] !== undefined)
                                obj[field.refkey] = item[field.refkey];
                            else {
                                var refIndex = navcon.getItemIndexByProperty(fields, field.refkey);
                                if (refIndex !== undefined && refIndex !== -1) obj[field.refkey] = fields[refIndex].data;
                            }
                        };
                    }
                    else { //Evaluation type data details assign
                        var fieldList = [];
                        $.map(item.data, function (key, index) {
                            if (index.toLowerCase() !== "$id") {
                                if (typeof key === "object")
                                    fieldList.push({ "type": "text", "key": index, "data": key[index] });
                                else if (index.toLowerCase() === "parentid") {
                                    if (key === "#")
                                        fieldList.push({ "type": "text", "key": index, "data": 0 });
                                    else
                                        fieldList.push({ "type": "text", "key": index, "data": parseInt(key) });
                                }
                                else
                                    fieldList.push({ "type": "text", "key": index, "data": key });
                            }
                        });
                        obj = getFieldsDataToSave(fieldList, mode, field.id);
                    }
                    if (mode.toLowerCase() === "save" || mode.toLowerCase() === "saveas") {
                        obj["ObjectState"] = (item.data["ObjectState"] !== undefined && item.data["ObjectState"].toString() !== "" && item.data["ObjectState"].toString() !== "0") ? parseInt(item.data["ObjectState"]) : 1;
                        obj["Status"] = (item.data["Status"] !== undefined && item.data["Status"].toString() !== "" && item.data["Status"].toString() !== "0") ? parseInt(item.data["Status"]) : 0;
                    }
                    else {
                        if (item[field.id] !== undefined)
                            obj["ObjectState"] = (item.data["ObjectState"] !== undefined && item.data["ObjectState"].toString() !== "" && item.data["ObjectState"].toString() !== "0") ? parseInt(item.data["ObjectState"]) : 2;
                        else
                            obj["ObjectState"] = (item.data["ObjectState"] !== undefined && item.data["ObjectState"].toString() !== "" && item.data["ObjectState"].toString() !== "0") ? parseInt(item.data["ObjectState"]) : 1;
                        obj["Status"] = (item.data["Status"] !== undefined && item.data["Status"].toString() !== "" && item.data["Status"].toString() !== "0") ? parseInt(item.data["Status"]) : 0;
                    }
                    obj['SeqNo'] = findSeqNo(seqData, obj.id);
                    dataList.push(obj);
                }
            }
        });
        return dataList;
    };

    var findSeqNo = function (seqData, id) {
        var value = $.grep(seqData, function (e) {
            return e['id'] === id.toString();
        });

        if (value.length > 0) {
            return value[0].data['SeqNo'];
        } else {
            return 0;
        }
    };

    var getCellControlValue = function (value) {
        if (value === null || value.indexOf === undefined) return value;
        var retVal = value;
        if (value.indexOf('<input') !== -1) {
            var valueObj = $(value);
            if (valueObj.prop("type") === "text") {
                retVal = valueObj.val();
            } else {
                if ($(valueObj).attr("checked") !== undefined)
                    retVal = 1;
                else
                    retVal = 0;
            }
        } else if (value.indexOf('<a') !== -1) {
            var valueObj = $(value);
            retVal = valueObj.text();
        }
        return retVal;
    };

    var setCellControlValue = function (value, targetValue) {
        var retVal = value;
        if (value.toString().indexOf('<input') !== -1) {
            var valueObj = $(value);
            if (targetValue === 1)
                valueObj.attr("checked", "checked");
            else
                valueObj.removeAttr("checked");

            var modStr = valueObj.prop('outerHTML');
            retVal = modStr.replace(/"/gi, "'");
        }
        return retVal;
    };

    var setValueToControl = function (value, targetValue) {
        var retVal = targetValue
        if (value.toString().indexOf('<input') !== -1) {
            var valueObj = $(value);
            valueObj.attr("value", targetValue);
            var modStr = valueObj.prop('outerHTML');
            retVal = modStr.replace(/"/gi, "'");
        }
        return retVal;
    };

    var getItemByProperty = function (items, key) {
        var value = $.grep(items, function (e) {
            return e.key === key;
        });

        if (value.length > 0)
            return value[0];
        else {
            //alert('item not found...');
            return -1;
        }
    };

    var getItemByKeyValue = function (items, key, value, lowercase) {
        if (items === null || items === undefined || items.length === undefined) return -1
        var value = $.grep(items, function (e) {
            if (lowercase !== undefined && lowercase)
                return e[key].toString().toLowerCase() === value.toString().toLowerCase();
            else
                return e[key] === value;
        });

        if (value.length > 0) {
            return value[0];
        }
        else {
            return -1;
        }
    };

    var getItemsFilterByKeyValue = function (items, key, value) {
        var value = $.grep(items, function (e) {
            return e[key] === value;
        });

        if (value.length > 0) {
            return value;
        }
        else {
            return [];
        }
    };


    var getItemsNotInOtherItems = function (items, notInItems, itemField, notInFiled) {
        var value = $.grep(items, function (e, i) {
            return e[itemField] !== undefined && getItemsFilterByKeyValue(notInItems, (notInFiled || itemField), e[itemField]).length === 0
        });
        return value;
    };


    var getItemsFilterByObject = function (items, object) {
        var value = $.grep(items, function (e) {
            var foundCount = 0;
            $.map(Object.keys(object), function (prop, key) {
                if (e[prop] === object[prop])
                    foundCount++;

            })
            return Object.keys(object).length === (foundCount);
        });

        if (value.length > 0) {
            return value;
        }
        else {
            return [];
        }
    };



    var getItemIndexByKeyValue = function (items, key, value) {
        var index = -1;
        var value = $.grep(items, function (e, i) {
            if (e[key] !== undefined && e[key] !== null && value !== undefined && value !== null) {
                if (e[key].toString() === value.toString()) {
                    index = i;
                    return;
                    /*} else if (e.children !== undefined && e.children !== null) {
                        arrayindex.push(i);
                        index = getItemIndexByKeyValue(e.children, key, value);
                        if (index !== -1) {
                            index = i;
                            return;
                        }*/
                }
            }
        });

        return index;

    };

    var getItemIndexByProperty = function (items, key) {
        if (items === undefined || items.length === 0) return;
        var index = -1;
        var value = $.grep(items, function (e, i) {
            if (e.key === key) {
                index = i;
                return;
            }
        });

        if (index != -1)
            return index;
        else {
            //alert('item not found...');
            return index;
        }
    };

    var closeModal = function (id) {
        navcon.setViewContentDisabled("");
        var smPadding = $(".page-sidebar-menu").css("padding");
        $(".page-sidebar-menu").css("padding", "0px");
        $(".page-sidebar-menu").css("padding", smPadding + "px");
        if (id !== undefined && id !== null && id !== '')
            $("div[id=" + id + "]").modal('hide');
    };

    var closeReport = function () {
        $('.modal').modal('hide');
    };

    var openModal = function (id, callback) {
        $('#' + id).modal({
            show: true
        });
        $('#' + id).on('shown.bs.modal', function (e) {
            if (callback !== undefined)
                return callback(true);
            else
                return true;
        });
    };

    var getFieldsData = function (fields) {
        var obj = {};
        $.map(fields, function (item, index) {
            obj[item.key] = item.data;
        });
        return obj;
    };

    var setFieldFocus = function (fields) {
        var itemObj;
        var $rootScope = angular.element(document).injector().invoke(function ($rootScope) { return $rootScope; });
        var $timeout = angular.element(document).injector().invoke(function ($timeout) { return $timeout; });
        var $scope = angular.element(document).injector().invoke(function ($timeout) { return $scope; })

        $.map(fields, function (item, index) {
            if (item.templateOptions !== undefined && item.templateOptions.focus !== undefined) {
                item.templateOptions.focus = true;
                $timeout(function () {
                    $rootScope.$broadcast('SET-FOCUS', true);
                })
                return false;
            }
        });
    };

    var saveTables = function (vm, dataservice, type, fields, refId, refValue, popup, callback) {
        for (i = 0, len = fields.length; i < len; i++) {
            if (fields[i].type !== undefined && fields[i].type === 'table' && fields[i].name === type) {
                if (refId !== undefined) {
                    var refIndex = navcon.getItemIndexByProperty(vm[fields[i].field], refId);
                    vm[fields[i].field][refIndex].data = refValue;
                }

                var uploadData = false;
                if (fields[i].upload !== undefined && fields[i].upload !== null && fields[i].upload !== "")
                    uploadData = fields[i].upload;

                var data = navcon.save.saveOption(vm, dataservice, vm[fields[i].field].mode, type, vm[fields[i].tableDataField], vm[fields[i].field], "0", fields[i].id, fields[i].displayfield, 0, uploadData, popup, type, function (data) {
                    if (callback !== undefined) callback(data);
                });
                return data;
            }
        }
    };

    var addNewTables = function ($scope, vm, type, fields, pageConfig, callback) {
        if (pageConfig === undefined || pageConfig === null || pageConfig === "")
            pageConfig = vm.pageConfig;

        for (i = 0, len = fields.length; i < len; i++) {
            if (fields[i].type !== undefined && fields[i].type === 'table' && fields[i].name === type) {
                var title = fields[i].title;
                vm[fields[i].field]["mode"] = "Save";
                var subFormTitle = navcon.save.addNewOption($scope, pageConfig.fields[fields[i].field], vm[fields[i].field], title || "", "", function (data) {
                    if (callback !== undefined) callback(data);
                }, type);
                return subFormTitle;
            }
        }
    };

    var editTables = function ($scope, vm, type, fields, action, data, callback, popup) {
        for (i = 0, len = fields.length; i < len; i++) {
            if (fields[i].type !== undefined && fields[i].type === 'table' && fields[i].name === type) {
                var title = fields[i].title;

                //vm[fields[i].field]["mode"] = "Update";
                if (action.toLowerCase() === "edit") vm[fields[i].field]["mode"] = "Update";
                if (action.toLowerCase() === "delete") vm[fields[i].field]["mode"] = "Delete";
                if (action.toLowerCase() === "view") vm[fields[i].field]["mode"] = "Print";

                //vm.selectedChildRow = navcon.save.selectedRowIndex(vm[fields[i].tableDataField], data, fields[i].id);
                vm[fields[i].field].selectedRow = navcon.save.selectedRowIndex(vm[fields[i].tableDataField], data, fields[i].id);
                var primaryKey;
                if (fields[i].alternatekey !== undefined && fields[i].alternatekey !== "")
                    primaryKey = fields[i].alternatekey;
                else
                    primaryKey = fields[i].id;

                var returnData = null;
                $scope.$apply(function () {
                    returnData = navcon.save.viewOption($scope, action, type, vm[fields[i].tableDataField], vm[fields[i].field], data, primaryKey, fields[i].displayfield, undefined, false,
                        function (data) {
                            if (callback !== undefined) callback(data);
                        }, "", popup);
                });

                return returnData;
            }
        }
    };

    var updateTableEditorData = function (data, field, $scope, isDisabled, vm) {
        var itemList = [];
        var value = angular.copy(data);
        if (value === null || value === undefined) return itemList;

        for (var i = 0, len = value.length; i < len; i++) {
            var setting = angular.copy($scope[field.templateOptions.settings]);
            var item = value[i];
            var retData = {};
            retData.fields = angular.copy(updateFieldsData(setting.fields, item, $scope, isDisabled, vm));
            retData.fields.sno = (i + 1);
            itemList.push(retData);
        }
        return itemList;
    };

    var updateFieldsData = function (fields, item, $scope, isDisabled, vm) {
        toolTipSetting();
        for (var key in fields) {
            var field = fields[key];
            var keyName = field.key;

            if (item !== null && item[keyName] === undefined) {
                if (field.alternatekey !== undefined && field.alternatekey !== "")
                    keyName = field.alternatekey;
            }
            if (keyName == "fuattachments") {
                keyName = keyName;
            }

            if (field.type != undefined && field.type.toLowerCase() === "label" && field.alternateType != undefined && field.alternateType.toLowerCase() === "lastupdated") {
                if (item !== null && item["UpdatedBy"] !== undefined && item["LastUpdateDate"] !== undefined) {
                    if (fields.mode !== undefined && (fields.mode.toLowerCase() === "update" || fields.mode.toLowerCase() === "delete")) {
                        field.data = "Modified by " + item["UpdatedBy"].toString() + " on " + navcon.dateFromUTCToLocal(item["LastUpdateDate"]).toString();
                        field.templateOptions.label = "Modified by " + item["UpdatedBy"].toString() + " on " + navcon.dateFromUTCToLocal(item["LastUpdateDate"], "DD/MM/YYYY hh:mm:ss A").toString();
                    } else {
                        field.data = "";
                        field.templateOptions.label = "";
                    }
                }
            }

            if (item !== null && item[keyName] !== undefined) { //data collected from table
                if (field.type.toLowerCase() === "date" || (field.alternateType != undefined && field.alternateType.toLowerCase() === "date") || field.type.toLowerCase() === "kendodate") {
                    if (item[keyName] !== undefined && item[keyName] !== null && item[keyName] !== "" && item[keyName] !== "0")
                        field.data = navcon.dateFromUTCToLocal(item[keyName]);
                    else
                        field.data = "";
                } else if (field.type.toLowerCase() === "datetime" || field.type.toLowerCase() === "kendodatetime") {
                    if (field.templateOptions.timeonly !== undefined && field.templateOptions.timeonly)
                        field.data = item[keyName];
                    else
                        field.data = navcon.dateFromUTCToLocal(item[keyName], "DD/MM/YYYY HH:mm:ss");
                }
                else if (field.type.toLowerCase() === "select" || field.type.toLowerCase() === "kendoselect" || field.type.toLowerCase() === "kendocombobox") {
                    var itemList = -1;
                    field.selectOptions.item["isSelect"] = false;

                    if ((item[keyName] !== undefined && item[keyName] !== null) || (item[field.selectOptions.item.refField] !== undefined && item[field.selectOptions.item.refField] !== null))
                        itemList = getItemByKeyValue(field.selectOptions.items, (field.selectOptions.item.dataField || "id"), item[field.selectOptions.item.refField || keyName])
                    if (itemList === -1)
                        field.data = "";
                    else
                        field.data = itemList;
                } else if (field.type.toLowerCase() === "checkboxlist" || field.type.toLowerCase() === "groupcheckboxlist") {
                    //field.selectOptions.item["isSelect"] = false;
                    field.data = loadCheckBoxList(item[keyName], field, fields);
                } else if (field.type.toLowerCase() === "multiselect" || field.type.toLowerCase() === "multiselectcheckbox" || field.type.toLowerCase() === "kendomultiselect") {
                    field.selectOptions.item["isSelect"] = false;
                    field.data = loadMultiSelect(item[keyName], field);
                } else if (field.type.toLowerCase() === "fileupload") {
                    field.data = item[keyName];
                    if (isDisabled !== undefined) field.ischangeable = !isDisabled;
                    if (field.readonly !== undefined && field.readonly) field.ischangeable = !field.readonly;
                } else if (field.type.toLowerCase() === "tableeditor") {
                    field.data = updateTableEditorData(item[keyName], field, $scope, isDisabled, vm);
                } else if (field.type.toLowerCase() === "table") {
                    if ($scope !== undefined && $scope[field.tableDataField] !== undefined) $scope[field.tableDataField].data = [];
                    if ($scope !== undefined && $scope.navconData !== undefined && $scope.navconData[field.tableDataField] !== undefined) $scope.navconData[field.tableDataField].data = [];
                    if (vm !== undefined && vm[field.tableDataField] !== undefined) vm[field.tableDataField].data = [];
                    if (vm !== undefined && vm[field.tableDataField] === undefined && vm[field.field] !== undefined) navcon.clearFieldsData(vm[field.field], $scope, false);

                    if (item[keyName] !== undefined && item[keyName] !== null && $scope[field.tableDataField] !== undefined) {
                        $scope[field.tableDataField].data = item[keyName];
                        $scope[field.tableDataField].oldData = angular.copy(item[keyName]);
                    } else if (item[keyName] !== undefined && item[keyName] !== null && $scope !== undefined && $scope.navconData !== undefined && $scope.navconData[field.tableDataField] !== undefined) {
                        $scope.navconData[field.tableDataField].data = item[keyName];
                        $scope.navconData[field.tableDataField].oldData = angular.copy(item[keyName]);
                    } else if (item[keyName] !== undefined && item[keyName] !== null && vm !== undefined && vm[field.tableDataField] !== undefined) {
                        vm[field.tableDataField].data = item[keyName];
                        vm[field.tableDataField].oldData = angular.copy(item[keyName]);

                        if (field.childrenField !== undefined && field.childrenField && item[keyName][0] !== undefined && item[keyName][0] !== null)
                            updateFieldsData(vm[field.field], item[keyName][0], $scope, isDisabled, vm);
                    } else if (vm !== undefined && vm[field.field] !== undefined) {
                        //} else if (item[keyName] !== undefined && item[keyName] !== null && vm !== undefined && vm[field.field] !== undefined) {
                        if (typeof item[keyName] === "object")
                            updateFieldsData(vm[field.field], item[keyName], $scope, isDisabled, vm);
                        else
                            updateFieldsData(vm[field.field], item[keyName][0], $scope, isDisabled, vm);
                    }

                    field.data = item[keyName];
                } else if (field.type.toLowerCase() === "tree" || field.type.toLowerCase() === "evaluation") {
                    if (vm === undefined) vm = $scope;
                    if (item[keyName] !== undefined && item[keyName] !== null && vm[field.treeDataField]) {
                        vm[field.treeDataField].core.data = [];
                        vm[field.treeDataField].core.data = item[keyName];
                        if (field.name !== undefined && field.name !== "")
                            vm[field.treeDataField].core.treeType = field.name;
                        vm[field.treeDataField].core.oldData = angular.copy(item[keyName]);
                        field.data = item[keyName];
                    }
                }
                else if (field.type.toLowerCase() === "rating") {
                    if (item[keyName] === null)
                        field.data = 0;
                    else
                        field.data = item[keyName];
                }
                else {
                    if (item[keyName] != null && item[keyName] !== undefined) field.data = item[keyName] == null ? "" : item[keyName];
                }

                if (isDisabled !== undefined) field.disabled = isDisabled;
                if (field.readonly !== undefined && field.readonly) field.disabled = field.readonly;
            } else if (item !== null && item[key] !== undefined) {//data collected from common fields
                if (item[key].data !== undefined) {
                    if (item[key] != null && item[key] !== undefined) field.data = item[key].data;

                    if (field.type.toLowerCase() === "fileupload") {
                        if (isDisabled !== undefined) field.ischangeable = !isDisabled;
                        if (field.readonly !== undefined && field.readonly) field.ischangeable = !field.readonly;
                    }

                    if (isDisabled !== undefined) field.disabled = isDisabled;
                    if (field.readonly !== undefined && field.readonly) field.disabled = field.readonly;
                }
            } else {
                if (item !== null && item.data !== undefined) {//data collected from tree / subchild
                    if (item.data[keyName] !== undefined) {
                        $scope.$apply(function () {
                            field.data = item.data[keyName];

                            if (isDisabled !== undefined) field.disabled = isDisabled;
                            if (field.readonly !== undefined && field.readonly) field.disabled = field.readonly;
                        });
                    }
                }
            }

            if (isDisabled !== undefined) field.disabled = isDisabled;
            if (field.readonly !== undefined && field.readonly) field.disabled = field.readonly;

            field.oldData = angular.copy(field.data);

            if (field.readOnlyText != undefined) {
                field.readOnlyText = displayreadonlyField(field);
            }
            else if (field.type != undefined) {
                if (field.type != undefined && field.type.toLowerCase() === "radio") {
                    $.each(field.templateOptions.items, function (key, item) {
                        if (item.value == field.data) {
                            field.readOnlyText = item.label;
                        }
                    })

                }
                else {
                    var result = displayField(field);
                    if (result.oldData != undefined) {
                        field.readOnlyText = result.data;
                    } else {
                        field.readOnlyText = result;
                    }

                }

            }
        }
        return fields;
    };

    function displayreadonlyField(item) {
        var returnValue = item.data;
        if (item.type === "select" || item.type === "kendoselect" || item.type === "kendocombobox") {
            returnValue = item.data[item.selectOptions.item.displayField];
        } else if (item.type === "multiselect" || item.type === "multiselectcheckbox" || item.type.toLowerCase() === "kendomultiselect") {
            var list = [];
            if (item.data == undefined || item.data == "" || item.data == null) {
                item.data = [];
            }
            for (var i = 0, len = item.data.length; i < len; i++) {
                var obj = item.data[i];
                list.push(obj[item.selectOptions.item.displayField])
            }
            returnValue = list.join("; ");
        } else if (item.type === "checkbox") {
            if (item.data || item.data === 1 || item.data === "true")
                returnValue = item.templateOptions.suffixLabel;
            else {
                if (item.templateOptions.suffixLabelfalse !== undefined)
                    returnValue = item.templateOptions.suffixLabelfalse;
                else
                    returnValue = "No";
            }
        } else if (item.type === "radio") {
            var items = item.templateOptions.items;
            var findObj = navcon.getItemByKeyValue(items, "value", item.data);
            if (findObj !== -1) {
                if (item.templateOptions.suffixLabelfalse !== undefined)
                    returnValue = findObj.suffixLabel;
                else
                    returnValue = findObj.label;
            } else {
                if (item.templateOptions.suffixLabelfalse !== undefined)
                    returnValue = items[0].suffixLabel;
                else
                    returnValue = item.data;
            }
        }
        else {
            returnValue = item.data;
        }
        if (returnValue != undefined) {
            returnValue.data = returnValue.data != undefined ? returnValue.data : ""
            returnValue.oldData = returnValue.oldData != undefined ? returnValue.oldData : ""
            if (returnValue.data == "" && returnValue.oldData == "") {
                returnValue = "";
            }
        }
        return returnValue != undefined ? returnValue : "";
    };

    var loadMultiSelect = function (items, field) {
        if (items === undefined || items === null || items === "")
            return;
        var list = [];
        $.map(items, function (item, key) {
            var objValue = getItemByKeyValue(field.selectOptions.items, (field.selectOptions.item.dataField || "id"), item[(field.selectOptions.item.dataField || "id")]);
            if (objValue === -1) {
                list.push(item);
            } else {
                if (field["altkey"] !== undefined)
                    objValue[field["altkey"]] = item[field["altkey"]];

                if (field["refkey"] !== undefined)
                    objValue[field["refkey"]] = item[field["refkey"]];
                list.push(objValue);
            }
        });
        return list;
    }

    var loadCheckBoxList = function (items, field, fields) {
        if (items === undefined || items === null || items === "") return;
        var list = [];
        var fieldData = field.data;
        var refId = "";
        if (field.listDisplay !== undefined && field.listDisplay) {
            $.map(fields, function (fieldItem, index) {
                if ((fieldItem.type === "checkboxlist" || fieldItem.type === "groupcheckboxlist") && fieldItem.listDisplay !== undefined && fieldItem.listDisplay && fieldItem.group !== undefined) {
                    $.map(fieldItem.data, function (dataItem, dataIndex) {
                        var eventIndex = getItemIndexByKeyValue(items, (field.templateOptions.item.dataField || "EventID"), dataItem[(field.templateOptions.item.dataField || "EventID")])
                        if (eventIndex !== -1 && fieldItem.group.indexOf(dataItem.EventSection) !== -1) {
                            dataItem.value = true;
                        }
                    })
                }
            });
        } else {
            $.map(items, function (item, key) {
                var groupObject = getItemByKeyValue(fieldData, (field.templateOptions.item.dataField || "ParentID"), item[(field.templateOptions.item.groupField || "ParentID")]);
                if (groupObject !== undefined && groupObject !== -1) {

                    var eventIndex = getItemIndexByKeyValue(groupObject.data, (field.templateOptions.item.dataField || "EventID"), item[(field.templateOptions.item.dataField || "EventID")]);
                    if (eventIndex !== undefined && eventIndex !== -1) {
                        var EventName = groupObject.data[eventIndex].EventName;
                        groupObject.data[eventIndex] = item;
                        groupObject.data[eventIndex].EventName = EventName;
                        groupObject.data[eventIndex].value = true;
                    }
                }
            });
        }
        return fieldData;
    }

    var insertDeleteditems = function (newItems, oldItems, tableKey, controlType) {
        if (oldItems === undefined) return newItems;
        if (controlType !== "tableEditor") {
            $.map(oldItems, function (item, key) {
                if (item['CommonId'] !== undefined && item['CommonId'] !== '') {
                    item[tableKey] = item['CommonId'];
                    tableKey = 'CommonId';
                }

                var value = getItemByKeyValue(newItems, tableKey, item[tableKey]);
                if (value === -1) {
                    if (controlType !== undefined && controlType !== "" && controlType.toString().toLowerCase() === "tree") {
                        item.data["ObjectState"] = 2;
                        item.data["Status"] = 1;
                    }

                    item["ObjectState"] = 2;
                    item["Status"] = 1;
                    if (controlType !== undefined && controlType !== "" && controlType.toString().toLowerCase() === "table") {
                        item["ObjectState"] = 2;
                        item["Status"] = 1;
                    }
                    newItems.push(item);
                }

            });

        }
        else if (controlType === "tableEditor") {
            var olditemList = [];
            var oldPrimaryKey = [];
            var newPrimaryKey = [];
            for (var i = 0, len = oldItems.length; i < len; i++) {
                var item = oldItems[i];
                var retSata = getFieldsDataToSave(item.fields, 'Update', tableKey);

                olditemList.push(retSata);
                oldPrimaryKey.push(retSata[tableKey]);
            }

            for (var j = 0; j < newItems.length; j++) {
                var item = newItems[j];
                newPrimaryKey.push(item[tableKey])
            }

            for (var j = 0; j < oldPrimaryKey.length; j++) {
                if (newPrimaryKey.indexOf(oldPrimaryKey[j]) === -1) {
                    olditemList[j].ObjectState = 2;
                    olditemList[j].Status = 1;
                    newItems.push(olditemList[j])
                }
            }

        }
        return newItems;
    };

    var getFieldsColumn = function (columns) {
        var obj = {};
        if (columns.length > 0) {
            $.map(columns, function (item, key) {
                if (item.data !== null) {
                    obj[item.data] = "";
                }
            });
        }
        return obj;
    };

    var clearKeyVakues = function (object) {
        for (key in object) {
            object[key] = "";
        }
        return object;
    };

    var addDataList = function (vm, fields, tableOptions, uniqueKey) {
        var item = navcon.getFieldsData(fields);
        var items = tableOptions;
        var tableData = {};
        if (items.data.length > 0) {
            var index = getItemIndexByKeyValue(items.data, uniqueKey, item[uniqueKey]);
            if (index !== -1) {
                tableData = items.data[index];
                items.data.splice(index, 1);
            } else {
                tableData = getFieldsColumn(items.columns);
                $.extend(tableData, item);
            }

            $.map(Object.keys(item), function (prop, key) {
                if (item[prop] !== undefined) {
                    var field = fields[key];
                    if (field.type.toUpperCase() === "SELECT")
                        tableData[prop] = tableData[prop].id || tableData[prop].Id || tableData[prop].code || tableData[prop].Code;
                    else if (field.type.toUpperCase() === "DATE") {
                        if (item[prop] !== undefined && item[prop] !== null && item[prop] !== "" && item[prop] !== "0")
                            tableData[prop] = navcon.dateToUTC(item[prop]);
                        else
                            tableData[prop] = "";
                    }
                    else
                        tableData[prop] = item[prop];
                }
            });
        } else {
            tableData = getFieldsColumn(items.columns);
            $.extend(tableData, item);
        }
        items.data.push(tableData);
        return tableData;
    };

    var getTableEditorData = function (data, mode, fieldItem, primaryKey, fields) {
        var itemList = [];
        var index = navcon.getItemIndexByProperty(fields, primaryKey);
        var primaryKeyValue = fields[index].data;
        for (var i = 0, len = data.length; i < len; i++) {
            var item = data[i];
            var retSata = getFieldsDataToSave(item.fields, mode, primaryKey);
            if (mode !== undefined && mode.toLowerCase() === "update") {
                // fieldItem.templateOptions.key = "CauseActiveFailureId";
                if (fieldItem.templateOptions.key !== undefined && fieldItem.templateOptions.key !== "") {
                    if (retSata[fieldItem.templateOptions.key] !== undefined && (retSata[fieldItem.templateOptions.key] === 0 || retSata[fieldItem.templateOptions.key] === "0")) {
                        retSata.ObjectState = 1;
                        if (retSata[primaryKey] !== undefined)
                            retSata[primaryKey] = primaryKeyValue;
                    }
                }
            }
            itemList.push(retSata);
        }
        //return itemList;
        if (mode.toLowerCase() === "save")
            return itemList;
        else {
            return insertDeleteditems(itemList, fieldItem.oldData, (fieldItem.templateOptions.key || 'id'), "tableEditor");
        }

    }

    var isSave = function (fields, editorsave) {
        var save = false
        if (editorsave !== undefined && editorsave !== "")
            save = editorsave;
        $.map(fields, function (item, index) {
            if (item.key.toLowerCase() !== "objectstate" || item.key.toLowerCase() !== "status") {
                if (item.type === "tableeditor") {
                    if ((item.data !== undefined)) {
                        for (var i = 0, len = item.data.length; i < len; i++) {
                            var data = item.data[i];
                            if (data.fields !== undefined)
                                save = isSave(data.fields, save);
                            if (save) return save;
                        }
                    }
                } else {
                    if (item.oldData !== undefined && JSON.stringify(angular.copy(item.oldData)) !== JSON.stringify(angular.copy(item.data))) {
                        save = true;
                        return save;
                    }
                }
            }
            if (save) return save;
        })
        return save;
    };

    var comparedata = function (fields, pagename, section, pkname, pkid, identifier, pushedData) {
        var changedItems;
        if (pushedData != undefined) {
            changedItems = pushedData;
        } else {
            changedItems = [];
        }
        var $rootScope = angular.element(document).injector().invoke(function ($rootScope) { return $rootScope; });
        var pagename = $rootScope.configHeaderMenu == 'bowtieanalysis' ? 'riskaggregation' : $rootScope.configHeaderMenu;
        var Batchdate = new Date();
        var keyword = identifier || "";
        // Batchdate = Batchdate.getTime();
        $.map(fields, function (item, index) {
            if (item.key.toLowerCase() !== "CompiledByIdName" && item.key.toLowerCase() !== "objectstate" && item.key.toLowerCase() !== "status" && !(item.key.toLowerCase().indexOf("itarwarning") != -1)) {
                if (item.type === "tableeditor") {
                    if ((item.data !== undefined)) {
                        for (var i = 0, len = item.data.length; i < len; i++) {
                            var data = item.data[i];
                            if (data.fields !== undefined) {
                                var key = item.key;
                                var groupname = item.templateOptions.label != undefined ? item.templateOptions.label : "";
                                var temp = [];
                                $.each(data.fields, function (index, value) {
                                    if (value.key.toLowerCase() !== "objectstate" && value.key.toLowerCase() !== "status") {
                                        value.tableEditor = key;
                                        if (value.oldData == undefined) {
                                            value.oldData = "";
                                        }
                                        if (value.oldData !== undefined && value.data !== undefined && JSON.stringify(angular.copy(value.oldData)) !== JSON.stringify(angular.copy(value.data)) && value.name != undefined) {
                                            var returnData = displayField(value)
                                            //temp.push({ name: value.name, oldData: returnData.oldData, data: returnData.data });
                                            if (returnData.data == undefined) {
                                                returnData.data = "";
                                            }
                                            if (returnData.oldData == undefined) {
                                                returnData.oldData = "";
                                            }
                                            if (returnData.data != returnData.oldData)
                                                changedItems.push({ HistoryId: 0, Field: value.name.replace(':', ''), oldData: returnData.oldData, NewData: returnData.data, row: i + 1, SubSection: groupname, Page: pagename, ObjectState: 0, Section: section, PKName: pkname, PKId: pkid, Batch: Batchdate, keyword: keyword })
                                        }
                                    }
                                });
                            }
                        }
                        // if (item.data.length < item.oldData.length) {
                        var oldPrimarkeys = [];
                        var curPrimarkeys = [];
                        if (item.oldData != undefined) {
                            for (var i = 0, len = item.oldData.length; i < len; i++) {
                                var data = item.oldData[i];
                                $.each(data.fields, function (index, value) {
                                    if (value.key === item.templateOptions.key) {
                                        oldPrimarkeys.push(value.data);
                                    }
                                })
                            }
                        }
                        for (var i = 0, len = item.data.length; i < len; i++) {
                            var curdata = item.data[i];
                            $.each(curdata.fields, function (index, value) {
                                if (value.key === item.templateOptions.key) {
                                    curPrimarkeys.push(value.data);
                                }
                            })
                        }

                        for (var j = 0; j < oldPrimarkeys.length; j++) {

                            // look for same thing in new array
                            if (curPrimarkeys.indexOf(oldPrimarkeys[j]) == -1)

                                for (var i = 0, len = item.oldData.length; i < len; i++) {
                                    var data = item.oldData[i];
                                    $.each(data.fields, function (index, value) {
                                        if (value.data === oldPrimarkeys[j]) {
                                            $.each(data.fields, function (i, valueData) {
                                                if (valueData.name !== undefined) {
                                                    var returnData = displayField(valueData);
                                                    changedItems.push({ HistoryId: 0, Field: valueData.name, oldData: returnData.oldData, NewData: 'Deleted', row: j + 1, SubSection: groupname, Page: pagename, ObjectState: 0, Section: section, PKName: pkname, PKId: pkid, Batch: Batchdate, keyword: keyword })
                                                }
                                            })
                                        }
                                    })
                                }
                        }
                    }
                }

                else if (item.type === "table") {
                    if (item.oldData == undefined) {
                        item.oldData = "";
                    }

                    if ((item.data !== undefined)) {
                        var groupname = item.label != undefined ? item.label : "";
                        var oldPrimarkeys = [];
                        var curPrimarkeys = [];
                        for (var i = 0, len = item.oldData.length; i < len; i++) {
                            var data = item.oldData[i];
                            oldPrimarkeys.push(data[item.primaryKey]);

                        }
                        for (var i = 0, len = item.data.length; i < len; i++) {
                            var curdata = item.data[i];
                            curPrimarkeys.push(curdata[item.primaryKey]);
                        }
                        var InsertFields = item.InsertFields;
                        for (var j = 0; j < oldPrimarkeys.length; j++) {

                            // look for same thing in new array
                            if (curPrimarkeys.indexOf(oldPrimarkeys[j]) == -1) {
                                var data = item.oldData[j];

                                if (oldPrimarkeys[j] == data[item.primaryKey]) {
                                    $.each(InsertFields, function (key, itemValue) {
                                        var oldData = data[itemValue.field];
                                        changedItems.push({ HistoryId: 0, Field: itemValue.label, oldData: oldData, NewData: "Deleted", row: j + 1, SubSection: groupname, Page: pagename, ObjectState: 0, Section: section, PKName: pkname, PKId: pkid, Batch: Batchdate })
                                    })
                                }
                            }
                        }
                        for (var j = 0; j < curPrimarkeys.length; j++) {

                            // look for same thing in new array
                            if (oldPrimarkeys.indexOf(curPrimarkeys[j]) == -1) {

                                var curdata = item.data[j];

                                if (curPrimarkeys[j] == curdata[item.primaryKey]) {
                                    $.each(InsertFields, function (key, itemValue) {
                                        var newData = curdata[itemValue.field];
                                        changedItems.push({ HistoryId: 0, Field: itemValue.label, oldData: '--', NewData: newData, row: j + 1, SubSection: groupname, Page: pagename, ObjectState: 0, Section: section, PKName: pkname, PKId: pkid, Batch: Batchdate, keyword: keyword })
                                    })
                                }
                            }
                        }
                    }
                }
                else if (item.type === "fileupload") {
                    var oldFiles = "";
                    var newFiles = "";
                    if (item.oldData === undefined) {
                        oldFiles = "";
                        item.oldData = [];
                    }
                    if (item.oldData !== undefined && JSON.stringify(angular.copy(item.oldData)) !== JSON.stringify(angular.copy(item.data))) {

                        $.each(item.oldData, function (i, item) {

                            oldFiles += item.name + ",";
                        });
                        oldFiles = oldFiles.substring(0, oldFiles.length - 1);

                        $.each(item.data, function (k, newItem) {

                            newFiles += newItem.name + ",";

                        });
                        newFiles = newFiles.substring(0, newFiles.length - 1);
                        var returnData = displayField(item);

                        if ((item.data == undefined || item.data == "" || item.data.length == 0) && item.oldData.length == 0) {
                            return true;
                        }
                        changedItems.push({ HistoryId: 0, Field: item.templateOptions.label.replace(':', ''), oldData: oldFiles, NewData: newFiles, row: "", SubSection: "", Page: pagename, ObjectState: 0, Section: section, PKName: pkname, PKId: pkid, Batch: Batchdate, keyword: keyword });

                    }
                }
                else if (item.type === "groupcheckboxlist") {
                    var oldarray = [];
                    var newarray = [];
                    var dataField = item.templateOptions.item.dataField;
                    var Fieldname = item.templateOptions.item.displayField;
                    if (item.oldData != undefined && item.oldData.length > 0) {
                        if (item.data != undefined && item.data.length > 0) {
                            $.each(item.oldData, function (index, valueData) {
                                oldarray = valueData;
                                $.each(item.data, function (index, itemData) {

                                    if (oldarray[dataField] == itemData[dataField] && itemData.value != undefined && itemData.value != oldarray.value) {
                                        changedItems.push({ HistoryId: 0, Field: itemData[Fieldname], oldData: oldarray.value == undefined ? 'unchecked' : (oldarray.value ? 'checked' : 'unchecked'), NewData: itemData.value ? 'checked' : 'unchecked', row: "", SubSection: "", Page: pagename, ObjectState: 0, Section: section, PKName: pkname, PKId: pkid, Batch: Batchdate, keyword: keyword });
                                    }
                                });
                            })
                        }
                    }
                }
                else if (item.type === "checkboxlist") {
                    if (item.oldData != undefined && item.oldData.length > 0) {
                        if (item.data != undefined && item.data.length > 0) {
                            var oldDataArray = [];
                            var dataArray = [];
                            var dataField = item.templateOptions.item.dataField;
                            var Fieldname = item.templateOptions.item.displayField;
                            $.each(item.oldData, function (index, ValueData) {
                                oldDataArray = ValueData.data
                                if (oldDataArray == null) {
                                    oldDataArray = [];
                                }

                                $.each(item.data, function (index, value) {
                                    dataArray = value.data
                                    //  if (oldDataArray != null && dataArray != null) {
                                    if (dataArray == null) {
                                        dataArray = [];
                                    }
                                    $.each(oldDataArray, function (index, itemData) {
                                        $.each(dataArray, function (index, item) {
                                            if (item[dataField] == itemData[dataField] && item.value != itemData.value) {
                                                changedItems.push({ HistoryId: 0, Field: item[Fieldname], oldData: itemData.value ? 'checked' : 'unchecked', NewData: item.value ? 'checked' : 'unchecked', row: "", SubSection: "", Page: pagename, ObjectState: 0, Section: section, PKName: pkname, PKId: pkid, Batch: Batchdate, keyword: keyword });
                                            }
                                        });
                                    });
                                    // }
                                });

                            });
                        }
                    }
                }
                else if (item.type == "multiselectcheckbox" || item.type.toLowerCase() === "kendomultiselect" ) {
                    if (item.oldData === undefined) {
                        item.oldData = "";
                    }

                    if (item.data === undefined) {
                        item.data = "";
                    }
                    var PrimaryId = item.selectOptions.item.dataField;


                    if (item.oldData != "" && item.data != "") {

                        var matcheddata = angular.copy(item.data);

                        $.each(matcheddata, function (masterindex, itemValue) {
                            $.each(item.oldData, function (keyIndex, itemData) {
                                if (itemValue != undefined && itemValue[PrimaryId] == itemData[PrimaryId]) {
                                    matcheddata.splice(masterindex, 1);
                                }
                            })
                        })

                        if (matcheddata.length > 0) {
                            var returnData = displayField(item);
                            if (returnData != undefined && returnData.data != returnData.oldData)
                                changedItems.push({ HistoryId: 0, Field: item.templateOptions.label.replace(':', ''), oldData: returnData.oldData, NewData: returnData.data, row: "", SubSection: "", Page: pagename, ObjectState: 0, Section: section, PKName: pkname, PKId: pkid, Batch: Batchdate, keyword: keyword });
                        }

                        else if (item.oldData != undefined && item.oldData != "" && item.oldData.length > item.data.length) {
                            var matchedolddata = angular.copy(item.oldData);
                            $.each(matchedolddata, function (masterindex, itemValue) {
                                $.each(item.data, function (keyIndex, itemData) {
                                    if (itemValue != undefined && itemValue[PrimaryId] == itemData[PrimaryId]) {
                                        matchedolddata.splice(masterindex, 1);
                                    }
                                })
                            })
                            if (matchedolddata != undefined && matchedolddata.length > 0) {
                                var returnData = displayField(item);
                                if (returnData != undefined && returnData.data != returnData.oldData)
                                    changedItems.push({ HistoryId: 0, Field: item.templateOptions.label.replace(':', ''), oldData: returnData.oldData, NewData: returnData.data, row: "", SubSection: "", Page: pagename, ObjectState: 0, Section: section, PKName: pkname, PKId: pkid, Batch: Batchdate, keyword: keyword });
                            }

                        }
                    }
                    else if (item.oldData == "" && item.data != "") {

                        var returnData = displayField(item);
                        if (returnData != undefined && returnData.data != returnData.oldData)
                            changedItems.push({ HistoryId: 0, Field: item.templateOptions.label.replace(':', ''), oldData: "", NewData: returnData.data, row: "", SubSection: "", Page: pagename, ObjectState: 0, Section: section, PKName: pkname, PKId: pkid, Batch: Batchdate, keyword: keyword });

                    }
                    else if (item.oldData != "" && item.data == "") {

                        var returnData = displayField(item);
                        if (returnData != undefined && returnData.data != returnData.oldData)
                            changedItems.push({ HistoryId: 0, Field: item.templateOptions.label.replace(':', ''), oldData: returnData.oldData, NewData: "", row: "", SubSection: "", Page: pagename, ObjectState: 0, Section: section, PKName: pkname, PKId: pkid, Batch: Batchdate, keyword: keyword });
                    }
                }
                else if (item.type === "htmltable") {
                    var oldDataArray = [];
                    var dataArray = [];

                    if (item.oldData === undefined) {
                        item.oldData = [];
                    }

                    if (item.data === undefined) {
                        item.data = [];
                    }

                    var columns = item.columns;
                    var labelcolumns = item.labelcolumns;
                    var scopevariable = item.scopevariable || "";
                    var objecttype = item.objecttype || "";

                    if (scopevariable != undefined && scopevariable != "") {

                        var _scopevariable = angular.element('#' + scopevariable).scope().$parent;

                        var paneldata = _scopevariable.formManage[item.panelvariable];
                        if (paneldata != undefined) {
                            for (var m = 0; m < paneldata.length; m++) {
                                changedItems = comparedata(paneldata[m], pagename, section, pkname, pkid, identifier, changedItems)
                            }
                        }
                    }
                    else if (item.objecttype != undefined && item.objecttype != "") {
                        if (item.data != undefined && item.data != null) {
                            $.each(item.data, function (index, itemData) {
                                var parentSection = itemData[item.section];
                                var oldDataObject;
                                if (item.objecttype != undefined) {
                                    oldDataObject = item.oldData[index][objecttype];
                                } else {
                                    oldDataObject = item.oldData[index];
                                }

                                if (itemData[objecttype] != undefined) {
                                    $.each(itemData[objecttype], function (key, value) {
                                        var childSection = value[item.subsection];
                                        if (oldDataObject[key] != undefined) {
                                            for (var k = 0; k < columns.length; k++) {
                                                if (value[columns[k]] != oldDataObject[key][columns[k]]) {
                                                    changedItems.push({
                                                        HistoryId: 0,
                                                        Field: labelcolumns[k],
                                                        oldData: oldDataObject[key][columns[k]],
                                                        NewData: value[columns[k]],
                                                        row: "",
                                                        SubSection: childSection,
                                                        Page: pagename,
                                                        ObjectState: 0,
                                                        Section: parentSection,
                                                        PKName: pkname,
                                                        PKId: pkid,
                                                        Batch: Batchdate, keyword: keyword
                                                    });
                                                }
                                            }
                                        } else {
                                            for (var k = 0; k < columns.length; k++) {
                                                changedItems.push({
                                                    HistoryId: 0,
                                                    Field: labelcolumns[k],
                                                    oldData: "",
                                                    NewData: value[columns[k]],
                                                    row: "",
                                                    SubSection: childSection,
                                                    Page: pagename,
                                                    ObjectState: 0,
                                                    Section: parentSection,
                                                    PKName: pkname,
                                                    PKId: pkid,
                                                    Batch: Batchdate, keyword: keyword
                                                });
                                            }
                                        }
                                    })
                                }
                                else {
                                    var childSection = itemData[item.subsection];
                                    if (oldDataObject != undefined) {
                                        for (var k = 0; k < columns.length; k++) {
                                            if (itemData[columns[k]] != oldDataObject[columns[k]]) {
                                                changedItems.push({
                                                    HistoryId: 0,
                                                    Field: labelcolumns[k],
                                                    oldData: oldDataObject[columns[k]],
                                                    NewData: itemData[columns[k]],
                                                    row: "",
                                                    SubSection: childSection,
                                                    Page: pagename,
                                                    ObjectState: 0,
                                                    Section: parentSection,
                                                    PKName: pkname,
                                                    PKId: pkid,
                                                    Batch: Batchdate, keyword: keyword
                                                });
                                            }
                                        }
                                    }
                                    else {
                                        for (var k = 0; k < columns.length; k++) {
                                            changedItems.push({
                                                HistoryId: 0,
                                                Field: labelcolumns[k],
                                                oldData: "",
                                                NewData: itemData[columns[k]],
                                                row: "",
                                                SubSection: childSection,
                                                Page: pagename,
                                                ObjectState: 0,
                                                Section: parentSection,
                                                PKName: pkname,
                                                PKId: pkid,
                                                Batch: Batchdate, keyword: keyword
                                            });
                                        }
                                    }
                                }
                            })
                        }
                    }
                    else {
                        $.each(item.data, function (index, itemData) {
                            var oldDataObject = item.oldData[index];
                            if (oldDataObject == undefined) {
                                oldDataObject = [];
                            }
                            var parentSection = itemData[item.section];
                            for (var k = 0; k < columns.length; k++) {
                                if (itemData[columns[k]] != oldDataObject[columns[k]]) {
                                    changedItems.push({ HistoryId: 0, Field: labelcolumns[k], oldData: oldDataObject[columns[k]], NewData: itemData[columns[k]], row: "", SubSection: parentSection, Page: pagename, ObjectState: 0, Section: section, PKName: pkname, PKId: pkid, Batch: Batchdate, keyword: keyword });
                                }
                            }
                        })
                    }
                }
                else if (item.type === "tree") {
                    var oldDataArray = [];
                    var dataArray = [];

                    if (item.oldData === undefined) {
                        item.oldData = [];
                    }

                    if (item.data === undefined) {
                        item.data = [];
                    }
                    var objecttype = item.objecttype || "";
                    var childobject = item.childobject || "";
                    var columns = item.columns;
                    var labelcolumns = item.labelcolumns;

                    var scopevariable = item.scopevariable || "";
                    if (scopevariable != undefined && scopevariable != "") {

                        var _scopevariable = angular.element('#' + scopevariable).scope().$parent;

                        var treedata = _scopevariable.formManage[item.treevariable];
                        if (treedata != undefined && treedata.data != undefined) {
                            var curdata = treedata.data;
                            var prevdata = treedata.oldData;

                            if (curdata != undefined && curdata != "" && prevdata != undefined && prevdata != "") {
                                for (var index = 0; index < curdata.length; index++) {
                                    for (var col = 0; col < columns.length; col++) {
                                        if (curdata[index].data[columns[col]] != prevdata[index].data[columns[col]]) {
                                            changedItems.push({
                                                HistoryId: 0,
                                                Field: labelcolumns[col],
                                                oldData: prevdata[index].data[columns[col]],
                                                NewData: curdata[index].data[columns[col]],
                                                row: "",
                                                SubSection: curdata[index].text,
                                                Page: pagename,
                                                ObjectState: 0,
                                                Section: "",
                                                PKName: pkname,
                                                PKId: pkid,
                                                Batch: Batchdate,
                                                keyword: keyword
                                            });
                                        }
                                    }
                                }
                            }
                        }
                    }
                }
                else {
                    if (item.oldData === undefined) {
                        item.oldData = "";
                    }

                    if (item.data === undefined) {
                        item.data = "";
                    }

                    if (item.oldData !== undefined && JSON.stringify(angular.copy(item.oldData)) !== JSON.stringify(angular.copy(item.data)) && item.type.toLowerCase() !== "table" && item.type.toLowerCase() !== "label" && item.key.toLowerCase() !== "ITAR") {
                        var returnData = displayField(item);
                        if (returnData != undefined && returnData.data != returnData.oldData) {
                            if (returnData.data != undefined && returnData.data == 'AUTHORISED') {
                                returnData.data = 'AUTHORIZED'
                            }
                            changedItems.push({
                                HistoryId: 0,
                                Field: item.templateOptions.label.replace(':', ''),
                                oldData: returnData.oldData,
                                NewData: returnData.data,
                                row: "",
                                SubSection: "",
                                Page: pagename,
                                ObjectState: 0,
                                Section: section,
                                PKName: pkname,
                                PKId: pkid,
                                Batch: Batchdate,
                                keyword: keyword
                            });
                        }
                    }
                }
            }
        })
        return changedItems;
    };
    function getDifferences(oldObj, newObj) {
        var diff = {};

        for (var k in oldObj) {
            if (!(k in newObj))
                diff[k] = undefined;  // property gone so explicitly set it undefined
            else if (oldObj[k] !== newObj[k])
                diff[k] = newObj[k];  // property in both but has changed
        }

        for (k in newObj) {
            if (!(k in oldObj))
                diff[k] = newObj[k]; // property is new
        }

        return diff;
    }
    var BrowserDetect = function () {
        var nav = window.navigator,
        ua = window.navigator.userAgent.toLowerCase();
        // detect browsers (only the ones that have some kind of quirk we need to work around)
        if (ua.match(/ipad/i) !== null)
            return "iPod";
        if (ua.match(/iphone/i) !== null)
            return "iPhone";
        if (ua.match(/android/i) !== null)
            return "Android";
        if ((nav.appName.toLowerCase().indexOf("microsoft") != -1 || nav.appName.toLowerCase().match(/trident/gi) !== null))
            return "IE";
        if (ua.match(/chrome/gi) !== null)
            return "Chrome";
        if (ua.match(/firefox/gi) !== null)
            return "Firefox";
        if (ua.match(/webkit/gi) !== null)
            return "Webkit";
        if (ua.match(/gecko/gi) !== null)
            return "Gecko";
        if (ua.match(/opera/gi) !== null)
            return "Opera";
        //If any case miss we will return null
        return null
    }

    function displayField(item) {
        var returnValue = {};
        if (item.type === "select" || item.type === "kendoselect" || item.type === "kendocombobox") {
            returnValue.data = item.data[item.selectOptions.item.displayField];
            if (item.oldData != undefined && item.oldData != "") {
                returnValue.oldData = item.oldData[item.selectOptions.item.displayField];
            }
            else {
                returnValue.oldData = "";
            }

        } else if (item.type === "multiselect" || item.type === "multiselectcheckbox" || item.type.toLowerCase() === "kendomultiselect") {
            var list = [];
            var oldlist = [];
            if (item.data == undefined) item.data = [];
            for (var i = 0, len = item.data.length; i < len; i++) {
                var obj = item.data[i];
                var getdata = obj[item.selectOptions.item.displayField];
                if (item.selectOptions.item.secondDisplayField != undefined) {
                    getdata = obj[item.selectOptions.item.displayField] + '/' + obj[item.selectOptions.item.secondDisplayField];
                }
                list.push(getdata);
            }
            if (item.oldData != undefined && item.oldData != "") {
                for (var i = 0, len = item.oldData.length; i < len; i++) {
                    var obj = item.oldData[i];
                    var getdata = obj[item.selectOptions.item.displayField];
                    if (item.selectOptions.item.secondDisplayField != undefined) {
                        getdata = obj[item.selectOptions.item.displayField] + '/' + obj[item.selectOptions.item.secondDisplayField];
                    }
                    oldlist.push(getdata);
                }
            }
            else {
                oldlist = [];
            }
            returnValue.data = list.join("; ");
            returnValue.oldData = oldlist.join("; ");

        } else if (item.type === "checkbox") {
            if (item.oldData != undefined && item.oldData != "") {
                if (item.oldData || item.oldData === 1 || item.oldData === "true") {
                    returnValue.oldData = item.templateOptions.suffixLabel;
                }
            } else {
                returnValue.oldData = "";
            }

            if (item.data || item.data === 1 || item.data === "true") {
                returnValue.data = item.templateOptions.suffixLabel;
            }
            else {
                if (item.templateOptions.suffixLabelfalse !== undefined)
                    returnValue.data = item.templateOptions.suffixLabelfalse;
                else
                    returnValue.data = "No";
            }
        } else if (item.type === "radio") {
            var items = item.templateOptions.items;
            if (item.oldData != undefined && item.oldData != null && item.oldData.toString() != "") {
                var findobjold = getItemByKeyValue(items, "value", item.oldData);
                if (findobjold !== -1) {
                    returnValue.oldData = findobjold.label;
                } else {
                    returnValue.oldData = item.oldData;
                }
            } else {
                returnValue.oldData = "";
            }

            var findObj = getItemByKeyValue(items, "value", item.data);
            if (findObj !== -1) {
                returnValue.data = findObj.label;
            } else {
                returnValue.data = item.data;
            }
        }
        else {
            returnValue.data = item.data;
            if (item.oldData != undefined && item.oldData != "") {
                returnValue.oldData = item.oldData;
            } else {
                returnValue.oldData = "";
            }
        }

        if (returnValue != undefined) {
            returnValue.data = returnValue.data != undefined ? returnValue.data : ""
            returnValue.oldData = returnValue.oldData != undefined ? returnValue.oldData : ""
            if (returnValue.data == "" && returnValue.oldData == "") {
                returnValue = "";
            }
        }
        return returnValue != undefined ? returnValue : "";
    }

    var getFieldsDataToSave = function (fields, mode, key, upload) {
        var obj = {};
        var formData = new FormData();
        var type;
        $.map(fields, function (item, index) {
            if (item != undefined && item != null && item != "") {
                if (item.save !== undefined && item.save === false) return true;
                if (item.type != undefined) {
                    type = 0;
                    if (item.type.toLowerCase() === "select" || item.type.toLowerCase() === "kendoselect" || item.type.toLowerCase() === "kendocombobox") {
                        if (item.data == undefined) {
                            item.data = "";
                        }
                        var selectedData = (item.data[item.selectOptions.item.dataField] || item.data.Id || item.data.id);
                        obj[item.key] = (selectedData !== undefined && selectedData !== "" ? selectedData : null);
                    } else if (item.type.toLowerCase() === "tab") {
                        var selectedData = (item.data[item.selectOptions.item.dataField] || item.data.Id || item.data.id || item.data);
                        obj[item.key] = (selectedData !== undefined && selectedData !== "" ? selectedData : null);
                    } else if (item.type.toLowerCase() === "multiselect" || item.type.toLowerCase() === "multiselectcheckbox" || item.type.toLowerCase() === "kendomultiselect") {
                        obj[item.key] = updateMultiselectData(item, mode, fields, key);
                    } else if (item.type.toLowerCase() === "checkboxlist" || item.type.toLowerCase() === "groupcheckboxlist") {
                        obj[item.key] = updateCheckBoxListData(item, mode, fields, key);
                    } else if (item.type.toLowerCase() === "tableeditor") {
                        obj[item.key] = getTableEditorData(item.data, mode, item, key, fields);
                    } else if (item.type.toLowerCase() === "table") {
                        if (item.checkedField !== undefined && item.checkedField !== "" && item.checkedField.toString().toLowerCase() === "all") {
                            obj[item.key] = item.data;
                        }
                        else {
                            var checked = (item.checkedField === undefined || item.checkedField === '') ? false : true;
                            obj[item.key] = navcon.getTableData(item.name, '', checked, (item.id || ''), checked ? item.checkedField : '', item.oldData, mode);
                        }
                    } else if (item.type.toLowerCase() === "tree") {
                        obj[item.key] = getTreeData(item.name, item, mode, fields);
                    } else if (item.type.toLowerCase() === "evaluation") {
                        obj[item.key] = getTreeData("", item, mode, fields);
                    } else if (item.type.toLowerCase() === "checkbox") {
                        if (item.data === false || item.data === "" || item.data === undefined)
                            obj[item.key] = false;
                        else
                            obj[item.key] = true;
                    } else if (item.type.toLowerCase() === "radio") {
                        obj[item.key] = (item.data != undefined && item.data.toString() != "") ? item.data : null;
                    }
                    else if (item.type.toLowerCase() === "date" || item.type.toLowerCase() === "kendodate") {
                        if (item.data !== undefined && item.data !== null && item.data !== "" && item.data !== "0")
                            obj[item.key] = navcon.dateToUTC(item.data);
                        else
                            obj[item.key] = null;
                    } else if (item.type.toLowerCase() === "datetime" || item.type.toLowerCase() === "kendodatetime") {
                        if (item.data !== undefined && item.data !== null && item.data !== "" && item.data !== "0") {
                            if (item.templateOptions.timeonly !== undefined && item.templateOptions.timeonly)
                                obj[item.key] = item.data;
                            else
                                obj[item.key] = navcon.dateToUTC(item.data, "DD/MM/YYYY HH:mm:ss");
                        }
                        else
                            obj[item.key] = null;
                    } else if (item.type.toLowerCase() === "fileupload" || item.type.toLowerCase() === "photoupload") {
                        angular.forEach(item.data, function (f) {
                            if (f.status !== undefined && f.status === "new") {
                                var blob = base64ToBlob(f.base64, f.type);
                                formData.append("blob", blob, f.name);
                            }
                        });
                        obj[item.key] = item.data;
                        item.data = "";
                    } else {
                        if ((item.datatype !== undefined && item.datatype.toLowerCase() === "integer") && (item.data === undefined || item.data === null || item.data === ""))
                            obj[item.key] = null;
                            /*else if (item.data === "" || item.data === undefined)
                                obj[item.key] = null;*/
                        else
                            if (item.key == "History" || item.key == "HistoryRemarks") {
                                obj[item.key] = item.data == 0 ? "" : item.data;
                            }
                            else {
                                obj[item.key] = item.data === undefined ? "" : item.data;
                            }
                    }
                }
                else {
                    type = -1;
                }
            }
            else {
                type = -1;
            }
        });

        //if (mode !== undefined && mode.toLowerCase() === "save") {
        //    if (fields['objectstate'] !== undefined) fields['objectstate'] = 1;
        //    if (fields[key] !== undefined) fields[key] = 0;
        //} else if (mode !== undefined && mode.toLowerCase() === "update") {
        //    if (fields['objectstate'] !== undefined) fields['objectstate'] = 2;
        //}
        if (type === 0) {
            var objIndex = navcon.getItemIndexByProperty(fields, "ObjectState");
            if (mode !== undefined && mode.toLowerCase() === "save") {
                if (fields[objIndex] !== undefined && (obj.ObjectState === "" || obj.ObjectState === "0" || obj.ObjectState === 0)) obj.ObjectState = 1;
                if (fields[key] !== undefined) obj[key] = 0;
            } else if (mode !== undefined && mode.toLowerCase() === "update") {
                if (fields[objIndex] !== undefined && (obj.ObjectState === "" || obj.ObjectState === "0" || obj.ObjectState === 0)) obj.ObjectState = 2;
            }

            if (upload !== undefined && upload)
                obj["filesUpload"] = formData;

            return obj;
        }
        else {
            return fields;
        }
    };

    var base64ToBlob = function (b64Data, contentType) {
        var byteCharacters = atob(b64Data.split(',')[1]);
        var byteNumbers = new Array(byteCharacters.length);
        for (var i = 0; i < byteCharacters.length; i++) {
            byteNumbers[i] = byteCharacters.charCodeAt(i);
        }
        var byteArray = new Uint8Array(byteNumbers);
        var blob = new Blob([byteArray], { type: contentType });
        return blob;
    }

    var updateMultiselectData = function (item, mode, fields, key) {
        var list = [];
        if (item.data === undefined || item.data === "" || item.data === null) {
            item.data = [];
            return item.data;
        }
        $.map(item.data, function (value, index) {
            var obj = {};
            //obj[item.selectOptions.item.dataField || 'id'] = value[item.selectOptions.item.dataField] || value.Id;
            obj[item.selectOptions.item.dataField || 'id'] = value[item.selectOptions.item.dataField || 'Id'];

            if ((mode.toLowerCase() === "save" || mode.toLowerCase() === "saveas") && value[item.altkey || 'Id'] == 0) {
                obj.ObjectState = 1;
            } else {
                //retData = navcon.getItemByKeyValue(item.oldData, (item.selectOptions.item.dataField || 'id'), (value[item.selectOptions.item.dataField] || value.Id))
                retData = navcon.getItemByKeyValue(item.oldData, (item.selectOptions.item.dataField || 'id'), (value[item.selectOptions.item.dataField || 'Id']))
                if (retData !== -1) {
                    obj.ObjectState = 2;
                    if (item.refkey !== undefined && item.refkey !== null) obj[item.refkey] = value[item.refkey];
                }
                else {
                    obj.ObjectState = 1;
                    var keyIndex = navcon.getItemIndexByProperty(fields, item.refkey);
                    if (keyIndex !== undefined && keyIndex !== -1) obj[item.refkey] = fields[keyIndex].data;
                }

                if (item.altkey !== undefined && item.altkey !== null) obj[item.altkey] = (value[item.altkey] === undefined ? 0 : value[item.altkey]);
            }
            obj.Status = 0;
            if (item.selectOptions.item.type !== undefined && value[item.selectOptions.item.type])
                obj[item.selectOptions.item.type] = value[item.selectOptions.item.type];
            list.push(obj);
        });

        //if (mode.toLowerCase() === "save")
        //    return list;
        //else
        return insertDeleteditems(list, item.oldData, (item.selectOptions.item.dataField || 'id'));
    };

    var updateCheckBoxListData = function (item, mode, fields, key) {
        var list = [];
        if (item.data === undefined || item.data === "" || item.data === null || item.data.length === undefined || item.data.length === 0) return;
        if (item.listDisplay !== undefined && item.listDisplay) {
            $.map(fields, function (fieldItem, index) {
                if ((fieldItem.type === "checkboxlist" || fieldItem.type === "groupcheckboxlist") && fieldItem.listDisplay !== undefined && fieldItem.listDisplay) {
                    $.map(fieldItem.data, function (dataItem, dataIndex) {
                        if (dataItem.value !== undefined && dataItem.value) {
                            dataItem.Status = 0;

                            var refkeyIndex = navcon.getItemIndexByProperty(fields, item.refkey);
                            if (refkeyIndex !== undefined && refkeyIndex !== -1) dataItem[item.refkey] = fields[refkeyIndex].data;

                            if (mode.toLowerCase() === "save" || mode.toLowerCase() === "saveas") {
                                dataItem.ObjectState = 1;
                            } else {
                                dataItem.ObjectState = 1;
                            }

                            var eventIndex = getItemIndexByKeyValue(list, (fieldItem.templateOptions.item.dataField || "EventID"), dataItem[(fieldItem.templateOptions.item.dataField || "EventID")]);
                            if (eventIndex === -1) {
                                list.push(dataItem);
                            }
                        }
                    });
                }
            })
        } else {
            $.map(item.data, function (parentdata, index) {
                $.map(parentdata.data, function (eventdata, ind) {
                    var obj = {};
                    obj = eventdata;
                    obj.Status = 0;

                    var refkeyIndex = navcon.getItemIndexByProperty(fields, item.refkey);
                    if (refkeyIndex !== undefined && refkeyIndex !== -1) obj[item.refkey] = fields[refkeyIndex].data;

                    if (mode.toLowerCase() === "save" || mode.toLowerCase() === "saveas") {
                        obj.ObjectState = 1;
                    } else {
                        obj.ObjectState = 1;
                    }

                    if (obj.value === true)
                        if (eventdata.value) list.push(obj);
                });
            });
        }


        return list;
    };

    /*var treeDataUpdate = function (type, id, mode) {
        getDataFromTree(items)
        return getTreeData(type, id, mode);
    }*/

    var clearFieldsData = function (fields, $scope, uploadClear) {
        $.map(fields, function (item, index) {
            if (item.type.toLowerCase() === "fileupload" || item.type.toLowerCase() === "photoupload") {
                item.data = [];
                if (item.type.toLowerCase() === "fileupload") {
                    var elem = angular.element(document.querySelector('[ng-app]'));
                    var injector = elem.injector();
                    var $rootScope = injector.get('$rootScope');
                    if (uploadClear !== undefined && !uploadClear)
                        $rootScope.$broadcast('FILEUPLOAD-CLEAR', true, false);
                    else
                        $rootScope.$broadcast('FILEUPLOAD-CLEAR', true, true);
                }
            } else if (item.type.toLowerCase() === "label" && item.alternateType != undefined && item.alternateType.toLowerCase() === "lastupdated") {
                item.data = "";
                item.templateOptions.label = "";
            } else if (item.type.toLowerCase() === "rating") {
                item.data = "0";
            } else if (item.type.toLowerCase() === "tableeditor") {

            } else if (item.type.toLowerCase() === "multiselectcheckbox" || item.type.toLowerCase() === "kendomultiselect" || item.type.toLowerCase() === "kendoselect" || item.type.toLowerCase() === "kendocombobox") {
                item.data = [];
            }
            else if (item.type.toLowerCase() === "label" && (item.templateOptions === undefined || item.templateOptions === null)) {
                if (item.Olddata === null) {
                    item.data = null;
                }
                else {
                    item.data = "0";
                }

            } else if ((item.datatype !== undefined && item.datatype !== null && item.datatype !== "" && item.datatype.toLowerCase() === "integer")) {
                item.data = "";
            } else
                item.data = "";

            item.valid = false;

            if (item.form !== undefined) {
                if (item.form[item.key] !== undefined && item.form[item.key].$setValidity !== undefined && typeof item.form[item.key].$setValidity === "function")
                    item.form[item.key].$setValidity('isExist', true)
            }

            if (item.oldData != undefined) {
                item.oldData = "";
            }
        });
    };

    var clearTreeData = function (type) {
        //var checkbox = $("navcon-tree[type='" + type + "']").find('.jstree').find("input[type='checkbox']");
        var checkbox = $("navcon-tree[type='" + type + "']").find('.jstree').find("input[type='checkbox'][checked='checked']")
        $(checkbox).removeAttr("checked");
    };

    var treeDataRefresh = function (data, type, callback) {
        var tree = $("navcon-tree[type='" + type + "']").find('.jstree').find("div[role='tree']").jstree(true);
        if (tree.settings === undefined) return;
        tree.settings.core.data = data;
        tree.refresh();
        tree.redraw(true);
        if (callback !== undefined)
            callback(data);
    };

    var deleteDataList = function (tableOptions, row) {
        if (tableOptions !== undefined && row !== undefined) {
            tableOptions.data.splice(row, 1);
        }
    };

    var createTreeNode = function (type, currentNode, newNode, position) {
        var tree = $("navcon-tree[type='" + type + "']").find('.jstree').find("div[role='tree']");
        tree.jstree('create_node', currentNode.id, newNode, position);
    };

    var removeTreeNode = function (type, currentNode, treeSettings, hasParentRemove) {
        ///*below 2 line used for setViewContentDisabled function, don't remove*/
        //if (scope.navconData[scope.fieldSet] !== undefined && scope.navconData[scope.fieldSet].mode !== undefined)
        //    scope.navconData[scope.fieldSet].mode = "";

        /*selected node remove*/
        var tree = $("navcon-tree[type='" + type + "']").find('.jstree').find("div[role='tree']");
        tree.jstree().delete_node($('#' + currentNode.id));

        var parentRemove = false;
        if (hasParentRemove !== undefined && hasParentRemove !== null && hasParentRemove !== "")
            parentRemove = hasParentRemove;
        else
            parentRemove = currentNode.parent !== "#" ? true : false;

        /*Parent node remove*/
        if (parentRemove) {
            var parentNode = tree.jstree().get_node(currentNode.parent);
            if (parentNode.children.length === 0) {
                removeTreeNode(type, parentNode, treeSettings, hasParentRemove);
            }
        }

        /*current node treesetting rebind*/
        var jsInstance = tree.jstree(true);
        if (jsInstance !== undefined && jsInstance !== null) {
            //tree data value remove
            if (treeSettings !== undefined && treeSettings !== "") {
                var checkdata = angular.copy(treeSettings.core.data);
                if (checkdata !== undefined && checkdata !== "") {
                    var data = deleteTreeValueByNode(checkdata, currentNode["id"]);
                    if (typeof data === "object") {
                        var returnData = reorderTreeData(data);
                        treeSettings.core.data = [];
                        treeSettings.core.data = angular.copy(returnData);
                    }
                    else
                        treeSettings.core.data.splice(data, 1);
                    jsInstance.settings.core.data = treeSettings.core.data;
                }
            }
        }
    };

    var deleteTreeValueByNode = function (items, targetValue) {
        var retVal = 0;
        if (targetValue !== undefined || targetValue !== "") {
            for (var i = 0; i < items.length; i++) {
                if (!$.isEmptyObject(items[i])) {
                    /*if (items[i].id === undefined || items[i].id === null)
                        items[i].id = items[i].CommonId;*/
                    if (items[i].id.toString() === targetValue.toString()) {
                        delete items[i];
                        return i;
                    }
                    if (items[i].children !== undefined && items[i].children !== null && items[i].children.length > 0) {
                        var found = deleteTreeValueByNode(items[i].children, targetValue);
                        if ((found !== undefined) && (typeof found !== "object")) {
                            retVal = 1;
                            break;
                        }
                    }
                }
            }
        }
        return items;
    };

    var reorderTreeData = function (data) {
        var childData = [];
        for (var i = 0; i < data.length; i++) {
            if (data[i] !== undefined) {
                var currentData = angular.copy(data[i]);
                currentData.children = {};

                childData.push(currentData);

                if (data[i].children !== undefined && data[i].children !== null && data[i].children.length > 0) {
                    var returnVal = reorderTreeData(data[i].children);
                    if (returnVal != undefined && returnVal.length > 0) {
                        var childLoop = childData.length - 1;
                        childData[childLoop].children = returnVal;
                    }
                }
            }
        }

        return childData;
    };

    var getTreeDataById = function (treeData, parentId, nodeType) {
        //var getTreeData = [];
        var getDataCollect = [];
        for (var i = 0; i < treeData.length; i++) {
            var item = angular.copy(treeData[i]);
            if (item.id !== undefined && item.id !== null && (item.id === parentId || item.id.toString() === parentId.toString())) {
                if (nodeType !== undefined && (nodeType.toLowerCase() === "child" || nodeType.toLowerCase() === "children"))
                    getDataCollect = item.children;
                else
                    getDataCollect.push(item);

                break;
            } else {
                if (item.children !== undefined && item.children !== null && item.children.length > 0) {
                    getDataCollect = getTreeDataById(item.children, parentId, nodeType);
                    if (getDataCollect.length > 0) break;
                }
            }
        }

        return getDataCollect;
    };

    var editTreeNode = function (type, currentNode, text) {
        var tree = $("navcon-tree[type='" + type + "']").find('.jstree').find("div[role='tree']");
        tree.jstree().rename_node(currentNode, text);
    };

    var updateTreeSingleData = function (type, currentNode, columnName, text, columnNo, controlType) {
        var tree = $("navcon-tree[type='" + type + "']").find('.jstree').find("div[role='tree']");
        var nodeId;
        if (currentNode.data.id !== undefined && currentNode.data.id !== null)
            nodeId = (currentNode.data.id || currentNode.data.Id);
        else
            nodeId = (currentNode.id || currentNode.Id);

        var parentNode = tree.jstree().get_node(nodeId);
        parentNode.data[columnName] = text;

        if (columnNo === undefined || columnNo === null || columnNo === "") columnNo = 1;
        var getColumn = $(tree).parent().parent().find("div[id='jsgrid_" + nodeId + "_col" + columnNo + "']");
        if (getColumn !== undefined && getColumn.children.length !== 0) {
            if (controlType !== undefined && controlType !== null && controlType !== "") {
                var getCtrl = $(getColumn.children().find(controlType));
                if (getCtrl !== undefined)
                    getCtrl.val(text);
            } else {
                $(getColumn.children()[0]).html(text);
            }
        }
    };

    var dateConvert = function (date, isUTC, format) {
        var returnData = "";

        if (format === undefined || format === "") format = "YYYY-MM-DD HH:mm:ss";
        if (isUTC === undefined || isUTC === "") isUTC = true;

        if (isUTC) {
            returnData = moment.utc(date).format(format);
        }
        else {
            var localTime = moment.utc(date).toDate();
            returnData = moment(localTime).format(format);
        }

        return returnData;
    };

    var dateToUTC = function (date, format) {
        var format = format || "DD/MM/YYYY";
        if (date !== undefined && date !== "")
            return moment(date, format).utc().format("YYYY-MM-DD HH:mm:ss");
        else
            return null;
    };

    var dateFromUTCToLocal = function (date, format) {
        var format = format || "DD/MM/YYYY";
        var localTime = moment.utc(date).toDate();
        return moment(localTime).format(format);
    };

    var dateFormat = function (date, format) {
        var format = format || "DD/MM/YYYY";
        return moment(date, format);
    };

    var getCurrentDate = function (format) {
        return "Date: " + moment().format(format || "DD-MM-YYYY");
    }

    var insertControl = function (type, data) {
        var valueObj = "";
        if (data.toString().indexOf('<input') !== -1) return data;
        if (type === "checkbox") {
            valueObj = "<input type='checkbox'>";
            if (data === 1 || data === true || data === "1")
                $(valueObj).attr("checked", "checked");
            else
                $(valueObj).removeAttr("checked");
        } else if (type === "text") {
            valueObj = "<input type='text' value='" + data.toString() + "' style='width: 50px' maxlength='5'>";
        }
        var html = $(valueObj).prop('outerHTML');
        if (html === undefined) return data;
        return html.replace(/"/gi, "'");
    };

    var loadData = function (node, obj) {
        var value = node.data[obj.field];
        var fieldType = obj.fieldType || '';
        var parent = obj.parent || false;
        if (node.children !== undefined && node.children.length > 0 && fieldType !== undefined && fieldType !== '' && parent === false)
            return "";

        var valueObj = "";
        if (fieldType === "checkbox") {
            if (value === 1 || value === true || value === "1" && value !== null) {
                valueObj = "<div style = 'text-align:center;'><input type='checkbox' checked='checked'></div>";
            }
            else {
                valueObj = "<div style='text-align:center;'><input type='checkbox'></div>";
                //default data assign
                if ((value === 0 || value === "0" || value === "" || value === undefined)) node.data[obj.field] = 0;
            }

            //default data assign
            if (self.scope.navconData !== undefined && self.scope.navconData.treeCellClick !== undefined)
                self.scope.navconData.treeCellClick(node.id, obj.field, value !== undefined && value !== null ? value : 0, node, null, $(this));

        } else if (fieldType === "text") {
            if (obj.format !== undefined && obj.format.toLowerCase() === "date" && value !== "")
                value = dateFromUTCToLocal(value.toString());
            valueObj = "<div style='text-align:center;'><input type='text' value='" + value.toString() + "'></div>";
        } else if (fieldType === "textarea") {
            if (obj.format !== undefined && obj.format.toLowerCase() === "date" && value !== "")
                value = dateFromUTCToLocal(value.toString());
            valueObj = "<div><textarea style='width: 96%; height: 33px;'>" + value.toString() + "</textarea><div type='validRequiredIndicate' title='Required' style='color: red; font-size:15pt; display: none;'>*</div></div>";
        }
        else if (fieldType === "select") {
            var data = node.data.OptionData;
            var optionData = "";
            for (var iLoop = 0; iLoop < data.length; iLoop++) {
                optionData += "<option value='" + data[iLoop].id + "'>" + data[iLoop].text + "</option>";
            }
            //default data assign
            if (data.length > 0 && (value === 0 || value === "0" || value === "" || value === undefined)) {
                if (self.scope.navconData !== undefined && self.scope.navconData.treeCellClick !== undefined)
                    self.scope.navconData.treeCellClick(node.id, obj.field, data[0].id, node, null, $(this));

                node.data[obj.field] = data[0].id;
            }
            valueObj = "<select size=\"1\" expandto=\"5\" class=\"selectpicker\" style='position:fixed; width: 150px;'>" + optionData + "</select>";
        }
        else if (fieldType === "delete") {
            valueObj = "<div style = 'text-align:center;'><a class='float-center delete btn default btn-xs treebtn' href='javascript:;' data-target='#deleteconform' data-toggle='modal'>\
                        <i class='fa fa-trash-o'></i> </a></div>";
        }
        else if (fieldType === "anchor") {
            valueObj = "<div style='text-align:center;'><a  href='javascript:;' class='mandatory'>" + value.toString() + "</a></div>";
        } else {
            if (obj.format !== undefined && obj.format.toLowerCase() === "date" && value !== "" && value !== null)
                valueObj = dateFromUTCToLocal(value);
        }

        return valueObj;
    };

    var loadTableData = function (node, field, fieldType) {
        var value = node[field];
        //var fieldType = obj.fieldType;
        if (node.children !== undefined && node.children.length > 0)
            return "";
        var valueObj = "";
        if (fieldType === "checkbox") {
            if (value === 1 || value === true || value === "1")
                valueObj = "<input type='checkbox' checked='checked'>";
            else
                valueObj = "<input type='checkbox'>";

            node["Check_Field"] = field;
            node[field] = node["Row_Checked"] !== undefined && node["Row_Checked"] !== null ? node["Row_Checked"] : value;
        } else if (fieldType === "text") {
            valueObj = "<input type='text' value='" + value.toString() + "'>";
        }
        else if (fieldType === "anchor") {
            valueObj = "<div style = 'text-align:center;'><a  href='javascript:;' class='mandatory'>" + value.toString() + "</a></div>";
        }
        return valueObj;
    };

    var jsonTransformed = function (data) {

        if (data !== undefined && data !== null) {
            var jsonText = JSON.stringify(data);
            data = functionConvert(jsonText);
        }

        return data;

        function functionConvert(jsonText) {
            var jsonFinal = JSON.parse(jsonText, function (key, value) {
                if (value && (typeof value === 'string') && value.indexOf("function") === 0) {
                    // we can only pass a function as string in JSON ==> doing a real function
                    var jsFunc = new Function('return ' + value)();
                    return jsFunc;
                }

                return value;
            });

            return jsonFinal;
        }
    };

    var handleError = function (error, logger) {
        if (error.data === undefined) {
            logger.error('', 'XHR Failed');
        }
        var message = error.statusText;
        var reason = error.data.Message;
        if (error.statusText === "Unauthorized") {
            reason = "Unauthorized";
            message = error.data.Message;
        }

        logger.error(message, reason);
    };

    var menuRightsCheck = function (menuSettings, mainMenu, subMenu) {
        var retValue = false;
        var main = getItemByKeyValue(menuSettings.data, 'ConfigName', mainMenu);
        if (main !== -1) {
            var item = getItemByKeyValue(main.children, 'ConfigName', subMenu);
            if (item !== -1)
                retValue = true;
        }
        return retValue;
        //return true;
    }

    var getUserRights = function (menuSettings, mainMenu, subMenu) {
        var retValue = {};
        if (mainMenu !== undefined && mainMenu === "") {
            var main = getItemByKeyValue(menuSettings.data, 'MenuCode', subMenu);
            if (main !== -1)
                retValue = main.data;
        } else {
            var main = getItemByKeyValue(menuSettings.data, 'MenuCode', mainMenu);
            if (main !== -1) {
                var item = getItemByKeyValue(main.children, 'MenuCode', subMenu);
                if (item !== -1)
                    retValue = item.data;
            }
        }
        return retValue;
    }


    var getSubMenus = function (menuSettings, mainMenu) {
        var retValue = [];
        var main = getItemByKeyValue(menuSettings.data, 'ConfigName', mainMenu);
        if (main !== -1) {
            retValue = main.children;
        }
        return retValue;
    }

    var getMenuTitle = function (menuSettings, mainMenu) {
        /*var scope = getAppScope();
        var $injector = angular.injector();
        $injector.invoke(['bsLoadingOverlayService', function(bsLoadingOverlayService){
            console.log(bsLoadingOverlayService);
        }]);*/
        var retValue = "";
        var main = getItemByKeyValue(menuSettings.data, 'ConfigName', mainMenu);
        if (main !== -1) {
            retValue = main.text;
        }
        return retValue;
    };

    var setViewContentDisabled = function (currentMode) {
        if (currentMode !== undefined) {
            if (currentMode.toLowerCase() === "view" || currentMode.toLowerCase() === "delete") {
                $(".jstree-grid-wrapper").css({ "pointer-events": "none", "background-color": "aliceblue" });
            } else {
                $(".jstree-grid-wrapper").css({ "pointer-events": "auto", "background-color": "transparent" });
            }
        }
    };

    var setApprvoedTableCollection = function (table, options) {
        if (options.approvedDisplay === undefined || options.approvedDisplay === false) {
            var columnNo = navcon.getItemIndexByKeyValue(options.columns, "title", "Status");

            $.map($(table).find("tbody tr"), function (item, index) {
                if ($($(item).find("td")[columnNo]).text() !== undefined && $($(item).find("td")[columnNo]).text() !== null
                    && $($(item).find("td")[columnNo]).text().toLowerCase() === "approved") {
                    if ($(item).find(".fa-edit").length > 0)
                        //$(item).find(".fa-edit").parent().css("display", "none");
                        $(item).find(".fa-edit").parent().attr("disabled", "disabled");
                    if ($(item).find(".fa-trash-o").length > 0)
                        //$(item).find(".fa-trash-o").parent().css("display", "none");
                        $(item).find(".fa-trash-o").parent().attr("disabled", "disabled");
                } else {
                    if ($(item).find(".fa-edit").length > 0)
                        //$(item).find(".fa-edit").parent().css("display", "");
                        $(item).find(".fa-edit").parent().removeAttr("disabled");
                    if ($(item).find(".fa-trash-o").length > 0)
                        //$(item).find(".fa-trash-o").parent().css("display", "");
                        $(item).find(".fa-trash-o").parent().removeAttr("disabled");
                }
            });
        }
    };

    var setApprvoedTableColumnOptions = function (row, data, options) {
        if (options.approvedDisplay === undefined || options.approvedDisplay === false) {
            if (data.StatusName !== undefined && data.StatusName !== null && data.StatusName.toLowerCase() === "approved") {
                if ($(row).find(".fa-edit").length > 0)
                    //$(row).find(".fa-edit").parent().css("display", "none");
                    $(row).find(".fa-edit").parent().attr("disabled", "disabled");
                if ($(row).find(".fa-trash-o").length > 0)
                    //$(row).find(".fa-trash-o").parent().css("display", "none");
                    $(row).find(".fa-trash-o").parent().attr("disabled", "disabled");
            } else {
                if ($(row).find(".fa-edit").length > 0)
                    //$(row).find(".fa-edit").parent().css("display", "");
                    $(row).find(".fa-edit").parent().removeAttr("disabled");
                if ($(row).find(".fa-trash-o").length > 0)
                    //$(row).find(".fa-trash-o").parent().css("display", "");
                    $(row).find(".fa-trash-o").parent().removeAttr("disabled");
            }
        }
    };

    var setApprvoedTreeeColumnOptions = function (type, options) {
        if (options !== undefined && options !== null && options.approvedDisplay !== undefined && options.approvedDisplay) return;

        var tree = $("navcon-tree[type='" + type + "']").find('.jstree');//.find("div[role='tree']");
        if (tree.length === 0) tree = $("navcon-tree[type='" + type + "']").find('.jstree').find("div[role='tree']");
        if (tree.length !== 0) {
            if ($(tree[0]).jstree().settings === undefined) $(tree[0]).jstree().settings = options;

            //if ($(tree[0]).jstree().settings.approvedDisplay === undefined || $(tree[0]).jstree().settings.approvedDisplay === false) {
            var data = $(tree[0]).jstree().settings.core.data;
            if (data !== undefined && data !== null && data !== false && data.length !== 0) {
                $.map(data, function (item, index) {
                    var nodeId = item["id"];
                    var nodeChild = $(tree[0]).jstree().get_node(nodeId);
                    if (nodeChild !== undefined && nodeChild !== null) {
                        if (item.StatusName !== undefined && item.StatusName !== null && item.StatusName.toLowerCase() === "approved") {
                            var columnNo = 4;
                            var getColumn = $(tree[0]).parent().parent().find("div[id='jsgrid_" + nodeId + "_col" + columnNo + "']");
                            if (getColumn !== undefined && getColumn.children.length !== 0) {
                                var getCtrl = $(getColumn.find("a"));
                                if (getCtrl !== undefined)
                                    //getCtrl.css("display", "none");
                                    getCtrl.attr("disabled", "disabled");
                            }

                            var columnNo = 5;
                            var getColumn = $(tree[0]).parent().parent().find("div[id='jsgrid_" + nodeId + "_col" + columnNo + "']");
                            if (getColumn !== undefined && getColumn.children.length !== 0) {
                                var getCtrl = $(getColumn.find("a"));
                                if (getCtrl !== undefined)
                                    //getCtrl.css("display", "none");
                                    getCtrl.attr("disabled", "disabled");
                            }
                        } else {
                            var columnNo = 4;
                            var getColumn = $(tree[0]).parent().parent().find("div[id='jsgrid_" + nodeId + "_col" + columnNo + "']");
                            if (getColumn !== undefined && getColumn.children.length !== 0) {
                                var getCtrl = $(getColumn.find("a"));
                                if (getCtrl !== undefined)
                                    //getCtrl.css("display", "");
                                    getCtrl.removeAttr("disabled");
                            }

                            var columnNo = 5;
                            var getColumn = $(tree[0]).parent().parent().find("div[id='jsgrid_" + nodeId + "_col" + columnNo + "']");
                            if (getColumn !== undefined && getColumn.children.length !== 0) {
                                var getCtrl = $(getColumn.find("a"));
                                if (getCtrl !== undefined)
                                    //getCtrl.css("display", "");
                                    getCtrl.removeAttr("disabled");
                            }
                        }
                    }
                });
            }
            //}
        }
    };

    var setDisabledEnabledByRights = function (rights, appItem) {
        if (rights === undefined || Object.keys(rights).length === 0) return false;

        if (appItem !== undefined && appItem !== "") {
            var status = (rights.Approve || false) ? false : true;
            if (status) {
                $("navcon-button[approval-id^='" + appItem + "']").find("a").attr("disabled", "disabled");
                $("navcon-button[approval-id^='" + appItem + "']").find("a").css("pointerEvents", "none");
            } else {
                $("navcon-button[approval-id^='" + appItem + "']").find("a").removeAttr("disabled");
                $("navcon-button[approval-id^='" + appItem + "']").find("a").css("pointerEvents", "auto");
            }
            return;
        }

        var addStatus = (rights.Add || false) ? false : true;
        var editStatus = (rights.Edit || false) ? false : true;
        var deleteStatus = (rights.Delete || false) ? false : true;
        var approvalStatus = (rights.Approve || false) ? false : true;
        var printStatus = (rights.View || false) ? false : true;


        if (addStatus) {
            $("a[class*='addnew'][data-target!='#requestlist']").attr("disabled", "disabled");
            $('.jstree-grid-midwrapper').find('.float-center.add.btn.btntree.btn-xs').attr("disabled", "disabled");
        } else {
            $("a[class*='addnew'][data-target!='#requestlist']").removeAttr("disabled");
            $('.jstree-grid-midwrapper').find('.float-center.add.btn.btntree.btn-xs').removeAttr("disabled");
        }

        if (editStatus) {
            $("a[class*='edit']").attr("disabled", "disabled");
            $('.jstree-grid-midwrapper').find('.float-center.edit.btn.btntree.btn-xs').attr("disabled", "disabled");
        } else {
            $("a[class*='edit']").removeAttr("disabled");
            $('.jstree-grid-midwrapper').find('.float-center.edit.btn.btntree.btn-xs').removeAttr("disabled");
        }

        if (printStatus) {
            $("a[class*='view']").attr("disabled", "disabled");
            $('.jstree-grid-midwrapper').find('.float-center.view.btn.btntree.btn-xs').attr("disabled", "disabled");
        } else {
            $("a[class*='view']").removeAttr("disabled");
            $('.jstree-grid-midwrapper').find('.float-center.view.btn.btntree.btn-xs').removeAttr("disabled");
        }


        if (deleteStatus) {
            $("a[class*='delete']").attr("disabled", "disabled");
            $('.jstree-grid-midwrapper').find('.float-center.delete.btn.btntree.btn-xs').attr("disabled", "disabled");
        } else {
            $("a[class*='delete']").removeAttr("disabled");
            $('.jstree-grid-midwrapper').find('.float-center.delete.btn.btntree.btn-xs').removeAttr("disabled");
        }


        if (approvalStatus) {
            $("a[class*='addnew'][data-target^='#requestlist_']").attr("disabled", "disabled");
            $("a[class*='addnew'][data-target^='#requestlist_']").parent().css("pointerEvents", "none");
        } else {
            $("a[class*='addnew'][data-target^='#requestlist_']").removeAttr("disabled");
            $("a[class*='view']").removeAttr("disabled");
            $('.jstree-grid-midwrapper').find('.float-center.view.btn.btntree.btn-xs').removeAttr("disabled");
            $("a[class*='addnew'][data-target^='#requestlist_']").parent().css("pointerEvents", "auto");
        }

    };


    var clearTableSelectedRows = function (type) {
        var tableInstance = navcon.getTable(type);
        if (tableInstance !== undefined)
            tableInstance.row('.selected').remove().draw(false);
    }

    var pageControlAction = function ($scope, mode, tableDefine, callback) {
        if (mode.toLowerCase() === "view" || mode.toLowerCase() === "print" || mode.toLowerCase() === "delete" || mode.toLowerCase() === "saveas") {
            $.map(tableDefine, function (item, index) {
                if (item.type !== undefined && item.type !== "") {
                    var tableInstance = navcon.getTable(item.type);
                    if (tableInstance !== undefined && tableInstance !== null && item.columns !== undefined && item.columns !== "")
                        tableInstance.columns(item.columns).visible(false);
                }
            });

            //$scope.navconData.hideButton = true;
            if ($scope.navconData !== undefined && $scope.navconData.hideTab !== undefined && $scope.navconData.hideTab !== null) $scope.navconData.hideTab = false;

            if (callback !== undefined) callback(true);
        } else {
            $.map(tableDefine, function (item, index) {
                if (item.type !== undefined && item.type !== "") {
                    var tableInstance = navcon.getTable(item.type);
                    if (tableInstance !== undefined && tableInstance !== null && item.columns !== undefined && item.columns !== "")
                        tableInstance.columns(item.columns).visible(true);
                }
            });

            //$scope.navconData.hideButton = false;
            if ($scope !== undefined && $scope.navconData !== undefined) $scope.navconData.hideTab = false;
            if ($scope !== undefined && $scope.navconData !== undefined && $scope.navconData.hideTab !== undefined && mode.toLowerCase() === "save") $scope.navconData.hideTab = true;

            if (callback !== undefined) callback(false);
        }
    };


    var sleep = function (milliseconds) {
        var start = new Date().getTime();
        for (var i = 0; i < 1e7; i++) {
            if ((new Date().getTime() - start) > milliseconds) {
                break;
            }
        }
    };


    var getTableNotInOtherTable = function (mode, selectedItem, collectionItem, primaryKey, deleteRowItem, assignPrimaryKey) {
        if (mode.toLowerCase() === "add") {
            if (collectionItem !== undefined && collectionItem !== null) {
                if (collectionItem.oldData === undefined || collectionItem.oldData === null) collectionItem.oldData = collectionItem.data;

                var filterMembers = navcon.getItemsNotInOtherItems(collectionItem.data, selectedItem !== undefined && selectedItem !== null ? selectedItem.data : [], primaryKey);
                $.map(filterMembers, function (item, index) {
                    if (assignPrimaryKey !== undefined && assignPrimaryKey !== "" && item[assignPrimaryKey] !== undefined) item[assignPrimaryKey] = null;
                    if (item.Row_Checked !== undefined) item.Row_Checked = false;
                    if (item.Check_Field !== undefined && item[item.Check_Field] !== undefined) item[item.Check_Field] = false;
                });

                collectionItem.data = filterMembers;
            }
        } else if (mode.toLowerCase() === "delete") {
            if (deleteRowItem !== undefined && deleteRowItem !== null) {
                if (navcon.getItemIndexByKeyValue(collectionItem.data, primaryKey, deleteRowItem[primaryKey]) === -1) {
                    var selectedRowIndex = navcon.save.selectedRowIndex(collectionItem.oldData, deleteRowItem, primaryKey);
                    var itemInsert = navcon.getItemByKeyValue(collectionItem.oldData, primaryKey, deleteRowItem[primaryKey]);
                    if (itemInsert !== -1) {
                        if (assignPrimaryKey !== undefined && assignPrimaryKey !== "" && itemInsert[assignPrimaryKey] !== undefined) itemInsert[assignPrimaryKey] = null;
                        if (itemInsert.Row_Checked !== undefined) itemInsert.Row_Checked = false;
                        if (itemInsert.Check_Field !== undefined && itemInsert[itemInsert.Check_Field] !== undefined) itemInsert[itemInsert.Check_Field] = false;

                        //collectionItem.data.splice(selectedRowIndex, 0, itemInsert);
                        collectionItem.data.push(itemInsert);
                    }
                }
            }
        }
    };


    var getObjectsfromJSON = function (obj, key, val) {
        var newObj = false;
        var data = [];
        $.each(obj, function () {
            var testObject = this;
            if (testObject[key] === val)
            { data.push(testObject); }
        });

        return data;
    }

    var getTemplateUrl = function (path) {
        var environment = getApplicationEnvironment();
        var version = getApplicationVersion();
        var cacheBust = (new Date()).getTime();
        if (environment === "production")
            cacheBust = version.split('.').join(''); //version;
        var returnUrl = "";
        path = path.toLowerCase();

        var templateAppPath = (environment === "production") ? "/partials/" : "app/";
        var templateExtPath = (environment === "production") ? "/partials/" : "ext-modules/";
        if (path === "kendomultiselect") {
            returnUrl = templateAppPath + 'kendomultiselect/kendomultiselect.html';
        }
        else if (path === "dashboard") {
            returnUrl = templateAppPath + 'dashboard/dashboardTemplate.html';
        } else if (path === "404") {
            returnUrl = templateAppPath + '404/404.html';
        } else if (path === "sort") {
            returnUrl = templateAppPath + 'sort/sort.html';
        } else if (path === "hazardmanagement") {
            returnUrl = templateAppPath + 'hazardmanagement/hazardmanagement.html';
        } else if (path === "sortpage1") {
            returnUrl = templateAppPath + 'sort/page1/page1.html';
        } else if (path === "sortpage2") {
            returnUrl = templateAppPath + 'sort/page2/page2.html';
        } else if (path === "sortpage2groundmarineland") {
            returnUrl = templateAppPath + 'sort/page2/ground.marine.land.html';
        } else if (path === "sortpage3") {
            returnUrl = templateAppPath + 'sort/page3/page3.html';
        } else if (path === "sortpage3equipmentdetails") {
            returnUrl = templateAppPath + 'sort/page3/equipmentdetails.html';
        } else if (path === "sortconfiguration") {
            returnUrl = templateAppPath + 'sort/sortconfiguration/sortconfiguration.html';
        } else if (path === "actionstracker") {
            returnUrl = templateAppPath + 'sort/actionstracker/actionstracker.html';
        } else if (path === "sortmanagement") {
            returnUrl = templateAppPath + 'sortmanagement/sortmanagement.html';
        } else if (path === "eda") {
            returnUrl = templateAppPath + 'eda/eda.html';
        } else if (path === "edamanagement") {
            returnUrl = templateAppPath + 'edamanagement/edamanagement.html';
        } else if (path === "hazardsystemconfig") {
            returnUrl = templateAppPath + 'hazardmanagement/hazardsystemconfig/hazardsystemconfig.html';
        } else if (path === "controlmanagement") {
            returnUrl = templateAppPath + 'controlmanagement/controlmanagement.html';
        } else if (path === "riskaggregation") {
            returnUrl = templateAppPath + 'riskaggregation/riskaggregation.html';
        } else if (path === "hazardimport") {
            returnUrl = templateAppPath + 'hazardimport/hazardimport.html';
        } else if (path === "bowtie") {
            returnUrl = templateAppPath + 'bowtieanalysis/bowtie.html';
        } else if (path === "hazardreports") {
            returnUrl = templateAppPath + 'hazardreports/hazardreports.html';
        } else if (path === "sortreports") {
            returnUrl = templateAppPath + 'sortreports/sortreports.html';
        } else if (path === "psmmconfiguration") {
            returnUrl = templateAppPath + 'psmmconfiguration/psmmconfiguration.html';
        } else if (path === "psmmcompliance") {
            returnUrl = templateAppPath + 'psmmcompliance/psmmcompliance.html';
        } else if (path === "psmmmaturity") {
            returnUrl = templateAppPath + 'psmmmaturity/psmmmaturity.html';
        } else if (path === "psmmreports") {
            returnUrl = templateAppPath + 'psmmreports/psmmreports.html';
        } else if (path === "adminreports") {
            returnUrl = templateAppPath + 'adminreports/adminreports.html';
        } else if (path === "mrr") {
            returnUrl = templateAppPath + 'form/mrr/mrr.html';
        } else if (path === "foc") {
            returnUrl = templateAppPath + 'form/flightoperationcause/foc.html';
        } else if (path === "formconfiguration") {
            returnUrl = templateAppPath + 'form/formconfiguration/formconfiguration.html';
        } else if (path === "forms") {
            returnUrl = templateAppPath + 'forms/forms.html';
        } else if (path === "referencemanagement") {
            returnUrl = templateAppPath + 'referencemanagement/referencemanagement.html';
        } else if (path === "tiles") {
            returnUrl = templateAppPath + 'tiles/tiles.html';
        } else if (path === "usermanagement") {
            returnUrl = templateAppPath + 'usermanagement/usermanagement.html';
        } else if (path === "rolemanagement") {
            returnUrl = templateAppPath + 'rolemanagement/rolemanagement.html';
        } else if (path === "useraccessrights") {
            returnUrl = templateAppPath + 'useraccessrights/useraccessrights.html';
        } else if (path === "masterconfiguration") {
            returnUrl = templateAppPath + 'masterconfiguration/masterconfiguration.html';
        } else if (path === "actionlog") {
            returnUrl = templateAppPath + 'actionlog/actionlog.html';
        } else if (path === "notificationsetup") {
            returnUrl = templateAppPath + 'notificationsetup/notificationsetup.html';
        } else if (path === "notifications") {
            returnUrl = templateAppPath + 'notifications/notifications.html';
        } else if (path === "userimport") {
            returnUrl = templateAppPath + 'userimport/userimport.html';
        } else if (path === "quarantine") {
            returnUrl = templateAppPath + 'quarantine/quarantine.html';
        } else if (path === "userprofile") {
            returnUrl = templateAppPath + 'userprofile/userprofile.html';
        } else if (path === "changepassword") {
            returnUrl = templateAppPath + 'changepassword/changepassword.html';
        } else if (path === "dashboardmanagement") {
            returnUrl = templateAppPath + 'dashboardmanagement/dashboardmanagement.html';
        } else if (path === "dashboardreports") {
            returnUrl = templateAppPath + 'dashboardreports/dashboardreports.html';
        } else if (path === "news") {
            returnUrl = templateAppPath + 'news/news.html';
        } else if (path === "notificationmaster") {
            returnUrl = templateAppPath + 'notificationmaster/notificationmaster.html';

        } else if (path === "newcontrol") {
            returnUrl = templateAppPath + 'controlmanagement/newcontrol/newcontrol.html';
        } else if (path === "maincontrol") {
            returnUrl = templateAppPath + 'controlmanagement/newcontrol/maincontrol.html';
        } else if (path === "dashboarddetails") {
            returnUrl = templateAppPath + 'dashboarddetails/dashboarddetails.html';
        } else if (path === "delete") {
            returnUrl = templateAppPath + 'delete/delete.html';
        } else if (path === "cfmaintenancehumanfactors") {
            returnUrl = templateAppPath + 'eda/cfmaintenancehumanfactors/cfmaintenancehumanfactors.html';
        } else if (path === "cfpersonalinjury") {
            returnUrl = templateAppPath + 'eda/cfpersonalinjury/cfpersonalinjury.html';
        } else if (path === "contributingfactorschecklist") {
            returnUrl = templateAppPath + 'eda/contributingfactorschecklist/contributingfactorschecklist.html';
        } else if (path === "errorpreventionstrategies") {
            returnUrl = templateAppPath + 'eda/errorpreventionstrategies/errorpreventionstrategies.html';
        } else if (path === "generalinformation") {
            returnUrl = templateAppPath + 'eda/generalinformation/generalinformation.html';
        } else if (path === "occurrence") {
            returnUrl = templateAppPath + 'eda/occurrence/occurrence.html';
        } else if (path === "summary") {
            returnUrl = templateAppPath + 'eda/summary/summary.html';
        } else if (path === "causeanalysis") {
            returnUrl = templateAppPath + 'hazardmanagement/causeanalysis/causeanalysis.html';
        } else if (path === "causedetails") {
            returnUrl = templateAppPath + 'hazardmanagement/causedetails/causedetails.html';
        } else if (path === "history") {
            returnUrl = templateAppPath + 'history/history.html';
        } else if (path === "photouploader") {
            returnUrl = templateAppPath + 'photo/egPhotoUploader.html';
        } else if (path === "pcccompliancetemplates") {
            returnUrl = templateAppPath + 'psmmconfiguration/pcccompliancetemplates/pcccompliancetemplates.html';
        } else if (path === "pccrequirements") {
            returnUrl = templateAppPath + 'psmmconfiguration/pccrequirements/pccrequirements.html';
        } else if (path === "pmcleadingindicatorscalculation") {
            returnUrl = templateAppPath + 'psmmconfiguration/pmcleadingindicatorscalculation/pmcleadingindicatorscalculation.html';
        } else if (path === "pmcleadingindicatorsstatus") {
            returnUrl = templateAppPath + 'psmmconfiguration/pmcleadingindicatorsstatus/pmcleadingindicatorsstatus.html';
        } else if (path === "pmcsubjectindicator") {
            returnUrl = templateAppPath + 'psmmconfiguration/pmcsubjectindicator/pmcsubjectindicator.html';
        } else if (path === "pmctemplates") {
            returnUrl = templateAppPath + 'psmmconfiguration/pmctemplates/pmctemplates.html';
        } else if (path === "programme") {
            returnUrl = templateAppPath + 'psmmconfiguration/programme/programme.html';
        } else if (path === "psmmpanel") {
            returnUrl = templateAppPath + 'psmmpanel/psmmpanel.html';
        } else if (path === "referencepage") {
            returnUrl = templateAppPath + 'referencemanagement/directives/referencepage.html';
        } else if (path === "summaryaccidentstate") {
            returnUrl = templateAppPath + 'riskaggregation/summaryaccidentstate/summaryaccidentstate.html';
        } else if (path === "summaryhazardstate") {
            returnUrl = templateAppPath + 'riskaggregation/summaryhazardstate/summaryhazardstate.html';
        } else if (path === "actioninvestigation") {
            returnUrl = templateAppPath + 'sort/actionstracker/directive/actioninvestigationtemplate.html';
        } else if (path === "actionstrackertemplate") {
            returnUrl = templateAppPath + 'sort/actionstracker/directive/actionstrackertemplate.html';
        } else if (path === "airproximity") {
            returnUrl = templateAppPath + 'sort/airproximity/airproximity.html';
        } else if (path === "airtrafficmanagement") {
            returnUrl = templateAppPath + 'sort/airtrafficmanagement/airtrafficmanagement.html';
        } else if (path === "birdstrike") {
            returnUrl = templateAppPath + 'sort/birdstrike/birdstrike.html';
        } else if (path === "tireburst") {
            returnUrl = templateAppPath + 'sort/tireburst/tireburst.html';
        } else if (path === "sortclosing") {
            returnUrl = templateAppPath + 'sortclosing/sortclosing.html';
        } else if (path === "edainvestigation") {
            returnUrl = templateAppPath + 'sortdecision/edainvestigation/edainvestigation.html';
        } else if (path === "sortdecision") {
            returnUrl = templateAppPath + 'sortdecision/sortdecision.html';
        } else if (path === "sortfindings") {
            returnUrl = templateAppPath + 'sortfindings/findings.html';
        } else if (path === "mycounttemplate") {
            returnUrl = templateAppPath + 'dashboard/directives/mycountTemplate.html';
        } else if (path === "myreporttemplate") {
            returnUrl = templateAppPath + 'dashboard/directives/myreportTemplate.html';
        } else if (path === "myriskmatrixtemplate") {
            returnUrl = templateAppPath + 'dashboard/directives/myriskmatrixTemplate.html';
        } else if (path === "mysummarytemplate") {
            returnUrl = templateAppPath + 'dashboard/directives/mysummaryTemplate.html';
        } else if (path === "probability") {
            returnUrl = templateAppPath + 'hazardmanagement/hazardsystemconfig/probability/probability.html';
        } else if (path === "riskclass") {
            returnUrl = templateAppPath + 'hazardmanagement/hazardsystemconfig/riskclass/riskclass.html';
        } else if (path === "severity") {
            returnUrl = templateAppPath + 'hazardmanagement/hazardsystemconfig/severity/severity.html';
        } else if (path === "navconchart") {
            returnUrl = templateAppPath + 'widgets/navconChart/navconChartTemplate.html';

        } else if (path === "navcondashboard") {
            returnUrl = templateExtPath + 'navconDashboard/navconDashboardTemplate.html';
        } else if (path === "navconwidgetbody") {
            returnUrl = templateExtPath + 'navconDashboard/navconWidgetBodyTemplate.html';
        } else if (path === "navcondelete") {
            returnUrl = templateExtPath + 'navconDelete/navconDeleteTemplate.html';
        } else if (path === "navconevaluation") {
            returnUrl = templateExtPath + 'navconEvaluation/navconEvaluationTemplate.html';
        } else if (path === "navconform") {
            returnUrl = templateExtPath + 'navconForm/navconFormTemplate.html';
        } else if (path === "navconframework") {
            returnUrl = templateExtPath + 'navconFramework/navconFrameworkTemplate.html';
        } else if (path === "navconuserprofile") {
            returnUrl = templateExtPath + 'navconFramework/navconUserProfile/navconUserProfileTemplate.html';
        } else if (path === "navconuserprofilesmall") {
            returnUrl = templateExtPath + 'navconFramework/navconUserProfile/navconUserProfileSmallTemplate.html';
        } else if (path === "navconmenu") {
            returnUrl = templateExtPath + 'navconMenu/navconMenuTemplate.html';
        } else if (path === "navconmenugroup") {
            returnUrl = templateExtPath + 'navconMenu/navconMenuGroupTemplate.html';
        } else if (path === "navconmenuitem") {
            returnUrl = templateExtPath + 'navconMenu/navconMenuItemTemplate.html';
        } else if (path === "navconmodal") {
            returnUrl = templateExtPath + 'navconModal/navconModalTemplate.html';
        } else if (path === "navconpagebar") {
            returnUrl = templateExtPath + 'navconPagebar/navconPagebarTemplate.html';
        } else if (path === "navconportlet") {
            returnUrl = templateExtPath + 'navconPortlet/navconPortletTemplate.html';
        } else if (path === "navconrating") {
            returnUrl = templateExtPath + 'navconRating/navconRatingTemplate.html';
        } else if (path === "navconreport") {
            returnUrl = templateExtPath + 'navconReport/navconReportTemplate.html';
        } else if (path === "navconreportpage") {
            returnUrl = templateExtPath + 'navconReport/navconReportPageTemplate.html';
        } else if (path === "navcontable") {
            returnUrl = templateExtPath + 'navconTable/navconTableTemplate.html';
        } else if (path === "navcontableeditor") {
            returnUrl = templateExtPath + 'navconTableEditor/navconTableEditorTemplate.html';
        } else if (path === "navcontree") {
            returnUrl = templateExtPath + 'navconTree/navconTreeTemplate.html';
        } else if (path === "navconfileupload") {
            returnUrl = templateExtPath + 'navconUpload/navconFileUploadTemplate.html';
        } else if (path === "navconphotoupload") {
            returnUrl = templateExtPath + 'navconUpload/navconPhotoUploadTemplate.html';
        } else if (path === "login") {
            returnUrl = templateAppPath + 'login/login.html';
        }

        if (environment !== "production") returnUrl + "?v=" + cacheBust;
        return returnUrl;
    }

    var pageChanges = function (funcPageChange, funcpageSave, callback) {
        var changes = funcPageChange();
        if (changes) {
            BootstrapDialog.show({
                title: 'Confirmation',
                closable: false,
                message: 'Do you want to discard the changes?',
                buttons: [{
                    icon: 'glyphicon glyphicon-ok-circle',
                    label: 'Yes',
                    cssClass: 'btn-primary green',
                    action: function (dialogItself) {
                        if (funcpageSave !== undefined && funcpageSave !== "")
                            funcpageSave();
                        dialogItself.close();
                        callback(false);
                    }
                },
                {
                    icon: 'glyphicon glyphicon-remove-circle',
                    label: 'No',
                    cssClass: 'btn-primary red',
                    action: function (dialogItself) {
                        dialogItself.close();
                        callback(true);
                    }
                }]
            });
        } else {
            callback(false);
        }
    };

    var getApplicationVersion = function () {
        version = "1.0.0";

        var ngAuthSettings = angular.element(document).injector().invoke(function (ngAuthSettings) { return ngAuthSettings; });
        var localStorageService = angular.element(document).injector().invoke(function (localStorageService) { return localStorageService; });
        var authData = localStorageService.get('authorizationData');
        if (authData !== undefined && authData !== null) {
            //var version = ngAuthSettings.version;
            var version = authData.SafetalVersion;
            if (version === undefined || version === "")
                version = "1.0.0";
        }
        return version;
    }

    var getApplicationEnvironment = function () {
        var ngAuthSettings = angular.element(document).injector().invoke(function (ngAuthSettings) { return ngAuthSettings; });
        var environment = ngAuthSettings.environment;
        if (environment === undefined || environment === "")
            environment = "development";
        return environment.toLowerCase();
    }

    var getPageConfig = function (scope, pageConfig, fieldConfigName) {
        if (pageConfig !== undefined && pageConfig !== null && pageConfig !== "") {
            /*breadcrumbs*/
            if (pageConfig.breadcrumbs !== undefined && pageConfig.breadcrumbs !== null && scope !== undefined && scope !== null && scope !== "")
                scope["breadcrumbs"] = pageConfig.breadcrumbs;

            //Field Assign
            if (pageConfig.fields !== undefined && pageConfig.fields !== null && pageConfig.fields.length !== 0) {
                $.map(pageConfig.fields, function (fields, index) {

                    if (scope !== undefined && scope !== null && scope !== "") {
                        scope[index] = angular.copy(fields);

                        updateFields(scope[index]);

                        //Data Assign
                        if (pageConfig.data !== undefined && pageConfig.data !== null && pageConfig.data.length !== 0) {
                            navcon.save.loadListDefaultData(pageConfig.data, scope[index]);
                        }
                    }

                });
            } else {
                updateFields(pageConfig);
            }

            if (scope !== undefined && scope !== null && scope !== "") {

                //Table Assign
                if (pageConfig.tables !== undefined && pageConfig.tables !== null && pageConfig.tables.length !== 0) {
                    $.map(pageConfig.tables, function (table, index) {
                        scope[index] = angular.copy(pageConfig.tables[index]);
                    });
                }

                //Tree Assign
                if (pageConfig.trees !== undefined && pageConfig.trees !== null && pageConfig.trees.length !== 0) {
                    $.map(pageConfig.trees, function (tree, index) {
                        scope[index] = angular.copy(pageConfig.trees[index]);
                    });
                }

                //tableEditor Assign
                if (pageConfig.tableEditor !== undefined && pageConfig.tableEditor !== null && pageConfig.tableEditor.length !== 0) {
                    $.map(pageConfig.tableEditor, function (tableEditor, index) {
                        scope[index] = angular.copy(pageConfig.tableEditor[index]);
                        scope[index].tableAction = {};

                        if (tableEditor.templateOptions.primaryKey !== undefined && tableEditor.templateOptions.primaryKey !== null && tableEditor.templateOptions.primaryKey !== "") scope[index].primaryKey = tableEditor.templateOptions.primaryKey;
                        if (tableEditor.templateOptions.displayKey !== undefined && tableEditor.templateOptions.displayKey !== null && tableEditor.templateOptions.displayKey !== "") scope[index].displayKey = tableEditor.templateOptions.displayKey;
                    });
                }
            }
        }

        function updateFields(fields) {
            if (fieldConfigName === undefined || fieldConfigName === null || fieldConfigName === "") fieldConfigName = "fieldConfig";
            var fieldPrimaryIndex = navcon.getItemIndexByProperty(fields, fieldConfigName);
            if (fieldPrimaryIndex !== undefined && fieldPrimaryIndex !== -1) {
                var fieldData = fields[fieldPrimaryIndex];

                if (fieldData.primaryKey !== undefined && fieldData.primaryKey !== null && fieldData.primaryKey !== "") fields.primaryKey = fieldData.primaryKey;
                if (fieldData.displayKey !== undefined && fieldData.displayKey !== null && fieldData.displayKey !== "") fields.displayKey = fieldData.displayKey;
                if (fieldData.alternatePrimaryKey !== undefined && fieldData.alternatePrimaryKey !== null && fieldData.alternatePrimaryKey !== "") fields.alternatePrimaryKey = fieldData.alternatePrimaryKey;
                if (fieldData.alternateDisplayKey !== undefined && fieldData.alternateDisplayKey !== null && fieldData.alternateDisplayKey !== "") fields.alternateDisplayKey = fieldData.alternateDisplayKey;
                if (fieldData.title !== undefined && fieldData.title !== null && fieldData.title !== "") fields.title = fieldData.title;
            }
        }
    };

    var getSequenceNo = function (options, callback) {
        var returnData;
        if (options.table !== undefined && options.table !== null) {
            if (options.table.columnName !== undefined && options.table.columnName !== null) {
                var currentData = 0;
                $.map(options.table, function (item, index) {
                    if (parseInt(item[options.table.columnName]) > parseInt(currentData)) {
                        currentData = item[options.table.columnName];
                    }
                });

                returnData = (currentData + 1);

                if (options.fields !== undefined && options.fields !== null) {
                    if (options.fields.key !== undefined && options.fields.key !== null) {//Field key assigned
                        var fieldsKeyIndex = navcon.getItemIndexByProperty(options.fields, options.fields.key);
                        if (fieldsKeyIndex !== null && fieldsKeyIndex !== -1 && fieldsKeyIndex.length !== 0) {
                            options.fields[fieldsKeyIndex].data = returnData;
                        }
                    }
                }
            } else { //No table column assigned
                var currentData = 0;
                returnData = 0;

                if (options.table.columns.length !== 0) { // serialNoColumn based data
                    $.map(options.table.columns, function (item, colIndex) {
                        if (item.serialNoColumn !== undefined && item.serialNoColumn != null) {
                            if (parseInt(item.serialNoColum) > parseInt(currentData)) {
                                currentData = item.serialNoColum;
                            }
                        }
                    });
                    returnData = (currentData + 1);
                }

                if (options.fields !== undefined && options.fields !== null) {
                    if (options.fields.key !== undefined && options.fields.key !== null) {//Field key assigned
                        var fieldsKeyIndex = navcon.getItemIndexByProperty(options.fields, options.fields.key);
                        if (fieldsKeyIndex !== null && fieldsKeyIndex !== -1 && fieldsKeyIndex.length !== 0) {
                            options.fields[fieldsKeyIndex].data = returnData;
                        }
                    }
                }
            }
        } else { // no table assigned
            returnData = 0;
        }

        if (callback !== undefined) callback(returnData);
        return returnData;
    };

    var getEmailPattern = function () {
        var emailPattern = "(?:[a-z0-9!#$%&'*+/=?^_`{|}~-]+(?:\.[a-z0-9!#$%&'*+/=?^_`{|}~-]+)*|(?:[\x01-\x08\x0b\x0c\x0e-\x1f\x21\x23-\x5b\x5d-\x7f]|\\[\x01-\x09\x0b\x0c\x0e-\x7f])*)@(?:(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?|\[(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?|[a-z0-9-]*[a-z0-9]:(?:[\x01-\x08\x0b\x0c\x0e-\x1f\x21-\x5a\x53-\x7f]|\\[\x01-\x09\x0b\x0c\x0e-\x7f])+)\])";
        return emailPattern;
    };

    var viewContentLoaded = function (configMenu) {
        // $(".page-container").css("margin-top", "");
        toolTipSetting();
        initEvents();

        chartToolTipClose(configMenu);

        //setTimeout('$(".page-container").css("margin-top", "58px");', 1000)
    }



    function toolTipSetting() {
        setTimeout(function () {
            $('.fa.fa-print').attr("data-toggle", "tooltip");
            $('.fa.fa-print').attr("data-original-title", "Print");
            $('.fa.fa-print').attr("data-placement", "bottom");

            $('.portlet .collapse > a').attr("data-toggle", "tooltip");
            $('.portlet .collapse > a').attr("data-original-title", "Collapse");
            $('.portlet .collapse > a').attr("data-placement", "bottom");

            $('.portlet .collapse > a').attr("data-toggle", "tooltip");
            $('.portlet .collapse > a').attr("data-original-title", "Expand");
            $('.portlet .collapse > a').attr("data-placement", "bottom");

            $('li[data-toggle="tooltip"]').tooltip();
            $('a[data-toggle="tooltip"]').tooltip();

            if ($('navcon-button').attr("text") !== undefined && $('navcon-button').attr("text").toLowerCase() === "cancel") {
                $('navcon-button').attr("text", "Cancel");
            }
        }, 500);
    }

    function initEvents() {
        $('.portlet .collapse').on("click", function () {
            if ($(this) === undefined) return;
            if ($(this).hasClass('collapse'))
                $(this).attr("data-original-title", "Expand");
            else
                $(this).attr("data-original-title", "Collapse");
        });
        document.addEventListener('scroll', function (e) {
            if ($('.sp-container').is(":visible")) {
                $('.sp-container').addClass("sp-hidden");
            }
        }, true);
    }

    function colorpickerHide() {
        $('.sp-container').addClass("sp-hidden");
    }

    var riskAggressionModalClose = function (configHeaderMenu, event) {//bowtie riskaggression modal close
        if (configHeaderMenu !== undefined && configHeaderMenu !== null && configHeaderMenu.toLowerCase() === "bowtieanalysis") {
            var targetId = event.target.id;
            if (targetId !== undefined && targetId !== null && targetId.toLowerCase() === "hazardclassification") {// $(".modal.in").find("navcon-modal[id=" + targetId + "]").length !== 0) {
                var targetScope = $(".modal.in").find("navcon-modal[id=" + targetId + "]").scope();
                if (targetScope !== undefined && targetScope !== null) {
                    var parentScope = targetScope.$parent;
                    if (parentScope !== undefined && parentScope !== null && parentScope.cancel !== undefined) {
                        var type = parentScope.type;
                        parentScope.cancel(type);
                    }
                }
            }
        }
    }

    function chartToolTipClose(configMenu) {
        if (configMenu !== undefined && configMenu !== null && configMenu.toLowerCase() === "dashboard") {
            if ($(".chartToolTip") !== undefined && $(".chartToolTip").length !== 0) {

            }
        } else if ($("#fusioncharts-tooltip-element") !== undefined && $("#fusioncharts-tooltip-element").length !== 0) {
            $("#fusioncharts-tooltip-element").hide();
        }
    }

    // Reveal public pointers to
    // private functions and properties

    return {
        getSiteURL: webUrl,
        getPageConfig: function (scope, pageConfig, fieldConfigName) { return getPageConfig(scope, pageConfig, fieldConfigName) },
        getSequenceNo: function (options) { return getSequenceNo(options) },
        /*Fields*/
        getFieldsData: function (fields) { return getFieldsData(fields) },
        updateFieldsData: function (fields, item, $scope, isDisabled, $timeout) { return updateFieldsData(fields, item, $scope, isDisabled, $timeout) },
        clearFieldsData: function (fields, $scope, uploadClear) { clearFieldsData(fields, $scope, uploadClear) },
        setFieldFocus: function (fields) { setFieldFocus(fields) },
        getFieldsDataToSave: function (fields, mode, key, upload) { return getFieldsDataToSave(fields, mode, key, upload) },
        /*Tables*/
        setTableSetting: function (el, data, scope) { tableSetting(el, data, scope) },
        tableRefresh: function (el, setting, scope) { tableRefresh(el, setting, scope) },
        tableCellEditSetting: function (row, column, data, cellObj, oTable, $scope, $compile) { return tableCellEditSetting(row, column, data, cellObj, oTable, $scope, $compile) },
        getTableData: function (type, id, checked, key, checkedCol, oldData, mode) { return getTableData(type, id, checked, key, checkedCol, oldData, mode) },
        getTable: function (type, id, mode, fields) { return getTableInstance(type) },
        clearTableData: function (type, data) { return clearTableData(type, data) },
        updateTableData: function (type, data, targetData, id) { updateTableData(type, data, targetData, id) },
        saveTables: function (vm, dataservice, type, fields, refId, refValue, popup, callback) { return saveTables(vm, dataservice, type, fields, refId, refValue, popup, callback) },
        addNewTables: function ($scope, vm, type, fields, pageConfig, callback) { return addNewTables($scope, vm, type, fields, pageConfig, callback) },
        editTables: function ($scope, vm, type, fields, action, data, callback, popup) { return editTables($scope, vm, type, fields, action, data, callback, popup) },
        loadTableData: function (node, field, fieldType) { return loadTableData(node, field, fieldType) },
        getTableNotInOtherTable: function (mode, selectedItem, collectionItem, primaryKey, deleteRowItem, assignPrimaryKey) { return getTableNotInOtherTable(mode, selectedItem, collectionItem, primaryKey, deleteRowItem, assignPrimaryKey) },
        updateTableEditorData: function (data, field, $scope, isDisabled, vm) { return updateTableEditorData(data, field, $scope, isDisabled, vm) },
        /*Trees*/
        setTreeSetting: function (el, data, scope, fields, isExpand) { treeSetting(el, data, scope, fields, isExpand) },
        clearTreeData: function (type) { clearTreeData(type) },
        treeDataRefresh: function (data, type, callback) { treeDataRefresh(data, type, callback) },
        createTreeNode: function (tree, currentNode, newNode, position) { createTreeNode(tree, currentNode, newNode, position) },
        removeTreeNode: function (type, currentNode, treeSettings, hasParentDelete) { removeTreeNode(type, currentNode, treeSettings, hasParentDelete) },
        editTreeNode: function (tree, currentNode, text) { editTreeNode(tree, currentNode, text) },
        getTreeData: function (type, id, mode, fields) { return getTreeData(type, id, mode, fields) },
        treeInstance: function (type) { return treeInstance(type) },
        loadTreeData: function (type, data, targetData) { return loadTreeData(type, data, targetData) },
        getDataFromTree: function (items, data) { return getDataFromTree(items, data) },
        updateTreeData: function (data, id, field, value) { return updateTreeData(data, id, field, value) },
        updateTreeNode: function (type, data, updatedNode, callback) { return updateTreeNode(type, data, updatedNode, callback) },
        insertChildrenTreeData: function (data, id, node) { return insertChildrenTreeData(data, id, node) },
        chooseTree: function (type, checkedData, targetType, targetData, scope, callback, insNode) { return chooseTree(type, checkedData, targetType, targetData, scope, callback, insNode) },
        removeExistsTreeNode: function (sourceTreeType, targetTreeType, sourceTreeData, targetTreeData) { return removeExistsTreeNode(sourceTreeType, targetTreeType, sourceTreeData, targetTreeData) },
        disableTreeNodeById: function (sourceTree, id, sourceTreeData) { return disableTreeNodeById(sourceTree, id, sourceTreeData) },
        getNodeFromTreeDataByField: function (items, field, value) { return getNodeFromTreeDataByField(items, field, value) },
        getCheckedTreeNodes: function (type) { return getCheckedTreeNodes(type) },
        getTreeDataById: function (treeData, parentId, nodeType) { return getTreeDataById(treeData, parentId, nodeType) },
        updateTreeSingleData: function (tree, currentNode, columnName, text, columnNo, controlType) { updateTreeSingleData(tree, currentNode, columnName, text, columnNo, controlType) },
        /*Calendar*/
        calendarSetting: function (el, data, scope) { calendarSetting(el, data, scope) },
        /*Print*/
        callPrint: function (report, reportId, callback) { callPrint(report, reportId, callback) },
        /*Chart*/
        chartSetting: function (el, data, scope) { chartSetting(el, data, scope) },
        /*Page*/
        pageControlAction: function ($scope, mode, tableDefine, callback) { return pageControlAction($scope, mode, tableDefine, callback) },
        openModal: function (id, callback) { return openModal(id, callback) },
        closeModal: function (id) { return closeModal(id) },
        /*Common*/
        getItemByProperty: function (items, key) { return getItemByProperty(items, key) },
        getItemIndexByProperty: function (items, key) { return getItemIndexByProperty(items, key) },
        getItemByKeyValue: function (items, key, value, lowercase) { return getItemByKeyValue(items, key, value, lowercase) },
        getItemIndexByKeyValue: function (items, key, value) { return getItemIndexByKeyValue(items, key, value) },
        addDataList: function (vm, fields, tableOptions, uniqueKey) { return addDataList(vm, fields, tableOptions, uniqueKey) },
        deleteDataList: function (tableOptions, row) { deleteDataList(tableOptions, row) },
        dateConvert: function (date, format) { return dateConvert(date, format) },
        dateToUTC: function (date, format) { return dateToUTC(date, format) },
        dateFromUTCToLocal: function (date, format) { return dateFromUTCToLocal(date, format) },
        getItemsFilterByKeyValue: function (items, key, value) { return getItemsFilterByKeyValue(items, key, value) },
        setValueToControl: function (value, targetValue) { return setValueToControl(value, targetValue) },
        insertControl: function (type, data) { return insertControl(type, data) },
        insertDeleteditems: function (newItems, oldItems, tableKey, controlType) { return insertDeleteditems(newItems, oldItems, tableKey, controlType) },
        loadData: function (node, obj) { return loadData(node, obj) },
        jsonTransformed: function (data) { return jsonTransformed(data) },
        handleError: function (error, logger) { return handleError(error, logger) },
        dateFormat: function (date, format) { return dateFormat(date, format) },
        menuRightsCheck: function (menuSettings, mainMenu, subMenu) { return menuRightsCheck(menuSettings, mainMenu, subMenu) },
        updateMultiselectData: function (item, mode, fields, key) { return updateMultiselectData(item, mode, fields, key) },
        loadMultiSelect: function (items, field) { return loadMultiSelect(items, field) },
        updateCheckBoxListData: function (item, mode, fields, key) { return updateCheckBoxListData(item, mode, fields, key) },
        loadCheckBoxList: function (items, field, fields) { return loadCheckBoxList(items, field, fields) },
        getUserRights: function (menuSettings, mainMenu, subMenu) { return getUserRights(menuSettings, mainMenu, subMenu) },
        setDisabledEnabledByRights: function (rights, appItem) { return setDisabledEnabledByRights(rights, appItem) },
        getCurrentDate: function (format) { return getCurrentDate(format) },
        getItemsFilterByObject: function (items, object) { return getItemsFilterByObject(items, object) },
        getSubMenus: function (menuSettings, mainMenu) { return getSubMenus(menuSettings, mainMenu) },
        getMenuTitle: function (menuSettings, mainMenu) { return getMenuTitle(menuSettings, mainMenu) },
        getItemsNotInOtherItems: function (items, notInItems, itemField, notInFiled) { return getItemsNotInOtherItems(items, notInItems, itemField, notInFiled) },
        setViewContentDisabled: function (currentMode) { return setViewContentDisabled(currentMode) },
        getTextFromTree: function (items, data, parent) { return getTextFromTree(items, data, parent) },
        sleep: function (milliseconds) { sleep(milliseconds) },
        getObjectsfromJSON: function (obj, key, val) { return getObjectsfromJSON(obj, key, val) },
        isSave: function (fields) { return isSave(fields) },
        comparedata: function (fields, pagename, section, pkname, pkid, keyword) { return comparedata(fields, pagename, section, pkname, pkid, keyword) },
        clearTableSelectedRows: function (type) { return clearTableSelectedRows(type) },
        closeReport: function () { return closeReport() },
        getTemplateUrl: function (path) { return getTemplateUrl(path) },
        getApplicationVersion: function () { return getApplicationVersion() },
        getApplicationEnvironment: function () { return getApplicationEnvironment() },
        defaultFormat: function () { return defaultFormat() },
        getDistinctfromJSON: function (obj, key) { return getDistinctfromJSON(obj, key) },
        getMatchedobjectfromJSON: function (obj, key1, key2, value) { return getMatchedobjectfromJSON(obj, key1, key2, value) },
        getFilterobjectfromJSON: function (obj, key1, value) { return getFilterobjectfromJSON(obj, key1, value) },
        pageChanges: function (funcPageChange, funcpageSave, callback) { return pageChanges(funcPageChange, funcpageSave, callback) },
        tableSortDDMMYYYEExt: function () { return tableSortDDMMYYYEExt() },
        getEmailPattern: function () { return getEmailPattern() },
        viewContentLoaded: function (configMenu) { return viewContentLoaded(configMenu) },
        colorpickerHide: function () { return colorpickerHide() },
        riskAggressionModalClose: function (configHeaderMenu, event) { return riskAggressionModalClose(configHeaderMenu, event) }
    };

}());
(function (navcon) {
    navcon.alert = {
        load: function (signalRHubProxy, ngAuthSettings, logger, authService, $rootScope){
            var clientPushHubProxy = signalRHubProxy(ngAuthSettings.signalRServer, 'NotificationHub', { logging: true });
            
            clientPushHubProxy.on('addNewNotification', function (data){
                 navcon.alert.displayAllNotification(data, authService.authentication.userId, logger, $rootScope);  
            });
            
            clientPushHubProxy.on('DeleteNotificationDetail', function (id){
                 navcon.alert.deleteUserNotification(id, authService.authentication.userId, logger, $rootScope);     
            });
            
            clientPushHubProxy.on('DeleteNotification', function (id){
                 navcon.alert.deleteAllNotification(id, authService.authentication.userId, logger, $rootScope);       
            });
        },
        displayAllNotification: function(data, loginId, logger, $rootScope){
            
            if(data.NotificationDetail === undefined) return;
            for(i=0, len = data.NotificationDetail.length; i < len ; i++){
                var item = data.NotificationDetail[i];
                if(item.UserId === loginId){
                    displayNotification(item.ReadStatus, item.NotificationDetailId);
                    break;
                } 
            }
            
            function displayNotification(readStatus,notificationId){
                data.NFDetailsId = notificationId;
                data.NotificationDetailId = notificationId;
                var items = [];
                items.push(data);
                $rootScope.$broadcast('ALERT-DATA-REFRESH', items, false);
                logger.info(data.Message || "Notification received..", "", "");
            }
        },
        deleteUserNotification: function(id, loginId, logger, $rootScope){
            $rootScope.$broadcast('ALERT-DATA-DELETE', id, "user");
        },
        deleteAllNotification: function(id, loginId, logger, $rootScope){
            $rootScope.$broadcast('ALERT-DATA-DELETE', id, "all");
        }
        
    };
}(navcon || {}));
(function (navcon) {
    navcon.kendo = {
        loadListDefaultData: function (data, fields) {
            $.map(fields, function (item, key) {
                if (item.type.toLowerCase() === "kendomultiselect" || item.type.toLowerCase() === "kendoselect" || item.type.toLowerCase() === "kendocombobox") {
                    var defaultField = item.selectOptions.item.defaultField;
                    if (defaultField !== undefined && defaultField !== "") {
                        if (data[defaultField] !== undefined && data[defaultField] !== null && data[defaultField] !== "")
                            item.selectOptions.items = angular.copy(navcon.getDistinctfromJSON(data[defaultField], item.selectOptions.item.dataField));
                    }
                }
            });
        },
        loadListSingleData: function (data, fields, key) {
            var keyIndex = navcon.getItemIndexByProperty(fields, key);
            var item = fields[keyIndex];
            if (keyIndex !== -1 && item !== undefined) {
                if (item.type.toLowerCase() === "kendomultiselect" || item.type.toLowerCase() === "kendoselect" || item.type.toLowerCase() === "kendocombobox") {
                    var defaultField = item.selectOptions.item.defaultField;
                    if (defaultField !== undefined && defaultField !== "") {
                        if (data[defaultField] !== undefined && data[defaultField] !== null && data[defaultField] !== "")
                            item.selectOptions.items = angular.copy(data[defaultField]);
                    }
                }
            }
        },
        requiredValidation: function (myFields, fieldName, validation) {
            //Required message
            if (validation.required !== undefined && validation.required !== null && (validation.required || validation.required.toLowerCase() === "yes")) {
                if (validation.requiredMessage !== undefined && validation.requiredMessage !== null && validation.requiredMessage !== "")
                    myFields.validation["required"] = { "message": validation.requiredMessage };
                else
                    myFields.validation["required"] = (validation.required || validation.required.toLowerCase() === "yes" ? true : false);
            }
        },
        minimumValidation: function (myFields, fieldName, validation) {
            //Minium message
            if (validation.minlength !== undefined && validation.minlength !== null && validation.minlength !== "") {
                var messageMin = validation.minlengthMessage !== undefined && validation.minlengthMessage !== "" ? validation.minlengthMessage : "Minimum " + validation.minlength + " character required.";
                myFields.validation[fieldName.toLowerCase() + "min"] = function (input) {
                    if (input.is("[name='" + fieldName + "']") && input.val().length < validation.minlength) {
                        input.attr("data-" + fieldName.toLowerCase() + "min-msg", "" + validation.minlengthMessage + "");
                        return false;
                    }
                    return true;
                }
            }
        },
        maximumValidation: function (myFields, fieldName, validation) {
            //Maximum message
            if (validation.maxlength !== undefined && validation.maxlength !== null && validation.maxlength !== "") {
                var messageMin = validation.maxlengthMessage !== undefined && validation.maxlengthMessage !== "" ? validation.maxlengthMessage : "Maximum " + validation.maxlength + " only allowed.";
                myFields.validation[fieldName.toLowerCase() + "max"] = function (input) {
                    if (input.is("[name='" + fieldName + "']") && input.val().length > validation.maxlength) {
                        input.attr("data-" + fieldName.toLowerCase() + "max-msg", "" + validation.maxlengthMessage + "");
                        return false;
                    }
                    return true;
                }
            }
        },
        patternValidation: function (myFields, fieldName, validation) {
            //Pattern message
            if (validation.pattern !== undefined && validation.pattern !== null && validation.pattern !== "") {
                var patternRegex = new RegExp(validation.pattern.toString());
                var messageMin = validation.patternMessage !== undefined && validation.patternMessage !== "" ? validation.patternMessage : "Alpha numeric only allowed.";
                myFields.validation[fieldName.toLowerCase() + "pattern"] = function (input) {
                    if (input.is("[name='" + fieldName + "']") && input.val() != "") {
                        input.attr("data-" + fieldName.toLowerCase() + "pattern-msg", "" + validation.patternMessage + "");
                        return patternRegex.test(input.val());
                    }
                    return true;
                }
            }
        },
        existDataValidation: function (myFields, fieldName, fieldKey, validation, scope) {
            //ExistData message
            if (validation.isExistData !== undefined && validation.isExistData !== null && validation.isExistData !== "") {
                var scopeData = scope.navconData[validation.isExistData];
                var keyOldData = "";

                var messageMin = validation.isExistMessage !== undefined && validation.isExistMessage !== "" ? validation.isExistMessage : "already exists..";
                myFields.validation[fieldName.toLowerCase() + "exists"] = function (input) {
                    if (input.is("[name='" + fieldName + "']") && input.val() != "") {
                        if (scope.fields.getById !== undefined && scope.fields.getById !== null)
                            keyOldData = scope.fields.getById[fieldKey];

                        retVal = navcon.getItemByKeyValue(scopeData, fieldKey, input.val().toString().trim());
                        if (retVal !== -1 && input.val().toString().trim() !== keyOldData.toString().trim()) {
                            input.attr("data-" + fieldName.toLowerCase() + "exists-msg", "" + validation.isExistMessage + "");
                            retVal = false;
                        }
                        else
                            retVal = true;

                        return retVal;
                    }
                    return true;
                }
            }
        }
    }
}(navcon || {}));
(function (navcon) {
    navcon.kendo.schedule = {
        /*distinctData: function (collectionData, distinctField) {
            var filterData = [];
            if (collectionData !== undefined && collectionData !== null && collectionData.length !== 0) {
                $.each(collectionData, function (index, event) {
                    var events = $.grep(filterData, function (e) {
                        return event[distinctField] === e[distinctField];
                    });
                    if (events.length === 0) {
                        filterData.push(event);
                    }
                });
            }
            return filterData;
        },
        filterDropDown: function (element, fieldName, settings) {
            //var dataSource = new kendo.data.DataSource({ data: this.dataS.data().toJSON() });

            var data = navcon.kendo.schedule.distinctData(settings.data, fieldName);

            element.kendoDropDownList({
                dataSource: {
                    data: data
                },
                group: { field: fieldName },
                serverFiltering: true,
                dataTextField: fieldName,
                dataValueField: fieldName,
                optionLabel: "--Select Value--"
            });
        },
        editDropDown: function (container, options, serviceMethod) {
            //var dataservice = angular.element(document).injector().invoke(function (dataservice) { return dataservice; });

            var fieldId = this.option.id;
            var fieldText = this.option.text;
            var dataSource = this.dataset;

            if (serviceMethod !== undefined && serviceMethod !== null && serviceMethod !== "") {
                return dataservice.getServerData(serviceMethod, '').then(function (returnData) {
                    if (returnData === undefined || returnData === null || returnData.length === 0) return;

                    var data = navcon.kendo.schedule.distinctData(returnData, fieldId);

                    $('<input required name="' + options.field + '"/>')
                        .appendTo(container)
                        .kendoDropDownList({
                            dataValueField: fieldId,
                            dataTextField: fieldText,
                            dataSource: {
                                type: "odata",
                                data: data,
                            }
                        });
                });
            } else {
                var data = navcon.kendo.schedule.distinctData(dataSource.data, fieldId);

                $('<input required name="' + options.field + '"/>')
                    .appendTo(container)
                    .kendoDropDownList({
                        dataValueField: fieldId,
                        dataTextField: fieldText,
                        dataSource: {
                            type: "odata",
                            data: data,
                        }
                    });
            }
        },*/
        resourceSetting: function (settings, scope, objParam) {
            var items = [];

            if (objParam !== undefined && objParam.resources !== undefined && objParam.resources !== null && objParam.resources.length !== 0)
                items = objParam.resources
            else
                items = settings.resources;

            return items;
        },
        eventSetting: function (settings, scope) {
            var items = [];
            items = settings.events;

            var resources = settings.resources;

            var modelFields = settings.model.fields;
            if (modelFields.color === undefined || modelFields.color === null) modelFields.color = { from: "Color", fieldKey: "" };

            /*if (modelFields.description === undefined || modelFields.description === null) modelFields.description = { from: "Description",fieldKey: "" };
            if (modelFields.startTimezone === undefined || modelFields.startTimezone === null) modelFields.startTimezone = { from: "StartTimezone",fieldKey: "" };
            if (modelFields.endTimezone === undefined || modelFields.endTimezone === null) modelFields.endTimezone = { from: "EndTimezone",fieldKey: "" };
            if (modelFields.recurrenceRule === undefined || modelFields.recurrenceRule === null) modelFields.recurrenceRule = { from: "RecurrenceRule",fieldKey: "" };
            if (modelFields.recurrenceID === undefined || modelFields.recurrenceID === null) modelFields.recurrenceID = { from: "RecurrenceID",fieldKey: "" };
            if (modelFields.recurrenceException === undefined || modelFields.recurrenceException === null) modelFields.recurrenceException = { from: "RecurrenceException",fieldKey: "" };
            if (modelFields.isAllDay === undefined || modelFields.isAllDay === null) modelFields.isAllDay = { IsAllDay: false,fieldKey: "" };*/

            $.map(items, function (item, index) {
                $.each(modelFields, function (key, value) {
                    if (modelFields[key].type !== undefined && modelFields[key].type.toLowerCase() === "date") {
                        //item[modelFields[key].from] = Date(item[modelFields[key].from]);
                    }
                });

                if (item.Color === undefined || item.Color === null) {
                    var colorValue = [{ color: "" }];
                    var iLoop = 0;
                    //for (var iLoop = 0, length = resources.length; iLoop < length; iLoop++) {
                    $.each(item, function (key, value) {
                        if (resources[iLoop].field === key) {
                            colorValue = resources[iLoop].dataSource.filter(function (e) { return e.value === item[key] });
                            return;
                        }
                    });
                    //}
                    item["Color"] = colorValue[0].color;
                }
                /*if (item.Description === undefined || item.Description === null) item.Description = "";
                if (item.StartTimezone === undefined || item.StartTimezone === null) item.StartTimezone = null";
                if (item.EndTimezone === undefined || item.EndTimezone === null) item.EndTimezone = null;
                if (item.RecurrenceRule === undefined || item.RecurrenceRule === null) item.RecurrenceRule = null;
                if (item.RecurrenceID === undefined || item.RecurrenceID === null) item.RecurrenceID = null;
                if (item.RecurrenceException === undefined || item.RecurrenceException === null) item.RecurrenceException = null;
                if (item.IsAllDay === undefined || item.IsAllDay === null) item.IsAllDay = false;*/
            });

            var dataSource = {
                type: "odata",
                batch: true,
                /*transport: {
                    read: function (e) {
                        e.success(data);
                    },
                    parameterMap: function (options, operation) {
                        if (operation !== "read" && options.models) {
                            return { models: kendo.stringify(options.models) };
                        }
                    }

                },*/
                data: items,
                schema: {
                    model: {
                        id: (settings.model.id !== undefined && settings.model.id !== "" ? settings.model.id : "id"),
                        fields: navcon.kendo.schedule.validationSchema(settings, scope),
                    }
                }
            };
            return dataSource;
        },
        setting1: function (el, options, scope, objParam) {
            var settings = {};
            if (options != undefined) settings = options;

            var kScheduler = null;
            var scheduler = $($(el).find('.kendoSchedule')[0]);
            if (scheduler !== undefined && scheduler !== null) {
                kendo.destroy(scheduler);
                scheduler.empty();

                $(scheduler).kendoScheduler({
                    date: new Date(navcon.getCurrentDate("YYYY/MM/DD")),
                    dateHeaderTemplate: kendo.template("<strong>#=kendo.toString(date, 'dd-MMM-yyyy')#</strong>"),
                    //height: 500,
                    editable: settings.editable !== undefined && settings.editable.enabled !== undefined && settings.editable.enabled ? settings.editable.enabled : false,

                    //eventTemplate: $("#event-template").html(),
                    allDaySlot: settings.allDaySlot !== undefined ? settings.allDaySlot : false,
                    allDaySlotTemplate: "<div style='background:\\#A2A2AA; height: 100%;width: 100%;'></div>",

                    views: [
                      "day",
                      {
                          type: "kendo.ui.SchedulerTimelineYearView",
                          title: "Year",
                          majorTick: 1440,
                          minorTickCount: 1,
                          columnWidth: 100,
                          group: {
                              date: false,
                              "resources": ["ownerId"],
                              "orientation": "vertical"
                          },
                          selected: true
                      },
                    ],
                    timezone: settings.timezone !== undefined ? settings.timezone : "Etc/UTC",
                    dataSource: {
                        batch: true,
                        data: [
                            /*{ "TaskID": 4, "OwnerID": 2, "Title": "Bowling tournament", "Description": "", "StartTimezone": null, "Start": "\/Date(1370811600000)\/", "End": "\/Date(1370822400000)\/", "EndTimezone": null, "RecurrenceRule": null, "RecurrenceID": null, "RecurrenceException": null, "IsAllDay": false },
                            { "TaskID": 5, "OwnerID": 2, "Title": "Take the dog to the vet", "Description": "", "StartTimezone": null, "Start": "\/Date(1370847600000)\/", "End": "\/Date(1370851200000)\/", "EndTimezone": null, "RecurrenceRule": null, "RecurrenceID": null, "RecurrenceException": null, "IsAllDay": false },
                            { "TaskID": 6, "OwnerID": 2, "Title": "Call Charlie about the project", "Description": "", "StartTimezone": null, "Start": "\/Date(1370950200000)\/", "End": "\/Date(1370955600000)\/", "EndTimezone": null, "RecurrenceRule": null, "RecurrenceID": null, "RecurrenceException": null, "IsAllDay": false },
                            { "TaskID": 7, "OwnerID": 3, "Title": "Meeting with Alex", "Description": "", "StartTimezone": null, "Start": "\/Date(1371034800000)\/", "End": "\/Date(1371038400000)\/", "EndTimezone": null, "RecurrenceRule": null, "RecurrenceID": null, "RecurrenceException": null, "IsAllDay": false },
                            { "TaskID": 9, "OwnerID": 2, "Title": "Alex\u0027s Birthday", "Description": "", "StartTimezone": null, "Start": "\/Date(1371175200000)\/", "End": "\/Date(1371175200000)\/", "EndTimezone": null, "RecurrenceRule": null, "RecurrenceID": null, "RecurrenceException": null, "IsAllDay": true }*/
                            { "MeetingID": 4, "OwnerID": 2, "Title": "Bowling tournament", "Description": "", "StartTimezone": null, "Start": "2017-01-01", "End": "2017-01-01", "EndTimezone": null, "RecurrenceRule": null, "RecurrenceID": null, "RecurrenceException": null, "IsAllDay": false },
                            { "MeetingID": 5, "OwnerID": 2, "Title": "Take the dog to the vet", "Description": "", "StartTimezone": null, "Start": "2017-01-02", "End": "2017-01-02", "EndTimezone": null, "RecurrenceRule": null, "RecurrenceID": null, "RecurrenceException": null, "IsAllDay": false },
                            { "MeetingID": 6, "OwnerID": 2, "Title": "Call Charlie about the project", "Description": "", "StartTimezone": null, "Start": "2017-01-03", "End": "2017-01-03", "EndTimezone": null, "RecurrenceRule": null, "RecurrenceID": null, "RecurrenceException": null, "IsAllDay": false },
                            { "MeetingID": 7, "OwnerID": 3, "Title": "Meeting with Alex", "Description": "", "StartTimezone": null, "Start": "2017-01-04", "End": "2017-01-04", "EndTimezone": null, "RecurrenceRule": null, "RecurrenceID": null, "RecurrenceException": null, "IsAllDay": false },
                            { "MeetingID": 9, "OwnerID": 2, "Title": "Alex\u0027s Birthday", "Description": "", "StartTimezone": null, "Start": "2017-01-05", "End": "2017-01-05", "EndTimezone": null, "RecurrenceRule": null, "RecurrenceID": null, "RecurrenceException": null, "IsAllDay": true }
                        ],
                        schema: {
                            model: {
                                id: "taskId",
                                fields: {
                                    //taskId: { from: "TaskID", type: "number" },
                                    meetingId: { from: "MeetingID", type: "number" },
                                    title: { from: "Title", defaultValue: "No title", validation: { required: true } },
                                    start: { type: "date", from: "Start" },
                                    end: { type: "date", from: "End" },
                                    startTimezone: { from: "StartTimezone" },
                                    endTimezone: { from: "EndTimezone" },
                                    description: { from: "Description" },
                                    recurrenceId: { from: "RecurrenceID" },
                                    recurrenceRule: { from: "RecurrenceRule" },
                                    recurrenceException: { from: "RecurrenceException" },
                                    ownerId: { from: "OwnerID", defaultValue: 1 },
                                    isAllDay: { type: "boolean", from: "IsAllDay" }
                                }
                            }
                        }
                    },
                    resources: [
                      {
                          field: "ownerId",
                          title: "Owner",
                          dataSource: [
                            { text: "Alex", value: 1, color: "#f8a398" },
                            { text: "Bob", value: 2, color: "#51a0ed" },
                            { text: "Charlie", value: 3, color: "#56ca85" }
                          ]
                      }
                    ]
                });
            }
        },
        schedulerViews: function (settings, objParam) {
            var viewList = [];
            var defaultView = false;

            var myGroup = null;
            if (objParam !== undefined && objParam.group !== undefined && objParam.group !== null) {
                myGroup = objParam.group;
            } else if (settings.group !== undefined && settings.group.enabled !== undefined && settings.group.enabled) {
                myGroup = {
                    date: settings.group.date !== undefined && settings.group.orientation === undefined ? settings.group.date : false,
                    resources: settings.group.resources !== undefined ? settings.group.resources : [],
                    orientation: settings.group.orientation !== undefined ? settings.group.orientation : "vertical"//"horizontal"
                };
            }

            if (settings.views !== undefined) {
                $.map(settings.views, function (item, index) {
                    if (item.toLowerCase() === "day") {
                        defaultView = (settings.defaultView.toLowerCase() === "day" ? true : false);
                        viewList.push({
                            type: "day",
                            showWorkHours: true,
                            title: "Today",
                            date: new Date(navcon.getCurrentDate("YYYY/MM/DD")),
                            startTime: new Date(navcon.getCurrentDate("YYYY/MM/DD") + " 00:00"),
                            endTime: new Date(navcon.getCurrentDate("YYYY/MM/DD") + " 23:00"),
                            selected: defaultView
                        });
                    } else if (item.toLowerCase() === "week") {
                        defaultView = (settings.defaultView.toLowerCase() === "week" ? true : false);
                        viewList.push({
                            type: "week",
                            selected: defaultView
                        });
                    } else if (item.toLowerCase() === "workWeek") {
                        defaultView = (settings.defaultView.toLowerCase() === "workweek" ? true : false);
                        viewList.push({
                            type: "workWeek", workWeekStart: 0, workWeekEnd: 4,
                            selected: defaultView
                        });
                    } else if (item.toLowerCase() === "month") {
                        defaultView = (settings.defaultView.toLowerCase() === "month" ? true : false);
                        viewList.push({
                            type: "month",
                            eventTemplate: $("#event-template").html(),
                            selected: defaultView                            
                        });
                    } else if (item.toLowerCase() === "year") {
                        defaultView = (settings.defaultView.toLowerCase() === "year" ? true : false);
                        viewList.push({
                            title: "Year",
                            type: "kendo.ui.SchedulerTimelineYearView",
                            majorTick: 1440,
                            minorTickCount: 1,
                            columnWidth: 100,
                            group: myGroup,
                            groupHeaderTemplate: $("#groupHeaderTemplate").html(),
                            selected: defaultView
                            //dayTemplate: kendo.template("<strong>#= kendo.toString(date, 'MMM') #</strong>"),
                            //majorTimeHeaderTemplate: kendo.template("<strong>#= kendo.toString(date, 'dd') #</strong>"),
                            //minorTimeHeaderTemplate: kendo.template("<strong>#= kendo.toString(date, 'dd') #</strong>"),
                        });
                    } else if (item.toLowerCase() === "agenda") {
                        defaultView = (settings.defaultView.toLowerCase() === "agenda" ? true : false);
                        viewList.push({
                            type: "agenda",
                            eventHeight: 200,
                            selected: defaultView
                        });
                    } else if (item.toLowerCase() === "todo") {
                        defaultView = (settings.defaultView.toLowerCase() === "todo" ? true : false);
                        viewList.push({
                            type: "kendo.ui.ToDoView", title: "To Do",
                            selected: defaultView
                        });
                    } else if (item.toLowerCase() === "timeline") {
                        defaultView = (settings.defaultView.toLowerCase() === "timeline" ? true : false);
                        viewList.push({
                            type: "timeline",
                            eventHeight: 50,
                            selected: defaultView
                        });
                    } else if (item.toLowerCase() === "timelineworkweek") {
                        defaultView = (settings.defaultView.toLowerCase() === "timelineworkweek" ? true : false);
                        viewList.push({
                            type: "timelineWorkWeek",
                            selected: defaultView
                        });
                    } else if (item.toLowerCase() === "timelinemonth") {
                        defaultView = (settings.defaultView.toLowerCase() === "timelinemonth" ? true : false);
                        viewList.push({
                            type: "timelineMonth",
                            //startTime: new Date(navcon.getCurrentDate("YYYY/MM/DD") + " 00:00 AM"),
                            //majorTick: 1440,
                            group: myGroup,
                            groupHeaderTemplate: $("#groupHeaderTemplate").html(),
                            selected: defaultView
                        });
                    } else if (item.toLowerCase() === "customagenda") {
                        defaultView = (settings.defaultView.toLowerCase() === "customagenda" ? true : false);
                        viewList.push({
                            type: "kendo.ui.CustomAgendaView",
                            title: "Custom Agenda",
                            selected: defaultView
                        });
                    }
                });
            } else {
                viewList = ["day", "month", "agenda"];
            }
            return viewList;
        },
        setting: function (el, options, scope, objParam) {
            var settings = {};
            if (options != undefined) settings = options;
            //if (options != undefined && options.options !== undefined) settings = options.options;

            var kScheduler = null;
            var scheduler = $($(el).find('.kendoSchedule')[0]);
            if (scheduler !== undefined && scheduler !== null) {

                kendo.destroy(scheduler);
                scheduler.empty();

                var myGroup = null;
                if (objParam !== undefined && objParam.group !== undefined && objParam.group !== null) {
                    myGroup = objParam.group;
                } else if (settings.group !== undefined && settings.group.enabled !== undefined && settings.group.enabled) {
                    myGroup = {
                        date: settings.group.date !== undefined && settings.group.orientation === undefined ? settings.group.date : false,
                        resources: settings.group.resources !== undefined ? settings.group.resources : [],
                        orientation: settings.group.orientation !== undefined ? settings.group.orientation : "vertical"//"horizontal"
                    };
                }

                var kScheduler = scheduler.kendoScheduler({
                    timezone: settings.timezone !== undefined ? settings.timezone : "Etc/UTC",
                    date: new Date(navcon.getCurrentDate("YYYY/MM/DD")),
                    //startTime: new Date(navcon.getCurrentDate("YYYY/MM/DD") + " 00:00 AM"),
                    dateHeaderTemplate: kendo.template("<strong>#=kendo.toString(date, 'dd-MMM-yyyy')#</strong>"),
                    selectable: settings.selectable !== undefined ? settings.selectable : false,
                    mobile: true,
                    //currentTimeMarker: settings.todayVisible !== undefined ? settings.todayVisible : { updateInterval: 100, useLocalTimezone: false },
                    //eventHeight: settings.contentHeight !== undefined ? settings.contentHeight : 50,

                    allDaySlot: (settings.allDaySlot !== undefined ? settings.allDaySlot : false),
                    allDaySlotTemplate: "<div style='background:\\#A2A2AA; height: 100%;width: 100%;'></div>",

                    //eventTemplate: $("#event-template").html(),

                    ////slotTemplate: kendo.template("<strong>#=kendo.toString(date, 'dd-MMM-yyyy')#</strong>"),
                    ////allDayEventTemplate: $("#event-template").html(),
                    ////dateHeaderTemplate: kendo.template("<strong>#=kendo.toString(date, 'd')#</strong>"),
                    ////groupHeaderTemplate: $("#groupHeaderTemplate").html(),
                    ////majorTimeHeaderTemplate: kendo.template("<strong>#=kendo.toString(date, 'h')#</strong><sup>00</sup>"),
                    ////minorTimeHeaderTemplate: kendo.template("<strong>#=kendo.toString(date, 't')#</strong>"),
                    //groupHeaderTemplate: kendo.template("<span>#=kendo.toString(start, 'HH:mm')#</span> - <span>#=kendo.toString(end, 'HH:mm')#</span>"),

                    views: navcon.kendo.schedule.schedulerViews(options, objParam),

                    //autoBind: settings.autoBind !== undefined ? settings.autoBind : false,
                    dataSource: navcon.kendo.schedule.eventSetting(options, scope),

                    //Group settings
                    //group: myGroup,

                    resources: navcon.kendo.schedule.resourceSetting(options, scope, objParam),

                    //Edit settings
                    //editable: settings.editable !== undefined && settings.editable.enabled !== undefined && settings.editable.enabled ? settings.editable.enabled : false,
                    editable: ((settings.editable !== undefined && settings.editable.enabled !== undefined && settings.editable.enabled) ?
                        {
                            confirmation: settings.editable.confirmText !== undefined ? settings.editable.confirmText : "Are you sure you want to delete this meeting?",
                            create: settings.editable.create !== undefined ? settings.editable.create : false,
                            update: settings.editable.update !== undefined ? settings.editable.update : false,
                            destroy: settings.editable.destroy !== undefined ? settings.editable.destroy : false,
                            //editRecurringMode: settings.editable.editRecurringMode !== undefined ? settings.editable.editRecurringMode : "series",
                            //Recurring events edit mode. The available modes are: "dialog" (default), "series" and "occurrence".
                            move: settings.editable.move !== undefined ? settings.editable.move : false,
                            resize: settings.editable.resize !== undefined ? settings.editable.resize : false,
                            //template: $("#editor").html(),
                            //window: {
                            //    title: "My Custom Title",
                            //    animation: false,
                            //    open: function(e){}
                            //},
                        } : null),
                    //footer: settings.footer !== undefined && settings.footer.enabled !== undefined && settings.footer.enabled ? settings.footer.enabled : false,
                    dataBound: navcon.kendo.schedule.dataBound,
                    dataBinding: navcon.kendo.schedule.dataBinding,
                    change: settings.selectable !== undefined && settings.selectable ? navcon.kendo.schedule.change : null,
                    add: function (e) {
                        //e.event.location = 1;
                        //e.event.appointmentType = 1;

                        console.log("Add", e.event.title);
                    },
                    edit: function (e) {
                        //e.preventDefault(); //prevent popup editing
                        //var dataSource = this.dataSource;
                        //var event = e.event;

                        //if (event.isNew()) {
                        //    setTimeout(function () {
                        //        dataSource.add(event);
                        //        navcon.kendo.schedule.editEvent(event);
                        //    });
                        //} else {
                        //    navcon.kendo.schedule.editEvent(event);
                        //}

                        console.log("Edit", e.event.title);
                    },
                    save: function (e) {
                        var container = e.container;
                        var event = e.event;

                        var scheduler = $(e.sender.element).data("kendoScheduler");
                        var dataSource = scheduler.dataSource;

                        if (event.id !== "") {
                        } else {
                            //$(".k-scheduler").data("kendoScheduler").dataSource.sync();
                            event.id = 122;
                            event.meetingId = 122;
                            dataSource.options.data.push(event);

                            //$(".k-scheduler").data("kendoScheduler").addEvent({
                            //    start: new Date(event.start),
                            //    end: new Date(event.end)
                            //});

                            dataSource.add({ event });
                            /*dataSource.add({
                                meetingId: 122,
                                roomID: 3,
                                attendees: event.attendees,
                                start: event.start,
                                end: event.end,
                                title: event.title,
                                description: event.title,
                                startTimezone: "",
                                endTimezone: "",
                                recurrenceRule: "",
                                recurrenceID: "",
                                recurrenceException: "",
                                isAllDay: event.isAllDay,
                                uid:event.uid
                            });*/
                        }
                        //e.preventDefault();
                        console.log("Saving", e.event.title);
                    },
                    remove: function (e) {
                        //e.preventDefault();
                        console.log("Removing", e.event.title);
                    },
                    cancel: function (e) {
                        //kSchedule.cancelChanges();
                        console.log("Cancel");
                    },
                    moveStart: navcon.kendo.schedule.moveStart,
                    move: navcon.kendo.schedule.move,
                    moveEnd: navcon.kendo.schedule.moveEnd,
                    resizeStart: navcon.kendo.schedule.resizeStart,
                    resize: navcon.kendo.schedule.resize,
                    resizeEnd: navcon.kendo.schedule.resizeEnd,
                    navigate: navcon.kendo.schedule.navigate,

                    //footer settings
                    footer: ((settings.footer !== undefined && settings.footer.enabled !== undefined && settings.footer.enabled) ?
                        {
                            command: settings.footer.command !== undefined ? settings.footer.command : false,//"workDay" 
                        } : false),
                    //PDF settings
                    toolbar: [{ name: "pdf", text: "Export PDF", iconClass: "k-icon k-i-copy" }],
                    pdf: ((settings.pdf !== undefined && settings.pdf.enabled !== undefined && settings.pdf.enabled) ?
                        {
                            allPages: true,
                            avoidLinks: true,
                            paperSize: "A4",
                            margin: { top: "2cm", right: "1cm", bottom: "1cm", left: "1cm" },
                            landscape: true,
                            repeatHeaders: true,
                            fileName: $(el).attr("type") + ".pdf",
                            template: $("#print-template").html(),
                            scale: 0.8
                        } : null),
                    pdfExport: function (e) {
                        title = $(el).attr("type");
                        //date = navcon.getCurrentDate();

                        //kSchedule.hideColumn(4);

                        //e.promise.done(function () {
                        //    kSchedule.showColumn(4);
                        //});
                    }
                }).data("kendoScheduler");
            }

            var toolbarOptions = [];

            if (kScheduler !== undefined && kScheduler !== null) {
                //$("#scheduler").data("kendoScheduler").addEvent({
                //    start: new Date("2013/6/13"),
                //    end: new Date("2013/6/13")
                //});

                $(scheduler).kendoTooltip({
                    filter: "td[role='gridcell']",
                    width: 300,
                    content: function (e) {
                        var scheduler = $($(el).find('.kendoSchedule')[0]);
                        scheduler = $(scheduler).getKendoScheduler();
                        var slot = scheduler.slotByElement(e.target);
                        var events = scheduler.occurrencesInRange(slot.startDate, slot.endDate);
                        var content = "";
                        for (var i = 0; i < events.length; i++) {
                            content = content + "<div>" + events[i].title + "</div>";
                        }
                        return content == "" ? "No events" : content;
                    }
                });

                //Multiselect control
                //$timeout(function () {
                //var schedulerMS = $($(el).find('.schedulerMS')[0]);
                //schedulerMS.kendoMultiSelect({
                //    delay: 1000, // wait 1 second before clearing the user input
                //    dataTextField: "text",
                //    dataValueField: "value",
                //    dataSource: {
                //        data: $(scheduler).getKendoScheduler().resources[0].dataSource.data().toJSON()
                //    },
                //    //value: [$(scheduler).getKendoScheduler().resources[0].dataSource.at(0).value],
                //    //change: navcon.kendo.schedule.multiselectChange(el, scheduler, this.value()),
                //});

                //var multiselect = $(schedulerMS).data("kendoMultiSelect");
                //multiselect.value($(scheduler).getKendoScheduler().resources[0].dataSource.at(0).value);
                ////multiselect.trigger("change");
                //multiselect.bind("change", navcon.kendo.schedule.multiselectChange(el, scheduler, multiselect));

                //var schedulerMSB = $($(el).find('.schedulerMSB')[0]);
                //$(schedulerMSB).click(function () {
                //    navcon.kendo.schedule.multiselectGroup(el, scheduler, kScheduler)
                //});
                //});

            }
        },
        change: function (e) {
            //var start = e.start;
            //var end = e.end;
            //var scope = $(e.sender.element).scope();

            //var scheduler = $(e.sender.element).data("kendoScheduler");
            ////scheduler.options.group.orientation = this.value();

            ////scheduler.view(scope.calendarSetting.defaultView);
            ////scheduler.view(scheduler.view().name);

            ////console.log(kendo.format("Selection between {0:g} and {1:g}", start, end));
        },
        multiselectChange: function (el, scope, scheduler, values) {
            var scheduler = $(scheduler).getKendoScheduler();
            var resources = scheduler.resources;

            var filters = null;
            if (values !== undefined && values !== null && values.length !== 0) {
                filters = $.map(values, function (val) {
                    return { field: "value", operator: "eq", value: val }
                });
            }

            if (filters !== null) {
                resources[0].dataSource.filter({
                    logic: "or",
                    filters: ((filters !== undefined && filters !== null && filters !== -1) ? filters : null)
                });
            } else {
                resources[0].dataSource._filter = undefined;
            }

            navcon.kendo.schedule.setting(el, scope.calendarSetting, scope, { resources: resources });
        },
        multiselectGroup: function (el, scope) {
            var group = scope.calendarSetting.group;

            var button = $($(el).find('.schedulerMSB')[0]);
            if (button.text() === "Group") {
                button.text("Ungroup");
                //group.resources= ["Rooms"]
            } else {
                button.text("Group");
                group.resources = null;
            }

            navcon.kendo.schedule.setting(el, scope.calendarSetting, scope, { group: group });
        },
        itemPageChange: function (el, scope, values) {
            scope.records_per_page = values.toString().toLowerCase() === "all" ? scope.objJson.length : values;

            scope.current_page--;
            scope.nextPage();
        },
        dataBinding: function (e) {
            console.log("data binding");
        },
        dataBound: function (e) {
            var view = this.view();
            var events = this.dataSource.view();
            var eventElement;
            var event;

            var table1 = $(".k-scheduler-times .k-scheduler-table");
            table1 = table1.first();
            table1.find("tr:nth(0)").children().first().text("Resources").css({ "text-align": "left" });
            table1.find("tr:nth(1)").hide();

            var table2 = $(".k-scheduler-header .k-scheduler-header-wrap .k-scheduler-table");
            table2 = table2.last();
            table2.find("tr:nth(1)").hide();

            //var rows = table.find("tr").hide();
            //rows.each(function () {
            //    $(this).children("th:last").hide();
            //});

            /*for (var idx = 0, length = events.length; idx < length; idx++) {
                event = events[idx];
        
                //get event element
                eventElement = view.element.find("[data-uid=" + event.uid + "]");
        
                //set the backgroud of the element
                eventElement.css("background-color", "red");
            }*/

            console.log("data bound");
        },
        messagesInfo: function (e) {
            return {
                allDay: "daily",
                ariaEventLabel: "Selected event is {0}. It starts on {1:d} {2:t}",
                ariaSlotLabel: "Selected from {0:g} to {0:g}",
                date: "Date",
                deleteWindowTitle: "Remove event",
                event: "Meeting",
                defaultRowText: "Conference room",
                showFullDay: "Show 24h",
                showWorkDay: "Show work hours",
                time: "Time of the day",
                today: "Current Date",
                previous: "Previous",
                next: "Next",
                save: "Update",
                cancel: "Undo",
                destroy: "Destroy",
                pdf: "PDF Export",
                editable: {
                    confirmation: "Are you sure you want to delete this meeting?",
                    allDayEvent: "Full day",
                    description: "Message",
                    editorTitle: "Edit event",
                    end: "End of the event",
                    endTimezone: "End date timezone",
                    repeat: "Repeat the event",
                    separateTimezones: "Set different start and end time zones",
                    start: "Start of the event",
                    startTimezone: "Start date timezone",
                    timezone: "Event timezone",
                    timezoneEditorButton: "Time zone",
                    timezoneEditorTitle: "Timezones",
                    title: "Title of the event",
                },
                recurrenceEditor: {
                    daily: {
                        interval: " days(s)",
                        repeatEvery: "Repeat on: ",
                    },
                    end: {
                        after: "after ",
                        occurrence: " occurrence(s).",
                        label: "end: ",
                        never: "never",
                        mobileLabel: "ends: ",
                        on: "on ",

                    }
                },
                recurrenceEditor: {
                    frequencies: {
                        daily: "daily",
                        monthly: "monthly",
                        weekly: "weekly",
                        yearly: "yearly",
                        never: "never",
                    },
                    monthly: {
                        day: "day ",
                        interval: " month(s).",
                        repeatEvery: "Repeat each: ",
                        repeatOn: "repeat on: ",
                    },
                    offsetPositions: {
                        first: "first",
                        second: "second",
                        last: "last",
                    },
                    weekly: {
                        interval: " week(s).",
                        repeatEvery: "Repeat each: ",
                    },
                    weekdays: {
                        day: "Day",
                        weekday: "Week day",
                        weekend: "Week day"
                    },
                    yearly: {
                        of: " of ",
                        repeatEvery: "Repeat each: ",
                        repeatOn: "repeat on: ",
                        interval: " year(s).",
                    }
                },
                recurrenceMessages: {
                    deleteRecurring: "Delete only this event occurrence or the whole series?",
                    deleteWindowOccurrence: "Delete current event",
                    deleteWindowSeries: "Delete all occurrences",
                    deleteWindowTitle: "Delete Recurring event",
                    editRecurring: "Do you want to edit only this event or the whole series?",
                    editWindowOccurrence: "Edit current event",
                },
                views: {
                    day: "Today",
                    week: "Weekly",
                    month: "Monthly",
                    agenda: "Events list",
                }
            };
        },
        destroyEditor() {
            //var editor = $("#editor");
            //var template = kendo.template($("#editor-template").html());
            //var scheduler = $("#scheduler").data("kendoScheduler");

            //kendo.destroy(editor);
            //editor.find("button").off();
            //editor.html("");
        },
        editEvent: function () {
            //var editor = $("#editor");
            //var template = kendo.template($("#editor-template").html());
            //var scheduler = $("#scheduler").data("kendoScheduler");

            //navcon.kendo.schedule.destroyEditor();

            //editor.html(template({}));
            //kendo.bind(editor, event); //Bind the editor container (uses MVVM)

            //editor.find("#save").click(function () {
            //    scheduler.dataSource.sync();
            //    navcon.kendo.schedule.destroyEditor();
            //});

            //editor.find("#cancel").click(function () {
            //    scheduler.dataSource.cancelChanges(currentEvent);
            //    navcon.kendo.schedule.destroyEditor();
            //});
        }, moveStart: function (e) {
            console.log("Move Start", e.event.title);
        }, move: function (e) {
            //var scheduler = $("#scheduler").data("kendoScheduler");
            //var view = scheduler.view();
            //var template = "your custom template";
            //$(".k-event-drag-hint").html(template);

            console.log("Move", e.slot.start);
        }, moveEnd: function (e) {
            console.log("MoveEnd", e.slot.start);
        },
        navigate: function (e) {
            console.log("navigate", e.date);
        },
        resizeStart: function (e) {
            console.log("Resize Start", e.event.title);
        },
        resize: function (e) {
            console.log("Resize", e.slot.start);
        },
        resizeEnd: function (e) {
            console.log("Resize End", e.slot.start);
        },
        refresh: function (el, setting, scope) {
            var schedulerElement = $($(el).find('.kendoSchedule')[0]);
            scheduler = schedulerElement.getKendoScheduler();

            if (scheduler) {
                scheduler.destroy();
                schedulerElement.empty();
            }

            navcon.kendo.schedule.setting(el, setting, scope);
        },
        selectedRowIndex: function (table, selectedRow, idColumn) {
            var returnData = -1;
            var tableData = table.data !== undefined ? table.data : table;

            if (tableData !== undefined && tableData.length > 0)
                returnData = navcon.getItemIndexByKeyValue(tableData, idColumn, selectedRow[idColumn]);

            return returnData;
        },
        /*columnAssign: function (table, columnData, serviceName, columnType) {
            var returnData = "";
            if (serviceName != undefined && serviceName != "") {
                returnData = dataservice.getServerData(serviceName).then(function (data) {
                    if (data === undefined || data.length === 0) return;
                    tableColumnCreate(data, columnType);
                    return data;
                });
            } else {
                tableColumnCreate(columnData, columnType);
            }

            function tableColumnCreate(data, columnType) {
                if (data != undefined) {
                    var columndetails = "", i = 0;

                    for (i = 0; i < data.length; i++) {
                        //var columnIndex = navcon.getItemByKeyValue(table.columnControl.exceptColumns, "index", i);
                        var columnIndex = table.columnControl.exceptColumns.indexOf(i);
                        if (columnIndex !== -1)
                            columndetails += "{\"title\": \"" + data[i].text.trim() + "\", \"data\": \"" + data[i].id + "\", \"width\": \"100px\" },";
                        else
                            columndetails += "{\"title\": \"" + data[i].text.trim() + "\", \"options\" : {\"type\" : \"" + table.columnControl.type + "\", \"dataType\": \"" + columnType + "\"}, \"data\": \"" + data[i].id + "\", \"width\": \"100px\" },";
                        //columndetails += "{\"title\": \"" + data[i].text.trim() + "\", \"data\": \"" + data[i].id + "\", \"field\": \"" + data[i].id + "\", \"width\": \"" + columnIndex.width + "\", \"fieldType\": \"text\" },";
                    }
                    if (columndetails !== "") columndetails = columndetails.substring(0, columndetails.length - 1);

                    table.columns = $.parseJSON("[" + columndetails + "]");
                    //table.columns = navcon.jsonTransformed($.parseJSON("[" + columndetails + "]"));
                }
                return data;
            }
        },
        manageData: function (columns, items) {
            for (var index in items) {
                var item = items[index];
                for (var p in item) {
                    if (item.hasOwnProperty(p)) {
                        var propVal = item[p];
                        var options = getColumnOptions(columns, p);
                        if (options !== -1) {
                            if (options.type !== undefined) {
                                var retVal = navcon.insertControl(options.type, propVal);
                                item[p] = retVal;
                            }
                        }
                    }
                }
            }

            function getColumnOptions(columns, prop) {
                for (index in columns) {
                    var col = columns[index];
                    if (col.data !== undefined) {
                        if (col.data === prop) {
                            return col.options || -1;
                        }
                    }
                }
                return -1;
            }

            return items;
        },*/
        pdfExport: function (kScheduler, settings, e) {
            var progress = $.Deferred();

            /*kendo.drawing.drawDOM($("#header"))
              .done(function(header) {
                  kendo.drawing.drawDOM($("#footer"))
                    .done(function(footer) {*/
            kScheduler._drawPDF(progress)
              .then(function (root) {
                  root.children.unshift(header);
                  root.children.push(footer);

                  return kendo.drawing.exportPDF(root, {
                      paperSize: "auto",
                      margin: { left: "1cm", top: "1cm", right: "1cm", bottom: "1cm" },
                      multiPage: true
                  });
              })
              .done(function (dataURI) {
                  //console.log("Okay");
                  kendo.saveAs({
                      dataURI: dataURI,
                      fileName: "navcon.pdf"
                  });
                  progress.resolve();
              })
            /*});
        })*/
        },
        exportData: function () {
            //drawing = kendo.drawing;

            ////workaround PDF export rowspan limitation
            //$(".k-scheduler-content table [rowspan]").each(function () {
            //    var currentCell = $(this);
            //    var rowSpan = parseInt(currentCell.attr("rowspan"));
            //    var currentRow = currentCell.closest("tr");

            //    var nextRow = null;
            //    for (var i = 0; i < rowSpan - 1; i++) {
            //        nextRow = nextRow ? nextRow.next() : currentRow.next();
            //        nextRow.prepend($("<td class='inserted'></td>"));
            //    }

            //    currentCell.attr("rowspan", 1);
            //})

            //drawing.drawDOM("#scheduler .k-scheduler-content", {
            //    paperSize: "A4",
            //    margin: "2cm",
            //    scale: 0.6
            //}).then(function (group) {
            //    drawing.pdf.saveAs(group, "scheduler_agenda.pdf");
            //    var scheduler = $("#scheduler").getKendoScheduler();
            //    scheduler.view(scheduler.view().name);
            //});
        },
        validationSchema: function (settings, scope) {
            var myFields = {};
            if (settings.model !== undefined && settings.model !== null) {
                var strFields = "";
                //myFields = { "id": settings.model.id !== undefined && settings.model.id !== "" ? settings.model.id : "id" };

                $.each(settings.model.fields, function (i, item) {
                    var key = i;
                    var type = item.type !== undefined && item.type !== "" ? item.type : "";
                    var fieldTitle = item.defaultValue !== undefined && item.defaultValue !== "" ? item.defaultValue : "";
                    var fieldName = item.from !== undefined && item.from !== "" ? item.from : "";
                    var nullable = item.nullable !== undefined && item.nullable !== "" ? item.nullable : true;
                    var defaultValue = item.defaultValue !== undefined && item.defaultValue !== "" ? item.defaultValue : "";

                    var fieldKey = item.fieldKey !== undefined && item.fieldKey !== "" ? item.fieldKey : "";
                    var field = null;
                    var fieldKeyIndex = navcon.getItemIndexByProperty(scope.fields, fieldKey);
                    if (fieldKeyIndex !== undefined && fieldKeyIndex !== -1) field = scope.fields[fieldKeyIndex];

                    if (fieldName !== undefined && fieldName !== null && fieldName !== "") {
                        if (type.toLowerCase() === "autoselect") type = "string";

                        //myFields[key] = { "from": fieldName, "type": type, "defaultValue": defaultValue, "nullable": nullable, "validation": {} };
                        myFields[key] = { "from": fieldName, "type": type, "validation": {} };

                        if (fieldKey !== undefined && fieldKey !== null && fieldKey !== "") {
                            myFields[key].validation["type"] = type;

                            if (field !== undefined && field !== null && field.templateOptions !== undefined && field.templateOptions.length !== 0) {
                                var validation = field.templateOptions;
                                //Required message
                                navcon.kendo.requiredValidation(myFields[key], fieldName, validation);
                                /*if (validation.required !== undefined && validation.required !== null && (validation.required || validation.required.toLowerCase() === "yes")) {
                                    if (validation.requiredMessage !== undefined && validation.requiredMessage !== null && validation.requiredMessage !== "")
                                        myFields[fieldName].validation["required"] = { "message": validation.requiredMessage };
                                    else
                                        myFields[fieldName].validation["required"] = (validation.required || validation.required.toLowerCase() === "yes" ? true : false);
                                }*/

                                //Minium message
                                navcon.kendo.minimumValidation(myFields[key], fieldName, validation);
                                /*if (validation.minlength !== undefined && validation.minlength !== null && validation.minlength !== "") {
                                    var messageMin = validation.minlengthMessage !== undefined && validation.minlengthMessage !== "" ? validation.minlengthMessage : "Minimum " + validation.minlength + " character required.";
                                    myFields[fieldName].validation[fieldName.toLowerCase() + "min"] = function (input) {
                                        if (input.is("[name='" + fieldName + "']") && input.val().length < validation.minlength) {
                                            input.attr("data-" + fieldName.toLowerCase() + "min-msg", "" + validation.minlengthMessage + "");
                                            return false;
                                        }
                                        return true;
                                    }
                                }*/

                                //Maximum message
                                navcon.kendo.maximumValidation(myFields[key], fieldName, validation);
                                /*if (validation.maxlength !== undefined && validation.maxlength !== null && validation.maxlength !== "") {
                                    var messageMin = validation.maxlengthMessage !== undefined && validation.maxlengthMessage !== "" ? validation.maxlengthMessage : "Maximum " + validation.maxlength + " only allowed.";
                                    myFields[fieldName].validation[fieldName.toLowerCase() + "max"] = function (input) {
                                        if (input.is("[name='" + fieldName + "']") && input.val().length > validation.maxlength) {
                                            input.attr("data-" + fieldName.toLowerCase() + "max-msg", "" + validation.maxlengthMessage + "");
                                            return false;
                                        }
                                        return true;
                                    }
                                }*/

                                //Pattern message
                                navcon.kendo.patternValidation(myFields[key], fieldName, validation);
                                /*if (validation.pattern !== undefined && validation.pattern !== null && validation.pattern !== "") {
                                    var patternRegex = new RegExp(validation.pattern.toString());
                                    var messageMin = validation.patternMessage !== undefined && validation.patternMessage !== "" ? validation.patternMessage : "Alpha numeric only allowed.";
                                    myFields[fieldName].validation[fieldName.toLowerCase() + "pattern"] = function (input) {
                                        if (input.is("[name='" + fieldName + "']") && input.val() != "") {
                                            input.attr("data-" + fieldName.toLowerCase() + "pattern-msg", "" + validation.patternMessage + "");
                                            return patternRegex.test(input.val());
                                        }
                                        return true;
                                    }
                                }*/

                                //ExistData message
                                navcon.kendo.existDataValidation(myFields[key], fieldName, validation, scope);
                                /*if (validation.isExistData !== undefined && validation.isExistData !== null && validation.isExistData !== "") {
                                    var scopeData = scope.navconData[validation.isExistData];
                                    var keyOldData = "";
    
                                    var messageMin = validation.isExistMessage !== undefined && validation.isExistMessage !== "" ? validation.isExistMessage : "already exists..";
                                    myFields[fieldName].validation[fieldName.toLowerCase() + "exists"] = function (input) {
                                        if (input.is("[name='" + fieldName + "']") && input.val() != "") {
                                            if (scope.fields.getById !== undefined && scope.fields.getById !== null)
                                                keyOldData = scope.fields.getById[fieldKey];
    
                                            retVal = navcon.getItemByKeyValue(scopeData, fieldKey, input.val().toString().trim());
                                            if (retVal !== -1 && input.val().toString().trim() !== keyOldData.toString().trim()) {
                                                input.attr("data-" + fieldName.toLowerCase() + "exists-msg", "" + validation.isExistMessage + "");
                                                retVal = false;
                                            }
                                            else
                                                retVal = true;
    
                                            return retVal;
                                        }
                                        return true;
                                    }
                                }*/
                            }
                        }
                    }
                });
            }

            return myFields;
        }
    }
}(navcon || {}));
(function (navcon) {
    navcon.kendo.table = {
        distinctData: function (collectionData, distinctField) {
            var filterData = [];
            if (collectionData !== undefined && collectionData !== null && collectionData.length !== 0) {
                $.each(collectionData, function (index, event) {
                    var events = $.grep(filterData, function (e) {
                        return event[distinctField] === e[distinctField];
                    });
                    if (events.length === 0) {
                        filterData.push(event);
                    }
                });
            }
            return filterData;
        },
        filterDropDown: function (element, fieldName, settings) {
            //var dataSource = new kendo.data.DataSource({ data: this.dataS.data().toJSON() });

            var data = navcon.kendo.table.distinctData(settings.data, fieldName);

            element.kendoDropDownList({
                dataSource: {
                    data: data
                },
                group: { field: fieldName },
                serverFiltering: true,
                dataTextField: fieldName,
                dataValueField: fieldName,
                optionLabel: "--Select Value--"
            });
        },
        editDropDown: function (container, options, serviceMethod) {
            //var dataservice = angular.element(document).injector().invoke(function (dataservice) { return dataservice; });

            var fieldId = this.option.id;
            var fieldText = this.option.text;
            var dataSource = this.dataset;

            if (serviceMethod !== undefined && serviceMethod !== null && serviceMethod !== "") {
                return dataservice.getServerData(serviceMethod, '').then(function (returnData) {
                    if (returnData === undefined || returnData === null || returnData.length === 0) return;

                    var data = navcon.kendo.table.distinctData(returnData, fieldId);

                    $('<input required name="' + options.field + '"/>')
                        .appendTo(container)
                        .kendoDropDownList({
                            dataValueField: fieldId,
                            dataTextField: fieldText,
                            dataSource: {
                                type: "odata",
                                data: data,
                                /*transport: {
                                    read: "https://demos.telerik.com/kendo-ui/service/Northwind.svc/Categories"
                                }*/
                            }
                        });
                });
            } else {
                var data = navcon.kendo.table.distinctData(dataSource.data, fieldId);

                $('<input required name="' + options.field + '"/>')
                    .appendTo(container)
                    .kendoDropDownList({
                        dataValueField: fieldId,
                        dataTextField: fieldText,
                        dataSource: {
                            type: "odata",
                            data: data,
                            /*transport: {
                                read: "https://demos.telerik.com/kendo-ui/service/Northwind.svc/Categories"
                            }*/
                        }
                    });
            }
        },
        columnSetting: function (settings, scope) {
            var items = [];
            $.each(settings.columns, function (i, item) {
                item.field = item.data;
                if (item.visible !== undefined && item.visible !== "") item.hidden = !item.visible;

                if (item.type !== undefined && item.type.toLowerCase() === "select") {
                    //item.editor = navcon.kendo.table.editDropDown;
                    item.editor = jQuery.proxy(navcon.kendo.table.editDropDown, { option: { id: item.data, text: item.data }, dataset: settings });

                    item.template = "#=" + item.data + "#";

                    if (item.filterable === undefined || item.filterable) {
                        item.filterable = {
                            cell: {
                                template: function (args) {
                                    args.element.kendoDropDownList({
                                        dataSource: navcon.kendo.table.distinctData(args.dataSource.options.data, item.data),
                                        dataTextField: item.data,
                                        dataValueField: item.data,
                                        valuePrimitive: true,
                                        optionLabel: "--Select " + item.title + "--"
                                    });
                                },
                                showOperators: false,
                                operator: "contains"
                            },
                            ui: function (element) {
                                //navcon.kendo.table.filterDropDown(element, item.data, settings);
                                jQuery.proxy(navcon.kendo.table.filterDropDown, { option: { id: item.data, text: item.data }, dataset: settings });
                            }
                        };
                    }
                } else if (item.type !== undefined && item.type.toLowerCase() === "date") {
                    item.template = "#= kendo.toString(kendo.parseDate(" + item.data + "), '" + navcon.defaultFormat().kdate + "')#";
                    
                    if (item.filterable === undefined || item.filterable) {
                        item.filterable = {
                            cell: {
                                showOperators: false,
                                operator: "contains"
                            },
                            ui: "datetimepicker" // use Kendo UI DateTimePicker
                            //element.kendoDateTimePicker(); // initialize a Kendo UI DateTimePicker
                        };
                    }
                } else if (item.type !== undefined && item.type.toLowerCase() === "autoselect") {
                    if (item.filterable === undefined || item.filterable) {
                        item.filterable = {
                            cell: {
                                inputWidth: "100%",
                                showOperators: true,
                                operator: "contains",
                                suggestionOperator: "contains"
                            }
                        };
                    }
                } else {
                    if (item.type !== undefined && item.type !== "") item.type = "string";
                    if (item.filterable === undefined || item.filterable) {
                        item.filterable = {
                            cell: {
                                operator: "contains",
                                suggestionOperator: "contains"
                            }
                        };
                    }

                    /*item.editor= function (container, options) {
                        var input = $("<input/>");
                        input.attr("name", options.field);
                        input.attr("placeholder", "(optional)");
                        input.appendTo(container);
                    }*/
                }

                if (settings.options !== undefined && settings.options.editable !== undefined && settings.options.editable.enabled !== undefined
                    && !settings.options.editable.enabled && item.command !== undefined && item.command.length !== 0) return false;

                items.push(item);
            });

            return items;
        },
        rowSetting: function (settings, scope) {
            var items = [];
            items = settings.data;

            var fieldsConfig = scope.fields[0];
            var field = { "primaryKey": "Id" };
            var fieldConfigIndex = navcon.getItemIndexByProperty(scope.fields, "fieldConfig");
            if (fieldConfigIndex !== undefined && fieldConfigIndex !== -1) field = scope.fields[fieldConfigIndex];

            var dataSource = new kendo.data.DataSource({
                type: "odata",
                data: items,
                pageSize: settings.pageLength !== undefined ? settings.pageLength : 20,
                batch: true,
                schema: {
                    model: {
                        id: (settings.options !== undefined && settings.options.primaryKey !== undefined ? settings.options.primaryKey : field.primaryKey),
                        fields: navcon.kendo.table.validationSchema(settings, scope),
                    }
                }
            });

            return dataSource;
        },
        setting: function (el, options, scope) {
            var settings = {};
            if (options != undefined && options.options !== undefined) settings = options.options;

            var oTable = null;
            var table = $($(el).find('.kendoGrid')[0]);
            if (table !== undefined && table !== null) {
                //var scope = $(table).scope();

                var oTable = table.kendoGrid({
                    type: $(el).attr("type"),
                    scrollable: {
                        endless: true,
                        virtual: true
                    },
                    height: 600,
                    noRecords: true,
                    autoBind: true,
                    autoFitColumn: true,
                    columns: navcon.kendo.table.columnSetting(options, scope),
                    dataSource: new navcon.kendo.table.rowSetting(options, scope),
                    reorderable: true,
                    resizable: true,
                    sortable: settings.sortable !== undefined ? settings.sortable : true,
                    selectable: settings.selectable !== undefined ? settings.selectable : false,
                    //selectable: "multiple, row"
                    pageable: settings.pageable !== undefined && settings.pageable.enabled !== undefined && settings.pageable.enabled ? settings.pageable.enabled : false,
                    filterable: settings.filterable !== undefined && settings.filterable.enabled !== undefined && settings.filterable.enabled ? settings.filterable.enabled : false,
                    editable: settings.editable !== undefined && settings.editable.enabled !== undefined && settings.editable.enabled ? settings.editable.enabled : false,
                    groupable: settings.groupable !== undefined && settings.groupable.enabled !== undefined && settings.groupable.enabled ? settings.groupable.enabled : false,
                    columnMenu: settings.columnMenu !== undefined && settings.columnMenu.enabled !== undefined && settings.columnMenu.enabled ? settings.columnMenu.enabled : false,
                    dataBound: navcon.kendo.table.dataBound,
                    dataBinding: navcon.kendo.table.dataBinding,
                    sort: navcon.kendo.table.sorting
                }).data("kendoGrid");
            }

            var dataservice = angular.element(document).injector().invoke(function (dataservice) { return dataservice; });
            var logger = angular.element(document).injector().invoke(function (logger) { return logger; });
            //var $timeout = angular.element(document).injector().invoke(function ($timeout) { return $timeout; });
            //$timeout(function () {
            //setTimeout(function () {
            var toolbarOptions = [];

            if (oTable !== undefined && oTable !== null) {
                //Selectable Settings
                if (settings.selectable !== undefined && settings.selectable) {
                    oTable.setOptions({
                        change: navcon.kendo.table.change,
                    });
                }

                //Filter Settings
                if (settings.filterable !== undefined && settings.filterable.enabled !== undefined && settings.filterable.enabled) {
                    oTable.setOptions({
                        filterable: {//CELL FILTERING OPTIONS
                            mode: "row",
                            extra: false, //the filter menu allows the user to input a second criterion.
                            operators: {
                                string: {
                                    eq: "Equal to",
                                    neq: "Not equal to",
                                    contains: "Contains",
                                    startswith: "Starts",
                                    isempty: "Empty"
                                }
                            }
                        },
                        /*dataSource: {
                            serverPaging: true,
                            serverFiltering: true,
                        }*/
                        /*filterable: {//CELL FILTERING OPTIONS
                            mode: "row",
                            //mode: "menu, row",
                            extra: true, //the filter menu allows the user to input a second criterion.
                            messages: {
                                and: "and",
                                or: "or",
                                filter: "Apply filter",
                                clear: "Clear filter",
                                info: "Filter by: ",
                                isFalse: "False",
                                search: "Search category",
                                selectValue: "Select category",
                                cancel: "Reject",
                                selectedItemsFormat: "There are {0} selected items",
                                operator: "Choose operator",
                                value: "Choose value"
                            },
                            operators: {
                                string: {
                                    eq: "Equal to",
                                    neq: "Not equal to",
                                    isnull: "Null",
                                    isnotnull: "Not null",
                                    isempty: "Empty",
                                    isnotempty: "Not empty",
                                    startswith: "Starts",
                                    contains: "Contains",
                                    doesnotcontain: "Doesn't contain",
                                    endswith: "Ends"
                                },
                                number: {
                                    eq: "Equal to",
                                    neq: "Not equal to",
                                    lte: "Less than or equal to",
                                    lt: "Less than",
                                },
                                date: {
                                    gt: "After",
                                    lt: "Before"
                                },
                                enums: {
                                    eq: "Equal to",
                                    neq: "Not equal to"
                                }
                            }
                        }*/
                        filterMenuInit: navcon.kendo.table.filterMenuInit,
                        filter: navcon.kendo.table.filtering
                    });
                }

                //Header menu settings
                if (settings.columnMenu !== undefined && settings.columnMenu.enabled !== undefined && settings.columnMenu.enabled) {
                    oTable.setOptions({
                        columnMenu: {
                            columns: settings.columnMenu.columns !== undefined ? settings.columnMenu.columns : false, //DISABLE COLUMN SELECTION
                            filterable: settings.columnMenu.filterable !== undefined ? settings.columnMenu.filterable : false, //DISABLE COLUMN MENU FILTERING
                            sortable: settings.columnMenu.sortable !== undefined ? settings.columnMenu.sortable : false, //DISABLE COLUMN MENU SORTING
                            /*messages: {
                                columns: "Choose columns",
                                filter: "Apply filter",
                                sortAscending: "Sort (asc)",
                                sortDescending: "Sort (desc)",
                                settings: "Column Options",
                                done: "Ok",
                                lock: "Pin this column",
                                unlock: "Unpin this column"
                            }*/
                        }
                    });
                }

                //Pager settings
                if (settings.pageable !== undefined && settings.pageable.enabled !== undefined && settings.pageable.enabled) {
                    oTable.setOptions({
                        pageable: {
                            refresh: true,
                            alwaysVisible: false,
                            pageSize: settings.pageable.pageLength !== undefined ? settings.pageable.pageLength : 20,
                            previousNext: settings.pageable.previousNext !== undefined ? settings.pageable.previousNext : true,
                            pageSizes: settings.pageable.pageSizes !== undefined ? settings.pageable.pageSizes : [5, 15, 25, "all"],
                            buttonCount: settings.pageable.buttonCount !== undefined ? settings.pageable.buttonCount : 5,
                            numeric: settings.pageable.pageBadge !== undefined ? settings.pageable.pageBadge : true,
                            input: settings.pageable.pageInput !== undefined ? settings.pageable.pageInput : false,
                            info: settings.pageable.info !== undefined ? settings.pageable.info : true,
                            messages: {
                                display: "Showing {0}-{1} from {2} data items",
                                empty: options.emptyTable !== undefined ? options.emptyTable : "No data available in table",
                                page: "Enter page",
                                of: "from {0}",
                                itemsPerPage: "data items per page",
                                first: "First page",
                                last: "Last page",
                                next: "Next page",
                                previous: "Previous page",
                                refresh: "Refresh the grid",
                                morePages: "More pages"
                            }
                        }/*,
                        dataSource: {
                            pageSize: settings.pageable.pageLength !== undefined ? settings.pageable.pageLength : 20,
                        }*/
                    });
                } else {
                    oTable.setOptions({
                        scrollable: {
                            endless: true,
                            virtual: true
                        },
                        pageable: true
                    });
                }

                //Group settings
                if (settings.groupable !== undefined && settings.groupable.enabled !== undefined && settings.groupable.enabled) {
                    oTable.setOptions({
                        groupable: {
                            showFooter: true,
                            messages: {
                                empty: "Drop columns here"
                            }
                        },
                        group: navcon.kendo.table.grouping,
                        groupExpand: navcon.kendo.table.groupExpand,
                        groupCollapse: navcon.kendo.table.groupCollapse
                    });
                }

                //Edit settings
                if (settings.editable !== undefined && settings.editable.enabled !== undefined && settings.editable.enabled) {
                    if (settings.editable.addNew !== undefined && settings.editable.addNew)
                        toolbarOptions.push({ name: "create", text: "Add new" });

                    //$timeout(function () {
                    oTable.setOptions({
                        //toolbar: [{ name: "create", text: "Add new", iconClass: "k-icon k-i-copy" }],
                        //command: [
                        //    { name: "edit", text: { edit: "Edit", update: "Update", cancel: "Cancel" } },
                        //    { name: "destroy", text: "Delete" }
                        //],
                        editable: {
                            mode: settings.editable.mode !== undefined ? settings.editable.mode : "",
                            createAt: settings.editable.createAt !== undefined ? settings.editable.createAt : "bottom", //INSERT NEW DATA ITEMS AT THE BOTTOM {"top","bottom"},
                            update: settings.editable.update !== undefined ? settings.editable.update : true,
                            destroy: settings.editable.delete !== undefined ? settings.editable.delete : true,//DISABLE DELETING
                            confirmation: settings.editable.confirmationInfo !== undefined ? settings.editable.confirmationInfo : false, //DISABLE DELETE CONFIRMATION
                            //template: kendo.template($("#" + $(el).attr("type") + "-editor").html())
                            //template: kendo.template($("#" + $(el).attr("type")).children().html())

                            //template: kendo.template($("#popup-editor").html())
                        },
                        addRow: function (e) {
                            console.log("add row");
                        },
                        edit: function (e) {
                            e.preventDefault();

                            var model = e.model; //reference to the model that is about the be edited
                            var container = e.container; //reference to the editor container
                            var dataSource = this.dataSource;
                            //var event = e.event;

                            if (e.container.data("kendoWindow") !== undefined) e.container.data("kendoWindow").title($(el).attr("type"));

                            var scope = $(e.sender.element).scope()
                            var rowId = model.uid;
                            var selectedRowIndex = navcon.save.selectedRowIndex(dataSource.options.data, { "uid": rowId }, "uid");
                            var selectedData = dataSource.options.data[selectedRowIndex];

                            scope.fields.selectedRow = angular.copy(selectedRowIndex);
                            scope.fields.getById = angular.copy(selectedData);

                            if (model.id !== undefined && model.id !== null && model.id !== "")
                                scope.fields.mode = "Update";
                            else {
                                scope.fields.mode = "Save";
                                container.find(".k-button.k-primary").text("Save");
                            }
                            var approvalColumn = navcon.kendo.table.approvalColumn(scope.tableSettings.columns);

                            container.find("[data-container-for='" + approvalColumn + "']").find(".k-dropdown").hide();
                            container.find("[data-container-for='" + approvalColumn + "']").find("[name='" + approvalColumn + "']").removeAttr("required");
                            
                            //navcon.openModal($(el).attr("type"));

                            console.log("Edit - " + scope.fields.mode);
                        },
                        saveChanges: function (e) {
                            var model = e.model; //reference to the model that is about the be edited
                            var container = e.container; //reference to the editor container
                            var type = $(el).attr("type");
                            console.log("saveChanges");
                        },
                        save: function (e) {
                            e.preventDefault();

                            var model = e.model; //reference to the model that is about the be edited
                            var container = e.container; //reference to the editor container
                            var type = $(el).attr("type");

                            var scope = $(e.sender.element).scope()
                            var rowId = model.uid;
                            //var selectedRowIndex = navcon.save.selectedRowIndex(dataSource.options.data, { "uid": rowId }, "uid");
                            //var selectedData = dataSource.options.data[selectedRowIndex];

                            //if (model.id !== undefined && model.id !== null && model.id !== "")
                            //    scope.fields.mode = "Update";
                            //else
                            //    scope.fields.mode = "Save";

                            navcon.updateFieldsData(scope.fields, model, scope, false);

                            var fieldKeyIndex = navcon.getItemIndexByProperty(scope.fields, scope.fields.primaryKey);
                            if (fieldKeyIndex !== undefined && fieldKeyIndex !== -1 && (scope.fields[fieldKeyIndex].data === null || scope.fields[fieldKeyIndex].data === ""))
                                scope.fields[fieldKeyIndex].data = "0";

                            scope.navconData.save(type, "", function (data) {
                                if (data) {
                                    var msg = "Entries are saved successfully...";
                                    if (scope.navconData !== undefined && scope.items.mode !== undefined && scope.items.mode === "Update")
                                        msg = "Entries are updated successfully...";
                                    if (scope.navconData !== undefined && scope.items.mode !== undefined && scope.items.mode !== "Delete")
                                        logger.success(msg, "", "");

                                    oTable.saveRow();
                                }
                            });

                            console.log("Save");
                        },
                        remove: function (e) {
                            e.preventDefault();

                            var model = e.model; //reference to the model that is about the be edited
                            var container = e.container; //reference to the editor container
                            var dataSource = e.sender.dataSource;
                            var type = $(el).attr("type");

                            var scope = $(e.sender.element).scope()
                            var rowId = model.uid;
                            var selectedRowIndex = navcon.save.selectedRowIndex(dataSource.options.data, { "uid": rowId }, "uid");
                            var selectedData = dataSource.options.data[selectedRowIndex];

                            scope.fields.selectedRow = angular.copy(selectedRowIndex);
                            scope.fields.getById = angular.copy(selectedData);

                            scope.navconData.tableRowDelete(type, type + 'delete', function (data) {
                                if (data) {
                                    logger.success("Entries are deleted successfully...", "", "");

                                    oTable.dataSource.remove(model);
                                    oTable.dataSource.sync();
                                }
                            });
                        },
                        cancel: function (e) {
                            oTable.cancelChanges();
                            console.log("Cancel");
                        }
                    });
                }

                //PDF settings
                if (settings.pdf !== undefined && settings.pdf.enabled !== undefined && settings.pdf.enabled) {
                    toolbarOptions.push({ name: "pdf", text: "Export PDF", iconClass: "k-icon k-i-print" });

                    oTable.setOptions({
                        //toolbar: [{ name: "pdf", text: "Export PDF", iconClass: "k-icon k-i-copy" }],
                        pdf: {
                            allPages: true,
                            avoidLinks: true,
                            paperSize: "A4",
                            margin: { top: "2cm", right: "1cm", bottom: "1cm", left: "1cm" },
                            landscape: true,
                            repeatHeaders: true,
                            fileName: $(el).attr("type") + ".pdf",
                            template: $("#print-template").html(),
                            scale: 0.8
                            /*subject: "Products",
                            title: "Products",
                            fileName: "Products.pdf",
                            keywords: "northwind products",
                            author: "Navcon",
                            creator: "Navcon",
                            avoidLinks: true,
                            date: navcon.getCurrentDate,
                            paperSize: ["20mm", "20mm"],
                            landscape: true,
                            margin: {
                                left: 10,
                                right: "10pt",
                                top: "10mm",
                                bottom: "1in"
                            },
                            forceProxy: true,
                            proxyURL: "/save",
                            proxyTarget: "_blank",*/
                        },
                        pdfExport: function (e) {
                            title = $(el).attr("type");
                            date = navcon.getCurrentDate();

                            oTable.hideColumn(4);

                            e.promise.done(function () {
                                oTable.showColumn(4);
                            });
                        }
                    });
                }

                //Toolbar  options
                if (toolbarOptions !== undefined && toolbarOptions.length !== 0) {
                    //toolbarOptions.push("<p>My string template in a paragraph.</p>");
                    //toolbarOptions.push(kendo.template("<p>My function template.</p>"));
                    //toolbarOptions.push({ template: '<a class="k-button" href="\\#" onclick="return toolbar_click()">Command</a>' });
                    //toolbarOptions.push({ template: kendo.template($("#toolbar-template").html()) }); //toolbar template

                    oTable.setOptions({
                        toolbar: toolbarOptions
                    });

                    if (settings.editable !== undefined && settings.editable.createAt !== undefined && settings.editable.createAt.toLowerCase() === "bottom") {
                        $(".k-grid-toolbar").insertAfter($(".k-grid-pager").length !== 0 ? $(".k-grid-pager") : $(".k-grid-content"));
                    }

                    $(".k-grid-pdf").css("float", "right");
                }

            }

            //cell click 
            $(table).find('tbody').on('click', 'td', function (el, tt) {
                var tableSettings = scope.tableSettings;
                var tr = $(this).closest("tr");

                var tableData = oTable.dataSource.data();
                var rowId = tr.attr("data-uid");
                var selectedRowIndex = navcon.save.selectedRowIndex(tableData, { "uid": rowId }, "uid");

                var rowData = tableData[selectedRowIndex];
                var rowIndex = selectedRowIndex;
                var rowObj = tr;

                var cellData = $(this).text();
                var columnIndex = rowObj.find(this).index();
                var cellObj = this;
                var columnTitle = tableSettings.columns[columnIndex].title;

                //if (scope.navconData.rights !== undefined && ((!scope.navconData.rights.Add && columnTitle === "add") || (!scope.navconData.rights.Edit && columnTitle === "edit")
                //    || ((!scope.navconData.rights.View && !scope.navconData.rights.Approve) && columnTitle === "view") || (!scope.navconData.rights.Delete && columnTitle === "delete"))) return false;

                //if (scope.tableSettings.tableCellClick !== undefined) {
                var approveAnchor = $(this).find("a.gridApprove");
                if (approveAnchor !== undefined && approveAnchor !== null && approveAnchor.length !== 0) {
                    var action = "Approve";
                    if (scope.navconData.tableRowApproveClick === undefined) return;
                    scope.navconData.tableRowApproveClick(rowIndex, columnIndex, rowData, scope.type, this, oTable, action);
                    /*} else {
                        if (scope.navconData.tableCellClick === undefined) return;
                        scope.navconData.tableCellClick(row, column, data, scope.type, this, oTable, undefined, action);*/
                }
                //}
            });

            //});
        },
        detailTemplate: function (arg) {
            //kendo.template($("#detail-template").html())

            console.log("Grid detail Template");
            return {};
        },
        rowTemplate: function (arg) {
            //kendo.template($("#template").html())
            console.log("Grid row Template");
            return {};
        },
        change: function (arg, e) {
            var selected = $.map(this.select(), function (item) {
                return $(item).text();
            });

            console.log("Selected: " + selected.length + " item(s), [" + selected.join(", ") + "]");

            var oTable = null;
            var table = $($(arg.sender.element).parents()[0]).find('.kendoGrid')[0];
            if (table !== undefined && table !== null) var oTable = $(table).data("kendoGrid");

            var scope = $(arg.sender.select()).scope();
            if (scope.navconData.rights !== undefined && ((!scope.navconData.rights.Add && headerTitle === "add") || (!scope.navconData.rights.Edit && headerTitle === "edit")
                || ((!scope.navconData.rights.View && !scope.navconData.rights.Approve) && headerTitle === "view") || (!scope.navconData.rights.Delete && headerTitle === "delete"))) return false;

            $(event.target).addClass("navcon-selected");
            var tr = event.target.closest("tr");
            var data = this.dataItem(event.target.closest("tr"));
            var row = $(tr).index();
            var column = $(event.target.closest("tr")).find(".navcon-selected").index();
            var rowId = $(this.select()).data().uid;
            $(event.target).removeClass("navcon-selected");

            /*var primaryKey = scope.tableSettings.options !== undefined && scope.tableSettings.options.primaryKey !== undefined
                && scope.tableSettings.options.primaryKey !== "" ? scope.tableSettings.options.primaryKey : "id";
            var tableData = arg.sender.dataSource.data();
            var selectedRowIndex = navcon.save.selectedRowIndex(tableData, { "uid": rowId }, "uid");
            var selectedData = tableData[selectedRowIndex];*/

            if ($(arg.sender)[0].type !== "checkbox" && (scope.tableSettings.columnNonclick === undefined || scope.tableSettings.columnNonclick === null || !scope.tableSettings.columnNonclick)) {
                var action = "View";

                if (scope.tableSettings.tableCellClick !== undefined) {
                    var approveAnchor = $(this).find("a.gridApprove");
                    if (approveAnchor !== undefined && approveAnchor !== null && approveAnchor.length !== 0) {
                        action = "Approve";
                        if (scope.tableSettings.tableRowApproveClick === undefined) return;
                        scope.tableSettings.tableRowApproveClick(row, column, data, scope.type, this, oTable, action, rowId);
                    } else {
                        if (scope.tableSettings.tableCellClick === undefined) return;
                        scope.tableSettings.tableCellClick(row, column, data, scope.type, this, oTable, rowId, action);
                    }
                } else {
                    var approveAnchor = $(this).find("a.gridApprove");
                    if (approveAnchor !== undefined && approveAnchor !== null && approveAnchor.length !== 0) {
                        action = "Approve";
                        if (scope.navconData.tableRowApproveClick === undefined) return;
                        scope.navconData.tableRowApproveClick(row, column, data, scope.type, this, oTable, action, rowId);
                    } else {
                        if (scope.navconData.tableCellClick === undefined) return;
                        scope.navconData.tableCellClick(row, column, data, scope.type, this, oTable, rowId, action);
                    }
                }
            }

            //console.log("Grid change");
        },
        detailInit: function (arg) {
            //e.detailCell.text("City: " + e.data.city);

            e.detailRow.find(".grid").kendoGrid({
                //dataSource: e.data.products
            });

            console.log("Grid detail Init");
        },
        dataBinding: function (arg) {
            console.log("Grid data binding");
        },        
        dataBound: function (e) {
            var scope = $(e.sender.element).scope();
            var tableSettings = scope.tableSettings;
            var columns = e.sender.columns;
            var approvalColumn = navcon.kendo.table.approvalColumn(columns);
            var type = scope.type;

            /*Rights based edit and delete button enabled*/
            $(e.sender.element).find(".k-button.k-grid-edit").show();
            $(e.sender.element).find(".k-button.k-grid-delete").show();
            if (scope.navconData !== undefined && scope.navconData.rights !== undefined && scope.navconData.rights !== null) {
                if (scope.navconData.rights.Edit !== undefined && scope.navconData.rights.Edit !== null && scope.navconData.rights.Edit !== null && !scope.navconData.rights.Edit)
                    $(arg.sender.element).find(".k-button.k-grid-edit").hide();

                if (scope.navconData.rights.Delete !== undefined && scope.navconData.rights.Delete !== null && scope.navconData.rights.Delete !== null && !scope.navconData.rights.Delete)
                    $(arg.sender.element).find(".k-button.k-grid-delete").hide();
            }

            /*Grid row*/
            var columnIndex = this.wrapper.find(".k-grid-header [data-field=" + approvalColumn + "]").index();
            var dataItems = e.sender.dataSource.view();
            for (var j = 0; j < dataItems.length; j++) {
                var data = dataItems[j];

                var row = e.sender.tbody.find("[data-uid='" + dataItems[j].uid + "']");
                var cellObj = row.children().eq(columnIndex);

                if (scope.navconData !== undefined && scope.navconData.tableRowUpdate !== undefined)
                    scope.navconData.tableRowUpdate(row, data, j, type, cellObj, scope);

                //ApprovalColumn
                if (columnIndex !== undefined && columnIndex !== "" && columnIndex !== -1) {
                    if (scope.navconData !== undefined && scope.navconData.rights !== undefined && scope.navconData.rights.Approve !== undefined && scope.navconData.rights.Approve) {
                        var item = tableSettings.columns[columnIndex];
                        if (item.approvalColumn !== undefined && item.approvalColumn != null && item.approvalColumn) {
                            //if ($(row).children().length <= columnIndex)
                            //    columnIndex = ($(row).children().length - 1);

                            if (data["SendApproval"] === undefined || (data["SendApproval"] != null && data["SendApproval"])) {
                                var columnText = $(row).children().eq(columnIndex).text();
                                if (columnText !== undefined && columnText !== null && (columnText.toLowerCase() === "active" || columnText.toLowerCase() === "draft" || columnText.toLowerCase() === "pending" || columnText.toLowerCase() === "completed" || columnText === ""))
                                    $(row).children().eq(columnIndex).html('<a class="btn default green btn-xs gridApprove"><i class="fa fa-check"></i>Approve</a>');
                            } else if (data["SendApproval"] === undefined && (data[item.data] === undefined || (data[item.data] != null && data[item.data]))) {
                                var columnText = $(row).children().eq(columnIndex).text();
                                if (columnText !== undefined && columnText !== null && (columnText.toLowerCase() === "active" || columnText.toLowerCase() === "draft" || columnText.toLowerCase() === "pending" || columnText.toLowerCase() === "completed" || columnText === ""))
                                    $(row).children().eq(columnIndex).html('<a class="btn default green btn-xs gridApprove"><i class="fa fa-check"></i>Approve</a>');
                            }
                        }
                    }
                }
                //row.addClass("discontinued");
                //cellObj.addClass(getUnitsInStockClass(units));
            }

            //$(arg.sender.element).find("[data-container-for='StatusName']").find(".k-dropdown").hide();
            //$(arg.sender.element).find("[data-container-for='StatusName']").find("[name='StatusName']").removeAttr("required");

            //this.expandRow(this.tbody.find("tr.k-master-row").first());
            console.log("Grid data bound");
        },
        dataItems: function (arg) {
            console.log("Grid dataItems");
        },
        _displayRow: function (t) {
            console.log("Grid _displayRow");
        },
        _rowsHtml: function (e, t) {
            console.log("Grid _rowsHtml");
        },
        sorting: function (arg) {
            console.log("Sorting on field: " + arg.sort.field + ", direction:" + (arg.sort.dir || "none"));
        },
        filtering: function (arg) {
            //if (arg.filter == null) {
            //    console.log("filter has been cleared");
            //} else {
            //    console.log(arg.filter.logic);
            //    console.log(arg.filter.filters[0].field);
            //    console.log(arg.filter.filters[0].operator);
            //    console.log(arg.filter.filters[0].value);
            //}

            console.log("Filter on " + kendo.stringify(arg.filter));
        },
        filterMenuInit: function () {
            console.log("filter Menu Init");
            /*var popup = e.container.data("kendoPopup");
            popup.bind("open", function(e) {
                //find the dropdownlist in this.element container
                //use the setDataSource to change its DataSource
                //or filter method to filter the current dataSource
            }*/

            // If the filter is for the "Role" column...
            /*if (e.field == "roleTitle") {
                e.container.find("div.k-filter-help-text").text("Select an item from the list:");
                e.container.find("span.k-dropdown:first").css("display", "none");
        
                // Change the text field to a dropdownlist in the Role filter menu.
                var dropDownList = e.container.find(".k-textbox:first")
                    .removeClass("k-textbox")
                    .kendoDropDownList({
                        dataSource: new kendo.data.DataSource({
                            data: [
                                { title: "Software Engineer" },
                                { title: "Quality Assurance Engineer" },
                                { title: "Team Lead" }
                            ]
                        }),
                        dataTextField: "title",
                        dataValueField: "title"
                    }).data("kendoDropDownList");
        
                // Get the FilterMenu object for the roleTitle column.
                // Set the FilterMenu.filterModel.filters[0] to the
                // title of the first item in the dropdownlist.
                _grid.thead.find("th:last")     //roleTitle is the last column 
                    .data("kendoFilterMenu")    // Get the FilterMenu for the last column 
                        .filterModel.filters[0].value = dropDownList.dataSource.data()[0].title;
            }*/
        },
        paging: function (arg) {
            console.log("Paging to page index:" + arg.page);
        },
        grouping: function (arg) {
            console.log("Group on " + kendo.stringify(arg.groups));
        },
        groupExpand: function (arg) {
            console.log("The group to be expanded: " + kendo.stringify(arg.group));
        },
        groupCollapse: function (arg) {
            console.log("The group to be collapsed: " + kendo.stringify(arg.group));
        },
        refresh: function (el, setting, scope) {
            if (setting.data.length === 0) setting.data = [];
            navcon.kendo.table.setting(el, setting, scope);

            //var table = $($(el).find('table')[0]);
            //var tabInst = table.DataTable.fnTables();
            //if ($(tabInst).parents("navcon-table[type='" + $(el).attr("type") + "']").length === 0 || table.children().length === 0) {
            //    navcon.kendo.table.setting(el, setting, scope);
            //    return;
            //}
            //var oTable = table.DataTable();
            //oTable.clear();

            //oTable.rows.add(setting.data).draw();

            //var table = $($(el).find('.kendoGrid')[0]);
            //var grid = table.data("kendoGrid");
            /*var items = navcon.kendo.table.rowSetting(setting.data);
            grid.dataSource.data(items);*/

            //table.find(".k-grid-content").css('max-height', '500px');
            //table.find(".k-filtercell>span[style='width: 100%;']").css("display", "");
            //table.find(".k-filtercell, .k-filtercell .k-widget, .k-filtercell>span[style='width: 100%;']").css("display", "");
        },
        selectedRowIndex: function (table, selectedRow, idColumn) {
            var returnData = -1;
            var tableData = table.data !== undefined ? table.data : table;

            if (tableData !== undefined && tableData.length > 0)
                returnData = navcon.getItemIndexByKeyValue(tableData, idColumn, selectedRow[idColumn]);

            return returnData;
        },
        approvalColumn: function (columns) {
            var objColumn = $.grep(columns, function (v) { return v.approvalColumn === true; });
            var strColumn = ((objColumn.length !== 0 && objColumn[0].data !== undefined) ? objColumn[0].data : "");

            return strColumn;
        },
        dateColumn: function (settings) {
            var objColumn = $.grep(settings.dateFields, function (v) { return v.approvalColumn === true; });
            var strColumn = ((objColumn.length !== 0 && objColumn[0].data !== undefined) ? objColumn[0].data : "");

            return strColumn;
        },
        columnAssign: function (table, columnData, serviceName, columnType) {
            var returnData = "";
            if (serviceName != undefined && serviceName != "") {
                returnData = dataservice.getServerData(serviceName).then(function (data) {
                    if (data === undefined || data.length === 0) return;
                    tableColumnCreate(data, columnType);
                    return data;
                });
            } else {
                tableColumnCreate(columnData, columnType);
            }

            function tableColumnCreate(data, columnType) {
                if (data != undefined) {
                    var columndetails = "", i = 0;

                    for (i = 0; i < data.length; i++) {
                        //var columnIndex = navcon.getItemByKeyValue(table.columnControl.exceptColumns, "index", i);
                        var columnIndex = table.columnControl.exceptColumns.indexOf(i);
                        if (columnIndex !== -1)
                            columndetails += "{\"title\": \"" + data[i].text.trim() + "\", \"data\": \"" + data[i].id + "\", \"width\": \"100px\" },";
                        else
                            columndetails += "{\"title\": \"" + data[i].text.trim() + "\", \"options\" : {\"type\" : \"" + table.columnControl.type + "\", \"dataType\": \"" + columnType + "\"}, \"data\": \"" + data[i].id + "\", \"width\": \"100px\" },";
                        //columndetails += "{\"title\": \"" + data[i].text.trim() + "\", \"data\": \"" + data[i].id + "\", \"field\": \"" + data[i].id + "\", \"width\": \"" + columnIndex.width + "\", \"fieldType\": \"text\" },";
                    }
                    if (columndetails !== "") columndetails = columndetails.substring(0, columndetails.length - 1);

                    table.columns = $.parseJSON("[" + columndetails + "]");
                    //table.columns = navcon.jsonTransformed($.parseJSON("[" + columndetails + "]"));
                }
                return data;
            }
        },        
        manageData: function (columns, items) {
            for (var index in items) {
                var item = items[index];
                for (var p in item) {
                    if (item.hasOwnProperty(p)) {
                        var propVal = item[p];
                        var options = getColumnOptions(columns, p);
                        if (options !== -1) {
                            if (options.type !== undefined) {
                                var retVal = navcon.insertControl(options.type, propVal);
                                item[p] = retVal;
                            }
                        }
                    }
                }
            }

            function getColumnOptions(columns, prop) {
                for (index in columns) {
                    var col = columns[index];
                    if (col.data !== undefined) {
                        if (col.data === prop) {
                            return col.options || -1;
                        }
                    }
                }
                return -1;
            }

            return items;
        },
        pdfExport: function (kendoTable, settings, e) {
            var progress = $.Deferred();

            /*kendo.drawing.drawDOM($("#header"))
              .done(function(header) {
                  kendo.drawing.drawDOM($("#footer"))
                    .done(function(footer) {*/
            kendoTable._drawPDF(progress)
              .then(function (root) {
                  root.children.unshift(header);
                  root.children.push(footer);

                  return kendo.drawing.exportPDF(root, {
                      paperSize: "auto",
                      margin: { left: "1cm", top: "1cm", right: "1cm", bottom: "1cm" },
                      multiPage: true
                  });
              })
              .done(function (dataURI) {
                  //console.log("Okay");
                  kendo.saveAs({
                      dataURI: dataURI,
                      fileName: "navcon.pdf"
                  });
                  progress.resolve();
              })
            /*});
        })*/
        },
        validationSchema: function (settings, scope) {
            var myFields = {};
            var strFields = "";

            $.each(settings.columns, function (i, item) {
                var type = item.type;
                var fieldTitle = item.title;
                var fieldName = item.data;

                var fieldKey = item.fieldKey;
                var field = null;
                var fieldKeyIndex = navcon.getItemIndexByProperty(scope.fields, fieldKey);
                if (fieldKeyIndex !== undefined && fieldKeyIndex !== -1) field = scope.fields[fieldKeyIndex];

                if (fieldName !== undefined && fieldName !== null && fieldName !== "") {
                    myFields[fieldName] = { "validation": {} };

                    if (fieldName !== undefined && fieldName !== null && fieldName !== "" && fieldName.length !== 0) {
                        if (type.toLowerCase() === "autoselect") type = "string";
                        myFields[fieldName].validation["type"] = type;

                        if (field !== undefined && field !== null && field.templateOptions !== undefined && field.templateOptions.length !== 0) {
                            var validation = field.templateOptions;
                            //Required message
                            navcon.kendo.requiredValidation(myFields[fieldName], fieldName, validation);
                            /*if (validation.required !== undefined && validation.required !== null && (validation.required || validation.required.toLowerCase() === "yes")) {
                                if (validation.requiredMessage !== undefined && validation.requiredMessage !== null && validation.requiredMessage !== "")
                                    myFields[fieldName].validation["required"] = { "message": validation.requiredMessage };
                                else
                                    myFields[fieldName].validation["required"] = (validation.required || validation.required.toLowerCase() === "yes" ? true : false);
                            }*/

                            //Minium message
                            navcon.kendo.minimumValidation(myFields[fieldName], fieldName, validation);
                            /*if (validation.minlength !== undefined && validation.minlength !== null && validation.minlength !== "") {
                                var messageMin = validation.minlengthMessage !== undefined && validation.minlengthMessage !== "" ? validation.minlengthMessage : "Minimum " + validation.minlength + " character required.";
                                myFields[fieldName].validation[fieldName.toLowerCase() + "min"] = function (input) {
                                    if (input.is("[name='" + fieldName + "']") && input.val().length < validation.minlength) {
                                        input.attr("data-" + fieldName.toLowerCase() + "min-msg", "" + validation.minlengthMessage + "");
                                        return false;
                                    }
                                    return true;
                                }
                            }*/

                            //Maximum message
                            navcon.kendo.maximumValidation(myFields[fieldName], fieldName, validation);
                            /*if (validation.maxlength !== undefined && validation.maxlength !== null && validation.maxlength !== "") {
                                var messageMin = validation.maxlengthMessage !== undefined && validation.maxlengthMessage !== "" ? validation.maxlengthMessage : "Maximum " + validation.maxlength + " only allowed.";
                                myFields[fieldName].validation[fieldName.toLowerCase() + "max"] = function (input) {
                                    if (input.is("[name='" + fieldName + "']") && input.val().length > validation.maxlength) {
                                        input.attr("data-" + fieldName.toLowerCase() + "max-msg", "" + validation.maxlengthMessage + "");
                                        return false;
                                    }
                                    return true;
                                }
                            }*/

                            //Pattern message
                            navcon.kendo.patternValidation(myFields[fieldName], fieldName, validation);
                            /*if (validation.pattern !== undefined && validation.pattern !== null && validation.pattern !== "") {
                                var patternRegex = new RegExp(validation.pattern.toString());
                                var messageMin = validation.patternMessage !== undefined && validation.patternMessage !== "" ? validation.patternMessage : "Alpha numeric only allowed.";
                                myFields[fieldName].validation[fieldName.toLowerCase() + "pattern"] = function (input) {
                                    if (input.is("[name='" + fieldName + "']") && input.val() != "") {
                                        input.attr("data-" + fieldName.toLowerCase() + "pattern-msg", "" + validation.patternMessage + "");
                                        return patternRegex.test(input.val());
                                    }
                                    return true;
                                }
                            }*/

                            //ExistData message
                            navcon.kendo.existDataValidation(myFields[fieldName], fieldName, validation, scope);
                            /*if (validation.isExistData !== undefined && validation.isExistData !== null && validation.isExistData !== "") {
                                var scopeData = scope.navconData[validation.isExistData];
                                var keyOldData = "";

                                var messageMin = validation.isExistMessage !== undefined && validation.isExistMessage !== "" ? validation.isExistMessage : "already exists..";
                                myFields[fieldName].validation[fieldName.toLowerCase() + "exists"] = function (input) {
                                    if (input.is("[name='" + fieldName + "']") && input.val() != "") {
                                        if (scope.fields.getById !== undefined && scope.fields.getById !== null)
                                            keyOldData = scope.fields.getById[fieldKey];

                                        retVal = navcon.getItemByKeyValue(scopeData, fieldKey, input.val().toString().trim());
                                        if (retVal !== -1 && input.val().toString().trim() !== keyOldData.toString().trim()) {
                                            input.attr("data-" + fieldName.toLowerCase() + "exists-msg", "" + validation.isExistMessage + "");
                                            retVal = false;
                                        }
                                        else
                                            retVal = true;

                                        return retVal;
                                    }
                                    return true;
                                }
                            }*/
                        }
                    }
                }
            });

            return myFields;
        }
    }

    //},1200);
}(navcon || {}));
(function (navcon) {
    navcon.Menuroute = {
        getRoutes: function (ngAuthSettings) {
            var routes = [{
                url: '/login',
                config: {
                    templateUrl: function () {
                        return navcon.Menuroute.getTemplateUrl("login");
                    },
                    caseInsensitiveMatch: false,
                    controller: 'login',
                    controllerAs: 'vm',
                    title: 'login',
                    settings: {
                        nav: 88,
                        icon: 'fa fa-bookmark',
                        content: '</i> Favourite'
                    },
                    resolve: {
                        pageConfig: function (dataservice, $q, $rootScope) {
                            return $q.all(["loginConfig", "navconfieldhtml"].map(function (d) {
                                if (d == "navconfieldhtml" && $rootScope.fieldTemplate == undefined) {
                                    var environment = ngAuthSettings.environment;
                                    var prodPath = "start/";
                                    //var appPath = (environment === "production") ? prodPath + "navconFieldTemplate.html" : "ext-modules/navconField/navconFieldTemplate.html";
                                    var appPath = (environment === "production") ? prodPath + "navconFieldTemplate.html" : "start/navconFieldTemplate.html";
                                    return dataservice.getServerHtmlData(appPath).then(function (res) {
                                        var htmlObj = $('<html></html>');
                                        htmlObj.html(res.data);
                                        $rootScope.fieldTemplate = htmlObj;
                                        return;
                                    });
                                } else if (d == "navconfieldhtml" && $rootScope.fieldTemplate != undefined) {
                                    return;
                                } else {
                                    return dataservice.getServerData(d).then(function (data) {
                                        return navcon.jsonTransformed(data);
                                    });
                                }

                            }));
                        }
                    }
                }
            },
                {
                    url: '/404',
                    config: {
                        //templateUrl: 'app/404/404.html'
                        templateUrl: function () {
                            return navcon.Menuroute.getTemplateUrl("404");
                        },
                    }
                },
                {
                    url: '/dashboard',
                    config: {
                        templateUrl: function () {
                            return navcon.Menuroute.getTemplateUrl("dashboard");
                        },
                        title: 'My space',
                        display: false,
                        settings: {
                            nav: 12,
                            content: '<i class="fa fa-edit"></i> My space'
                        },
                        controller: function ($scope, pageConfig) {
                            $scope.pageConfig = pageConfig;
                        },
                        controllerAs: 'vm',
                        resolve: {
                            pageConfig: function (dataservice, $q) {
                                return null;
                            }
                        }
                    }
                },
                {
                    url: '/usermanagement',
                    config: {
                        //templateUrl: 'app/usermanagement/usermanagement.html',
                        templateUrl: function () {
                            return navcon.Menuroute.getTemplateUrl("usermanagement");
                        },
                        controller: 'usermanagement',
                        controllerAs: 'vm',
                        title: 'User Management',
                        display: false,
                        settings: {
                            nav: 12,
                            content: '<i class="fa fa-hand-o-up"></i> User Management'
                        },
                        resolve: {
                            pageConfig: function (dataservice) {
                                return dataservice.getServerData("userManagementConfig").then(function (data) {
                                    return navcon.jsonTransformed(data);
                                });
                            }
                        },
                        authorize: true
                    }
                },
                {
                    url: '/rolemanagement',
                    config: {
                        //templateUrl: 'app/rolemanagement/rolemanagement.html',
                        templateUrl: function () {
                            return navcon.Menuroute.getTemplateUrl("rolemanagement");
                        },
                        controller: 'rolemanagement',
                        controllerAs: 'vm',
                        title: 'Role Management',
                        display: false,
                        settings: {
                            nav: 12,
                            content: '<i class="fa fa-group"></i> Role Management'
                        },
                        resolve: {
                            pageConfig: function (dataservice) {
                                return dataservice.getServerData("roleManagementConfig").then(function (data) {
                                    return navcon.jsonTransformed(data);
                                });
                            }
                        },
                        authorize: false
                    }
                },
                {
                    url: '/useraccessrights',
                    config: {
                        //templateUrl: 'app/useraccessrights/useraccessrights.html',
                        templateUrl: function () {
                            return navcon.Menuroute.getTemplateUrl("useraccessrights");
                        },
                        controller: 'useraccessrights',
                        controllerAs: 'vm',
                        title: 'Security',
                        display: false,
                        settings: {
                            nav: 12,
                            content: '<i class="fa fa-book"></i> Security'
                        },
                        resolve: {
                            pageConfig: function (dataservice) {
                                return dataservice.getServerData("useraccessrightsConfig").then(function (data) {
                                    return navcon.jsonTransformed(data);
                                });
                            }
                        },
                        authorize: true
                    }
                },
                {
                    url: '/notificationsetup',
                    config: {
                        //templateUrl: 'app/notificationsetup/notificationsetup.html',
                        templateUrl: function () {
                            return navcon.Menuroute.getTemplateUrl("notificationsetup");
                        },
                        controller: 'notificationsetup',
                        controllerAs: 'vm',
                        title: 'Notification Setup',
                        display: false,
                        settings: {
                            nav: 12,
                            content: '<i class="fa fa-hand-o-up"></i> Notification Setup'
                        },
                        resolve: {
                            pageConfig: function (dataservice) {
                                return dataservice.getServerData("notificationSetupConfig").then(function (data) {
                                    return navcon.jsonTransformed(data);
                                });
                            }
                        },
                        authorize: true
                    }
                },
                {
                    url: '/notifications',
                    config: {
                        //templateUrl: 'app/notifications/notifications.html',
                        templateUrl: function () {
                            return navcon.Menuroute.getTemplateUrl("notifications");
                        },
                        controller: 'notifications',
                        controllerAs: 'vm',
                        title: 'Notifications',
                        display: false,
                        settings: {
                            nav: 12,
                            content: '<i class="fa fa-hand-o-up"></i> Notifications'
                        },
                        resolve: {
                            pageConfig: function (dataservice) {
                                return dataservice.getServerData("notificationsConfig").then(function (data) {
                                    return navcon.jsonTransformed(data);
                                });
                            }
                        },
                        authorize: true
                    }
                },
                {
                    url: '/userimport',
                    config: {
                        //templateUrl: 'app/userimport/userimport.html',
                        templateUrl: function () {
                            return navcon.Menuroute.getTemplateUrl("userimport");
                        },
                        controller: 'userimport',
                        controllerAs: 'vm',
                        title: 'User Import',
                        display: false,
                        settings: {
                            nav: 12,
                            content: '<i class="fa fa-hand-o-up"></i> User Import'
                        },
                        resolve: {
                            pageConfig: function (dataservice) {
                                return dataservice.getServerData("userImportConfig").then(function (data) {
                                    return navcon.jsonTransformed(data);
                                });
                            }
                        },
                        authorize: true
                    }
                },
                {
                    url: '/userprofile',
                    config: {
                        //templateUrl: 'app/userprofile/userprofile.html',
                        templateUrl: function () {
                            return navcon.Menuroute.getTemplateUrl("userprofile");
                        },
                        controller: 'userprofile',
                        controllerAs: 'vm',
                        title: 'User Profile',
                        display: true,
                        settings: {
                            nav: 12,
                            content: '<i class="fa fa-hand-o-up"></i> User Profile'
                        },
                        resolve: {
                            pageConfig: function (dataservice, authService, $q) {
                                return dataservice.getServerData("userProfileConfig").then(function (data) {
                                    return navcon.jsonTransformed(data);
                                });
                            }
                        },
                        authorize: true
                    }
                },
                {
                    url: '/changepassword',
                    config: {
                        //templateUrl: 'app/changepassword/changepassword.html',
                        templateUrl: function () {
                            return navcon.Menuroute.getTemplateUrl("changepassword");
                        },
                        controller: 'changepassword',
                        controllerAs: 'vm',
                        title: 'Change Password',
                        display: true,
                        settings: {
                            nav: 12,
                            content: '<i class="fa fa-hand-o-up"></i> Change Password'
                        },
                        resolve: {
                            pageConfig: function (dataservice, authService, $q) {
                                return $q.all(["changePasswordConfig", "userRegistrationId"].map(function (d) {
                                    if (d === "userRegistrationId") {
                                        return dataservice.getServerData(d, authService.authentication.userId).then(function (data) {
                                            return data;
                                        });
                                    } else {
                                        return dataservice.getServerData(d).then(function (data) {
                                            return navcon.jsonTransformed(data);
                                        });
                                    }
                                }));
                            }
                        },
                        authorize: true
                    }
                },
                {
                    url: '/directives',
                    config: {
                        //templateUrl: 'app/tiles/tiles.html',
                        templateUrl: function () {
                            return navcon.Menuroute.getTemplateUrl("tiles");
                        },
                        title: 'Directives',
                        controller: 'tiles',
                        controllerAs: 'vm',
                        display: true,
                        settings: {
                            nav: 4,
                            icon: 'fa fa-pencil-square-o',
                            content: '</i> Directives'
                        }
                    }
                },
                {
                    url: '/news',
                    config: {
                        //templateUrl: 'app/news/news.html',
                        templateUrl: function () {
                            return navcon.Menuroute.getTemplateUrl("news");
                        },
                        display: true,
                        controller: 'news',
                        controllerAs: 'vm',
                        title: 'news',
                        settings: {
                            nav: 1,
                            icon: 'fa fa-dashboard',
                            content: '</i> News Announcements'
                        },
                        resolve: {
                            pageConfig: function (dataservice) {
                                return dataservice.getServerData("newsAnnouncementsConfig").then(function (data) {
                                    return navcon.jsonTransformed(data);
                                });
                            }
                        },
                        authorize: true
                    }
                }
            ];
            return routes;

        },
        getTemplateUrl: function (path) {
            var environment = navcon.getApplicationEnvironment();
            var version = navcon.getApplicationVersion();
            var cacheBust = (new Date()).getTime();
            if (environment === "production")
                cacheBust = version.split('.').join(''); //version;
            var returnUrl = "";
            path = path.toLowerCase();

            var templateAppPath = (environment === "production") ? "/templates/app/" : "app/";
            var templateExtPath = (environment === "production") ? "/templates/ext-modules/" : "ext-modules/";

            if (path === "dashboard") {
                returnUrl = templateAppPath + 'dashboard/dashboardTemplate.html';
            } else if (path === "404") {
                returnUrl = templateAppPath + '404/404.html';
            } else if (path === "usermanagement") {
                returnUrl = templateAppPath + 'usermanagement/usermanagement.html';
            } else if (path === "rolemanagement") {
                returnUrl = templateAppPath + 'rolemanagement/rolemanagement.html';
            } else if (path === "useraccessrights") {
                returnUrl = templateAppPath + 'useraccessrights/useraccessrights.html';
            } else if (path === "userprofile") {
                returnUrl = templateAppPath + 'userprofile/userprofile.html';
            } else if (path === "changepassword") {
                returnUrl = templateAppPath + 'changepassword/changepassword.html';
            } else if (path === "photouploader") {
                returnUrl = templateAppPath + 'photo/egPhotoUploader.html';
            } else if (path === "navconchart") {
                returnUrl = templateAppPath + 'widgets/navconChart/navconChartTemplate.html';
                //} else if (path === "navcondashboard") {
                //    returnUrl = templateExtPath + 'navconDashboard/navconDashboardTemplate.html';
                //} else if (path === "navconwidgetbody") {
                //    returnUrl = templateExtPath + 'navconDashboard/navconWidgetBodyTemplate.html';
                //} else if (path === "navcondelete") {
                //    returnUrl = templateExtPath + 'navconDelete/navconDeleteTemplate.html';
                //} else if (path === "navconevaluation") {
                //    returnUrl = templateExtPath + 'navconEvaluation/navconEvaluationTemplate.html';
            } else if (path === "navconform") {
                returnUrl = templateExtPath + 'navconForm/navconFormTemplate.html';
            } else if (path === "navconframework") {
                returnUrl = templateExtPath + 'navconFramework/navconFrameworkTemplate.html';
            } else if (path === "navconuserprofile") {
                returnUrl = templateExtPath + 'navconFramework/navconUserProfile/navconUserProfileTemplate.html';
            } else if (path === "navconuserprofilesmall") {
                returnUrl = templateExtPath + 'navconFramework/navconUserProfile/navconUserProfileSmallTemplate.html';
            } else if (path === "navconmenu") {
                returnUrl = templateExtPath + 'navconMenu/navconMenuTemplate.html';
            } else if (path === "navconmenugroup") {
                returnUrl = templateExtPath + 'navconMenu/navconMenuGroupTemplate.html';
            } else if (path === "navconmenuitem") {
                returnUrl = templateExtPath + 'navconMenu/navconMenuItemTemplate.html';
            } else if (path === "navconmodal") {
                returnUrl = templateExtPath + 'navconModal/navconModalTemplate.html';
            } else if (path === "navconpagebar") {
                returnUrl = templateExtPath + 'navconPagebar/navconPagebarTemplate.html';
            } else if (path === "navconportlet") {
                returnUrl = templateExtPath + 'navconPortlet/navconPortletTemplate.html';
            } else if (path === "navconrating") {
                returnUrl = templateExtPath + 'navconRating/navconRatingTemplate.html';
            } else if (path === "navconreport") {
                returnUrl = templateExtPath + 'navconReport/navconReportTemplate.html';
            } else if (path === "navconreportpage") {
                returnUrl = templateExtPath + 'navconReport/navconReportPageTemplate.html';
            } else if (path === "navcontable") {
                returnUrl = templateExtPath + 'navconTable/navconTableTemplate.html';
            } else if (path === "navcontableeditor") {
                returnUrl = templateExtPath + 'navconTableEditor/navconTableEditorTemplate.html';
            } else if (path === "navcontree") {
                returnUrl = templateExtPath + 'navconTree/navconTreeTemplate.html';
            } else if (path === "navconfileupload") {
                returnUrl = templateExtPath + 'navconUpload/navconFileUploadTemplate.html';
            } else if (path === "navconphotoupload") {
                returnUrl = templateExtPath + 'navconUpload/navconPhotoUploadTemplate.html';

            } else if (path === "navconkendotemplate") {
                returnUrl = templateExtPath + 'navconKendo/navconKendoTemplate.html';
            } else if (path === "navconkendotable") {
                returnUrl = templateExtPath + 'navconKendo/navconKendoTable.html';
            } else if (path === "navconkendoschedule") {
                returnUrl = templateExtPath + 'navconKendo/navconKendoSchedule.html';

            } else if (path === "login") {
                returnUrl = templateAppPath + 'login/login.html';
            }

            if (environment !== "production") returnUrl + "?v=" + cacheBust;
            return returnUrl;
        }
    };
}(navcon || {}));
(function (navcon) {
    navcon.save = {
        selectedRowIndex: function (table, selectedRow, idColumn) {
            var returnData = -1;
            var tableData = table.data !== undefined ? table.data : table;

            if (tableData !== undefined && tableData.length > 0)
                returnData = navcon.getItemIndexByKeyValue(tableData, idColumn, selectedRow[idColumn]);

            return returnData;
        },
        loadListDefaultData: function (data, fields) {
            $.map(fields, function (item, key) {
                if (item.type.toLowerCase() === "select" || item.type.toLowerCase() === "autocomplete" || item.type.toLowerCase() === "multiselect" || item.type.toLowerCase() === "multiselectcheckbox"
                    || item.type.toLowerCase() === "tab" || item.type.toLowerCase() === "listview") {
                    var defaultField = item.selectOptions.item.defaultField;
                    if (defaultField !== undefined && defaultField !== "") {
                        if (data[defaultField] !== undefined && data[defaultField] !== null && data[defaultField] !== "")
                            item.selectOptions.items = angular.copy(navcon.getDistinctfromJSON(data[defaultField], item.selectOptions.item.dataField));
                    }
                }
                else if (item.type.toLowerCase() === "radio") {
                    if (item.templateOptions.item !== undefined && item.templateOptions.item !== null) {
                        var defaultField = item.templateOptions.item.defaultField;
                        if (defaultField !== undefined && defaultField !== "") {
                            if (data[defaultField] !== undefined && data[defaultField] !== null && data[defaultField] !== "")
                                item.templateOptions.items = angular.copy(data[defaultField]);
                        }
                    }

                }
                else if (item.type.toLowerCase() === "checkboxlist" || item.type.toLowerCase() === "groupcheckboxlist") {
                    if (item.templateOptions.item !== undefined && item.templateOptions.item !== null) {
                        var defaultField = item.templateOptions.item.defaultField;
                        if (defaultField !== undefined && defaultField !== "") {
                            if (data[defaultField] !== undefined && data[defaultField] !== null && data[defaultField] !== "")
                                item.data = angular.copy(data[defaultField]);
                        }
                    }

                }
            });
        },
        loadListSingleData: function (data, fields, key) {
            var keyIndex = navcon.getItemIndexByProperty(fields, key);
            var item = fields[keyIndex];
            if (keyIndex !== -1 && item !== undefined) {
                if (item.type.toLowerCase() === "select" || item.type.toLowerCase() === "autocomplete" || item.type.toLowerCase() === "multiselect" || item.type.toLowerCase() === "multiselectcheckbox"
                    || item.type.toLowerCase() === "tab" || item.type.toLowerCase() === "listview") {
                    var defaultField = item.selectOptions.item.defaultField;
                    if (defaultField !== undefined && defaultField !== "") {
                        if (data[defaultField] !== undefined && data[defaultField] !== null && data[defaultField] !== "")
                            item.selectOptions.items = angular.copy(data[defaultField]);
                    }
                }
            }
        },
        tableColumnAssign: function (table, columnData, serviceName) {
            var returnData = "";
            if (serviceName != undefined && serviceName != "") {
                returnData = dataservice.getServerData(serviceName).then(function (data) {
                    if (data === undefined || data.length === 0) return;
                    tableColumnCreate(data);
                    return data;
                });
            } else {
                tableColumnCreate(columnData);
            }

            function tableColumnCreate(data) {
                if (data != undefined) {
                    var columndetails = "", i = 0;

                    for (i = 0; i < data.length; i++) {
                        //var columnIndex = navcon.getItemByKeyValue(table.columnControl.exceptColumns, "index", i);
                        var columnIndex = table.columnControl.exceptColumns.indexOf(i);
                        if (columnIndex !== -1)
                            columndetails += "{\"title\": \"" + data[i].text.trim() + "\", \"data\": \"" + data[i].id + "\", \"width\": \"100px\" },";
                        else
                            columndetails += "{\"title\": \"" + data[i].text.trim() + "\", \"options\" : {\"type\" : \"" + table.columnControl.type + "\"}, \"data\": \"" + data[i].id + "\", \"width\": \"100px\" },";
                        //columndetails += "{\"title\": \"" + data[i].text.trim() + "\", \"data\": \"" + data[i].id + "\", \"field\": \"" + data[i].id + "\", \"width\": \"" + columnIndex.width + "\", \"fieldType\": \"text\" },";
                    }
                    if (columndetails !== "") columndetails = columndetails.substring(0, columndetails.length - 1);

                    table.columns = $.parseJSON("[" + columndetails + "]");
                    //table.columns = navcon.jsonTransformed($.parseJSON("[" + columndetails + "]"));
                }
                return data;
            }
        },
        addNewOption: function (scope, configFields, fields, displayTitle, treeTable, callback, type) {
            var retData = canceldata();
            if (callback !== undefined && $.isFunction(callback))
                callback(retData);

            return retData;

            function canceldata() {
                var returnData = "";
                navcon.clearFieldsData(fields);
                navcon.updateFieldsData(fields, configFields, scope, false);
                returnData = 'Add ( ' + displayTitle + " )";

                if (treeTable !== undefined && treeTable !== "" && treeTable.length > 0) {
                    navcon.clearTreeData(treeTable);
                }

                if (type !== undefined && type !== "") {
                    if (type !== false) {
                        if (!$("#" + type).hasClass('in')) {
                            navcon.openModal(type, function (val) {
                                navcon.setFieldFocus(fields);
                            });
                        }
                    }
                } else {
                    setTimeout(function () {
                        scope.$apply();
                        navcon.setFieldFocus(fields);
                    }, 500);
                }

                return returnData;
            }
        },
        optionType: function (optional, callback) {
            if (optional === undefined || optional === {}) return true;
            navcon.save.saveOption(optional.scope, optional.dataservice, optional.mode, optional.type,
                optional.table, optional.fields, optional.rowNumber,
                optional.idColumn, optional.displayColumn, optional.treeTable, optional.upload, optional.popup, optional.type,
                function (data) {
                    callback(data);
                });
        },
        tableAction: function (optional, callback) {
            if (optional === undefined || optional === {}) return true;

            //optional{"scope":"", "type":"", fields:"", table:"", rowNumber:"", primaryColumn:"", displayColumn:"", popup:"", upload:""};
            if (optional.fields.mode === undefined || optional.fields.mode === null || optional.fields.mode === "") return;
            var returnData = "";
            if (optional.fields.mode.toUpperCase() === "SAVE" || optional.fields.mode.toUpperCase() === "SAVEAS"
                || optional.fields.mode.toUpperCase() === "UPDATE" || optional.fields.mode.toUpperCase() === "DELETE") {

                if (optional.dataAssign !== undefined && optional.dataAssign !== "" && optional.dataAssign.length > 0) {
                    $.map(optional.dataAssign, function (item, key) {
                        var mainIndex = navcon.getItemIndexByProperty(item[0][0], item[0][1]);
                        var childIndex = navcon.getItemIndexByProperty(optional.fields, item[1][0]);
                        if (item[0][2] !== undefined && item[0][2] !== null) {
                            optional.fields[childIndex].data = (item[0][0][mainIndex].data[item[0][2]] !== undefined ? item[0][0][mainIndex].data[item[0][2]] : item[0][0][mainIndex].data);
                        } else if (mainIndex !== undefined && mainIndex !== null && mainIndex !== -1 && childIndex !== -1) {
                            optional.fields[childIndex].data = item[0][0][mainIndex].data;
                        } else if ((mainIndex === undefined || mainIndex === null || mainIndex === -1) && childIndex !== -1) {
                            optional.fields[childIndex].data = item[0][0];
                        }
                    });
                }

                var addedItem = navcon.getFieldsDataToSave(optional.fields, optional.fields.mode, optional.idColumn, optional.upload);

                if (optional.fields.mode.toUpperCase() === "SAVE" || optional.fields.mode.toUpperCase() === "SAVEAS") {
                    addedItem[optional.primaryColumn] = (parseInt(optional.table.data.length) - 100);
                    if (addedItem.ObjectState !== undefined && (addedItem.ObjectState === "0" || addedItem.ObjectState === "")) addedItem.ObjectState = 1;
                    if (addedItem.Status !== undefined && (addedItem.Status === "0" || addedItem.Status === "")) addedItem.Status = 0;

                    if (addedItem !== undefined && addedItem !== null && optional.table !== undefined && optional.table !== null)
                        optional.table.data.push(addedItem);
                } else if (optional.fields.mode.toUpperCase() === "UPDATE") {
                    if (addedItem.ObjectState !== undefined && (addedItem.ObjectState === 0 || addedItem.ObjectState === "0" || addedItem.ObjectState === "")) addedItem.ObjectState = 2;
                    if (addedItem.Status !== undefined && (addedItem.Status === "0" || addedItem.Status === "")) addedItem.Status = 0;

                    var index = navcon.getItemIndexByKeyValue(optional.table.data, optional.primaryColumn, addedItem[optional.primaryColumn]);
                    if (index !== -1 && optional.table !== undefined && optional.table !== null) {
                        optional.table.data.splice(index, 1, addedItem);
                    }
                } else if (optional.fields.mode.toUpperCase() === "DELETE") {
                    //navcon.deleteDataList(optional.table, optional.fields.selectedRow);
                    navcon.openModal(optional.type + "delete");

                    if (callback !== undefined) callback(addedItem);

                    return addedItem;
                }

                if (optional.fields !== undefined && optional.fields !== "") navcon.clearFieldsData(optional.fields);
                if (optional.popup === undefined || optional.popup === "" || optional.popup === false) navcon.closeModal(optional.type);

                if (callback !== undefined) callback(addedItem);

                return addedItem;
            } else if (optional.fields.mode.toUpperCase() === "DELETED") {
                navcon.deleteDataList(optional.table, optional.fields.selectedRow);
                //optional.table.data.splice(optional.fields.selectedRow, 1);

                navcon.closeModal(optional.type + "delete");
                navcon.closeModal(optional.type);

                if (callback !== undefined) callback(addedItem);

                return addedItem;
            } else if (optional.fields.mode.toUpperCase() === "TABLESAVE") {
                var returnData = [];
                var tableData = optional.table.data !== undefined && optional.table.data !== null ? optional.table.data : [];
                var tableOldData = optional.table.oldData !== undefined && optional.table.oldData !== null ? optional.table.oldData : [];

                if (tableData !== undefined && tableData !== null && tableData.length !== 0) {
                    for (var i = 0; i < tableData.length; i++) {
                        if (tableData[i][tableData[i].Check_Field] !== undefined && (tableData[i][tableData[i].Check_Field] === 1 || tableData[i][tableData[i].Check_Field] === true)) {
                            if (tableData[i][optional.primaryColumn] !== undefined && tableData[i][optional.primaryColumn] !== null && tableData[i][optional.primaryColumn].toString() !== "0") {
                                tableData[i]["ObjectState"] = 2;
                                tableData[i]["Status"] = 0;
                            } else {
                                tableData[i]["ObjectState"] = 1;
                                tableData[i]["Status"] = 0;
                            }

                            if (optional.saveDataInclude !== undefined && optional.saveDataInclude.length !== 0 && optional.saveDataInclude !== "")
                                $.extend(true, tableData[i], optional.saveDataInclude);

                            returnData.push(tableData[i]);
                        } else if (optional.noCheckedData) {
                            if (optional.saveDataInclude !== undefined && optional.saveDataInclude.length !== 0 && optional.saveDataInclude !== "")
                                $.extend(true, tableData[i], optional.saveDataInclude);

                            returnData.push(tableData[i]);
                        }
                    }

                    if (returnData.length > 0 && optional.dataservice !== undefined && optional.dataservice !== null && optional.dataservice !== "") {
                        returnData = optional.dataservice.postServerData(optional.type + optional.saveType, returnData).then(function (data) {
                            if (optional.assignTable !== undefined && optional.assignTable !== null && optional.assignTable !== "") {
                                optional.assignTable.data = [];
                                optional.assignTable.data = (typeof data === "object" && data.length !== 0 ? data : []);
                            }

                            if (callback !== undefined) callback(typeof data === "object" && data.length !== 0 ? data : []);
                        });
                    } else if (returnData.length > 0) {
                        if (callback !== undefined) callback(returnData);
                    }
                }

                if ($("#" + optional.type).data('modal') && $("#" + optional.type).data('modal').isShown) navcon.closeModal(optional.type);
            } else if (optional.fields.mode.toUpperCase() === "FINAL") {
                var jsondata = [];

                var tableData = optional.table.data !== undefined && optional.table.data !== null ? optional.table.data : [];
                var tableOldData = optional.table.oldData !== undefined && optional.table.oldData !== null ? optional.table.oldData : [];

                var tableData = navcon.insertDeleteditems(tableData, tableOldData, optional.primaryColumn, "table");
                for (var i = 0; i < tableData.length; i++) {
                    if (tableData[i][optional.primaryColumn] > 0) {
                        if (tableData[i].ObjectState === undefined || tableData[i].ObjectState.toString() === "0") tableData[i].ObjectState = 2;
                        if (tableData[i].Status === undefined || tableData[i].Status.toString() === "0") tableData[i].Status = 0;
                    } else {
                        if (tableData[i].ObjectState === undefined || tableData[i].ObjectState.toString() === "0") tableData[i].ObjectState = 1;
                        if (tableData[i].Status === undefined || tableData[i].Status.toString() === "0") tableData[i].Status = 0;
                    }
                }

                if (tableData.length > 0 && optional.dataservice !== undefined && optional.dataservice !== null && optional.dataservice !== "") {
                    if (optional.saveType.toLowerCase() === "update" || optional.saveType.toLowerCase() === "updateall") {
                        returnData = optional.dataservice.putServerData(optional.type + optional.saveType, tableData).then(function (data) {
                            optional.table.data = [];
                            optional.table.data = data;

                            if (callback !== undefined) callback(data);
                        });
                    } else {
                        returnData = optional.dataservice.postServerData(optional.type + optional.saveType, tableData).then(function (data) {
                            optional.table.data = [];
                            optional.table.data = data;

                            if (callback !== undefined) callback(data);
                        });
                    }
                } else if (tableData !== undefined) {
                    if (callback !== undefined) callback(tableData);
                }
            }
        },
        saveOption: function (scope, dataservice, mode, type, table, fields, rowNumber, idColumn, displayColumn, treeTable, upload, popup, saveType, callback) {
            if (mode === undefined || mode === "") return;
            var returnData = "";
            if (mode.toUpperCase() === "SAVE" || mode.toUpperCase() === "SAVEAS" || mode.toUpperCase() === "UPDATE") { //Form Data update
                var addedItem = navcon.getFieldsDataToSave(fields, mode, idColumn, upload);

                if (mode.toUpperCase() === "SAVE" || mode.toUpperCase() === "SAVEAS") {
                    if (addedItem.ObjectState !== undefined && (addedItem.ObjectState === "0" || addedItem.ObjectState === "")) addedItem.ObjectState = 1;
                    if (addedItem.Status !== undefined && (addedItem.Status === "0" || addedItem.Status === "")) addedItem.Status = 0;

                    if (saveType === undefined || saveType === "") saveType = type;
                    returnData = dataservice.postServerData(saveType + mode + (fields.page !== undefined ? "/" + fields.page : ""), addedItem).then(function (data) {
                        if (upload !== undefined && upload !== "" && upload) {
                            if (data != undefined) {
                                var collectData = data;
                               /* var fileData = {
                                    file  : addedItem["filesUpload"]
                                }*/

                               

                                var formData = addedItem["filesUpload"];
                                delete addedItem["filesUpload"];
                                var dataInfo = {
                                    folder: type || saveType,  // Page Name
                                    id: data[idColumn]   // Primary Key
                                };
                                if (formData != undefined && formData != null) {
                                    formData.append("data", JSON.stringify(dataInfo));
                                    dataservice.fileUpload(formData).then(function (uploadData) {
                                        if (uploadData !== undefined && uploadData.Files !== undefined && uploadData.Files.length !== 0) {
                                            if (collectData.DocumentName !== undefined) collectData.DocumentName = uploadData.Files[0].name;
                                            if (collectData.Documents !== undefined) collectData.Documents = uploadData.Files;
                                            if (collectData["fuattachments"] === undefined || collectData["fuattachments"] === null || collectData["fuattachments"] === "") collectData["fuattachments"] = [];

                                            $.each(uploadData.Files, function (index, value) {
                                                collectData["fuattachments"].push(value);
                                            })
                                            
                                            var retData = refreshSavedData(collectData);
                                            closePopup(collectData);
                                            if (callback !== undefined)
                                                callback(collectData);
                                        }
                                        else {
                                            var retData = refreshSavedData(collectData);
                                            closePopup(collectData);
                                            if (callback !== undefined)
                                                callback(collectData);
                                        }


                                    });
                                }
                                else {
                                    if (callback !== undefined)
                                        callback(collectData);
                                }
                            }
                        } else {
                            var retData = refreshSavedData(data);
                            closePopup(data);
                            if (callback !== undefined)
                                callback(retData);
                        }
                    });

                    function refreshSavedData(data) {
                        //if (data.TableData !== undefined && data.TableData !== null) {
                        //    if (data.TableData.length > 0) {
                        //        if (data.TableData[0].$ref != undefined)
                        //            table.data.push(data);
                        //        else
                        //            table.data.push(data.TableData[0]);
                        //    }
                        //    else if (data.TableData.$ref != undefined)
                        //        table.data.push(data);
                        //    else
                        //        table.data.push(data.TableData);
                        //}
                        if (data !== undefined && data !== null && table !== undefined && table !== null && table !== "") {
                            if (table.data == undefined) {
                                table.data = [];
                            }
                            table.data.push(data);
                        }
                        return data;
                    }

                }
                else if (mode.toUpperCase() === "UPDATE") {
                    if (addedItem.ObjectState !== undefined && (addedItem.ObjectState === 0 || addedItem.ObjectState === "0" || addedItem.ObjectState === "")) addedItem.ObjectState = 2;
                    if (addedItem.Status !== undefined && (addedItem.Status === "0" || addedItem.Status === "")) addedItem.Status = 0;

                    if (saveType === undefined || saveType === "") saveType = type;
                    returnData = dataservice.putServerData(saveType + mode, addedItem).then(function (data) {
                        //if (popup !== undefined && popup === false) return;
                        if (upload !== undefined && upload !== "" && upload) {
                            if (data != undefined) {
                                var collectData = data;
                                var formData = addedItem["filesUpload"];
                                if (formData == undefined) {
                                    formData = new FormData();
                                }
                                delete addedItem["filesUpload"];
                                var dataInfo = {
                                    folder: type || saveType,  // Page Name
                                    id: data[idColumn]   // Primary Key
                                };
                                formData.append("data", JSON.stringify(dataInfo));
                                dataservice.fileUpload(formData).then(function (uploadData) {
                                    if (uploadData !== undefined && uploadData.Files !== undefined && uploadData.Files.length !== 0) {
                                        if (collectData.DocumentName !== undefined) collectData.DocumentName = uploadData.Files[0].name;
                                        if (collectData.Documents !== undefined) collectData.Documents = uploadData.Files;
                                        if (collectData["fuattachments"] === undefined || collectData["fuattachments"] === null || collectData["fuattachments"] === "") collectData["fuattachments"] = [];
                                        $.each(uploadData.Files, function (index, value) {
                                            collectData["fuattachments"].push(value);
                                        })
                                        closePopup(collectData);
                                        if (callback !== undefined)
                                            callback(collectData);
                                    }
                                    else {
                                        closePopup(collectData);
                                        if (callback !== undefined)
                                            callback(collectData);
                                    }
                                    //var retData = refreshSavedData(collectData);

                                });
                            }
                        }
                        else {

                            // var retData = refreshSavedData(data);
                            closePopup(data);

                            if (callback !== undefined)
                                callback(data);
                            else
                                return data;
                        }
                    });

                    function refreshSavedData(data) {
                        //if (data.TableData !== undefined && data.TableData !== null) {
                        //    if (data.TableData.length > 0) {
                        //        if (data.TableData[0].$ref != undefined)
                        //            table.data.push(data);
                        //        else
                        //            table.data.push(data.TableData[0]);
                        //    }
                        //    else if (data.TableData.$ref != undefined)
                        //        table.data.push(data);
                        //    else
                        //        table.data.push(data.TableData);
                        //}
                        if (data !== undefined && data !== null && table !== undefined && table !== null && table !== "") {
                            if (table.data == undefined) {
                                table.data = [];
                            }
                            table.data.push(data);
                        }
                        return data;
                    }
                }

                function closePopup(data) {
                    if (data === undefined) return;
                    if (popup !== undefined && popup !== "" && popup === false) return;

                    var idColumnIndex = navcon.getItemIndexByProperty(fields, idColumn);
                    if (idColumnIndex !== undefined && idColumnIndex !== -1) {
                        var primaryKey = idColumn;
                        if (fields[idColumnIndex].alternatekey !== undefined && fields[idColumnIndex].alternatekey !== "")
                            primaryKey = fields[idColumnIndex].alternatekey;
                        else {
                            if (fields[idColumnIndex].id !== undefined)
                                primaryKey = fields[idColumnIndex].id;
                            else
                                primaryKey = fields[idColumnIndex].key;
                        }

                        if (table !== undefined && table !== null && data !== undefined && table !== "" && table.data != undefined && data !== null) {
                            var index = -1;
                            index = navcon.getItemIndexByKeyValue(table.data, primaryKey, data[primaryKey]);
                            if (index !== -1) {
                                //table.data.splice(index, 1);
                                //table.data.push(data);

                                table.data.splice(index, 1, data);
                            }
                        }
                    }

                    if (treeTable !== undefined && treeTable !== "" && treeTable.length > 0) {
                        navcon.clearTreeData(treeTable);
                    }
                    if (idColumnIndex != -1)
                        navcon.clearFieldsData(fields);
                    navcon.closeModal(type);
                }


            }
            else if (mode.toUpperCase() === "OK") { //OK Button update
                var addedItem = navcon.getFieldsDataToSave(fields, mode, idColumn);

                var index = navcon.getItemIndexByKeyValue(table.data, idColumn, addedItem[idColumn]);
                if (index > -1) {
                    if (addedItem.ObjectState !== undefined) addedItem.ObjectState = 2;
                    if (addedItem.Status !== undefined) addedItem.Status = 0;

                    table.data.splice(index, 1);
                    if (addedItem !== undefined)
                        table.data.push(addedItem);
                }
                else {
                    if (addedItem.ObjectState !== undefined) addedItem.ObjectState = 1;
                    if (addedItem.Status !== undefined) addedItem.Status = 0;

                    addedItem[idColumn] = parseFloat(addedItem[idColumn]) + 1;
                    table.data.push(addedItem);
                }
                //navcon.clearTableData(type, updateFields)
                //updateFields.data=table.data;

                navcon.closeModal(type);
                return table.data;
            }
            else if (mode.toUpperCase() === "DELETE") { //Delete Modal Open
                var currentTableItem = navcon.getFieldsDataToSave(fields, mode, idColumn);
                //var currentTableItem = table.data[rowNumber];

                if (displayColumn.indexOf(".") > 0)
                    returnData = "Delete ( " + currentTableItem[displayColumn.split('.')[0]][displayColumn.split('.')[1]] + " )";
                else
                    returnData = "Delete ( " + currentTableItem[displayColumn] + " )";

                for (var key in fields) {
                    var field = fields[key];
                    field.disabled = true;
                }

                type = type + "delete";
                navcon.openModal(type);

                if (callback !== undefined) callback(returnData);
            }
            else if (mode.toUpperCase() === "PRINT") { //PRINT Modal Open
                returnData = "";
            }

            return returnData;
        },
        viewOption: function (scope, action, type, table, fields, selectedRow, idColumn, displayColumn, dataservice, directCall, callback, addtionalId, popup, directUrl) { //View form 
            if (directCall !== undefined && directCall) {
                if (directUrl === undefined || directUrl === "")
                    url = type + '/GetById';
                else
                    url = directUrl;

                var data = dataservice.getData(url + "/" + selectedRow[idColumn] + (addtionalId != undefined && addtionalId != "" ? "/" + addtionalId : "")).then(function (data) {
                    var retData = updatedata(data);
                    if (callback !== undefined)
                        callback(retData);
                });
            }
            else {
                var currentTableItem = navcon.getItemByKeyValue(table.data, idColumn, selectedRow[idColumn]);
                var retData = updatedata(currentTableItem);
                if (callback !== undefined)
                    callback(retData);
                else
                    return retData;
            }
            function updatedata(currentTableItem) {
                var returnData = "";
                if (currentTableItem !== -1) {
                    if (displayColumn.indexOf(".") > 0)
                        returnData = action.substr(0, 1).toUpperCase() + action.substr(1) + " ( " + currentTableItem[displayColumn.split('.')[0]][displayColumn.split('.')[1]] + " )";
                    else
                        returnData = action.substr(0, 1).toUpperCase() + action.substr(1) + " ( " + currentTableItem[displayColumn] + " )";
                }
                else if (selectedRow.data !== undefined) {
                    returnData = action.substr(0, 1).toUpperCase() + action.substr(1) + " ( " + selectedRow.data[displayColumn] + ")";

                    currentTableItem = selectedRow.data;
                }

                var isDisabled = false;
                if (action.toUpperCase() !== "EDIT" && action.toUpperCase() !== "MANAGE") isDisabled = true;

                navcon.updateFieldsData(fields, currentTableItem, scope, isDisabled, scope.vm);
                navcon.setViewContentDisabled(action);

                fields.getById = currentTableItem;

                if (type.toLowerCase() === "approval") return returnData;


                if (popup !== undefined && popup !== null && popup !== "") {
                    if (popup !== false) {
                        navcon.openModal(popup, function (val) {
                            if (action.toUpperCase() === "EDIT")
                                navcon.setFieldFocus(fields);
                        });
                    }
                } else {
                    navcon.openModal(type, function (val) {
                        if (action.toUpperCase() === "EDIT")
                            navcon.setFieldFocus(fields);
                    });
                }
                return returnData;
            }
        },
        deleteOption: function (dataservice, type, table, RowNumber, primaryKey, saveType, callback, isTableRemove) { //Delete event update
            var returnData = "";
            if (saveType === undefined || saveType === "") saveType = type;

            returnData = dataservice.deleteServerData(saveType + 'Delete', table.data[RowNumber][primaryKey]).then(function (data) {
                if (data !== undefined) {
                    if (isTableRemove !== undefined && isTableRemove !== null && isTableRemove == false)
                        //navcon.deleteDataList(table, RowNumber);
                        console.log("no table delete");
                    else
                        navcon.deleteDataList(table, RowNumber);
                }
                closeModal(data);

                if (callback !== undefined) {
                    callback(data);
                } else {
                    return data;
                }
            });

            function closeModal(data) {
                if ($("#" + type + "delete").data('modal') && $("#" + type + "delete").data('modal').isShown) navcon.closeModal(type + "delete");
                if ($("#" + type).data('modal') && $("#" + type).data('modal').isShown) navcon.closeModal(type);
            }

            //return returnData;
        },
        treeView: function (scope, action, type, table, fields, displayColumn, idColumn, dataservice, directCall, callback) {
            if (directCall !== undefined && directCall) {
                var data = dataservice.getData(type + '/GetById/' + table.data[idColumn]).then(function (data) {
                    var retData = updatedata(data);
                    if (callback !== undefined)
                        callback(retData);
                    else
                        return retData;
                    //return data;
                });
            } else {
                var currentTableItem = table.data;// navcon.getItemByKeyValue(table.data, idColumn, table.data[idColumn]);
                return updatedata(currentTableItem);
            }
            function updatedata(currentTableItem) {
                var returnData = "";

                if (currentTableItem.data !== undefined && currentTableItem.data[displayColumn] !== undefined)
                    returnData = action.substr(0, 1).toUpperCase() + action.substr(1) + " ( " + currentTableItem.data[displayColumn] + " )";
                else
                    returnData = action.substr(0, 1).toUpperCase() + action.substr(1) + " ( " + currentTableItem[displayColumn] + " )";

                var isDisabled = false;
                if (action.toUpperCase() !== "EDIT" && action.toUpperCase() !== "MANAGE") isDisabled = true;

                navcon.clearFieldsData(fields, scope);
                navcon.updateFieldsData(fields, currentTableItem, scope, isDisabled, scope.vm);
                navcon.setViewContentDisabled(action);

                fields.getById = currentTableItem;

                navcon.openModal(type, function (val) {
                    navcon.setFieldFocus(fields);
                });

                return returnData;
            }
        },
        treeDeleteAction: function (dataservice, type, currentNode, idColumn, callback, hasParentRemove) { //Tree delee
            var returnData = "";
            var currentId = "0";
            if (currentNode.data[idColumn] !== undefined)
                currentId = currentNode.data[idColumn];
            else
                currentId = currentNode[idColumn];

            returnData = dataservice.deleteServerData(type + "Delete", currentId).then(function (data) {
                if (data !== undefined)
                    navcon.removeTreeNode(type, currentNode, "", hasParentRemove);
                closeModal(data);

                if (callback !== undefined) {
                    callback(data);
                } else {
                    return data;
                }
            });

            function closeModal(data) {
                navcon.closeModal(type + "delete");
                if ($("#" + type).data('modal') && $("#" + type).data('modal').isShown) navcon.closeModal(type);
            }

            //return returnData;
        },
        treeAction: function (scope, dataservice, action, type, fields, currentNode, assignNode, idColumn, displayColumn, treeData, popup, callback) { //Tree data save
            if (fields === undefined) {
            }

            var position = "";
            if (position === undefined || position === '') position = 'last';

            //var item = navcon.getFieldsData(fields);
            var item = navcon.getFieldsDataToSave(fields, action, idColumn);
            if (assignNode !== null) {
                for (var key in assignNode.data) {
                    if (item.hasOwnProperty(key)) assignNode.data[key] = item[key];
                }

                if (assignNode.text !== undefined) assignNode.text = item[displayColumn];


                if (action.toUpperCase() === "SAVE" || action.toUpperCase() === "SAVEAS") {

                    if (assignNode.data.ParentId !== undefined) assignNode.data.ParentId = currentNode.data.id;
                    if (assignNode.data.LevelId !== undefined) assignNode.data.LevelId = parseFloat(currentNode.data.LevelId) + 1;
                    if (assignNode.data.SeqNo !== undefined) assignNode.data.SeqNo = (currentNode.data.id !== "" ? currentNode.children.length : currentNode.data.SeqNo) + 1;
                    if (assignNode.data.ObjectState !== undefined && (assignNode.data.ObjectState === "0" || assignNode.data.ObjectState === "")) assignNode.data.ObjectState = 1;
                    if (assignNode.data.Status !== undefined && (assignNode.data.Status === "0" || assignNode.data.Status === "")) assignNode.data.Status = 0;

                    returnData = dataservice.postServerData(type + action, assignNode.data).then(function (data) {
                        if (assignNode.StatusName === undefined && data.StatusName !== undefined && data.StatusName !== null) assignNode.StatusName = data.StatusName;
                        if (assignNode.data.StatusName === undefined && data.StatusName !== undefined && data.StatusName !== null) assignNode.data.StatusName = data.StatusName;

                        //return data;
                        assignNode.id = data.id;
                        assignNode.data.id = data.id;

                        if (currentNode === undefined || currentNode.data === undefined || currentNode.data.id === "" || currentNode.data.id === "-1" || currentNode.data.id === "0")
                            currentNode = { "id": "#" };

                        var data = assignNode.data;
                        navcon.createTreeNode(type, currentNode, assignNode, position);
                        assignNode.data = data;

                        //navcon.closeModal(type);
                        if (callback !== undefined)
                            callback(assignNode)
                        else
                            return assignNode;
                    });
                }
                else if (action.toUpperCase() === "UPDATE") {

                    if (assignNode.data.id !== undefined) assignNode.data.id = currentNode.data.id;
                    if (assignNode.data.ParentId !== undefined) assignNode.data.ParentId = currentNode.data.ParentId;
                    if (assignNode.data.LevelId !== undefined) assignNode.data.LevelId = currentNode.data.LevelId;
                    if (assignNode.data.SeqNo !== undefined) assignNode.data.SeqNo = currentNode.data.SeqNo;
                    if (assignNode.data.ObjectState !== undefined && (assignNode.data.ObjectState === "0" || assignNode.data.ObjectState === "")) assignNode.data.ObjectState = 2;
                    if (assignNode.data.Status !== undefined && (assignNode.data.Status === "0" || assignNode.data.Status === "")) assignNode.data.Status = 0;

                    returnData = dataservice.putServerData(type + action, assignNode.data).then(function (data) {
                        if (assignNode.StatusName === undefined && data.StatusName !== undefined && data.StatusName !== null) assignNode.StatusName = data.StatusName;
                        if (assignNode.data.StatusName === undefined && data.StatusName !== undefined && data.StatusName !== null) assignNode.data.StatusName = data.StatusName;

                        navcon.editTreeNode(type, currentNode, assignNode.text);
                        if (assignNode !== undefined && data.id !== undefined) {
                            assignNode.id = data.id;
                            assignNode.data.id = data.id;

                            var nodeChildren = navcon.getItemByKeyValue(treeData, "id", data.id);
                            if (nodeChildren !== -1) assignNode.children = nodeChildren.children;

                            var jsonData = [assignNode];
                            if (treeData !== undefined) navcon.updateTreeNode(type, treeData, jsonData)
                        }

                        //navcon.closeModal(type);
                        if (callback !== undefined)
                            callback(currentNode)
                        else
                            return currentNode;
                    });
                }
                else if (action.toUpperCase() === "DELETE") {
                    if (currentNode.data[displayColumn] !== undefined)
                        returnData = action + " ( " + currentNode.data[displayColumn] + " )";
                    else
                        returnData = action + " ( " + currentNode[displayColumn] + " )";

                    for (var key in fields) {
                        var field = fields[key];
                        field.disabled = true;
                    }

                    type = type + "delete";
                    navcon.openModal(type);
                    return treeData;
                }

                if ((popup !== undefined && popup !== "" && popup === false) || action.toUpperCase() === "DELETE") return;
                navcon.closeModal(type);
            }
            else {
                if (action.toUpperCase() === "SAVE" || action.toUpperCase() === "SAVEAS")
                    dataservice.postServerData(type + action, item).then(function (data) {
                        if (callback !== undefined)
                            callback(data);
                    });
                else if (action.toUpperCase() === "UPDATE")
                    dataservice.putServerData(type + action, item).then(function (data) {
                        if (callback !== undefined)
                            callback(data);
                    });
                else if (action.toUpperCase() === "DELETE")
                    dataservice.putServerData(type + action, item).then(function (data) {
                        if (callback !== undefined)
                            callback(data);
                    });
            }
        }
    };
}(navcon || {}));
(function (navcon) {
    navcon.route = {
        API: {
            aboutUsConfig: 'Generic/GetPageConfiguration?Page=administration&type=aboutUsConfig',

            /*Login*/
            loginConfig: 'Generic/GetPageConfiguration?Page=login&type=loginConfig',
            loginAll: 'login/GetALL',
            loginId: 'login/Get',
            loginSave: 'login/Create',
            loginUpdate: 'login/Update',
            /*Login*/

            /*user Profile*/
            userProfileConfig: 'Generic/GetPageConfiguration?Page=administration&type=userprofileConfig',
            userProfileId: 'myProfile/GetById',
            userProfileUpdate: 'myProfile/Update',

            /*Change Password*/
            changePasswordConfig: 'Generic/GetPageConfiguration?Page=administration&type=changePasswordConfig',
            changePasswordUpdate: 'myProfile/ChangePassword',
            /*Change Password*/

            /*User Management*/
            userManagementConfig: 'Generic/GetPageConfiguration?Page=administration&type=userManagementConfig',
            userManagementAll: 'userManagement/GetALL',
            userManagementId: 'userManagement/GetById',
            userManagementSave: 'userManagement/Create',
            userManagementUpdate: 'userManagement/Update',
            userManagementDelete: 'userManagement/DeleteById',
            userManagementGetDeptByLocationId: 'myProfile/GetDepartmentByLocationId',
            userManagementGetSecQn: 'userManagement/GetSecQuestion',
            forgotPasswordSave: 'userManagement/ForgotPassword',
            /*User Management*/

            /*master Configuration*/
            masterConfigurationConfig: 'Generic/GetPageConfiguration?Page=masterdata&type=masterdataConfig',
            masterConfigurationAll: 'Configuration/GetALL',
            masterConfigurationId: 'Configuration/GetById/',
            ConfigurationSave: 'Configuration/Create',
            ConfigurationUpdate: 'Configuration/Update',
            ConfigurationDelete: 'Configuration/DeleteById',
            /*master Configuration*/
            
            /*Notifications*/
            notificationsConfig: 'Generic/GetPageConfiguration?Page=administration&type=notificationsConfig',
            notificationsAll: 'Security/GetAllNotifications',
            notificationsUpdate: 'MySpace/AllNotification/Update',
            notificationsUpdateAll: 'MySpace/AllNotification/UpdateAll',

            /*Notification Setup*/
            notificationSetupConfig: 'Generic/GetPageConfiguration?Page=administration&type=notificationSetupConfig',
            notificationSetupAll: 'notificationSetup/GetALL',
            notificationSetupUpdate: 'notificationSetup/Update',
            notificationSetupTestMail: 'notificationSetup/TestMail',
            notificationSetupTestSMS: 'notificationSetup/TestSMS',

            /*Role Management*/
            roleManagementConfig: 'Generic/GetPageConfiguration?Page=administration&type=roleManagementConfig',
            roleManagementAll: 'roleManagement/GetALL',
            roleManagementId: 'roleManagement/GetById',
            roleManagementSave: 'roleManagement/Create',
            roleManagementUpdate: 'roleManagement/Update',
            roleManagementDelete: 'roleManagement/DeleteById',
            /*Role Management*/

            noConfig: '/'
        },
        UI: function (serviceBase, type, rowId) {
            var apiEndUrl = navcon.route.API;
            var returnData = serviceBase;

            /*Login*/
            if (type.toUpperCase() === "LOGINCONFIG") returnData += apiEndUrl.loginConfig;
            else if (type.toUpperCase() === "LOGINALL") returnData += apiEndUrl.loginAll;
            else if (type.toUpperCase() === "LOGINID") returnData += apiEndUrl.loginId;
            else if (type.toUpperCase() === "LOGINSAVE") returnData += apiEndUrl.loginSave;
            else if (type.toUpperCase() === "LOGINUPDATE") returnData += apiEndUrl.loginUpdate;

                /*User Management*/
            else if (type.toUpperCase() === "USERMANAGEMENTCONFIG") returnData += apiEndUrl.userManagementConfig;
            else if (type.toUpperCase() === "USERMANAGEMENTALL") returnData += apiEndUrl.userManagementAll;
            else if (type.toUpperCase() === "USERMANAGEMENTID") returnData += apiEndUrl.userManagementId;
            else if (type.toUpperCase() === "USERMANAGEMENTSAVE") returnData += apiEndUrl.userManagementSave;
            else if (type.toUpperCase() === "USERMANAGEMENTUPDATE") returnData += apiEndUrl.userManagementUpdate;
            else if (type.toUpperCase() === "USERMANAGEMENTDELETE") returnData += apiEndUrl.userManagementDelete;
            else if (type.toUpperCase() === "USERMANAGEMENTGETDEPTBYLOCATIONID") returnData += apiEndUrl.userManagementGetDeptByLocationId;
            else if (type.toUpperCase() === "USERMANAGEMENTGETSECQN") returnData += apiEndUrl.userManagementGetSecQn;
            else if (type.toUpperCase() === "FORGOTPASSWORDSAVE") returnData += apiEndUrl.forgotPasswordSave;


                /*Master Configuration*/
            else if (type.toUpperCase() === "MASTERCONFIGURATIONCONFIG") returnData += apiEndUrl.masterConfigurationConfig;
            else if (type.toUpperCase() === "MASTERCONFIGURATIONALL") returnData += apiEndUrl.masterConfigurationAll;
            else if (type.toUpperCase() === "MASTERCONFIGURATIONID") returnData += apiEndUrl.masterConfigurationId;
            else if (type.toUpperCase() === "CONFIGURATIONSAVE") returnData += apiEndUrl.ConfigurationSave;
            else if (type.toUpperCase() === "CONFIGURATIONUPDATE") returnData += apiEndUrl.ConfigurationUpdate;
            else if (type.toUpperCase() === "CONFIGURATIONDELETE") returnData += apiEndUrl.ConfigurationDelete;
                
                /*Notifications*/
            else if (type.toUpperCase() === "NOTIFICATIONSCONFIG") returnData += apiEndUrl.notificationsConfig;
            else if (type.toUpperCase() === "NOTIFICATIONSALL") returnData += apiEndUrl.notificationsAll;
            else if (type.toUpperCase() === "NOTIFICATIONSUPDATE") returnData += apiEndUrl.notificationsUpdate;
            else if (type.toUpperCase() === "NOTIFICATIONSUPDATEALL") returnData += apiEndUrl.notificationsUpdateAll;

                /*Notification Setup*/
            else if (type.toUpperCase() === "NOTIFICATIONSETUPCONFIG") returnData += apiEndUrl.notificationSetupConfig;
            else if (type.toUpperCase() === "NOTIFICATIONSETUPALL") returnData += apiEndUrl.notificationSetupAll;
            else if (type.toUpperCase() === "NOTIFICATIONSETUPUPDATE") returnData += apiEndUrl.notificationSetupUpdate;
            else if (type.toUpperCase() === "NOTIFICATIONSETUPTESTMAIL") returnData += apiEndUrl.notificationSetupTestMail;
            else if (type.toUpperCase() === "NOTIFICATIONSETUPTESTSMS") returnData += apiEndUrl.notificationSetupTestSMS;
                
                /*User Profile*/
            else if (type.toUpperCase() === "USERPROFILECONFIG") returnData += apiEndUrl.userProfileConfig;
            else if (type.toUpperCase() === "USERPROFILEID") returnData += apiEndUrl.userProfileId;
            else if (type.toUpperCase() === "USERPROFILEUPDATE") returnData += apiEndUrl.userProfileUpdate;

                /*Change Password*/
            else if (type.toUpperCase() === "CHANGEPASSWORDCONFIG") returnData += apiEndUrl.changePasswordConfig;
            else if (type.toUpperCase() === "CHANGEPASSWORDUPDATE") returnData += apiEndUrl.changePasswordUpdate;


            /*Notification Management*/
            if (type.toUpperCase() === "NOTIFICATIONMASTERCONFIG") returnData += apiEndUrl.notificationmasterConfig;
            if (type.toUpperCase() === "NOTIFICATIONMANAGEMENTALL") returnData += apiEndUrl.NotificationManagementAll;
            if (type.toUpperCase() === "NOTIFICATIONMASTERID") returnData += apiEndUrl.notificationmasterId;
            // if (type.toUpperCase() === "NOTIFICATIONMASTERSAVE") returnData += apiEndUrl.NEWSANNOUNCEMENTSSAVE;
            if (type.toUpperCase() === "NOTIFICATIONMASTERUPDATE") returnData += apiEndUrl.notificationmasterUpdate;
            if (type.toUpperCase() === "NOTIFICATIONMASTERDELETE") returnData += apiEndUrl.notificationmasterDelete;
                
                /*Role Management*/
            else if (type.toUpperCase() === "ROLEMANAGEMENTCONFIG") returnData += apiEndUrl.roleManagementConfig;
            else if (type.toUpperCase() === "ROLEMANAGEMENTALL") returnData += apiEndUrl.roleManagementAll;
            else if (type.toUpperCase() === "ROLEMANAGEMENTID") returnData += apiEndUrl.roleManagementId;
            else if (type.toUpperCase() === "ROLEMANAGEMENTSAVE") returnData += apiEndUrl.roleManagementSave;
            else if (type.toUpperCase() === "ROLEMANAGEMENTUPDATE") returnData += apiEndUrl.roleManagementUpdate;
            else if (type.toUpperCase() === "ROLEMANAGEMENTDELETE") returnData += apiEndUrl.roleManagementDelete;

            if (type.toUpperCase() === "CONTRIBUTINGFACTORSCHECKLISTCONFIG")
                returnData += ((rowId !== undefined && rowId !== "") ? +rowId : "");
            else returnData += ((rowId !== undefined && rowId !== "") ? "/" + rowId : "");

            return returnData;
        }
    };
}(navcon || {}));
(function () {
    'use strict';
    var core = angular.module('app.core').run(function ($rootScope, $http, ngAuthSettings) {
        //$rootScope.test = new Date();

        var environment = ngAuthSettings.environment;
        var prodPath = "start/";
        //var appPath = (environment === "production") ? prodPath + "navconFieldTemplate.html" : "ext-modules/navconField/navconFieldTemplate.html";
        var appPath = (environment === "production") ? prodPath + "navconFieldTemplate.html" : "start/navconFieldTemplate.html";

        $http.get(appPath).then(function (res) {
            var htmlObj = $('<html></html>');
            htmlObj.html(res.data);
            $rootScope.fieldTemplate = htmlObj;
        });
        
    });
   // core.config(toastrConfig);

    /* @ngInject */
    function toastrConfig(toastr) {
        toastr.options.timeOut = 4000;
        toastr.options.positionClass = 'toast-bottom-right';
    }

    var config = {
        appErrorPrefix: '[SafeTal-Modular Error] ', //Configure the exceptionHandler decorator
        appTitle: 'RMS',
        version: '1.0.0'
    };

    core.value('config', config);

    core.config(configure);
    
    /* @ngInject */
    function configure($logProvider, $routeProvider, routehelperConfigProvider, exceptionHandlerProvider) {

       
        
        // turn debugging off/on (no info or warn)
        if ($logProvider.debugEnabled) {
            $logProvider.debugEnabled(true);
        }

        // Configure the common route provider
        routehelperConfigProvider.config.$routeProvider = $routeProvider;
        routehelperConfigProvider.config.docTitle = 'NG-Modular: ';
        var resolveAlways = { /* @ngInject */
            ready: function (dataservice) {
                return dataservice.ready();
            }
        };
        routehelperConfigProvider.config.resolveAlways = resolveAlways;

        // Configure the common exception handler
        exceptionHandlerProvider.configure(config.appErrorPrefix);
    }
})();
var chartData = (function () {

    var chartData = [];

    function wrap(text, width) {
        text.each(function () {
            var text = d3.select(this),
                words = text.text().split(/\s+/).reverse(),
                word,
                line = [],
                lineNumber = 0,
                lineHeight = 1.1, // ems
                y = text.attr("y"),
                dy = parseFloat(text.attr("dy")),
                tspan = text.text(null).append("tspan").attr("x", 0).attr("y", y).attr("dy", dy + "em");
            while (word = words.pop()) {
                line.push(word);
                tspan.text(line.join(" "));
                if (tspan.node().getComputedTextLength() > width) {
                    line.pop();
                    tspan.text(line.join(" "));
                    line = [word];
                    tspan = text.append("tspan").attr("x", 0).attr("y", y).attr("dy", ++lineNumber * lineHeight + dy + "em").text(word);
                }
            }
        });
    }

    function type(d) {
        d.value = +d.value;
        return d;
    }

    var chartData = [];
    var chart = {};

    chart = {
        "chart": {
            "paletteColors": "#7e6f6a,#36afb2,#9c6db2",
            "bgColor": "#ffffff",
            "showBorder": "0",
            "showCanvasBorder": "0",
            "usePlotGradientColor": "0",
            "plotBorderAlpha": "10",
            "legendBorderAlpha": "0",
            "legendBgAlpha": "0",
            "legendShadow": "0",
            "showHoverEffect": "1",
            "valueFontColor": "#000",
            "rotateValues": "1",
            "placeValuesInside": "1",
            "divlineColor": "#999999",
            "divLineIsDashed": "1",
            "divLineDashLen": "1",
            "divLineGapLen": "1",
            "canvasBgColor": "#ffffff",
            "canvasBgAlpha": "30",
            "captionFontSize": "14",
            "subcaptionFontSize": "14",
            "subcaptionFontBold": "0",
            "legendItemFontSize":"12"
        },
        "events": {
            "chartMousemove": function (eventObj, dataObj) {
                alert($(".chartToolTip").html());
            }
        },
        "categories": [
            {
                "category": [
                    {
                        "label": "January"
                    },
                    {
                        "label": "February"
                    },
                    {
                        "label": "March"
                    },
                    {
                        "label": "April"
                    },
                    {
                        "label": "May"
                    },
                    {
                        "label": "June"
                    },
                    {
                        "label": "July"
                    },
                    {
                        "label": "August"
                    },
                    {
                        "label": "September"
                    }
                ]
            }
        ],
        "dataset": [
            {
                "seriesname": "Managed",
                "data": [
                   {
                       "value": 2
                   },
                   {
                       "value": 4
                   },
                   {
                       "value": 13
                   },
                   {
                       "value": 4
                   },
                   {
                       "value": 8
                   },
                   {
                       "value": 6
                   },
                   {
                       "value": 5
                   },
                   {
                       "value": 9
                   },
                   {
                       "value": 9
                   }
                ]
            },
            {
                "seriesname": "Closed",
                "data": [
                   {
                       "value": 6
                   },
                   {
                       "value": 7
                   },
                   {
                       "value": 6
                   },
                   {
                       "value": 1
                   },
                   {
                       "value": 9
                   },
                   {
                       "value": 7
                   },
                   {
                       "value": 5
                   },
                   {
                       "value": 3
                   },
                   {
                       "value": 2
                   }
                ]
            },
            {
                "seriesname": "Open",
                "data": [
                    {
                        "value": null
                    },
                    {
                        "value": null
                    },
                    {
                        "value": null
                    },
                    {
                        "value": null
                    },
                    {
                        "value": null
                    },
                    {
                        "value": null
                    },
                    {
                        "value": null
                    },
                    {
                        "value": null
                    },
                    {
                        "value": 3
                    }
                ]
            }
        ],
        "id": "1",
        "type": "stackedcolumn3d"
    }
    chartData.push(chart);

    chart = {};
    chart = {
        "chart": {
            "paletteColors": "#0075c2,#1aaf5d,#f2c500,#f45b00,#8e0000",
            "bgColor": "#ffffff",
            "showBorder": "0",
            "use3DLighting": "0",
            "showShadow": "0",
            "enableSmartLabels": "0",
            "startingAngle": "0",
            "decimals": "0",
            "captionFontSize": "14",
            "subcaptionFontSize": "14",
            "subcaptionFontBold": "0",
            "showPercentInTooltip": "0",
            "toolTipColor": "#ffffff",
            "toolTipBorderThickness": "0",
            "toolTipBgColor": "#000000",
            "toolTipBgAlpha": "80",
            "toolTipBorderRadius": "2",
            "toolTipPadding": "5",
            "showHoverEffect": "1",
            "showLegend": "1",
            "legendBgColor": "#ffffff",
            "legendBorderAlpha": '0',
            "legendShadow": '0',
            "legendItemFontSize": '10',
            "legendItemFontColor": '#666666',
            "enableRotation": "0",
            "enableSlicing ": '1',
            "enableMultiSlicing": '0',
            "showLabels": '1',
            "showPercentValues": "0",
            "defaultCenterLabel": "",
            "centerLabel": "$label <br /> $value",
            "centerLabelBold": "1",
            "useDataPlotColorForLabels": "1",
            "legendItemFontSize": "12"
        },
        "data": [
            {
                "label": "Risk Class A",
                "value": "10"
            },
            {
                "label": "Risk Class B",
                "value": "15"
            },
            {
                "label": "Risk Class C",
                "value": "30"
            },
            {
                "label": "Risk Class D",
                "value": "40"
            }
        ],
        "id": "2",
        "type": "doughnut2d"
    }
    chartData.push(chart);

    chart = {};
    chart = {
        "chart": {
            "caption": "Top Smartphone Ratings",
            "subcaption": "By Features",
            "xAxisName": "Features",
            "yAxisName": "Model",
            "showplotborder": "1",
            "xAxisLabelsOnTop": "1",
            "plottooltext": "<div id='nameDiv' style='font-size: 12px; border-bottom: 1px dashed #666666; font-weight:bold; padding-bottom: 3px; margin-bottom: 5px; display: inline-block; color: #888888;' >$rowLabel :</div>{br}Rating : <b>$dataValue</b>{br}$columnLabel : <b>$tlLabel</b>{br}<b>$trLabel</b>",
            "baseFontColor": "#333333",
            "baseFont": "Helvetica Neue,Arial",
            "captionFontSize": "14",
            "subcaptionFontSize": "14",
            "subcaptionFontBold": "0",
            "showBorder": "0",
            "bgColor": "#ffffff",
            "showShadow": "0",
            "usePlotGradientColor": "0",
            "canvasBgColor": "#ffffff",
            "canvasBorderAlpha": "0",
            "legendBgAlpha": "0",
            "legendBorderAlpha": "0",
            "legendShadow": "0",
            "legendItemFontSize": "10",
            "legendItemFontColor": "#666666",
            "toolTipColor": "#ffffff",
            "toolTipBorderThickness": "0",
            "toolTipBgColor": "#000000",
            "toolTipBgAlpha": "80",
            "toolTipBorderRadius": "2",
            "toolTipPadding": "5"
        },
        "rows": {
            "row": [
                {
                    "id": "SGS5",
                    "label": "Samsung Galaxy S5"
                },
                {
                    "id": "HTC1M8",
                    "label": "HTC One (M8)"
                },
                {
                    "id": "IPHONES5",
                    "label": "Apple iPhone 5S"
                },
                {
                    "id": "LUMIA",
                    "label": "Nokia Lumia 1520"
                }
            ]
        },
        "columns": {
            "column": [
                {
                    "id": "processor",
                    "label": "Processor"
                },
                {
                    "id": "screen",
                    "label": "Screen Size"
                },
                {
                    "id": "price",
                    "label": "Price"
                },
                {
                    "id": "backup",
                    "label": "Battery Backup"
                },
                {
                    "id": "cam",
                    "label": "Camera"
                }
            ]
        },
        "dataset": [
            {
                "data": [
                    {
                        "rowid": "SGS5",
                        "columnid": "processor",
                        "value": "8.7",
                        "tllabel": "Quad Core 2.5 GHz",
                        "trlabel": "OS : Android 4.4 Kitkat"
                    },
                    {
                        "rowid": "SGS5",
                        "columnid": "screen",
                        "value": "8.5",
                        "tllabel": "5.1 inch",
                        "trlabel": "AMOLED screen"
                    },
                    {
                        "rowid": "SGS5",
                        "columnid": "price",
                        "value": "9.3",
                        "tllabel": "$600"
                    },
                    {
                        "rowid": "SGS5",
                        "columnid": "backup",
                        "value": "9.7",
                        "tllabel": "29 Hrs",
                        "trlabel": "Battery : 2800 MAH"
                    },
                    {
                        "rowid": "SGS5",
                        "columnid": "cam",
                        "value": "8",
                        "tllabel": "16 MP",
                        "trlabel": "Front Camera : 2.1 MP"
                    },
                    {
                        "rowid": "HTC1M8",
                        "columnid": "processor",
                        "value": "9.2",
                        "tllabel": "Quad Core 2.3 GHz",
                        "trlabel": "OS : Android 4.4 Kitkat"
                    },
                    {
                        "rowid": "HTC1M8",
                        "columnid": "screen",
                        "value": "8.3",
                        "tllabel": "5 inch",
                        "trlabel": "LCD screen"
                    },
                    {
                        "rowid": "HTC1M8",
                        "columnid": "price",
                        "value": "7.3",
                        "tllabel": "$600"
                    },
                    {
                        "rowid": "HTC1M8",
                        "columnid": "backup",
                        "value": "8.8",
                        "tllabel": "20 Hrs",
                        "trlabel": "Battery : 2600 MAH"
                    },
                    {
                        "rowid": "HTC1M8",
                        "columnid": "cam",
                        "value": "8.7",
                        "tllabel": "4 MP",
                        "trlabel": "Front Camera : 5 MP"
                    },
                    {
                        "rowid": "IPHONES5",
                        "columnid": "processor",
                        "value": "9.1",
                        "tllabel": "Dual Core",
                        "trlabel": "OS : iOS 7"
                    },
                    {
                        "rowid": "IPHONES5",
                        "columnid": "screen",
                        "value": "8.6",
                        "tllabel": "4 inch",
                        "trlabel": "Retina LCD screen"
                    },
                    {
                        "rowid": "IPHONES5",
                        "columnid": "price",
                        "value": "7.2",
                        "tllabel": "$649"
                    },
                    {
                        "rowid": "IPHONES5",
                        "columnid": "backup",
                        "value": "8.4",
                        "tllabel": "10 Hrs",
                        "trlabel": "Battery : 1560 MAH"
                    },
                    {
                        "rowid": "IPHONES5",
                        "columnid": "cam",
                        "value": "9.5",
                        "tllabel": "8 MP",
                        "trlabel": "Front Camera : 1.2 MP"
                    },
                    {
                        "rowid": "LUMIA",
                        "columnid": "processor",
                        "value": "8.8",
                        "tllabel": "Quad Core 2.2 GHz",
                        "trlabel": "OS: Windows Phone 8"
                    },
                    {
                        "rowid": "LUMIA",
                        "columnid": "screen",
                        "value": "9.1",
                        "tllabel": "6 inch",
                        "trlabel": "LCD screen"
                    },
                    {
                        "rowid": "LUMIA",
                        "columnid": "price",
                        "value": "9.7",
                        "tllabel": "$470"
                    },
                    {
                        "rowid": "LUMIA",
                        "columnid": "backup",
                        "value": "9.2",
                        "tllabel": "27 Hrs",
                        "trlabel": "Battery : 3400 MAH"
                    },
                    {
                        "rowid": "LUMIA",
                        "columnid": "cam",
                        "value": "8.1",
                        "tllabel": "20MP",
                        "trlabel": "Front Camera : 1.2 MP"
                    }
                ]
            }
        ],
        "colorrange": {
            "gradient": "0",
            "minvalue": "0",
            "code": "E24B1A",
            "startlabel": "Poor",
            "endlabel": "Good",
            "color": [
                {
                    "code": "E24B1A",
                    "minvalue": "1",
                    "maxvalue": "5",
                    "label": "Bad"
                },
                {
                    "code": "F6BC33",
                    "minvalue": "5",
                    "maxvalue": "8.5",
                    "label": "Average"
                },
                {
                    "code": "6DA81E",
                    "minvalue": "8.5",
                    "maxvalue": "10",
                    "label": "Good"
                }
            ]
        },
        "id": "3",
        "type": "heatmap"
    }
    chartData.push(chart);

    chart = {};
    chart = {
        "chart": {
            "caption": "SORT Reports",
            "subCaption": "Jan 2016 - Sep 2016",
            //"xAxisname": "Quarter",
            //"yAxisName": "Revenue (In USD)",
            "numberSuffix": "%",
            //"paletteColors": "#0075c2,#1aaf5d",
            "bgColor": "#ffffff",
            "borderAlpha": "20",
            "showCanvasBorder": "0",
            "usePlotGradientColor": "0",
            "plotBorderAlpha": "10",
            "legendBorderAlpha": "0",
            "legendShadow": "0",
            "valueFontColor": "#000",
            "showXAxisLine": "1",
            "xAxisLineColor": "#999999",
            "divlineColor": "#999999",
            "divLineDashed": "1",
            "showAlternateHGridColor": "0",
            "subcaptionFontBold": "0",
            "subcaptionFontSize": "14",
            "showHoverEffect": "1"
        },
        "categories": [
            {
                "category": [
                    {
                        "label": "Aircraft General"
                    },
                    {
                        "label": "Auto Flight"
                    },
                    {
                        "label": "Electrical"
                    },
                    {
                        "label": "Indicating/Recording"
                    },
                    {
                        "label": "Navigation"
                    },
                    {
                        "label": "Water/Waste"
                    }
                ]
            }
        ],
        "dataset": [
            {
                "seriesname": "Success %",
                "data": [
                    {
                        "value": "86"
                    },
                    {
                        "value": "92"
                    },
                    {
                        "value": "88"
                    },
                    {
                        "value": "85"
                    },
                    {
                        "value": "90"
                    },
                    {
                        "value": "99"
                    }
                ]
            },
            {
                "seriesname": "Failures %",
                "data": [
                    {
                        "value": "14"
                    },
                    {
                        "value": "8"
                    },
                    {
                        "value": "12"
                    },
                    {
                        "value": "15"
                    },
                    {
                        "value": "10"
                    },
                    {
                        "value": "1"
                    }
                ]
            }
        ],
        "id": "4",
        "type": "stackedcolumn3d"
    }
    chartData.push(chart);

    chart = {};
    chart = {
        "chart": {
            "caption": "Occurrence Causes",
            "subCaption": "Jan 2016 - Sep 2016",
            "paletteColors": "#0075c2,#1aaf5d,#f2c500,#f45b00,#8e0000",
            "bgColor": "#ffffff",
            "showBorder": "0",
            "use3DLighting": "0",
            "showShadow": "0",
            "enableSmartLabels": "0",
            "startingAngle": "0",
            "showPercentValues": "1",
            "showPercentInTooltip": "0",
            "decimals": "1",
            "captionFontSize": "14",
            "subcaptionFontSize": "14",
            "subcaptionFontBold": "0",
            "toolTipColor": "#ffffff",
            "toolTipBorderThickness": "0",
            "toolTipBgColor": "#000000",
            "toolTipBgAlpha": "80",
            "toolTipBorderRadius": "2",
            "toolTipPadding": "5",
            "showHoverEffect": "1",
            "showLegend": "1",
            "legendBgColor": "#ffffff",
            "legendBorderAlpha": '0',
            "legendShadow": '0',
            "legendItemFontSize": '10',
            "legendItemFontColor": '#666666'
        },
        "data": [
            {
                "label": "Electrical",
                "value": "12"
            },
            {
                "label": "Auto Flight",
                "value": "8"
            },
            {
                "label": "Aircraft general",
                "value": "8"
            },
            {
                "label": "Indicating/Recording",
                "value": "7"
            },
            {
                "label": "Navigation",
                "value": "5"
            },
            {
                "label": "Water/Waste",
                "value": "2"
            }
        ],
        "id": "5",
        "type": "doughnut2d"
    }
    chartData.push(chart);

    chart = {};
    chart = {
        "chart": {
            "caption": "SORT Reports",
            //"xAxisName": "Quarter",
            //"yAxisName": "Sales (In USD)",
            //"numberPrefix": "$",
            "paletteColors": "#0075c2,#1aaf5d,#f2c500",
            "bgColor": "#ffffff",
            "showBorder": "0",
            "showCanvasBorder": "0",
            "usePlotGradientColor": "0",
            "plotBorderAlpha": "10",
            "legendBorderAlpha": "0",
            "legendBgAlpha": "0",
            "legendShadow": "0",
            "showHoverEffect": "1",
            "valueFontColor": "#000",
            "rotateValues": "1",
            "placeValuesInside": "1",
            "divlineColor": "#999999",
            "divLineIsDashed": "1",
            "divLineDashLen": "1",
            "divLineGapLen": "1",
            "canvasBgColor": "#ffffff",
            "captionFontSize": "14",
            "subcaptionFontSize": "14",
            "subcaptionFontBold": "0"
        },
        "categories": [
            {
                "category": [
                    {
                        "label": "Aircraft General"
                    },
                    {
                        "label": "Auto Flight"
                    },
                    {
                        "label": "Electrical"
                    },
                    {
                        "label": "Indicating/Recording"
                    },
                    {
                        "label": "Navigation"
                    },
                    {
                        "label": "Water/Waste"
                    }
                ]
            }
        ],
        "dataset": [
            {
                "seriesname": "Success",
                "data": [
                    {
                        "value": 50
                    },
                    {
                        "value": 60
                    },
                    {
                        "value": 40
                    },
                    {
                        "value": 86
                    },
                    {
                        "value": 92
                    },
                    {
                        "value": 96
                    },
                    {
                        "value": 57
                    },
                    {
                        "value": 84
                    }
                ]
            },
            {
                "seriesname": "Failure",
                "data": [
                    {
                        "value": 50
                    },
                    {
                        "value": 40
                    },
                    {
                        "value": 60
                    },
                    {
                        "value": 14
                    },
                    {
                        "value": 8
                    },
                    {
                        "value": 4
                    },
                    {
                        "value": 43
                    },
                    {
                        "value": 26
                    }
                ]
            }
        ],
        "id": "2508",
        "type": "stackedcolumn3d"
    }
    chartData.push(chart);

    chart = {
        "chart": {
            "caption": "Over All By Subject, Year",
            //"xAxisName": "Quarter",
            //"yAxisName": "Sales (In USD)",
            //"numberPrefix": "$",
            "paletteColors": "#0075c2,#1aaf5d,#f2c500",
            "bgColor": "#ffffff",
            "showBorder": "0",
            "showCanvasBorder": "0",
            "usePlotGradientColor": "0",
            "plotBorderAlpha": "10",
            "legendBorderAlpha": "0",
            "legendBgAlpha": "0",
            "legendShadow": "0",
            "showHoverEffect": "1",
            "valueFontColor": "#000",
            "rotateValues": "1",
            "placeValuesInside": "1",
            "divlineColor": "#999999",
            "divLineIsDashed": "1",
            "divLineDashLen": "1",
            "divLineGapLen": "1",
            "canvasBgColor": "#ffffff",
            "captionFontSize": "14",
            "subcaptionFontSize": "14",
            "subcaptionFontBold": "0"
        },
        "categories": [
            {
                "category": [
                    {
                        "label": "Aircraft General"
                    },
                    {
                        "label": "Auto Flight"
                    },
                    {
                        "label": "Electrical"
                    },
                    {
                        "label": "Indicating/Recording"
                    },
                    {
                        "label": "Navigation"
                    },
                    {
                        "label": "Water/Waste"
                    }
                ]
            }
        ],
        "dataset": [
            {
                "seriesname": "2011",
                "data": [
                    {
                        "value": 50
                    },
                    {
                        "value": 60
                    },
                    {
                        "value": 40
                    },
                    {
                        "value": 86
                    },
                    {
                        "value": 92
                    },
                    {
                        "value": 96
                    },
                    {
                        "value": 57
                    },
                    {
                        "value": 84
                    }
                ]
            },
            {
                "seriesname": "2012",
                "data": [
                    {
                        "value": 50
                    },
                    {
                        "value": 80
                    },
                    {
                        "value": 40
                    },
                    {
                        "value": 90
                    },
                    {
                        "value": 20
                    },
                    {
                        "value": 60
                    },
                    {
                        "value": 63
                    },
                    {
                        "value": 70
                    }
                ]
            },
            {
                "seriesname": "2013",
                "data": [
                    {
                        "value": 50
                    },
                    {
                        "value": 86
                    },
                    {
                        "value": 92
                    },
                    {
                        "value": 86
                    },
                    {
                        "value": 92
                    },
                    {
                        "value": 96
                    },
                    {
                        "value": 57
                    },
                    {
                        "value": 84
                    }
                ]
            },
            {
                "seriesname": "2014",
                "data": [
                    {
                        "value": 40
                    },
                    {
                        "value": 60
                    },
                    {
                        "value": 80
                    },
                    {
                        "value": 90
                    },
                    {
                        "value": 70
                    },
                    {
                        "value": 50
                    },
                    {
                        "value": 30
                    },
                    {
                        "value": 10
                    }
                ]
            },
            {
                "seriesname": "2015",
                "data": [
                    {
                        "value": 80
                    },
                    {
                        "value": 86
                    },
                    {
                        "value": 92
                    },
                    {
                        "value": 86
                    },
                    {
                        "value": 92
                    },
                    {
                        "value": 96
                    },
                    {
                        "value": 57
                    },
                    {
                        "value": 84
                    }
                ]
            }
        ],
        "id": "2509",
        "type": "mscolumn3d"
    }
    chartData.push(chart);

    chart = {};
    chart = {
        "chart": {
            "caption": "Pre Evaluation",
            "subCaption": "",
            //"xAxisname": "Quarter",
            //"yAxisName": "Revenue (In USD)",
            "numberSuffix": "%",
            //"paletteColors": "#0075c2,#1aaf5d",
            "bgColor": "#ffffff",
            "borderAlpha": "20",
            "showCanvasBorder": "0",
            "usePlotGradientColor": "0",
            "plotBorderAlpha": "10",
            "legendBorderAlpha": "0",
            "legendShadow": "0",
            "valueFontColor": "#000",
            "showXAxisLine": "1",
            "xAxisLineColor": "#999999",
            "divlineColor": "#999999",
            "divLineDashed": "1",
            "showAlternateHGridColor": "0",
            "subcaptionFontBold": "0",
            "subcaptionFontSize": "14",
            "showHoverEffect": "1"
        },
        "categories": [
            {
                "category": [
                    {
                        "label": "Aircraft General"
                    },
                    {
                        "label": "Auto Flight"
                    },
                    {
                        "label": "Electrical"
                    },
                    {
                        "label": "Indicating/Recording"
                    },
                    {
                        "label": "Navigation"
                    },
                    {
                        "label": "Water/Waste"
                    }
                ]
            }
        ],
        "dataset": [
            {
                "seriesname": "Success %",
                "data": [
                    {
                        "value": "86"
                    },
                    {
                        "value": "92"
                    },
                    {
                        "value": "88"
                    },
                    {
                        "value": "85"
                    },
                    {
                        "value": "90"
                    },
                    {
                        "value": "99"
                    }
                ]
            },
            {
                "seriesname": "Failures %",
                "data": [
                    {
                        "value": "14"
                    },
                    {
                        "value": "8"
                    },
                    {
                        "value": "12"
                    },
                    {
                        "value": "15"
                    },
                    {
                        "value": "10"
                    },
                    {
                        "value": "1"
                    }
                ]
            }
        ],
        "id": "2511",
        "type": "stackedcolumn3d"
    }
    chartData.push(chart);

    chart = {};
    chart = {
        "chart": {
            "caption": "Previous Level by Subject",
            "subCaption": "",
            //"xAxisname": "Quarter",
            //"yAxisName": "Revenue (In USD)",
            "numberSuffix": "%",
            //"paletteColors": "#0075c2,#1aaf5d",
            "bgColor": "#ffffff",
            "borderAlpha": "20",
            "showCanvasBorder": "0",
            "usePlotGradientColor": "0",
            "plotBorderAlpha": "10",
            "legendBorderAlpha": "0",
            "legendShadow": "0",
            "valueFontColor": "#000",
            "showXAxisLine": "1",
            "xAxisLineColor": "#999999",
            "divlineColor": "#999999",
            "divLineDashed": "1",
            "showAlternateHGridColor": "0",
            "subcaptionFontBold": "0",
            "subcaptionFontSize": "14",
            "showHoverEffect": "1"
        },
        "categories": [
            {
                "category": [
                    {
                        "label": "Aircraft General"
                    },
                    {
                        "label": "Auto Flight"
                    },
                    {
                        "label": "Electrical"
                    },
                    {
                        "label": "Indicating/Recording"
                    },
                    {
                        "label": "Navigation"
                    },
                    {
                        "label": "Water/Waste"
                    }
                ]
            }
        ],
        "dataset": [
            {
                "seriesname": "Success %",
                "data": [
                    {
                        "value": "86"
                    },
                    {
                        "value": "92"
                    },
                    {
                        "value": "88"
                    },
                    {
                        "value": "85"
                    },
                    {
                        "value": "90"
                    },
                    {
                        "value": "99"
                    }
                ]
            },
            {
                "seriesname": "Failures %",
                "data": [
                    {
                        "value": "14"
                    },
                    {
                        "value": "8"
                    },
                    {
                        "value": "12"
                    },
                    {
                        "value": "15"
                    },
                    {
                        "value": "10"
                    },
                    {
                        "value": "1"
                    }
                ]
            }
        ],        
        "id": "2512",
        "type": "stackedcolumn3d"
    }
    chartData.push(chart);

    // or we could create a function on the Array prototype directly

    Array.prototype.inArray = function (property, searchFor) {
        var retVal = -1;
        $.each(this, function (index, item) {
            if (item.hasOwnProperty(property)) {
                if (item[property] === searchFor) {
                    retVal = item;
                    return false;
                }
            }
        });
        return retVal;
    };

    return {
        getChartData: function (value) {
            var returnData = chartData.inArray("id", value.toString());
            return returnData;
        },
    };

})();
(function () {
    'use strict';
    angular.module('app.core', [
        /*
         * Angular modules
         */
        'ngAnimate', 'ngRoute', 'ngSanitize',
        /*
         * Our reusable cross app code modules
         */
        'blocks.exception', 'blocks.logger', 'blocks.router',
        /*
         * 3rd Party modules
         */
        'ngplus'
    ]);
})();
(function () {
    'use strict';

    angular
        .module('blocks.logger')
        .factory('logger', logger);

    logger.$inject = ['$log', 'toastr', '$injector'];

    function logger($log, toastr, $injector) {

        var service = {
            showToasts: true,

            error: error,
            info: info,
            success: success,
            warning: warning,

            // straight to console; bypass toastr
            log: $log.log
        };

        return service;
        /////////////////////

        function error(message, data, title) {
            var dataservice = $injector.get('dataservice');
            var $location = $injector.get('$location');

            var saveObj = {Message:message};
            dataservice.postServerData("", saveObj, false, '', "/Generic/Log/Create").then(function (data) {
                var errNo = "000";
                if(data !== undefined && data !== "")
                    errNo = data;
                var errMessage = errNo + " - Unexpected error. Please contact Administrator.";
                //toastr.error(errMessage, title, { allowHtml: true });

            })
           // console.log('Error: ' + message);
            $log.error('Error: ' + message, data);
            //$location.path('/dashboard');
        }

        function info(message, data, title) {
            toastr.info(message, title, {allowHtml: true});
            $log.info('Info: ' + message, data);
        }

        function success(message, data, title) {
            toastr.success(message, title, { allowHtml: true });
            $log.info('Success: ' + message, data);
        }

        function warning(message, data, title) {
            toastr.warning(message, title, { allowHtml: true });
            /*$log.warn('Warning: ' + message, data);*/
        }
    }
}());
(function () {
    'use strict';

    angular
        .module('blocks.router')
        .provider('routehelperConfig', routehelperConfig)
        .factory('routehelper', routehelper);

    routehelper.$inject = ['$location', '$rootScope', '$route', 'logger', 'routehelperConfig', 'authService', 'bsLoadingOverlayService', 'localStorageService'];

    // Must configure via the routehelperConfigProvider
    function routehelperConfig() {
        /* jshint validthis:true */
        this.config = {
            // These are the properties we need to set
            // $routeProvider: undefined
            // docTitle: ''
            // resolveAlways: {ready: function(){ } }
        };

        this.$get = function () {
            return {
                config: this.config
            };
        };
    }

    function routehelper($location, $rootScope, $route, logger, routehelperConfig, authService, bsLoadingOverlayService, localStorageService) {
        var handlingRouteChangeError = false;
        var routeCounts = {
            errors: 0,
            changes: 0
        };
        var routes = [];
        var $routeProvider = routehelperConfig.config.$routeProvider;

        var service = {
            configureRoutes: configureRoutes,
            getRoutes: getRoutes,
            routeCounts: routeCounts
        };

        init();

        return service;
        ///////////////

        function configureRoutes(routes) {
            routes.forEach(function (route) {
                route.config.resolve =
                    angular.extend(route.config.resolve || {}, routehelperConfig.config.resolveAlways);
                $routeProvider.when(route.url, route.config);
            });
            $routeProvider.otherwise({
                redirectTo: '/'
            });
        }

        function handleRoutingErrors() {
            // Route cancellation:
            // On routing error, go to the dashboard.
            // Provide an exit clause if it tries to do it twice.
            $rootScope.$on('$routeChangeError',
                function (event, current, previous, rejection) {
                    if (handlingRouteChangeError) {
                        return;
                    }
                    routeCounts.errors++;
                    handlingRouteChangeError = true;
                    var destination = (current && (current.title || current.name || current.loadedTemplateUrl)) ||
                        'unknown target';
                    var msg = 'Error routing to ' + destination + '. ' + (rejection.msg || '');
                    logger.warning(msg, [current]);
                    $location.path('/');
                }
            );
        }

        function init() {
            handleRoutingErrors();
            hendleEvents();
            $route.reload();
        }

        function loginPageSetting() {
            $(".page-content").css("margin-left", "0px").css("background-color", "transparent");
            $(".page-sidebar-wrapper").css("display", "none");
            $(".top-menu").css("display", "none");
            $(".page-container").css("margin", "0px");
            $(".page-header").css("display", "none");
            $(".page-footer").css("display", "none");
            $("#pagewrapper").removeAttr('style');
            $("#pagewrapper").css("margin-top", "0px");
            //$(".page-container").css("margin-top", "0px");
            //$("html").css("background", "url('images/flynas_lgoin_Bg.png') no-repeat center center fixed");
            $(".top-menu").css("display", "none");
            //$(".loading-overlay").css("background", "url('images/flynas_lgoin_Bg.png') no-repeat center center fixed");
            $(".page-content-wrapper").removeClass("well-lg");
            //$(".shuffle-animation").css("height", "calc(100% - 30px)");
            // $(".page-content-wrapper").css("margin-top", "-60px");
            $(".page-content").addClass("login-content");
            $(".page-content-wrapper").height($(window).height() + "px");
        }

        function allPageSetting() {
            if ($location !== undefined && $location.$$path !== undefined)
                $rootScope.configHeaderMenu = $location.$$path.replace("/", "");
            else
                $rootScope.configHeaderMenu = "";
            $(".page-content").css("margin-left", "230px").css("background-color", "#E6F0F1");
            $(".page-sidebar-wrapper").css("display", "none");
            $(".page-sidebar-wrapper").css("display", "inline");
            $(".top-menu").css("display", "block");
            $(".page-footer").css("display", "block");
            $(".page-header").css("display", "block");
            
            //$(".page-container").css("margin-top", "46px");
            // $("html").css("background-color", "#6ebebd").css("background-image", "none");
            $(".loading-overlay").css("background-image", "none");
            $(".page-content").removeClass("login-content");
            $("#pagewrapper").removeAttr('style');
            $("#pagewrapper").css("margin-top", "58px");
            //$(".page-content").css("margin-top", "0px");
            //$(".page-content-wrapper").css("margin-top", "0px");
            $(".page-content-wrapper").height(($(window).height() - $(".page-header").height()) + "px");
        }


        function getRoutes() {
            for (var prop in $route.routes) {
                if ($route.routes.hasOwnProperty(prop)) {
                    var route = $route.routes[prop];
                    var isRoute = !!route.title;
                    if (isRoute && (route.display !== undefined && route.display !== false)) {
                        routes.push(route);
                    }
                }
            }
            return routes;
        }


        function hendleEvents() {
            $rootScope.$on('$routeChangeSuccess',
                function (event, current, previous) {
                    routeCounts.changes++;
                    handlingRouteChangeError = false;
                    var title = routehelperConfig.config.docTitle + ' ' + (current.title || '');
                    $rootScope.title = title; // data bind to <title>
                    //bsLoadingOverlayService.stop();
                }
            );

            function routeChangeStart(event, next, current) {
                //bsLoadingOverlayService.start();
                //allPageSetting();

                //Look at the next parameter value to determine if a redirect is needed

                var authData = localStorageService.get('authorizationData');
                if (authData === undefined || authData === null || authData.authentication === undefined || authData.authentication.isAuth === undefined || authData.authentication.isAuth === null || authData.authentication.isAuth === "") {
                    if (authService == undefined || (authService !== undefined && authService.authentication != undefined && authService.authentication != null && authService.authentication.isAuth !== undefined && !authService.authentication.isAuth)) {
                        loginPageSetting();
                        $location.path('/login');
                        return;
                    } else {
                        allPageSetting();
                    }
                }

                if (next && next.$$route && next.$$route.originalPath == "/login") {
                    if (authData === undefined || authData === null || authData.authentication === undefined || authData.authentication.isAuth === undefined || authData.authentication.isAuth === null || authData.authentication.isAuth === "") {
                        loginPageSetting();
                        $location.path('/login');
                    }
                    else if (authService.authentication.isAuth) {
                        $rootScope.$evalAsync(function () {
                            $location.path('/dashboard');
                        });
                        return;
                    } else {
                        loginPageSetting();
                    }
                }

                if (next && next.$$route && next.$$route.authorize) {
                    allPageSetting();
                    if (!authService.authentication.isAuth) {
                        $rootScope.$evalAsync(function () {
                            loginPageSetting();
                            $location.path('/login');
                        });
                    }
                }

                if (next && next.$$route && !authService.authentication.isAuth) {
                    $rootScope.$evalAsync(function () {
                        loginPageSetting();
                        if ($location.$$url !== undefined && $location.$$url !== '' && $location.$$url.toLowerCase() === '/login#login')
                            $location.url("/login");
                        $location.path('/login');
                    });
                }
            }

            $rootScope.$on('$routeChangeStart', function (event, next, current) {
                $rootScope.configSection = "";
                if (($rootScope.pageChange === undefined || $rootScope.pageChange === false) && current !== undefined && current.scope !== undefined && current.scope.vm !== undefined && current.scope.vm.pageChange !== undefined) {
                    var redirectPath = "/dashboard";
                    if (next && next.$$route && next.$$route.originalPath)
                        redirectPath = next.$$route.originalPath;
                    var changes = navcon.pageChanges(current.scope.vm.pageChange, current.scope.vm.pageSave, function (confirm) {
                        if (!confirm) {
                            $rootScope.$evalAsync(function () {
                                $rootScope.pageChange = true;
                                $location.path(redirectPath);
                                return;
                            })
                        }
                    });
                    //bsLoadingOverlayService.stop();
                    event.preventDefault();
                    return;

                } else {
                    routeChangeStart(event, next, current);
                }
                $rootScope.pageChange = false;
            });
        }
    }
})();
// Include in index.html so that app level exceptions are handled.
(function () {
    'use strict';

    angular
        .module('blocks.exception')
        .provider('exceptionHandler', exceptionHandlerProvider)
        .config(config);

    /**
     * Must configure the exception handling
     * @return {[type]}
     */
    function exceptionHandlerProvider() {

        this.config = {
            appErrorPrefix: undefined
        };

        this.configure = function (appErrorPrefix) {
            this.config.appErrorPrefix = appErrorPrefix;
        };

        this.$get = function () {
            return {
                config: this.config
            };
        };
    }

    /**
     * Configure by setting an optional string value for appErrorPrefix.
     * Accessible via config.appErrorPrefix (via config value).
     * @param  {[type]} $provide
     * @return {[type]}
     * @ngInject
     */
    function config($provide) {
        $provide.decorator('$exceptionHandler', extendExceptionHandler);
    }

    /**
     * Extend the $exceptionHandler service to also display a toast.
     * @param  {Object} $delegate
     * @param  {Object} exceptionHandler
     * @param  {Object} logger
     * @return {Function} the decorated $exceptionHandler service
     */
    function extendExceptionHandler($delegate, exceptionHandler, logger, $injector) {
        return function (exception, cause) {
            var appErrorPrefix = exceptionHandler.config.appErrorPrefix || '';
            var errorData = {
                exception: exception,
                cause: cause
            };
            exception.message = appErrorPrefix + exception.message;
            $delegate(exception, cause);
            /**
             * Could add the error to a service's collection,
             * add errors to $rootScope, log errors to remote web server,
             * or log locally. Or throw hard. It is entirely up to you.
             * throw exception;
             *
             * @example
             *     throw { message: 'error message we added' };
             */
            var localStorageService = $injector.get('localStorageService');
            var authData = localStorageService.get('authorizationData');

            if(authData !== null) {
                logger.error(exception.message, errorData);
            }
           // console.log("Exception: " + exception.message);
        };
    }
})();
(function () {
    'use strict';

    angular
        .module('blocks.exception')
        .factory('exception', exception);

    function exception(logger) {
        var service = {
            catcher: catcher
        };
        return service;

        function catcher(message) {
            return function (reason) {
                if(reason.status === 500 || reason.status === 415 || reason.status === 405 ) //InternalServerError or UnsupportedMediaType or MethodNotAllowed
                    logger.error(message, reason);
                else
                    logger.warning(message, reason);
            };
        }
    }
})();


'use strict';
angular.module('app').factory('authService', ['$http', '$q', 'localStorageService', 'ngAuthSettings', 'logger', '$location', '$rootScope', function ($http, $q, localStorageService, ngAuthSettings, logger, $location, $rootScope) {

    var loginServiceUri = ngAuthSettings.loginServiceUri;
    var serviceBase = ngAuthSettings.apiServiceBaseUri;
    var authServiceFactory = {};

    var _authentication = {
        isAuth: false,
        userName: "",
        userId: -1,
        useRefreshTokens: false,
        userRights: {},
        notification: {},
        Designation: "",
        Roles: {},
        version:""
    };

    var _externalAuthData = {
        provider: "",
        userName: "",
        externalAccessToken: ""
    };

    var _saveRegistration = function (registration) {

        _logOut();

        return $http.post(serviceBase + 'api/account/register', registration).then(function (response) {
            return response;
        });

    };

    var _login = function (loginData) {

        var data = "grant_type=password&username=" + loginData.userName + "&password=" + loginData.password + "&timezone=" + navcon.defaultFormat().timeZone;
        // var data = "grant_type=password&username=" + "USR001" + "&password=" + "Safetal1!";
        /* if (loginData.useRefreshTokens) {
             data = data + "&client_id=" + ngAuthSettings.clientId;
         }*/

        var deferred = $q.defer();



        $http.post(loginServiceUri + 'oauth/token', data, { headers: { 'Content-Type': 'application/x-www-form-urlencoded' } }).success(function (response) {

            var accessToken = response.access_token;
            _authentication.isAuth = true;

            if(response.userName !== undefined && response.userName !== "")
                _authentication.userName = response.userName;
            else
                _authentication.userName = loginData.userName;


            _authentication.useRefreshTokens = loginData.useRefreshTokens;
            _authentication.userId = response.UserId;

            if (loginData.useRefreshTokens) {
                localStorageService.set('authorizationData', { token: accessToken, userName: _authentication.userName, userId: _authentication.userId, refreshToken: _authentication.useRefreshTokens, useRefreshTokens: true });
            }
            else {
                localStorageService.set('authorizationData', { token: accessToken, userName: _authentication.userName, userId: _authentication.userId, refreshToken: _authentication.useRefreshTokens, useRefreshTokens: false });
            }


                $rootScope.$broadcast('START-ALERT');
                // Get UserRights by Id //should be revoked
                $http.get(serviceBase + 'Security/GetUserAccess', { headers: { 'Content-Type': 'application/json', 'Authorization': 'Bearer ' + accessToken } }).success(function (data) {
                    // $http.get('reference/dataSecurity.json').success(function (data) {
                    _authentication.userRights = data.SecurityAccess;
                    _authentication.notification = data.Notifications;                    
                    _authentication.FirstName = data.FirstName;
                    _authentication.LastName = data.LastName;
                    _authentication.Designation = data.Designation;
                    _authentication.Roles = data.Roles;
                    _authentication.version = data.SafetalVersion;
                    if (loginData.useRefreshTokens) {
                        localStorageService.set('authorizationData', {
                            token: accessToken, userName: _authentication.userName, userId: _authentication.userId,
                            userRights: data.SecurityAccess, refreshToken: _authentication.useRefreshTokens, useRefreshTokens: true,
                            notification: data.Notifications,                            
                            FirstName: data.FirstName,
                            LastName: data.LastName,
                            Designation: data.Designation,
                            Roles: data.Roles,
                            version: data.SafetalVersion
                        });
                    }
                    else {
                        localStorageService.set('authorizationData', {
                            token: accessToken, userName: _authentication.userName, userId: _authentication.userId, userRights: data.SecurityAccess,
                            refreshToken: _authentication.useRefreshTokens, useRefreshTokens: false, notification: data.Notifications,                            
                            FirstName: data.FirstName,
                            LastName: data.LastName,
                            Designation: data.Designation,
                            Roles: data.Roles,
                            version: data.SafetalVersion
                        });
                    }

                    deferred.resolve(data.SecurityAccess);

                }).error(function (err, status) {
                    _logOut();
                    deferred.reject(err);
                });

            
        }).error(function (err, status) {
            _logOut();
            deferred.reject(err);
        });

        return deferred.promise;

    };


    var _logOut = function (callback) {
        if (!_authentication.isAuth) return;
        $http.get(serviceBase + 'MyProfile/Logout', { headers: { 'Content-Type': 'application/json' } }).success(function (data) {
            _clearSession();
            //$location.path('/login');
            if (callback !== undefined) callback('logout');
        })
    };


    var _clearSession = function () {
        localStorageService.remove('authorizationData');

        _authentication.isAuth = false;
        _authentication.userName = "";
        _authentication.userId = -1;
        _authentication.useRefreshTokens = false;
        _authentication.userRights = {};
        _authentication.notification = {};
        _authentication.Designation = "";
        _authentication.Roles = {};
        _authentication.version = "";
        
    }


    var _windowsCloseLogOut = function () {
        var authData = localStorageService.get('authorizationData');
        if (!_authentication.isAuth) return;
        _clearSession();
        jQuery.ajax({
            url: serviceBase + 'MyProfile/Logout',
            async: false,
            beforeSend: function (xhr) {
                xhr.setRequestHeader("Authorization", "Bearer " + authData.token);
            },
            success: function (response) {
                console.log(response);
            }
        });
    };



    var _fillAuthData = function () {

        var authData = localStorageService.get('authorizationData');
        if (authData) {
            _authentication.isAuth = true;
            _authentication.userName = authData.userName;
            _authentication.userId = authData.userId;
            _authentication.useRefreshTokens = authData.useRefreshTokens;
            _authentication.userRights = authData.userRights;
            _authentication.notification = authData.notification;
            _authentication.Designation = authData.Designation;
            _authentication.Roles = authData.Roles;
            
        }

    };

    var _refreshToken = function () {
        var deferred = $q.defer();

        var authData = localStorageService.get('authorizationData');

        if (authData) {

            if (authData.useRefreshTokens) {

                var data = "grant_type=refresh_token&refresh_token=" + authData.refreshToken + "&client_id=" + ngAuthSettings.clientId;

                localStorageService.remove('authorizationData');

                $http.post(serviceBase + 'token', data, { headers: { 'Content-Type': 'application/x-www-form-urlencoded' } }).success(function (response) {

                    $http.get(serviceBase + 'User/GetByName/' + response.userName, { headers: { 'Content-Type': 'application/json' } }).success(function (userId) {
                        localStorageService.set('authorizationData', { token: response.access_token, userName: response.userName, userId: userId, refreshToken: response.refresh_token, useRefreshTokens: true });
                    });

                    //localStorageService.set('authorizationData', { token: response.access_token, userName: response.userName, refreshToken: response.refresh_token, useRefreshTokens: true });

                    deferred.resolve(response);

                }).error(function (err, status) {
                    _logOut();
                    deferred.reject(err);
                });
            }
        }

        return deferred.promise;
    };

    var _obtainAccessToken = function (externalData) {

        var deferred = $q.defer();

        $http.get(serviceBase + 'api/account/ObtainLocalAccessToken', { params: { provider: externalData.provider, externalAccessToken: externalData.externalAccessToken } }).success(function (response) {

            $http.get(serviceBase + 'User/GetByName/' + response.userName, { headers: { 'Content-Type': 'application/json' } }).success(function (userId) {
                localStorageService.set('authorizationData', { token: response.access_token, userName: response.userName, userId: userId, refreshToken: "", useRefreshTokens: false });
            });

            //localStorageService.set('authorizationData', { token: response.access_token, userName: response.userName, refreshToken: "", useRefreshTokens: false });

            _authentication.isAuth = true;
            _authentication.userName = response.userName;
            _authentication.useRefreshTokens = false;

            deferred.resolve(response);

        }).error(function (err, status) {
            _logOut();
            deferred.reject(err);
        });

        return deferred.promise;

    };

    var _registerExternal = function (registerExternalData) {

        var deferred = $q.defer();

        $http.post(serviceBase + 'api/account/registerexternal', registerExternalData).success(function (response) {

            $http.get(serviceBase + 'User/GetByName/' + response.userName, { headers: { 'Content-Type': 'application/json' } }).success(function (userId) {
                localStorageService.set('authorizationData', { token: response.access_token, userName: response.userName, userId: userId, refreshToken: "", useRefreshTokens: false });
            });

            //localStorageService.set('authorizationData', { token: response.access_token, userName: response.userName, refreshToken: "", useRefreshTokens: false });

            _authentication.isAuth = true;
            _authentication.userName = response.userName;
            _authentication.useRefreshTokens = false;

            deferred.resolve(response);

        }).error(function (err, status) {
            _logOut();
            deferred.reject(err);
        });

        return deferred.promise;

    };

    authServiceFactory.saveRegistration = _saveRegistration;
    authServiceFactory.login = _login;
    authServiceFactory.logOut = _logOut;
    authServiceFactory.clearSession = _clearSession;
    authServiceFactory.windowsCloseLogOut = _windowsCloseLogOut;
    authServiceFactory.fillAuthData = _fillAuthData;
    authServiceFactory.authentication = _authentication;
    authServiceFactory.refreshToken = _refreshToken;

    authServiceFactory.obtainAccessToken = _obtainAccessToken;
    authServiceFactory.externalAuthData = _externalAuthData;
    authServiceFactory.registerExternal = _registerExternal;

    return authServiceFactory;
}]);
'use strict';
angular.module('app').factory('authInterceptorService', ['$rootScope', '$q', '$injector', '$location', 'localStorageService', 'logger', 'ngAuthSettings', function ($rootScope, $q, $injector, $location, localStorageService, logger, ngAuthSettings) {

    var authInterceptorServiceFactory = {};

    var _request = function (config) {
        var authData = localStorageService.get('authorizationData');
        if (ngAuthSettings.SSO !== undefined && ngAuthSettings.SSO && !authData && $location.$$url.toLowerCase() !== '/login') {
            window.appReload = true;
            if (ngAuthSettings.SSO !== undefined && !ngAuthSettings.SSO) {
                var authService = $injector.get('authService');
                authService.clearSession();
            }
            window.sessionAlert = false;
            $location.path('login');
           
            return;
        }

        config.headers = config.headers || {};


        if (authData) {
            config.headers.Authorization = 'Bearer ' + authData.token;
            if ($rootScope.configHeaderMenu !== undefined && $rootScope.configHeaderMenu !== null)
                config.headers.Menu = $rootScope.configHeaderMenu;
            else
                config.headers.Menu = "";
            if ($rootScope.configSection !== undefined && $rootScope.configSection !== null)
                config.headers.Section = $rootScope.configSection;
            else
                config.headers.Section = "";
        }
        return config;
    }


    var _responseError = function (rejection) {
        var authData = localStorageService.get('authorizationData');
        if (rejection.status === 0) {
            window.appReload = true;
            if (ngAuthSettings.SSO !== undefined && !ngAuthSettings.SSO) {
                var authService = $injector.get('authService');
                authService.clearSession();
            }
            if (!window.sessionAlert) {
                window.sessionAlert = true;
                alert("Your session has expired. Please click OK to start a new session.");
                $location.path('login');
            }
           
           
            return;
        }

        if (rejection.status === 500 || rejection.status === 415 || rejection.status === 405) {//InternalServerError or UnsupportedMediaType or MethodNotAllowed
            logger.error(rejection.data.Message, rejection);
            //return $q.reject(rejection);
        }
        if (rejection.status === 401) {
            var authService = $injector.get('authService');
            authService.clearSession();
            $location.path('/login');
            return { "data": [] };
        }
        return $q.reject(rejection);
    }

    authInterceptorServiceFactory.request = _request;
    authInterceptorServiceFactory.responseError = _responseError;

    return authInterceptorServiceFactory;
}]);

angular.module('app').config(function ($httpProvider) {
    $httpProvider.interceptors.push('authInterceptorService');
});
(function () {
    'use strict';
    angular
        .module('app.core')
        .factory('dataservice', dataservice);

    /* @ngInject */
    function dataservice($http, $location, $q, exception, logger, $templateCache, ngAuthSettings, apiEndUrl) {
        var serviceBase = ngAuthSettings.apiServiceBaseUri;

        var service = {
            getData: getData,
            putData: putData,
            getServerData: getServerData,
            postServerData: postServerData,
            putServerData: putServerData,
            deleteServerData: deleteServerData,
            getTemplateURL: getTemplateURL,
            getFields: getFields,
            fileUpload: fileUpload,
            excelFileUpload: excelFileUpload,
            fileDelete: fileDelete,
            JSONUrl: JSONUrl,
            getServerPath: getServerPath,
            getFiles: getFiles,
            getServerHtmlData: getServerHtmlData
        };
        var Base64 = { _keyStr: "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=", encode: function (e) { var t = ""; var n, r, i, s, o, u, a; var f = 0; e = Base64._utf8_encode(e); while (f < e.length) { n = e.charCodeAt(f++); r = e.charCodeAt(f++); i = e.charCodeAt(f++); s = n >> 2; o = (n & 3) << 4 | r >> 4; u = (r & 15) << 2 | i >> 6; a = i & 63; if (isNaN(r)) { u = a = 64 } else if (isNaN(i)) { a = 64 } t = t + this._keyStr.charAt(s) + this._keyStr.charAt(o) + this._keyStr.charAt(u) + this._keyStr.charAt(a) } return t }, decode: function (e) { var t = ""; var n, r, i; var s, o, u, a; var f = 0; e = e.replace(/[^A-Za-z0-9\+\/\=]/g, ""); while (f < e.length) { s = this._keyStr.indexOf(e.charAt(f++)); o = this._keyStr.indexOf(e.charAt(f++)); u = this._keyStr.indexOf(e.charAt(f++)); a = this._keyStr.indexOf(e.charAt(f++)); n = s << 2 | o >> 4; r = (o & 15) << 4 | u >> 2; i = (u & 3) << 6 | a; t = t + String.fromCharCode(n); if (u != 64) { t = t + String.fromCharCode(r) } if (a != 64) { t = t + String.fromCharCode(i) } } t = Base64._utf8_decode(t); return t }, _utf8_encode: function (e) { e = e.replace(/\r\n/g, "\n"); var t = ""; for (var n = 0; n < e.length; n++) { var r = e.charCodeAt(n); if (r < 128) { t += String.fromCharCode(r) } else if (r > 127 && r < 2048) { t += String.fromCharCode(r >> 6 | 192); t += String.fromCharCode(r & 63 | 128) } else { t += String.fromCharCode(r >> 12 | 224); t += String.fromCharCode(r >> 6 & 63 | 128); t += String.fromCharCode(r & 63 | 128) } } return t }, _utf8_decode: function (e) { var t = ""; var n = 0; var r = c1 = c2 = 0; while (n < e.length) { r = e.charCodeAt(n); if (r < 128) { t += String.fromCharCode(r); n++ } else if (r > 191 && r < 224) { c2 = e.charCodeAt(n + 1); t += String.fromCharCode((r & 31) << 6 | c2 & 63); n += 2 } else { c2 = e.charCodeAt(n + 1); c3 = e.charCodeAt(n + 2); t += String.fromCharCode((r & 15) << 12 | (c2 & 63) << 6 | c3 & 63); n += 3 } } return t } }

        // Define the string
        function JSONUrl(url) {

            return $http.get(url)
                .then(getDataComplete)
                .catch(function (message) {
                    //exception.catcher('XHR Failed')(message);
                    //$location.url('/');
                    return serverValidation(message);
                });

            function getDataComplete(returnData, status, headers, config) {
                return returnData.data;
            }
        }

        function getFiles(type, page, endPoint) {
            var url = serviceBase + type + (page != undefined ? "/" + page : "");

            if (endPoint !== undefined && endPoint !== "")
                url = serviceBase + endPoint;

            return $http.get(url, { responseType: "arraybuffer" })
                .then(getDataComplete)
                .catch(function (message) {
                    return serverValidation(message);
                });

            function getDataComplete(returnData, status, headers, config) {
                return returnData.data;
            }
        }

        function getServerPath(type, rowId) {
            var returnData = navcon.route.UI(serviceBase, type, rowId);
            return returnData.toString().replace(serviceBase, "");
        }

        function getData(type, page, endPoint) {
            var url = serviceBase + type + (page != undefined ? "/" + page : "");

            if (endPoint !== undefined && endPoint !== "")
                url = serviceBase + endPoint;

            return $http.get(url)
                .then(getDataComplete)
                .catch(function (message) {
                    return serverValidation(message);
                });

            function getDataComplete(returnData, status, headers, config) {
                return returnData.data;
            }
        }

        function putData(type, data, endPoint) {
            var url = serviceBase + type;

            if (endPoint !== undefined && endPoint !== "")
                url = serviceBase + endPoint;
            if (data.hasOwnProperty('History')) {
                var Historydata = data["History"] != undefined ? data["History"] : "";
                data["History"] = Base64.encode(JSON.stringify(Historydata));
            }
            return $http.put(url, data, {
                headers: { 'Content-Type': 'application/json' }
            }).then(getDataComplete)
            .catch(function (message) {
                //exception.catcher('XHR Failed')(message);
                //$location.url('/');
                return serverValidation(message);
            });

            function getDataComplete(returnData, status, headers, config) {
                return returnData.data;
            }
        }

        function getServerURL(type, rowId) {
            var returnData = '';
            returnData = navcon.route.UI(serviceBase, type, rowId);
            return returnData;
        }

        function getServerData(type, rowId, endPoint) {
            var url = getServerURL(type, rowId);
            if (endPoint !== undefined && endPoint !== "")
                url = serviceBase + endPoint;
            if (url !== "" && url != serviceBase) {
                return $http.get(url)
                    .then(getDataComplete)
                    .catch(function (message) {
                        if (message.status === 401) {
                            $location.path('/refresh');
                            $location.path('/login');
                        }
                        else {
                            //exception.catcher('XHR Failed')(message);
                            //$location.url('/');
                            return serverValidation(message);
                        }
                    });
            }

            function getDataComplete(returnData, status, headers, config) {
                return returnData.data;
            }
        };

        function getServerHtmlData(endPoint) {
            var url;
            if (endPoint !== undefined && endPoint !== "")
                url = endPoint;
            if (url !== "" ) {
                return $http.get(url)
                    .then(getDataComplete)
                    .catch(function (message) {
                        if (message.status === 401) {
                            $location.path('/refresh');
                            $location.path('/login');
                        }
                        else {
                            //exception.catcher('XHR Failed')(message);
                            //$location.url('/');
                            return serverValidation(message);
                        }
                    });
            }

            function getDataComplete(returnData, status, headers, config) {
                return returnData;
            }
        };


        function postServerData(type, data, upload, formData, endPoint) {
            var url = getServerURL(type);

            if (endPoint !== undefined && endPoint !== "")
                url = serviceBase + endPoint;
            if (data.hasOwnProperty('History')) {
                var Historydata = data["History"] != undefined ? data["History"] : "";
                data["History"] = Base64.encode(JSON.stringify(Historydata));
            }

            //var jsonString = JSON.stringify(data);
            //var encodeRequest = Base64.encode(jsonString);

            return $http.post(url, data, {
                headers: {
                    'Content-Type': 'application/json'
                }
            }).then(getDataComplete)
            .catch(function (message) {
                //exception.catcher('XHR Failed')(message);
                return serverValidation(message);
            });

            function getDataComplete(returnData, status, headers, config) {
                return returnData.data;
            };
        };

        function fileUpload(formData) {
            var url = serviceBase + "/upload";
            return $http.post(url, formData, {
                transformRequest: angular.identity,
                headers: { 'Content-Type': undefined }
            }).then(getDataComplete)
            .catch(function (message) {
                //exception.catcher('XHR Failed')(message);
                return serverValidation(message);
            });

            function getDataComplete(returnData, status, headers, config) {
                return returnData.data;
            };
        };

        function excelFileUpload(formData) {
            var url = serviceBase + "/readExcel/upload";
            return $http.post(url, formData, {
                transformRequest: angular.identity,
                headers: { 'Content-Type': undefined }
            }).then(getDataComplete)
            .catch(function (message) {
                return serverValidation(message);
            });

            function getDataComplete(returnData, status, headers, config) {
                return returnData.data;
            };
        };

        function fileDelete(type, id) {
            var url = serviceBase + "/" + type + "/" + id;
            return $http.delete(url).then(getDataComplete)
            .catch(function (message) {
                //exception.catcher('XHR Failed')(message);
                return serverValidation(message);
            });
            function getDataComplete(returnData, status, headers, config) {
                return returnData.data;
            }
        };

        function putServerData(type, data) {
            var url = getServerURL(type);
            //var jsonString = JSON.stringify(data);
            //var encodeRequest = Base64.encode(jsonString);

            if (data.hasOwnProperty('History')) {
                var Historydata = data["History"] != undefined ? data["History"] : "";
                data["History"] = Base64.encode(JSON.stringify(Historydata));
            }
            return $http.put(url, data, {
                headers: { 'Content-Type': 'application/json' }
            }).then(getDataComplete)
            .catch(function (message) {
                //exception.catcher('XHR Failed')(message);
                //$location.url('/');
                return serverValidation(message);
            });

            function getDataComplete(returnData, status, headers, config) {
                return returnData.data;
            }
        };

        function deleteServerData(type, data) {
            var url = getServerURL(type);
            if (data !== undefined || data !== "") url += "/" + data;

            return $http.delete(url).then(getDataComplete)
            .catch(function (message) {
                //exception.catcher('XHR Failed')(message);
                //$location.url('/');
                return serverValidation(message);
            });

            function getDataComplete(returnData, status, headers, config) {
                return returnData.data;
            }
        };

        function serverValidation(message) {
            var arrData = null;
            if (message.data !== undefined && message.data !== null) {
                if (message.data.ModelState !== undefined && message.data.ModelState !== null) {
                    arrData = message.data.ModelState[""];
                } else if (message.data !== undefined && typeof message.data === "object") {
                    arrData = message.data;
                }

                if (arrData !== undefined && arrData !== null && arrData.length !== undefined && arrData.length > 0) {
                    $.map(arrData, function (item, key) {
                        if (item !== undefined)
                            exception.catcher(item)(message);
                    });
                } else if (arrData !== undefined && arrData !== null) {
                    if (arrData.ExceptionMessage !== undefined) exception.catcher(arrData.ExceptionMessage)(message);
                } else if (message.data !== undefined && message.data !== "") {
                    exception.catcher(message.data)(message);
                }
            }

            return;
        }

        function getFields(type) {
            var defer = $q.defer();

            $http.get('/api/getData/' + type).then(function (response) {
                defer.resolve(response.data[0].data.results);
            }, function (response) {
                exception.catcher('XHR Failed')(message);
                $location.url('/');
                defer.reject(response);
            });

            return defer.promise;
        };

        function getTemplateURL(keyOrUrl) {
            var data = $templateCache.get(keyOrUrl);

            if (data) {
                return data;
            } else {
                return $http.get(keyOrUrl, { cache: true })
                .then(getDataComplete)
                .catch(function (message) {
                    exception.catcher('XHR Failed')(message);
                    $location.url('/');
                });
            }

            function getDataComplete(data, status, headers, config) {
                $templateCache.put('navconfield.html', data.data);
                return data.data;
            }
        };

        return service;
    }
})();
var app = angular.module('app.loading', [
	'bsLoadingOverlay',
	'bsLoadingOverlaySpinJs',
	'ui.bootstrap'
]).run(function(bsLoadingOverlayService) {
	bsLoadingOverlayService.setGlobalConfig({
		templateUrl: 'bsLoadingOverlaySpinJs'
	});
});
'use strict';

angular.module('app.core').factory('signalRHubProxy', ['$rootScope', function ($rootScope) {
    function signalRHubProxyFactory(serverUrl, hubName, startOptions) {
        var connection = $.hubConnection(serverUrl);
        var proxy = connection.createHubProxy(hubName);
        connection.start(startOptions).done(function () { });
        
        return {
            on: function (eventName, callback) {
                proxy.on(eventName, function (result) {
                    $rootScope.$apply(function () {
                        if (callback) {
                            callback(result);
                        }
                    });
                });
            },
            off: function (eventName, callback) {
                proxy.off(eventName, function (result) {
                    $rootScope.$apply(function () {
                        if (callback) {
                            callback(result);
                        }
                    });
                });
            },
            invoke: function (methodName, callback) {
                proxy.invoke(methodName)
                    .done(function (result) {
                        $rootScope.$apply(function () {
                            if (callback) {
                                callback(result);
                            }
                        });
                    });
            },
            connection: connection
        };
    };

    return signalRHubProxyFactory;    
}]);


(function () {
    'use strict';

    angular
        .module('app.changepassword')
        .controller('changepassword', changepassword);

    /* @ngInject */
    function changepassword($scope, dataservice, logger, $compile, $timeout, $location, authService, pageConfig, menuSettings) {
        var vm = this;

        vm.rights = navcon.getUserRights(menuSettings, "", "Change Password");

        /*Settings*/
        vm.pageConfig = pageConfig[0];
        vm.getUserData = pageConfig[1];

        /*Fields*/
        vm.changePasswordFields = angular.copy(vm.pageConfig.fields.changePasswordFields);
        navcon.updateFieldsData(vm.changePasswordFields, vm.getUserData, $scope, false, vm);
                
        /*breadcrumbs*/
        if (vm.pageConfig.breadcrumbs !== undefined) vm.breadcrumbs = vm.pageConfig.breadcrumbs;
        
        /*Variable Declaration*/
        vm.title = 'Change Password';
        vm.primaryKey = "Id";
        vm.displayKey = "Password";
        vm.changePasswordFields.selectedRow = -1;
        vm.treeNode = {};

        vm.deleteModalTitle = "";
        vm.mainFormTitle = "";
        vm.subFormTitle = "";
        /*Variable Declaration*/

        vm.changePasswordFields.mode = "Update";
        vm.changePasswordFields.type = "changePassword";

        navcon.setDisabledEnabledByRights(vm.rights);

        /*Save*/
        vm.save = function (type, mode, callback) {
            if (type === "changePassword") {
                vm.deleteModalTitle = navcon.save.saveOption(vm, dataservice, vm.changePasswordFields.mode, vm.changePasswordFields.type, vm.changePasswordTable, vm.changePasswordFields,
                    vm.changePasswordFields.selectedRow, vm.primaryKey, vm.displayKey, 0, false, false, "",
                    function (data) {
                        if (callback !== undefined)
                            callback(data === undefined ? false : true);
                        $location.path('/');
                    });
            }
        };
    }
})();
(function () {
    'use strict';

    angular
        .module('app.login')
        .controller('login', login);

    /*@ngInject*/
    function login($scope, dataservice, logger, $compile, $timeout, $location, authService, ngAuthSettings, pageConfig, menuSettings, $rootScope, localStorageService, $cookieStore) {
        /*Page Declaration*/
        var vm = this;
        /* added for approuteconfig change */
        pageConfig = pageConfig[0];
        if (pageConfig === undefined || pageConfig.fields === undefined) {
            window.appReload = true;
            if (ngAuthSettings.SSO !== undefined && !ngAuthSettings.SSO) {
                var authService = $injector.get('authService');
                authService.clearSession();
            }
            window.location.href = ngAuthSettings.appURL;
            //$location.url('/404');
            return false;
           // $location.url('/404');
           // return false;
        }

        vm.SSO = false;
        vm.SSOProgress = false;
        if (ngAuthSettings.SSO !== undefined && ngAuthSettings.SSO)
            vm.SSO = true;

        /*Settings*/
        vm.pageConfig = pageConfig;

        /*Fields*/
        vm.loginFields = angular.copy(vm.pageConfig.fields.loginFields);

        defaultData(vm.pageConfig.data);
        //loginPageSubscribe(vm, $scope);

        /*Settings*/

        /*Variable Declaration*/
        vm.title = 'loginPage';

        vm.showForgorPassword = false;
        vm.showLogin = true;
        vm.message = "";

        vm.primaryKey = "Id";
        vm.displayKey = "UserName";
        vm.loginFields.selectedRow = -1;
        vm.treeNode = {};

        vm.deleteModalTitle = "";
        vm.mainFormTitle = "";
        vm.subFormTitle = "";
        /*Variable Declaration*/

        vm.loginFields.mode = "Save";
        vm.loginFields.type = "forgotPassword";

        vm.loginData = {
            userName: "",
            password: function () {
                var passIndex = navcon.getItemIndexByProperty(vm.loginFields, "userpassword");
                return vm.loginFields[passIndex].data;
            },
            useRefreshTokens: false
        };
        vm.warningModal = function (type) {

            var userIndex = navcon.getItemIndexByProperty(vm.loginFields, "username");
            if (vm.loginFields[userIndex].data === "") {
                logger.warning("User Name shouldn't be empty....");
                return;
            }

            var passIndex = navcon.getItemIndexByProperty(vm.loginFields, "userpassword");
            if (vm.loginFields[passIndex].data === "") {
                logger.warning("Password shouldn't be empty....");
                return;
            }

            navcon.openModal(type);
        }
        vm.closeModal = function (type) {
            navcon.closeModal(type);
        }
        vm.login = function () {

            if (vm.SSO) {
                var authData = localStorageService.get('authorizationData');
                if(authData === null || authData === undefined)
                    ssoSignin();
                else {

                    $location.path('/dashboard');
                }
            } else {
                var userIndex = navcon.getItemIndexByProperty(vm.loginFields, "username");
                vm.loginData.userName = vm.loginFields[userIndex].data;

                var passIndex = navcon.getItemIndexByProperty(vm.loginFields, "userpassword");
                vm.loginData.password = vm.loginFields[passIndex].data;
                authentication();
                navcon.closeModal('warning');
            }

        };

        vm.logout = function () {
            if (ngAuthSettings.SSO !== undefined && ngAuthSettings.SSO) {
                if (ngAuthSettings.appURL !== undefined && ngAuthSettings.appURL !== "") {
                    window.location.href = ngAuthSettings.appURL + "logout.aspx";
                }
            }
        };

        function authentication(callback) {
            authService.login(vm.loginData).then(function (response) {
                menuSettings.data = authService.authentication.userRights;
                $rootScope.$broadcast('MENU-SETTING-DATA-REFRESH');
                $rootScope.$broadcast('ALERT-DATA-REFRESH', authService.authentication.notification, true);
                var authData = localStorageService.get('authorizationData');
                if (authService.authentication.notification != undefined && authService.authentication.notification.length > 0)
                    authData.notification.push(authService.authentication.notification);
                localStorageService.set('authorizationData', authData);

                $location.path('/dashboard');

                if (callback !== undefined)
                    callback('success');
            },
            function (err) {
                vm.message = "";
                navcon.closeModal('warning');
                if(err !== undefined &&  err !== null && err.error_description !== undefined && err.error_description !== "")
                    logger.warning(err.error_description, "", "");
                if (callback !== undefined)
                    callback(err);

            });
        }



        vm.authExternalProvider = function (provider) {
            var redirectUri = location.protocol + '//' + location.host + '/authcomplete.html';

            var externalProviderUrl = ngAuthSettings.apiServiceBaseUri + "api/Account/ExternalLogin?provider=" + provider
                                                                        + "&response_type=token&client_id=" + ngAuthSettings.clientId
                                                                        + "&redirect_uri=" + redirectUri;
            window.$windowScope = vm;

            var oauthWindow = window.open(externalProviderUrl, "Authenticate Account", "location=0,status=0,width=600,height=750");
        };

        vm.authCompletedCB = function (fragment) {

            $scope.$apply(function () {

                if (fragment.haslocalaccount == 'False') {

                    authService.logOut();
                    logger.success("You have successfully log out...", "", "");

                    authService.externalAuthData = {
                        provider: fragment.provider,
                        userName: fragment.external_user_name,
                        externalAccessToken: fragment.external_access_token
                    };

                    $location.path('/associate');
                }
                else {
                    //Obtain access token and redirect to orders
                    var externalData = { provider: fragment.provider, externalAccessToken: fragment.external_access_token };
                    authService.obtainAccessToken(externalData).then(function (response) {
                        $location.path('/orders');
                    },
                 function (err) {
                     vm.message = "";
                     //vm.message = err.error_description;
                     logger.warning(err.error_description, "", "");
                 });
                }

            });
        }

        vm.enterKey = function () {
            //$("navcon-button[text='login']").click();
            $timeout(function () {
                if (angular.element("navcon-button[class~='warningLogin']").length !== 0)
                    angular.element("navcon-button[class~='warningLogin']").triggerHandler('click');
                else
                    angular.element("navcon-button[text='login']").triggerHandler('click');
            });
            /*var userIndex = navcon.getItemIndexByProperty(vm.loginFields, "username");
            var userData = vm.loginFields[userIndex].data;

            var passIndex = navcon.getItemIndexByProperty(vm.loginFields, "userpassword");
            var passData = vm.loginFields[passIndex].data;

            if (userData === "" && passData === "") {
                var user = $('[type=text][name="username"]');
                $(user).focus();
            } else if (userData !== "" && passData === "") {
                var pass = $('[type=password][name="userpassword"]');
                $(pass).focus();
            } else if (userData !== "" && passData !== "") {
                if (event.which === 13) {
                    $("navcon-button[text='login']").click();
                    vm.login();
                }
            }*/
        }

        activate();

        /*Privat functions*/

        /*Save*/
        vm.save = function (type, mode, callback) {
            var SecurityQuestionIndex = navcon.getItemIndexByProperty(vm.loginFields, "SecurityQuestion");

            if (vm.loginFields[SecurityQuestionIndex].data !== "") {
                if (type === "forgotPassword") {
                    vm.deleteModalTitle = navcon.save.saveOption(vm, dataservice, vm.loginFields.mode, vm.loginFields.type, vm.loginTable, vm.loginFields, vm.loginFields.selectedRow,
                        vm.primaryKey, vm.displayKey, 0, false, false, "", function (data) {
                            if (data === undefined || data === null) return;
                            else {
                                logger.warning(data.Message);

                                if (data.Success) {
                                    var UserNameIndex = navcon.getItemIndexByProperty(vm.loginFields, "UserName");
                                    vm.loginFields[UserNameIndex].data = "";
                                    manageAllControls(true);
                                    navcon.closeModal(type);
                                }
                            }
                            //if (callback !== undefined)
                            //    callback(data === undefined ? false : true);
                        });
                }
            }
        };

        /*Cancel*/
        vm.cancel = function (type) {
            var UserNameIndex = navcon.getItemIndexByProperty(vm.loginFields, "UserName");
            vm.loginFields[UserNameIndex].data = "";
            manageAllControls(true);
            navcon.closeModal(type);
        };

        function getServerData(type, rowId) {
            return dataservice.getServerData(type, rowId).then(function (data) {
                return data;
            });
        };

        function activate() {
            var authData = localStorageService.get('authorizationData');
            manageAllControls(true);
            Layout.initSidebar();
            if(authData === null || authData === undefined) {
                if (vm.SSO) {
                    $timeout(function () {
                        navcon.openModal('warning');
                    })

                }
            } else {
                $location.path('/dashboard');
            }
        };


        function ssoSignin() {
            vm.SSOProgress = true;
            vm.loginData.userName = "******";
            vm.loginData.password = "******";
            authentication(function (res) {

                if (res === 'success') {
                    navcon.closeModal('warning');
                    return;
                }

                vm.SSOProgress = false;
                vm.ssoError = "";
                if (ngAuthSettings.SSOError !== undefined && ngAuthSettings.SSOError !== "")
                    vm.ssoError = ngAuthSettings.SSOError;

            });
        }

        function defaultData(data) {
            navcon.save.loadListDefaultData(data, vm.loginFields);
            manageAllControls(true);
        }

        function loginPageSubscribe(vm, $scope) {
            //template

        };

        vm.Ok = function () {
            var userNameIndex = navcon.getItemIndexByProperty(vm.loginFields, "UserName");
            var SecurityQuestionIndex = navcon.getItemIndexByProperty(vm.loginFields, "SecurityQuestion");

            vm.loginFields[SecurityQuestionIndex].disabled = true;
            var userNameData = vm.loginFields[userNameIndex].data;

            if (userNameData === undefined || userNameData === "") {
                logger.warning("User name required.");
                return;
            }
            else {
                getServerData("userRegistrationGetSecQn", userNameData).then(function (data) {
                    if (data === undefined || data === null || data.length === 0) {
                        vm.loginFields[SecurityQuestionIndex].data = "";
                        logger.warning("Invalid username.");
                        manageAllControls(true);
                        return;
                    }

                    if (data.Question.toUpperCase() === "NONE") {
                        //vm.loginFields[SecurityQuestionIndex].data = "";
                        logger.warning("No security question registered for the user.");
                        manageAllControls(true);
                    }
                    else {
                        vm.loginFields[SecurityQuestionIndex].data = data.Question;
                        manageAllControls(false);
                    }
                });
            }
        };

        function manageAllControls(status) {
            var securityQuesIndex = navcon.getItemIndexByProperty(vm.loginFields, "SecurityQuestion");
            var securityAnsIndex = navcon.getItemIndexByProperty(vm.loginFields, "SecurityAnswer");
            var passwordIndex = navcon.getItemIndexByProperty(vm.loginFields, "NewPassword");
            var confirmPasswordIndex = navcon.getItemIndexByProperty(vm.loginFields, "ConfirmPassword");

            vm.loginFields[securityAnsIndex].data = "";
            vm.loginFields[passwordIndex].data = "";
            vm.loginFields[confirmPasswordIndex].data = "";

            vm.loginFields[securityQuesIndex].disabled = true;
            vm.loginFields[securityAnsIndex].disabled = status;
            vm.loginFields[passwordIndex].disabled = status;
            vm.loginFields[confirmPasswordIndex].disabled = status;

            $rootScope.$broadcast('FIELD-VALID', status, securityAnsIndex);
            $rootScope.$broadcast('FIELD-VALID', status, passwordIndex);
            $rootScope.$broadcast('FIELD-VALID', status, confirmPasswordIndex);

            if (status === true) {
                vm.loginFields[securityQuesIndex].data = "";
            }
        };

        /*Private functions*/
    }
})();
(function () {
    'use strict';

    angular
        .module('app')
        .factory('appInfo', appInfo);    

    function appInfo() {
        var service = {
            status: {
                busy: false,
                message: ''
            },
            setInfo: setInfo
        };

        return service;

        function setInfo(args) {
            if (args) {
                if (args.hasOwnProperty('busy')) {             
                    service.status.busy = args.busy;
                }
                if (args.hasOwnProperty('message')) {                    
                    service.status.message = args.message;
                }
            } else {
                service.status.busy = false;
                service.status.message = '';
            }
        }
    }
})();
(function() {
    'use strict';

    angular
        .module('app.photo')
        .directive('egFiles', egFiles);

    function egFiles () {

        var directive = {
            link: link,
            restrict: 'A',
            scope: {
                files: '=egFiles',
                hasFiles: '='
            }
        };
        return directive;

        function link(scope, element, attrs) {                         
            //scope.files.length = 0;
            scope.fileList = [];
            element.bind('change', function () {
                scope.files.length = 0;
                scope.$apply(function () {
                    if (element[0].files) {
                        angular.forEach(element[0].files, function (f) {
                            scope.files.push(f);
                            scope.fileList.push(f);
                        });
                        scope.hasFiles = true;
                    }                    
                });
            });
                        
            if (element[0].form) {
                angular.element(element[0].form)
                        .bind('reset', function () {
                            scope.$apply(function () {
                                scope.files.length = 0;
                                scope.hasFiles = false;
                            });
                });
            }
        }
    }
})();
(function() {
    'use strict';

    angular
        .module('app.photo')
        .directive('egPhotoUploader', egPhotoUploader);

    egPhotoUploader.$inject = ['appInfo', 'photoManager'];

    function egPhotoUploader(appInfo, photoManager) {

        var directive = {
            link: link,
            restrict: 'E',
            //templateUrl: 'app/photo/egPhotoUploader.html',
            templateUrl: function() {
                return navcon.Menuroute.getTemplateUrl("PhotoUploader");
            },
            scope: true
        };
        return directive;

        function link(scope, element, attrs) {
            scope.hasFiles = false;
            scope.photos = [];
            scope.upload = photoManager.upload;
            scope.appStatus = appInfo.status;
            scope.photoManagerStatus = photoManager.status;
        }
    }

})();
(function() {
    'use strict';

    angular
        .module('app.photo')
        .directive('egUpload', egUpload);

    egUpload.$inject = ['$timeout'];
    
    function egUpload($timeout) {

        var directive = {
            link: link,
            restrict: 'A',
            scope: {
                upload:'&egUpload'
            }
        };
        return directive;

        function link(scope, element, attrs) {
            var parentForm = element[0].form;
            if (parentForm) {
                element.on('click', function (event) {
                    return scope.upload().then(function () {
                        $timeout(function () {
                            parentForm.reset();
                        });
                    });
                });
            }
        }
    }
})();
(function () {
    'use strict';

    angular
        .module('app.photo')
        .factory('photoManager', photoManager);

    photoManager.$inject = ['$q', 'photoManagerClient', 'appInfo'];

    function photoManager($q, photoManagerClient, appInfo) {
        var service = {
            photos: [],
            load: load,
            upload: upload,
            remove: remove,
            photoExists: photoExists,
            status: {
                uploading: false
            }
        };

        return service;

        function load() {
            appInfo.setInfo({busy:true, message:"loading photos"})
            
            service.photos.length = 0;

            return photoManagerClient.query()
                                .$promise
                                .then(function (result) {                                    
                                    result.photos
                                            .forEach(function (photo) {
                                                    service.photos.push(photo);
                                                });

                                    appInfo.setInfo({message: "photos loaded successfully"});

                                    return result.$promise;
                                },
                                function (result) {
                                    appInfo.setInfo({message: "something went wrong: " + result.data.message});
                                    return $q.reject(result);
                                })                   
                                ['finally'](
                                function () {
                                    appInfo.setInfo({busy: false});
                                });
        }

        function upload(photos)
        {
            service.status.uploading = true;
            appInfo.setInfo({ busy: true, message: "uploading photos" });            

            var formData = new FormData();

            angular.forEach(photos, function (photo) {
                formData.append(photo.name, photo);
            });

            return photoManagerClient.save(formData)
                                        .$promise
                                        .then(function (result) {
                                            if (result && result.photos) {
                                                result.photos.forEach(function (photo) {
                                                    if (!photoExists(photo.name)) {
                                                        service.photos.push(photo);
                                                    }
                                                });
                                            }

                                            appInfo.setInfo({message: "photos uploaded successfully"});

                                            return result.$promise;
                                        },
                                        function (result) {
                                            appInfo.setInfo({message: "something went wrong: " + result.data.message});
                                            return $q.reject(result);
                                        })
                                        ['finally'](
                                        function () {
                                            appInfo.setInfo({ busy: false });                                            
                                            service.status.uploading = false;
                                        });
        }

        function remove(photo) {
            appInfo.setInfo({ busy: true, message: "deleting photo " + photo.name });            

            return photoManagerClient.remove({fileName: photo.name})
                                        .$promise
                                        .then(function (result) {
                                            //if the photo was deleted successfully remove it from the photos array
                                            var i = service.photos.indexOf(photo);
                                            service.photos.splice(i, 1);

                                            appInfo.setInfo({message: "photos deleted"});

                                            return result.$promise;
                                        },
                                        function (result) {
                                            appInfo.setInfo({message: "something went wrong: " + result.data.message});
                                            return $q.reject(result);
                                        })
                                        ['finally'](
                                        function () {
                                            appInfo.setInfo({busy: false});
                                        });
        }

        function photoExists(photoName) {
            var res = false
            service.photos.forEach(function (photo) {
                if (photo.name === photoName) {
                    res = true;
                }
            });

            return res;
        }
    }
})();
(function () {
    'use strict';

    angular
        .module('app.photo')
        .factory('photoManagerClient', photoManagerClient);

    photoManagerClient.$inject = ['$resource', 'ngAuthSettings'];

    function photoManagerClient($resource, ngAuthSettings) {
        var serviceBase = ngAuthSettings.apiServiceBaseUri;
        return $resource(serviceBase + "photo/:fileName",
                { id: "@fileName" },
                {
                    'query': {method:'GET'},
                    'save': { method: 'POST', transformRequest: angular.identity, headers: { 'Content-Type': undefined } },
                    'remove':{method: 'DELETE', url: 'api/photo/:fileName', params:{name:'@fileName'}}
                });
    }
})();
(function () {
    'use strict';

    angular
        .module('app.photo')
        .controller('photos', photos); 

    photos.$inject = ['photoManager'];

    function photos(photoManager) {
        /* jshint validthis:true */
        var vm = this;
        vm.title = 'photo manager';
        vm.photos = photoManager.photos;
        vm.uploading = false;
        vm.previewPhoto;        
        vm.remove = photoManager.remove;
        vm.setPreviewPhoto = setPreviewPhoto;        

        activate();

        function activate() {
            photoManager.load();
        }

        function setPreviewPhoto(photo) {         
            vm.previewPhoto = photo         
        }

        function remove(photo) {
            photoManager.remove(photo).then(function () {
                setPreviewPhoto();
            });
        }
    }
})();

(function () {
    'use strict';

    angular
        .module('app.rolemanagement')
        .controller('rolemanagement', rolemanagement);

    /* @ngInject */
    function rolemanagement($scope, dataservice, logger, $compile, $timeout, $location, pageConfig, $rootScope, menuSettings) {
        var vm = this;
        
        if (pageConfig === undefined || pageConfig.fields === undefined) {
            $location.url('/');
            return false;
        }

        /* History Fields */
        $scope.isHistory = false;
        $scope.historyState = "Save";
        $scope.HistoryTitle = "Review Changes";
        $scope.hideHistory = false;

        vm.rights = navcon.getUserRights(menuSettings, "padministration", "rolemanagement");

        /*Settings*/
        vm.pageConfig = pageConfig;
        //vm.roleManagementFields = angular.copy(vm.pageConfig.fields.roleManagementFields);
        //vm.roleManagementHistoryFields = angular.copy(vm.pageConfig.fields.roleManagementHistoryFields);
        //vm.roleManagementTable = angular.copy(vm.pageConfig.tables.roleManagementTable);

        /*Page Config Common Varriable Assign */
        navcon.getPageConfig(vm, vm.pageConfig);

        defaultData(vm.pageConfig.data);

        activate();

        /*Variable Declaration*/
        vm.primaryKey = "RoleId";
        var type = "roleManagement";
        var roleStatusIndex;
        var addExistingSystemRoleIndex;
        var existingSystemRoleIdIndex;
        //var ITARWarningIndex;
        vm.readOnly = false;
        vm.formManage = {};
        vm.showHistory = false;

        /*Cancel*/
        vm.cancel = function (type) {
            if (type === 'RoleDeleteModal') {
                navcon.closeModal(type);
            }
            else {
                clearFields();
                getRoleById(vm.RoleId);

                vm.enableFields(false);
                vm.isSave = true;
                vm.isEdit = true;
                vm.isUpdate = true;
                vm.readOnly = true;

                if (vm.RoleId === 0)
                    vm.showHistory = false;
                else
                    vm.showHistory = true;
                
                if (vm.RoleId === 0)
                    $('#Role').removeClass('in');
            }

            $scope.isHistory = false;
            navcon.closeModal(type);
            navcon.clearFieldsData(vm.roleManagementHistoryFields);
        };

        $scope.cancel = function (type) {
            $scope.isHistory = false;
            navcon.closeModal(type);
            navcon.clearFieldsData(vm.roleManagementHistoryFields);
        }

        /*Edit*/
        vm.edit = function () {
            vm.enableFields(true);
            vm.isSave = true;
            vm.isUpdate = false;
            vm.isDelete = false;
            vm.isCancel = false;
            vm.isITAR = false;
        };

        /*Save*/
        vm.save = function (mode, callback) {
            $scope.hideHistory = false;

            if (vm.RoleId === 0)
                vm.mode = "Save";
            else
                vm.mode = "Update";

            var idName = "RoleId";
            var idNameIndex = navcon.getItemIndexByProperty(vm.roleManagementFields, idName);

            if (vm.roleManagementFields[idNameIndex].data != 0) {

                $scope.Historydata = navcon.comparedata(vm.roleManagementFields, 'Administration Role Management', "", idName, vm.roleManagementFields[idNameIndex].data);
                var HistoryIndex = navcon.getItemIndexByProperty(vm.roleManagementFields, 'History');
                vm.roleManagementFields[HistoryIndex].data = $scope.Historydata;

                $scope.HistoryTitle = 'Review Changes';

                if ($scope.Historydata.length > 0) {
                    $scope.isHistory = true;
                    $scope.historyState = "Save";
                    navcon.openModal('review');
                }
                else {
                    $scope.isHistory = false;
                    navcon.openModal('notFound');
                }
            } else {
                $scope.ProceedToSave();
            }
        };

        $scope.saveChanges = function () {
            if (vm.formManage.formValid(vm.roleManagementHistoryFields)) {
                var HistoryRemarksIndex = navcon.getItemIndexByProperty(vm.roleManagementFields, "HistoryRemarks");
                var RemarksIndex = navcon.getItemIndexByProperty(vm.roleManagementHistoryFields, "HistoryRemarks");
                var objHistory = { Remarks: vm.roleManagementHistoryFields[RemarksIndex].data };
                console.log(objHistory);
                vm.roleManagementFields[HistoryRemarksIndex].data = objHistory;
                $scope.ProceedToSave();
            }
        };

        $scope.ProceedToSave = function () {
            navcon.save.saveOption(vm, dataservice, vm.mode, type, vm.roleManagementTable, vm.roleManagementFields, vm.selectedRow, vm.primaryKey, "", "", "", true, "", function (data) {
                clearFields();
                $('#Role').removeClass('in');
                $scope.cancel('review');
                navcon.clearFieldsData(vm.roleManagementHistoryFields);

                if (data !== undefined && vm.mode == "Update")
                    logger.success("Entries are updated successfully...");
                if (data !== undefined && vm.mode == "Save")
                    logger.success("Entries are saved successfully...");
            });
        };

        $scope.HistoryChanges = function (type) {
            $scope.hideHistory = false;
            var idNameIndex = navcon.getItemIndexByProperty(vm.roleManagementFields, "RoleId");

            dataservice.getData("History/GetHistory/RoleId/" + vm.roleManagementFields[idNameIndex].data).then(function (data) {
                $scope.HistoryTitle = "History";

                if (data != undefined && data != null && data.length > 0) {
                    $scope.Historydata = data;
                    $scope.hideHistory = false;
                } else {
                    $scope.Historydata = data;
                    $scope.hideHistory = true;
                }

                $scope.isHistory = true;
                $scope.historyState = "View";
                navcon.openModal('review');
            });
        };

        /*Delete*/
        vm.delete = function (callback) {
            navcon.openModal('RoleDeleteModal');
        }

        vm.showHide = function (id, mode) {
            if (!$('#' + id).hasClass('in')) {
                $('#' + id).toggleClass('in');
            }

            if (mode === 'add') {
                clearFields();
                vm.RoleId = 0;
                vm.isSave = false;
                vm.isCancel = false;
                vm.isUpdate = true;
                vm.isDelete = true;
                vm.enableFields(true);
                vm.isITAR = false;
                vm.showHistory = false;
                vm.roleManagementFields.mode = 'save';
                $('table.dataTable tbody tr').removeClass('selected');
                $('table.dataTable tbody tr').css("background-color", "");
            }
        }

        vm.closePopup = function (modalType, action) {
            if (action === "No") {
                navcon.closeModal(modalType);
            }
            else
                if (action === "Yes") {
                    navcon.save.deleteOption(dataservice, type, vm.roleManagementTable, vm.selectedRow, vm.primaryKey, "", function (data) {
                        //if (callback !== undefined)
                        //    callback(data === undefined ? false : true);
                        closeModal('delete');
                        navcon.closeModal(modalType);
                        vm.isEdit = true;
                        if (data !== undefined)
                            logger.success("Entries are deleted successfully...");
                    });
                }
        }

        function closeModal(mode) {
            if (mode === 'delete') {
                clearFields();
                $('#Role').removeClass('in');
                vm.showHistory = false;
            }
            else {
                vm.readOnly = true;
                vm.showHide('Role');
                vm.showHistory = true;
            }
        }

        function clearFields() {
            navcon.clearFieldsData(vm.roleManagementFields);
            roleStatusIndex = navcon.getItemIndexByProperty(vm.roleManagementFields, "RoleStatus");
            vm.roleManagementFields[roleStatusIndex].data = true;
            navcon.clearFieldsData(vm.roleManagementHistoryFields);
        }

        vm.enableFields = function (isEnabled) {
            vm.readOnly = !isEnabled;
        }

        vm.tableCellClick = function (row, column, data, type, cellObj, oTable) {
            vm.showHide('Role');
            vm.RoleId = data.RoleId;
            vm.selectedRow = navcon.save.selectedRowIndex(vm.roleManagementTable, data, vm.primaryKey);

            getRoleById(vm.RoleId);

            vm.enableFields(false);
            vm.isSave = true;
            vm.isUpdate = true;
            vm.showHistory = true;
            vm.roleManagementFields.mode = 'view';
        }

        function getRoleById(roleId) {
            var dataRole = getServerData('roleManagementId', roleId).then(function (dataRole) {
                if (dataRole !== undefined && dataRole !== null) {
                    if (roleId !== 0) {
                        clearFields();
                        navcon.updateFieldsData(vm.roleManagementFields, dataRole[0], vm, false, vm.navconData);

                        if (dataRole[0].IsSystemRole) {
                            vm.isEdit = true;
                            vm.isDelete = true;
                            vm.isCancel = true;
                            vm.isITAR = false;
                        }
                        else {
                            vm.isEdit = false;
                            vm.isDelete = false;
                            vm.isCancel = false;
                            vm.isITAR = true;
                        }
                    }
                }
            });
        }

        function getServerData(type, rowId) {
            return dataservice.getServerData(type, rowId).then(function (data) {
                return data;
            });
        };

        function activate() {
            getServerData('roleManagementAll').then(function (data) {
                //navcon.setDisabledEnabledByRights(vm.rights);
                if (data === undefined || data.length === 0) return;

                vm.roleManagementTable.data = data;
                vm.roleManagementTableData = data;

                //ITARWarningIndex = navcon.getItemIndexByProperty(vm.roleManagementFields, "ITARWarning");
                addExistingSystemRoleIndex = navcon.getItemIndexByProperty(vm.roleManagementFields, "AddExistingSystemRole");
                existingSystemRoleIdIndex = navcon.getItemIndexByProperty(vm.roleManagementFields, "ExistingSystemRoleId");
                $scope.itarwarning = true;
                vm.showExistingRoles = false;
                watchAttributes();
            });
        };

        function defaultData(data) {
            navcon.save.loadListDefaultData(data, vm.roleManagementFields);
        }

        function watchAttributes() {
            $scope.$watch("vm.roleManagementFields[" + addExistingSystemRoleIndex + "].data", function (newValue, oldValue) {
                if (newValue) {
                    vm.showExistingRoles = true;
                }
                else {
                    vm.showExistingRoles = false;
                    vm.roleManagementFields[existingSystemRoleIdIndex].data = "";
                }
            });

            // History ITAR  Watch
            var HistoryITARWarningIndex = navcon.getItemIndexByProperty(vm.roleManagementHistoryFields, "ITARWarning");
            $scope.$watch("vm.roleManagementHistoryFields[" + HistoryITARWarningIndex + "].data", function (newValue, oldValue) {
                if (newValue != undefined && newValue != "") {
                    $scope.historyItarWarning = newValue;
                }
                else {
                    $scope.historyItarWarning = false;
                }
            }, true);

            //$scope.$watch("vm.roleManagementFields[" + ITARWarningIndex + "].data", function (newValue, oldValue) {
            //    if (newValue) {
            //        $scope.itarwarning = newValue;
            //    }
            //    else {
            //        $scope.itarwarning = false;
            //    }
            //}, true);
        }
    }
})();
(function () {
    'use strict';

    angular
        .module('app.tiles')
        .controller('tiles', tiles);

    /* @ngInject */
    function tiles($scope, dataservice, logger, menuSettings, $rootScope, $location) {
        var vm = this;
        vm.title = '';
        vm.menu = '';
        
        vm.menuCheck = function (subMenu) {
            return navcon.menuRightsCheck(menuSettings, vm.menu, subMenu.toLowerCase()) ? false : true;
        }
        
        vm.subMenus = [];
        
        $scope.$on('SUBMENU-LOADING', function(event, menu) {
            vm.menu = menu.toLowerCase();
            vm.subMenus = navcon.getSubMenus(menuSettings, vm.menu);
            vm.title = navcon.getMenuTitle(menuSettings, vm.menu);

        }); 
        
        vm.menu = $location.$$path.substring(1,$location.$$path.length).toLowerCase();
        vm.subMenus = navcon.getSubMenus(menuSettings, vm.menu);
        vm.title = navcon.getMenuTitle(menuSettings, vm.menu);
        
    }
})();
(function () {
    'use strict';
    angular
        .module('app.useraccessrights')
        .controller('useraccessrights', useraccessrights);

    /*@ngInject*/
    function useraccessrights($scope, dataservice, logger, $compile, $timeout, $location, pageConfig, $rootScope, localStorageService, $http, authService, ngAuthSettings, menuSettings) {
        /*Page Declaration*/
        var vm = this;
        activate();

        if (pageConfig === undefined || pageConfig.fields === undefined) {
            $location.url('/');
            return false;
        }

        /* History Fields */
        $scope.isHistory = false;
        $scope.historyState = "Save";
        $scope.HistoryTitle = "Review Changes";
        $scope.hideHistory = false;

        $scope.IsSubsection = 'yes';
        $scope.SubsectionHeading = "Menu";

        vm.rights = navcon.getUserRights(menuSettings, "padministration", "useraccessrights");

        /*Settings*/
        vm.pageConfig = pageConfig;
        vm.userAccessRightsFields = angular.copy(vm.pageConfig.fields.userAccessRightsFields);
        vm.userAccessRightsHistoryFields = angular.copy(vm.pageConfig.fields.userAccessRightsHistoryFields);
        vm.userAccessRightsTree = angular.copy(vm.pageConfig.trees.userAccessRightsTree);
        defaultData(vm.pageConfig.data);
        watchAttributes();

        /*Variable Declaration*/
        vm.primaryKey = "RightsId";
        vm.isSave = true;
        vm.isUpdate = true;
        vm.saveTitle = "";
        vm.selectedDropDown = "";
        vm.newId = -1;
        vm.mode = "Save";
        vm.formManage = {};
        vm.showHistory = false;
        var denyColumnId = "col6";
        vm.showReset = false;

        /*Save*/
        vm.save = function (mode, callback) {
            var RightsIdIndex = navcon.getItemIndexByProperty(vm.userAccessRightsFields, "RightsId");
            if (vm.userAccessRightsTree.core.data === undefined || vm.userAccessRightsTree.core.data.length === 0) {
                logger.warning("Menu - sub menu items should be listed..");
                return;
            }
            else {
                //vm.ProceedToSave();
                var RightsDetailsIndex = navcon.getItemIndexByProperty(vm.userAccessRightsFields, "RightsDetails");
                vm.userAccessRightsTree.oldData = angular.copy(vm.userAccessRightsTree.core.oldData);

                var tree = $("navcon-tree[type='userAccessRights']").find('.jstree').find("div[role='tree']").jstree(false);
                vm.userAccessRightsTree.core.data = tree.settings.core.data;
                var treeNewData = navcon.getDataFromTree(vm.userAccessRightsTree.core.data, '', 0);
                vm.userAccessRightsTree.data = treeNewData; //navcon.getFieldsDataToSave(vm.userAccessRightsFields, mode, "RightsId")

                $scope.Historydata = navcon.comparedata(vm.userAccessRightsFields, 'Security', "", "RightsId", vm.userAccessRightsFields[RightsIdIndex].data);
                var HistoryIndex = navcon.getItemIndexByProperty(vm.userAccessRightsFields, 'History');
                vm.userAccessRightsFields[HistoryIndex].data = $scope.Historydata;
                vm.HistoryTitle = 'Review Changes';

                if ($scope.Historydata !== undefined && $scope.Historydata.length > 0) {
                    $scope.Historydata.splice(0, 1); //excluding Role Dropdownlist
                }

                if ($scope.Historydata !== undefined && $scope.Historydata.length > 0) {
                    for (var i = 0; i < $scope.Historydata.length; i++) {
                        if ($scope.Historydata[i].oldData === 0 || $scope.Historydata[i].oldData === false) $scope.Historydata[i].oldData = "No";
                        if ($scope.Historydata[i].oldData === 1 || $scope.Historydata[i].oldData === true) $scope.Historydata[i].oldData = "Yes";

                        if ($scope.Historydata[i].NewData === 0 || $scope.Historydata[i].NewData === false) $scope.Historydata[i].NewData = "No";
                        if ($scope.Historydata[i].NewData === 1 || $scope.Historydata[i].NewData === true) $scope.Historydata[i].NewData = "Yes";
                    }

                    $scope.hideHistory = false;
                    $scope.isHistory = true;
                    $scope.historyState = "Save";
                    navcon.openModal('review');
                }
                else {
                    $scope.hideHistory = true;
                    $scope.isHistory = false;
                    navcon.openModal('notFound');
                }
            }
        };

        $scope.saveChanges = function () {
            if (vm.formManage.formValid(vm.userAccessRightsHistoryFields)) {
                var HistoryRemarksIndex = navcon.getItemIndexByProperty(vm.userAccessRightsFields, "HistoryRemarks");
                var RemarksIndex = navcon.getItemIndexByProperty(vm.userAccessRightsHistoryFields, "HistoryRemarks");
                var objHistory = { Remarks: vm.userAccessRightsHistoryFields[RemarksIndex].data };
                console.log(objHistory);
                vm.userAccessRightsFields[HistoryRemarksIndex].data = objHistory;
                vm.ProceedToSave();
            }
        };

        vm.ProceedToSave = function () {
            var type = "userAccessRights";
            vm.saveTitle = navcon.save.treeAction(vm, dataservice, vm.mode, type, vm.userAccessRightsFields,
                null, null, vm.primaryKey, "", vm.userAccessRightsTree.core.data, "", function (data) {
                    vm.saveTitle = data;
                    //getRightsById();
                    $('#User').removeClass('in');
                    vm.showHistory = false;
                    vm.showReset = false;

                    if (data !== undefined && vm.mode == "Update")
                        logger.success("Entries are updated successfully...");
                    if (data !== undefined && vm.mode == "Save")
                        logger.success("Entries are saved successfully...");

                    $scope.cancel('review');
                    navcon.clearFieldsData(vm.userAccessRightsHistoryFields);
                });

            defaultData(vm.pageConfig.data);
            vm.userAccessRightsTree.core.data = [];
            vm.mode = "Save";
        }

        $scope.HistoryChanges = function () {
            $scope.hideHistory = false;
            var idNameIndex = navcon.getItemIndexByProperty(vm.userAccessRightsFields, "RightsId");

            dataservice.getData("History/GetHistory/RightsId/" + vm.userAccessRightsFields[idNameIndex].data).then(function (data) {
                $scope.HistoryTitle = "History";

                if (data != undefined && data != null && data.length > 0) {
                    $scope.Historydata = data;
                    $scope.hideHistory = false;
                } else {
                    $scope.Historydata = data;
                    $scope.hideHistory = true;
                }

                $scope.isHistory = true;
                $scope.historyState = "View";
                navcon.openModal('review');
            });
        };

        $scope.cancel = function (type) {
            $scope.isHistory = false;
            navcon.closeModal(type);
            navcon.clearFieldsData(vm.userAccessRightsHistoryFields);
            $scope.Historydata = [];
            $scope.historyState = "Save";
        }

        vm.cancel = function () {
            defaultData(vm.pageConfig.data);
            vm.userAccessRightsTree.core.data = [];
            vm.mode = "Save";
            $('#User').removeClass('in');
            vm.showHistory = false;

            $scope.isHistory = false;
            navcon.closeModal(type);
            navcon.clearFieldsData(vm.userAccessRightsHistoryFields);
            $scope.Historydata = [];
            $scope.historyState = "Save";
        };

        vm.showHide = function (id, mode) {
            if (!$('#' + id).hasClass('in')) {
                $('#' + id).toggleClass('in');
            }
        }

        vm.showRights = function () {

            vm.showReset = false;

            if (vm.formManage.formValid(vm.userAccessRightsFields)) {
                var checkNodes = 0;
                var roleIndex = navcon.getItemIndexByProperty(vm.userAccessRightsFields, "RoleId");
                if (vm.userAccessRightsFields[roleIndex].data === undefined || vm.userAccessRightsFields[roleIndex].data === "" || vm.userAccessRightsFields[roleIndex].data.length === 0) {
                    logger.warning(vm.userAccessRightsFields[roleIndex].templateOptions.requiredMessage);
                    $('#User').removeClass('in');
                    vm.showHistory = false;
                    return;
                }
                if (vm.newId !== -1) {

                    vm.showHide('User');
                    vm.showReset = true;

                    if (vm.newId !== undefined) {
                        getServerData(vm.selectedDropDown, vm.newId).then(function (data) {
                            if (data === undefined || data === null || data.length === 0) return;
                            vm.userAccessRightsTree.core.data = data.Menu;

                            vm.formManage.userAccessRightsTree = vm.userAccessRightsTree;
                            var RightsIdIndex = navcon.getItemIndexByProperty(vm.userAccessRightsFields, "RightsId");
                            vm.userAccessRightsFields[RightsIdIndex].data = data.RightsId;

                            if (data.RightsId === 0) {
                                vm.mode = "Save";
                                vm.isSave = false;
                                vm.isUpdate = true;
                            }
                            else {
                                vm.mode = "Update";
                                vm.isSave = true;
                                vm.isUpdate = false;
                            }

                            $('.jstree-grid-midwrapper').find('input').removeAttr("disabled");

                            if (data.IsSystemRole) {
                                vm.isSave = true;
                                vm.isUpdate = true;
                                vm.showHistory = false;

                                $timeout(function () {
                                    $('.jstree-grid-midwrapper').find('input').attr("disabled", "disabled");
                                    //$('.jstree-ocl').removeClass('jstree-icon');
                                }, 800);
                            }
                            else {
                                vm.showHistory = true;
                                vm.userAccessRightsTree.core.oldData = angular.copy(navcon.getDataFromTree(vm.userAccessRightsTree.core.data, '', 0));
                            }
                        });
                    }
                }
            }
            else {
                logger.warning("Invalid entries...", "", "");
            }
        };

        vm.reset = function () {
            var RoleIdIndex = navcon.getItemIndexByProperty(vm.userAccessRightsFields, "RoleId");
            vm.userAccessRightsFields[RoleIdIndex].data = [];
            $('#User').removeClass('in');
            vm.showReset = false;

            //$location.path('useraccessrights/');
            //$('#User').removeClass('in');
        }

        vm.treeActionClick = function (action, type, text, data, oTree, target) {

        };

        vm.treeCellClick = function (id, field, value, node, oTree) {

            //var type = "userAccessRights";
            //var data = vm.userAccessRightsTree.core.data;
            //var tree = $("navcon-tree[type='" + type + "']").find('.jstree').find("div[role='tree']").jstree(true);
            //if (tree.settings !== undefined && tree.settings.core.data.length !== 0) data = tree.settings.core.data;            

            //if (field === 'Deny' && value === true) {
            //    $("[data-jstreegrid=" + id + "]").find("INPUT").attr("checked", false);
            //    $("[id=jsgrid_" + id + "_" + denyColumnId + "]").find("INPUT").attr("checked", true);                

            //    if (data !== undefined && data.length !== 0) {
            //        var treeData = navcon.getDataFromTree(data, '', 0);
            //        var currentIndex = navcon.getItemIndexByKeyValue(treeData, "id", parseFloat(node.data.id));
            //        treeData[currentIndex].data.Add = 0;
            //        treeData[currentIndex].data.Edit = 0;
            //        treeData[currentIndex].data.Delete = 0;
            //        treeData[currentIndex].data.View = 0;
            //        treeData[currentIndex].data.PRINT = 0;
            //    }
            //    node.data.Add = false;
            //    node.data.Edit = false;
            //    node.data.Delete = false;
            //    node.data.View = false;
            //    node.data.PRINT = false;
            //}
            //else {
            //    $("[id=jsgrid_" + id + "_" + denyColumnId + "]").find("INPUT").attr("checked", false);

            //    if (data !== undefined && data.length !== 0) {
            //        var treeData = navcon.getDataFromTree(data, '', 0);
            //        var currentIndex = navcon.getItemIndexByKeyValue(treeData, "id", parseFloat(node.data.id));
            //        treeData[currentIndex].data.Deny = 0;
            //    }
            //    node.data.Deny = false;
            //}
        };

        /*Private functions*/
        function getServerData(type, rowId) {
            return dataservice.getServerData(type, rowId).then(function (data) {
                return data;
            });
        };

        function activate() {

        };

        function getRightsById() {
            var serviceBase = ngAuthSettings.apiServiceBaseUri;
            $http.get(serviceBase + 'home/Security/' + authService.authentication.userId, { headers: { 'Content-Type': 'application/json' } }).success(function (rights) {
                var authData = localStorageService.get('authorizationData');
                authData.userRights = rights;
                localStorageService.set('authorizationData', authData);
                authService.fillAuthData();
                menuSettings.data = rights;
                $rootScope.$broadcast('MENU-SETTING-DATA-REFRESH');
            }).error(function (err, status) {

            });
        };

        function defaultData(data) {
            navcon.save.loadListDefaultData(data, vm.userAccessRightsFields);
        }

        function watchAttributes() {
            var roleItemIndex = navcon.getItemIndexByProperty(vm.userAccessRightsFields, "RoleId");

            $scope.$watch("vm.userAccessRightsFields[" + roleItemIndex + "].data", function (newValue, oldValue) {
                if (newValue != undefined && newValue !== oldValue) {

                    vm.selectedDropDown = 'userAccessRightsRoleId';
                    vm.newId = newValue.RoleId;
                    vm.userAccessRightsTree.core.data = [];
                    vm.mode = "Save";
                    vm.isSave = true;
                    vm.isUpdate = true;
                    $('#User').removeClass('in');
                    vm.showHistory = false;
                    vm.showReset = false;
                }
            }, true);

            $scope.$watch("vm.userAccessRightsTree.core.data", function (newValue, oldValue) {
                if (newValue === undefined || newValue === "" || newValue.length === 0) {
                    $rootScope.$broadcast('FOOTER-CHANGE', '');
                } else {
                    $rootScope.$broadcast('FOOTER-CHANGE', 'S');
                }
            });

            // History ITAR  Watch
            var HistoryITARWarningIndex = navcon.getItemIndexByProperty(vm.userAccessRightsHistoryFields, "ITARWarning");
            $scope.$watch("vm.userAccessRightsHistoryFields[" + HistoryITARWarningIndex + "].data", function (newValue, oldValue) {
                if (newValue != undefined && newValue != "") {
                    $scope.historyItarWarning = newValue;
                }
                else {
                    $scope.historyItarWarning = false;
                }
            }, true);
        };
    }
})();



(function () {
    'use strict';

    angular
        .module('app.userimport')
        .controller('userimport', userimport);

    /* @ngInject */
    function userimport($scope, dataservice, logger, $compile, $timeout, $location, pageConfig, $rootScope, menuSettings, ngAuthSettings) {
        var vm = this;

        if (pageConfig === undefined || pageConfig.fields === undefined) {
            $location.url('/');
            return false;
        }

        vm.rights = navcon.getUserRights(menuSettings, "padministration", "userimport");

        /*Settings*/
        vm.pageConfig = pageConfig;
        vm.userImportFields = angular.copy(vm.pageConfig.fields.userImportFields);
        vm.userImportTable = angular.copy(vm.pageConfig.tables.userImportTable);
        defaultData(vm.pageConfig.data);

        /*Variable Declaration*/
        vm.primaryKey = "Id";
        var type = "userImport";
        vm.formManage = {};

        /*Close*/
        vm.close = function (type) {
            $('#ResultsTable').removeClass('in');
        };

        vm.process = function () {
            //if (vm.formManage.formValid(vm.userImportFields)) {
            var importFields = navcon.getFieldsDataToSave(vm.userImportFields, 'Save', '', true);
            vm.userImportTable.data = [];
            $('#ResultsTable').removeClass('in');

            if (importFields.fuattachments === "" || importFields.fuattachments.length === 0)
                logger.warning("Please choose a File.");
            else {
                var formData = importFields["filesUpload"];
                if (formData != undefined && formData != null) {
                    var dataInfo = {
                        folder: "Excel",
                        id: 1
                    };
                    formData.append("data", JSON.stringify(dataInfo));

                    dataservice.excelFileUpload(formData).then(function (uploadData) {
                        if (uploadData !== undefined) {
                            vm.userImportTable.data = uploadData;
                            vm.showHide('ResultsTable');
                        }
                    });
                }
            }
            //}
        }

        vm.download = function () {
            var link = document.createElement("a");
            link.download = name;
            link.href = getServerURL("userImportFile");

            if (window.navigator && window.navigator.msSaveOrOpenBlob) {
                window.open(link.href, 'download_window', 'toolbar=0,location=no,directories=0,status=0,scrollbars=0,resizeable=0,width=1,height=1,top=0,left=0');
            } else {
                link.click();
            }
        }

        function getServerURL(type, rowId) {
            var returnData = '';
            returnData = navcon.route.UI(ngAuthSettings.loginServiceUri, type, rowId);
            return returnData;
        }

        vm.showHide = function (id, mode) {
            if (!$('#' + id).hasClass('in')) {
                $('#' + id).toggleClass('in');
            }
        }

        function clearFields() {
            navcon.clearFieldsData(vm.userImportFields);
        }

        function getServerData(type, rowId) {
            return dataservice.getServerData(type, rowId).then(function (data) {
                return data;
            });
        };

        function defaultData(data) {
            navcon.save.loadListDefaultData(data, vm.userImportFields);
        }
    }
})();
(function () {
    'use strict';

    angular
        .module('app.usermanagement')
        .controller('usermanagement', usermanagement);

    function usermanagement($scope, dataservice, logger, $compile, $timeout, $location, pageConfig, $rootScope, menuSettings) {
        var vm = this;
      //  activate();
        vm.readOnly = false;

        if (pageConfig === undefined || pageConfig.fields === undefined) {
            $location.url('/');
            return false;
        }
        vm.rights = navcon.getUserRights(menuSettings, "padministration", "usermanagement");
        vm.formManage = {};
        //  vm.rights = navcon.getUserRights(menuSettings, "padministration", "kendofields");
        /*Settings*/
        vm.pageConfig = pageConfig;
        vm.kendofieldsFields = angular.copy(vm.pageConfig.fields.kendofieldsFields);
        //vm.kendofieldsTable = angular.copy(vm.pageConfig.tables.kendofieldsTable);
        defaultData(vm.pageConfig.data);
        function defaultData(data) {
            navcon.save.loadListDefaultData(data, vm.kendofieldsFields);
            navcon.kendo.loadListDefaultData(data, vm.kendofieldsFields);
        }
        
    }
})();
(function () {
    'use strict';

    angular
        .module('app.userprofile')
        .controller('userprofile', userprofile);

    /* @ngInject */
    function userprofile($scope, dataservice, logger, $compile, $timeout, $location, authService, pageConfig, $rootScope, menuSettings, ngAuthSettings) {
        var vm = this;
        vm.userId = authService.authentication.userId;
        vm.userName = authService.authentication.userName;
        vm.SSOStatus = ngAuthSettings.SSO;

        if (pageConfig === undefined || pageConfig.fields === undefined) {
            $location.url('/');
            return false;
        }

        vm.rights = navcon.getUserRights(menuSettings, "padministration", "userprofile");

        /*Settings*/
        vm.pageConfig = pageConfig;
        vm.userProfileFields = angular.copy(vm.pageConfig.fields.userProfileFields);
        vm.changePasswordFields = angular.copy(vm.pageConfig.fields.changePasswordFields);
        defaultData(vm.pageConfig.data);
        activate();

        /*Variable Declaration*/
        vm.primaryKey = "Id";
        var type = "userProfile";
        var userNameIndex;
        var userIdIndex;
        var userNameIndex;
        vm.readOnly = true;
        vm.formManage = {};

        vm.cancel = function (type) {
            if (type === 'userprofile') {
                clearFields();
                getUserById();

                vm.enableFields(false);
                vm.isUpdate = true;
                vm.readOnly = true;
            }
            else if (type === 'changePassword') {                
                $('#' + 'ChangePassword').toggleClass('in');
                $('#' + 'ChangePassword').parent('.panel').find('.panel-heading .panel-title:first').addClass('collapsed');
                $('#ChangePassword').removeClass('in');
            }
        };

        /*Edit*/
        vm.edit = function () {
            vm.enableFields(true);
            vm.isEdit = true;
            vm.isUpdate = false;
            vm.isCancel = false;
        };

        vm.save = function (type, callback) {
            vm.mode = "Update";
            if (type === 'userprofile') {
                if (vm.formManage.formValid(vm.userProfileFields)) {
                    navcon.save.saveOption(vm, dataservice, vm.mode, type, vm.userProfileTable, vm.userProfileFields, vm.selectedRow, vm.primaryKey, "", "", "", true, "", function (data) {
                        //if (callback !== undefined)
                        //    callback(data === undefined ? false : true);

                        if (data !== undefined) {
                            clearFields();
                            getUserById();
                            logger.success("Entries are updated successfully...");
                        }
                        vm.readOnly = true;
                        vm.isEdit = false;
                        vm.isUpdate = true;
                        vm.isCancel = false;
                    });
                }
            }
            else if (type === 'changePassword') {
                if (vm.formManage.formValid(vm.changePasswordFields)) {
                    userIdIndex = navcon.getItemIndexByProperty(vm.changePasswordFields, "Id");
                    userNameIndex = navcon.getItemIndexByProperty(vm.changePasswordFields, "UserName");

                    vm.changePasswordFields[userIdIndex].data = parseInt(vm.userId);
                    vm.changePasswordFields[userNameIndex].data = vm.userName;
                    
                    navcon.save.saveOption(vm, dataservice, vm.mode, type, "", vm.changePasswordFields, vm.changePasswordFields.selectedRow, vm.primaryKey, vm.displayKey, 0, false, false, "", function (data) {
                        if (data !== undefined) {
                            clearPasswordFields();
                            logger.success("Password changed successfully...");
                            $('#' + 'ChangePassword').toggleClass('in');
                            $('#' + 'ChangePassword').parent('.panel').find('.panel-heading .panel-title:first').addClass('collapsed');
                            $('#ChangePassword').removeClass('in');
                        }
                        //else {
                        //    logger.warning("Old Password is incorrect.")
                        //}
                    });
                }
            }
        };

        vm.showPassword = function () {
            clearPasswordFields();
            vm.showHide('ChangePassword');
        }

        vm.showHide = function (id, mode) {
            if (!$('#' + id).hasClass('in')) {
                $('#' + id).toggleClass('in');
            }
        }

        function clearFields() {
            navcon.clearFieldsData(vm.userProfileFields);
            //userImageIndex = navcon.getItemIndexByProperty(vm.userProfileFields, "UserImage");
            //vm.userProfileFields[userImageIndex].data = "";
        }

        function clearPasswordFields() {
            navcon.clearFieldsData(vm.changePasswordFields);
        }

        vm.enableFields = function (isEnabled) {
            vm.readOnly = !isEnabled;
        }

        vm.togglePanel = function (id) {
            $('#' + id).toggleClass('in');

            if ($('#' + id).hasClass('in')) {

                $('#' + id).parent('.panel').find('.panel-heading .panel-title:first').removeClass('collapsed');
            }
            else {
                $('#' + id).parent('.panel').find('.panel-heading .panel-title:first').addClass('collapsed');
            }
        }

        function getUserById() {
            clearFields();

            var dataUser = getServerData('userProfileId').then(function (dataUser) {
                if (dataUser !== undefined && dataUser !== null) {
                    navcon.updateFieldsData(vm.userProfileFields, dataUser, vm, false, vm.navconData);
                    vm.isEdit = false;
                    vm.isUpdate = true;
                    vm.isCancel = false;

                    var IdIndex = navcon.getItemIndexByProperty(vm.userProfileFields, "Id");
                    var documentIdIndex = navcon.getItemIndexByProperty(vm.userProfileFields, "documentId");
                    if (dataUser.documentId === undefined || dataUser.documentId === null || dataUser.documentId === "")
                        vm.userProfileFields[documentIdIndex].data = vm.userProfileFields[IdIndex].data;

                    if (dataUser.documents !== undefined && dataUser.documents !== null && dataUser.documents.DocumentName !== undefined && dataUser.documents.DocumentName !== null) {
                        var documentNameIndex = navcon.getItemIndexByProperty(vm.userProfileFields, "DocumentName");
                        vm.userProfileFields[documentNameIndex].data = dataUser.documents.DocumentName;
                    }

                    if (dataUser.img !== undefined && dataUser.img !== null && dataUser.img !== "") {
                        //var userImageIndex = navcon.getItemIndexByProperty(vm.userProfileFields, "img");
                        //vm.userProfileFields[userImageIndex].data = dataUser.img;
                        $rootScope.userProfileImage = dataUser.img;
                    }
                }
            });
        }

        function getServerData(type, rowId) {
            return dataservice.getServerData(type, rowId).then(function (data) {
                return data;
            });
        };

        function activate() {
            getUserById();                        
            watchAttributes();            
        };

        function defaultData(data) {
            navcon.save.loadListDefaultData(data, vm.userProfileFields);
        }

        function watchAttributes() {
            var userImageIndex = navcon.getItemIndexByProperty(vm.userProfileFields, "img");
            $scope.$watch("vm.userProfileFields[" + userImageIndex + "].templateOptions.keyReturn", function (newValue, oldValue) {
                if (newValue !== undefined && newValue !== oldValue) {
                    if (newValue.error !== undefined && newValue.error.length > 0) {
                    } else if (newValue.removed !== undefined) {
                        var IdIndex = navcon.getItemIndexByProperty(vm.userProfileFields, "Id");
                        var documentIdIndex = navcon.getItemIndexByProperty(vm.userProfileFields, "documentId");
                        vm.userProfileFields[documentIdIndex].data = vm.userProfileFields[IdIndex].data;
                        $rootScope.userProfileImage = "/9j/4AAQSkZJRgABAQAAAQABAAD/2wCEAAkGBhAQERUQEBAVFRAUEhoYEBESDxQSEhUSFRgVIBYUEhcYHCcfFxsvGxIXHy8gIycqLDgtFR4yNTAqNSYrLCoBCQoKBQUFDQUFDSkYEhgpKSkpKSkpKSkpKSkpKSkpKSkpKSkpKSkpKSkpKSkpKSkpKSkpKSkpKSkpKSkpKSkpKf/AABEIALwAkAMBIgACEQEDEQH/xAAbAAEAAgMBAQAAAAAAAAAAAAAAAgUBBAYDB//EAEMQAAICAQEDCAcDCgQHAAAAAAECAAMRBBIhMQUGMkFRYXGBEyIjQlKRoTNighRDcnOisbLB0fA0dJLSJFNjo7PCw//EABQBAQAAAAAAAAAAAAAAAAAAAAD/xAAUEQEAAAAAAAAAAAAAAAAAAAAA/9oADAMBAAIRAxEAPwD7hmMzEQM5jMxEDOYzMRAzmMzQ5U5bp0wHpW9ZuhWql7Hxx2UG8+PCVp52P1aK4r2l6FbyU2fvgdDmMygHO4e9pNQPBK3/AIXMmvPHS+96VP09NcB5kKRAvMxmVmm5y6Ow4TU1Fvh9Kob/AEkgyygZzGZiIGcxmYiBnMZmIgYzGZHMZgSzGZHMZgSzKjlvl8U+yqAs1TD1a8+qgP5y4jop9TwHaNXlzlpy502mbFg+3uxkUqRuCjg1pHAcAN56gdHSaNKgQg4nLsSWd262djvY95gR0uj2S1jsXuf7S1uk3YoHuoOpRuHjvmxEjdcqKXYgKoyzE4AA4kwJTM1tBrluTbUMPWIKuNl1IPBlO9TjBwe0TYgQu06OMOqsOxlDD5Geei17aEjJLaI7mUks2n++hO81dq+7xG7InrZaq9IgeJA/fPCvlKh29Gt1bMR0FtRiR17gYHYhgd44dRmczmebWs9C/wCRsfUwW0hJz7MdKn8OQR90j4Z0mYEsxmRzGYEsxmRzGYGMxmRzGYEsyp5wcrtSq104OptyKgRkIo6Vrj4VyN3WSB1y0zOVb1tVqXPEOta9yIinA7BtOx8TAaPSLUuyCTvJZmOWdzvZ3PWSd89oiAkeRuT/AMscXP8A4WtvYr1XWKftW7awR6o6yNrgBPDlPTtZTZWpwzVsqnvIOP7751HI2rS2iqysBUatSqgYCjA9THVjhjuga+u5s6e5zYVZbG6T1WPWWxw2tk4Y95ngOZul970r9z6m4jzAbfLyIFXVzW0S8NJTntNKM3zIJnrr+RKbqjSUCrxUoArI46LoQNzDt/rN+IHz7VXWVgmwf8To7FsbZGNtBxdB2NVtjHbkdU7lLAwDKcqRkEcCDwIlHzs0wVqdSBvDim3saq3hntw+yR4t2z25qOfySoH3A1flU7IPoggXGYzI5jMCWYzI5jMCOYzI5jMCWZy+ManVD/rK3k9VZH8/lOmzOV5U1C06q5mz61dLKqjLOxL1hVHWdpQPMQNqJ5WU6xV220nq9aper2gfoYwT3Bj3ZmdNqVsUOhyp4H94IO8HIxgwPQnrm7zLYnTsQD6I32GgkEbVTHO0ufd2mbHdiVOpoF1lOmPQtc+lA66q1LMvgTsqe5jO0VQBgDAHADhiBmIiAiIgU3PDTWWaK5ahm0KHrAGTt1sGGB1714SXItVaaepaW26hWNhx74O8v4kkk95lnqbxWjO3RVSzeCjJ+glNzfqZdNXtDDMDYwHANczOVHh6THlAs8xmRzGYEsxmRzGYEcxmQzGYE8yl5T0QfXaKw8FNwI6i2wGTPga2IlvmUnO5bPQpZU2zZVqKmRiMgZbYO0Ph9pg9xMDrJyHLGkfS2WX7AbS2OrOVOGqdsKzMp6Sk4Ykbxlt3XOh5G5TGppW0DZJyHTOSlikh0J7mBE1ud3+C1H6lv3QKrkrfr0z1aW0jxNmnB+k6ycjoX2dbSfiruT5+ib/5zroCIiAiIgeOt0wsres8HRlJ7mBH85U8h6gvpqWPS9EocdjoNlx/qUy8nP8AIf2Tf5i//wA1kCyzGZDMZgTzGZDMZgRzGZHMZgSzPDX6QXVPSxwLEKk9YyNzDvBwfKeuYzA5fkflSzTk37JKE7OvpXeUuTc91Y6+G9etdkjeN/aulWoqwcPTYnirIw+oIM5blqj0L/la9DAGqUfAOjeO9eDdq/ozd5o37Bt0vuV7NlH6q0v6o7g6OB3FYFjo+bWlpcWV0qrrnZYZJGRg4yeyWcRAREQEREDy1WoWtGsY4VFLMfuqCT9BKPkOsrp6g25ym24+/aS7D5uR5Ta51knSWIPzmzV5XOqH6OZJjv8AOBLMZkcxmBLMZkcxmBHMZkMxmBPMZkMxmBP+9/DzlNyTycdLra9ls0WVWV1oR61ZGy6pte8oCvs53gEjfultmVvKeuVL9Gh6b6r1cDgordWY9gzYq+LQOsiIgIiICIiBT85TkUp8eqr+SZc/SuZzKXlvnLpxr0qd9laUbLn7Mai0KFVzwUistvO72g4S3z/fdAnmMyGYzAnmMyGYzAjmMyOYzAlmMyI38JS8oc7NPVlUJusHu1EFQfv2dEeWT3QLm69UUu7BUUZZ2OFUdpM5KjULrWtvYMq7Yro3lXVKjkOCN6sXJb5DqlXylynbqWBuICKcpSmfRqfiOd7t3nyAlnzaHsPGyw/tn+kC+5O50WUYTV5erq1Sr6y/5hB/Gu7tA4zrKrldQyMGUjKspBBB4EEcROJnlpGt0zF9KQFJy+nYkUuesrj7Ju8bu0GB30Sk0XPDSuvtLFosHTqvdK2B7snDj7ykiaPLXOnb9jorFZyPaahGV0qU/CRkNYeodXE9QIe/LfOZkf0GmCtaPtXfJqqHUrBSCzn4QRgbyRuzT36nV2faatwvWtKLSPnvf9qeen061qFXh2k5JJ4sxO8kneSe2esDleVdElV+yigK9QJHaysQxOeJIZck75Lk7lO/TbqbMJ/yXG3V5DOU/CRNjnH9rT+rt/fTK+B02m58D89p3X71TravybZYfWWem50aOzcNQqn4bc0n/uAD6zhoIzxgfTQcjI3g8CN4PgeBjM+YU1+jOay1Z7anao+eyRnzljRzh1icL9sdl1av9Rst9YHcu4ALEgKBlmYhVA7WJ3AeMoNdzyqXdQpub4slKR+MjLfhB8ROY1d9l52r7DYQcgNgVqfuVj1R44z3yMD31/KV+o3XWZQ/mkGxV4EZy/4iZrqoG4DA6gNwmYgJd82T7DHZbYP2j/WUktebD7rU7LdrydV/mD8oF3ERAiyA8QD4jMyqgcBjwmYgIiIHPc4T7esdlT/V6/8AbNCbfLpzqfChfmz2f7ZqQEREBERAREQEREBNrkO3Z1GOqysj8VZyP2Wf5TVkLbCmzaONbBwO0DpDzUkQOziRrsDAMpyCAQe0HgflJQEREBERA5blVs6mzuWtf2c/+88Jhrdt7LOprWx4L6o/hmYCIiAiIgIiICIiAiIgW3NrVeq1B41H1O+ps7PyOV8hLqccmoNLrcPc3OB11N0h5YDfhnYI4IBByCMgjgQeBEDMREBNTlXWehpewdIL6ne53KPmRNuc/wA49TtOlI4L7Szx3isHz2m/CIFZRVsqF7AB8uuTiICIiAiIgIiICIiAiIgJZc29Zs50ze6C1PfX1p+En5EdkrZ46u0ovpV3PX6yHvHUe4gkHxgdtEwDMwPPUaha0Z3OFUEse4TkEdnLWP07G2mHwj3V8lAHzltzotPsq/cdyXHbsDKg92cHyErICIiAiIgIiIH/2Q==";
                    } else if (newValue.uploaded !== undefined && newValue.uploaded.length > 0) {
                        $timeout(function () {
                            var dataUser = getServerData('userProfileId').then(function (dataUser) {
                                if (dataUser !== undefined && dataUser !== null) {
                                    navcon.updateFieldsData(vm.userProfileFields, dataUser, vm, false, vm.navconData);

                                    var IdIndex = navcon.getItemIndexByProperty(vm.userProfileFields, "Id");
                                    var documentIdIndex = navcon.getItemIndexByProperty(vm.userProfileFields, "documentId");
                                    if (dataUser.documentId === undefined || dataUser.documentId === null || dataUser.documentId === "")
                                        vm.userProfileFields[documentIdIndex].data = vm.userProfileFields[IdIndex].data;

                                    if (dataUser.documents !== undefined && dataUser.documents !== null && dataUser.documents.DocumentName !== undefined && dataUser.documents.DocumentName !== null) {
                                        var documentNameIndex = navcon.getItemIndexByProperty(vm.userProfileFields, "DocumentName");
                                        vm.userProfileFields[documentNameIndex].data = dataUser.documents.DocumentName;
                                    }

                                    if (dataUser.img !== undefined && dataUser.img !== null && dataUser.img !== "") {
                                        //var userImageIndex = navcon.getItemIndexByProperty(vm.userProfileFields, "img");
                                        //vm.userProfileFields[userImageIndex].data = dataUser.img;
                                        $rootScope.userProfileImage = dataUser.img;
                                    }
                                }
                            });
                        });
                    }
                }
            });

            var ITARWarningIndex = navcon.getItemIndexByProperty(vm.userProfileFields, "ITARWarning");
            $scope.$watch("vm.userProfileFields[" + ITARWarningIndex + "].data", function (newValue, oldValue) {
                if (newValue) {
                    vm.itarwarning = newValue;
                }
                else {
                    vm.itarwarning = false;
                }
            }, true);
        }
    }
})();
(function() {
    'use strict';
    angular
        .module('app.news')
        .controller('news', news);

    /* @ngInject */
    function news($scope, dataservice, logger, $compile, $timeout, $location, pageConfig, $rootScope, menuSettings) {
        var vm = this;


        if (pageConfig === undefined || pageConfig.fields === undefined) {
            $location.url('/');
            return false;
        }

        //vm.rights = navcon.getRoleRights(menuSettings, "Administration", "Bulletin Management");

        /*Settings*/
        vm.pageConfig = pageConfig;

        /*Page Config Common Varriable Assign */
        navcon.getPageConfig(vm, vm.pageConfig);
        //vm.newsFields = angular.copy(vm.pageConfig.fields.newsFields);
        activate();
        defaultData(vm.pageConfig.data);

        /*Variable Declaration*/
        vm.readOnly = true;
        vm.isViewMode = true;
        vm.isEdit = false;
        vm.isSaveHide = true;
        vm.isDeleteHide = true;

        vm.formManage = {};

        /*Page Actions*/
        vm.showHide = function(type, isShow) {
            if (isShow !== undefined && isShow)
                $('#' + type).addClass('in');
            else if (isShow !== undefined && !isShow)
                $('#' + type).removeClass('in');
            else if (!$('#' + type).hasClass('in')) {
                $('#' + type).toggleClass('in');
            } else {
                $('#' + type).removeClass('in');
            }

        };

        vm.enableFields = function(isEnabled) {
            vm.readOnly = !isEnabled;
        }

        /*Add New*/
        vm.addNew = function(type) {
            if (type === "NewsAnnouncements") {
                vm.newsFields.selectedRow = -1;
                vm.newsFields.mode = "Save";

                navcon.save.addNewOption($scope, vm.pageConfig.fields.newsFields, vm.newsFields, "News Announcement", "", function(data) {
                    vm.showHide(type, true);
                    vm.isSaveHide = false;
                    vm.isEdit = false;

                    vm.enableFields(true);
                }, false);
            }
        };

        /*Cancel*/
        vm.cancel = function(type) {
            if (type === 'newsDeleteModal') {
                navcon.closeModal(type);
            } else if (type === 'NewsAnnouncements') {

                vm.isSaveHide = true;

                vm.enableFields(false);

                if (vm.isEdit) {
                    getById();
                } else {
                    vm.showHide(type, false);
                }
            }
        };

        /*Edit*/
        vm.edit = function() {
            vm.enableFields(true);

            vm.isSaveHide = false;
            vm.isDeleteHide = false;
        };

        /*Save*/
        vm.save = function(type, mode, callback) {
            if (type === "NewsAnnouncements") {
                if (vm.formManage.formValid(vm.newsFields)) {
                    vm.deleteModalTitle = navcon.save.saveOption(vm, dataservice, vm.newsFields.mode, type, vm.newsTable, vm.newsFields, vm.newsFields.selectedRow, vm.newsFields.primaryKey, vm.newsFields.displayKey, "", true, "", "", function(data) {
                        navcon.clearFieldsData(vm.newsFields, $scope, false);
                        $('#' + type).removeClass('in');

                        if (callback !== undefined)
                            callback(data === undefined || data === null ? false : true);
                    });
                }
            }
        };

        /*Delete*/
        vm.delete = function(type, callback) {
            //navcon.openModal(type + 'DeleteModal');

            var action = "delete";
            vm.newsFields.mode = "Delete";
            var data = vm.newsFields.getById;

            vm.newsFields.selectedRow = navcon.save.selectedRowIndex(vm.newsTable, data, vm.newsFields.primaryKey);

            navcon.save.saveOption(vm, dataservice, vm.newsFields.mode, type, vm.newsTable, vm.newsFields, vm.newsFields.selectedRow, vm.newsFields.primaryKey, vm.newsFields.displayKey, "", false, "", "", function(data) {
                vm.newsFields.mode = "Update";
            });
        }


        /*Delete*/
        vm.tableRowDelete = function(type, modal, callback) {
            if (type === "NewsAnnouncements") {
                if (modal === "No") {
                    navcon.closeModal(type + 'delete');
                } else {
                    navcon.save.deleteOption(dataservice, type, vm.newsTable, vm.newsFields.selectedRow, vm.newsFields.primaryKey, "", function(data) {
                        vm.isEdit = false;
                        vm.isSaveHide = true;
                        vm.enableFields(false);
                        vm.showHide(type, false);

                        if (callback !== undefined)
                            callback(data === undefined || data === null ? false : true);
                    });
                }
            }
        };

        vm.tableCellClick = function(row, column, data, type, cellObj, oTable) {
            if (type === "NewsAnnouncements") {
                var action = "edit";
                vm.newsFields.mode = "Update";
                vm.newsFields.selectedRow = navcon.save.selectedRowIndex(vm.newsTable, data, vm.newsFields.primaryKey);

                vm.mainFormTitle = navcon.save.viewOption($scope, action, type, vm.newsTable, vm.newsFields, data, vm.newsFields.primaryKey, vm.newsFields.displayKey, dataservice, true, function(data) {
                    //vm.mainFormTitle = data;

                    vm.showHide(type, true);

                    vm.enableFields(false);

                    vm.isEdit = true;
                    vm.isSaveHide = true;
                }, "", false, "");
            }
        }

        /*Row Data change*/
        vm.tableRowUpdate = function(row, data, index, type, cellObj, oTable) {
            if (type === "NewsAnnouncements") {
                if (data.IsPublish != null && data.IsPublish !== undefined && data.IsPublish) {
                    $(row).children().eq(3).html("<a href='javascript:;'>Yes</a>");
                } else {
                    $(row).children().eq(3).html("<a href='javascript:;'>No</a>");
                }
                //if (data.DocumentPath !== null && data.DocumentPath !== "" && data.DocumentPath.length !== 0) {
                //    var applyData = "";
                //    $.map(data.DocumentPath, function (item, index) {
                //        if (item.DocumentPath !== null && item.DocumentPath !== "" && item.DocumentPath.length !== 0) {
                //            var url = uploadBase + item["DocumentPath"].toString();
                //            applyData += "<a href='javascript:;' onclick=\"window.open('" + url + "')\">" + item["DocumentName"].toString() + ";</a>&nbsp;&nbsp;";
                //        }
                //    });
                //    $(row).children().eq(0).html(applyData);
                //} else {
                //    var columnText = $(row).children().eq(0).text();
                //    $(row).children().eq(0).html("<a href='javascript:;'>" + columnText + "</a>");
                //}
            }
        };

        //vm.closePopup = function (modalType, action) {
        //    if (action === "No") {
        //        navcon.closeModal(modalType);
        //    }
        //    else
        //        if (action === "Yes") {
        //            navcon.save.deleteOption(dataservice, type, vm.newsTable, vm.selectedRow, vm.primaryKey, "", function (data) {
        //                //if (callback !== undefined)
        //                //    callback(data === undefined ? false : true);
        //                closeModal('delete');
        //                navcon.closeModal(modalType);
        //                if (data !== undefined)
        //                    logger.success("Entries are deleted successfully...");
        //            });
        //        }
        //}

        //function closeModal(mode) {
        //    if (mode === 'delete') {
        //        clearFields();
        //        $('#Role').removeClass('in');
        //    }
        //    else {
        //        vm.readOnly = true;
        //        vm.showHide('Role');
        //    }
        //}

        //function clearFields() {
        //    roleIdIndex = navcon.getItemIndexByProperty(vm.newsFields, "RoleId");
        //    roleNameIndex = navcon.getItemIndexByProperty(vm.newsFields, "RoleName");
        //    allRightsIndex = navcon.getItemIndexByProperty(vm.newsFields, "AllRights");
        //    projectRoleIndex = navcon.getItemIndexByProperty(vm.newsFields, "ProjectRole");
        //    roleStatusIndex = navcon.getItemIndexByProperty(vm.newsFields, "RoleStatus");
        //    remarksIndex = navcon.getItemIndexByProperty(vm.newsFields, "Remarks");
        //    roleStatusNameIndex = navcon.getItemIndexByProperty(vm.newsFields, "RoleStatusName");

        //    vm.newsFields[roleIdIndex].data = 0;
        //    vm.newsFields[roleNameIndex].data = "";
        //    vm.newsFields[allRightsIndex].data = false;
        //    vm.newsFields[projectRoleIndex].data = "";
        //    vm.newsFields[roleStatusIndex].data = true;
        //    vm.newsFields[remarksIndex].data = "";
        //    vm.newsFields[roleStatusNameIndex].data = "";
        //}


        function getById() {
            if (vm.newsFields.getById !== undefined && vm.newsFields.getById !== null && vm.newsFields.getById.length !== 0) {
                navcon.clearFieldsData(vm.newsFields);

                navcon.updateFieldsData(vm.newsFields, vm.newsFields.getById, vm, false);
            }
        }

        function getServerData(type, rowId) {
            return dataservice.getServerData(type, rowId).then(function(data) {
                return data;
            });
        };

        function activate() {
            getServerData('newsAnnouncementsAll').then(function(data) {
                //navcon.setDisabledEnabledByRights(vm.rights);
                if (data === undefined || data === null || data.length === 0) return;

                vm.newsTable.data = data;
                vm.newsTableData = data;
            });

            watchAttributes();
        };

        function defaultData(data) {
            navcon.save.loadListDefaultData(data, vm.newsFields);
        }

        function watchAttributes() {
            var ITARWarningIndex = navcon.getItemIndexByProperty(vm.newsFields, "ITARWarning");
            $scope.$watch("vm.newsFields[" + ITARWarningIndex + "].data", function(newValue, oldValue) {
                if (newValue) {
                    vm.itarwarning = newValue;
                } else {
                    vm.itarwarning = false;
                }
            }, true);
        }
    }
})();
"use strict";

angular.module("navconFramework").controller("navconFrameworkController",
    ['$scope', '$window', '$timeout', '$rootScope', '$location', 'routehelper', 'authService', 'dataservice', 'menuSettings', 'signalRHubProxy', 'logger', 'ngAuthSettings', 'localStorageService', 'Idle',
        function ($scope, $window, $timeout, $rootScope, $location, routehelper, authService, dataservice, menuSettings, signalRHubProxy, logger, ngAuthSettings, localStorageService, Idle) {

            var routes = routehelper.getRoutes();
            $scope.userName = "";
            $scope.UserFullName = "";
            $scope.Designation = "";
            $scope.commPageConfig = "",
            $scope.commItemId = "",
            $scope.commItemPage = "",
            $scope.currentMainmenu = "Home";
            $scope.currentSubmenu = "My Space";
            $scope.currentSubmenuURL = "/myspace".replace('/', '');
            $scope.currentMainmenuicon = "fa fa-home";
            $scope.idleTimeOut = 1800;
            $scope.idleConfirmTimeOut = 5;
            $scope.userProfileImage = "";
            $scope.aboutUsData = {};
            if (ngAuthSettings.sessionTimeOut !== undefined && ngAuthSettings.sessionTimeOut > 0) {
                $scope.idleTimeOut = ngAuthSettings.sessionTimeOut;
                if (ngAuthSettings.sessionTimeOut < 60)
                    $scope.idleTimeOut = 60;
            }

            if (ngAuthSettings.sessionConfirmTimeOut !== undefined && ngAuthSettings.sessionConfirmTimeOut > 0)
                $scope.idleConfirmTimeOut = ngAuthSettings.sessionConfirmTimeOut;

            $scope.feedback = "mailto:";
            if (ngAuthSettings.feedback !== undefined) {
                //$scope.feedback = $scope.feedback + ngAuthSettings.feedback.mailto + "?cc=" + ngAuthSettings.feedback.cc + "&bcc=" + ngAuthSettings.feedback.bcc + "&subject=" + ngAuthSettings.feedback.subject;
                $scope.feedback = $scope.feedback.concat(ngAuthSettings.feedback.mailto);
                if (ngAuthSettings.feedback.cc != '')
                    $scope.feedback = $scope.feedback.concat("?cc=" + ngAuthSettings.feedback.cc)
                if (ngAuthSettings.feedback.bcc != '')
                    $scope.feedback = $scope.feedback.concat("?bcc=" + ngAuthSettings.feedback.bcc)
                if (ngAuthSettings.feedback.subject != '')
                    $scope.feedback = $scope.feedback.concat("?subject=" + ngAuthSettings.feedback.subject)
            }

            $scope.userProfileClick = function () {
                $scope.currentMainmenu = "Home";
                $scope.currentMainmenuicon = "fa fa-home";
                $scope.currentSubmenu = "My Profile";

                $location.path('/userprofile');
            }

            $scope.notificationViewClick = function () {
                $scope.currentMainmenu = "Home";
                $scope.currentMainmenuicon = "fa fa-home";
                $scope.currentSubmenu = "Notifications";

                $location.path('/notifications');
            }

            $rootScope.isFeedback = false;
            $scope.feedbackClick = function () {
                $rootScope.isFeedback = true;
            }

            $scope.helpOpen = function () {
                if (ngAuthSettings.helpURL !== undefined && ngAuthSettings.helpURL !== "")
                    window.open(ngAuthSettings.helpURL, '_blank', 'location=yes,height=800,width=' + (window.outerWidth / 2)*1.25 + ',resizable=yes,scrollbars=yes,status=yes');
            }

            $scope.aboutUsClick = function () {
                getServerData("aboutUsConfig").then(function (data) {
                    if (data === undefined || data === null || data.length === 0) return;
                    $scope.aboutUsData = data.aboutUs;
                    var authData = localStorageService.get('authorizationData');
                    $scope.aboutUsData.version = authData.version;
                    navcon.openModal("aboutUs");
                    //$('#aboutUs').modal({
                    //    show: true
                    //});
                });
            }

            $scope.aboutUsSiteClick = function () {
                window.open($scope.aboutUsData.website.toString(), '_blank');
            }

            $scope.startTimer = function () {
                $scope.$broadcast('timer-start');
            };

            $scope.stopTimer = function () {
                $scope.$broadcast('timer-stop');
            };

            $scope.resetTimer = function () {
                $scope.$broadcast('timer-reset');
            };

            getNavRoutes();

            function getNavRoutes() {
                var authData = localStorageService.get('authorizationData');

                $scope.notification = [];
                if (authData !== undefined && authData !== null) {
                    $scope.userName = authData.userName;
                    if (authData.FirstName === undefined || authData.FirstName === null)
                        authData.FirstName = "";
                    if (authData.LastName === undefined || authData.LastName === null)
                        authData.LastName = "";
                    $scope.UserFullName = authData.FirstName + " " + authData.LastName;
                    $scope.Designation = authData.Designation;
                    loadNotification(authData.notification);
                }

                $scope.$on('ALERT-DATA-REFRESH', function (event, data, status) {
                    //if(authData === null){
                    authData = localStorageService.get('authorizationData');
                    $scope.userName = authData.userName;
                    $scope.UserFullName = authData.FirstName + " " + authData.LastName;
                    $scope.Designation = authData.Designation;
                    //}
                    if (status) {
                        loadNotification(data, true);
                    } else {
                        loadNotification(data, false);
                        authData.notification.push(data[0]);
                        localStorageService.set('authorizationData', authData);
                    }
                });

                $scope.$on('ALERT-DATA-DELETE', function (event, data, type) {
                    authData = localStorageService.get('authorizationData');
                    if (authData.notification.length > 0) {
                        var notification = deleteNotification(authData.notification, data, type);
                        loadNotification(notification, true);
                        authData.notification = notification;
                        localStorageService.set('authorizationData', authData);
                    }
                });

                $scope.$on('ALERT-DATA-DELETE-ALL', function (event, data, type) {
                    authData = localStorageService.get('authorizationData');
                    if (authData.notification.length > 0) {
                        var notification = [];
                        loadNotification(notification, true);
                        authData.notification = notification;
                        localStorageService.set('authorizationData', authData);
                    }
                });

                $scope.$on('SCREEN-IDLE', function (event, method, idleTimeOut, idleConfirmTimeOut) {
                    idleTimeoutSettings(method, idleTimeOut, idleConfirmTimeOut);
                });

                $scope.timeOutClose = function () {
                    navcon.closeModal('idletimeout');
                    $scope.stopTimer();
                    $timeout(function () {
                        $scope.resetTimer();
                    })
                };

                function idleTimeoutSettings(method, idleTimeOut, idleConfirmTimeOut) {
                    $scope.idleConfirmTimeOut = idleConfirmTimeOut;
                    if (method === 'IdleTimeout') {
                        navcon.closeModal('idletimeout');
                        $scope.stopTimer();
                        $timeout(function () {
                            $scope.resetTimer();
                        })
                        $('.modal').modal('hide');
                        $scope.logOut();
                    } else if (method === 'IdleStart') {
                        navcon.openModal('idletimeout', function () {
                            $scope.startTimer();
                        });
                    } else if (method === 'IdleEnd') {
                        $('.modal').modal('hide');
                        //$scope.logOut();
                    }
                }

                $scope.notificationClick = function (item) {
                    if (authData === null)
                        authData = localStorageService.get('authorizationData');

                    if (item.type.toString() === "1") {
                        if (item !== undefined && item !== null) {
                            if (item.NFDetailsId !== undefined && item.NFDetailsId !== null) {
                                var data = { NFDetailsId: item.NFDetailsId };
                                dataservice.putData("MySpace/Notification/Update", data).then(function (data) {
                                    item.status = true;
                                    for (var i = 0, len = authData.notification.length; i < len; i++) {
                                        if (authData.notification[i].NFDetailsId === item.NFDetailsId) {
                                            authData.notification[i].Status = true;
                                            localStorageService.set('authorizationData', authData);
                                            break;
                                        }
                                    }
                                    if ($location.$$url === '/notifications') {
                                        setTimeout(function () {
                                            $rootScope.$broadcast('NOTIFICATION-ALERT-DATA-REFRESH', data, function () { });
                                        }, 500)
                                    }
                                });
                            }
                        }
                    }

                    //if (item.type === 0) {
                    //    $location.path('/refresh');
                    //    $location.path('/' + item.page.toLowerCase());
                    //    setTimeout(function () {
                    //        $rootScope.$broadcast(item.page.toUpperCase() + '-ALERT-DATA-REFRESH', item.code, false);
                    //    }, 500)
                    //} else if (item.type === 2) {
                    //    $scope.commItemId = item.code;
                    //    $scope.commItemPage = item.page.toLowerCase();
                    //    //  $scope.modalId = "messagecomm";
                    //    navcon.openModal("messagecomm");
                    //}
                }

                $scope.navRoutes = []
                loadMenus(menuSettings.data);

                $scope.$on('MENU-SETTING-DATA-REFRESH', function (event, args) {
                    loadMenus(menuSettings.data);
                });

                $scope.menuClick = function (e) {
                    if ($('.page-sidebar').hasClass('hideMenu')) {
                        $('.profile').toggleClass('hideMenudetail');
                        $('.page-logo').toggleClass('hideMenudetail');
                        $('.page-sidebar').toggleClass('hideMenu');
                        $('#pagecontent').toggleClass('marginLeft0');
                        $('#Mainmenu li a div').toggleClass('hideMenudetail');
                        $('#Mainmenu li a span').toggleClass('hideMenudetail');
                        $('#Mainmenu li.active ul').toggleClass('hideMenudetail');
                    }
                    if ($(e.target).parents('li').hasClass('active')) {
                        $('#Mainmenu li').removeClass('active');
                        $('#Mainmenu li a span').removeClass('fa fa-chevron-down');
                        $('#Mainmenu li a span').addClass('fa fa-chevron-right');

                        if (e.target.localName == 'span' || e.target.localName == 'i' || e.target.localName == 'div') {
                            checkElement = $(e.target).parent().next();
                        }
                        else {
                            checkElement = $(e.target).next();
                        }

                        if (checkElement.is('ul')) {
                            //$(checkElement).css("display", "none");
                            $('#Mainmenu ul:visible').slideUp('normal');
                        }

                    } else {
                        $('#Mainmenu li').removeClass('active');
                        $('#Mainmenu li a span').removeClass('fa fa-chevron-down');
                        $('#Mainmenu li a span').addClass('fa fa-chevron-right');

                        var checkElement;
                        if (e.target.localName == 'span' || e.target.localName == 'i' || e.target.localName == 'div') {
                            checkElement = $(e.target).parent().next();
                        }
                        else {
                            checkElement = $(e.target).next();
                        }
                        $(e.target).parents('li').addClass('active')
                        if (e.target.localName == 'a')
                            $(e.target).find('span').addClass('fa fa-chevron-down');
                        if (e.target.localName == 'span')
                            $(e.target).addClass('fa fa-chevron-down');
                        if (e.target.localName == 'i')
                            $(e.target).next().next().addClass('fa fa-chevron-down');
                        if (e.target.localName == 'div')
                            $(e.target).next().addClass('fa fa-chevron-down');

                        if ((checkElement.is('ul')) && (checkElement.is(':visible'))) {
                            return false;
                        }
                        if ((checkElement.is('ul')) && (!checkElement.is(':visible'))) {
                            $('#Mainmenu ul:visible').slideUp('normal');
                            checkElement.slideDown('normal');
                            return false;
                        }
                    }


                    //$('#Mainmenu li').removeClass('current-page');
                    //$(e.target).parent().addClass('current-page');

                };
                $scope.submenuClick = function (e, mainmenu, submenu) {//pagename
                    $scope.currentMainmenu = mainmenu.text;
                    $scope.currentMainmenuicon = mainmenu.IconClass;
                    $scope.currentSubmenu = submenu.text;
                    $scope.currentSubmenuURL = submenu.ConfigName;
                    $('#Mainmenu li').removeClass('current-page');
                    $(e.target).parent().addClass('current-page');
                    //$state.go(pagename);
                };


                //$scope.menuClick = function(item){
                //    $timeout(function(){
                //        $rootScope.$broadcast('SUBMENU-LOADING', item.ConfigName.toLowerCase()); 
                //    })
                //}


                $scope.mainMenuFilter = function (item) {
                    if (item.MenuType === 0 || item.MenuType === 1 || item.MenuType === 2) {
                        return true;
                    }
                    return false;
                };

                function loadMenus(data) {
                    if (data === undefined) return;
                    $scope.navRoutes = []
                    if (data.length === undefined) return;
                    $scope.menus = data;
                }

                function deleteNotification(data, id, type) {
                    var notification = [];
                    var field = "NotificationId";
                    if (type === 'user')
                        field = "NFDetailsId";
                    for (var i = 0, len = data.length; i < len; i++) {
                        var item = data[i];
                        if (item[field] === id)
                            continue;
                        notification.push(item);
                    }
                    return notification;
                }

                function loadNotification(data, status) {
                    if (data === undefined || data.length === 0) {
                        $scope.notification = [];
                        return;
                    }
                    if (status)
                        $scope.notification = [];
                    for (var i = 0, len = data.length; i < len ; i++) {
                        var item = data[i];
                        if (item.Message === undefined || item.Message === "") continue;
                        var obj = {
                            item: item.Message, page: item.PageKey, code: item.Id, status: item.Status || false, NotificationDetailId: item.NotificationDetailId,
                            NFDetailsId: item.NotificationDetailId,
                            date: navcon.dateFromUTCToLocal(item.LastUpdateDate, "DD/MM/YYYY HH:MM"), type: item.Type
                        };
                        $scope.notification.push(obj);
                    }
                }
            };

            $scope.logOut = function () {
                if ($('.page-sidebar').hasClass('hideMenu')) {
                    $('.profile').toggleClass('hideMenudetail');
                    $('.page-logo').toggleClass('hideMenudetail');
                    $('.page-sidebar').toggleClass('hideMenu');
                    $('#pagecontent').toggleClass('marginLeft0');
                    $('#Mainmenu li a div').toggleClass('hideMenudetail');
                    $('#Mainmenu li a span').toggleClass('hideMenudetail');
                    $('#Mainmenu li.active ul').toggleClass('hideMenudetail');
                }
                authService.logOut(function () {
                    $('.modal').modal('hide');
                    $scope.currentMainmenu = "Home";
                    $scope.currentMainmenuicon = "fa fa-home";
                    $scope.currentSubmenu = "My Space";

                    if (ngAuthSettings.SSO !== undefined && ngAuthSettings.SSO) {
                        if (ngAuthSettings.appURL !== undefined && ngAuthSettings.appURL !== "") {
                            window.location.href = ngAuthSettings.appURL + "logout.aspx";
                        } else {
                            $location.path('/login');
                        }
                    } else {
                        $location.path('/login');
                    }
                });
            };

            /*Cancel*/
            $scope.cancel = function (type) {
                navcon.closeModal(type);
            };

            var currentUrl = "";

            if ($location.$$path !== undefined)
                currentUrl = $location.$$path.substring(1, $location.$$path.length).toLowerCase();

            function getUserProfile() {
                if ($rootScope.userProfileImage === undefined || $rootScope.userProfileImage === oldValue || $rootScope.userProfileImage === "") {
                    var dataUser = getServerData('userProfileId').then(function (dataUser) {
                        if (dataUser !== undefined && dataUser !== null) {
                            var userImage = dataUser.img;

                            if (dataUser.img === undefined || dataUser.img === null || dataUser.img === "")
                                userImage = "/9j/4AAQSkZJRgABAQAAAQABAAD/2wCEAAkGBhAQERUQEBAVFRAUEhoYEBESDxQSEhUSFRgVIBYUEhcYHCcfFxsvGxIXHy8gIycqLDgtFR4yNTAqNSYrLCoBCQoKBQUFDQUFDSkYEhgpKSkpKSkpKSkpKSkpKSkpKSkpKSkpKSkpKSkpKSkpKSkpKSkpKSkpKSkpKSkpKSkpKf/AABEIALwAkAMBIgACEQEDEQH/xAAbAAEAAgMBAQAAAAAAAAAAAAAAAgUBBAYDB//EAEMQAAICAQEDCAcDCgQHAAAAAAECAAMRBBIhMQUGMkFRYXGBEyIjQlKRoTNighRDcnOisbLB0fA0dJLSJFNjo7PCw//EABQBAQAAAAAAAAAAAAAAAAAAAAD/xAAUEQEAAAAAAAAAAAAAAAAAAAAA/9oADAMBAAIRAxEAPwD7hmMzEQM5jMxEDOYzMRAzmMzQ5U5bp0wHpW9ZuhWql7Hxx2UG8+PCVp52P1aK4r2l6FbyU2fvgdDmMygHO4e9pNQPBK3/AIXMmvPHS+96VP09NcB5kKRAvMxmVmm5y6Ow4TU1Fvh9Kob/AEkgyygZzGZiIGcxmYiBnMZmIgYzGZHMZgSzGZHMZgSzKjlvl8U+yqAs1TD1a8+qgP5y4jop9TwHaNXlzlpy502mbFg+3uxkUqRuCjg1pHAcAN56gdHSaNKgQg4nLsSWd262djvY95gR0uj2S1jsXuf7S1uk3YoHuoOpRuHjvmxEjdcqKXYgKoyzE4AA4kwJTM1tBrluTbUMPWIKuNl1IPBlO9TjBwe0TYgQu06OMOqsOxlDD5Geei17aEjJLaI7mUks2n++hO81dq+7xG7InrZaq9IgeJA/fPCvlKh29Gt1bMR0FtRiR17gYHYhgd44dRmczmebWs9C/wCRsfUwW0hJz7MdKn8OQR90j4Z0mYEsxmRzGYEsxmRzGYGMxmRzGYEsyp5wcrtSq104OptyKgRkIo6Vrj4VyN3WSB1y0zOVb1tVqXPEOta9yIinA7BtOx8TAaPSLUuyCTvJZmOWdzvZ3PWSd89oiAkeRuT/AMscXP8A4WtvYr1XWKftW7awR6o6yNrgBPDlPTtZTZWpwzVsqnvIOP7751HI2rS2iqysBUatSqgYCjA9THVjhjuga+u5s6e5zYVZbG6T1WPWWxw2tk4Y95ngOZul970r9z6m4jzAbfLyIFXVzW0S8NJTntNKM3zIJnrr+RKbqjSUCrxUoArI46LoQNzDt/rN+IHz7VXWVgmwf8To7FsbZGNtBxdB2NVtjHbkdU7lLAwDKcqRkEcCDwIlHzs0wVqdSBvDim3saq3hntw+yR4t2z25qOfySoH3A1flU7IPoggXGYzI5jMCWYzI5jMCOYzI5jMCWZy+ManVD/rK3k9VZH8/lOmzOV5U1C06q5mz61dLKqjLOxL1hVHWdpQPMQNqJ5WU6xV220nq9aper2gfoYwT3Bj3ZmdNqVsUOhyp4H94IO8HIxgwPQnrm7zLYnTsQD6I32GgkEbVTHO0ufd2mbHdiVOpoF1lOmPQtc+lA66q1LMvgTsqe5jO0VQBgDAHADhiBmIiAiIgU3PDTWWaK5ahm0KHrAGTt1sGGB1714SXItVaaepaW26hWNhx74O8v4kkk95lnqbxWjO3RVSzeCjJ+glNzfqZdNXtDDMDYwHANczOVHh6THlAs8xmRzGYEsxmRzGYEcxmQzGYE8yl5T0QfXaKw8FNwI6i2wGTPga2IlvmUnO5bPQpZU2zZVqKmRiMgZbYO0Ph9pg9xMDrJyHLGkfS2WX7AbS2OrOVOGqdsKzMp6Sk4Ykbxlt3XOh5G5TGppW0DZJyHTOSlikh0J7mBE1ud3+C1H6lv3QKrkrfr0z1aW0jxNmnB+k6ycjoX2dbSfiruT5+ib/5zroCIiAiIgeOt0wsres8HRlJ7mBH85U8h6gvpqWPS9EocdjoNlx/qUy8nP8AIf2Tf5i//wA1kCyzGZDMZgTzGZDMZgRzGZHMZgSzPDX6QXVPSxwLEKk9YyNzDvBwfKeuYzA5fkflSzTk37JKE7OvpXeUuTc91Y6+G9etdkjeN/aulWoqwcPTYnirIw+oIM5blqj0L/la9DAGqUfAOjeO9eDdq/ozd5o37Bt0vuV7NlH6q0v6o7g6OB3FYFjo+bWlpcWV0qrrnZYZJGRg4yeyWcRAREQEREDy1WoWtGsY4VFLMfuqCT9BKPkOsrp6g25ym24+/aS7D5uR5Ta51knSWIPzmzV5XOqH6OZJjv8AOBLMZkcxmBLMZkcxmBHMZkMxmBPMZkMxmBP+9/DzlNyTycdLra9ls0WVWV1oR61ZGy6pte8oCvs53gEjfultmVvKeuVL9Gh6b6r1cDgordWY9gzYq+LQOsiIgIiICIiBT85TkUp8eqr+SZc/SuZzKXlvnLpxr0qd9laUbLn7Mai0KFVzwUistvO72g4S3z/fdAnmMyGYzAnmMyGYzAjmMyOYzAlmMyI38JS8oc7NPVlUJusHu1EFQfv2dEeWT3QLm69UUu7BUUZZ2OFUdpM5KjULrWtvYMq7Yro3lXVKjkOCN6sXJb5DqlXylynbqWBuICKcpSmfRqfiOd7t3nyAlnzaHsPGyw/tn+kC+5O50WUYTV5erq1Sr6y/5hB/Gu7tA4zrKrldQyMGUjKspBBB4EEcROJnlpGt0zF9KQFJy+nYkUuesrj7Ju8bu0GB30Sk0XPDSuvtLFosHTqvdK2B7snDj7ykiaPLXOnb9jorFZyPaahGV0qU/CRkNYeodXE9QIe/LfOZkf0GmCtaPtXfJqqHUrBSCzn4QRgbyRuzT36nV2faatwvWtKLSPnvf9qeen061qFXh2k5JJ4sxO8kneSe2esDleVdElV+yigK9QJHaysQxOeJIZck75Lk7lO/TbqbMJ/yXG3V5DOU/CRNjnH9rT+rt/fTK+B02m58D89p3X71TravybZYfWWem50aOzcNQqn4bc0n/uAD6zhoIzxgfTQcjI3g8CN4PgeBjM+YU1+jOay1Z7anao+eyRnzljRzh1icL9sdl1av9Rst9YHcu4ALEgKBlmYhVA7WJ3AeMoNdzyqXdQpub4slKR+MjLfhB8ROY1d9l52r7DYQcgNgVqfuVj1R44z3yMD31/KV+o3XWZQ/mkGxV4EZy/4iZrqoG4DA6gNwmYgJd82T7DHZbYP2j/WUktebD7rU7LdrydV/mD8oF3ERAiyA8QD4jMyqgcBjwmYgIiIHPc4T7esdlT/V6/8AbNCbfLpzqfChfmz2f7ZqQEREBERAREQEREBNrkO3Z1GOqysj8VZyP2Wf5TVkLbCmzaONbBwO0DpDzUkQOziRrsDAMpyCAQe0HgflJQEREBERA5blVs6mzuWtf2c/+88Jhrdt7LOprWx4L6o/hmYCIiAiIgIiICIiAiIgW3NrVeq1B41H1O+ps7PyOV8hLqccmoNLrcPc3OB11N0h5YDfhnYI4IBByCMgjgQeBEDMREBNTlXWehpewdIL6ne53KPmRNuc/wA49TtOlI4L7Szx3isHz2m/CIFZRVsqF7AB8uuTiICIiAiIgIiICIiAiIgJZc29Zs50ze6C1PfX1p+En5EdkrZ46u0ovpV3PX6yHvHUe4gkHxgdtEwDMwPPUaha0Z3OFUEse4TkEdnLWP07G2mHwj3V8lAHzltzotPsq/cdyXHbsDKg92cHyErICIiAiIgIiIH/2Q==";

                            $rootScope.userProfileImage = userImage;
                        }
                    });
                }
            }

            $scope.firstIndex = function (indexNo, type) {
                if (type == "main") {
                    if (indexNo === 0) {
                        breadCrumbConfig("");
                        return "active";
                    } else
                        return "";
                } else if (type == "sub") {
                    if (indexNo === 0)
                        return "block";
                    else
                        return "none";
                }
            };

            function breadCrumbConfig(url) {
                var etarget, checkElement;
                if ($scope.menus !== undefined && $scope.menus !== null && $scope.menus.length !== 0) {
                    var allMenus = navcon.getDataFromTree($scope.menus, '', 0);
                    var filterMenus = $.grep(allMenus, function (e) {
                        return e.ConfigName !== undefined && e.ConfigName !== null && e.ConfigName !== "";
                    });
                    if (filterMenus.length > 0) {
                        if (url === "") url = filterMenus[0].text;


                        var subMenu = navcon.getItemByKeyValue(filterMenus, 'ConfigName', url, true);
                        if (subMenu !== -1) {

                            var mainMenu = navcon.getItemByKeyValue(allMenus, 'id', subMenu.ParentId, true);
                            if (mainMenu !== -1) {
                                $scope.currentMainmenu = mainMenu.text;
                                $scope.currentMainmenuicon = mainMenu.IconClass;

                                $('#Mainmenu li').removeClass('active');
                                $('#Mainmenu li a span').removeClass('fa fa-chevron-down');
                                $('#Mainmenu li a span').addClass('fa fa-chevron-right');

                                etarget = $($('#mainMenuId_' + mainMenu.id).children()[0]).children()[1]
                                $('#mainMenuId_' + mainMenu.id).addClass('active');
                                //$('#' + mainMenu.id).children().first().click();
                            }

                            $scope.currentSubmenu = subMenu.text;
                            $scope.currentSubmenuURL = url;


                            $('#Mainmenu li').removeClass('current-page');
                            $('#mainMenuSubId_' + subMenu.id).addClass('current-page');

                            if (etarget !== undefined && etarget !== null) {
                                if (etarget.localName == 'span' || etarget.localName == 'i' || etarget.localName == 'div') {
                                    checkElement = $(etarget).parent().next();
                                }
                                else {
                                    checkElement = $(etarget).next();
                                }

                                if (checkElement.is('ul')) {
                                    //$(checkElement).css("display", "none");
                                    $('#Mainmenu ul:visible').slideUp('normal');
                                    checkElement.slideDown('normal');
                                }
                            }
                        }
                    }
                }
            }

            $timeout(function () {
                if ($rootScope.configHeaderMenu !== undefined && $rootScope.configHeaderMenu !== null && $rootScope.configHeaderMenu !== "login")
                    getUserProfile();

                breadCrumbConfig(currentUrl);

                $rootScope.$broadcast('SUBMENU-LOADING', currentUrl);

                /*if ($(".main_menu_side .menuScrollbar").mCustomScrollbar.length !== 0)
                    $(".main_menu_side .menuScrollbar").mCustomScrollbar('destroy');*/
                if(!$(".page-sidebar").hasClass('mCustomScrollbar')){
                    $(".page-sidebar").mCustomScrollbar({
                        autoHideScrollbar: true,
                        scrollInertia: 0,
                        scrollbarPosition: "outside"
                    });
                }

                //$("#pagecontent").mCustomScrollbar({
                //    autoHideScrollbar: true,
                //    theme: "3d-dark",
                //    scrollInertia: 0,
                //    scrollbarPosition: "outside"
                //});
            })

            $scope.getTimeoutMinutes = function () {
                return $scope.idleTimeOut / 60;
            }

            function getServerData(type, rowId) {
                return dataservice.getServerData(type, rowId).then(function (data) {
                    return data;
                });
            };

            function activate() {

                if (authService.authentication.isAuth)
                    $rootScope.$broadcast('START-SESSION');
            };

            activate();
            Layout.initSidebar();

            $rootScope.$watch("userProfileImage", function (newValue, oldValue) {
                if (newValue !== undefined && newValue !== oldValue && newValue !== "") {
                    var imgSrc = "data:image/jpeg;base64," + newValue;
                    $scope.userProfileImage = imgSrc;
                }
            }, true);
        }
    ]);
"use strict";

angular.module('navconMenu').controller('navconMenuController',
    ['$scope', '$rootScope',
        function ($scope, $rootScope) {

            $scope.isVertical = true;
            $scope.openMenuScope = null;
            $scope.showMenu = true;
            $scope.allowHorizontalToggle = true;

            this.getActiveElement = function () {
                return $scope.activeElement;
            };

            this.setActiveElement = function (el) {
                $scope.activeElement = el;
            };

            this.isVertical = function () {
                return $scope.isVertical;
            }

            this.setRoute = function (route) {
                $rootScope.$broadcast('navcon-menu-item-selected-event',
                    { route: route });
            };

            this.setOpenMenuScope = function (scope) {
                $scope.openMenuScope = scope;
            };

            $scope.toggleMenuOrientation = function () {

                // close any open menu
                if ($scope.openMenuScope)
                    $scope.openMenuScope.closeMenu();

                $scope.isVertical = !$scope.isVertical;

                $rootScope.$broadcast('navcon-menu-orientation-changed-event',
                    { isMenuVertical: $scope.isVertical });
            };

            angular.element(document).bind('click', function (e) {
                if ($scope.openMenuScope && !$scope.isVertical) {
                    if ($(e.target).parent().hasClass('navcon-selectable-item'))
                        return;
                    $scope.$apply(function () {
                        $scope.openMenuScope.closeMenu();
                    });
                    e.preventDefault();
                    e.stopPropagation();
                }
            });

            $scope.$on('navcon-menu-show', function(evt, data) {
                $scope.showMenu = data.show;
                $scope.isVertical = data.isVertical;
                $scope.allowHorizontalToggle = data.allowHorizontalToggle;
            });
        }
    ]);
"use strict";

angular.module('app').directive('navconDashboard', ['$localStorage', '$rootScope', 'localStorageService', 'dataservice', 'ngAuthSettings', 'logger', '$timeout', '$location', 'authService',
function ($localStorage, $rootScope, localStorageService, dataservice, ngAuthSettings, logger, $timeout, $location, authService) {
    return {
        restrict: 'AE',
        scope: {
            navconData: '=',
            pageConfig: '='
        },
        template: '<main-dashboard ></main-dashboard>',
        link: function (scope, el, attrs) {
            //el.text(scope.pageConfig);
            scope.isDelete = false;
            scope.isNew = false;

            scope.widgetDefinitions = [];
            scope.widgets = [];
            scope.userProject = [];

            scope.isModuleAvailable = false;
            scope.moduleData = ["Hazard"];
            scope.projectData = [{ "ProjectId": 0, "ProjectName": "" }];
            scope.reportData = [{ "ReportCode": "HazardSummary", "ReportName": "Hazard Summary" }];
            scope.moduleId = "";
            scope.projectId = "";

            var authData = localStorageService.get('authorizationData');
            if (authData != undefined && authData !== null && authData.userId !== null) {
                scope.userId = authData.userId;
                scope.userRights = authData.userRights;
            } else { //if (!_authentication.isAuth) {
                /*authService.authentication.isAuth = false;
                authService.logOut();*/
                $location.path('/login');
                return;
            }

            scope.filterStart = moment().startOf('year');
            scope.filterEnd = moment();

            scope.widgetMainConfig = [
                {
                    title: 'Dashboard Count',
                    settings: {
                        UserWidgetId: 0,
                        ModuleId: scope.moduleId,
                        ProjectId: scope.projectId,
                        widgetId: "1",
                        reportType: -1,
                        FilterId: "-1",
                        sizeX: 12,
                        sizeY: 1,
                        title: 'Dashboard Count',
                        subTitle: "",
                        width: window.screen.availWidth,
                        height: window.screen.availHeight,
                        data: [],
                        template: '<navcon-Mycount ></navcon-Mycount>',
                        configName: scope.moduleId,
                        //reportList: [],
                        options: { filter: false, reportSetting: false, close: false }
                    },
                    configName: "dashboardCount"
                },
                {
                    title: 'Hazard Management Summary',
                    settings: {
                        UserWidgetId: 0,
                        ModuleId: scope.moduleId,
                        ProjectId: scope.projectId,
                        widgetId: "2",
                        reportType: 1,
                        sizeX: 7,
                        sizeY: 4,
                        title: '',
                        subTitle: "Jan 2016 - Sep 2016",
                        width: window.screen.availWidth,
                        height: window.screen.availHeight,
                        //template: '<navcon-myriskmatrix ></navcon-myriskmatrix>',
                        //template: '<navcon-chart ></navcon-chart>',
                        template: '',
                        configName: scope.moduleId,
                        //popoverTemplate: "<select class='col-md-8 margin-bottom-10' ng-model='selectedReport'><option ng-selected='selectedReport.id == item.id' ng-repeat='item in items'>{{item.title}}</option></select>",
                        //popoverTemplate: "<select class='col-md-8 margin-bottom-10' style='width: 90%;' ng-model='selectedReport' ng-options='x.title for x in items'></select>",
                        popoverTemplate: "<select class='col-md-8 margin-bottom-10' style='width: 90%;' ng-model='selectedReport'><option ng-selected='selectedReport.ReportCode == item.ReportCode' ng-repeat='item in items' value={{item}}>{{item.ReportName}}</option></select>",
                        reportList: scope.reportData,
                        FilterKey: "ReportCode",
                        FilterId: "",
                        filterStart: scope.filterStart,
                        filterEnd: scope.filterEnd,
                        options: { filter: true, reportSetting: true, close: false }
                    },
                    configName: "mySapcetrainingsummary"
                },
                {
                    title: 'Risk Class Summary',
                    settings: {
                        UserWidgetId: 0,
                        ModuleId: scope.moduleId,
                        ProjectId: scope.projectId,
                        widgetId: "3",
                        reportType: 2,
                        FilterId: "-1",
                        sizeX: 5,
                        sizeY: 4,
                        title: 'Risk Class Summary',
                        subTitle: "Jan 2016 - Sep 2016",
                        //report: { ReportName: "Hazard Management Summary", source: "", ReportDetailId: "39" },
                        width: window.screen.availWidth,
                        height: window.screen.availHeight,
                        //template: '<navcon-myreport ></navcon-myreport>',
                        //widgetId: "1002",
                        template: '<navcon-chart ></navcon-chart>',
                        configName: scope.moduleId,
                        //reportList: [],
                        options: { filter: false, reportSetting: false, close: false }
                    },
                    configName: "mySapceRiskClassSummary",
                },
                {
                    title: 'Safety Bulletin',
                    settings: {
                        UserWidgetId: 0,
                        ModuleId: scope.moduleId,
                        ProjectId: scope.projectId,
                        widgetId: "5",
                        reportType: -1,
                        FilterId: "-1",
                        sizeX: 12,
                        sizeY: 4,
                        title: 'Safety Bulletin',
                        data: [],
                        width: window.screen.availWidth,
                        height: window.screen.availHeight,
                        template: '<navcon-mysummary ></navcon-mysummary>',
                        configName: scope.moduleId,
                        //reportList: [],
                        options: { filter: false, reportSetting: false, close: false }
                    },
                    configName: "NewsAnnouncements"
                }
            ];

            scope.widgetConfig = [];

            scope.gridsterOpts = {
                columns: 12,
                margins: [10, 10],
                rowHeight: 'match',
                outerMargin: false,
                pushing: true,
                floating: false,
                swapping: false,
                /*maxSizeX: 6, // maximum column width of an item
                maxSizeY: 4, // maximum row height of an item*/
                draggable: {
                    enabled: false,
                    drag: function (event, ui) {

                    },
                    stop: function (event, ui) {
                        if (!scope.isDelete) {
                            scope.saveWidget();
                        }
                        scope.isDelete = false;
                    }
                },
                serialize_params: function ($w, wgd) {
                    console.log('widget' + wgd);
                },
                resizable: {
                    enabled: false,
                    handles: ['n', 'e', 's', 'w', 'ne', 'se', 'sw', 'nw'],

                    // optional callback fired when resize is started
                    start: function (event, $element, widget) { },

                    // optional callback fired when item is resized,
                    resize: function (event, $element, widget) {
                    },

                    // optional callback fired when item is finished resizing 
                    stop: function (event, $element, widget) {
                        //$($element).css("height","auto");
                        scope.resize($($element).width(), $($element).height(), widget.widgetId, $($element));

                        var found = navcon.getItemIndexByKeyValue(scope.widgets, "widgetId", widget.widgetId)
                        if (found !== -1) {
                            scope.widgets[found].width = $($element).width();
                            scope.widgets[found].height = $($element).height();

                        }
                        scope.saveWidget();
                    }
                },
            };

            function getServerData(type, rowId) {
                return dataservice.getServerData(type, rowId).then(function (data) {
                    return data;
                });
            };

            scope.myspaceData = [];
            scope.loadData = false;
            function loadAllData(project, module, startDate, endDate, callback) {
                getServerData("myspaceLoadAllReport", project + "/" + module).then(function (data) {

                    var moduleData = angular.copy(scope.moduleData[0]);
                    scope.loadData = true;

                    if (data !== undefined && data !== null && data.length != 0) {
                        //scope.isNew = false;
                        //scope.myspaceData = data;

                        //myprofile
                        try {
                            var userImage = "/9j/4AAQSkZJRgABAQAAAQABAAD/2wCEAAkGBhAQERUQEBAVFRAUEhoYEBESDxQSEhUSFRgVIBYUEhcYHCcfFxsvGxIXHy8gIycqLDgtFR4yNTAqNSYrLCoBCQoKBQUFDQUFDSkYEhgpKSkpKSkpKSkpKSkpKSkpKSkpKSkpKSkpKSkpKSkpKSkpKSkpKSkpKSkpKSkpKSkpKf/AABEIALwAkAMBIgACEQEDEQH/xAAbAAEAAgMBAQAAAAAAAAAAAAAAAgUBBAYDB//EAEMQAAICAQEDCAcDCgQHAAAAAAECAAMRBBIhMQUGMkFRYXGBEyIjQlKRoTNighRDcnOisbLB0fA0dJLSJFNjo7PCw//EABQBAQAAAAAAAAAAAAAAAAAAAAD/xAAUEQEAAAAAAAAAAAAAAAAAAAAA/9oADAMBAAIRAxEAPwD7hmMzEQM5jMxEDOYzMRAzmMzQ5U5bp0wHpW9ZuhWql7Hxx2UG8+PCVp52P1aK4r2l6FbyU2fvgdDmMygHO4e9pNQPBK3/AIXMmvPHS+96VP09NcB5kKRAvMxmVmm5y6Ow4TU1Fvh9Kob/AEkgyygZzGZiIGcxmYiBnMZmIgYzGZHMZgSzGZHMZgSzKjlvl8U+yqAs1TD1a8+qgP5y4jop9TwHaNXlzlpy502mbFg+3uxkUqRuCjg1pHAcAN56gdHSaNKgQg4nLsSWd262djvY95gR0uj2S1jsXuf7S1uk3YoHuoOpRuHjvmxEjdcqKXYgKoyzE4AA4kwJTM1tBrluTbUMPWIKuNl1IPBlO9TjBwe0TYgQu06OMOqsOxlDD5Geei17aEjJLaI7mUks2n++hO81dq+7xG7InrZaq9IgeJA/fPCvlKh29Gt1bMR0FtRiR17gYHYhgd44dRmczmebWs9C/wCRsfUwW0hJz7MdKn8OQR90j4Z0mYEsxmRzGYEsxmRzGYGMxmRzGYEsyp5wcrtSq104OptyKgRkIo6Vrj4VyN3WSB1y0zOVb1tVqXPEOta9yIinA7BtOx8TAaPSLUuyCTvJZmOWdzvZ3PWSd89oiAkeRuT/AMscXP8A4WtvYr1XWKftW7awR6o6yNrgBPDlPTtZTZWpwzVsqnvIOP7751HI2rS2iqysBUatSqgYCjA9THVjhjuga+u5s6e5zYVZbG6T1WPWWxw2tk4Y95ngOZul970r9z6m4jzAbfLyIFXVzW0S8NJTntNKM3zIJnrr+RKbqjSUCrxUoArI46LoQNzDt/rN+IHz7VXWVgmwf8To7FsbZGNtBxdB2NVtjHbkdU7lLAwDKcqRkEcCDwIlHzs0wVqdSBvDim3saq3hntw+yR4t2z25qOfySoH3A1flU7IPoggXGYzI5jMCWYzI5jMCOYzI5jMCWZy+ManVD/rK3k9VZH8/lOmzOV5U1C06q5mz61dLKqjLOxL1hVHWdpQPMQNqJ5WU6xV220nq9aper2gfoYwT3Bj3ZmdNqVsUOhyp4H94IO8HIxgwPQnrm7zLYnTsQD6I32GgkEbVTHO0ufd2mbHdiVOpoF1lOmPQtc+lA66q1LMvgTsqe5jO0VQBgDAHADhiBmIiAiIgU3PDTWWaK5ahm0KHrAGTt1sGGB1714SXItVaaepaW26hWNhx74O8v4kkk95lnqbxWjO3RVSzeCjJ+glNzfqZdNXtDDMDYwHANczOVHh6THlAs8xmRzGYEsxmRzGYEcxmQzGYE8yl5T0QfXaKw8FNwI6i2wGTPga2IlvmUnO5bPQpZU2zZVqKmRiMgZbYO0Ph9pg9xMDrJyHLGkfS2WX7AbS2OrOVOGqdsKzMp6Sk4Ykbxlt3XOh5G5TGppW0DZJyHTOSlikh0J7mBE1ud3+C1H6lv3QKrkrfr0z1aW0jxNmnB+k6ycjoX2dbSfiruT5+ib/5zroCIiAiIgeOt0wsres8HRlJ7mBH85U8h6gvpqWPS9EocdjoNlx/qUy8nP8AIf2Tf5i//wA1kCyzGZDMZgTzGZDMZgRzGZHMZgSzPDX6QXVPSxwLEKk9YyNzDvBwfKeuYzA5fkflSzTk37JKE7OvpXeUuTc91Y6+G9etdkjeN/aulWoqwcPTYnirIw+oIM5blqj0L/la9DAGqUfAOjeO9eDdq/ozd5o37Bt0vuV7NlH6q0v6o7g6OB3FYFjo+bWlpcWV0qrrnZYZJGRg4yeyWcRAREQEREDy1WoWtGsY4VFLMfuqCT9BKPkOsrp6g25ym24+/aS7D5uR5Ta51knSWIPzmzV5XOqH6OZJjv8AOBLMZkcxmBLMZkcxmBHMZkMxmBPMZkMxmBP+9/DzlNyTycdLra9ls0WVWV1oR61ZGy6pte8oCvs53gEjfultmVvKeuVL9Gh6b6r1cDgordWY9gzYq+LQOsiIgIiICIiBT85TkUp8eqr+SZc/SuZzKXlvnLpxr0qd9laUbLn7Mai0KFVzwUistvO72g4S3z/fdAnmMyGYzAnmMyGYzAjmMyOYzAlmMyI38JS8oc7NPVlUJusHu1EFQfv2dEeWT3QLm69UUu7BUUZZ2OFUdpM5KjULrWtvYMq7Yro3lXVKjkOCN6sXJb5DqlXylynbqWBuICKcpSmfRqfiOd7t3nyAlnzaHsPGyw/tn+kC+5O50WUYTV5erq1Sr6y/5hB/Gu7tA4zrKrldQyMGUjKspBBB4EEcROJnlpGt0zF9KQFJy+nYkUuesrj7Ju8bu0GB30Sk0XPDSuvtLFosHTqvdK2B7snDj7ykiaPLXOnb9jorFZyPaahGV0qU/CRkNYeodXE9QIe/LfOZkf0GmCtaPtXfJqqHUrBSCzn4QRgbyRuzT36nV2faatwvWtKLSPnvf9qeen061qFXh2k5JJ4sxO8kneSe2esDleVdElV+yigK9QJHaysQxOeJIZck75Lk7lO/TbqbMJ/yXG3V5DOU/CRNjnH9rT+rt/fTK+B02m58D89p3X71TravybZYfWWem50aOzcNQqn4bc0n/uAD6zhoIzxgfTQcjI3g8CN4PgeBjM+YU1+jOay1Z7anao+eyRnzljRzh1icL9sdl1av9Rst9YHcu4ALEgKBlmYhVA7WJ3AeMoNdzyqXdQpub4slKR+MjLfhB8ROY1d9l52r7DYQcgNgVqfuVj1R44z3yMD31/KV+o3XWZQ/mkGxV4EZy/4iZrqoG4DA6gNwmYgJd82T7DHZbYP2j/WUktebD7rU7LdrydV/mD8oF3ERAiyA8QD4jMyqgcBjwmYgIiIHPc4T7esdlT/V6/8AbNCbfLpzqfChfmz2f7ZqQEREBERAREQEREBNrkO3Z1GOqysj8VZyP2Wf5TVkLbCmzaONbBwO0DpDzUkQOziRrsDAMpyCAQe0HgflJQEREBERA5blVs6mzuWtf2c/+88Jhrdt7LOprWx4L6o/hmYCIiAiIgIiICIiAiIgW3NrVeq1B41H1O+ps7PyOV8hLqccmoNLrcPc3OB11N0h5YDfhnYI4IBByCMgjgQeBEDMREBNTlXWehpewdIL6ne53KPmRNuc/wA49TtOlI4L7Szx3isHz2m/CIFZRVsqF7AB8uuTiICIiAiIgIiICIiAiIgJZc29Zs50ze6C1PfX1p+En5EdkrZ46u0ovpV3PX6yHvHUe4gkHxgdtEwDMwPPUaha0Z3OFUEse4TkEdnLWP07G2mHwj3V8lAHzltzotPsq/cdyXHbsDKg92cHyErICIiAiIgIiIH/2Q==";
                            if (data.myProfileGetById !== undefined && data.myProfileGetById !== null && data.myProfileGetById.length !== 0) {
                                if (data.myProfileGetById.img !== undefined && data.myProfileGetById.img !== null && data.myProfileGetById.img !== "")
                                    userImage = data.myProfileGetById.img;
                            }
                            $rootScope.userProfileImage = userImage;
                        } catch (e) { }

                        //Module
                        if (data.MySpaceReportList !== undefined && data.MySpaceReportList !== null && data.MySpaceReportList.length !== 0) {
                            if (module.toString() === "0") {
                                if (data.MySpaceReportList.Modules.length !== 0) {
                                    scope.isModuleAvailable = true;
                                    scope.moduleData = data.MySpaceReportList.Modules;
                                    moduleData = angular.copy(scope.moduleData[0]);
                                    scope.widgetConfig = angular.copy(scope.widgetMainConfig);
                                } else {
                                    scope.isModuleAvailable = false;
                                    scope.widgetConfig = angular.copy(scope.widgetMainConfig);
                                    scope.widgetConfig.splice(0, 3);
                                }
                            } else {
                                moduleData = module;
                            }

                            scope.projectData = data.MySpaceReportList.Projects;

                            if (module.toString() === "0" && data.MySpaceReportList.DefaultModule !== undefined && data.MySpaceReportList.DefaultModule !== null &&
                                data.MySpaceReportList.DefaultModule !== 0 && data.MySpaceReportList.DefaultModule.length !== 0)
                                moduleData = data.MySpaceReportList.DefaultModule;
                        }
                    }

                    scope.userModule = moduleData;
                    scope.moduleId = moduleData;

                    //Project
                    if (project !== undefined && project !== null && project.toString() === "0" && scope.projectData !== undefined && scope.projectData !== null && scope.projectData.length !== 0) {
                        scope.projectId = scope.projectData[0].ProjectId;
                    }

                    if (project !== undefined && project !== null && project.toString() === "0" && data !== undefined && data.MySpaceProjectList.DefaultProject !== undefined && data.MySpaceProjectList.DefaultProject !== null &&
                        data.MySpaceProjectList.DefaultProject !== 0 && data.MySpaceProjectList.DefaultProject !== "") {
                        scope.projectId = data.MySpaceProjectList.DefaultProject;
                        project = data.MySpaceProjectList.DefaultProject;
                    }

                    if (project !== undefined && project !== null && project.toString() !== "0") {//scope.projectId !== 0) {
                        var itemList = navcon.getItemByKeyValue(scope.projectData, "ProjectId", project);// scope.projectId);
                        if (itemList !== undefined && itemList !== null && itemList !== -1)
                            scope.userProject = itemList;
                        else
                            scope.userProject = scope.projectData[0];
                    } else {
                        scope.userProject = scope.projectData[0];
                    }

                    //Load Chart
                    if (data !== undefined && data !== null && data.MySpaceReportListByModule !== undefined && data.MySpaceReportListByModule !== null && data.MySpaceReportListByModule.length !== 0) {
                        scope.reportData = navcon.getItemsFilterByKeyValue(data.MySpaceReportListByModule, "ReportType", scope.moduleId);

                        if (data.MySpaceProjectList !== undefined && data.MySpaceProjectList !== null && data.MySpaceProjectList.length != 0) {
                            if (data.MySpaceProjectList.Widgets !== null && data.MySpaceProjectList.Widgets.length !== 0) {
                                scope.isNew = false;
                                scope.widgetData = data.MySpaceProjectList.Widgets;

                                $.map(data.MySpaceProjectList.Widgets, function (item, index) {
                                    var widgetIndex = -1;

                                    $.grep(scope.widgetConfig, function (e, i) {
                                        if (e.settings.widgetId !== undefined && e.settings.widgetId !== null && item.widgetId !== undefined && item.widgetId !== null) {
                                            if (e.settings.widgetId.toString() === item.widgetId.toString()) {
                                                widgetIndex = i;
                                                return;
                                            }
                                        }
                                    });

                                    if (widgetIndex !== undefined && widgetIndex !== -1 && widgetIndex.length !== 0) {
                                        scope.widgetConfig[widgetIndex].settings.UserWidgetId = item.UserWidgetId;
                                        if (item.template !== undefined && item.template !== null) {
                                            scope.widgetConfig[widgetIndex].settings.template = item.template;
                                            scope.widgetConfig[widgetIndex].settings.title = item.title;
                                        }

                                        if (item.FilterId !== undefined && item.FilterId !== null && scope.widgetConfig[widgetIndex].settings.FilterId !== -1)
                                            scope.widgetConfig[widgetIndex].settings.FilterId = item.FilterId;

                                        scope.widgetConfig[widgetIndex].settings.ModuleId = scope.moduleId;
                                        //scope.widgetConfig[widgetIndex].settings.ModuleId = moduleData;

                                        //scope.widgetConfig[widgetIndex].settings.configName = scope.moduleId;
                                        scope.widgetConfig[widgetIndex].settings.configName = scope.widgetConfig[widgetIndex].configName;

                                        if (scope.projectId !== 0) scope.widgetConfig[widgetIndex].settings.ProjectId = angular.copy(scope.projectId);
                                        //if (project.toString() !== "0") scope.widgetConfig[widgetIndex].settings.ProjectId = angular.copy(project);

                                        if (scope.widgetConfig[widgetIndex].settings.reportList !== undefined && scope.widgetConfig[widgetIndex].settings.reportList !== null
                                            && scope.widgetConfig[widgetIndex].settings.reportList !== "" && scope.widgetConfig[widgetIndex].settings.reportList.length !== 0)
                                            scope.widgetConfig[widgetIndex].settings.reportList = scope.reportData;

                                        if (scope.widgetConfig[widgetIndex].configName === "dashboardCount") {
                                            if (data.MySpaceReportCount.CausesInnerList !== undefined && data.MySpaceReportCount.CausesInnerList.length !== 0)
                                                scope.widgetConfig[widgetIndex].settings.data = data.MySpaceReportCount.CausesInnerList;
                                        } else if (scope.widgetConfig[widgetIndex].configName === "NewsAnnouncements") {
                                            if (data.NewsAnnouncementsEffective !== undefined && data.NewsAnnouncementsEffective.length !== 0)
                                                scope.widgetConfig[widgetIndex].settings.data = data.NewsAnnouncementsEffective;
                                        } else if (scope.widgetConfig[widgetIndex].configName === "mySapcetrainingsummary") {

                                            if (data.MySpaceSummaryReport !== undefined && data.MySpaceSummaryReport.length !== 0) {
                                                scope.widgetConfig[widgetIndex].settings.data = data.MySpaceSummaryReport.data;
                                            } else
                                                scope.widgetConfig[widgetIndex].settings.data = "";

                                            //if (scope.widgetConfig[widgetIndex].settings.template === "") {
                                            if (scope.moduleId.toLowerCase() === "hazard" && (scope.widgetConfig[widgetIndex].settings.FilterId === "" || scope.widgetConfig[widgetIndex].settings.FilterId.toString().toLowerCase().indexOf("sort") > -1)) {
                                                scope.widgetConfig[widgetIndex].settings.FilterId = "HazardSummary";
                                                scope.widgetConfig[widgetIndex].settings.template = "<navcon-chart ></navcon-chart>";
                                                scope.widgetConfig[widgetIndex].settings.title = "SORT Management Summary";
                                            } else if (scope.moduleId.toLowerCase() === "sort" && (scope.widgetConfig[widgetIndex].settings.FilterId === "" || scope.widgetConfig[widgetIndex].settings.FilterId.toString().toLowerCase().indexOf("hazard") > -1)) {
                                                scope.widgetConfig[widgetIndex].settings.FilterId = "SORTSummary";
                                                scope.widgetConfig[widgetIndex].settings.template = "<navcon-chart ></navcon-chart>";
                                                scope.widgetConfig[widgetIndex].settings.title = "SORT Management Summary";
                                            }
                                            //}
                                        } else if (scope.widgetConfig[widgetIndex].configName === "mySapceRiskClassSummary") {
                                            if (data.MySpaceRiskClassSummary !== undefined && data.MySpaceRiskClassSummary.length !== 0) {
                                                //scope.widgetConfig[widgetIndex].settings.data = data.MySpaceRiskClassSummary.data;
                                                scope.widgetConfig[widgetIndex].settings.data = data.MySpaceRiskClassSummary;
                                                scope.widgetConfig[widgetIndex].settings.title = data.MySpaceRiskClassSummary.title;
                                            } else
                                                scope.widgetConfig[widgetIndex].settings.data = "";
                                        }
                                    }

                                });
                            } else if (scope.widgetConfig !== null && scope.widgetConfig.length !== 0) {
                                scope.isNew = true;

                                $.map(scope.widgetConfig, function (item, index) {
                                    item.settings.UserWidgetId = item.UserWidgetId;

                                    if (item.template !== undefined && item.template !== null) {
                                        item.settings.template = item.template;
                                        item.settings.title = item.title;
                                    }

                                    if (item.FilterId !== undefined && item.FilterId !== null && item.FilterId !== -1)
                                        item.settings.FilterId = item.FilterId;
                                    else if (item.settings.FilterId !== -1) {
                                        if (item.settings.FilterId !== undefined && scope.moduleId.toLowerCase() === "hazard" && (item.settings.FilterId === "" || item.settings.FilterId === "SortSummary")) {
                                            item.settings.FilterId = "HazardSummary";
                                            item.settings.template = "<navcon-chart ></navcon-chart>";
                                            item.settings.title = "SORT Management Summary";
                                        } else if (item.settings.FilterId !== undefined && scope.moduleId.toLowerCase() === "sort" && (item.settings.FilterId === "" || item.settings.FilterId === "HazardSummary")) {
                                            item.settings.FilterId = "SORTSummary";
                                            item.settings.template = "<navcon-chart ></navcon-chart>";
                                            item.settings.title = "SORT Management Summary";
                                        }
                                    }

                                    item.settings.ModuleId = scope.moduleId;
                                    //item.settings.ModuleId = moduleData;

                                    //item.settings.configName = scope.moduleId;
                                    item.settings.configName = item.configName;

                                    if (scope.projectId !== 0) item.settings.ProjectId = angular.copy(scope.projectId);
                                    //if (project.toString() !== "0") item.settings.ProjectId = angular.copy(project);
                                });
                            }
                        }
                    }
                    if (callback !== undefined && data !== undefined && data !== null && data.MySpaceProjectList !== undefined && data.MySpaceProjectList !== null)
                        callback(data.MySpaceProjectList.Widgets);

                    widgetSettings();
                });
            }

            function loadModule() {
                getServerData("mySpaceModules").then(function (data) {
                    var moduleData = angular.copy(scope.moduleData[0]);

                    if (data !== undefined && data !== null && data.length != 0) {
                        if (data.Modules.length !== 0) {
                            scope.isModuleAvailable = true;
                            scope.moduleData = data.Modules;
                            moduleData = angular.copy(scope.moduleData[0]);
                            scope.widgetConfig = angular.copy(scope.widgetMainConfig);
                        } else {
                            scope.isModuleAvailable = false;
                            scope.widgetConfig = angular.copy(scope.widgetMainConfig);
                            scope.widgetConfig.splice(0, 3);
                        }

                        scope.projectData = data.Projects;

                        if (data.DefaultModule !== undefined && data.DefaultModule !== null && data.DefaultModule !== 0 && data.DefaultModule.length !== 0)
                            moduleData = data.DefaultModule;
                    }

                    scope.userModule = moduleData;
                });
            }

            scope.$watch('userModule', function (newValue, oldValue) {
                if (newValue !== undefined && newValue !== oldValue && oldValue !== undefined) {// !scope.loadData) {
                    var scopeUserProject = scope.userProject;
                    scope.userProject = [];
                    scope.projectId = "";
                    scope.moduleId = newValue;

                    $timeout(function () {
                        if (scopeUserProject === undefined && scopeUserProject === null || scopeUserProject === "" || scopeUserProject.length === 0) {
                            scope.userProject = angular.copy(scope.projectData[0]);
                        } else {
                            scope.userProject = scopeUserProject;
                        }
                    });
                }
            }, true);

            scope.$watch('userProject', function (newValue, oldValue) {
                if (newValue !== undefined && newValue !== oldValue && newValue.length !== 0 && scope.projectId !== newValue.ProjectId && oldValue !== undefined) {// && !scope.loadData) {
                    scope.projectId = newValue.ProjectId;

                    loadAllData(newValue.ProjectId, scope.moduleId, navcon.dateFromUTCToLocal(scope.filterStart, "MM-DD-YYYY"), navcon.dateFromUTCToLocal(scope.filterEnd, "MM-DD-YYYY"),
                        function (data) {
                            scope.isNew = true;
                        });
                }
            }, true);

            scope.$watch('userProject1', function (newValue, oldValue) {
                if (newValue !== undefined && newValue !== oldValue && newValue.length !== 0 && scope.projectId !== newValue.ProjectId && !scope.loadData) {
                    scope.isNew = true;

                    scope.loadProject(scope.moduleId, newValue.ProjectId, function (projectId, data) {
                        scope.projectId = projectId;

                        scope.moduleId = scope.userModule;
                    });
                }
            }, true);

            //scope.$watch('projectId', function (newValue, oldValue) {
            //    if (newValue !== undefined && newValue !== "" && newValue !== oldValue && !scope.loadData) {
            //        widgetSettings();
            //        //getDashboardReports(data, function (data) {
            //        //    scope.widgetDefinitions = data;
            //        //    widgetSettings();
            //        //})
            //    }
            //}, true);

            scope.loadProject = function (moduleId, projectId, callback) {
                scope.widgetData = [];

                if (projectId === "") projectId = "0";
                if (moduleId === "") moduleId = scope.userModule === "" ? "Hazard" : scope.userModule;

                getServerData("mySpaceProjectList").then(function (data) {
                    if (data !== undefined && data !== null && data.length != 0) {
                        //if (data.Projects !== undefined && data.Projects !== null && data.Projects.length !== 0)
                        //    scope.projectData = data.Projects;

                        if (scope.projectData !== undefined && scope.projectData !== null && scope.projectData.length !== 0 && projectId === "0")
                            projectId = scope.projectData[0].ProjectId;

                        if (data.DefaultProject !== undefined && data.DefaultProject !== null && data.DefaultProject !== 0 && scope.projectId === "")
                            projectId = data.DefaultProject;

                        if (data.DefaultModule !== undefined && data.DefaultModule !== null && data.DefaultModule !== 0 && scope.moduleId === "")
                            moduleId = data.DefaultModule;

                        if (data.Widgets !== null && data.Widgets.length !== 0) {
                            scope.isNew = false;
                            scope.widgetData = data.Widgets;

                            $.map(data.Widgets, function (item, index) {
                                var widgetIndex = -1;

                                $.grep(scope.widgetConfig, function (e, i) {
                                    if (e.settings.widgetId !== undefined && e.settings.widgetId !== null && item.widgetId !== undefined && item.widgetId !== null) {
                                        if (e.settings.widgetId.toString() === item.widgetId.toString()) {
                                            widgetIndex = i;
                                            return;
                                        }
                                    }
                                });

                                if (widgetIndex !== undefined && widgetIndex !== -1 && widgetIndex.length !== 0) {
                                    scope.widgetConfig[widgetIndex].settings.UserWidgetId = item.UserWidgetId;
                                    if (item.template !== undefined && item.template !== null) {
                                        scope.widgetConfig[widgetIndex].settings.template = item.template;
                                        scope.widgetConfig[widgetIndex].settings.title = item.title;
                                    }

                                    if (item.FilterId !== undefined && item.FilterId !== null && scope.widgetConfig[widgetIndex].settings.FilterId !== -1)
                                        scope.widgetConfig[widgetIndex].settings.FilterId = item.FilterId;

                                    //if (scope.widgetConfig[widgetIndex].settings.FilterId !== undefined && moduleId.toLowerCase() === "hazard" && (scope.widgetConfig[widgetIndex].settings.FilterId === "" || scope.widgetConfig[widgetIndex].settings.FilterId === "SortSummary"))
                                    //    scope.widgetConfig[widgetIndex].settings.FilterId = "HazardSummary";
                                    //else if (scope.widgetConfig[widgetIndex].settings.FilterId !== undefined && moduleId.toLowerCase() === "sort" && (scope.widgetConfig[widgetIndex].settings.FilterId === "" || scope.widgetConfig[widgetIndex].settings.FilterId === "HazardSummary"))
                                    //    scope.widgetConfig[widgetIndex].settings.FilterId = "SORTSummary";

                                    scope.widgetConfig[widgetIndex].settings.ModuleId = moduleId;
                                    scope.widgetConfig[widgetIndex].settings.configName = moduleId;

                                    if (projectId !== 0) scope.widgetConfig[widgetIndex].settings.ProjectId = angular.copy(projectId);
                                }

                            });
                        } else if (scope.widgetConfig !== null && scope.widgetConfig.length !== 0) {
                            scope.isNew = true;

                            $.map(scope.widgetConfig, function (item, index) {
                                item.settings.UserWidgetId = item.UserWidgetId;

                                if (item.template !== undefined && item.template !== null) {
                                    item.settings.template = item.template;
                                    item.settings.title = item.title;
                                }

                                if (item.FilterId !== undefined && item.FilterId !== null && item.FilterId !== -1)
                                    item.settings.FilterId = item.FilterId;
                                else if (item.settings.FilterId !== -1) {
                                    if (item.settings.FilterId !== undefined && moduleId.toLowerCase() === "hazard" && (item.settings.FilterId === "" || item.settings.FilterId === "SortSummary")) {
                                        item.settings.FilterId = "HazardSummary";
                                        item.settings.template = "<navcon-chart ></navcon-chart>";
                                        item.settings.title = "SORT Management Summary";
                                    } else if (item.settings.FilterId !== undefined && moduleId.toLowerCase() === "sort" && (item.settings.FilterId === "" || item.settings.FilterId === "HazardSummary")) {
                                        item.settings.FilterId = "SORTSummary";
                                        item.settings.template = "<navcon-chart ></navcon-chart>";
                                        item.settings.title = "SORT Management Summary";
                                    }
                                }

                                item.settings.ModuleId = moduleId;
                                item.settings.configName = moduleId;

                                if (projectId !== 0) item.settings.ProjectId = angular.copy(projectId);
                            });
                        }

                        if (projectId !== 0) {
                            var itemList = navcon.getItemByKeyValue(scope.projectData, "ProjectId", projectId);
                            scope.userProject = itemList;
                        } else {
                            scope.userProject = scope.projectData[0];
                        }

                        if (callback !== undefined) callback(projectId, data);
                    }
                });
            }

            //getDashboardReports(widgetdef, function (data) {
            //    scope.widgetDefinitions = data;
            //})

            function widgetSettings() {
                scope.widgets = [];
                //logger.warning(newValue);

                var widgetSet = [];
                angular.forEach(scope.widgetConfig, function (item, key) {
                    var newWidget = angular.copy(item.settings);
                    widgetSet.push(newWidget);
                    //scope.$broadcast('DASHBOARD-WIDGET-ACTION', 'add');
                });
                scope.widgets = widgetSet;
            }

            scope.saveWidget = function () {
                var widgets = [];

                var scopeWidgets = angular.copy(scope.widgets);
                angular.forEach(scopeWidgets, function (item, key) {
                    if (item.row !== undefined && item.col !== undefined) {
                        if (item["UserWidgetId"] === undefined)
                            item["UserWidgetId"] = 0;
                        item["update"] = true;

                        //item["FilterId"] = scope.defaultReport;

                        widgets.push(item);
                    }
                });

                //$rootScope.dashboardWidgets = widgets;

                if (widgets.length !== 0) {
                    dataservice.putServerData("mySpaceUpdate", widgets).then(function (data) {
                        //$rootScope.dashboardWidgets = scope.widgets;
                        //logger.warning("My space data Updated");
                    });
                }
            }

            scope.$watch('widgets', function (newWidget, oldWidget) {
                if (newWidget !== undefined && newWidget !== oldWidget) {
                    if (scope.isNew && newWidget[0].row !== undefined && newWidget[0].col !== undefined) {
                        scope.saveWidget();
                        scope.isNew = false;
                    } else if (oldWidget !== undefined && newWidget.length > 1 && oldWidget.length > 1 && newWidget[1].FilterId !== undefined && newWidget[1].FilterId !== oldWidget[1].FilterId) { // Second Widget
                        scope.saveWidget();
                    }
                }
            }, true);

            scope.$on('DASHBOARD-WIDGET-ACTION', function (ev, action, callback) {
                if (action !== undefined && action.toLowerCase() === "add") {
                    scope.isNew = true;
                    //scope.saveWidget();
                } else if (action !== undefined && action.toLowerCase() === "delete") {
                    scope.isDelete = true;
                    $rootScope.dashboardDel = true;
                }

                if (callback !== undefined)
                    callback();
            });

            scope.$watch('fetching', function () {
                if (!scope.fetching) {

                }
            });

            scope.resize = function (width, height, id, itemObj) {
                $rootScope.$broadcast('DASHBOARD-RESIZE', width, height, id, itemObj);
            }

            // We want to manually handle `window.resize` event in each directive.
            // So that we emulate `resize` event using $broadcast method and internally subscribe to this event in each directive
            // Define event handler
            scope.events = {
                beforeResize: function (e, scope) {
                    setTimeout(function () {
                        scope.api.update()
                    }, 200)
                }
            };

            angular.element(window).on('resize', function (e) {

            });

            // We want to hide the charts until the grid will be created and all widths and heights will be defined.
            // So that use `visible` property in config attribute
            scope.config = {
                visible: false
            };

            function getUserProfile() {
                try {
                    var dataUser = getServerData('userProfileId').then(function (dataUser) {
                        if (dataUser !== undefined && dataUser !== null) {
                            var userImage = dataUser.img;

                            if (dataUser.img === undefined || dataUser.img === null || dataUser.img === "")
                                userImage = "/9j/4AAQSkZJRgABAQAAAQABAAD/2wCEAAkGBhAQERUQEBAVFRAUEhoYEBESDxQSEhUSFRgVIBYUEhcYHCcfFxsvGxIXHy8gIycqLDgtFR4yNTAqNSYrLCoBCQoKBQUFDQUFDSkYEhgpKSkpKSkpKSkpKSkpKSkpKSkpKSkpKSkpKSkpKSkpKSkpKSkpKSkpKSkpKSkpKSkpKf/AABEIALwAkAMBIgACEQEDEQH/xAAbAAEAAgMBAQAAAAAAAAAAAAAAAgUBBAYDB//EAEMQAAICAQEDCAcDCgQHAAAAAAECAAMRBBIhMQUGMkFRYXGBEyIjQlKRoTNighRDcnOisbLB0fA0dJLSJFNjo7PCw//EABQBAQAAAAAAAAAAAAAAAAAAAAD/xAAUEQEAAAAAAAAAAAAAAAAAAAAA/9oADAMBAAIRAxEAPwD7hmMzEQM5jMxEDOYzMRAzmMzQ5U5bp0wHpW9ZuhWql7Hxx2UG8+PCVp52P1aK4r2l6FbyU2fvgdDmMygHO4e9pNQPBK3/AIXMmvPHS+96VP09NcB5kKRAvMxmVmm5y6Ow4TU1Fvh9Kob/AEkgyygZzGZiIGcxmYiBnMZmIgYzGZHMZgSzGZHMZgSzKjlvl8U+yqAs1TD1a8+qgP5y4jop9TwHaNXlzlpy502mbFg+3uxkUqRuCjg1pHAcAN56gdHSaNKgQg4nLsSWd262djvY95gR0uj2S1jsXuf7S1uk3YoHuoOpRuHjvmxEjdcqKXYgKoyzE4AA4kwJTM1tBrluTbUMPWIKuNl1IPBlO9TjBwe0TYgQu06OMOqsOxlDD5Geei17aEjJLaI7mUks2n++hO81dq+7xG7InrZaq9IgeJA/fPCvlKh29Gt1bMR0FtRiR17gYHYhgd44dRmczmebWs9C/wCRsfUwW0hJz7MdKn8OQR90j4Z0mYEsxmRzGYEsxmRzGYGMxmRzGYEsyp5wcrtSq104OptyKgRkIo6Vrj4VyN3WSB1y0zOVb1tVqXPEOta9yIinA7BtOx8TAaPSLUuyCTvJZmOWdzvZ3PWSd89oiAkeRuT/AMscXP8A4WtvYr1XWKftW7awR6o6yNrgBPDlPTtZTZWpwzVsqnvIOP7751HI2rS2iqysBUatSqgYCjA9THVjhjuga+u5s6e5zYVZbG6T1WPWWxw2tk4Y95ngOZul970r9z6m4jzAbfLyIFXVzW0S8NJTntNKM3zIJnrr+RKbqjSUCrxUoArI46LoQNzDt/rN+IHz7VXWVgmwf8To7FsbZGNtBxdB2NVtjHbkdU7lLAwDKcqRkEcCDwIlHzs0wVqdSBvDim3saq3hntw+yR4t2z25qOfySoH3A1flU7IPoggXGYzI5jMCWYzI5jMCOYzI5jMCWZy+ManVD/rK3k9VZH8/lOmzOV5U1C06q5mz61dLKqjLOxL1hVHWdpQPMQNqJ5WU6xV220nq9aper2gfoYwT3Bj3ZmdNqVsUOhyp4H94IO8HIxgwPQnrm7zLYnTsQD6I32GgkEbVTHO0ufd2mbHdiVOpoF1lOmPQtc+lA66q1LMvgTsqe5jO0VQBgDAHADhiBmIiAiIgU3PDTWWaK5ahm0KHrAGTt1sGGB1714SXItVaaepaW26hWNhx74O8v4kkk95lnqbxWjO3RVSzeCjJ+glNzfqZdNXtDDMDYwHANczOVHh6THlAs8xmRzGYEsxmRzGYEcxmQzGYE8yl5T0QfXaKw8FNwI6i2wGTPga2IlvmUnO5bPQpZU2zZVqKmRiMgZbYO0Ph9pg9xMDrJyHLGkfS2WX7AbS2OrOVOGqdsKzMp6Sk4Ykbxlt3XOh5G5TGppW0DZJyHTOSlikh0J7mBE1ud3+C1H6lv3QKrkrfr0z1aW0jxNmnB+k6ycjoX2dbSfiruT5+ib/5zroCIiAiIgeOt0wsres8HRlJ7mBH85U8h6gvpqWPS9EocdjoNlx/qUy8nP8AIf2Tf5i//wA1kCyzGZDMZgTzGZDMZgRzGZHMZgSzPDX6QXVPSxwLEKk9YyNzDvBwfKeuYzA5fkflSzTk37JKE7OvpXeUuTc91Y6+G9etdkjeN/aulWoqwcPTYnirIw+oIM5blqj0L/la9DAGqUfAOjeO9eDdq/ozd5o37Bt0vuV7NlH6q0v6o7g6OB3FYFjo+bWlpcWV0qrrnZYZJGRg4yeyWcRAREQEREDy1WoWtGsY4VFLMfuqCT9BKPkOsrp6g25ym24+/aS7D5uR5Ta51knSWIPzmzV5XOqH6OZJjv8AOBLMZkcxmBLMZkcxmBHMZkMxmBPMZkMxmBP+9/DzlNyTycdLra9ls0WVWV1oR61ZGy6pte8oCvs53gEjfultmVvKeuVL9Gh6b6r1cDgordWY9gzYq+LQOsiIgIiICIiBT85TkUp8eqr+SZc/SuZzKXlvnLpxr0qd9laUbLn7Mai0KFVzwUistvO72g4S3z/fdAnmMyGYzAnmMyGYzAjmMyOYzAlmMyI38JS8oc7NPVlUJusHu1EFQfv2dEeWT3QLm69UUu7BUUZZ2OFUdpM5KjULrWtvYMq7Yro3lXVKjkOCN6sXJb5DqlXylynbqWBuICKcpSmfRqfiOd7t3nyAlnzaHsPGyw/tn+kC+5O50WUYTV5erq1Sr6y/5hB/Gu7tA4zrKrldQyMGUjKspBBB4EEcROJnlpGt0zF9KQFJy+nYkUuesrj7Ju8bu0GB30Sk0XPDSuvtLFosHTqvdK2B7snDj7ykiaPLXOnb9jorFZyPaahGV0qU/CRkNYeodXE9QIe/LfOZkf0GmCtaPtXfJqqHUrBSCzn4QRgbyRuzT36nV2faatwvWtKLSPnvf9qeen061qFXh2k5JJ4sxO8kneSe2esDleVdElV+yigK9QJHaysQxOeJIZck75Lk7lO/TbqbMJ/yXG3V5DOU/CRNjnH9rT+rt/fTK+B02m58D89p3X71TravybZYfWWem50aOzcNQqn4bc0n/uAD6zhoIzxgfTQcjI3g8CN4PgeBjM+YU1+jOay1Z7anao+eyRnzljRzh1icL9sdl1av9Rst9YHcu4ALEgKBlmYhVA7WJ3AeMoNdzyqXdQpub4slKR+MjLfhB8ROY1d9l52r7DYQcgNgVqfuVj1R44z3yMD31/KV+o3XWZQ/mkGxV4EZy/4iZrqoG4DA6gNwmYgJd82T7DHZbYP2j/WUktebD7rU7LdrydV/mD8oF3ERAiyA8QD4jMyqgcBjwmYgIiIHPc4T7esdlT/V6/8AbNCbfLpzqfChfmz2f7ZqQEREBERAREQEREBNrkO3Z1GOqysj8VZyP2Wf5TVkLbCmzaONbBwO0DpDzUkQOziRrsDAMpyCAQe0HgflJQEREBERA5blVs6mzuWtf2c/+88Jhrdt7LOprWx4L6o/hmYCIiAiIgIiICIiAiIgW3NrVeq1B41H1O+ps7PyOV8hLqccmoNLrcPc3OB11N0h5YDfhnYI4IBByCMgjgQeBEDMREBNTlXWehpewdIL6ne53KPmRNuc/wA49TtOlI4L7Szx3isHz2m/CIFZRVsqF7AB8uuTiICIiAiIgIiICIiAiIgJZc29Zs50ze6C1PfX1p+En5EdkrZ46u0ovpV3PX6yHvHUe4gkHxgdtEwDMwPPUaha0Z3OFUEse4TkEdnLWP07G2mHwj3V8lAHzltzotPsq/cdyXHbsDKg92cHyErICIiAiIgIiIH/2Q==";

                            $rootScope.userProfileImage = userImage;
                        }
                    });
                } catch (e) { }
            }

            function mScrollbar() {
                if ($(".page-sidebar").hasClass('mCustomScrollbar')) {
                    if ($(".main_menu_side .menuScrollbar").mCustomScrollbar.length !== 0) {
                        //$(".main_menu_side .menuScrollbar").mCustomScrollbar('stop');
                        $(".main_menu_side .menuScrollbar").mCustomScrollbar('destroy');
                    }

                    $(".page-sidebar").mCustomScrollbar({
                        autoHideScrollbar: true,
                        scrollInertia: 0,
                        scrollbarPosition: "outside"
                    });
                }
            }

            setTimeout(function () {
                mScrollbar();

                if ($rootScope.configHeaderMenu !== undefined && $rootScope.configHeaderMenu !== null && $rootScope.configHeaderMenu !== "login") {
                    //getUserProfile();

                    var currentUrl = "";
                    if ($location.$$path !== undefined)
                        currentUrl = $location.$$path.substring(1, $location.$$path.length).toLowerCase();


                    if (scope.$parent !== undefined && scope.$parent !== null
                        && scope.$parent.$parent !== undefined && scope.$parent.$parent !== null
                        && scope.$parent.$parent.menus !== undefined && scope.$parent.$parent.menus !== null) {
                        var allMenus = navcon.getDataFromTree(scope.$parent.$parent.menus, '', 0);
                        var filterMenus = $.grep(allMenus, function (e) {
                            return e.ConfigName !== undefined && e.ConfigName !== null && e.ConfigName !== "";
                        });
                        if (filterMenus.length > 0 && filterMenus[0].ConfigName.toLowerCase() !== "dashboard") {
                            var locationPath = filterMenus[0].ConfigName.toString();
                            $location.path('/' + locationPath);
                            return;
                        } else {
                            loadAllData("0", "0", navcon.dateFromUTCToLocal(scope.filterStart, "MM-DD-YYYY"), navcon.dateFromUTCToLocal(scope.filterEnd, "MM-DD-YYYY"));
                            //loadModule();
                        }
                    } else if (currentUrl.toLowerCase() === "dashboard") {
                        loadAllData("0", "0", navcon.dateFromUTCToLocal(scope.filterStart, "MM-DD-YYYY"), navcon.dateFromUTCToLocal(scope.filterEnd, "MM-DD-YYYY"));
                        //loadModule();
                    }
                }

                scope.config.visible = true;
                if (window.dispatchEvent.length > 0)
                    window.dispatchEvent(new Event('resize'));
            }, 200);

            /*activate(function (widgets) {
                //scope.loadProject();
            });*/

            function getDashboardReports(widgets, callback) {
                var dashboardRights;
                var value = navcon.getItemByKeyValue(scope.userRights, "ConfigName", "dashboard");
                if (value !== -1)
                    dashboardRights = value;
                if (dashboardRights !== undefined && dashboardRights.children.length === 0) return
                var widgetLst = [];
                angular.forEach(dashboardRights.children, function (item, key) {
                    if (item.ConfigName !== undefined) {
                        var widget = widgets.inArray("configName", item.ConfigName);
                        if (widget !== -1) {
                            widgetLst.push(widget);
                        }
                    }
                });
                callback(widgetLst);
            }

            function activate(callback) {
                if (ngAuthSettings.widgetSetting !== undefined && ngAuthSettings.widgetSetting.length !== undefined) {
                    //scope.widgets = ngAuthSettings.widgetSetting;
                    callback(ngAuthSettings.widgetSetting);
                } else {
                    if ($rootScope.dashboardWidgets !== undefined) {
                        //scope.widgets = $rootScope.dashboardWidgets;
                        callback($rootScope.dashboardWidgets);
                        //return;
                    }/*dataservice.getData("Home/Widgets/GetAll").then(function (data) {
                            if (data !== undefined && data.length > 0) {
                                //scope.widgets = data;
                                $rootScope.dashboardWidgets = data;
                                callback(data);
                            } else {
                                callback([]);
                            }
                        });*/
                }
            };
        }
    }
}]);
"use strict";
angular.module('app').directive('navconMycount', ['$rootScope', 'dataservice', '$timeout',
    function($rootScope, dataservice, $timeout) {
        return {
            restrict: 'AE',
            //templateUrl: 'app/dashboard/directives/mycountTemplate.html',
            templateUrl: function() {
                return navcon.Menuroute.getTemplateUrl("mycountTemplate");
            },
            controller: function($scope) {
                $scope.navconData = $scope;
                $scope.moduleId = $scope.item.ModuleId;
                $scope.projectId = $scope.item.ProjectId;
                $scope.report = $scope.item.report;
                $scope.title = $scope.item.title.toString();
                $scope.causesData = $scope.item.data;

                function getServerData(type, rowId) {
                    return dataservice.getServerData(type, rowId).then(function(data) {
                        return data;
                    });
                };

                //$scope.causesData = [];

                $scope.$watch('projectId', function(newValue, oldValue) {
                    if (newValue !== undefined && newValue !== "" && $scope.causesData.length === 0) {
                        getServerData("mySpaceCountReport", newValue + "/" + $scope.moduleId).then(function(data) {
                            if (data !== undefined && data !== null && data.CausesInnerList !== undefined) {
                                $scope.causesData = data.CausesInnerList;

                                //$timeout(function () {
                                //    $('.navcon-dashboard-tile').tooltip();
                                //});
                            }
                        });
                    }
                }, true);

                //getServerData("mySpaceCountReport", $scope.projectId + "/" + $scope.moduleId).then(function (data) {
                //    if (data !== undefined && data !== null && data.CausesInnerList !== undefined) {
                //        $scope.causesData = data.CausesInnerList;
                //    }
                //});
            },
            link: function(scope, el, attrs) {}
        };
    }
]);
"use strict";
angular.module('app').directive('navconMyreport', ['$rootScope', 'dataservice',
    function($rootScope, dataservice) {
        return {
            restrict: 'E',
            //templateUrl: 'app/dashboard/directives/myreportTemplate.html',
            templateUrl: function() {
                return navcon.Menuroute.getTemplateUrl("myreportTemplate");
            },
            controller: function($scope) {
                $scope.navconData = $scope;
                $scope.report = $scope.item.report;
                $scope.title = $scope.item.title.toString()

                //    dataservice.getData($scope.reportCategory+"/GetAllReports").then(function (data) {
                //        $scope.reports = data;
                //    });
                //    $scope.report = {};

                $("#myFav ul").children().each(function() {
                    $(this).removeClass('highlight');
                });

                $("#allReports ul").children().each(function() {
                    $(this).removeClass('highlight');
                });

                //$(event.currentTarget).addClass('highlight');
                //$scope.report.title = $scope.title;
                //$scope.rportId = $scope.report.ReportDetailId;
                //$scope.report.source = "";
                //$scope.report.previewImage = "";

                navcon.callPrint($scope.report, $scope.report.ReportDetailId, function() {

                });

                //    $scope.generate = function(){
                //        navcon.callPrint($scope.report, $scope.rportId, function () {
                //        });
                //        $('#reportpreview').hide();
                //        $('#reportgenerate').show();
                //    };

                //    $scope.returntoreport = function(){
                //        $('#reportpreview').show();
                //        $('#reportgenerate').hide();

                //    };

                //    $scope.compare = function(){
                //        if(scope.isSplit)
                //            $scope.isSplit = false;
                //        else
                //            $scope.isSplit = true;

                //    }

                //    $("#myFav ul").children().each(function () {
                //        $(this).removeClass('highlight');
                //    });
                //    $("#allReports ul").children().each(function () {
                //        $(this).removeClass('highlight');
                //    });

                //    $scope.reportClick = function (event, report) {

                //        $("#myFav ul").children().each(function () {
                //            $(this).removeClass('highlight');
                //        });

                //        $("#allReports ul").children().each(function () {
                //            $(this).removeClass('highlight');
                //        });

                //        $(event.currentTarget).addClass('highlight');
                //        $scope.report.title = report.ReportName;
                //        $scope.rportId = report.ReportDetailId;
                //        $scope.report.source = "";
                //        $scope.report.previewImage = "";
                //    };
            },
            link: function(scope, el, attrs) {}
        };
    }
]);
"use strict";
angular.module('app').directive('navconMyriskmatrix', ['$rootScope', 'dataservice', '$timeout',
    function($rootScope, dataservice, $timeout) {
        return {
            restrict: 'AE',
            //templateUrl: 'app/dashboard/directives/myriskmatrixTemplate.html',
            templateUrl: function() {
                return navcon.Menuroute.getTemplateUrl("myriskmatrixTemplate");
            },
            controller: function($scope) {
                $scope.readOnly = true;
                $scope.navconData = $scope;
                $scope.riskMatrixData = [];

                $scope.title = $scope.item.title.toString();
                $scope.subTitle = $scope.item.subTitle.toString();
                $scope.moduleId = $scope.item.ModuleId;
                $scope.projectId = $scope.item.ProjectId;
                $scope.widgetId = $scope.item.widgetId.toString();
                $scope.reportType = $scope.item.reportType;

                $scope.options = $scope.item.options;

                $scope.reportId = $scope.item.FilterId;
                $scope.FilterKey = $scope.item.FilterKey;

                $scope.filterStart = $scope.item.filterStart;
                $scope.filterEnd = $scope.item.filterEnd;

                $scope.filterParameter = "";
                if ($scope.title.toLowerCase() === "hazard pre-mitigation risk class")
                    $scope.filterParameter = "CauseAnalysis/GetRiskMatrixPrePost/" + $scope.projectId + "/1";
                else if ($scope.title.toLowerCase() === "hazard post mitigation risk class")
                    $scope.filterParameter = "CauseAnalysis/GetRiskMatrixPrePost/" + $scope.projectId + "/2";
                else if ($scope.title.toLowerCase() === "hazard risk matrix aggregation")
                    $scope.filterParameter = "CauseAnalysis/GetRiskMatrixForAggregation/" + $scope.projectId;

                //$scope.report = $scope.item.report;
                //$scope.title = $scope.item.title.toString();
                //$scope.causesCount = $scope.item.data;

                function getServerData(type, rowId) {
                    return dataservice.getServerData(type, rowId).then(function(data) {
                        return data;
                    });
                };

                $scope.$watch('projectId', function(newValue, oldValue) {
                    if (newValue !== undefined && newValue !== "" && $scope.filterParameter !== "") {
                        getRiskMatrix(newValue);
                    }
                }, true);

                //dataservice.getData("RiskMatrix/GetRiskMatrixALL").then(function (data) {
                //    if (data !== undefined && data !== null) {
                //        $scope.riskmatrixTable.data = data;
                //        $scope.readonly = true;
                //    }
                //});

                function getRiskMatrix(projectId) {
                    var severityData = [];
                    var probalilityData = [];
                    // Check whether project has secerity then only risk matrix to be formed

                    //dataservice.getData("CauseAnalysis/GetRiskMatrixPrePost/" + projectId + "/1").then(function (data) {
                    //    var currentData = data;
                    //});

                    dataservice.getData("Severity/GetSeverityByProjectId/" + projectId).then(function(data) {
                        if (data !== undefined && data.length !== 0 && data !== null) {
                            severityData = data;
                            dataservice.getData("CauseDetail/GetProbabilityByProjectId/" + projectId).then(function(data) {
                                if (data === undefined || data.length === 0) {
                                    //logger.warning("Probability Not Yet Assigned to this project !", "", "");
                                    $scope.showRiskMatrixTable = false;
                                    return;
                                } else {
                                    probalilityData = data;
                                    dataservice.getData("RiskClass/GetRiskClassByProjectId/" + projectId).then(function(data) {
                                        if (data !== undefined && data !== null && data.length !== 0) {
                                            $scope.riskClasses = data;
                                        } else {
                                            //logger.warning("Risk Class Not Yet Assigned to this project !", "", "");
                                            $scope.showRiskMatrixTable = false;
                                            return;
                                        }
                                    });
                                }

                                $scope.riskMatrixData = [];
                                //dataservice.getData("CauseAnalysis/GetMappingRiskRegister/" + projectId).then(function (data) {
                                dataservice.getData($scope.filterParameter).then(function(data) {
                                    if (data !== undefined && data !== null && data.length !== 0) {
                                        $scope.riskMatrixData = data;
                                        if (data !== undefined && data[0] !== undefined && data[0].list !== undefined && data[0].list !== null && data[0].list.length !== 0) {
                                            $scope.mode = "update";
                                            $scope.SeverityTable = data[0].list;
                                            $scope.showRiskMatrixTable = true;
                                        } else if (data[0].list !== undefined && data[0].list !== null && data[0].list.length == 0) {
                                            $scope.mode = "save";
                                            var obj = {
                                                "RisClassId": 0,
                                                "RiskMatrixId": 0,
                                                "background": "#ffffff",
                                                "color": "#000000",
                                                "level": "",
                                                "severity": "",
                                                "sid": 0
                                            }

                                            $scope.SeverityTable = [];

                                            $.each($scope.riskMatrixData, function(index, value) {
                                                $.each(severityData, function(key, item) {
                                                    //   console.log(severityData);
                                                    //     obj.severity = item.SeverityName;
                                                    //   obj.sid = item.SeverityId;
                                                    if (index == 0) {
                                                        $scope.SeverityTable.push({
                                                            "RisClassId": 0,
                                                            "RiskMatrixId": 0,
                                                            "background": "#ffffff",
                                                            "color": "#000000",
                                                            "level": "",
                                                            "severity": item.SeverityName,
                                                            "sid": item.SeverityId
                                                        });
                                                    }
                                                    value.list.push({
                                                        "RisClassId": 0,
                                                        "RiskMatrixId": 0,
                                                        "background": "#ffffff",
                                                        "color": "#000000",
                                                        "level": "",
                                                        "severity": item.SeverityName,
                                                        "sid": item.SeverityId
                                                    });

                                                })

                                                $scope.mode = "save";
                                                $scope.showRiskMatrixTable = true;
                                            })

                                        } else {
                                            $scope.mode = "save";

                                            var obj = {
                                                "RisClassId": 0,
                                                "RiskMatrixId": 0,
                                                "background": "#ffffff",
                                                "color": "#000000",
                                                "level": "",
                                                "severity": "",
                                                "sid": 0
                                            }

                                            //severityData
                                            $.map(severityData, function(e) {
                                                if (e["SeverityName"] !== undefined && e["SeverityName"] !== null && e["SeverityName"] !== '') {
                                                    obj.severity = e["SeverityName"];
                                                }

                                                if (e["SeverityId"] !== undefined && e["SeverityId"] !== null && e["SeverityId"] !== '') {
                                                    obj.sid = e["SeverityId"];

                                                    data[0].list.push(obj);
                                                }
                                            });

                                            $scope.SeverityTable = data[0].list;
                                            $scope.showRiskMatrixTable = true;
                                        }
                                    }

                                });
                            });

                            //if ($scope.options.filter !== undefined && $scope.options.filter) {
                            //    //filterStart = filterStart.startOf('month');
                            //    filterSetting();
                            //}
                        }
                    });
                }

                function filterSetting() {
                    //var filterStart = moment().startOf('year');
                    //var filterEnd = moment();
                    $timeout(function() {
                        $('#reportrange_' + $scope.widgetId).daterangepicker({
                            autoUpdateInput: true,
                            showDropdowns: true,
                            timePicker: false,
                            minDate: moment().subtract(280, 'months'),
                            maxDate: moment(),
                            startDate: $scope.filterStart,
                            endDate: $scope.filterEnd,
                            opens: 'left',
                            buttonClasses: ['btn btn-default'],
                            applyClass: 'btn-small btn-primary',
                            cancelClass: 'btn-small',
                            format: navcon.defaultFormat().datetime,
                            separator: ' to ',
                            /*dateLimit: {
                                days: 60
                            },*/
                            ranges: {},
                            locale: {
                                format: navcon.defaultFormat().datetime,
                                applyLabel: 'Submit',
                                cancelLabel: 'Clear',
                                fromLabel: 'From',
                                toLabel: 'To',
                                customRangeLabel: 'Custom',
                                daysOfWeek: ['Su', 'Mo', 'Tu', 'We', 'Th', 'Fr', 'Sa'],
                                monthNames: ['January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December'],
                                firstDay: 1
                            }
                        }, function(start, end, label) {
                            cb(start, end, label);

                            $scope.filterStart = start;
                            $scope.filterEnd = end;
                            loadChartReport();
                        });
                    });
                };

                var cb = function(startDt, endDt, label) {
                    if (startDt !== undefined && endDt !== undefined) {
                        $timeout(function() {
                            $('#reportrange_' + $scope.widgetId + ' span').html(startDt.format(navcon.defaultFormat().dateDisplay) + ' - ' + endDt.format(navcon.defaultFormat().dateDisplay));
                            $scope.chartFilterData = startDt.format(navcon.defaultFormat().dateDisplay) + ' - ' + endDt.format(navcon.defaultFormat().dateDisplay);
                        });
                    }
                };
            },
            link: function(scope, el, attrs) {}
        };
    }
]);
"use strict";
angular.module('app').directive('navconMysummary', ['$rootScope', 'dataservice', '$timeout', 'ngAuthSettings',
    function($rootScope, dataservice, $timeout, ngAuthSettings) {
        return {
            restrict: 'AE',
            //templateUrl: 'app/dashboard/directives/mysummaryTemplate.html',
            templateUrl: function() {
                return navcon.Menuroute.getTemplateUrl("mysummaryTemplate");
            },
            controller: function($scope) {
                $scope.uploadBase = ngAuthSettings.uploadPath;
                $scope.summaryId = $scope.item.widgetId;
                $scope.title = $scope.item.title.toString()
                $scope.subTitle = $scope.item.title.toString()
                $scope.data = $scope.item.data;

                //$scope.data = [];
                function getServerData(type, rowId) {
                    return dataservice.getServerData(type, rowId).then(function(data) {
                        return data;
                    });
                };

                activate();

                function activate() {
                    if ($scope.data.length === 0) {
                        getServerData("mySpaceNews").then(function(data) {
                            if (data === undefined || data.length === 0) return;
                            $scope.data = data;
                        });
                    }
                }
            },
            link: function($scope, el, attrs) {

                $scope.openImage = function(obj) {
                    $scope.NewsTitle = obj.NewsTitle;
                    $scope.CreateDate = obj.CreateDate;
                    $scope.UpdatedByName = obj.UpdatedByName;
                    $scope.Summary = obj.Summary.replace(/\b(https?:\/\/[^\s\(\)\'\"\<\>]+)/ig, "<a ref='nofollow' href='$1' target='_blank'>$1</a>");
                    $scope.Summary = $scope.Summary.replace(/(?:\r\n|\r|\n)/g, '<br />');;
                    $scope.ContentType = obj.ContentType;
                    $scope.documentId = obj.documentId;
                    if ($scope.documentId != "" && $scope.documentId != null) {
                        dataservice.getData('MySpace/GetImageforBulletin/' + obj.documentId).then(function(data) {
                            $scope.Img = $scope.ContentType + data;
                            $('#modalImg').modal('show');
                        });
                    } else {
                        $scope.Img = "";
                        $('#modalImg').modal('show');
                    }


                }


                $scope.$watch('data', function(newValue, oldValue) {
                    if (newValue !== undefined) { //&& newValue !== oldValue) {
                        $timeout(function() {
                            if ($(".dashboardWidget_" + $scope.summaryId + "").length !== 0 && $("[type=mySpaceSummary_" + $scope.summaryId + "]").length !== 0) {
                                var widgetHeight = $(".dashboardWidget_" + $scope.summaryId + "").height();
                                $("[type=mySpaceSummary_" + $scope.summaryId + "]").find(".portlet-body").css({ "overflow": "auto", "height": (widgetHeight - 50) + "px" });
                            }

                            //$.map(newValue, function (item, index) {
                            //    if ($(".summaryRow_" + index + "").length !== 0) {
                            //        if (item.documents !== undefined && item.documents !== null && item.documents.length !== 0) {
                            //            var imageHeight = $(".summaryTemplate-image").width();

                            //            $(".summaryRow_" + index + "").css({ "height": (imageHeight - 30) + "px" });
                            //        }
                            //        else {
                            //            $(".summaryRow_" + index + "").css({ "height": "" });
                            //        }
                            //    }
                            //});

                            $("[type=mySpaceSummary_" + $scope.summaryId + "]").find(".portlet-body").mCustomScrollbar({
                                autoHideScrollbar: true,
                                theme: "3d-dark",
                                scrollInertia: 0,
                                scrollbarPosition: "outside"
                            });
                        });
                    }
                }, true);
            }
        };
    }
]);
"use strict";
angular.module('app').directive('navconLogin', ['$rootScope', 'dataservice', '$location', 'authService', 'ngAuthSettings',
        function($rootScope, dataservice, $location, authService, ngAuthSettings) {

            vm = this;

            return {
                /*E: Directive defined as an element. <navcon-table></navcon-table>
                A: Directive applied as an attribute on existing element. <div navcon-table></div>
                C: Directive applied as a css class to existing element <div class="navcon-table"></div>
                M: Directive applied as comment.*/
                restrict: 'E',
                transclude: true,
                scope: {
                    //@ reads the attribute value, = provides two-way binding, & works with functions
                    navconData: '=',
                    items: '=fieldData'
                },
                //templateUrl: 'app/login/directives/loginTemplate.html',
                templateUrl: function() {
                    return navcon.Menuroute.getTemplateUrl("login");
                },

                link: function(scope, el, attrs) {


                    scope.loginData = {
                        userName: "",
                        password: function() { return scope.loginfields[2].data; },
                        useRefreshTokens: false
                    };

                    function getData(type) {
                        return dataservice.getData(type).then(function(data) {
                            return data;
                        });
                    };

                    function activate() {
                        scope.showForgorPassword = false;
                        scope.showLogin = true;

                        getData('loginfields').then(function(data) {
                            if (data === undefined || data.length === 0) return;
                            scope.loginfields = data;

                        });

                        scope.message = "";

                        scope.login = function() {
                            scope.loginData.userName = scope.loginfields[1].data;
                            scope.loginData.password = scope.loginfields[2].data;
                            authService.login(scope.loginData).then(function(response) {

                                    $location.path('/dashboard');

                                },
                                function(err) {
                                    scope.message = err.error_description;
                                });
                        };



                        scope.authExternalProvider = function(provider) {

                            var redirectUri = location.protocol + '//' + location.host + '/authcomplete.html';

                            var externalProviderUrl = ngAuthSettings.apiServiceBaseUri + "api/Account/ExternalLogin?provider=" + provider +
                                "&response_type=token&client_id=" + ngAuthSettings.clientId +
                                "&redirect_uri=" + redirectUri;
                            window.$windowScope = scope;

                            var oauthWindow = window.open(externalProviderUrl, "Authenticate Account", "location=0,status=0,width=600,height=750");
                        };

                        scope.authCompletedCB = function(fragment) {

                            scope.$apply(function() {

                                if (fragment.haslocalaccount == 'False') {

                                    authService.logOut();
                                    logger.success("You have successfully log out...", "", "");

                                    authService.externalAuthData = {
                                        provider: fragment.provider,
                                        userName: fragment.external_user_name,
                                        externalAccessToken: fragment.external_access_token
                                    };

                                    $location.path('/associate');

                                } else {
                                    //Obtain access token and redirect to orders
                                    var externalData = { provider: fragment.provider, externalAccessToken: fragment.external_access_token };
                                    authService.obtainAccessToken(externalData).then(function(response) {

                                            $location.path('/orders');

                                        },
                                        function(err) {
                                            scope.message = err.error_description;
                                        });
                                }

                            });
                        }


                    };


                    activate();

                    console.log(scope);
                }
            };
        }
    ])
    .directive('loginEnter', function() {
        return function(scope, element, attrs) {
            element.bind("keydown keypress", function(event) {
                if (event.which === 13) {
                    scope.$apply(function() {
                        scope.$eval(attrs.loginEnter);
                    });

                    event.preventDefault();
                }
            });
        };
    });
"use strict";
angular.module('app').directive('navconChart', ['$localStorage', 'dataservice', '$timeout', 'logger', '$compile',
    function($localStorage, dataservice, $timeout, logger, $compile) {
        return {
            restrict: 'AE',
            //templateUrl: 'app/widgets/navconChart/navconChartTemplate.html',
            templateUrl: function() {
                return navcon.Menuroute.getTemplateUrl("navconChart");
            },
            controller: function($scope) {
                $scope.parentItem = $scope.item;
                $scope.title = $scope.item.title.toString();
                $scope.subTitle = $scope.item.subTitle.toString();
                $scope.moduleId = $scope.item.ModuleId;
                $scope.projectId = $scope.item.ProjectId;
                $scope.widgetId = $scope.item.widgetId.toString();
                $scope.reportType = $scope.item.reportType;
                $scope.chartData = $scope.item.data;

                $scope.options = $scope.item.options;

                $scope.reportId = $scope.item.FilterId;
                $scope.FilterKey = $scope.item.FilterKey;

                //$scope.filterStart = navcon.dateFormat("10/05/2012", "");
                //$scope.filterStart = moment().startOf('year');
                //$scope.filterEnd = moment();

                $scope.filterStart = $scope.item.filterStart;
                $scope.filterEnd = $scope.item.filterEnd;

                //$scope.$on('POPOVER-WIDGET-SETTING', function (ev, scope, data, callback) {
                //    if (data !== undefined && $scope.widgetId === scope.widgetId) {
                //        $scope.reportId = data[$scope.FilterKey];

                //        loadChartReport();

                //        $scope.item["FilterId"] = data[$scope.FilterKey];
                //        //$scope.saveWidget();
                //    }

                //    //if (callback !== undefined) callback();
                //});

                $scope.saveWidget = function() {
                    var widgets = [];
                    /*angular.forEach($scope.item, function (item, key) {
                        if (item["UserWidgetId"] === undefined) {
                            item["UserWidgetId"] = 0;
                            item["update"] = true;
                        }

                        item["FilterId"] = $scope.reportId;
                        
                    });*/
                    //$scope.item["FilterId"] = $scope.reportId;
                    widgets.push($scope.item);

                    if (widgets.length !== 0) {
                        dataservice.putServerData("mySpaceUpdate", widgets).then(function(data) {
                            //logger.warning("My space data Updated");
                            //$rootScope.dashboardWidgets = scope.widgets;
                        });
                    }
                }

                $scope.data = "";
                var returnData = chartData.getChartData($scope.reportType);
                //$scope.data = returnData;

                $scope.$watch('projectId', function(newValue, oldValue) {
                    if (newValue !== undefined && newValue !== "") {
                        if ($scope.chartData !== undefined && $scope.chartData !== "" && $scope.chartData.length !== 0)
                            loadChartDataReport($scope.reportType.toString(), $scope.chartData);
                        else
                            loadChartReport();
                    }
                }, true);

                function loadChartReport() {
                    if ($scope.reportId === undefined || $scope.reportId === null || $scope.reportId === "") return;
                    if ($scope.moduleId.toLowerCase() === "hazard" && $scope.reportId.toString().toLowerCase().indexOf("sort") > -1) return;
                    if ($scope.moduleId.toLowerCase() === "sort" && $scope.reportId.toString().toLowerCase().indexOf("hazard") > -1) return;

                    cb($scope.filterStart, $scope.filterEnd, "");

                    $scope.data = "";

                    var chartVariables = { "1": "mySpaceColumnReport", "2": "mySpaceDoughnutReport", "3": "mySpaceColumnReport" };
                    //var filterStart = navcon.dateFormat("10/05/2012", "");
                    ////var filterStart = moment();
                    //var filterEnd = moment();

                    var reportType = $scope.reportType.toString();
                    var apiName = chartVariables[reportType];

                    //if ($scope.reportId === undefined || $scope.reportId === null) $scope.reportId = "HazardSummary";
                    $scope.item["FilterId"] = $scope.reportId;

                    var parameterName = "";
                    if (reportType === "1" || reportType === "3")
                        parameterName = $scope.projectId + "/" + $scope.reportId + "/" + navcon.dateFromUTCToLocal($scope.filterStart, "MM-DD-YYYY") + "/" + navcon.dateFromUTCToLocal($scope.filterEnd, "MM-DD-YYYY");
                    else if (reportType === "2")
                        parameterName = $scope.projectId + "/" + $scope.moduleId;

                    //var collectionChartData = angular.copy(returnData);
                    getServerData(apiName, parameterName).then(function(data) {
                        if (data === undefined || data === null || data.length === 0) return;

                        loadChartDataReport(reportType, data);
                    });
                }

                function loadChartDataReport(reportType, data) {
                    if (data !== undefined && data !== null && data.length !== 0) {
                        if (data.title !== undefined && data.title !== null) $scope.title = data.title.toString();
                        if (data.subTitle !== undefined && data.subTitle !== null) $scope.subTitle = data.subTitle.toString();

                        var paletteColorsCollection = "";
                        var dataset = [];

                        if (reportType === "1") {
                            returnData.categories = data.categories;

                            var splColor = returnData.chart.paletteColors.split(",");
                            for (var iSet = 0, iLen = data.dataset.length; iSet < iLen; iSet++) {
                                //var seriesColor = data.dataset[iSet].Color;
                                //paletteColorsCollection += iSet < iLen ? seriesColor + "," : seriesColor;

                                for (var jCat = 0, jLen = data.categories[0].category.length; jCat < jLen; jCat++) {

                                    var toolText = "<div class='chartToolTip' style='text-align: center;vertical-align: middle;'>";
                                    toolText += "<div class='margin-bottom-10' style='font-weight: 600;'>" + data.categories[0].category[jCat].label + "</div>";

                                    for (var iTemp = 0, iTempLen = data.dataset.length; iTemp < iTempLen; iTemp++) {
                                        var seriesColor = splColor[iTemp];
                                        //var seriesColor = data.dataset[iTemp].Color;
                                        if (data.dataset[iTemp].data !== undefined && data.dataset[iTemp].data.length > jCat && data.dataset[iTemp].data[jCat].value !== undefined)
                                            toolText += "<div  class='margin-bottom-5' style='color:" + seriesColor + "'>" + data.dataset[iTemp].seriesname + ": " + data.dataset[iTemp].data[jCat].value + "</div>";
                                    }

                                    toolText += "</div>";
                                    if (data.dataset[iSet].data !== undefined && data.dataset[iSet].data.length > jCat)
                                        data.dataset[iSet].data[jCat].tooltext = toolText;
                                }

                                dataset.push(data.dataset[iSet]);
                            }

                            //returnData.chart.paletteColors = paletteColorsCollection;
                            returnData.dataset = dataset;
                        } else if (reportType === "2") {
                            //returnData.data = data.data;

                            for (var iSet = 0, iLen = data.data.length; iSet < iLen; iSet++) {
                                //data.data[iSet].value = data.data[iSet].Value === "0" ? "1" : data.data[iSet].Value;
                                dataset.push(data.data[iSet]);
                            }

                            if (data !== undefined && data.chart !== undefined && data.chart.paletteColors !== undefined && data.chart.paletteColors !== null)
                                returnData.chart.paletteColors = data.chart.paletteColors

                            returnData.data = dataset;
                        } else if (reportType === "3") {
                            //returnData = collectionChartData;
                        }

                        $scope.data = returnData;

                        if ($scope.options.filter !== undefined && $scope.options.filter) {
                            //filterStart = filterStart.startOf('month');
                            filterSetting();
                        }
                    }
                };

                function loadChartReport1() {
                    if ($scope.reportId === undefined || $scope.reportId === null || $scope.reportId === "") return;
                    if ($scope.moduleId.toLowerCase() === "hazard" && $scope.reportId.toString().toLowerCase().indexOf("sort") > -1) return;
                    if ($scope.moduleId.toLowerCase() === "sort" && $scope.reportId.toString().toLowerCase().indexOf("hazard") > -1) return;

                    cb($scope.filterStart, $scope.filterEnd, "");

                    $scope.data = "";

                    var chartVariables = { "1": "mySpaceColumnReport", "2": "mySpaceDoughnutReport", "3": "mySpaceColumnReport" };
                    //var filterStart = navcon.dateFormat("10/05/2012", "");
                    ////var filterStart = moment();
                    //var filterEnd = moment();

                    var reportType = $scope.reportType.toString();
                    var apiName = chartVariables[reportType];

                    //if ($scope.reportId === undefined || $scope.reportId === null) $scope.reportId = "HazardSummary";
                    $scope.item["FilterId"] = $scope.reportId;

                    var parameterName = "";
                    if (reportType === "1" || reportType === "3")
                        parameterName = $scope.projectId + "/" + $scope.reportId + "/" + navcon.dateFromUTCToLocal($scope.filterStart, "MM-DD-YYYY") + "/" + navcon.dateFromUTCToLocal($scope.filterEnd, "MM-DD-YYYY");
                    else if (reportType === "2")
                        parameterName = $scope.projectId + "/" + $scope.moduleId;

                    //var collectionChartData = angular.copy(returnData);
                    getServerData(apiName, parameterName).then(function(data) {
                        if (data === undefined || data === null || data.length === 0) return;

                        if (data.title !== undefined && data.title !== null) $scope.title = data.title.toString();
                        if (data.subTitle !== undefined && data.subTitle !== null) $scope.subTitle = data.subTitle.toString();

                        var paletteColorsCollection = "";
                        var dataset = [];

                        if (reportType === "1") {
                            returnData.categories = data.categories;

                            var splColor = returnData.chart.paletteColors.split(",");
                            for (var iSet = 0, iLen = data.dataset.length; iSet < iLen; iSet++) {
                                //var seriesColor = data.dataset[iSet].Color;
                                //paletteColorsCollection += iSet < iLen ? seriesColor + "," : seriesColor;

                                for (var jCat = 0, jLen = data.categories[0].category.length; jCat < jLen; jCat++) {

                                    var toolText = "<div class='chartToolTip' style='text-align: center;vertical-align: middle;'>";
                                    toolText += "<div class='margin-bottom-10' style='font-weight: 600;'>" + data.categories[0].category[jCat].label + "</div>";

                                    for (var iTemp = 0, iTempLen = data.dataset.length; iTemp < iTempLen; iTemp++) {
                                        var seriesColor = splColor[iTemp];
                                        //var seriesColor = data.dataset[iTemp].Color;
                                        if (data.dataset[iTemp].data !== undefined && data.dataset[iTemp].data.length > jCat && data.dataset[iTemp].data[jCat].value !== undefined)
                                            toolText += "<div  class='margin-bottom-5' style='color:" + seriesColor + "'>" + data.dataset[iTemp].seriesname + ": " + data.dataset[iTemp].data[jCat].value + "</div>";
                                    }

                                    toolText += "</div>";
                                    if (data.dataset[iSet].data !== undefined && data.dataset[iSet].data.length > jCat)
                                        data.dataset[iSet].data[jCat].tooltext = toolText;
                                }

                                dataset.push(data.dataset[iSet]);
                            }

                            //returnData.chart.paletteColors = paletteColorsCollection;
                            returnData.dataset = dataset;
                        } else if (reportType === "2") {
                            //returnData.data = data.data;

                            for (var iSet = 0, iLen = data.data.length; iSet < iLen; iSet++) {
                                //data.data[iSet].value = data.data[iSet].Value === "0" ? "1" : data.data[iSet].Value;
                                dataset.push(data.data[iSet]);
                            }

                            returnData.data = dataset;
                        } else if (reportType === "3") {
                            //returnData = collectionChartData;
                        }

                        $scope.data = returnData;

                        if ($scope.options.filter !== undefined && $scope.options.filter) {
                            //filterStart = filterStart.startOf('month');
                            filterSetting();
                        }
                    });
                };

                function getServerData(type, rowId) {
                    return dataservice.getServerData(type, rowId).then(function(data) {
                        return data;
                    });
                };

                function filterSetting() {
                    //var filterStart = moment().startOf('year');
                    //var filterEnd = moment();
                    $timeout(function() {
                        //$(".chartToolTip").on("mousemove", function (object, evt) {
                        //    alert(object);
                        //});
                        $('#reportrange_' + $scope.widgetId).daterangepicker({
                            autoUpdateInput: true,
                            showDropdowns: true,
                            timePicker: false,
                            minDate: moment().subtract(280, 'months'),
                            maxDate: moment(),
                            startDate: $scope.filterStart,
                            endDate: $scope.filterEnd,
                            opens: 'left',
                            buttonClasses: ['btn btn-default'],
                            applyClass: 'btn-small btn-primary',
                            cancelClass: 'btn-small',
                            format: navcon.defaultFormat().datetime,
                            separator: ' to ',
                            /*dateLimit: {
                                days: 60
                            },*/
                            ranges: {},
                            locale: {
                                format: navcon.defaultFormat().datetime,
                                applyLabel: 'Submit',
                                cancelLabel: 'Clear',
                                fromLabel: 'From',
                                toLabel: 'To',
                                customRangeLabel: 'Custom',
                                daysOfWeek: ['Su', 'Mo', 'Tu', 'We', 'Th', 'Fr', 'Sa'],
                                monthNames: ['January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December'],
                                firstDay: 1
                            }
                        }, function(start, end, label) {
                            cb(start, end, label);

                            $scope.filterStart = start;
                            $scope.filterEnd = end;
                            loadChartReport();
                        });
                    });
                };

                var cb = function(startDt, endDt, label) {
                    if (startDt !== undefined && endDt !== undefined) {
                        $timeout(function() {
                            $('#reportrange_' + $scope.widgetId + ' span').html(startDt.format(navcon.defaultFormat().dateDisplay) + ' - ' + endDt.format(navcon.defaultFormat().dateDisplay));
                            $scope.chartFilterData = startDt.format(navcon.defaultFormat().dateDisplay) + ' - ' + endDt.format(navcon.defaultFormat().dateDisplay);
                        });
                    }
                };
            },
            link: function($scope, el, attrs) {

                /*$scope.$on('POPOVER-WIDGET-SETTING', function (ev, scope, data, callback) {
                    if (data !== undefined && $scope.widgetId === scope.widgetId) {
                        //scope.item["FilterId"] = data[scope.FilterKey];
                        $scope.reportId = data[$scope.FilterKey];

                        $scope.item = $scope.parentItem;
                        $scope.item.template = "<navcon-myriskmatrix ></navcon-myriskmatrix>";

                        var newElement = angular.element($scope.item.template);
                        el.html(newElement);
                        $compile(newElement)($scope);

                        //loadChartReport();
                                                
                        //$scope.saveWidget();
                    }

                    //if (callback !== undefined) callback();
                });*/
            }
        };
    }
]);
/// <reference path="../page1/page1.html" />
"use strict";
angular.module('app').directive('navconDeleteRemarks', ['$rootScope', 'dataservice',
    function($rootScope, dataservice) {
        return {
            /*E: Directive defined as an element. <navcon-table></navcon-table>
             A: Directive applied as an attribute on existing element. <div navcon-table></div>
             C: Directive applied as a css class to existing element <div class="navcon-table"></div>
             M: Directive applied as comment.*/
            restrict: 'E',
            transclude: true,
            scope: {
                //@ reads the attribute value, = provides two-way binding, & works with functions
                navconData: '='
            },
            controller: function($scope, $rootScope) {
                $scope.formManage = {};
                $scope.pageConfig = {};

                var ITARWarningIndex;

                $scope.itarwarning = false;
                /*Page Actions*/
                activate();

                /*Fields*/
                // $scope.deleteRemarksSubmitFields = $scope.navconData.deleteRemarksSubmitFields;
                /*Tables*/


                /*breadcrumbs*/
                /*Variable Declaration*/
                /*Variable Declaration*/
                /*Page Actions*/
                /*Add New*/
                /*Table Action Click*/
                /*Delete*/
                /*Table Actions*/

                /*Privat functions*/
                function getData(type, page) {
                    return dataservice.getData(type, page).then(function(data) {
                        return data;
                    });
                };

                function getServerData(type, rowId) {
                    return dataservice.getServerData(type, rowId).then(function(data) {
                        return data;
                    });
                };


                $scope.save = function(type, fields) {
                    var fieldCondition = $scope.formManage.formValid(fields);
                    if (fieldCondition != undefined && fieldCondition == true) {
                        $scope.navconData.deleteWithRemarks(fields);
                        navcon.clearFieldsData($scope.deleteRemarksSubmitFields);
                    }
                };

                $scope.cancel = function(type) {
                    //$scope.navconData.cancel(type);
                    navcon.clearFieldsData($scope.deleteRemarksSubmitFields);
                    navcon.closeModal(type);
                };

                function getFields() {


                }

                function activate(callback) {

                    dataservice.getServerData("deleteConfig").then(function(data) {
                        $scope.pageConfig = data;
                        $scope.deleteRemarksSubmitFields = angular.copy(data.fields.deleteRemarksSubmitFields);
                        ITARWarningIndex = navcon.getItemIndexByProperty($scope.deleteRemarksSubmitFields, "ITARWarning");

                        watchAttributes();
                    });

                };


                function watchAttributes() {
                    $scope.$watch("deleteRemarksSubmitFields[" + ITARWarningIndex + "].data", function(newValue, oldValue) {
                        if (newValue != undefined && newValue != '') {
                            $scope.itarwarning = newValue;
                        } else {
                            $scope.itarwarning = false;
                        }
                    }, true);

                }


            },
            //templateUrl: 'app/delete/delete.html',
            templateUrl: function() {
                return navcon.Menuroute.getTemplateUrl("delete");
            },
            link: function(scope, el, attrs) {
                //console.log(scope);
            }
        };
    }
]);
"use strict";
angular.module('app').directive('navconCalendar', [
function (dataService) {
    return {
        /*E: Directive defined as an element. <navcon-table></navcon-table>
        A: Directive applied as an attribute on existing element. <div navcon-table></div>
        C: Directive applied as a css class to existing element <div class="navcon-table"></div>
        M: Directive applied as comment.*/
        restrict: 'E',
        scope: {
            //@ reads the attribute value, = provides two-way binding, & works with functions
            calendarSetting: '=',
            navconData: '='
        },
        template: '<div type="calendar"></div>',
        link: function (scope, el, attrs) {
            //navcon.calendarSetting(el, scope.calendarSetting);

            scope.$watch('calendarSetting', function (newValue, oldValue) {
                navcon.calendarSetting(el, scope.calendarSetting, scope);
            }, true);

            scope.$watch('calendarSetting.data', function (newValue, oldValue) {
                if (newValue !== undefined && newValue !== "") {
                    //if (newValue !== oldValue) {
                    if (newValue.resources !== undefined) scope.calendarSetting.resources = newValue.resources;
                    if (newValue.events !== undefined) scope.calendarSetting.events = newValue.events;
                    //}
                }
            }, true);
        }
    };
}]);
"use strict";
angular.module('app').directive('navconOrgchart', [
function (dataService) {
    return {
        /*E: Directive defined as an element. <navcon-table></navcon-table>
        A: Directive applied as an attribute on existing element. <div navcon-table></div>
        C: Directive applied as a css class to existing element <div class="navcon-table"></div>
        M: Directive applied as comment.*/
        restrict: 'E',
        scope: {
            //@ reads the attribute value, = provides two-way binding, & works with functions
            chartSetting: '=',
            navconData: '=',
            type: '@'
        },
        template: '<div id="orgChartContainer"><div id="orgChart" type="orgChart"></div></div>',
        link: function (scope, el, attrs) {
            //$($(el).find("div[type='chart']")[0]);

            scope.$watch('chartSetting', function (newValue, oldValue) {
                if (newValue !== undefined && newValue !== "") {
                    navcon.chartSetting(el, scope.chartSetting, scope);
                }
            }, true);

            scope.$watch('chartSetting.data', function (newValue, oldValue) {
                if (newValue !== undefined && newValue !== "") {
                    scope.chartSetting.data = newValue;
                }
            }, true);
        }
    };
}]);
"use strict";

angular.module('navconDashboard').directive('mainDashboard', ['$rootScope', 'logger', 'dataservice', function($rootScope, logger, dataservice) {
    return {
        restrict: 'AE',
        /*scope: {
            pageConfig: '='
        },*/
        //templateUrl: 'ext-modules/navconDashboard/navconDashboardTemplate.html',
        templateUrl: function() {
            return navcon.Menuroute.getTemplateUrl("navconDashboard");
        },
        link: function(scope, element, attrs) {
            element.bind('blur', function(e) {
                //do something
                //console.log(e);
            });

            //scope.$watch('projectId', function (newValue, oldValue) {
            //    if (newValue !== undefined && newValue !== oldValue) {
            //        //logger.warning(newValue);
            //    }
            //}, true);

            scope.addNewWidget = function(widget) {
                var newWidget = angular.copy(widget.settings);
                var found = navcon.getItemByKeyValue(scope.widgets, "widgetId", widget.settings.widgetId);
                if (found !== -1) {
                    logger.warning("It's already added!..");
                    return;
                }
                scope.widgets.push(newWidget);
                scope.$broadcast('DASHBOARD-WIDGET-ACTION', 'add');
            };

            scope.close = function() {
                $("#themeset").hide();
                $("#themeclose").hide();
            };

            scope.themeopen = function() {
                $("#themeset").show();
            };

            scope.themechange = function(theme) {
                $('link[href*="flynastheme"]').attr('href', 'content/flynastheme-' + theme + '.css');
                $('img[src*="logo_"]').attr('src', '../../Content/layout/img/logo_' + theme + '.png');
                $("#themeset").hide();
            };

            //Popover template
            scope.$watch('projectId', function(newValue, oldValue) {
                if (newValue !== undefined && newValue !== oldValue) {
                    scope.popoverTemplate = '<div style="color: black"><select class="col-md-8 margin-bottom-10" ng-model="selectedProject" ng-click="onReportClick()" ng-options="x.ProjectName for x in items" ng-hide="items.length===0"></select></div>';
                    //scope.popoverTemplate = angular.copy(scope.item.popoverTemplate);
                    scope.templateSettings = {
                        placement: "bottom",
                        html: true,
                        title: scope.title,
                        templateHtml: scope.popoverTemplate
                    };
                }
            }, true);

            scope.onClick = function(key, selectedData, e) {
                if (key === "module" && selectedData !== undefined && selectedData !== null && scope.userModule !== selectedData) {
                    scope.userModule = selectedData;
                } else if (key === "project" && selectedData !== undefined && selectedData !== null && scope.userProject !== selectedData) {
                    scope.userProject = selectedData;
                }
            };
        }
    };
}]);
"use strict";

angular.module('navconDashboard').directive('navconWidgetBody', ['$compile', '$modal', 'dataservice', '$rootScope', '$timeout', 'logger',
    function($compile, $modal, dataservice, $rootScope, $timeout, logger) {
        return {
            restrict: 'AE',
            scope: {
                pageConfig: '=',
                item: '=',
                widgets: '='
            },
            //templateUrl: 'ext-modules/navconDashboard/navconWidgetBodyTemplate.html',
            templateUrl: function() {
                return navcon.Menuroute.getTemplateUrl("navconWidgetBody");
            },
            link: function(scope, element, attrs) {
                scope.widgetId = angular.copy(scope.item.widgetId);
                scope.moduleId = angular.copy(scope.item.ModuleId);
                scope.popoverTemplate = angular.copy(scope.item.popoverTemplate);
                scope.options = angular.copy(scope.item.options);

                if (scope.item !== undefined && scope.item.reportSetting !== undefined)
                    scope.reportSetting = angular.copy(scope.item.reportSetting);

                //scope.reportList = [];
                scope.defaultReport = [];

                function getServerData(type, rowId) {
                    return dataservice.getServerData(type, rowId).then(function(data) {
                        return data;
                    });
                };

                if (scope.item !== undefined && scope.item.options !== undefined && scope.item.options.filter) {
                    if (scope.item.reportList !== undefined && scope.item.reportList.length === 0) {
                        getServerData("mySpaceReportList", scope.moduleId).then(function(data) {
                            var reportList = scope.item.reportList;
                            if (data !== undefined && data !== null && data.length != 0) {
                                reportList = data;
                            }
                            scope.reportList = reportList;

                            var defaultReport = scope.reportList[0];
                            if (scope.item.FilterId !== undefined && scope.item.FilterId !== null && scope.item.FilterId !== "") {
                                var keyId = scope.item.FilterKey;
                                var checkValue = scope.item.FilterId.toString();
                                var itemList = navcon.getItemByKeyValue(scope.reportList, keyId, checkValue);
                                defaultReport = itemList;
                            }
                            scope.defaultReport = defaultReport;
                        });
                    } else if (scope.item.reportList !== undefined) {
                        $timeout(function() {
                            scope.reportList = angular.copy(scope.item.reportList);

                            var defaultReport = scope.reportList[0];
                            if (scope.item.FilterId !== undefined && scope.item.FilterId !== null && scope.item.FilterId !== "") {
                                var keyId = scope.item.FilterKey;
                                var checkValue = scope.item.FilterId.toString();
                                var itemList = navcon.getItemByKeyValue(scope.reportList, keyId, checkValue);
                                defaultReport = itemList;
                            }
                            scope.defaultReport = defaultReport;
                        });
                    }
                }

                //var templateData = '"<select class="col-md-8 margin-bottom-10" ng-model="selectedReport" ng-click="onReportClick()" ng-options="x.title for x in items" ng-hide="reportList.length===0"></select>';

                scope.templateSettings = {
                    placement: "left",
                    html: true,
                    title: scope.title,
                    templateHtml: scope.popoverTemplate
                };

                //scope.onReportClick = function (item) {
                //    logger.warning(item);
                //};

                var templage = "<div></div>";
                if (scope.item.template !== undefined && scope.item.template !== "")
                    templage = scope.item.template;
                var newElement = angular.element(templage);
                element.append(newElement);
                $compile(newElement)(scope);

                scope.$on('POPOVER-WIDGET-SETTING', function(ev, popOverScope, data, callback) {
                    if (data !== undefined && scope.widgetId === popOverScope.widgetId) {
                        if (scope.item.FilterKey === undefined || scope.item.FilterKey === null || scope.item.FilterKey === "")
                            scope.item.FilterKey = "ReportCode";

                        scope.item["FilterId"] = data[scope.item.FilterKey];
                        //scope.reportId = data[scope.item.FilterKey];

                        //if (parseInt(data.MySpaceReportId) > 1) {
                        scope.item.title = data.ReportName;
                        scope.item.template = data.Template;
                        //}

                        var newElement = angular.element(scope.item.template);
                        //element.append(newElement);
                        $(element.children()[1]).html(newElement);
                        $compile(newElement)(scope);
                    }

                    //if (callback !== undefined) callback();
                });

                scope.close = function() {
                    $rootScope.$broadcast('DASHBOARD-WIDGET-ACTION', 'delete', function() {
                        var deletedIndex = scope.widgets.indexOf(scope.item);
                        var previousId = scope.item.widgetId;
                        var previousLeft = $(".dashboardWidget_" + scope.item.widgetId).css("left").replace("px", "");
                        var previousTop = $(".dashboardWidget_" + scope.item.widgetId).css("top").replace("px", "");

                        scope.widgets.splice(deletedIndex, 1);

                        //var widgets = [];
                        //angular.forEach(scope.widgets, function (item, key) {
                        //    if (item["userWidgetId"] === undefined) {
                        //        item["userWidgetId"] = 0;
                        //        item["update"] = true;
                        //    }
                        //    widgets.push(item);
                        //});

                        //dataservice.putServerData("Home/Widgets/Update", widgets, "Home/Widgets/Update").then(function (data) {
                        //    $rootScope.dashboardWidgets = scope.widgets;
                        //});

                        scope.saveWidget();

                        $.map(scope.widgets, function(item, index) {
                            if (deletedIndex <= index) {
                                var currentLeft = $(".dashboardWidget_" + item.widgetId).css("left").replace("px", "");
                                var currentTop = $(".dashboardWidget_" + item.widgetId).css("top").replace("px", "");

                                previousId = item.widgetId;

                                if (item.sizeX !== 12 && parseInt(currentLeft) > 0) {
                                    $(".dashboardWidget_" + item.widgetId).css("left", previousLeft + "px");
                                    $(".dashboardWidget_" + item.widgetId).css("top", previousTop + "px");

                                    previousLeft = "";
                                    previousTop = "";
                                } else if (previousTop !== "") {
                                    $(".dashboardWidget_" + item.widgetId).css("top", previousTop + "px");
                                    previousTop = currentTop;
                                } else {
                                    previousLeft = "";
                                    previousTop = "";
                                }
                            }
                        });
                    });
                };

                scope.settings = function() {
                    /*var options = {
                        templateUrl: scope.item.template,
                        controller: scope.item.widgetSettings.controller,
                        resolve: scope.item.widgetSettings.resolve,
                        scope: scope
                    };
                    $modal.open(options);*/
                };
                //scope.settings();
                scope.iconClicked = function() {
                    // empty body.
                    // this function is used by ng-click in the template
                    // so that icon clicks aren't intercepted by widgets
                };

                scope.openSettings = function() {
                    $(".widgetSettings").css("display", "block");
                };

                scope.saveWidget = function() {
                    var widgets = [];
                    angular.forEach(scope.widgets, function(item, key) {
                        if (item["UserWidgetId"] === undefined) {
                            item["UserWidgetId"] = 0;
                            item["update"] = true;
                        }

                        widgets.push(item);
                    });

                    if (widgets.length !== 0) {
                        dataservice.putServerData("mySpaceUpdate", widgets).then(function(data) {
                            //logger.warning("My space data Updated");
                            //$rootScope.dashboardWidgets = scope.widgets;
                        });
                    }
                }
            }
        };
    }
]);
"use strict";
angular.module('app').directive('navconDropdown', [
function (dataService) {
    return {
        /*E: Directive defined as an element. <navcon-table></navcon-table>
        A: Directive applied as an attribute on existing element. <div navcon-table></div>
        C: Directive applied as a css class to existing element <div class="navcon-table"></div>
        M: Directive applied as comment.*/
        restrict: 'E',
        scope: {
            //@ reads the attribute value, = provides two-way binding, & works with functions
            selectOptions: '=',
            selected:'@',
            items:'@'
        },
        template: '<ui-select ng-model="selected" theme="selectize">' + 
            '<ui-select-match placeholder="{{selectOptions.placeholder}}">{{$select.selected.text}}</ui-select-match>' +
            '<ui-select-choices repeat="item in items ">' +
            '<div ng-bind-html="item.text | highlight: $select.search"></div>' +
            '</ui-select-choices></ui-select> ',
        link: function (scope, el, attrs) {
            scope.items = scope.selectOptions.items;
            //console.log(scope);    
        }
    };
}]);
"use strict";
angular.module('app').directive('navconEvaluation', ['dataservice', 'logger', '$timeout', '$compile',
    function(dataservice, logger, $timeout, $compile) {
        return {
            restrict: 'E',
            scope: {
                optionSettings: '=',
                navconData: '=',
                type: '@',
                templateUrl: '@',
                isExpand: '@'
            },
            //templateUrl: 'ext-modules/navconEvaluation/navconEvaluationTemplate.html',
            templateUrl: function() {
                return navcon.Menuroute.getTemplateUrl("navconEvaluation");
            },
            controller: function($scope) {
                $scope.items = [];
                $scope.textFields = "text";
                $scope.gradeFields = "EfromRatingId";
                $scope.remarksFields = "Remarks";

                $scope.optionData = [];
                $scope.optionId = "id";
                $scope.optionText = "text";

                $scope.toggleCollapse = toggleCollapse;

                $scope.$watch('isExpand', function(newValue, oldValue) {
                    $scope.toggleCollapse($scope.items)
                });

                $scope.$watch('optionSettings', function(newValue, oldValue) {
                    if (newValue !== undefined && newValue !== "") {
                        $scope.textFields = newValue.fieldKey.textField;
                        $scope.gradeFields = newValue.fieldKey.gradeField;
                        $scope.remarksFields = newValue.fieldKey.remarksField;

                        $scope.optionId = newValue.fieldKey.optionField.id;
                        $scope.optionText = newValue.fieldKey.optionField.text;
                        $scope.optionRequired = newValue.fieldKey.optionField.required;
                    }
                });

                $scope.$watch('optionSettings.core.optionData', function(newValue, oldValue) {
                    if (newValue !== undefined && newValue !== "" && newValue.length > 0) {
                        if ($scope.optionSettings !== undefined && $scope.optionSettings !== null)
                            $scope.optionData = newValue;
                    }
                });

                $scope.$watch('optionSettings.core.data', function(newValue, oldValue) {
                    if (newValue !== undefined && newValue !== "" && newValue.length > 0) {
                        $scope.items = addDepthToTree(newValue, 1, $scope.collapsed, $scope);
                    }
                });

                $scope.gradeChange = function(data, item, ctrl) {
                    var ctrlId = item.id;
                    $("#" + ctrlId + "_grade").removeClass("evaluation-mandatory");

                    var remarks = $("#" + ctrlId + "_remarks");
                    if (data.Failure) {
                        item.data.Failure = true;
                        $("#" + ctrlId + "_spnremarks").addClass("evaluation-Remarks-Failure");
                        if (remarks !== undefined && remarks[0].value === "") {
                            logger.warning("Please enter remarks");
                            remarks.addClass("evaluation-Remarks-Failure");
                            remarks.focus();
                        }
                    } else {
                        item.data.Failure = false;
                        $("#" + ctrlId + "_spnremarks").removeClass("evaluation-Remarks-Failure");
                        remarks.removeClass("evaluation-Remarks-Failure");
                    }
                };

                $scope.RemarkChange = function(data, ctrl, ctrlId) {
                    var remarks = $("#" + ctrlId + "_remarks");
                    if (data !== undefined && data != "") {
                        remarks.removeClass("evaluation-Remarks-Failure");
                    } else if (data !== undefined && data == "") {
                        remarks.addClass($("#" + ctrlId + "_spnremarks")[0].className);
                    }
                };

                function toggleCollapse(obj) {
                    for (var key in obj) {
                        if (obj[key] && typeof(obj[key]) == 'object') {
                            obj[key].collapsed = !obj[key].collapsed;
                            toggleCollapse(obj[key])
                        }
                    }
                    return obj
                };

                function addDepthToTree(obj, depth, collapsed, $scope) {
                    for (var key in obj) {
                        if (obj[key] && key === "data" && typeof(obj[key]) == 'object') {
                            var itemList = navcon.getItemByKeyValue($scope.optionData, $scope.optionId, obj[key][$scope.gradeFields]);
                            if (obj.children !== undefined && obj.children !== null)
                                obj[key][$scope.gradeFields] = itemList !== -1 ? itemList : 0;
                            else
                                obj[key][$scope.gradeFields] = itemList !== -1 ? itemList : [];
                        }
                        if (obj[key] && typeof(obj[key]) == 'object') {
                            obj[key].depth = depth;
                            obj[key].collapsed = collapsed;
                            obj[key].Failure = navcon.getItemByKeyValue($scope.optionData, $scope.gradeFields, obj.EFormRatingId).Failure;

                            addDepthToTree(obj[key], key === 'children' ? ++depth : depth, collapsed, $scope)
                        }
                    }
                    return obj
                };
            },
            link: function($scope, el, attrs) {

            },
            compile: function(element, attrs) {
                attrs.templateUrl = attrs.templateUrl ? attrs.templateUrl : 'navconNodeData';
            }
        };
    }
]);
"use strict";
angular.module('app').directive('navconFchart', ['dataservice',
function (dataservice) {
    return {
        /*E: Directive defined as an element. <navcon-table></navcon-table>
        A: Directive applied as an attribute on existing element. <div navcon-table></div>
        C: Directive applied as a css class to existing element <div class="navcon-table"></div>
        M: Directive applied as comment.*/
        restrict: 'E',
        scope: {
            //@ reads the attribute value, = provides two-way binding, & works with functions
            type: '@',
            data: '=',
            id: '@',
            chart: '@'
        },
        template: '<div id="{{id}}"></div>',
        link: function (scope, el, attrs) {
            scope.$watch("data", function (newValue, oldValue) {
                if (newValue != undefined && newValue !== "") {
                    scope.id = newValue.id;

                    scope.$on('DASHBOARD-RESIZE', function (event, width, height, id) {
                        var chart = FusionCharts.items[event.currentScope.chart.id];
                        if (id !== undefined && chart !== undefined && chart.options.dataSource.id === id) {
                            chart.resizeTo(width, height);
                            $($.find("tspan:contains('XT Trial')")).remove();
                        }

                    });

                    loadFusion(scope.data, scope.id, scope.data.type, scope, el);
                }
                $($.find("tspan:contains('XT Trial')")).remove();
            });
        }
    };
}]);

function loadFusion(datasource, id, type, scope, el) {
    FusionCharts.ready(function () {
        //var width = $(el).parent().parent().parent().parent().parent().parent().parent(".gridster-item").width();
        //var height = $(el).parent().parent().parent().parent().parent().parent().parent(".gridster-item").height();
        var width = $(el).parents(".gridster-item").width();
        var height = $(el).parents(".gridster-item").height();
        scope.chart = new FusionCharts({
            type: type,
            renderAt: id,
            width: width,
            height: (height - 60),
            dataFormat: 'json',
            dataSource: datasource
        }).render(function (evt) {
            $($.find("tspan:contains('XT Trial')")).remove();
        });

        //FusionCharts.addEventListener('DrawComplete', function (evt, at) {
        //    $($.find("tspan:contains('XT Trial')")).remove();
        //});

        //FusionCharts.addEventListener('renderComplete', function (evt, at) {
        //    $($.find("tspan:contains('XT Trial')")).remove();
        //    var width = $(evt.sender.ref).parents(".gridster-item").width();
        //    var height = $(evt.sender.ref).parents(".gridster-item").height();
        //    evt.sender.resizeTo(width, (height - 60));

        //    //$(evt.sender.ref).parents(".gridster-item").width(at.width);
        //    //$(evt.sender.ref).parents(".gridster-item").height(at.height);
        //    //evt.sender.resizeTo(at.width, (at.height - 40));
        //});
    });
};
"use strict";

angular.module('app').directive('navconField', ['$timeout', 'dataservice', '$compile', '$http', '$rootScope', 'ngAuthSettings',
function ($timeout, dataservice, $compile, $http, $rootScope, ngAuthSettings) {
    return {
        /*E: Directive defined as an element. <navcon-input></navcon-input>
        A: Directive applied as an attribute on existing element. <div navcon-input></div>
        C: Directive applied as a css class to existing element <div class="navcon-input"></div>
        M: Directive applied as comment.*/
        restrict: 'E',
        replace: 'true',
        scope: {
            //@ reads the attribute value, = provides two-way binding, & works with functions
            //items:'=fieldData',
            fieldKey: '@',
            //navconData: '=',
            //fieldType:'@',
            //fieldIndex:'@',
            showMessage: '@',
            onClick: '@',
            onBlur: '@',
            onChange: '@',
            invalid: '@',
            onKeyPress: '@',
            fields: '=',
            //form: '@',
            labelClass: '@',
            fieldClass: '@',
            fieldData: '='
        },
        require: ['^?navconForm', '^?form'],
        link: function (scope, el, attrs, ctrl) {

            if (ctrl[0] !== null) {
                if (scope.fieldData !== undefined)
                    scope.items = scope.fieldData;
                else
                    scope.items = ctrl[0].getFieldItems();
                scope.form = ctrl[1];

                scope.navconData = ctrl[0].getNavconData();
                scope.validate = ctrl[0].getValidate();
                scope.readOnly = ctrl[0].getFormReadOnly();

            }
            if (scope.items === undefined) {
                if (scope.fieldData !== undefined)
                    scope.items = scope.fieldData;
                else
                    return;
            }

            if (scope.validate === undefined)
                scope.validate = true;

            if (scope.readOnly === undefined)
                scope.readOnly = false;

            if (ngAuthSettings.enableFieldLevelValidation !== undefined && !ngAuthSettings.enableFieldLevelValidation)
                scope.enableFieldLevelValidation = false;
            else
                scope.enableFieldLevelValidation = true;


            scope.fieldIndex = navcon.getItemIndexByProperty(scope.items, scope.fieldKey);
            scope.fieldType = scope.items[scope.fieldIndex].type;

            var templateData = $($rootScope.fieldTemplate).find("script[id ='" + scope.fieldType + "']").text();
            el.html(templateData);
            $compile(el.contents())(scope);
            el.find('[data-toggle="tooltip"]').tooltip();
            scope.redirectURL = function (URL) {
                if (URL.indexOf('http') == -1) {
                    URL = "http://" + URL;
                }
                window.open(encodeURI(URL), '_blank');
            }
            scope.onClick = function (key, e) {
                showMessaggeStatus(scope, $timeout);

                /*if (scope.fieldType === "select") {
                    if (key !== undefined && scope.navconData !== undefined && scope.navconData.dropdownchange !== undefined)
                        scope.navconData.dropdownchange(key, scope, scope.item.data);

                    if (scope.item.selectOptions.item.addNew !== undefined && scope.item.selectOptions.item.addNew === "yes") {

                        //remove last user input
                        scope.item.selectOptions.items = scope.item.selectOptions.items.filter(function (item) {
                            if (item["undefined"] !== undefined && item["undefined"] === "")
                                return false;
                            else if(item[(scope.item.selectOptions.item.dataField || "id")] === -1)
                                return false;
                            else
                                return true;
                        });
                    }

                } else*/ if (scope.fieldType === "autocomplete") {

                } else if (scope.fieldType === "datetime") {
                    $(e.target).parent().data('DateTimePicker').show();
                }
            };


            scope.dropdownClick = function (key, e) {
                showMessaggeStatus(scope, $timeout);
                if (scope.fieldType === "select") {
                    if (key !== undefined && scope.navconData !== undefined && scope.navconData.dropdownchange !== undefined)
                        scope.navconData.dropdownchange(key, scope, scope.item.data);

                    if (scope.item.selectOptions.item.addNew !== undefined && scope.item.selectOptions.item.addNew === "yes") {

                        //remove last user input
                        scope.item.selectOptions.items = scope.item.selectOptions.items.filter(function (itm) {
                            if (itm["undefined"] !== undefined && itm["undefined"] === "" && scope.item.data !== undefined && scope.item.data[(scope.item.selectOptions.item.dataField || "id")] !== itm[(scope.item.selectOptions.item.dataField || "id")])
                                return false;
                            else if (itm[(scope.item.selectOptions.item.dataField || "id")] === -1)
                                return false;
                            else
                                return true;
                        });
                    }

                }
            }

            scope.colorpickerBeforeShow = function () {

                colorpickerEventChange();
            }

            scope.colorpickerMove = function () {

            }

            scope.colorpickerShow = function () {
                $('a[class="sp-cancel"]').replaceWith('<button type="button" onclick="navcon.colorpickerHide();">Cancel</button>');

                $('.sp-palette-toggle').on("click", function () {
                    colorpickerEventChange();
                })
                colorpickerEventChange();
            }

            scope.onChange = function (key, e) {
                scope.item.selectOptions.item["isSelect"] = true;
            };

            var replaceSpecialCharacter = function (item) {
                if (item !== undefined && typeof item === "string" && item !== "") {
                    scope.item.data = item.replace(/\u2013|\u2014/g, "-");
                }
            }

            scope.labelDataClick = function (item) {
                if (!item.templateOptions.href) return;
                if (scope.navconData !== undefined && scope.navconData.labelDataClick !== undefined && $.isFunction(scope.navconData.labelDataClick))
                    scope.navconData.labelDataClick(item);

            }

            scope.onPaste = function (event) {
                $timeout(function () {
                    var item = angular.element(event.currentTarget).val();
                    replaceSpecialCharacter(item);
                }, 100)
            }

            scope.tabClick = function (scope, selectItem) {
                showMessaggeStatus(scope, $timeout);
                scope.data = selectItem[scope.selectOptions.item.dataField];
            };

            scope.onBlur = function (evt) {
                if ((evt !== undefined && evt.relatedTarget !== null && evt.relatedTarget !== undefined && $(evt.relatedTarget).prop("tagName").toLowerCase() === "button") && ($(evt.relatedTarget).text().toLowerCase() === "cancel" || $(evt.relatedTarget).text().toLowerCase() === "save" || $(evt.relatedTarget).text().toLowerCase() === "ok")) {
                    evt.preventDefault();
                    if ($(evt.relatedTarget).text().toLowerCase() === "save")
                        scope.item.setFocus = false;
                    return false;
                } else {
                    showMessaggeStatus(scope, $timeout);
                }
                if (scope.item.setFocusBlur === undefined || scope.item.setFocusBlur === false)
                    scope.item.setFocus = false;
            };

            scope.checkboxlistFilter = function (item) {
                if (scope.item.group !== undefined && scope.item.group.length > 0) {
                    for (var i = 0, len = scope.item.group.length; i < len; i++) {
                        var data = scope.item.group[i];
                        if (parseInt(item.EventSection) === parseInt(data)) {
                            if (scope.readOnly && item.ParentID !== 0) {
                                if (item.value !== undefined && item.value)
                                    return true;
                                else
                                    return false;
                            } else {
                                return true;
                            }
                        }
                    }
                    return false;

                } else {
                    if (scope.readOnly) {
                        if (item.value !== undefined && item.value)
                            return true;
                        else
                            return false;
                    } else {
                        return true;
                    }
                }
            };

            scope.radioClick = function (event, selectedItem) {
                if (scope.navconData !== undefined && scope.navconData.radioClick !== undefined) {
                    scope.navconData.radioClick(event, selectedItem);
                }
            };

            scope.dropdownSelect = function (item, model) {
                if (scope.item.selectOptions.item.addNew !== undefined && scope.item.selectOptions.item.addNew === "yes") {

                    //remove last user input
                    scope.item.selectOptions.items = scope.item.selectOptions.items.filter(function (itm) {
                        if (itm["undefined"] !== undefined && itm["undefined"] === "" && item[(scope.item.selectOptions.item.dataField || "id")] !== itm[(scope.item.selectOptions.item.dataField || "id")])
                            return false;
                        else
                            return true;
                    });

                    var found = navcon.getItemByKeyValue(scope.item.selectOptions.items, (scope.item.selectOptions.item.dataField || "id"), item[scope.item.selectOptions.item.dataField || id]);
                    if (found !== -1) return;
                    item[scope.item.selectOptions.item.dataField || id] = item[scope.item.selectOptions.item.displayField];

                    if (scope.navconData !== undefined && scope.navconData.addValueToSelect !== undefined) {
                        scope.navconData.addValueToSelect(item, scope.fieldKey, function (retItem) {
                            scope.$apply(function () {
                                scope.item.selectOptions.items = [retItem].concat(scope.item.selectOptions.items);
                            });
                        })
                    }
                }

            };

            scope.selectRefreshResults = function ($select, itemList) {
                if ($select.search === undefined || $select.search === "" || $select.search === null) return;
                if ($select.items.length !== 0) return;
                if (scope.item.selectOptions.item.addNew === undefined || scope.item.selectOptions.item.addNew !== "yes") return;
                var search = $select.search,
                  list = angular.copy($select.items),
                  FLAG = -1;

                //remove last user input
                list = list.filter(function (item) {
                    return item[(scope.item.selectOptions.item.dataField || "id")] !== FLAG;
                });

                if (!search) {
                    //use the predefined list
                    $select.items = list;
                }
                else {
                    //manually add user input and set selection
                    var userInputItem = {};
                    userInputItem[(scope.item.selectOptions.item.dataField || "id")] = FLAG;
                    userInputItem[(scope.item.selectOptions.item.displayField || "id")] = search;

                    if ($select.isGrouped) {
                        userInputItem[scope.item.selectOptions.item.groupBy] = "";
                    }

                    $select.items = [userInputItem].concat(list);
                    //$select.selected = userInputItem;

                    scope.$apply(function () {
                        scope.item.selectOptions.items = [userInputItem].concat(scope.item.selectOptions.items);
                    });

                }
            };

            scope.$watch("items[" + scope.fieldIndex + "]", function (newValue, oldValue) {
                if (newValue !== undefined) {
                    scope.item = newValue;
                    scope.item.form = scope.form;
                    scope.item.showMessage = false;
                    scope.item.setFocus = false;
                    fieldSettings(scope, el, attrs, $compile);
                    scope.$watch('form.' + scope.item.key + '.$valid', function (newValue, oldValue) {
                        if (newValue !== undefined && newValue !== oldValue) {
                            scope.item.setFocus = false;
                            if (newValue === false && scope.validate && scope.enableFieldLevelValidation) {
                                scope.invalid = true;
                                scope.item.valid = false;
                                showMessaggeStatus(scope, $timeout);
                            } else {
                                scope.invalid = false;
                                scope.item.valid = true;
                            }
                        }
                    });
                }
            });

            scope.$on('FORM-READONLY', function (event, data) {
                scope.readOnly = data;
            });

            scope.$watch("items[" + scope.fieldIndex + "].readonly", function (newValue, oldValue) {
                if (newValue !== undefined) {
                    scope.readOnly = newValue;
                }
            });


            scope.$watch("items[" + scope.fieldIndex + "].data", function (newValue, oldValue) {
                //  if (newValue !== undefined && newValue !== oldValue) {
                if (newValue !== undefined) {
                    scope.item.showMessage = false;
                    if (scope.readOnly) {
                        scope.item.readOnlyText = scope.displayReadOnlyField(scope.item);
                    }
                }
            }, this);

            scope.$on('FIELD-VALID', function (event, value, keyIndex) {
                if (scope.items.length >= keyIndex && scope.items[keyIndex] !== undefined) {
                    if (value === true) {
                        scope.items[keyIndex].valid = true;

                    } else {
                        scope.items[keyIndex].valid = false;

                    }
                }
            });


            scope.tabMouseOver = function (el, scope, item) {
                $(el.srcElement).css('cursor', scope.templateOptions.cursor);
            };

            scope.colorpickerOptions = getColorpickerOptions();

            scope.displayReadOnlyField = function (item) {
                var returnValue = item.data != null ? item.data : "";
                if (item.type === "select") {
                    returnValue = item.data[item.selectOptions.item.displayField];
                } else if (item.type === "multiselect" || item.type === "multiselectcheckbox") {
                    var list = [];
                    for (var i = 0, len = item.data.length; i < len; i++) {
                        var obj = item.data[i];
                        if (item.selectOptions.item.secondDisplayField !== undefined && item.selectOptions.item.secondDisplayField !== null && item.selectOptions.item.secondDisplayField !== "")
                            list.push(obj[item.selectOptions.item.displayField] + " / " + obj[item.selectOptions.item.secondDisplayField])
                        else
                            list.push(obj[item.selectOptions.item.displayField])
                    }
                    returnValue = list.join("; ");
                } else if (item.type === "checkbox") {
                    if (item.data || item.data === 1 || item.data === "true")
                        returnValue = item.templateOptions.suffixLabel;
                    else {
                        if (item.templateOptions.suffixLabelfalse !== undefined)
                            returnValue = item.templateOptions.suffixLabelfalse;
                        else
                            returnValue = "No";
                    }
                } else if (item.type === "radio") {
                    var items = item.templateOptions.items;
                    var findObj = navcon.getItemByKeyValue(items, "value", item.data);
                    if (findObj !== -1) {
                        if (item.templateOptions.suffixLabelfalse !== undefined)
                            returnValue = findObj.suffixLabel;
                        else
                            returnValue = findObj.label;
                    } else {
                        if (item.templateOptions.suffixLabelfalse !== undefined)
                            returnValue = items[0].suffixLabel;
                        else
                            returnValue = item.data;
                    }
                }
                else {
                    returnValue = item.data;
                }
                return returnValue != undefined ? (returnValue != null ? returnValue : "") : "";
            };

            function colorpickerEventChange() {
                if ($('.sp-palette-toggle').html() !== undefined && $('.sp-palette-toggle').html().toLowerCase() !== "") {

                    if (!$('.sp-picker-container').is(":visible"))
                        $('.sp-palette-toggle').html("More")

                    if ($('.sp-picker-container').is(":visible"))
                        $('.sp-palette-toggle').html("Less")
                }

                if ($('.sp-choose').html() !== undefined && $('.sp-choose').html().toLowerCase() !== "")
                    $('.sp-choose').html("Choose")
            }

            function fieldSettings(scope, el, attrs, $compile) {

                if (scope.item.type === "input") {
                    inputSetting(scope, el, attrs);
                } else if (scope.item.type === "date") {
                    dateSetting(scope, el, attrs);
                } else if (scope.item.type === "colorpicker") {
                    //colorpickerSetting(scope, el, attrs);
                } else if (scope.item.type === "datetime") {
                    dateTimeSetting(scope, el, attrs);
                } else if (scope.item.type === "tableeditor") {
                    tableeditorSetting(scope, el, attrs);
                } else if (scope.item.type === "select") {
                    selectSetting(scope, el, attrs);
                } else if (scope.item.type === "multiselect" || scope.item.type === "multiselectcheckbox") {
                    multiSelectSetting(scope, el, attrs);
                } else if (scope.item.type === "tab") {
                    tabSetting(scope, el, attrs);
                }
                else if (scope.item.type === "switch") {
                    switchSetting(scope, el, attrs);
                } else if (scope.item.type === "autocomplete") {
                    autoCompleteSetting(scope, el, attrs);
                } else if (scope.item.type === "rating") {
                    ratingSetting(scope, el, attrs);
                } else if (scope.item.type === "labeldata") {
                    if (scope.item.templateOptions.href === undefined) {
                        scope.item.templateOptions.href = false;
                    }
                    if (scope.item.templateOptions.href) {
                        var obj = $(el).find('.field-group label');
                        obj.css("color", "blue");
                        obj.css("cursor", "pointer");
                    }
                } else if (scope.item.type === "fileupload" || scope.item.type === "photoupload") {
                    var keyIndex = navcon.getItemIndexByProperty(scope.items, scope.item.templateOptions.key);
                    scope.$watch("items[" + keyIndex + "].data", function (newValue, oldValue) {
                        if (newValue !== undefined && newValue !== oldValue) {
                            scope.keyData = newValue;
                        }
                    });

                    var keyShowOnlyIndex = navcon.getItemIndexByProperty(scope.items, scope.item.key);
                    scope.$watch("items[" + keyShowOnlyIndex + "].templateOptions.showOnly", function (newValue, oldValue) {
                        if (newValue !== undefined && newValue !== oldValue) {
                            //console.log(newValue);
                        }
                    });

                    var keyNameIndex = navcon.getItemIndexByProperty(scope.items, scope.item.templateOptions.keyName);
                    scope.$watch("items[" + keyNameIndex + "].data", function (newValue, oldValue) {
                        if (newValue !== undefined && newValue !== oldValue) {
                            scope.keyName = newValue;
                        }
                    });

                    if (scope.item.templateOptions.fileType === undefined || scope.item.templateOptions.fileType === "")
                        scope.item.templateOptions.fileType = [];

                    if (scope.item.templateOptions.fileSize === undefined || scope.item.templateOptions.fileSize === "")
                        scope.item.templateOptions.fileSize = "0";

                    if (scope.item.templateOptions.sameFile === undefined || scope.item.templateOptions.sameFile === "")
                        scope.item.templateOptions.sameFile = true;

                    if (scope.item.templateOptions.showOnly === undefined || scope.item.templateOptions.showOnly === "")
                        scope.item.templateOptions.showOnly = false;

                    if (scope.item.templateOptions.label === undefined || scope.item.templateOptions.label === "")
                        scope.item.templateOptions.label = "Attachments";



                }

                if (scope.item.type === "input" || scope.item.type === "textarea") {
                    if (scope.item.templateOptions !== undefined) {
                        if (scope.item.templateOptions.spellcheck === undefined) {
                            scope.item.templateOptions.spellcheck = true;
                        }
                    }
                }

                if ($(el).is('[class*="col-sm"]'))
                    $('<div class="clearfix visible-xs-block visible-sm-block"></div>').insertAfter($(el));

                if (scope.item.templateOptions.label === "") {
                    var fistObj = $($(el).find("div[ng-show*='" + scope.item.type + "']")[0]).find('label').first();
                    fistObj.css("display", "none")
                    fistObj.next().css("width", "79%");
                }
            };

            function showMessaggeStatus(scope, $timeout) {
                if (scope.invalid === true && (scope.item.showMessage === undefined || scope.item.showMessage === false)) {
                    scope.item.showMessage = true;
                    $timeout(function () {
                        message(scope);
                    }, 6000);
                };

                function message(scope) {
                    scope.item.showMessage = false;
                };
            };


            function tabSetting(scope, el, attr) {
                $(el).find('a').css('cursor', scope.item.templateOptions.cursor);
            }

            function inputSetting(scope, el, attr) {
                if (scope.item.templateOptions.hideLabel === undefined || scope.item.templateOptions.hideLabel === false)
                    scope.item.templateOptions.hideLabel = false;
                else
                    scope.item.templateOptions.hideLabel = true;

                if (scope.item.templateOptions.customClass !== undefined)
                    scope.item.templateOptions.customClass = "";

            };

            function getColorpickerOptions() {
                //$("#picker").on('move.spectrum', function(e, tinycolor) { });
                return {
                    showPaletteOnly: true,
                    togglePaletteOnly: true,
                    togglePaletteMoreText: 'more',
                    togglePaletteLessText: 'less',
                    showInput: true,
                    palette: [
                        ["#000", "#444", "#666", "#999", "#ccc", "#eee", "#f3f3f3", "#fff"],
                        ["#f00", "#f90", "#ff0", "#0f0", "#0ff", "#00f", "#90f", "#f0f"],
                        ["#f4cccc", "#fce5cd", "#fff2cc", "#d9ead3", "#d0e0e3", "#cfe2f3", "#d9d2e9", "#ead1dc"],
                        ["#ea9999", "#f9cb9c", "#ffe599", "#b6d7a8", "#a2c4c9", "#9fc5e8", "#b4a7d6", "#d5a6bd"],
                        ["#e06666", "#f6b26b", "#ffd966", "#93c47d", "#76a5af", "#6fa8dc", "#8e7cc3", "#c27ba0"],
                        ["#c00", "#e69138", "#f1c232", "#6aa84f", "#45818e", "#3d85c6", "#674ea7", "#a64d79"],
                        ["#900", "#b45f06", "#bf9000", "#38761d", "#134f5c", "#0b5394", "#351c75", "#741b47"],
                        ["#600", "#783f04", "#7f6000", "#274e13", "#0c343d", "#073763", "#20124d", "#4c1130"]
                    ]
                }
            }

            function dateSetting123(scope, el, attr) {
                var options = {};
                options.rtl = Metronic.isRTL();
                options.orientation = "left";
                options.autoclose = true;
                options.todayHighlight = true;

                if (scope.item.templateOptions.mode !== undefined && scope.item.templateOptions.mode.toLowerCase() === "year") {
                    options.format = "yyyy";
                    options.viewMode = "years";
                    options.minViewMode = "years";
                }

                $(el).find('.date-picker').datepicker(options);


            };
            function dateSetting(scope, el, attr) {
                var options = {};
                options.rtl = Metronic.isRTL();
                options.orientation = "left";
                options.autoclose = true;
                options.todayHighlight = true;


                if (scope.item.templateOptions.mode !== undefined && scope.item.templateOptions.mode.toLowerCase() === "year") {
                    options.format = "yyyy";
                    options.viewMode = "years";
                    options.minViewMode = "years";
                }

                if (scope.item.templateOptions.futureDate !== undefined && scope.item.templateOptions.futureDate !== "")
                    options.endDate = scope.item.templateOptions.futureDate; //'+0d'

                $(el).find('.date-picker').datepicker(options);

                $(el).find('.date-picker').datepicker().on('changeDate', function (e) {
                    // `e` here contains the extra attributes
                    if (scope.items[scope.fieldIndex].templateOptions.dateformat === undefined ||
                        scope.items[scope.fieldIndex].templateOptions.dateformat === null ||
                        scope.items[scope.fieldIndex].templateOptions.dateformat === "")
                        scope.items[scope.fieldIndex].data = moment(e.date).format("DD/MM/YYYY");
                    else
                        scope.items[scope.fieldIndex].data = moment(e.date).format(scope.items[scope.fieldIndex].templateOptions.dateformat.toUpperCase());
                });

                scope.$watch("item.displayData", function (newValue, oldValue) {
                    if (newValue !== undefined) {
                        $(el).find('.date-picker').datepicker('update', newValue)
                    }
                });


            };


            function dateTimeSetting(scope, el, attr) {
                var options = { "sideBySide": true };
                if (scope.item.templateOptions !== undefined) {
                    if (scope.item.templateOptions.timeonly !== undefined && scope.item.templateOptions.timeonly) {
                        options["format"] = 'LT';
                        if (scope.item.templateOptions.hours24 !== undefined && scope.item.templateOptions.hours24)
                            options["format"] = "HH:mm";
                    } else {
                        options["format"] = 'LT';
                        if (scope.item.templateOptions.hours24 !== undefined && scope.item.templateOptions.hours24)
                            options["format"] = "DD/MM/YYYY HH:mm";
                        else
                            options["format"] = "DD/MM/YYYY hh:mm A";
                    }
                    if (scope.item.templateOptions.futureDate !== undefined && !scope.item.templateOptions.futureDate)
                        options.maxDate = new Date();

                }

                $(el).find('.input-group').datetimepicker(options);

                $(el).find('.input-group').on("dp.change", function (e) {
                    if (scope.item.templateOptions.timeonly !== undefined && scope.item.templateOptions.timeonly) {
                        options["format"] = 'LT';
                        if (scope.item.templateOptions.hours24 !== undefined && scope.item.templateOptions.hours24)
                            scope.items[scope.fieldIndex].data = e.date.locale('en').format("HH:mm");
                        else
                            scope.items[scope.fieldIndex].data = e.date.locale('en').format("hh:mm A");
                    } else {
                        if (scope.item.templateOptions.hours24 !== undefined && scope.item.templateOptions.hours24)
                            scope.items[scope.fieldIndex].data = e.date.locale('en').format("DD/MM/YYYY HH:mm");
                        else
                            scope.items[scope.fieldIndex].data = e.date.locale('en').format("DD/MM/YYYY hh:mm A");
                    }
                });
            };


            function autoCompleteSetting(scope, el, attr) {
                var source = new Bloodhound({
                    datumTokenizer: function (d) {
                        return Bloodhound.tokenizers.whitespace(d[scope.item.selectOptions.item.displayField]);
                    },
                    queryTokenizer: Bloodhound.tokenizers.whitespace,
                    local: scope.item.selectOptions.items
                });

                source.initialize();

                var defaults = function (q, sync) {
                    if (q === '') {
                        sync(source.index.all());
                    } else {
                        source.search(q, sync);
                    }
                }

                $(el).find('.typeahead').typeahead({
                    minLength: 0
                }, {
                    source: defaults,
                    display: scope.item.selectOptions.item.displayField,
                });

                $($(el).find('.typeahead')).data(scope.item);

                $(el).find('.typeahead').on('typeahead:selected', function (e, datum, name, t) {
                    $(e.target).data().data = datum;
                    scope.item.data = datum.text !== undefined ? datum.text : datum[scope.item.selectOptions.item.displayField];
                });

                scope.$watch("item.selectOptions.items", function (newValue, oldValue) {
                    if (newValue !== undefined && newValue.length !== 0) {
                        source = new Bloodhound({
                            datumTokenizer: function (d) {
                                return Bloodhound.tokenizers.whitespace(d[scope.item.selectOptions.item.displayField]);
                            },
                            queryTokenizer: Bloodhound.tokenizers.whitespace,
                            local: newValue
                        });

                        source.initialize();
                    }
                });
            };

            function selectSetting(scope, el, attr) {

                if (scope.item.selectOptions.isCustomFormat === undefined) {
                    scope.item.selectOptions.isCustomFormat = false;
                    //scope.item.selectOptions.customFormat = "reasonClosureCustomFormat";
                }

                scope.getFormat = function (selectedItem) {
                    var retVal = "";
                    if (selectedItem !== undefined && selectedItem !== "") {
                        if (scope.item.selectOptions.customFormat !== undefined && scope.item.selectOptions.customFormat !== "" && scope.item.selectOptions.isCustomFormat) {
                            if (scope.navconData[scope.item.selectOptions.customFormat] !== undefined)
                                retVal = scope.navconData[scope.item.selectOptions.customFormat](selectedItem);
                            else if (scope.navconData.$parent[scope.item.selectOptions.customFormat] !== undefined)
                                retVal = scope.navconData.$parent[scope.item.selectOptions.customFormat](selectedItem);
                            else
                                retVal = selectedItem[scope.item.selectOptions.item.displayField];
                        }
                        else {

                            if (selectedItem[scope.item.selectOptions.item.displayField] !== undefined)
                                retVal = selectedItem[scope.item.selectOptions.item.displayField];
                        }
                    }
                    return retVal;
                };

                var keyIndex = navcon.getItemIndexByProperty(scope.items, scope.item.key);
                scope.$watch("items[" + keyIndex + "].disabled", function (newValue, oldValue) {
                    if (newValue !== undefined) {
                        if (scope.item.disabled) {
                            $('.ui-select-container .selectize-input').css("background", "aliceblue");
                            $('.ui-select-container .selectize-input').css("color", "royalblue");
                        }
                    }
                });

            };

            function multiSelectSetting(scope, el, attr) {


                var keyIndex = navcon.getItemIndexByProperty(scope.items, scope.item.key);
                if (scope.items[keyIndex].type === "multiselectcheckbox")
                    if (scope.items[keyIndex].data === undefined || scope.items[keyIndex].data === "") scope.items[keyIndex].data = [];

                scope.$watch("items[" + keyIndex + "].disabled", function (newValue, oldValue) {
                    if (newValue !== undefined) {
                        if (scope.item.disabled) {
                            $('.select2-choices').css("background", "aliceblue");
                            $('.ui-select-match-item').css("background", "aliceblue");
                            $('.select2-choices').css("color", "royalblue");
                            $('.ui-select-match-item').css("color", "royalblue");
                        }
                    }
                });

                scope.multiSelectGroupColor = function (item, selectedItem, parentItem) {
                    var retVal = "#000";
                    if (scope.item.group == undefined || scope.item.group.key == undefined) {
                        return;
                    }

                    var keyIndex = navcon.getItemIndexByProperty(scope.items, scope.item.group.key);
                    var parentData = scope.items[keyIndex].data;

                    if (scope.item.group.field !== undefined && scope.item.group.field !== null) {
                        var value = $.grep(selectedItem[scope.item.group.object], function (e) {
                            return e[scope.item.group.field] === parentData[scope.item.group.field] && parentData !== undefined;
                        });

                        if (value !== undefined && value !== null && value.length !== 0 && value !== -1)
                            retVal = (scope.item.group.color || "#FF4500");
                    }

                    return retVal;
                };

                scope.multiSelectGroupBold = function (item, selectedItem, parentItem) {
                    var retVal = "normal";
                    if (scope.item.group == undefined || scope.item.group.key == undefined) {
                        return;
                    }

                    var keyIndex = navcon.getItemIndexByProperty(scope.items, scope.item.group.key);
                    var parentData = scope.items[keyIndex].data;

                    if (scope.item.group.field !== undefined && scope.item.group.field !== null) {
                        var value = $.grep(selectedItem[scope.item.group.object], function (e) {
                            return e[scope.item.group.field] === parentData[scope.item.group.field] && parentData !== undefined;
                        });

                        if (value !== undefined && value !== null && value.length !== 0 && value !== -1)
                            retVal = "600";
                    }

                    return retVal;
                };
            };

            function switchSetting(scope, el, attr) {
                var keyIndex = navcon.getItemIndexByProperty(scope.items, scope.item.key);
                scope.$watch("items[" + keyIndex + "].disabled", function (newValue, oldValue) {
                    if (newValue !== undefined) {
                        if (scope.item.disabled) {
                            $(el).find(".bootstrap-switch-container").css("pointer-events", "none");
                            $(el).find(".bootstrap-switch-wrapper").css("cursor", "not-allowed");
                        }
                        else {
                            $(el).find(".bootstrap-switch-container").css("pointer-events", "");
                            $(el).find(".bootstrap-switch-wrapper").css("pointer-events", "default");
                        }
                    }
                });
            };

            function tableeditorSetting(scope, el, attr) {
                if (scope.item.templateOptions.settings !== undefined && scope.item.templateOptions.settings !== "") {
                    scope.item.tableeditorSettings = scope.navconData[scope.item.templateOptions.settings];
                }

                if (scope.item.templateOptions.showAdd === undefined) {
                    scope.item.templateOptions.showAdd = true;
                }

                if (scope.item.templateOptions.showDel === undefined) {
                    scope.item.templateOptions.showDel = true;
                }

                if (scope.item.templateOptions.showUpdate === undefined) {
                    scope.item.templateOptions.showUpdate = false;
                }

                if (scope.item.templateOptions.showoverAllsave === undefined) {
                    scope.item.templateOptions.showoverAllsave = false;
                }
                if (scope.item.templateOptions.showItar === undefined) {
                    scope.item.templateOptions.showItar = false;
                }
                if (scope.item.templateOptions.SaveButtonText === undefined)
                    scope.item.templateOptions.SaveButtonText = "";
            }

            function parentItems(item) {
                for (var key in item) {
                    if (item["$parent"].items != undefined)
                        return item["$parent"].items;
                    else
                        return parentItems(item["$parent"]);
                }
            };

            function ratingSetting(scope, el, attr) {
                /*scope.item.data = 3;
                if(scope.item.ratingOptions !== undefined && scope.item.ratingOptions.max !== undefined)
                    scope.max = scope.item.ratingOptions.max;
                else
                    scope.max = 5;
              
                if(scope.item.ratingOptions !== undefined && scope.item.ratingOptions.isReadonly !== undefined)
                    scope.isReadonly = scope.item.ratingOptions.isReadonly;
                else
                    scope.isReadonly = false;
              
                if(scope.item.ratingOptions !== undefined && scope.item.ratingOptions.titles !== undefined)
                    scope.titles = scope.item.ratingOptions.titles;
                else
                    scope.titles = ['one','two','three', 'four', 'five'];*/

                scope.hoveringOver = function (value) {
                    scope.overStar = value;
                    scope.percent = 100 * (value / scope.max);
                };

                scope.ratingStates = [
                      { stateOn: 'glyphicon-ok-sign', stateOff: 'glyphicon-ok-circle' },
                      { stateOn: 'glyphicon-star', stateOff: 'glyphicon-star-empty' },
                      { stateOn: 'glyphicon-heart', stateOff: 'glyphicon-ban-circle' },
                      { stateOn: 'glyphicon-heart' },
                      { stateOff: 'glyphicon-off' }
                ];
            }
        }
    };
}]).directive('navconButton', ['$timeout', 'dataservice',
function ($timeout, dataservice) {
    return {
        /*E: Directive defined as an element. <navcon-input></navcon-input>
        A: Directive applied as an attribute on existing element. <div navcon-input></div>
        C: Directive applied as a css class to existing element <div class="navcon-input"></div>
        M: Directive applied as comment.*/
        restrict: 'E',
        scope: {
            //@ reads the attribute value, = provides two-way binding, & works with functions
            customClass: '@',
            navconData: '=',
            text: '@',
            icon: '@',
            target: '@',
            fieldDisabled: '=',
            tooltipText: '@'
        },
        template: '<a class="{{customClass}}"  data-target="#{{target}}" data-toggle="modal"><div data-toggle="tooltip" data-original-title="{{tooltipText}}">{{text}}&nbsp;<span class="{{icon}}"></span></div></a>',
        link: function (scope, el, attrs) {
            //console.log(scope);
            if (scope.tooltipText == undefined || scope.tooltipText === null) scope.tooltipText = "";

            scope.$watch("fieldDisabled", function (newValue, oldValue) {
                if (newValue !== undefined) {
                    if (newValue === null)
                        $(el).find("a").attr("disabled", "disbaled");
                    else
                        $(el).find("a").removeAttr("disabled");
                }
            });

            $('a > div[data-toggle="tooltip"]').tooltip();
        }
    };
}]).directive('navconButtonCollapse', ['$timeout', 'dataservice',
function ($timeout, dataservice) {
    return {
        /*E: Directive defined as an element. <navcon-input></navcon-input>
        A: Directive applied as an attribute on existing element. <div navcon-input></div>
        C: Directive applied as a css class to existing element <div class="navcon-input"></div>
        M: Directive applied as comment.*/
        restrict: 'E',
        scope: {
            //@ reads the attribute value, = provides two-way binding, & works with functions
            customClass: '@',
            navconData: '=',
            text: '@',
            icon: '@',
            target: '@',
            fieldDisabled: '='
        },
        template: '<button class="{{customClass}}" data-toggle="collapse" data-target="#{{target}}">{{text}}&nbsp;<i class="{{icon}}" aria-hidden="true"></i></button>',
        link: function (scope, el, attrs) {
            //console.log(scope);

            scope.$watch("fieldDisabled", function (newValue, oldValue) {
                if (newValue !== undefined) {
                    if (newValue === null)
                        $(el).find("a").attr("disabled", "disbaled");
                    else
                        $(el).find("a").removeAttr("disabled");
                }
            });
        }
    };
}]).directive('ngEnter', function () {
    return function (scope, element, attrs) {
        element.bind("keydown keypress", function (event) {
            if (event.which === 13) {
                scope.$apply(function () {
                    scope.$eval(attrs.ngEnter);
                });

                event.preventDefault();
            }
        });
    };
}).directive('requireMultiple', function () {
    return {
        require: 'ngModel',
        link: function postLink(scope, element, attrs, ngModel) {
            ngModel.$validators.required = function (value) {
                return angular.isArray(value) && value.length > 0;
            };
        }
    };
}
).directive('windowExit', ['authService', '$window', '$location', '$rootScope', function (authService, $window, $location, $rootScope) {
    return {
        restrict: 'AE',
        link: function (element, attrs) {
            var myEvent = $window.attachEvent || $window.addEventListener,
            chkevent = $window.attachEvent ? 'onbeforeunload' : 'beforeunload'; /// make IE7, IE8 compatable

            myEvent('unload', function (e) {
                
            });

            myEvent(chkevent, function (e) { // For >=IE7, Chrome, Firefox
                
                if ($location.$$url === "/login" || ($rootScope.isFeedback !== undefined && $rootScope.isFeedback)) {
                    $rootScope.isFeedback = false;
                    return false;
                }
                if (window.appReload !== undefined && window.appReload) {
                    window.appReload = false;
                    return false;
                }
                var confirmationMessage = '';  // a space
                (e || $window.event).returnValue = "Are you sure that you'd like to close the browser?";
                return confirmationMessage;
            });




        }
    };
}]).directive('focusMe', function ($timeout, $parse) {
    return {
        link: function (scope, element, attrs) {
            var model = $parse(attrs.focusMe);
            scope.$watch(model, function (value) {
                var itemFocus = scope.items[scope.fieldIndex].templateOptions.focus;
                if (itemFocus !== undefined && value === true) {
                    // element[0].focus();
                }
            }, true);

            scope.$on('SET-FOCUS', function (event, value) {
                var itemFocus = scope.items[scope.fieldIndex].templateOptions.focus;
                if (itemFocus !== undefined && value === true) {
                    scope.item.setFocus = true;
                    scope.item.setFocusBlur = true;

                    if (scope.item.type !== undefined && scope.item.type.toLowerCase() === 'select')
                        $(element[0]).find('input')[0].focus();
                    else
                        element[0].focus();

                    setTimeout(function () {
                        scope.item.setFocusBlur = false;
                    }, 100)
                }
            });

            element.bind('blur', function () {
                if (scope.item.templateOptions.focus !== undefined)
                    scope.$apply(model.assign(scope, false));
            })
        }
    };
}).directive('ngEsc', function ($timeout, $parse) {
    return {
        link: function (scope, element, attrs) {
            element.bind("keydown keypress keyup", function (event) {
                if (event.which === 27) {
                    scope.$apply(function () {
                        scope.$eval(attrs.ngEsc);
                    });
                    event.preventDefault();
                }
            })
        }
    };
});
"use strict";
angular.module('app').directive('compareTo', ['$timeout', 'dataservice', '$compile', '$http', '$rootScope', '$parse',
function ($timeout, dataservice, $compile, $http, $rootScope, $parse) {
    return {
        require: ['^?navconForm', '^ngModel'],
        link: function (scope, element, attrs, ctrl) {
            var field = ctrl[1];
            var model = $parse(attrs.compareTo);

            var compareToField = scope.items[scope.fieldIndex].templateOptions.compareTo;
            if (compareToField === undefined) return;
            scope.compareToField = compareToField;
            var compareBy = scope.items[scope.fieldIndex].templateOptions.compareBy;
            if (compareBy === undefined || compareBy === "") compareBy = "=";

            var compareToFieldIndex = navcon.getItemIndexByProperty(scope.items, scope.compareToField);
            element.bind('blur', function (e) {
                var currentValue = element.val();
                var retValid = compareValidate(scope.items[compareToFieldIndex].data, currentValue, compareBy)
                field.$setValidity("compareTo", retValid);
            });

            scope.$watch("items[" + compareToFieldIndex + "].data", function (value) {
                if (scope.items[scope.fieldIndex].data === "") return;
                var from = value;
                var to = scope.items[scope.fieldIndex].data;
                var retValid = compareValidate(from, to, compareBy)
                field.$setValidity("compareTo", retValid);
            });

            function compareValidate(from, to, compareBy) {
                var validity = true;
                if (compareBy === "<") {
                    validity = (parseInt(to) < parseInt(from) ? false : true);
                } else if (compareBy === ">") {
                    validity = (parseInt(to) > parseInt(from) ? false : true);
                } else if (compareBy === ">=") {
                    validity = (parseInt(to) >= parseInt(from) ? false : true);
                } else if (compareBy === "<=") {
                    validity = (parseInt(to) <= parseInt(from) ? false : true);
                } else if (compareBy === "!=") {
                    validity = (to !== from ? false : true);
                }
                else {
                    validity = (to === from ? false : true);
                }
                return validity;
            }
        }
    };
}]).directive("compareDate", ['$timeout', 'dataservice', '$compile', '$http', '$rootScope', '$parse', function ($timeout, dataservice, $compile, $http, $rootScope, $parse) {
    return {
        require: ['^navconForm', '^ngModel'],
        link: function (scope, element, attrs, ctrl) {
            var field = ctrl[1];
            scope.items = ctrl[0].getFieldItems();

            var model = $parse(attrs.compareDate);

            scope.compareDateTo = scope.items[scope.fieldIndex].templateOptions.compareDateTo;
            scope.compareDateBy = scope.items[scope.fieldIndex].templateOptions.compareDateBy;
            scope.compareDateToday = scope.items[scope.fieldIndex].templateOptions.compareDateToday;

            if (scope.compareDateBy !== undefined && Array.isArray(scope.compareDateBy)) {
                console.log("multiple");
            } else {
                if (scope.compareDateTo === undefined && (scope.compareDateToday === undefined && !scope.compareDateToday)) return;
                if (scope.compareDateBy === undefined) return;
                var compareDateToIndex = navcon.getItemIndexByProperty(scope.items, scope.compareDateTo);
                var compareDateByIndex = navcon.getItemIndexByProperty(scope.items, scope.compareDateBy);
            }

            var getTimeDate = function (value) {
                if (value === undefined) return;
                var today = navcon.dateFormat(moment().format("DD/MM/YYYY"));
                var hrs = value.trim().substr(0, 2);
                var mins = value.trim().substr(3, 2);
                var date = moment(today).add(hrs, 'hours');
                date = moment(date).add(mins, 'minutes');
                return date
            }


            scope.$watch(model, function (value) {
                field.$validate();
                field.$validators.compareDate = function (modelValue) {
                    var fromDate = navcon.dateFormat(modelValue);
                    var toDate;
                    if (scope.compareDateBy !== undefined && Array.isArray(scope.compareDateBy)) {
                        var retValue = true;
                        for (var i = 0, len = scope.compareDateBy.length; i < len; i++) {
                            var item = scope.compareDateBy[i];
                            if (scope.item !== undefined && item.condition !== undefined && item.to !== undefined && item.message !== undefined) {
                                var toIndex = navcon.getItemIndexByProperty(scope.items, item.to);
                                scope.item.templateOptions.compareDateMessage = item.message;
                                if (item.to === "today")
                                    toDate = navcon.dateFormat(moment().format("DD/MM/YYYY"));
                                else if (scope.item !== undefined && scope.item.type !== undefined && scope.item.type === "datetime") {
                                    toDate = getTimeDate(scope.items[toIndex].data);

                                }
                                else
                                    toDate = navcon.dateFormat(scope.items[toIndex].data);
                                fromDate = navcon.dateFormat(modelValue);
                                var retValue = dateValidate(fromDate, toDate, item.condition);
                                if (retValue === false) {
                                    break;
                                }
                            }
                        }
                        var fieldItem = scope.items[scope.fieldIndex];
                        if (fieldItem !== undefined && fieldItem.form !== undefined && fieldItem.form[fieldItem.key] !== undefined && fieldItem.form[fieldItem.key].$setValidity !== undefined && typeof fieldItem.form[fieldItem.key].$setValidity === "function") {
                            $timeout(function () {
                                fieldItem.form[fieldItem.key].$setValidity('compareDate', retValue);
                            })
                        }
                        return retValue;
                    } else {
                        if (scope.compareDateToday !== undefined && scope.compareDateToday)
                            toDate = navcon.dateFormat(moment().format("DD/MM/YYYY"));
                        else if (scope.item !== undefined && scope.item.type !== undefined && scope.item.type === "datetime") {
                            toDate = getTimeDate(scope.items[compareDateToIndex].data);
                            fromDate = getTimeDate(modelValue);
                        }
                        else
                            toDate = navcon.dateFormat(scope.items[compareDateToIndex].data);

                        var retVal = dateValidate(fromDate, toDate, scope.compareDateBy);
                        var fieldItem = scope.items[scope.fieldIndex];
                        if (fieldItem !== undefined && fieldItem.form !== undefined && fieldItem.form[fieldItem.key] !== undefined && fieldItem.form[fieldItem.key].$setValidity !== undefined && typeof fieldItem.form[fieldItem.key].$setValidity === "function") {
                            $timeout(function () {
                                if (fieldItem.form[fieldItem.key] != undefined)
                                    fieldItem.form[fieldItem.key].$setValidity('compareDate', retVal);
                            })
                        }
                        return retVal;
                    }
                }
            });

            scope.$watch("items[" + compareDateToIndex + "].data", function (value) {
                if (scope.items[scope.fieldIndex].data === undefined || scope.items[scope.fieldIndex].data === "") return;
                var fromDate = navcon.dateFormat(scope.items[scope.fieldIndex].data);
                var toDate = navcon.dateFormat(value);
                if (scope.item !== undefined && scope.item.type !== undefined && scope.item.type === "datetime") {
                    toDate = getTimeDate(value);
                    fromDate = getTimeDate(scope.items[scope.fieldIndex].data);
                }
                field.$setValidity("compareDate", dateValidate(fromDate, toDate, scope.compareDateBy));
            });

            function dateValidate(fromDate, toDate, compareDateBy) {
                var validity = true;
                if (fromDate._i !== undefined && fromDate._i === "") return validity;
                if (compareDateBy === "<") {
                    validity = (moment(fromDate).isBefore(toDate) ? false : true);
                } else if (compareDateBy === ">") {
                    validity = (moment(fromDate).isAfter(toDate) ? false : true);
                } else if (compareDateBy === "today") {
                    validity = (moment().diff(fromDate, 'day') > 0 ? false : true);
                } else if (compareDateBy === "<=") {
                    validity = (moment(fromDate).isSame(toDate) || moment(fromDate).isBefore(toDate)) ? false : true;
                } else if (compareDateBy === ">=") {
                    validity = (moment(fromDate).isSame(toDate) || moment(fromDate).isAfter(toDate)) ? false : true;
                }
                else {

                }
                return validity;
            }

        }
    };
}]).directive("isExist", ['$timeout', 'dataservice', '$compile', '$http', '$rootScope', '$parse', function ($timeout, dataservice, $compile, $http, $rootScope, $parse) {
    return {
        require: ['^navconForm', '^ngModel'],
        link: function (scope, element, attrs, ctrl) {
            element.bind('blur', function (e) {
                var field = ctrl[1];

                if (ctrl[0] !== null) {
                    scope.items = ctrl[0].getFieldItems();
                } else {
                    if (scope.fieldData !== undefined)
                        scope.items = scope.fieldData;
                }

                var model = $parse(attrs.IsExist);
                var currentValue = element.val();
                scope.IsExistKey = scope.items[scope.fieldIndex].key;
                scope.IsExistData = scope.items[scope.fieldIndex].templateOptions.isExistData;
                scope.IsExistTreeId = scope.items[scope.fieldIndex].templateOptions.isExistTreeId;

                if (scope.items[scope.fieldIndex].templateOptions.dependFieldKey !== undefined && scope.items[scope.fieldIndex].templateOptions.dependFieldKey !== "")
                    scope.dependFieldKey = scope.items[scope.fieldIndex].templateOptions.dependFieldKey;

                if (scope.IsExistKey === undefined) return;
                if (scope.IsExistData === undefined) return;
                if (currentValue === undefined || currentValue === "") return true;

                scope.data = ctrl[0].getItem((scope.IsExistData));

                if (scope.items.getById !== undefined && scope.items.getById !== null && (scope.data === undefined || scope.data === null)) scope.data = scope.items.getById;
                if (scope.IsExistTreeId !== undefined) {
                    var parent = ctrl[0].getItem((scope.IsExistTreeId));
                    if (parent.parent !== undefined && parent.parent !== "" && parent.parent !== "0") {// && parent.parent !== "#")
                        if (parent.parent === "#")
                            var childData = scope.data;
                        else
                            //var childData = navcon.getTreeDataById(scope.data, parent.parent, "child");
                            var childData = navcon.getTreeDataById(scope.data, parent.id, "child");
                    }
                    if (childData !== undefined && childData !== null) scope.data = childData;
                }

                var retVal = true;
                var oldSDataValue = "";


                if (scope.items[scope.fieldIndex].type == "number") {
                    currentValue = parseInt(currentValue.toString().trim());
                    if (scope.items[scope.fieldIndex].oldData == undefined || scope.items[scope.fieldIndex].oldData == null || scope.items[scope.fieldIndex].oldData == "") {
                        oldSDataValue = 0;
                    }
                    else
                        oldSDataValue = parseInt(scope.items[scope.fieldIndex].oldData);
                }
                else {
                    currentValue = currentValue.toString().toLowerCase().trim();
                    if (scope.items[scope.fieldIndex].oldData == undefined || scope.items[scope.fieldIndex].oldData == null || scope.items[scope.fieldIndex].oldData == "")
                        oldSDataValue = "";
                    else
                        oldSDataValue = scope.items[scope.fieldIndex].oldData.toString().toLowerCase().trim();
                }


                if (scope.items.mode !== undefined && scope.items.mode.toLowerCase() !== 'save' && currentValue === oldSDataValue) {
                    retVal = true;
                } else {
                    if (scope.dependFieldKey !== undefined && scope.dependFieldKey !== "") {
                        var dependFieldKeyIndex = navcon.getItemIndexByProperty(scope.items, scope.dependFieldKey);
                        if (dependFieldKeyIndex !== -1) {
                            var dependItem = scope.items[dependFieldKeyIndex];
                            var dependData = dependItem.data;
                            if (dependItem.type === "select") {
                                var selectedData = (dependItem.data[dependItem.selectOptions.item.dataField] || dependItem.data.Id || dependItem.data.id);
                                dependData = (selectedData !== undefined && selectedData !== "" ? selectedData : null);
                            }
                            var obj = {}

                            if (scope.items[scope.fieldIndex].type == "number")
                                obj[scope.IsExistKey] = parseInt(currentValue.toString().trim());
                            else
                                obj[scope.IsExistKey] = currentValue.toString().trim();


                            obj[scope.dependFieldKey] = dependData;

                            retVal = navcon.getItemsFilterByObject(scope.data, obj);

                            if (retVal !== undefined && retVal.length > 0)
                                retVal = false;
                            else
                                retVal = true;
                        }
                    } else {
                        var _currentValue = '';

                        if (scope.items[scope.fieldIndex].type == "number") {
                            _currentValue = parseInt(currentValue.toString().trim());
                            retVal = navcon.getItemByKeyValue(scope.data, scope.IsExistKey, _currentValue);
                        }
                        else {
                            _currentValue = currentValue.toString().trim();
                            retVal = navcon.getItemByKeyValue(scope.data, scope.IsExistKey, _currentValue.toLowerCase(), true);
                        }


                        if (retVal !== -1)
                            retVal = false;
                        else
                            retVal = true;
                    }

                }
                field.$setValidity('isExist', retVal);
            })
        }
    };
}]).directive("checkRequired", ['$timeout', 'dataservice', '$compile', '$http', '$rootScope', '$parse', function ($timeout, dataservice, $compile, $http, $rootScope, $parse) {
    return {
        require: ['^?navconForm', '^ngModel'],
        link: function (scope, element, attrs, ctrl) {
            var ngModel = ctrl[1];
            if (ctrl[0] !== null) {
                scope.items = ctrl[0].getFieldItems();
            } else {
                if (scope.fieldData !== undefined)
                    scope.items = scope.fieldData;
            }
            ngModel.$validators.checkRequired = function (modelValue, viewValue) {
                var required = scope.items[scope.fieldIndex].templateOptions.required || false;
                var value = modelValue || viewValue;
                var match = scope.$eval(attrs.ngTrueValue) || true;
                if (required === false || required === 'no' || value === match)
                    return true;
                else
                    return false;
            };
        }
    }
}]).directive("fieldRequired", ['$timeout', 'dataservice', '$compile', '$http', '$rootScope', '$parse', function ($timeout, dataservice, $compile, $http, $rootScope, $parse) {
    return {
        require: ['^?navconForm', '^ngModel'],
        link: function (scope, element, attrs, ctrl) {
            var ngModel = ctrl[1];
            if (ctrl[0] !== null) {
                scope.items = ctrl[0].getFieldItems();
            } else {
                if (scope.fieldData !== undefined)
                    scope.items = scope.fieldData;
            }
            ngModel.$validators.fieldRequired = function (modelValue, viewValue) {
                var required = scope.items[scope.fieldIndex == undefined ? scope.$parent.fieldIndex : scope.fieldIndex].templateOptions.required || false;
                var value = modelValue || viewValue;

                if ((required === true || required === 'yes') && (value === undefined || value.length === 0))
                    return false;
                else
                    return true;
            };
        }
    }
}]);
"use strict";

angular.module('app').directive('navconDelete', ['dataservice', 'logger',
    function(dataservice, logger) {
        return {
            /*E: Directive defined as an element. <navcon-table></navcon-table>
            A: Directive applied as an attribute on existing element. <div navcon-table></div>
            C: Directive applied as a css class to existing element <div class="navcon-table"></div>
            M: Directive applied as comment.*/
            restrict: 'E',
            replace: true,
            transclude: 'true',
            scope: {
                //@ reads the attribute value, = provides two-way binding, & works with functions
                title: '@',
                type: '@',
                id: '@',
                navconData: '=',
                footer: '@',
                icon: '@',
                size: '@',
                delete: '@'
            },
            //templateUrl: 'ext-modules/navconDelete/navconDeleteTemplate.html',
            templateUrl: function() {
                return navcon.Menuroute.getTemplateUrl("navconDelete");
            },
            link: function(scope, el, attrs) {
                $(el).draggable({
                    handle: ".modal-header",
                });

                $(el).attr("id", attrs.type + "delete");

                $(el).addClass(scope.size);

                scope.delete = function(type, typedel) {
                    scope.navconData.tableRowDelete(type, type + 'delete', function(data) {
                        if (data)
                            logger.success("Entries are deleted successfully...", "", "");
                    });
                };
            }
        };
    }
]);
"use strict";

angular.module('app').directive('navconForm', ['dataservice', 'logger', '$timeout', '$compile', '$rootScope',
    function(dataservice, logger, $timeout, $compile, $rootScope) {
        return {
            /*E: Directive defined as an element. <navcon-table></navcon-table>
            A: Directive applied as an attribute on existing element. <div navcon-table></div>
            C: Directive applied as a css class to existing element <div class="navcon-table"></div>
            M: Directive applied as comment.*/
            restrict: 'E',
            replace: true,
            transclude: 'element',
            scope: {
                //@ reads the attribute value, = provides two-way binding, & works with functions
                navconData: '=',
                navconModel: '@',
                items: '=fieldData',
                title: '@',
                icon: '@',
                footer: '@',
                type: '@',
                save: '@',
                cancel: '@',
                approvalKey: '@',
                approvalConfig: '@',
                approvalTitle: '=',
                formName: '@',
                formManage: '=',
                readOnly: '=',
                validate: '@'
            },
            controller: function($scope) {

                this.getFieldItems = function() {
                    return $scope.items;
                }
                this.getFormType = function() {
                    return $scope.type;
                }
                this.getItem = function(item) {
                    return $scope.navconData[item];
                }
                this.getFormName = function(item) {
                    return $scope.form;
                }
                this.getNavconData = function(item) {
                    return $scope.navconData;
                }
                this.getValidate = function() {
                    return $scope.validate;
                }
                this.getFormReadOnly = function() {
                    return $scope.readOnly;
                }
            },
            //templateUrl: 'ext-modules/navconForm/navconFormTemplate.html',
            templateUrl: function() {
                return navcon.Menuroute.getTemplateUrl("navconForm");
            },
            link: function(scope, el, attrs) {
                scope.form = "page";

                if (scope.formManage !== undefined && scope.formManage !== null)
                    scope.manage = scope.formManage
                else
                    scope.manage = {};

                if (scope.validate === undefined)
                    scope.validate = true;

                scope.$watch("readOnly", function(newValue, oldValue) {
                    if (newValue !== undefined && newValue !== oldValue) {
                        scope.$broadcast('FORM-READONLY', newValue);
                    }
                }, this);

                if (scope.approvalKey !== undefined && scope.approvalKey !== "") {
                    var keyIndex = navcon.getItemIndexByProperty(scope.items, scope.approvalKey);
                    if (keyIndex !== undefined && keyIndex !== -1) {
                        scope.approvalPage = scope.items[keyIndex].page;
                        scope.modalId = scope.items[keyIndex].modalId;
                        scope.itemId = scope.items[keyIndex].itemId;
                        scope.approvalId = scope.items[keyIndex].approvalId;
                        scope.source = scope.items[keyIndex].source;

                        if (scope.items[keyIndex].pageConfig !== undefined && scope.items[keyIndex].pageConfig !== "") {
                            if (scope.approvalConfig !== undefined && scope.approvalConfig !== null && scope.approvalConfig[scope.items[keyIndex].pageConfig] !== undefined && scope.approvalConfig[scope.items[keyIndex].pageConfig] !== null)
                                scope.approvalConfig = scope.approvalConfig[scope.items[keyIndex].pageConfig];
                            else if (scope.navconData !== undefined && scope.navconData !== null && scope.navconData[scope.items[keyIndex].pageConfig] !== undefined && scope.navconData[scope.items[keyIndex].pageConfig] !== null)
                                scope.approvalConfig = scope.navconData[scope.items[keyIndex].pageConfig];
                            else if (scope.$parent.$parent !== undefined && scope.$parent.$parent.navconData !== undefined && scope.$parent.$parent.navconData[scope.items[keyIndex].pageConfig] !== undefined && scope.$parent.$parent.navconData[scope.items[keyIndex].pageConfig] !== null)
                                scope.approvalConfig = scope.$parent.$parent.navconData[scope.items[keyIndex].pageConfig];
                        }

                        var templateData = $($(el).find("script[id ='Approval']")).text();
                        $($(el).find("span[id='Approval']")).html(templateData);
                        $compile($($(el).find("span[id='Approval']")).contents())(scope);
                    }
                }
                scope.manage.cancel = function(type) {
                    /* if(scope.navconData.directive.cancel !== undefined)
                        scope.navconData.directive.cancel(type);
                     else*/

                    //scope.approvalTitle = "";
                    navcon.setViewContentDisabled("");

                    scope.navconData.cancel(type);
                    scope.formReset();
                }

                scope.formReset = function() {
                    if (scope.items === undefined || scope.items.length === undefined) return true;
                    var retVal = true;
                    for (var i = 0, len = scope.items.length; i < len; i++) {
                        if (scope.items[i].form !== undefined) {
                            if (scope.items[i].form.$setPristine !== undefined && typeof scope.items[i].form.$setPristine === "function")
                                scope.items[i].form.$setPristine();

                            if (scope.items[i].form.$setUntouched !== undefined && typeof scope.items[i].form.$setUntouched === "function")
                                scope.items[i].form.$setUntouched();
                        }
                    }
                };

                scope.manage.continue = function(type, page, modal, fieldset) {

                    if (scope.manage.formValid(fieldset)) {
                        scope.navconData.formActions.continue(type, page, modal, fieldset);
                        //  scope.navconData.continue(type, page, modal, fieldset);//, saveCallBack
                    } else {
                        logger.warning("Invalid entries...", "", "");
                    }
                };

                scope.manage.save = function(type, category) {
                    //if (scope.formValid() && tableEditorValid()) {
                    if (category == undefined) {
                        category = scope.items;
                    }
                    if (scope.manage.formValid(category)) {
                        scope.navconData.save(type, category, saveCallBack);

                        function saveCallBack(data) {
                            if (data) {
                                var msg = "Entries are saved successfully...";
                                if (scope.navconData !== undefined && scope.items.mode !== undefined && scope.items.mode === "Update")
                                    msg = "Entries are updated successfully...";
                                if (scope.navconData !== undefined && scope.items.mode !== undefined && scope.items.mode !== "Delete")
                                    logger.success(msg, "", "");
                                // scope.formReset();
                            }
                        }
                    } else {
                        logger.warning("Invalid entries...", "", "");
                    }
                };

                //scope.formValid = function () {
                //    if (scope.items === undefined || scope.items.length === undefined || !scope.validate) return true;
                //    var retVal = true;
                //    for (var i = 0, len = scope.items.length; i < len; i++) {
                //        if (scope.items[i].type !== undefined && scope.items[i].type === "tableeditor") tableEditorValid();
                //        if (scope.items[i].form !== undefined && typeof scope.items[i].form === "object") {
                //            if (scope.items[i].form.$invalid) { //&& !scope.items[i].valid
                //                scope.items[i].setFocus = false;
                //                angular.forEach(scope.items[i].form.$error, function (field) {
                //                    angular.forEach(field, function (errorField) {
                //                        if (errorField.$name === "form") {
                //                        } else {
                //                            errorField.$setTouched();
                //                        }
                //                    })
                //                });
                //                retVal = false;
                //                if (scope.items[i].showMessage !== undefined) {
                //                    scope.items[i].showMessage = true;
                //                    setTimeout(function (n) {
                //                        if (scope.items[n].showMessage !== undefined)
                //                            scope.items[n].showMessage = false;
                //                    }, 6000, i);
                //                }
                //            }
                //        }
                //    }
                //    return retVal;
                //};

                scope.manage.formValid = function(items) {
                    if (items === undefined || items.length === undefined || !scope.validate) return true;
                    var retVal = true;
                    for (var i = 0, len = items.length; i < len; i++) {
                        if (items[i].type !== undefined && items[i].type === "tableeditor") tableEditorValid(items[i]);
                        if (items[i].form !== undefined && typeof items[i].form === "object") {
                            if (items[i].form.$invalid && (items[i].validate === undefined || items[i].validate)) { //&& !items[i].valid
                                var isDraftValidate = false;
                                var isDraft = false;
                                if (scope.navconData !== undefined && scope.navconData.saveStatus !== undefined && scope.navconData.saveStatus === "draft") {
                                    isDraft = true;
                                    if (items[i].templateOptions !== undefined && items[i].templateOptions.draftValidate !== undefined && items[i].templateOptions.draftValidate === true && !items[i].form[items[i].key].$valid) {
                                        retVal = false;
                                        isDraftValidate = true;
                                    }
                                } else {
                                    if (items[i].form[items[i].key] !== undefined && items[i].form[items[i].key].$valid !== undefined) {
                                        if (!items[i].form[items[i].key].$valid)
                                            retVal = false;
                                    } else {
                                        retVal = false;
                                    }
                                }
                                if (isDraft && !isDraftValidate) continue;
                                items[i].setFocus = false;
                                angular.forEach(items[i].form.$error, function(field) {
                                    angular.forEach(field, function(errorField) {
                                        if (errorField.$name === "form") {} else {
                                            errorField.$setTouched();
                                        }
                                    })
                                });
                                if (items[i].showMessage !== undefined) {
                                    items[i].showMessage = true;
                                    setTimeout(function(n) {
                                        if (items[n].showMessage !== undefined)
                                            items[n].showMessage = false;
                                    }, 6000, i);
                                }
                            }
                        }
                    }
                    return retVal;
                };

                //function tableEditorValid() {
                //    if (scope.items === undefined || scope.items.length === undefined) return true;
                //    var retVal = true;
                //    for (var l = 0, len = scope.items.length; l < len; l++) {
                //        if (scope.items[l].type !== undefined && scope.items[l].type === "tableeditor") {
                //            if (scope.items[l].data.length > 0) {
                //                var items = scope.items[l].data[0].fields;
                //                for (var i = 0, len = items.length; i < len; i++) {
                //                    if (items[i].form !== undefined && typeof items[i].form === "object") {
                //                        if (items[i].form.$invalid) {//&& !items[i].valid
                //                            items[i].setFocus = false;
                //                            angular.forEach(items[i].form.$error, function (field) {
                //                                angular.forEach(field, function (errorField) {
                //                                    if (errorField.$name === "form") {
                //                                        //console.log(scope.items[i]);
                //                                    } else {
                //                                        errorField.$setTouched();
                //                                    }
                //                                })
                //                            });
                //                            retVal = false;
                //                            if (items[i].showMessage !== undefined) {
                //                                items[i].showMessage = true;
                //                                setTimeout(function (n) {
                //                                    if (items[n].showMessage !== undefined)
                //                                        items[n].showMessage = false;
                //                                }, 6000, i);
                //                            }
                //                        }
                //                    }
                //                }
                //            }
                //        }
                //    }
                //    return retVal;
                //};


                function tableEditorValid(items) {
                    if (items === undefined) return true;
                    var retVal = true;
                    $.each(items.data, function(index, value) {
                        retVal = scope.manage.formValid(value.fields)
                    })
                    return retVal;
                };
            }
        };
    }
]);
"use strict";

angular.module("navconFramework").directive("navconFramework", function() {
    return {
        restrict: 'AE',
        replace: false,
        transclude: false,
        scope: {
            title: '@',
            subtitle: '@',
            iconFile: '@'
        },
        controller: "navconFrameworkController",
        //templateUrl: "ext-modules/navconFramework/navconFrameworkTemplate.html"
        templateUrl: function() {
            return navcon.Menuroute.getTemplateUrl("navconFramework");
        },

    };
});
"use strict";

angular.module('app').directive('navconKendofield', ['$timeout', 'dataservice', '$compile', '$http', '$rootScope', 'ngAuthSettings',
function ($timeout, dataservice, $compile, $http, $rootScope, ngAuthSettings) {
    return {
        /*E: Directive defined as an element. <navcon-input></navcon-input>
        A: Directive applied as an attribute on existing element. <div navcon-input></div>
        C: Directive applied as a css class to existing element <div class="navcon-input"></div>
        M: Directive applied as comment.*/
        restrict: 'E',
        replace: 'true',
        scope: {
            //@ reads the attribute value, = provides two-way binding, & works with functions
            //items:'=fieldData',
            fieldKey: '@',
            //navconData: '=',
            //fieldType:'@',
            //fieldIndex:'@',
            showMessage: '@',
            onClick: '@',
            onBlur: '@',
            onChange: '@',
            invalid: '@',
            onKeyPress: '@',
            fields: '=',
            //form: '@',
            labelClass: '@',
            fieldClass: '@',
            fieldData: '='
        },
        require: ['^?navconForm', '^?form'],
        link: function (scope, el, attrs, ctrl) {

            if (ctrl[0] !== null) {
                if (scope.fieldData !== undefined)
                    scope.items = scope.fieldData;
                else
                    scope.items = ctrl[0].getFieldItems();
                scope.form = ctrl[1];

                scope.navconData = ctrl[0].getNavconData();
                scope.validate = ctrl[0].getValidate();
                scope.readOnly = ctrl[0].getFormReadOnly();

            }
            if (scope.items === undefined) {
                if (scope.fieldData !== undefined)
                    scope.items = scope.fieldData;
                else
                    return;
            }

            if (scope.validate === undefined)
                scope.validate = true;

            if (scope.readOnly === undefined)
                scope.readOnly = false;

            if (ngAuthSettings.enableFieldLevelValidation !== undefined && !ngAuthSettings.enableFieldLevelValidation)
                scope.enableFieldLevelValidation = false;
            else
                scope.enableFieldLevelValidation = true;


            scope.fieldIndex = navcon.getItemIndexByProperty(scope.items, scope.fieldKey);
            scope.fieldType = scope.items[scope.fieldIndex].type;

            var templateData = $($rootScope.fieldTemplate).find("script[id ='" + scope.fieldType + "']").text();
            el.html(templateData);
            $compile(el.contents())(scope);
            el.find('[data-toggle="tooltip"]').tooltip();
            scope.redirectURL = function (URL) {
                if (URL.indexOf('http') == -1) {
                    URL = "http://" + URL;
                }
                window.open(encodeURI(URL), '_blank');
            }
            scope.onClick = function (key, e) {
                showMessaggeStatus(scope, $timeout);

            };




            scope.onChange = function (key, e) {
                scope.item.selectOptions.item["isSelect"] = true;
            };

            var replaceSpecialCharacter = function (item) {
                if (item !== undefined && typeof item === "string" && item !== "") {
                    scope.item.data = item.replace(/\u2013|\u2014/g, "-");
                }
            }



            scope.$watch("items[" + scope.fieldIndex + "]", function (newValue, oldValue) {
                if (newValue !== undefined) {
                    scope.item = newValue;
                    scope.item.form = scope.form;
                    scope.item.showMessage = false;
                    scope.item.setFocus = false;
                    fieldSettings(scope, el, attrs, $compile);
                    scope.$watch('form.' + scope.item.key + '.$valid', function (newValue, oldValue) {
                        if (newValue !== undefined && newValue !== oldValue) {
                            scope.item.setFocus = false;
                            if (newValue === false && scope.validate && scope.enableFieldLevelValidation) {
                                scope.invalid = true;
                                scope.item.valid = false;
                                showMessaggeStatus(scope, $timeout);
                            } else {
                                scope.invalid = false;
                                scope.item.valid = true;
                            }
                        }
                    });
                }
            });

            scope.$on('FORM-READONLY', function (event, data) {
                scope.readOnly = data;
            });

            scope.$watch("items[" + scope.fieldIndex + "].readonly", function (newValue, oldValue) {
                if (newValue !== undefined) {
                    scope.readOnly = newValue;
                }
            });


            //scope.$watch("items[" + scope.fieldIndex + "].data", function (newValue, oldValue) {
            //    //  if (newValue !== undefined && newValue !== oldValue) {
            //    if (newValue !== undefined) {
            //        scope.item.showMessage = false;
            //        if (scope.readOnly) {
            //            scope.item.readOnlyText = scope.displayReadOnlyField(scope.item);
            //        }
            //    }
            //}, this);

            scope.$on('FIELD-VALID', function (event, value, keyIndex) {
                if (scope.items.length >= keyIndex && scope.items[keyIndex] !== undefined) {
                    if (value === true) {
                        scope.items[keyIndex].valid = true;

                    } else {
                        scope.items[keyIndex].valid = false;

                    }
                }
            });


            scope.tabMouseOver = function (el, scope, item) {
                $(el.srcElement).css('cursor', scope.templateOptions.cursor);
            };



            scope.displayReadOnlyField = function (item) {
                var returnValue = item.data != null ? item.data : "";
                if (item.type === "select" || item.type === "kendoselect" || item.type === "kendocombobox") {
                    returnValue = item.data[item.selectOptions.item.displayField];
                } else if (item.type === "multiselect" || item.type === "multiselectcheckbox" || item.type === "kendomultiselect") {
                    var list = [];
                    for (var i = 0, len = item.data.length; i < len; i++) {
                        var obj = item.data[i];
                        if (item.selectOptions.item.secondDisplayField !== undefined && item.selectOptions.item.secondDisplayField !== null && item.selectOptions.item.secondDisplayField !== "")
                            list.push(obj[item.selectOptions.item.displayField] + " / " + obj[item.selectOptions.item.secondDisplayField])
                        else
                            list.push(obj[item.selectOptions.item.displayField])
                    }
                    returnValue = list.join("; ");
                } else if (item.type === "checkbox") {
                    if (item.data || item.data === 1 || item.data === "true")
                        returnValue = item.templateOptions.suffixLabel;
                    else {
                        if (item.templateOptions.suffixLabelfalse !== undefined)
                            returnValue = item.templateOptions.suffixLabelfalse;
                        else
                            returnValue = "No";
                    }
                } else if (item.type === "radio") {
                    var items = item.templateOptions.items;
                    var findObj = navcon.getItemByKeyValue(items, "value", item.data);
                    if (findObj !== -1) {
                        if (item.templateOptions.suffixLabelfalse !== undefined)
                            returnValue = findObj.suffixLabel;
                        else
                            returnValue = findObj.label;
                    } else {
                        if (item.templateOptions.suffixLabelfalse !== undefined)
                            returnValue = items[0].suffixLabel;
                        else
                            returnValue = item.data;
                    }
                }
                else {
                    returnValue = item.data;
                }
                return returnValue != undefined ? (returnValue != null ? returnValue : "") : "";
            };



            function fieldSettings(scope, el, attrs, $compile) {

                if (scope.item.type === "kendodate") {
                    kendodateSetting(scope, el, attrs);
                } else if (scope.item.type === "kendocombobox") {
                    kendocomboboxSetting(scope, el, attrs);
                } else if (scope.item.type === "kendonumerictextbox") {
                    kendonumerictextboxSetting(scope, el, attrs);
                } else if (scope.item.type === "kendomaskedtextbox") {
                    kendomaskedtextboxSetting(scope, el, attrs);
                } else if (scope.item.type === "kendocolorpicker") {
                    kendocolorpickerSetting(scope, el, attrs);
                } else if (scope.item.type === "kendoswitch") {
                    kendoswitchSetting(scope, el, attrs);
                } else if (scope.item.type === "kendodatetime") {
                    kendodatetimeSetting(scope, el, attrs);
                } else if (scope.item.type === "kendotime") {
                    kendotimeSetting(scope, el, attrs);
                } else if (scope.item.type === "kendoselect") {
                    kendoselectSetting(scope, el, attrs);
                } else if (scope.item.type === "kendomultiselect") {
                    kendomultiSelectSetting(scope, el, attrs);
                }


                if ($(el).is('[class*="col-sm"]'))
                    $('<div class="clearfix visible-xs-block visible-sm-block"></div>').insertAfter($(el));

                if (scope.item.templateOptions.label === "") {
                    var fistObj = $($(el).find("div[ng-show*='" + scope.item.type + "']")[0]).find('label').first();
                    fistObj.css("display", "none")
                    fistObj.next().css("width", "79%");
                }
            };

            function showMessaggeStatus(scope, $timeout) {
                if (scope.invalid === true && (scope.item.showMessage === undefined || scope.item.showMessage === false)) {
                    scope.item.showMessage = true;
                    $timeout(function () {
                        message(scope);
                    }, 6000);
                };

                function message(scope) {
                    scope.item.showMessage = false;
                };
            };


            function tabSetting(scope, el, attr) {
                $(el).find('a').css('cursor', scope.item.templateOptions.cursor);
            }

            function kendodateSetting(scope, el, attr) {


                var options = {};
                if (scope.item.templateOptions !== undefined) {
                    options["format"] = "dd/MM/yyyy";
                    if (scope.items[scope.fieldIndex].templateOptions.dateformat != undefined) {
                        options["format"] = scope.items[scope.fieldIndex].templateOptions.dateformat;
                    }
                    options["disableDates"] = function (date) {
                        if (scope.item.templateOptions.futureDate !== undefined && scope.item.templateOptions.futureDate !== "" && scope.item.templateOptions.futureDate)
                            return date < new Date();
                    };
                    if (scope.items[scope.fieldIndex].templateOptions.parseFormats != undefined)
                        options["parseFormats"] = scope.items[scope.fieldIndex].templateOptions.parseFormats
                    options["change"] = onkendodateChange;
                }


                var element = $(el);
                element.find("input").kendoDatePicker(options);

                if (scope.item.disabled !== undefined) {
                    var dateelement = element.data("kendoDatePicker");
                    dateelement.enable(!(scope.item.disabled));
                }
            };

            function onkendodateChange() {
                scope.item.data = [];

                scope.item.data = this._oldText;
            }


            function kendoswitchSetting(scope, el, attr) {

                var options = {};
                if (scope.item.templateOptions !== undefined) {
                    if (scope.item.templateOptions.onLabel !== undefined)
                        options["onLabel"] = scope.items[scope.fieldIndex].templateOptions.onLabel;

                    if (scope.items[scope.fieldIndex].templateOptions.offLabel != undefined) {
                        options["offLabel"] = scope.items[scope.fieldIndex].templateOptions.offLabel;
                    }

                    options["change"] = onkendoswitchChange;
                }
                var element = $(el);
                element.find("input").kendoMobileSwitch(options);

                if (scope.item.disabled !== undefined) {
                    var dateelement = element.data("kendoMobileSwitch");
                    dateelement.enable(!(scope.item.disabled));
                }
            };

            function onkendoswitchChange(e) {
                scope.item.data = [];

                scope.item.data = e.checked;
            }

            function kendodatetimeSetting(scope, el, attr) {

                var options = {};
                if (scope.item.templateOptions !== undefined) {
                    if (scope.item.templateOptions.hours24 !== undefined && scope.item.templateOptions.hours24)
                        options["timeFormat"] = "HH:mm";
                    options["format"] = "dd/MM/yyyy HH:mm";
                    if (scope.items[scope.fieldIndex].templateOptions.dateformat != undefined) {
                        options["format"] = scope.items[scope.fieldIndex].templateOptions.dateformat;
                    }
                    options["disableDates"] = function (date) {
                        if (scope.item.templateOptions.futureDate !== undefined && scope.item.templateOptions.futureDate !== "" && scope.item.templateOptions.futureDate)
                            return date < new Date();
                    };
                    if (scope.items[scope.fieldIndex].templateOptions.parseFormats != undefined)
                        options["parseFormats"] = scope.items[scope.fieldIndex].templateOptions.parseFormats
                    options["change"] = onkendodatetimeChange;
                }
                var element = $(el);
                element.find("input").kendoDateTimePicker(options);

                if (scope.item.disabled !== undefined) {
                    var dateelement = element.data("kendoDateTimePicker");
                    dateelement.enable(!(scope.item.disabled));
                }
            };

            function onkendodatetimeChange() {
                scope.item.data = [];

                scope.item.data = this._oldText;
            }

            function kendotimeSetting(scope, el, attr) {

                var options = {};
                if (scope.item.templateOptions !== undefined) {
                    if (scope.item.templateOptions.hours24 !== undefined && scope.item.templateOptions.hours24)
                        options["timeFormat"] = "HH:mm";

                    if (scope.items[scope.fieldIndex].templateOptions.parseFormats != undefined)
                        options["parseFormats"] = scope.items[scope.fieldIndex].templateOptions.parseFormats
                    options["change"] = onkendotimeChange;
                }
                var element = $(el);
                element.find("input").kendoTimePicker(options);

                if (scope.item.disabled !== undefined) {
                    var dateelement = element.data("kendoTimePicker");
                    dateelement.enable(!(scope.item.disabled));
                }
            };

            function onkendotimeChange() {
                scope.item.data = [];

                scope.item.data = this._oldText;
            }



            function kendocolorpickerSetting(scope, el, attr) {
                var keyIndex = navcon.getItemIndexByProperty(scope.items, scope.item.key);
                if (scope.items[keyIndex].type === "kendocolorpicker")
                    if (scope.items[keyIndex].data === undefined || scope.items[keyIndex].data === "") scope.items[keyIndex].data = [];

                var options = {};
                if (scope.item.templateOptions !== undefined) {
                    if (scope.item.templateOptions.buttons !== undefined) {
                        options["buttons"] = scope.item.templateOptions.buttons;
                    }


                    options["select"] = onkendocolorpickerSelect;
                }




                var element = $($(el).find('input'));
                element.kendoColorPicker(options);

                if (scope.item.disabled !== undefined) {
                    var colorboxField = element.data("kendoColorPicker");
                    colorboxField.enable(!(scope.item.disabled));
                }


                scope.$watch("items[" + keyIndex + "].data", function (newValue, oldValue) {
                    if (newValue !== undefined) {
                        var colorboxField = element.data("kendoColorPicker");
                        colorboxField.value(newValue);
                    }
                });

            }

            function onkendocolorpickerSelect() {
                scope.item.data = this.value();
            }

            function kendomaskedtextboxSetting(scope, el, attr) {
                var keyIndex = navcon.getItemIndexByProperty(scope.items, scope.item.key);
                if (scope.items[keyIndex].type === "kendomaskedtextbox")
                    if (scope.items[keyIndex].data === undefined || scope.items[keyIndex].data === "") scope.items[keyIndex].data = [];

                var options = {};
                if (scope.item.templateOptions !== undefined) {
                    if (scope.item.templateOptions.mask !== undefined) {
                        options["mask"] = scope.item.templateOptions.mask;
                    }


                    options["change"] = onkendomaskedtextboxChange;
                }




                var element = $($(el).find('input'));
                element.kendoMaskedTextBox(options);

                if (scope.item.disabled !== undefined) {
                    var textboxField = element.data("kendoMaskedTextBox");
                    textboxField.enable(!(scope.item.disabled));
                }



            }

            function onkendomaskedtextboxChange() {
                scope.item.data = this.value().replace(/[- ()]/g, '');
            }


            function kendonumerictextboxSetting(scope, el, attr) {
                var keyIndex = navcon.getItemIndexByProperty(scope.items, scope.item.key);
                if (scope.items[keyIndex].type === "kendonumerictextbox")
                    if (scope.items[keyIndex].data === undefined || scope.items[keyIndex].data === "") scope.items[keyIndex].data = [];

                var options = {};
                if (scope.item.templateOptions !== undefined) {
                    if (scope.item.templateOptions.format !== undefined) {
                        options["format"] = scope.item.templateOptions.format;
                    }
                    if (scope.item.templateOptions.decimals !== undefined) {
                        options["decimals"] = scope.item.templateOptions.decimals;
                    }

                    if (scope.item.templateOptions.min !== undefined) {
                        options["min"] = scope.item.templateOptions.min;
                    }

                    if (scope.item.templateOptions.max !== undefined) {
                        options["max"] = scope.item.templateOptions.max;
                    }

                    if (scope.item.templateOptions.step !== undefined) {
                        options["step"] = scope.item.templateOptions.step;
                    }

                    if (scope.item.templateOptions.round !== undefined) {
                        options["round"] = scope.item.templateOptions.round;
                    }

                    if (scope.item.templateOptions.restrictDecimals !== undefined) {
                        options["restrictDecimals"] = scope.item.templateOptions.restrictDecimals;
                    }

                    if (scope.item.templateOptions.placeholder !== undefined) {
                        options["placeholder"] = scope.item.templateOptions.placeholder;
                    }

                    options["change"] = onkendonumerictextboxChange;
                }




                var element = $($(el).find('input'));
                element.kendoNumericTextBox(options);

                if (scope.item.disabled !== undefined) {
                    var textboxField = element.data("kendoNumericTextBox");
                    textboxField.enable(!(scope.item.disabled));
                }



            }

            function onkendonumerictextboxChange() {
                scope.item.data = this.value();
            }

            function kendocomboboxSetting(scope, el, attr) {
                var keyIndex = navcon.getItemIndexByProperty(scope.items, scope.item.key);
                if (scope.items[keyIndex].type === "kendocombobox")
                    if (scope.items[keyIndex].data === undefined || scope.items[keyIndex].data === "") scope.items[keyIndex].data = [];

                var options = {};
                if (scope.item.templateOptions !== undefined) {
                    if (scope.item.selectOptions.item.filter !== undefined) {
                        options["filter"] = scope.item.selectOptions.item.filter;
                    }
                    if (scope.item.selectOptions.item.autoBind !== undefined) {
                        options["autoBind"] = scope.item.selectOptions.item.autoBind;
                    }
                    if (scope.item.selectOptions.item.autoBind !== undefined) {
                        options["autoBind"] = scope.item.selectOptions.item.autoBind;
                    }
                    if (scope.item.selectOptions.item.minLength !== undefined) {
                        options["minLength"] = scope.item.selectOptions.item.minLength;
                    }
                    if (scope.item.selectOptions.item.displayField !== undefined) {
                        options["dataTextField"] = scope.item.selectOptions.item.displayField;
                    }
                    if (scope.item.selectOptions.item.dataField !== undefined) {
                        options["dataValueField"] = scope.item.selectOptions.item.dataField;
                    } if (scope.item.selectOptions.placeholder !== undefined) {
                        options["placeholder"] = scope.item.templateOptions.placeholder;
                    }
                    if (scope.item.selectOptions.item.group !== undefined) {
                        options["dataSource"] = { data: scope.item.selectOptions.items, group: { field: scope.item.selectOptions.item.groupField } }
                    } else {
                        options["dataSource"] = { data: scope.item.selectOptions.items }
                    }

                    if (scope.item.selectOptions.item.headerTemplate !== undefined) {
                        options["headerTemplate"] = scope.item.selectOptions.item.headerTemplate;
                    }
                    if (scope.item.selectOptions.item.footerTemplate !== undefined) {
                        options["footerTemplate"] = scope.item.selectOptions.item.footerTemplate;
                    }
                    if (scope.item.selectOptions.item.template !== undefined) {
                        options["template"] = scope.item.selectOptions.item.template;
                    }
                    options["select"] = onkendocomboBoxselect;
                }




                var element = $($(el).find('input'));
                element.kendoComboBox(options);

                if (scope.item.disabled !== undefined) {
                    var dropselect = element.data("kendoComboBox");
                    dropselect.enable(!(scope.item.disabled));
                }
                scope.$watch("items[" + keyIndex + "].selectOptions.items", function (newValue, oldValue) {
                    if (newValue !== undefined) {
                        var singleselect = element.data("kendoComboBox");
                        singleselect.dataSource.data(newValue);
                        //$(multiselect.wrapper).addClass(scope.fieldClass);
                    }
                });

                scope.$watch("items[" + keyIndex + "].data", function (newValue, oldValue) {
                    if (newValue !== undefined && newValue[scope.item.selectOptions.item.dataField] != undefined) {
                        var dropselect = element.data("kendoComboBox");
                        dropselect.value(newValue[scope.item.selectOptions.item.dataField]);
                    } else {
                        var dropselect = element.data("kendoComboBox");
                        dropselect.value("");
                    }
                });
            }
            function onkendocomboBoxselect(e) {
                scope.item.data = [];

                scope.item.data = e.dataItem;
            }

            function kendoselectSetting(scope, el, attr) {
                var keyIndex = navcon.getItemIndexByProperty(scope.items, scope.item.key);
                if (scope.items[keyIndex].type === "kendoselect")
                    if (scope.items[keyIndex].data === undefined || scope.items[keyIndex].data === "") scope.items[keyIndex].data = [];

                var options = {};
                if (scope.item.templateOptions !== undefined) {
                    if (scope.item.selectOptions.item.displayField !== undefined) {
                        options["dataTextField"] = scope.item.selectOptions.item.displayField;
                    }
                    if (scope.item.selectOptions.item.dataField !== undefined) {
                        options["dataValueField"] = scope.item.selectOptions.item.dataField;
                    } if (scope.item.selectOptions.placeholder !== undefined) {
                        options["placeholder"] = scope.item.templateOptions.placeholder;
                    }
                    options["dataSource"] = { data: scope.item.selectOptions.items }
                    options["select"] = onkendoselect;
                }




                var element = $($(el).find('select'));
                element.kendoDropDownList(options);

                if (scope.item.disabled !== undefined) {
                    var dropselect = element.data("kendoDropDownList");
                    dropselect.enable(!(scope.item.disabled));
                }
                scope.$watch("items[" + keyIndex + "].selectOptions.items", function (newValue, oldValue) {
                    if (newValue !== undefined) {
                        var singleselect = element.data("kendoDropDownList");
                        singleselect.dataSource.data(newValue);
                        //$(multiselect.wrapper).addClass(scope.fieldClass);
                    }
                });

                //scope.$watch("items[" + keyIndex + "].data", function (newValue, oldValue) {
                //    if (newValue !== undefined && newValue[scope.item.selectOptions.item.dataField] != undefined) {
                //        var dropselect = element.data("kendoDropDownList");
                //        dropselect.value(newValue[scope.item.selectOptions.item.dataField]);
                //    } else {
                //        var dropselect = element.data("kendoDropDownList");
                //        dropselect.value("");
                //    }
                //});
            }
            function onkendoselect(e) {
                scope.item.data = [];

                scope.item.data = e.dataItem;
            }

            function kendomultiSelectSetting(scope, el, attr) {
                var keyIndex = navcon.getItemIndexByProperty(scope.items, scope.item.key);
                if (scope.items[keyIndex].type === "kendomultiselect")
                    if (scope.items[keyIndex].data === undefined || scope.items[keyIndex].data === "") scope.items[keyIndex].data = [];
                var element = $($(el).find('select'));

                var options = {};
                if (scope.item.templateOptions !== undefined) {
                    if (scope.item.selectOptions.item.displayField !== undefined) {
                        options["dataTextField"] = scope.item.selectOptions.item.displayField;
                    }
                    if (scope.item.selectOptions.tagTemplate !== undefined) {
                        options["tagTemplate"] = scope.item.selectOptions.tagTemplate;
                    }
                    if (scope.item.selectOptions.itemTemplate !== undefined) {
                        options["itemTemplate"] = scope.item.selectOptions.itemTemplate;
                    }
                    if (scope.item.selectOptions.headerTemplate !== undefined) {
                        options["headerTemplate"] = scope.item.selectOptions.headerTemplate;
                    }
                    if (scope.item.selectOptions.footerTemplate !== undefined) {
                        options["footerTemplate"] = scope.item.selectOptions.footerTemplate;
                    }
                    if (scope.item.selectOptions.tagMode !== undefined && scope.item.selectOptions.tagMode) {
                        options["tagMode"] = "single";
                    }
                    if (scope.item.selectOptions.item.dataField !== undefined) {
                        options["dataValueField"] = scope.item.selectOptions.item.dataField;
                    }
                    if (scope.item.selectOptions.placeholder !== undefined) {
                        options["placeholder"] = scope.item.templateOptions.placeholder;
                    }
                    options["dataSource"] = { data: scope.item.selectOptions.items }
                    options["select"] = onSelectKendomultiselect;
                    options["deselect"] = onDeselectKendomultiselect;
                }



                element.kendoMultiSelect(options).data('kendoMultiSelect');

                if (scope.item.disabled !== undefined) {
                    var dropselect = element.data("kendoMultiSelect");
                    dropselect.enable(!(scope.item.disabled));
                }


                scope.$watch("items[" + keyIndex + "].selectOptions.items", function (newValue, oldValue) {
                    if (newValue !== undefined) {
                        var multiselect = element.data("kendoMultiSelect");
                        multiselect.dataSource.data(newValue);
                        $(multiselect.wrapper).addClass(scope.fieldClass);
                    }
                });
                //scope.$watch("items[" + keyIndex + "].data", function (newValue, oldValue) {
                //    if (newValue !== undefined) {
                //        var selectedValues = [];
                //        $.each(newValue, function (index, item) {
                //            selectedValues.push(item[scope.item.selectOptions.item.dataField]);
                //        })
                //        var multiselect = element.data("kendoMultiSelect");
                //        multiselect.value(selectedValues);
                //    } else {
                //        var selectedValues = [];
                //        var multiselect = element.data("kendoMultiSelect");
                //        multiselect.value(selectedValues);
                //    }
                //});



            }
            function onSelectKendomultiselect(e) {

                scope.item.data.push(e.dataItem);
            }
            function onDeselectKendomultiselect(e) {
                scope.item.data = $(scope.item.data).filter(function (i, n) {
                    return n[scope.item.selectOptions.item.dataField] != e.dataItem[scope.item.selectOptions.item.dataField];
                });

            }


            function parentItems(item) {
                for (var key in item) {
                    if (item["$parent"].items != undefined)
                        return item["$parent"].items;
                    else
                        return parentItems(item["$parent"]);
                }
            };


        }
    };
}]);
"use strict";
angular.module('app').directive('navconKendoSchedule', ['$timeout',
function ($timeout) {
    return {
        /*E: Directive defined as an element. <navcon-table></navcon-table>
        A: Directive applied as an attribute on existing element. <div navcon-table></div>
        C: Directive applied as a css class to existing element <div class="navcon-table"></div>
        M: Directive applied as comment.*/
        restrict: 'E',
        scope: {
            //@ reads the attribute value, = provides two-way binding, & works with functions
            calendarSetting: '=',
            navconData: '=',
            fields: '=',
            type: '@'
        },
        templateUrl: function () {
            return navcon.Menuroute.getTemplateUrl("navconKendoSchedule");
        },
        link: function (scope, el, attrs) {
            scope.schedulerPage = {};
            scope.schedulerGroup = {};

            scope.current_page = 1;
            scope.objJson = angular.copy(scope.calendarSetting.resources[0].dataSource);
            //scope.objJson = angular.copy(scope.calendarSetting.events);
            scope.records_per_page = angular.copy(scope.calendarSetting.pageLength !== undefined && scope.calendarSetting.pageLength !== "All" ? scope.calendarSetting.pageLength : scope.objJson.length);

            var objResources = angular.copy(scope.calendarSetting.resources);
            //var objResources = angular.copy(scope.calendarSetting.events);

            $timeout(function () {
                var schedulerPage = $($(el).find('.schedulerPage')[0]);
                $(schedulerPage).kendoDropDownList({
                    //dataTextField: "value",
                    //dataValueField: "value",
                    //filter: "contains",
                    //suggest: true,
                    delay: 8000,
                    dataSource: {
                        type: "odata",
                        data: scope.calendarSetting.lengthMenu
                    },
                    index: $.inArray(scope.calendarSetting.pageLength, scope.calendarSetting.lengthMenu),
                    //change: navcon.kendo.schedule.itemPageChange(el, scope, schedulerPage)
                });

                var schedulerMS = $($(el).find('.schedulerMS')[0]);
                schedulerMS.kendoMultiSelect({
                    delay: 1000, // wait 1 second before clearing the user input
                    dataTextField: "text",
                    dataValueField: "value",
                    dataSource: {
                        type: "odata",
                        data: scope.calendarSetting.resources[0].dataSource
                    },
                    //value: [$(scheduler).getKendoScheduler().resources[0].dataSource.at(0).value],
                    //change: navcon.kendo.schedule.multiselectChange(el, scheduler, this.value()),
                });

                if (scope.calendarSetting.views.length !== 0)
                    scope.initFunction();
            });

            scope.$watch('schedulerPage.data', function (newValue, oldValue) {
                if (newValue !== undefined && newValue !== oldValue) {
                    navcon.kendo.schedule.itemPageChange(el, scope, newValue);
                }
            }, true);

            scope.$watch('schedulerGroup.data', function (newValue, oldValue) {
                if (newValue !== undefined && newValue !== oldValue) {
                    var scheduler = $($(el).find('.kendoSchedule')[0]);
                    navcon.kendo.schedule.multiselectChange(el, scope,scheduler, newValue);
                }
            }, true);

            scope.multiselectGroup = function () {
                navcon.kendo.schedule.multiselectGroup(el, scope);
            }
            //scope.$watch('calendarSetting', function (newValue, oldValue) {
            //    if (newValue !== undefined && newValue !== oldValue) {
            //        scope.initFunction();
            //    }
            //}, true);

            scope.$watch('calendarSetting.data', function (newValue, oldValue) {
                if (newValue !== undefined && newValue !== "") {
                    if (newValue.resources !== undefined) scope.calendarSetting.resources = newValue.resources;
                    if (newValue.events !== undefined) scope.calendarSetting.events = newValue.events;
                }
            }, true);

            // calculate number of pages 
            function numPages() {
                return Math.ceil(scope.objJson.length / scope.records_per_page);
            }

            // go to previous page
            scope.prevPage = function () {
                if (scope.current_page > 1) {
                    scope.current_page--;
                    var x = scope.changePage(scope.current_page);

                    objResources[0].dataSource = [];

                    for (var i = 0; i < x.length; i++) {
                        objResources[0].dataSource.push(x[i]);
                    };

                    navcon.kendo.schedule.setting(el, scope.calendarSetting, scope, { resources: objResources });
                }
            }

            // go to next page
            scope.nextPage = function () {
                if (scope.current_page < numPages()) {
                    scope.current_page++;
                    var x = scope.changePage(scope.current_page);

                    objResources[0].dataSource = [];
                    for (var i = 0; i < x.length; i++) {
                        objResources[0].dataSource.push(x[i]);
                    };

                    navcon.kendo.schedule.setting(el, scope.calendarSetting, scope, { resources: objResources });
                }
            }

            // on click either next/prev what happend to change page
            scope.changePage = function (page) {
                var btn_next = $(".btnNext");
                var btn_prev = $(".btnPrev");
                // var listing_table = document.getElementById("listingTable");
                // var page_span = document.getElementById("page");
                // alert(numPages());
                // Validate page
                if (page < 1) page = 1;
                if (page > numPages()) page = numPages();

                // listing_table.innerHTML = "";

                scope.txt2 = [];
                for (var i = (page - 1) * scope.records_per_page; i < (page * scope.records_per_page) ; i++) {
                    // listing_table.innerHTML += scope.objJson[i].text + "<br>";
                    scope.txt2.push(scope.objJson[i]);
                    // alert(scope.objJson[i]);
                }
                // page_span.innerHTML = page;

                if (page == 1) {
                    $(btn_prev).css({ "visibility": "hidden" });
                } else {
                    $(btn_prev).css({ "visibility": "visible" });
                }

                if (page == numPages()) {
                    $(btn_next).css({ "visibility": "hidden" });
                } else {
                    $(btn_next).css({ "visibility": "visible" });
                }
                return scope.txt2;
            }

            scope.initFunction = function () {
                // console.log($scope.schedulerOptions.dataSource.data);
                // kendo.bind(angular.element("#testItems"), testVM);
                var x = scope.changePage(1);

                objResources[0].dataSource = [];


                for (var i = 0; i < x.length; i++) {
                    objResources[0].dataSource.push(x[i]);
                };
                navcon.kendo.schedule.setting(el, scope.calendarSetting, scope, { resources: objResources });

                //$timeout(function () { scope.$apply(); }, 500);
            }
        }
    };
}]);
"use strict";
angular.module('app').directive('navconKendoTable', ['$timeout',
function ($timeout) {
    return {
        /*E: Directive defined as an element. <navcon-table></navcon-table>
        A: Directive applied as an attribute on existing element. <div navcon-table></div>
        C: Directive applied as a css class to existing element <div class="navcon-table"></div>
        M: Directive applied as comment.*/
        restrict: 'E',
        scope: {
            //@ reads the attribute value, = provides two-way binding, & works with functions
            tableSettings: '=',
            navconData: '=',
            fields: '=',
            type: '@'
        },
        templateUrl: function () {
            return navcon.Menuroute.getTemplateUrl("navconKendoTable");
        },
        link: function (scope, el, attrs) {
            //if (scope.tableSettings.columns.length !== 0)
            //    navcon.kendo.table.setting(el, scope.tableSettings, scope);

            scope.$watch('tableSettings.data', function (newValue, oldValue) {
                if (newValue !== undefined && newValue !== oldValue) {
                    if (scope.tableSettings.columns.length !== 0) {
                        //var items = navcon.table.kendo.manageData(scope.tableSettings.columns, scope.tableSettings.data);
                        //navcon.kendo.table.refresh(el, scope.tableSettings, scope);
                        navcon.kendo.table.setting(el, scope.tableSettings, scope);
                    }
                }
            }, true);

            //scope.$watch('tableSettings.columns', function (newValue, oldValue) {
            //    if (newValue !== undefined && newValue !== oldValue) {
            //        if (scope.tableSettings.columns.length !== 0)
            //            navcon.kendo.table.setting(el, scope.tableSettings, scope);
            //    }
            //}, true);            
            
            //$timeout(function () {
            //    el.find(".k-grid-toolbar").insertAfter(el.find(".k-grid-pager").length === 1 ? el.find(".k-grid-pager") : el.find(".k-grid-content"));
            //});
        }
    };
}]);
"use strict";

angular.module('app').directive('navconKendoTemplate', ['dataservice', 'ngAuthSettings', '$timeout', '$compile',
function (dataservice, ngAuthSettings, $timeout, $compile) {
    return {
        /*E: Directive defined as an element. <navcon-table></navcon-table>
        A: Directive applied as an attribute on existing element. <div navcon-table></div>
        C: Directive applied as a css class to existing element <div class="navcon-table"></div>
        M: Directive applied as comment.*/
        restrict: 'E',
        replace: true,
        transclude: 'element',
        scope: {
            //@ reads the attribute value, = provides two-way binding, & works with functions
            navconData: '=',
            headerTitle: '@',
            templateType: '@'
        },
        templateUrl: function () {
            return navcon.Menuroute.getTemplateUrl("navconKendoTemplate");
        },
        link: function (scope, el, attrs, ctrl, transclude) {
            //$(el).attr("id", attrs.templateType + "-editor");
            //$($(el).find("div[type ='text/x-kendo-template']")).attr("id", attrs.templateType + "-editor");

            //var templateData = $($(el).find("script[id ='Approval']")).text();
            //$($(el).find("span[id='Approval']")).html(templateData);
            //$compile($($(el).find("span[id='Approval']")).contents())(scope);

            //var template='<script type="text/x-kendo-template"></script>'
            //$($(el).find("span[id='Approval']")).html(templateData);
            //$compile($($(el).find("span[id='Approval']")).contents())(scope);

            
            /*var data = $($(el).find("div[class ='kendotemplateInclude']")).children().html();
            var template = '<script type="text/x-kendo-template" id="' + attrs.templateType + '-editor">' + data + '</script>';
            //$compile(template)(scope)
            //var template = $($(el).find("script[type='text/x-kendo-template']")).append(data).html();
            //$(el).append($compile(template)(scope));
            $(el).append(template);
            
            $compile($($(el).find("script[id='" + attrs.templateType + "-editor']")).html())(scope);*/

            //var futureParent = element.children().eq(0);
            transclude(function (clone) {
                //var template = '<script type="text/x-kendo-template" id="' + attrs.templateType + '-editor">' + clone + '</script>';
                //el.append(template);

                //el.find("script[type='text/x-kendo-template']").attr("id", attrs.templateType + "-editor");
                
                el.find("script[type='text/html']").append(clone);
                //$compile(el.find("script[type='text/html']").contents())(scope);
            }, el);
        }/*,
        compile: function (el, attrs, transclude) {
            return function (scope, lElem, lAttrs) {
                // do the transclusion.
                transclude(scope, function (clone, innerScope) {
                    //clone is a copy of the transcluded DOM element content.
                    //$(el).attr("id", attrs.templateType + "-editor");
                    //$compile($(el).contents())(scope);

                    //var templateData = clone.html();
                    //$($(el).find("script[type ='text/x-kendo-template']")).attr("id", attrs.templateType + "-editor");
                    //$($(el).find("script[type ='text/x-kendo-template']").find("div[class='kendotemplateInclude']")).html(templateData);
                    //$compile($($(el).find("script[type ='text/x-kendo-template']").find("div[class='kendotemplateInclude']")).contents())(innerScope);


                    var template = '<script type="text/x-kendo-template" id="' + attrs.templateType + '"-editor">' + clone.html() + '</script>';
                    $(el).append($compile(template)(scope));
                    //$(el).append(template);
                    $compile($(el).contents())(scope);

                    console.log("chan");
                });
            }
        }*/
    };
}]);
"use strict";

angular.module('navconMenu').directive('navconMenu', ['$timeout', function($timeout) {
    return {
        scope: {

        },
        transclude: true,
        //templateUrl: 'ext-modules/navconMenu/navconMenuTemplate.html',
        templateUrl: function() {
            return navcon.Menuroute.getTemplateUrl("navconMenu");
        },
        controller: 'navconMenuController',
        link: function(scope, el, attr) {
            var item = el.find('.navcon-selectable-item:first');
            $timeout(function() {
                item.trigger('click');
            });
        }
    };
}]);
"use strict";

angular.module('navconMenu').directive('navconMenuGroup', function() {
    return {
        require: '^navconMenu',
        transclude: true,
        scope: {
            label: '@',
            icon: '@'
        },
        //templateUrl: 'ext-modules/navconMenu/navconMenuGroupTemplate.html',
        templateUrl: function() {
            return navcon.Menuroute.getTemplateUrl("navconMenuGroup");
        },
        link: function(scope, el, attrs, ctrl) {
            scope.isOpen = false;
            scope.closeMenu = function() {
                scope.isOpen = false;
            };
            scope.clicked = function() {
                scope.isOpen = !scope.isOpen;

                if (el.parents('.navcon-subitem-section').length == 0)
                    scope.setSubmenuPosition();

                ctrl.setOpenMenuScope(scope);
            };
            scope.isVertical = function() {
                return ctrl.isVertical() || el.parents('.navcon-subitem-section').length > 0;
            };

            scope.setSubmenuPosition = function() {
                var pos = el.offset();
                $('.navcon-subitem-section').css({ 'left': pos.left + 20, 'top': 36 });
            };
        }
    };
});
"use strict";

angular.module('navconMenu').directive('navconMenuItem', function() {
    return {
        require: '^navconMenu',
        scope: {
            label: '@',
            icon: '@',
            route: '@'
        },
        //templateUrl: 'ext-modules/navconMenu/navconMenuItemTemplate.html',
        templateUrl: function() {
            return navcon.Menuroute.getTemplateUrl("navconMenuItem");
        },
        link: function(scope, el, attr, ctrl) {

            scope.isActive = function() {
                return el === ctrl.getActiveElement();
            };

            scope.isVertical = function() {
                return ctrl.isVertical() || el.parents('.navcon-subitem-section').length > 0;
            }

            el.on('click', function(evt) {
                evt.stopPropagation();
                evt.preventDefault();
                scope.$apply(function() {
                    ctrl.setActiveElement(el);
                    ctrl.setRoute(scope.route);
                });
            });
        }
    };
});
"use strict";

angular.module('app').directive('navconModal', ['dataservice', 'logger',
    function(dataservice, logger) {
        return {
            /*E: Directive defined as an element. <navcon-table></navcon-table>
            A: Directive applied as an attribute on existing element. <div navcon-table></div>
            C: Directive applied as a css class to existing element <div class="navcon-table"></div>
            M: Directive applied as comment.*/
            restrict: 'E',
            replace: true,
            transclude: 'element',
            scope: {
                //@ reads the attribute value, = provides two-way binding, & works with functions
                navconData: '=',
                title: '@',
                icon: '@',
                footer: '@',
                type: '@id',
                size: '@',
                save: '@',
                formValid: '@',
                fieldData: '=',
                cancel: '@',
                overflow: '@'
            },
            //templateUrl: 'ext-modules/navconModal/navconModalTemplate.html',
            templateUrl: function() {
                return navcon.Menuroute.getTemplateUrl("navconModal");
            },
            link: function(scope, el, attrs) {


                scope.fields = {};

                scope.cancel = function(type) {
                    navcon.setViewContentDisabled("");

                    if (scope.navconData !== undefined && scope.navconData.cancel !== undefined)
                        scope.navconData.cancel(type);

                    scope.formReset();
                }

                scope.formReset = function() {
                    if (scope.fieldData === undefined || scope.fieldData.length === undefined) return true;
                    var retVal = true;
                    for (var i = 0, len = scope.fieldData.length; i < len; i++) {
                        if (scope.fieldData[i].form !== undefined) {
                            if (scope.fieldData[i].form.$setPristine !== undefined && typeof scope.fieldData[i].form.$setPristine === "function")
                                scope.fieldData[i].form.$setPristine();

                            if (scope.fieldData[i].form.$setUntouched !== undefined && typeof scope.fieldData[i].form.$setUntouched === "function")
                                scope.fieldData[i].form.$setUntouched();
                        }
                    }
                };


                scope.save = function(type) {
                    if (scope.formValid()) {
                        scope.navconData.save(type);
                        var msg = "Entries are saved successfully...";
                        if (scope.navconData !== undefined && scope.navconData.mode !== undefined && scope.navconData.mode === "Update")
                            msg = "Entries are updated successfully...";

                        if (scope.navconData !== undefined && scope.navconData.mode !== undefined && scope.navconData.mode !== "Delete")
                            logger.success(msg, "", "");
                    } else {
                        logger.warning("Invalid entries...", "", "");
                    }
                };

                scope.formValid = function() {
                    if (scope.fieldData === undefined || scope.fieldData.length === undefined) return true;
                    var retVal = true;
                    for (var i = 0, len = scope.fieldData.length; i < len; i++) {
                        if (scope.fieldData[i].valid !== undefined && scope.fieldData[i].valid === false) {
                            return false;
                            break;
                        }
                    }
                    return retVal;
                };

                $(el).draggable({
                    handle: ".content",
                    cancel: ".modal-body"
                });

                $(el).addClass(scope.size);

                $(el).on('shown.bs.modal', function(event) {
                    if (scope.overflow !== undefined && scope.overflow === 'hide') {
                        $($(event.target).find('div')[0]).css("overflow", "hidden");
                    }
                    //$($(event.target).find("div[type='calendar']")).fullCalendar('render');
                });
            }
        };
    }
]);
"use strict";

angular.module('app').directive('navconPagebar', [
    function(dataService) {
        return {
            /*E: Directive defined as an element. <navcon-table></navcon-table>
            A: Directive applied as an attribute on existing element. <div navcon-table></div>
            C: Directive applied as a css class to existing element <div class="navcon-table"></div>
            M: Directive applied as comment.*/
            restrict: 'E',
            scope: {
                //@ reads the attribute value, = provides two-way binding, & works with functions
                breadcrumbs: '='
            },
            //templateUrl: 'ext-modules/navconPagebar/navconPagebarTemplate.html',
            templateUrl: function() {
                return navcon.Menuroute.getTemplateUrl("navconPagebar");
            },
            link: function(scope, el, attrs) {
                //console.log(scope);    
            }
        };
    }
]);
"use strict";
angular.module('app').directive('navconRating', ['dataservice', 'appInfo', 'photoManager', 'logger', 'ngAuthSettings',
    function(dataservice, appInfo, photoManager, logger, ngAuthSettings) {
        return {
            /*E: Directive defined as an element. <navcon-table></navcon-table>
            A: Directive applied as an attribute on existing element. <div navcon-table></div>
            C: Directive applied as a css class to existing element <div class="navcon-table"></div>
            M: Directive applied as comment.*/
            restrict: 'E',
            scope: {
                ngRating: '=',
                maxRating: '=',
                readOnly: '='
            },
            //templateUrl: 'ext-modules/navconRating/navconRatingTemplate.html',
            templateUrl: function() {
                return navcon.Menuroute.getTemplateUrl("navconRating");
            },
            link: function(scope, el, attrs) {

                scope.maxRatings = [];
                if (scope.maxRating === undefined) scope.maxRating = 5;
                if (scope.ngRating === undefined) scope.ngRating = 0;
                for (var i = 1; i <= scope.maxRating; i++) {
                    scope.maxRatings.push({});
                };

                scope._rating = scope.ngRating;


                scope.click = function(param) {
                    if (scope.readOnly || scope.readOnly == 'true') return;
                    scope.ngRating = scope._rating = param;
                    scope.hoverValue = 0;
                };

                scope.mouseHover = function(param) {
                    if (scope.readOnly || scope.readOnly == 'true') return;

                    scope._rating = 0;
                    scope.hoverValue = param;
                };

                scope.mouseLeave = function(param) {
                    if (scope.readOnly || scope.readOnly == 'true') return;

                    scope._rating = scope.ngRating;
                    scope.hoverValue = 0;
                };
            }
        };
    }
]);
"use strict";

angular.module('app').directive('navconPopover', ['dataservice', '$compile', 'logger', '$rootScope', '$timeout',
function (dataservice, $compile, logger, $rootScope, $timeout) {
    return {
        /*E: Directive defined as an element. <navcon-table></navcon-table>
        A: Directive applied as an attribute on existing element. <div navcon-table></div>
        C: Directive applied as a css class to existing element <div class="navcon-table"></div>
        M: Directive applied as comment.*/
        restrict: 'A',
        transclude: true,
        scope: {
            //@ reads the attribute value, = provides two-way binding, & works with functions
            widgetId: '=',
            title: '@',
            templateSettings: '=',
            reportData: '=',
            defaultReport: '='
        },
        template: '<span ng-transclude></span>',
        link: function (scope, element, attrs) {
            //scope.selectedReport = scope.defaultReport;

            element.bind('focus', function (e) {
                var popupId = $(element).attr("aria-describedby");
                $('#' + popupId).css('left', '-251px');
                $('#' + popupId).find(".arrow").css('left', '95%');
                $('#' + popupId).show();
            });

            scope.items = [];
            scope.$watch('reportData', function (newValue, oldValue) {
                if (newValue !== undefined && newValue !== oldValue && newValue.length !== 0) {
                    scope.items = newValue;

                    if (scope.defaultReport == undefined || scope.defaultReport == null || scope.defaultReport === -1) {
                        scope.selectedReport = scope.items[0];
                    } else {
                        scope.selectedReport = scope.defaultReport;
                    }
                }
            }, true);

            var popOverContent;

            scope.$watch('templateSettings', function (newValue, oldValue) {
                if (newValue !== undefined) {

                    if (scope.items) {
                        var html = newValue.templateHtml;
                        popOverContent = $compile(html)(scope);
                    }
                    newValue.content = popOverContent;
                    $(element).popover(newValue);
                }
            });

            scope.$watch('selectedReport', function (newValue, oldValue) {
                if (newValue !== undefined && oldValue !== undefined && newValue.length !== 0 && newValue !== oldValue) {
                    $rootScope.$broadcast('POPOVER-WIDGET-SETTING', scope, angular.fromJson(newValue), function () { });

                    var attr = $(element).attr('aria-describedby');
                    if (typeof attr !== typeof undefined && attr !== "") {
                        $(element).popover("hide");
                    }
                }
            });
        }
    };
}]);
"use strict";
angular.module('app').directive('navconReadmore', ['dataservice', '$compile', 'logger', '$rootScope',
function (dataservice, $compile, logger, $rootScope) {
    return {
        restrict: 'A',
        transclude: true,
        replace: false,
        template: '<p></p>',
        scope: {
            moreText: '@',
            lessText: '@',
            words: '@',
            ellipsis: '@',
            char: '@',
            limit: '@',
            content: '@'
        },
        link: function (scope, elem, attr, ctrl, transclude) {
            var moreText = angular.isUndefined(scope.moreText) ? ' <a class="read-more">Read More...</a>' : ' <a class="read-more">' + scope.moreText + '</a>',
                lessText = angular.isUndefined(scope.lessText) ? ' <a class="read-less">Less ^</a>' : ' <a class="read-less">' + scope.lessText + '</a>',
                ellipsis = angular.isUndefined(scope.ellipsis) ? '' : scope.ellipsis,
                limit = angular.isUndefined(scope.limit) ? 150 : scope.limit;

            attr.$observe('content', function (str) {
                readmore(str);
            });

            /*transclude(scope.$parent, function (clone, scope) {
                readmore(clone.text().trim());
            });*/

            function readmore(text) {
                var text = text,
                  orig = text,
                  regex = /\s+/gi,
                  charCount = text.length,
                  wordCount = text.trim().replace(regex, ' ').split(' ').length,
                  countBy = 'char',
                  count = charCount,
                  foundWords = [],
                  markup = text,
                  more = '';

                if (!angular.isUndefined(attr.words)) {
                    countBy = 'words';
                    count = wordCount;
                }

                if (countBy === 'words') { // Count words

                    foundWords = text.split(/\s+/);

                    if (foundWords.length > limit) {
                        text = foundWords.slice(0, limit).join(' ') + ellipsis;
                        more = foundWords.slice(limit, count).join(' ');
                        markup = text + moreText + '<span class="more-text">' + more + lessText + '</span>';
                    }

                } else { // Count characters

                    if (count > limit) {
                        text = orig.slice(0, limit) + ellipsis;
                        more = orig.slice(limit, count);
                        markup = text + moreText + '<span class="more-text">' + more + lessText + '</span>';
                    }

                }

                elem.append(markup);
                elem.find('.read-more').on('click', function () {
                    $(this).hide();
                    elem.find('.more-text').addClass('show').slideDown();
                });
                elem.find('.read-less').on('click', function () {
                    elem.find('.read-more').show();
                    elem.find('.more-text').hide().removeClass('show');
                });

            }
        }
    };
}]);
"use strict";

angular.module('app').directive('navconPortlet', [
    function(dataService) {
        return {
            /*E: Directive defined as an element. <navcon-table></navcon-table>
            A: Directive applied as an attribute on existing element. <div navcon-table></div>
            C: Directive applied as a css class to existing element <div class="navcon-table"></div>
            M: Directive applied as comment.*/
            restrict: 'E',
            replace: true,
            transclude: 'element',
            scope: {
                //@ reads the attribute value, = provides two-way binding, & works with functions
                title: '@',
                class: '@',
                navconData: '=',
                toolsDisp: '@',
                icon: '@',
                toolCollapse: '=',
                refresh: '@',
                isTitle: '@',
                subTitle: '@',
                showCaption: '@'
            },
            //templateUrl: 'ext-modules/navconPortlet/navconPortletTemplate.html',
            templateUrl: function() {
                return navcon.Menuroute.getTemplateUrl("navconPortlet");
            },
            link: function(scope, el, attrs) {
                if (scope.showCaption === undefined || scope.showCaption === "") scope.showCaption = 'false';

                if (scope.isTitle === undefined) scope.isTitle = 'true';

                if (scope.toolCollapse !== undefined && scope.toolCollapse === true) {
                    $(el).find(".portlet-body").first().css("display", "none");
                } else {
                    $(el).find(".portlet-body").first().css("display", "block");
                }

                scope.refresh = function(event) {
                    var tableType = $(event.srcElement).parents(".portlet:first").find("table:first").parents('navcon-table:first').attr("type");
                    if (tableType !== undefined && scope.navconData.tableRefresh !== undefined) {
                        scope.navconData.tableRefresh(tableType);
                    }

                    var treeType = $(event.srcElement).parents(".portlet:first").find("div[type='tree']:first").parents('navcon-tree:first').attr("type");

                    if (treeType !== undefined && scope.navconData.treeRefresh !== undefined) {
                        scope.navconData.treeRefresh(treeType);
                    }


                }
                scope.print = function() {
                    if (scope.navconData.print !== undefined)
                        scope.navconData.print();
                }
            }
        };
    }
]);
"use strict";
angular.module('app').directive('navconReport', ['dataservice', 'utilities', '$compile', '$window', '$timeout',
    function(dataservice, utilities, $compile, $window, $timeout) {
        return {
            /*E: Directive defined as an element. <navcon-table></navcon-table>
            A: Directive applied as an attribute on existing element. <div navcon-table></div>
            C: Directive applied as a css class to existing element <div class="navcon-table"></div>
            M: Directive applied as comment.*/
            restrict: 'E',
            scope: {
                //@ reads the attribute value, = provides two-way binding, & works with functions
                navconData: '=',
                reportSource: '=',
                reportTitle: '=',
                reportId: '@',
                page: '@',
                export: '@',
                reportSetting: '='
            },
            //templateUrl: 'ext-modules/navconReport/navconReportTemplate.html',
            templateUrl: function() {
                return navcon.Menuroute.getTemplateUrl("navconReport");
            },
            link: function(scope, el, attrs) {
                if (scope.reportId === undefined || scope.reportId === null || scope.reportId === "") scope.reportId = "model";
                if (scope.page === undefined || scope.page === null || scope.page === "") scope.page = "no";
                //$(el).find("navcon-modal").attr("id", "reports_" + attrs.type);

                if (scope.export === undefined)
                    scope.export = "false";


                /*scope.$watch('reportSetting.export', function (newValue, oldValue) {
                    if (newValue != undefined && newValue !== "") {
                        scope.export = newValue;
                    }
                }, true);*/


                //el.html('<navcon-modal navcon-data="vm" field-data="" title="" icon="fa fa-flask" footer="" id="reports_' + scope.reportId + '"><div><iframe style="border: transparent;"></iframe></div></navcon-modal>');
                //$compile(el.contents())(scope);

                scope.$watch('reportSource', function(newValue, oldValue) {
                    if (newValue != undefined && newValue !== "") {
                        var frame = el.find('iframe');
                        frame.attr('src', newValue);
                        resizeHtmlDialog(el);
                        navcon.openModal("reports_" + scope.reportId);
                    }
                });


                var resizeHtmlDialog = function(element) {
                    var height = angular.element($window).height() * 0.8;
                    var width = angular.element($window).width() * 0.8;
                    $(el).find('.modal-dialog').css('width', width.toString() + 'px');
                    $(el).find('.modal-dialog').css('height', height.toString() + 'px');
                    var dialog = angular.element('#globalMessageDialog .modal-dialog');
                    var margin = (angular.element($window).height() - dialog.height()) / 2 - parseInt(dialog.css('padding-top'));
                    console.log(margin);
                    var frame = el.find('iframe');
                    if (frame.length) {
                        frame.attr("width", "98%");
                        frame.attr("height", height /* - 100 - parseInt(angular.element('.modal-dialog').css('margin-top')) / 2*/ );

                        $timeout(function() {
                            $(frame[0].contentWindow.document).ready(function() {
                                $(frame[0]).contents().find('head').append('<link href="../Content/navcon-style.css" rel="stylesheet" type="text/css" />');
                            });
                        }, 1200)
                    }
                };

                scope.closeReport = function() {
                    navcon.closeModal("reports_" + scope.reportId);
                };
                scope.cancel = function() {
                    navcon.closeModal("reports_" + scope.reportId);
                }


            }
        };
    }
]);
"use strict";
angular.module('app').directive('navconReportPage', ['dataservice', 'utilities', '$compile', '$window', 'authService', 'ngAuthSettings', '$timeout',
    function(dataservice, utilities, $compile, $window, authService, ngAuthSettings, $timeout) {
        return {
            /*E: Directive defined as an element. <navcon-table></navcon-table>
            A: Directive applied as an attribute on existing element. <div navcon-table></div>
            C: Directive applied as a css class to existing element <div class="navcon-table"></div>
            M: Directive applied as comment.*/
            restrict: 'E',
            scope: {
                //@ reads the attribute value, = provides two-way binding, & works with functions
                navconData: '=',
                reportCategory: '@'
            },
            //templateUrl: 'ext-modules/navconReport/navconReportPageTemplate.html',
            templateUrl: function() {
                return navcon.Menuroute.getTemplateUrl("navconReportPage");
            },
            link: function(scope, el, attrs) {
                var reportBase = ngAuthSettings.reportBaseUri;
                var defaultImage = "report-preview.png";
                var noRecordImage = "report-preview.png";

                scope.userId = authService.authentication.userId;

                function loadFavorites() {
                    scope.favorites = [];
                    dataservice.getData(scope.reportCategory + "/GetAllReportFavorites/" + scope.userId.toString()).then(function(data) {
                        scope.favorites = data;
                    });
                }

                dataservice.getData(scope.reportCategory + "/GetAllReports").then(function(data) {
                    scope.reports = data;
                });

                scope.favorites = [];
                scope.isSplit = false;
                scope.report = {};
                scope.report.previewImage = reportBase + defaultImage;

                loadFavorites();

                scope.expandCollapse = function(id1, id2, id3) {
                    $timeout(function() {
                        if ($('#' + id1).hasClass("collapsed") && !$('#' + id3).hasClass("in")) {
                            $('#' + id2).addClass("collapsed")
                        } else {
                            $('#' + id2).removeClass("collapsed")
                        }
                    }, 430);
                };

                scope.generate = function() {
                    scope.report.reportFrom = "report";
                    navcon.callPrint(scope.report, scope.rportId, function() {});
                    $('#reportpreview').hide();
                    $('#reportgenerate').show();
                };

                scope.returntoreport = function() {
                    $('#reportpreview').show();
                    $('#reportgenerate').hide();

                };

                scope.compare = function() {
                    if (scope.isSplit)
                        scope.isSplit = false;
                    else
                        scope.isSplit = true;
                }

                $("#myFav ul").children().each(function() {
                    $(this).removeClass('highlight');
                });

                $("#allReports ul").children().each(function() {
                    $(this).removeClass('highlight');
                });


                scope.favoriteClick = function(event) {
                    $(event.currentTarget).toggleClass("glyphicon-star glyphicon-star-empty");
                    if ($(event.currentTarget).hasClass('glyphicon-star-empty'))
                        scope.isFavorite = false;
                    else
                        scope.isFavorite = true;
                    favoriteSave();
                }


                function favoriteSave() {

                    var findObj = navcon.getItemByKeyValue(scope.favorites, "ReportDetailId", scope.rportId);


                    var objectState = 1;
                    var reportFavoriteId = 0;

                    if (findObj !== -1) {
                        objectState = 3;
                        reportFavoriteId = findObj["ReportFavoriteId"];
                    }

                    var saveObj = {
                        "ReportFavoriteId": reportFavoriteId,
                        "ReportCategoryId": scope.reportCategoryId,
                        "ReportDetailId": scope.rportId,
                        "UserId": scope.userId,
                        "ObjectState": objectState
                    };

                    if (objectState == 1) {
                        dataservice.postServerData("", saveObj, false, '', scope.reportCategory + "/CreateReportFavorites/").then(function(data) {
                            loadFavorites();
                        })
                    } else {
                        dataservice.putData("", saveObj, scope.reportCategory + "/UpdateReportFavorites/").then(function(data) {
                            loadFavorites();
                        })
                    }

                }


                scope.reportClick = function(event, report) {

                    var findIndex = navcon.getItemIndexByKeyValue(scope.favorites, "ReportDetailId", report.ReportDetailId);
                    if (findIndex !== -1)
                        scope.isFavorite = true
                    else
                        scope.isFavorite = false;

                    $("#myFav ul").children().each(function() {
                        $(this).removeClass('highlight');
                    });

                    $("#allReports ul").children().each(function() {
                        $(this).removeClass('highlight');
                    });

                    $(event.currentTarget).addClass('highlight');
                    scope.report.export = "false";
                    scope.report.title = report.ReportName;
                    scope.rportId = report.ReportDetailId;
                    scope.reportCategoryId = report.ReportCategoryId;
                    scope.report.source = "";
                    //scope.report.previewImage = "";

                    if (report.PageView !== undefined && report.PageView !== null && report.PageView !== "")
                        scope.report.previewImage = reportBase + report.PageView;
                    else
                        scope.report.previewImage = reportBase + noRecordImage;
                };
            }
        };
    }
]);
"use strict";
angular.module('app').directive('navconTable', ['dataservice', '$timeout',
    function(dataservice, $timeout) {
        return {
            /*E: Directive defined as an element. <navcon-table></navcon-table>
            A: Directive applied as an attribute on existing element. <div navcon-table></div>
            C: Directive applied as a css class to existing element <div class="navcon-table"></div>
            M: Directive applied as comment.*/
            restrict: 'E',
            scope: {
                //@ reads the attribute value, = provides two-way binding, & works with functions
                tableSettings: '=',
                navconData: '=',
                type: '@',
                readOnly: '=',
                cssClass: '@'
            },
            //templateUrl: 'ext-modules/navconTable/navconTableTemplate.html',
            templateUrl: function() {
                return navcon.Menuroute.getTemplateUrl("navconTable");
            },
            link: function(scope, el, attrs) {
                if (scope.cssClass == undefined) {
                    scope.cssClass = "";
                }
                if (scope.tableSettings.columns.length !== 0)
                    navcon.setTableSetting(el, scope.tableSettings, scope);
                scope.$watch('tableSettings.data', function(newValue, oldValue) {
                    if (newValue !== undefined && newValue !== oldValue) {
                        if (scope.tableSettings.columns.length !== 0) {
                            var items = tableManageData(scope.tableSettings.columns, scope.tableSettings.data);
                            navcon.tableRefresh(el, scope.tableSettings, scope);
                            if (scope.readOnly !== undefined && scope.tableSettings.data.length > 0) {
                                $timeout(function() {
                                    hideShowColumnInReadonly(scope.readOnly, el);
                                }, 250)
                            }
                        }
                    }
                }, true)

                scope.$watch("readOnly", function(newValue, oldValue) {
                    if (newValue !== undefined && scope.tableSettings.data.length > 0) {
                        $timeout(function() {
                            hideShowColumnInReadonly(newValue, el);
                        }, 250)
                    }
                }, true);

                scope.$watch("$parent.readOnly", function(newValue, oldValue) {
                    if (newValue !== undefined) {
                        $('.table.dataTable thead .sorting').css("background-image", "");
                        if (newValue)
                            $('.table.dataTable thead .sorting').css("background-image", "none")
                    }
                }, true);


                function hideShowColumnInReadonly(value, el) {
                    var columnNames = ['Add', 'Edit', 'Delete'];
                    for (var i = 0, len = columnNames.length; i < len; i++) {
                        var header = columnNames[i];
                        var colIndex = $(el).find("th:contains('" + header + "')").index() + 1;
                        if (value)
                            $(el).find("td:nth-child(" + colIndex.toString() + "),th:nth-child(" + colIndex.toString() + ")").hide();
                        else
                            $(el).find("td:nth-child(" + colIndex.toString() + "),th:nth-child(" + colIndex.toString() + ")").show();
                    }
                }

                function tableManageData(columns, items) {

                    for (var index in items) {
                        var item = items[index];
                        for (var p in item) {
                            if (item.hasOwnProperty(p)) {
                                var propVal = item[p];
                                var options = getColumnOptions(columns, p);
                                if (options !== -1) {
                                    if (options.type !== undefined) {
                                        var retVal = navcon.insertControl(options.type, propVal);
                                        item[p] = retVal;
                                    }
                                }
                            }
                        }
                    }

                    function getColumnOptions(columns, prop) {
                        for (index in columns) {
                            var col = columns[index];
                            if (col.data !== undefined) {
                                if (col.data === prop) {
                                    return col.options || -1;
                                }
                            }
                        }
                        return -1;
                    }

                    return items;
                }

            }
        };
    }
]);
"use strict";
angular.module('app').directive('navconTableEditor', ['dataservice', '$compile', '$window',
    function(dataservice, $compile, $window) {
        return {
            /*E: Directive defined as an element. <navcon-table></navcon-table>
            A: Directive applied as an attribute on existing element. <div navcon-table></div>
            C: Directive applied as a css class to existing element <div class="navcon-table"></div>
            M: Directive applied as comment.*/
            restrict: 'E',
            scope: {
                //@ reads the attribute value, = provides two-way binding, & works with functions
                navconData: '=',
                settings: '=',
                data: '=',
                showDel: '=',
                showAdd: '=',
                showUpdate: '=',
                showoverAllsave: '=',
                showItar: '=',
                showSlno: '=',
                saveButtontext: '='
            },
            //templateUrl: 'ext-modules/navconTableEditor/navconTableEditorTemplate.html',
            templateUrl: function() {
                return navcon.Menuroute.getTemplateUrl("navconTableEditor");
            },
            link: function(scope, el, attrs) {
                if (scope.showSlno === undefined || scope.showSlno === null) scope.showSlno = true;
                scope.row = 1;
                scope.readOnly = false;
                if (scope.navconData != undefined) {
                    if (scope.navconData.readOnly != undefined) {

                        scope.$watch("navconData.readOnly", function(newvalue, oldvalue) {
                            scope.readOnly = newvalue;
                        });

                        scope.readOnly = scope.navconData.readOnly;
                    } else {
                        if (scope.navconData.readonly != undefined) {

                            scope.$watch("navconData.readonly", function(newvalue, oldvalue) {
                                scope.readOnly = newvalue;
                            });
                            scope.readOnly = scope.navconData.readonly;
                        } else {
                            scope.readOnly = false;
                        }
                    }

                }

                if (scope.showDel === undefined)
                    scope.showDel = true;

                if (scope.showAdd === undefined)
                    scope.showAdd = true;

                if (scope.showUpdate === undefined)
                    scope.showUpdate = false;
                if (scope.showoverAllsave === undefined)
                    scope.showoverAllsave = false;
                if (scope.showItar === undefined)
                    scope.showItar = false;
                if (scope.saveButtontext === undefined)
                    scope.saveButtontext = "";

                scope.$watch('settings.fields', function(newValue, oldValue) {

                });

                //scope.$watch('settings.data', function (newValue, oldValue) {
                //    if (newValue !== undefined && newValue !== null && newValue !== "" && newValue.length !== 0) {
                //        scope.data = [];
                //        var obj = {};

                //        obj.fields = angular.copy(scope.settings.fields);

                //        $.map(obj.fields, function (item, index) {
                //            if (newValue[item.key] !== undefined) {
                //                item.data = newValue[item.key];
                //            }
                //        })

                //        obj.fields.sno = 1;

                //        scope.data.push(obj);
                //    }
                //},false);

                var loadExistingData = function() {
                    var row = 1;
                    $.map(scope.settings.data, function(dataItem, index) {
                        var obj = {};
                        obj.fields = angular.copy(scope.settings.fields);

                        $.map(obj.fields, function(item, index) {
                            if (dataItem[item.key] !== undefined) {
                                item.data = dataItem[item.key];
                            }
                        })
                        obj.fields.sno = scope.data.length + 1;
                        scope.data.push(obj);
                        row++;

                    })

                };

                /*Cancel*/
                scope.cancel = function(type) {};

                scope.closeReport = function() {};

                scope.getFieldsData = function(data) {
                    var obj = {};
                    $.map(scope.settings.fields, function(item, index) {
                        if (data[item.key] !== undefined) {
                            item.data = data[item.key];
                        }
                    })
                    return scope.settings.fields;
                }

                scope.assignSno = function() {
                    var sno = 1;
                    $.map(scope.data, function(item, index) {
                        item.fields.sno = sno;
                        sno++;
                    })
                };
                scope.action = {};
                scope.action.addNew = function() {
                    var obj = {};
                    obj.fields = angular.copy(scope.settings.fields);
                    obj.fields.sno = (scope.data.length + 1);
                    scope.data.push(obj);
                    scope.row++;
                    $('[data-toggle="tooltip"]').tooltip();
                };

                scope.action.clear = function() {
                    scope.data = [];
                }

                scope.delete = function(index) {
                    if (scope.data.length > 1) {
                        scope.data.splice(index, 1);
                        scope.assignSno();

                        if (scope.settings.templateOptions !== undefined && scope.settings.templateOptions.type !== undefined && scope.navconData.$parent.tableRowDelete !== undefined)
                            scope.navconData.$parent.tableRowDelete(scope.settings.templateOptions.type);
                    }
                }

                loadExistingData();
                if (scope.data.length < 1)
                    scope.action.addNew();

                if (scope.settings.tableAction !== undefined)
                    scope.settings.tableAction = scope.action;

                scope.save = function(index) {
                    if (scope.settings.templateOptions !== undefined && scope.settings.templateOptions.type !== undefined && scope.navconData.$parent.save !== undefined && scope.navconData.$parent.formManage !== undefined)
                        scope.navconData.$parent.formManage.save(scope.settings.templateOptions.type);

                    //if (scope.formValid()) {
                    //    if (scope.settings.templateOptions !== undefined && scope.settings.templateOptions.type !== undefined && scope.navconData.$parent.save !== undefined)
                    //        scope.navconData.$parent.save(scope.settings.templateOptions.type);
                    //}
                }

                scope.formValid = function() {
                    scope.validate = true;
                    scope.items = scope.settings.fields;

                    if (scope.items === undefined || scope.items.length === undefined || !scope.validate) return true;
                    var retVal = true;
                    for (var i = 0, len = scope.items.length; i < len; i++) {
                        if (scope.items[i].type !== undefined && scope.items[i].type === "tableeditor") continue;
                        if (scope.items[i].form !== undefined && typeof scope.items[i].form === "object") {
                            if (scope.items[i].form.$invalid && !scope.items[i].valid) {
                                scope.items[i].setFocus = false;
                                angular.forEach(scope.items[i].form.$error, function(field) {
                                    angular.forEach(field, function(errorField) {
                                        if (errorField.$name === "form") {} else {
                                            errorField.$setTouched();
                                        }
                                    })
                                });
                                retVal = false;
                                if (scope.items[i].showMessage !== undefined) {
                                    scope.items[i].showMessage = true;
                                    setTimeout(function(n) {
                                        if (scope.items[n].showMessage !== undefined)
                                            scope.items[n].showMessage = false;
                                    }, 6000, i);
                                }
                            }
                        }
                    }
                    return retVal;
                };

            }
        };
    }
]);
"use strict";
angular.module('app').directive('navconTree', ['dataservice', '$timeout',
    function(dataservice, $timeout) {
        return {
            /*E: Directive defined as an element. <navcon-table></navcon-table>
            A: Directive applied as an attribute on existing element. <div navcon-table></div>
            C: Directive applied as a css class to existing element <div class="navcon-table"></div>
            M: Directive applied as comment.*/
            restrict: 'E',
            scope: {
                //@ reads the attribute value, = provides two-way binding, & works with functions
                treeSettings: '=',
                navconData: '=',
                type: '@',
                fieldSet: '@',
                isExpand: '@'
            },
            //templateUrl: 'ext-modules/navconTree/navconTreeTemplate.html',
            templateUrl: function() {
                return navcon.Menuroute.getTemplateUrl("navconTree");
            },
            link: function(scope, el, attrs) {
                var objEl = $(el);
                var tree = objEl.find('div[type="tree"]').first();
                if (scope.isExpand === undefined) {
                    scope.isExpand = false;
                }
                scope.typeText = 'Collapsed'

                scope.$watch('treeSettings', function(newValue, oldValue) {
                    if (newValue !== undefined && newValue !== "") {
                        var keyIndex = navcon.getItemIndexByProperty(scope.navconData[scope.fieldSet], scope.type);
                        navcon.setTreeSetting(el, scope.treeSettings, scope, scope.navconData[scope.fieldSet][keyIndex], scope.isExpand);
                        scope.$watch('treeSettings.core.data', function(newValue, oldValue) {
                            if (newValue !== undefined && newValue !== "" && newValue.length > 0) {
                                if (newValue !== oldValue) {
                                    var treeType = scope.type;
                                    if (scope.treeSettings.core.treeType !== undefined && scope.treeSettings.core.treeType !== "")
                                        treeType = scope.treeSettings.core.treeType;

                                    navcon.treeDataRefresh(newValue, treeType, function(data) {
                                        /*if(scope.$applay === undefined) return;
                                         scope.$applay(function(){
                                           scope.isExpand = false; 
                                        }); */
                                    });
                                }
                            }
                        })
                    }
                }, true)

                scope.$watch('isExpand', function(newValue, oldValue) {
                    var objEl = $(el);
                    var tree = objEl.find('div[type="tree"]').first();
                    if (newValue !== undefined && newValue !== "") {
                        var search = objEl.find('#tree_filter').first().find('input');
                        search.val("");
                        search.keyup();
                        if (newValue === true || newValue === "true") {
                            tree.jstree('open_all');
                            scope.typeText = 'Expanded';
                            scope.isExpand = true;
                        } else {
                            tree.jstree('close_all');
                            scope.typeText = 'Collapsed';
                            scope.isExpand = false;
                        }

                    }
                }, true);

                var treeSearch = function(el) {
                    var to = false;
                    var search = objEl.find('#tree_filter').first().find('input');

                    search.click(function(el) {
                        var collapse = $($(el.target).parents('.portlet').first().find('input[type="checkbox"]'));
                        if (collapse.attr("checked") === undefined) {
                            tree.jstree('open_all');
                            $timeout(function() {
                                scope.$apply(function() {
                                    scope.typeText = 'Expanded';
                                    scope.isExpand = true;
                                });
                            });
                        }
                    });

                    search.keyup(function(el) {
                        if (to) { clearTimeout(to); }
                        to = setTimeout(function(el) {
                            var treeObj = $(el).parent().parent().parent().next();
                            var v = search.val();
                            tree.jstree(true).search(v);

                            //hide/show grid values for nodes affected by searching
                            var hidden = treeObj.find('ul li:hidden');
                            var visible = treeObj.find('ul li:visible');

                            $.each(hidden, function(i) {
                                if (!checkId(visible, hidden[i].id))
                                    treeObj.find('div[id*=' + hidden[i].id + ']').hide();
                            });

                            var finalVisible = treeObj.find('ul li:visible');
                            $.each(finalVisible, function(i) {
                                treeObj.find('div[id^=jsgrid_' + visible[i].id + '_col]').show();
                            });

                        }, 500, this);
                    });
                }

                var checkId = function(visible, id) {
                    for (var i = 0, len = visible.length; i < len; i++) {
                        var item = visible[i];
                        if (item.id === id) return true;
                    }
                    return false;
                }

                treeSearch(el);
            }
        };
    }
]);


var manageData = function(columns, items) {
    for (var i = 0, len = items.length; i < len; i++) {
        var item = items[i];
        if (item.data !== undefined) {
            for (var p in item.data) {
                if (item.data.hasOwnProperty(p)) {
                    var propVal = item.data[p];
                    var options = getColumnOptions(columns, p);
                    if (options !== -1) {
                        if (options.type !== undefined) {
                            var retVal = navcon.insertControl(options.type, propVal);
                            item.data[p] = retVal;
                        }
                    }
                }
            }
            if (item.children !== undefined && item.children.length > 0) {
                var found = manageData(columns, item.children);
            }
        }
    }

    function getColumnOptions(columns, prop) {
        for (var index in columns) {
            var col = columns[index];
            if (col.value !== undefined) {
                if (col.value === prop) {
                    return col.options || -1;
                }
            }
        }
        return -1;
    }

    return items;
};
"use strict";
angular.module('app').directive('navconFileUpload', ['dataservice', 'appInfo', 'photoManager', 'logger', 'ngAuthSettings', '$timeout',
    function(dataservice, appInfo, photoManager, logger, ngAuthSettings, $timeout) {
        return {
            /*E: Directive defined as an element. <navcon-table></navcon-table>
            A: Directive applied as an attribute on existing element. <div navcon-table></div>
            C: Directive applied as a css class to existing element <div class="navcon-table"></div>
            M: Directive applied as comment.*/
            restrict: 'E',
            scope: {
                myFiles: '=',
                mode: '=',
                type: '=',
                keyData: '=',
                keyName: '=',
                keyReturn: '=',
                multipleFile: '=',
                photoChangeable: '=',
                agreeText: '=',
                fileSize: '=',
                fileType: '=',
                sameFile: '=',
                showOnly: '='
            },
            //templateUrl: 'ext-modules/navconUpload/navconFileUploadTemplate.html',
            templateUrl: function() {
                return navcon.Menuroute.getTemplateUrl("navconFileUpload");
            },
            link: function(scope, el, attrs) {
                scope.title = "test";
                scope.hasFiles = false;
                scope.photos = [];
                scope.upload = photoManager.upload;
                scope.appStatus = appInfo.status;
                scope.photoManagerStatus = photoManager.status;
                scope.isAgree = "no";
                scope.readonly = scope.$parent.readOnly != undefined ? scope.$parent.readOnly : (scope.$parent.readonly != undefined ? scope.$parent.readonly : false);

                scope.$watch("$parent.readOnly", function(newValue, oldValue) {
                    if (newValue != undefined) {
                        scope.readonly = newValue;
                        /*if(scope.readonly)
                            scope.showOnly = true;
                        else
                            scope.showOnly = false;*/
                    }
                });

                scope.$watch("$parent.readonly", function(newValue, oldValue) {
                    if (newValue != undefined)
                        scope.readonly = newValue;
                });

                scope.$watch("showOnly", function(newValue, oldValue) {
                    if (newValue != undefined)
                        scope.readonly = newValue;
                });

                if (scope.fileSize === undefined)
                    scope.fileSize = 0;

                if (scope.fileType === undefined)
                    scope.fileType = [];

                if (scope.sameFile === undefined)
                    scope.sameFile = false;

                if (scope.showOnly === undefined)
                    scope.showOnly = false;

                /*if (scope.agreeText !== undefined && scope.agreeText !== "")
                    scope.isAgreeVisible = true;
                else {
                    scope.isAgreeVisible = false;
                    scope.isAgree = "yes";
                }*/
                scope.$watch("agreeText", function(newValue, oldValue) {
                    if (newValue !== undefined && newValue !== "")
                        scope.isAgreeVisible = true;
                    else {
                        scope.isAgreeVisible = false;
                        scope.isAgree = "yes";
                    }
                });

                scope.remove = function(file) {
                    if (file.status === undefined || file.status === '') {
                        removeFile(file);
                        dataservice.fileDelete("download/Delete", file.id).then(function(status) {
                            removeFile(file);
                            logger.success("File(" + file.name + ") is removed successfully...", "", "");
                        });
                    } else {
                        removeFile(file);
                    }
                };

                scope.cancel = function(file) {
                    var retValue = "Cancel";
                    if (file.status === undefined || file.status === '')
                        retValue = 'Remove';
                    return retValue;
                };

                scope.openStatus = function(file) {
                    var retValue = true;
                    if (file.status === undefined || file.status === '')
                        retValue = false;
                    return retValue;
                };

                scope.openClick = function(file) {
                    dataservice.getFiles("", "", "download/GetById/" + file.id).then(function(response) {

                        var blob = new Blob([response], { type: "application/octet-stream" });
                        var url = window.URL.createObjectURL(blob);
                        //for microsoft IE
                        if (window.navigator && window.navigator.msSaveOrOpenBlob) {
                            window.navigator.msSaveOrOpenBlob(blob, file.name);
                        } else { //other browsers
                            var a = document.createElement('a');
                            a.style = "display:none";
                            a.href = url;
                            a.download = file.name;
                            a.click();
                            window.URL.revokeObjectURL(url);
                        }


                    });

                };

                scope.chooseClick = function() {
                    if (scope.multipleFile === undefined || !scope.multipleFile)
                        scope.myFiles = [];

                    $(el).find("#fileUpload").click();
                };


                scope.hideUpload = function() {
                    var newCount = 0;
                    angular.forEach(scope.myFiles, function(file) {
                        if (file.status !== undefined && file.status === "new") {
                            newCount++;
                        }
                    });

                    if (scope.keyData === undefined || scope.keyData.toString() === "0")
                        return true;
                    else if (newCount === 0 || (scope.mode !== undefined && (scope.mode.toLowerCase() === 'save' || scope.mode.toLowerCase() === 'saveas')))
                        return true;
                    else
                        return false;
                }

                scope.upload = function() {
                    var formData = new FormData();
                    angular.forEach(scope.myFiles, function(file) {
                        if (file.status !== undefined && file.status === "new") {
                            formData.append(file.name, file);
                        }
                    });

                    if (scope.keyData === undefined || scope.keyData === "" || scope.keyData === "0") {
                        scope.keyReturn = { "error": "No keyData" };
                        if (scope.$parent !== undefined && scope.$parent.item !== undefined && scope.$parent.item.templateOptions !== undefined)
                            scope.$parent.item.templateOptions.keyReturn = scope.keyReturn;
                    } else {
                        var dataInfo = {
                            folder: scope.type,
                            id: scope.keyData,
                            name: (scope.keyName !== undefined && scope.keyName !== '' ? scope.keyName : '')
                        };

                        formData.append("data", JSON.stringify(dataInfo));
                        dataservice.fileUpload(formData).then(function(uploadData) {
                            if (uploadData.Files !== undefined && uploadData.Files !== "" && uploadData.Files !== null && uploadData.Files.length > 0)
                                scope.myFiles = uploadData.Files;

                            logger.success("Files are uploaded successfully...", "", "");
                            scope.keyReturn = { "uploaded": scope.myFiles };
                            if (scope.$parent !== undefined && scope.$parent.item !== undefined && scope.$parent.item.templateOptions !== undefined)
                                scope.$parent.item.templateOptions.keyReturn = scope.keyReturn;
                        });
                    }
                };

                if (scope.multipleFile !== undefined && scope.multipleFile)
                    $(el).find("#fileUpload").attr("multiple", "multiple");
                else
                    $(el).find("#fileUpload").removeAttr("multiple");

                function removeFile(file) {
                    var index = navcon.getItemIndexByKeyValue(scope.myFiles, "name", file.name);
                    if (index !== -1) {
                        scope.myFiles.splice(index, 1);
                        scope.keyReturn = { "removed": scope.myFiles };
                        if (scope.$parent !== undefined && scope.$parent.item !== undefined && scope.$parent.item.templateOptions !== undefined)
                            scope.$parent.item.templateOptions.keyReturn = { "removed": scope.myFiles };
                    }
                };


                scope.$on('FILEUPLOAD-CLEAR', function(event, args, uploadClear) {
                    if (args && uploadClear)
                        clearFiles();
                });

                var clearFiles = function() {
                    $timeout(function() {
                        scope.$apply(function() {
                            scope.myFiles = [];
                        });
                    });
                };



            }
        };
    }
]).directive('navconPhotoUpload', ['dataservice', 'appInfo', 'photoManager', 'logger', 'ngAuthSettings', '$timeout',
    function(dataservice, appInfo, photoManager, logger, ngAuthSettings, $timeout) {
        return {
            /*E: Directive defined as an element. <navcon-table></navcon-table>
            A: Directive applied as an attribute on existing element. <div navcon-table></div>
            C: Directive applied as a css class to existing element <div class="navcon-table"></div>
            M: Directive applied as comment.*/
            restrict: 'E',
            scope: {
                myImage: '=',
                mode: '=',
                type: '=',
                keyData: '=',
                keyName: '=',
                photoChangeable: '=',
                fileSize: '=',
                fileType: '=',
                agreeText: '='
            },
            //templateUrl: 'ext-modules/navconUpload/navconPhotoUploadTemplate.html',
            templateUrl: function() {
                return navcon.Menuroute.getTemplateUrl("navconPhotoUpload");
            },
            link: function(scope, el, attrs) {
                scope.title = "test";
                scope.hasFiles = false;
                scope.photos = [];
                scope.upload = photoManager.upload;
                scope.appStatus = appInfo.status;
                scope.photoManagerStatus = photoManager.status;

                if (scope.fileSize === undefined)
                    scope.fileSize = 0;

                if (scope.fileType === undefined)
                    scope.fileType = [];

                scope.isAgree = "no";
                /*if (scope.agreeText !== undefined && scope.agreeText !== "")
                    scope.isAgreeVisible = true;
                else {
                    scope.isAgreeVisible = false;
                    scope.isAgree = "yes";
                }*/
                scope.$watch("agreeText", function(newValue, oldValue) {
                    if (newValue !== undefined && newValue !== "")
                        scope.isAgreeVisible = true;
                    else {
                        scope.isAgreeVisible = false;
                        scope.isAgree = "yes";
                    }
                });

                scope.readonly = scope.$parent.readOnly != undefined ? scope.$parent.readOnly : (scope.$parent.readonly != undefined ? scope.$parent.readonly : false);
                scope.$watch("$parent.readOnly", function(newValue, oldValue) {
                    if (newValue != undefined)
                        scope.readonly = newValue;
                });
                scope.$watch("$parent.readonly", function(newValue, oldValue) {
                    if (newValue != undefined)
                        scope.readonly = newValue;
                });

                scope.remove = function() {
                    scope.clearImage();
                    var file = scope.myImage[0];
                    if (file.status === undefined || file.status === '') {
                        //dataservice.fileDelete(scope.type, file.id).then(function (status) {
                        var id = file.id;
                        if (id === undefined) id = scope.keyData;
                        dataservice.fileDelete("download/Delete", id).then(function(status) {
                            var fileName = file.name;
                            if (fileName === undefined) fileName = scope.keyName;

                            scope.keyReturn = { "removed": scope.myImage };
                            if (scope.$parent !== undefined && scope.$parent.item !== undefined && scope.$parent.item.templateOptions !== undefined)
                                scope.$parent.item.templateOptions.keyReturn = scope.keyReturn;

                            logger.success("File(" + fileName + ") is removed successfully...", "", "");
                            scope.myImage = [];
                        });
                    } else {
                        var index = navcon.getItemIndexByKeyValue(scope.myImage, "name", file.name);
                        if (index !== -1) {
                            scope.myImage.splice(index, 1);
                            scope.keyReturn = { "removed": scope.myImage };
                            if (scope.$parent !== undefined && scope.$parent.item !== undefined && scope.$parent.item.templateOptions !== undefined)
                                scope.$parent.item.templateOptions.keyReturn = scope.keyReturn;
                        }
                    }
                };

                scope.cancel = function() {
                    //clearImage();
                    var retValue = "Cancel";
                    if (scope.myImage === undefined) return retValue;
                    if (scope.myImage !== undefined && scope.myImage.length < 1) return retValue;
                    var file = scope.myImage[0];
                    if (scope.myImage[0].URL !== null && (file.status === undefined || file.status === ''))
                        retValue = 'Remove';
                    return retValue;
                };

                scope.clearImage = function() {
                    $timeout(function() {
                        scope.$apply(function() {
                            scope.src = "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///ywAAAAAAQABAAACAUwAOw==";
                        })
                    });
                }

                scope.src = "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///ywAAAAAAQABAAACAUwAOw==";

                scope.openStatus = function(file) {
                    var retValue = true;
                    if (file.status === undefined || file.status === '')
                        retValue = false;
                    return retValue;
                };

                scope.loadSrc = function() {
                    var uploadBase = ngAuthSettings.uploadPath;
                    if (scope.myImage !== undefined) //&& scope.myImage.length > 0 && scope.myImage[0].URL !== undefined && scope.myImage[0].URL !== ''
                        scope.src = 'data:image/jpeg;base64,' + scope.myImage; //uploadBase + scope.myImage[0].URL;
                    else
                        scope.src = 'data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///ywAAAAAAQABAAACAUwAOw==';
                };

                scope.chooseClick = function() {
                    scope.myImage = [];
                    $(el).find("#photoUpload").click();
                };

                var base64ToBlob = function(b64Data, contentType) {
                    var byteCharacters = atob(b64Data.split(',')[1]);
                    var byteNumbers = new Array(byteCharacters.length);
                    for (var i = 0; i < byteCharacters.length; i++) {
                        byteNumbers[i] = byteCharacters.charCodeAt(i);
                    }
                    var byteArray = new Uint8Array(byteNumbers);
                    var blob = new Blob([byteArray], { type: contentType });
                    return blob;
                }

                scope.upload = function() {
                    var formData = new FormData();
                    angular.forEach(scope.myImage, function(file) {
                        if (file.status !== undefined && file.status === "new") {
                            var blob = base64ToBlob(file.base64, file.type);
                            formData.append("blob", blob, file.name);
                            scope.keyName = file.name;
                        }
                    });

                    if (scope.keyData === undefined || scope.keyData === "" || scope.keyData === "0") {
                        scope.keyReturn = { "error": "No keyData" };
                        if (scope.$parent !== undefined && scope.$parent.item !== undefined && scope.$parent.item.templateOptions !== undefined)
                            scope.$parent.item.templateOptions.keyReturn = scope.keyReturn;
                    } else {
                        var dataInfo = {
                            folder: scope.type,
                            id: scope.keyData,
                            name: (scope.keyName !== undefined && scope.keyName !== '' ? scope.keyName : '')
                        };

                        formData.append("data", JSON.stringify(dataInfo));
                        dataservice.fileUpload(formData).then(function(uploadData) {
                            scope.myImage = uploadData.Files;
                            logger.success("Files are uploaded successfully...", "", "");
                            scope.keyReturn = { "uploaded": scope.myImage };
                            if (scope.$parent !== undefined && scope.$parent.item !== undefined && scope.$parent.item.templateOptions !== undefined)
                                scope.$parent.item.templateOptions.keyReturn = scope.keyReturn;
                        });
                    }
                };

                scope.$watch('myImage', function(newValue, oldValue) {
                    if (newValue !== undefined && newValue.length === 0)
                        scope.clearImage();
                    else(newValue !== undefined && newValue.length > 0)
                    scope.loadSrc();

                })

            }
        };
    }
]).directive('fileModel', ['$parse', '$timeout', 'logger', 'blockUI', function($parse, $timeout, logger, blockUI) {
    return {
        restrict: 'A',
        link: function(scope, element, attrs) {
            var model = $parse(attrs.fileModel);

            var id = $(element).attr("id");
            var modelSetter = model.assign;
            var extList = [{ ext: 'exe' }, { ext: 'zip' }, { ext: 'bat' }]
            var allowExt = scope.fileType;
            element.bind('change', function() {
                if ($(element).val() == "")
                    return;

                if (scope.isAgreeVisible)
                    scope.isAgree = 'no';

                //blockUI.start();   

                $timeout(function() {
                    scope.$apply(function() {
                        if (element[0].files) {
                            angular.forEach(element[0].files, function(f) {
                                if (f.size !== undefined && f.size > 0 && scope.fileSize > 0) {
                                    if ((f.size / 1000) > scope.fileSize) {
                                        logger.warning("File size should be less than " + scope.fileSize.toString() + " kb");
                                        return 0;
                                    }
                                }

                                if ((f.size / 1000) > 2000 && scope.fileSize === "0") {
                                    logger.warning("File size should be less than 2mb");
                                    return 0;
                                }

                                if (scope.sameFile !== undefined && !scope.sameFile && navcon.getItemByKeyValue(scope.myFiles, "name", f.name) !== -1) {
                                    logger.warning("Can not upload the same file name (" + f.name + ")");
                                    return 0;
                                }

                                f["status"] = "new";
                                if (scope.myFiles == "")
                                    scope.myFiles = [];
                                var ext = f.name.split('.').pop().toLowerCase();

                                if (scope.fileType.length > 0 && scope.fileType.indexOf(ext) === -1) {
                                    logger.warning("File format " + scope.fileType.join(',') + " only supported");
                                    return 0;
                                }
                                if (navcon.getItemByKeyValue(extList, "ext", ext) === -1) {
                                    if (id.toLowerCase() === "photoupload") {
                                        getBase64(f, function(base64) {
                                            var fileData = {
                                                lastModified: f.lastModified,
                                                lastModifiedDate: f.lastModifiedDate,
                                                name: f.name,
                                                size: f.size,
                                                type: f.type,
                                                webkitRelativePath: f.webkitRelativePath,
                                                base64: base64,
                                                status: f.status || 'new'
                                            }
                                            $timeout(function() {
                                                scope.myImage.push(fileData);
                                                readURL(f);
                                            })
                                        })
                                    } else {
                                        getBase64(f, function(base64) {
                                            var fileData = {
                                                lastModified: f.lastModified,
                                                lastModifiedDate: f.lastModifiedDate,
                                                name: f.name,
                                                size: f.size,
                                                type: f.type,
                                                webkitRelativePath: f.webkitRelativePath,
                                                base64: base64,
                                                status: f.status || 'new'
                                            }
                                            $timeout(function() {
                                                scope.myFiles.push(fileData);
                                            })
                                        })
                                    }

                                } else {
                                    logger.warning("File format '." + ext + "' not supported.");
                                }
                            });
                            scope.hasFiles = true;
                        }
                        $(element).val("");
                    });
                })
            });

            function blobToDataURL(f, type, callback) {
                var fileReader = new FileReader();
                fileReader.readAsArrayBuffer(f);
                fileReader.onloadend = function(e) {
                    var ab = e.target.result;
                    var blob = new Blob([ab], { type: type });
                    callback(blob);
                };
            }


            function getBase64(file, callback) {
                var reader = new FileReader();
                reader.readAsDataURL(file);
                reader.onload = function() {
                    callback(reader.result);
                };
                reader.onerror = function(error) {
                    console.log('Error: ', error);
                };
            }


            function readURL(file) {
                if (file) {
                    var reader = new FileReader();
                    reader.onload = function(e) {
                        $timeout(function() {
                            scope.$apply(function() {
                                scope.src = e.target.result;
                            })
                        });
                    };
                    reader.readAsDataURL(file);
                }
            }

        }
    };
}]);
"use strict";

angular.module('navconFramework').directive('navconUserProfile', function() {
    return {
        //templateUrl: 'ext-modules/navconFramework/navconUserProfile/navconUserProfileTemplate.html'
        templateUrl: function() {
            return navcon.Menuroute.getTemplateUrl("navconUserProfile");
        },
    };
});
"use strict";

angular.module('navconFramework').directive('navconUserProfileSmall', function() {
    return {
        //templateUrl: 'ext-modules/navconFramework/navconUserProfile/navconUserProfileSmallTemplate.html'
        templateUrl: function() {
            return navcon.Menuroute.getTemplateUrl("navconUserProfileSmall");
        },
    };
});
angular.module('app').directive('mfDropdownStaticInclude', ['$compile', function ($compile) {
    return function (scope, element, attrs) {
        var template = attrs.mfDropdownStaticInclude;
        var contents = element.html(template).contents();
        $compile(contents)(scope);
    };
}]).directive('ngDropdownMultiselect', ['$filter', '$document', '$compile', '$parse', function ($filter, $document, $compile, $parse) {
    return {
        restrict: 'EA',
        scope: {
            selectedModel: '=',
            options: '=',
            extraSettings: '=',
            events: '=',
            searchFilter: '=?',
            translationTexts: '=',
            groupBy: '@',
            disabled: "=",
            parentList: "="
        },
        template: function (element, attrs, $scope) {
            var checkboxes = attrs.checkboxes ? true : false;
            var groups = attrs.groupBy ? true : false;

            var template = '<div  name="{{$parent.item.key}}" class="multiselect-parent btn-group dropdown-multiselect" style="float:left;width:100%" ng-class="{open: open}" ng-model="selectedModel" field-required="$parent.item.templateOptions.required">';
            template += '<button id="{{texts.name}}" ng-disabled="disabled" type="button" class="dropdown-toggle" ng-class="settings.buttonClasses" ng-click="toggleDropdown()" style="width:100%;text-align:left;text-overflow: ellipsis;padding: 4px;"><span style="text-overflow: ellipsis;width:85%;display:inline-block;overflow:hidden;">{{getButtonText()}}</span>&nbsp;<span class="caret" style="float:right;margin-top:8px;"></span></button>';
            template += '<ul class="dropdown-menu dropdown-menu-form" ng-if="open" ng-style="{display: open ? \'block\' : \'none\', height :  \'250px\', overflow: \'auto\' }" style="width:100%;margin-top:0" >';
            template += '<li ng-if="settings.showCheckAll && settings.selectionLimit !== 1" style="float:left;"><a ng-keydown="keyDownLink($event)" data-ng-click="selectAll()" tabindex="-1" id="selectAll"><span class="glyphicon glyphicon-ok"></span>  {{texts.checkAll}}</a>';
            template += '<li ng-if="settings.showUncheckAll" style="float:right;"><a ng-keydown="keyDownLink($event)" data-ng-click="deselectAll();" tabindex="-1" id="deselectAll"><span class="glyphicon glyphicon-remove"></span>   {{texts.uncheckAll}}</a></li>';
            template += '<li ng-if="settings.selectByGroups && ((settings.showCheckAll && settings.selectionLimit > 0) || settings.showUncheckAll)" class="divider" style="clear:both;"></li>';
            template += '<li ng-if="settings.selectByGroups && ((settings.showCheckAll && settings.selectionLimit > 0) || settings.showUncheckAll)" class="divider" style="clear:both;"></li>';
            template += '<li ng-repeat="currentGroup in settings.selectByGroups track by $index" ng-click="selectCurrentGroup(currentGroup)"><a ng-class="{\'dropdown-selected-group\': selectedGroup === currentGroup}" tabindex="-1">{{::texts.selectGroup}} {{::getGroupLabel(currentGroup)}}</a></li>';
            template += '<li ng-if="settings.selectByGroups && settings.showEnableSearchButton" class="divider" style="clear:both;"></li>';
            template += '<li ng-if="settings.showEnableSearchButton && settings.enableSearch"><a ng-keydown="keyDownLink($event); keyDownToggleSearch();" ng-click="toggleSearch($event);" tabindex="-1">{{texts.disableSearch}}</a></li>';
            template += '<li ng-if="settings.showEnableSearchButton && !settings.enableSearch"><a ng-keydown="keyDownLink($event); keyDownToggleSearch();" ng-click="toggleSearch($event);" tabindex="-1">{{texts.enableSearch}}</a></li>';
            template += '<li ng-if="(settings.showCheckAll && settings.selectionLimit > 0) || settings.showUncheckAll || settings.showEnableSearchButton" class="divider" style="clear:both; {{settings.isCustomFormat ? \'margin-bottom: 22px;\':\'\'}}"></li>';
            template += '<li ng-if="settings.enableSearch"><div class="dropdown-header"><input type="text" class="form-control searchField" ng-keydown="keyDownSearchDefault($event); keyDownSearch($event, input.searchFilter);" ng-style="{width: \'100%\'}" ng-model="input.searchFilter" placeholder="{{texts.searchPlaceholder}}" /></li>';
            template += '<li ng-if="settings.enableSearch" class="divider" style="clear:both;"></li>';

            if (groups) {
                template += '<li ng-repeat-start="option in orderedItems | filter:getFilter(input.searchFilter)" ng-show="getPropertyForObject(option, settings.groupBy) !== getPropertyForObject(orderedItems[$index - 1], settings.groupBy)" role="presentation" class="dropdown-header">{{ getGroupLabel(getPropertyForObject(option, settings.groupBy)) }}</li>';
                template += '<li ng-class="{\'active\': isChecked(getPropertyForObject(option,settings.idProp)) && settings.styleActive}" ng-repeat-end role="presentation">';
            } else {
                template += '<li ng-class="{\'active\': isChecked(getPropertyForObject(option,settings.idProp)) && settings.styleActive}" role="presentation" ng-repeat="option in options | filter:getFilter(input.searchFilter)">';
            }

            template += '<a ng-keydown="option.disabled || keyDownLink($event)" role="menuitem" class="option" tabindex="-1" ng-click="option.disabled || setSelectedItem(getPropertyForObject(option,settings.idProp), false, true)" ng-disabled="option.disabled">';

            if (checkboxes) {
                template += '<div ><label><input class="checkboxInput" type="checkbox" ng-click="checkboxClick($event, getPropertyForObject(option,settings.idProp))" ng-checked="isChecked(getPropertyForObject(option,settings.idProp))" /> <span mf-dropdown-static-include="{{settings.template}}"></div></label></span></a>';
            } else {
                template += '<span data-ng-class="{\'glyphicon glyphicon-ok\': isChecked(getPropertyForObject(option,settings.idProp))}"> </span> <span mf-dropdown-static-include="{{settings.template}}"></span></a>';
            }

            template += '</li>';

            template += '<li class="divider" ng-show="settings.selectionLimit > 1"></li>';
            template += '<li role="presentation" ng-show="settings.selectionLimit > 1"><a role="menuitem">{{selectedModel.length}} {{texts.selectionOf}} {{settings.selectionLimit}} {{texts.selectionCount}}</a></li>';

            template += '</ul>';
            template += '</div>';
            //template += '<div name="{{$parent.item.key}}" class="error-messages error-margin ng-active" style="clear:both" ng-if="selectedModel.length<1 && showText" ng-if="$parent.item.showMessage" >';
            //template += '<div ng-style="{width: ($parent.item.templateOptions.requiredMessage.length*7)+\'px\'}" ng-if="selectedModel.length<1 && showText" >{{settings.invalidMessage|| \'Shouldn\\\'t be empty...\'}}</div>'
            //template += '</div>';

            element.html(template);
        },
        link: function ($scope, $element, $attrs) {
            var $dropdownTrigger = $element.children()[0];
            $scope.selectedModel == undefined ? [] : $scope.selectedModel;
            $scope.toggleDropdown = function () {
                if ($scope.open) {
                    $scope.close()
                } else { $scope.open = true }
                if ($scope.settings.keyboardControls) {
                    if ($scope.open) {
                        if ($scope.settings.selectionLimit === 1 && $scope.settings.enableSearch) {
                            setTimeout(function () {
                                angular.element($element)[0].querySelector('.searchField').focus();
                            }, 0);
                        } else {
                            setTimeout(function () {
                                angular.element($element)[0].querySelector('.option').focus();
                            }, 0);
                        }
                    }
                }
            };
            $scope.showText = false;
            $scope.checkboxClick = function ($event, id) {

                $scope.setSelectedItem(id, false, true);
                $event.stopImmediatePropagation();
            };

            $scope.externalEvents = {
                onItemSelect: angular.noop,
                onItemDeselect: angular.noop,
                onSelectAll: angular.noop,
                onDeselectAll: angular.noop,
                onInitDone: angular.noop,
                onMaxSelectionReached: angular.noop,
                onSelectionChanged: angular.noop,
                onClose: angular.noop
            };

            $scope.settings = {
                dynamicTitle: true,
                scrollable: false,
                scrollableHeight: '250px',
                closeOnBlur: true,
                isCustomFormat: $scope.parentList.selectOptions.isCustomFormat,
                displayProp: $scope.parentList.selectOptions.item.displayField,
                secondDisplayProp: $scope.parentList.selectOptions.item.secondDisplayField,
                idProp: $scope.parentList.selectOptions.item.dataField,
                externalIdProp: $scope.parentList.selectOptions.item.dataField,
                invalidMessage: $scope.$parent.item.templateOptions.requiredMessage,
                enableSearch: false,
                selectionLimit: 0,
                showCheckAll: true,
                showUncheckAll: true,
                showEnableSearchButton: false,
                closeOnSelect: false,
                buttonClasses: 'btn btn-default',
                closeOnDeselect: false,
                groupBy: $attrs.groupBy || undefined,
                groupByTextProvider: null,
                smartButtonMaxItems: 7,
                smartButtonTextConverter: angular.noop,
                styleActive: false,
                keyboardControls: false,
                template: '{{getPropertyForObject(option, settings.displayProp)}}',
                searchField: '$'
            };

            $scope.texts = {
                checkAll: 'Check All',
                uncheckAll: 'Uncheck All',
                selectionCount: 'checked',
                selectionOf: '/',
                searchPlaceholder: 'Search...',
                buttonDefaultText: 'Select',
                dynamicButtonTextSuffix: 'checked',
                disableSearch: 'Disable search',
                enableSearch: 'Enable search',
                selectGroup: 'Select all:',
                name: $scope.parentList.name
            };

            $scope.input = {
                searchFilter: $scope.searchFilter || ''
            };

            if (angular.isDefined($scope.settings.groupBy)) {
                $scope.$watch('options', function (newValue) {
                    if (angular.isDefined(newValue)) {
                        $scope.orderedItems = $filter('orderBy')(newValue, $scope.settings.groupBy);
                    }
                });
            }

            $scope.$watch('selectedModel', function (newValue) {
                //if(newValue === undefined || newValue === "") newValue = [];
                if (!Array.isArray(newValue)) {
                    $scope.singleSelection = true;
                } else {
                    $scope.singleSelection = false;
                }
            });

            $scope.$watch('$parent.item.showMessage', function (oldValue, newValue) {
                if (oldValue) {
                    $scope.showText = oldValue;
                }
                else {
                    $scope.showText = false;
                }
            });

            $scope.close = function () {
                $scope.open = false;
                $scope.externalEvents.onClose();
            }

            $scope.selectCurrentGroup = function (currentGroup) {
                $scope.selectedModel.splice(0, $scope.selectedModel.length);
                if ($scope.orderedItems) {
                    $scope.orderedItems.forEach(function (item) {
                        if (item[$scope.groupBy] === currentGroup) {
                            $scope.setSelectedItem($scope.getPropertyForObject(item, $scope.settings.idProp), false, false)
                        }
                    });
                }
                $scope.externalEvents.onSelectionChanged();
            };

            angular.extend($scope.settings, $scope.extraSettings || []);
            angular.extend($scope.externalEvents, $scope.events || []);
            angular.extend($scope.texts, $scope.translationTexts);

            $scope.singleSelection = $scope.settings.selectionLimit === 1;

            function getFindObj(id) {
                var findObj = {};

                //if ($scope.settings.externalIdProp === '') {
                //    findObj[$scope.settings.idProp] = id;
                //} else {
                //    findObj[$scope.settings.externalIdProp] = id;
                //}

                $.each($scope.parentList.selectOptions.items, function (index, value) {
                    if (value[$scope.settings.externalIdProp] == id) {
                        findObj = value;
                    }
                })

                return findObj;
            }

            function clearObject(object) {
                if (object == "" || object == undefined) {
                    $scope.selectedModel = [];
                }
                for (var prop in object) {
                    delete object[prop];
                }
            }

            if ($scope.singleSelection) {
                if (angular.isArray($scope.selectedModel) && $scope.selectedModel.length === 0) {
                    clearObject($scope.selectedModel);
                }
            }

            if ($scope.settings.closeOnBlur) {
                $document.on('click', function (e) {
                    if ($scope.open) {
                        var target = e.target.parentElement;
                        var parentFound = false;

                        while (angular.isDefined(target) && target !== null && !parentFound) {
                            if (!!target.className.split && contains(target.className.split(' '), 'multiselect-parent') && !parentFound) {
                                if (target === $dropdownTrigger) {
                                    parentFound = true;
                                }
                            }
                            target = target.parentElement;
                        }

                        if (!parentFound) {
                            $scope.$apply(function () {
                                $scope.close();
                            });
                        }
                    }
                });
            }

            $scope.getGroupLabel = function (groupValue) {
                if ($scope.settings.groupByTextProvider !== null) {
                    return $scope.settings.groupByTextProvider(groupValue);
                }

                return groupValue;
            };

            $scope.getButtonText = function () {
                if ($scope.selectedModel != undefined) {
                    if ($scope.settings.dynamicTitle && ($scope.selectedModel.length > 0 || (angular.isObject($scope.selectedModel) && Object.keys($scope.selectedModel).length > 0))) {
                        if ($scope.settings.smartButtonMaxItems > 0) {
                            var itemsText = [];

                            angular.forEach($scope.options, function (optionItem) {
                                if ($scope.isChecked($scope.getPropertyForObject(optionItem, $scope.settings.idProp))) {
                                    var displayText = $scope.getPropertyForObject(optionItem, $scope.settings.displayProp);
                                    if ($scope.settings.secondDisplayProp !== undefined && $scope.settings.secondDisplayProp !== null && $scope.settings.secondDisplayProp !== "")
                                        displayText += " / " +  $scope.getPropertyForObject(optionItem, $scope.settings.secondDisplayProp);
                                    var converterResponse = $scope.settings.smartButtonTextConverter(displayText, optionItem);

                                    itemsText.push(converterResponse ? converterResponse : displayText);
                                }
                            });

                            if ($scope.selectedModel.length > $scope.settings.smartButtonMaxItems) {
                                itemsText = itemsText.slice(0, $scope.settings.smartButtonMaxItems);
                                itemsText.push('...');
                            }

                            return itemsText.join(', ');
                        } else {
                            var totalSelected;

                            if ($scope.singleSelection) {
                                totalSelected = ($scope.selectedModel !== null && angular.isDefined($scope.selectedModel[$scope.settings.idProp])) ? 1 : 0;
                            } else {
                                totalSelected = angular.isDefined($scope.selectedModel) ? $scope.selectedModel.length : 0;
                            }

                            if (totalSelected === 0) {
                                return $scope.texts.buttonDefaultText;
                            } else {
                                return totalSelected + ' ' + $scope.texts.dynamicButtonTextSuffix;
                            }
                        }
                    } else {
                        return $scope.texts.buttonDefaultText;
                    }
                }
            };

            $scope.getPropertyForObject = function (object, property) {
                if (angular.isDefined(object) && object.hasOwnProperty(property)) {
                    //  $scope.singleSelection = true;
                    return object[property];

                }
                //  $scope.singleSelection = false;
                return undefined;
            };

            $scope.selectAll = function () {
                var searchResult;
                $scope.deselectAll(true);
                $scope.externalEvents.onSelectAll();

                searchResult = $filter('filter')($scope.options, $scope.getFilter($scope.input.searchFilter));
                angular.forEach(searchResult, function (value) {
                    $scope.setSelectedItem(value[$scope.settings.idProp], true, false);
                });
                $scope.externalEvents.onSelectionChanged();
                $scope.selectedGroup = null;
            };

            $scope.deselectAll = function (dontSendEvent) {
                dontSendEvent = dontSendEvent || false;

                if (!dontSendEvent) {
                    $scope.externalEvents.onDeselectAll();
                }

                if ($scope.singleSelection) {
                    clearObject($scope.selectedModel);
                } else {
                    //$scope.selectedModel.splice(0, $scope.selectedModel.length);
                    $scope.selectedModel = [];
                }
                if (!dontSendEvent) {
                    $scope.externalEvents.onSelectionChanged();
                }
                $scope.selectedGroup = null;
                $scope.selectedModel = $scope.selectedModel;
            };

            $scope.setSelectedItem = function (id, dontRemove, fireSelectionChange) {
                $scope.selectedModel =  (($scope.selectedModel === undefined || $scope.selectedModel === "") ? [] : $scope.selectedModel);
                var findObj = getFindObj(id);
                var finalObj = null;

                if ($scope.settings.externalIdProp === '') {
                    finalObj = find($scope.options, findObj);
                } else {
                    finalObj = findObj;
                }

                if ($scope.singleSelection) {
                    clearObject($scope.selectedModel);
                    angular.extend($scope.selectedModel, finalObj);
                    if (fireSelectionChange) {
                        $scope.externalEvents.onItemSelect(finalObj);
                    }
                    if ($scope.settings.closeOnSelect || $scope.settings.closeOnDeselect) $scope.close();
                } else {
                    dontRemove = dontRemove || false;
                    if ($scope.selectedModel == "") {
                        $scope.selectedModel = [];
                    }

                    var exists = findIndex($scope.selectedModel, findObj) !== -1;

                    if (!dontRemove && exists) {
                        $scope.selectedModel.splice(findIndex($scope.selectedModel, findObj), 1);
                        if ($scope.selectedModel.length == 0) {
                            $scope.selectedModel = [];
                        }
                        $scope.externalEvents.onItemDeselect(findObj);
                        if ($scope.settings.closeOnDeselect) $scope.close();
                    } else if (!exists && ($scope.settings.selectionLimit === 0 || $scope.selectedModel.length < $scope.settings.selectionLimit)) {
                        if (!exists)
                            $scope.selectedModel.push(finalObj);
                        if (fireSelectionChange) {
                            $scope.externalEvents.onItemSelect(finalObj);
                        }
                        if ($scope.settings.closeOnSelect) $scope.close();
                        if ($scope.settings.selectionLimit > 0 && $scope.selectedModel.length === $scope.settings.selectionLimit) {
                            $scope.externalEvents.onMaxSelectionReached();
                        }
                    }
                }
                if (fireSelectionChange) {
                    $scope.externalEvents.onSelectionChanged();
                }
                $scope.selectedGroup = null;
            };

            $scope.isChecked = function (id) {
                if ($scope.selectedModel != undefined) {
                    if ($scope.singleSelection) {
                        return $scope.selectedModel !== null && angular.isDefined($scope.selectedModel[$scope.settings.externalIdProp]) && $scope.selectedModel[$scope.settings.externalIdProp] === getFindObj(id)[$scope.settings.externalIdProp];
                    }

                    return findIndex($scope.selectedModel, getFindObj(id)) !== -1;
                }
            };

            $scope.externalEvents.onInitDone();

            $scope.keyDownLink = function (event) {
                var sourceScope = angular.element(event.target).scope();
                var nextOption;
                var parent = event.target.parentNode;
                if (!$scope.settings.keyboardControls) {
                    return;
                }
                if (event.keyCode === 13 || event.keyCode === 32) { // enter
                    event.preventDefault();
                    if (!!sourceScope.option) {
                        $scope.setSelectedItem($scope.getPropertyForObject(sourceScope.option, $scope.settings.idProp), false, true);
                    } else if (event.target.id === 'deselectAll') {
                        $scope.deselectAll();
                    } else if (event.target.id === 'selectAll') {
                        $scope.selectAll();
                    }
                } else if (event.keyCode === 38) { // up arrow
                    event.preventDefault();
                    if (!!parent.previousElementSibling) {
                        nextOption = parent.previousElementSibling.querySelector('a') || parent.previousElementSibling.querySelector('input');
                    }
                    while (!nextOption && !!parent) {
                        parent = parent.previousElementSibling;
                        if (!!parent) {
                            nextOption = parent.querySelector('a') || parent.querySelector('input');
                        }
                    }
                    if (!!nextOption) {
                        nextOption.focus();
                    }
                } else if (event.keyCode === 40) { // down arrow
                    event.preventDefault();
                    if (!!parent.nextElementSibling) {
                        nextOption = parent.nextElementSibling.querySelector('a') || parent.nextElementSibling.querySelector('input');
                    }
                    while (!nextOption && !!parent) {
                        parent = parent.nextElementSibling;
                        if (!!parent) {
                            nextOption = parent.querySelector('a') || parent.querySelector('input');
                        }
                    }
                    if (!!nextOption) {
                        nextOption.focus();
                    }
                } else if (event.keyCode === 27) {
                    event.preventDefault();

                    $scope.toggleDropdown();
                }
            };

            $scope.keyDownSearchDefault = function (event) {
                var parent = event.target.parentNode.parentNode;
                var nextOption;
                if (!$scope.settings.keyboardControls) {
                    return;
                }
                if (event.keyCode === 9 || event.keyCode === 40) { //tab
                    event.preventDefault();
                    setTimeout(function () {
                        angular.element($element)[0].querySelector('.option').focus();
                    }, 0);
                } else if (event.keyCode === 38) {
                    event.preventDefault();
                    if (!!parent.previousElementSibling) {
                        nextOption = parent.previousElementSibling.querySelector('a') || parent.previousElementSibling.querySelector('input');
                    }
                    while (!nextOption && !!parent) {
                        parent = parent.previousElementSibling;
                        if (!!parent) {
                            nextOption = parent.querySelector('a') || parent.querySelector('input');
                        }
                    }
                    if (!!nextOption) {
                        nextOption.focus();
                    }
                } else if (event.keyCode === 27) {
                    event.preventDefault();

                    $scope.toggleDropdown();
                }
            };

            $scope.keyDownSearch = function (event, searchFilter) {
                var searchResult;
                if (!$scope.settings.keyboardControls) {
                    return;
                }
                if (event.keyCode === 13) {
                    if ($scope.settings.selectionLimit === 1 && $scope.settings.enableSearch) {
                        searchResult = $filter('filter')($scope.options, $scope.getFilter(searchFilter));
                        if (searchResult.length === 1) {
                            $scope.setSelectedItem($scope.getPropertyForObject(searchResult[0], $scope.settings.idProp), false, true);
                        }
                    } else if ($scope.settings.enableSearch) {
                        $scope.selectAll();
                    }
                }
            };

            $scope.getFilter = function (searchFilter) {
                var filter = {};
                filter[$scope.settings.searchField] = searchFilter;
                return filter;
            };

            $scope.toggleSearch = function ($event) {
                if ($event) {
                    $event.stopPropagation();
                }
                $scope.settings.enableSearch = !$scope.settings.enableSearch;
                if (!$scope.settings.enableSearch) {
                    $scope.input.searchFilter = '';
                }
            };

            $scope.keyDownToggleSearch = function () {
                if (!$scope.settings.keyboardControls) {
                    return;
                }
                if (event.keyCode === 13) {
                    $scope.toggleSearch();
                    if ($scope.settings.enableSearch) {
                        setTimeout(
							function () {
							    angular.element($element)[0].querySelector('.searchField').focus();
							}, 0
						);
                    } else {
                        angular.element($element)[0].querySelector('.option').focus();
                    }
                }
            };
        }
    };
}]);

function contains(collection, target) {
    var containsTarget = false;
    collection.some(function (object) {
        if (object === target) {
            containsTarget = true;
            return true;
        }
    });
    return containsTarget;
}

function find(collection, properties) {
    var target;

    collection.some(function (object) {
        var hasAllSameProperties = true;
        Object.keys(properties).forEach(function (key) {
            if (object[key] !== properties[key]) {
                hasAllSameProperties = false;
            }
        });
        if (hasAllSameProperties) {
            target = object;
            return true
        }
    });

    return target;
}

function findIndex(collection, properties) {
    var index = -1;
    var counter = -1;

    collection.some(function (object) {
        var hasAllSameProperties = true;
        counter += 1;
        Object.keys(properties).forEach(function (key) {
            if (object[key] !== properties[key]) {
                hasAllSameProperties = false;
            }
        });
        if (hasAllSameProperties) {
            index = counter;
            return true
        }
    });

    return index;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImNvbW1vbi9tb2R1bGVzLmpzIiwiY29tbW9uL25hdmNvbi5qcyIsImNvbW1vbi9uYXZjb25BbGVydC5qcyIsImNvbW1vbi9uYXZjb25LZW5kby5qcyIsImNvbW1vbi9uYXZjb25LZW5kb1NjaGVkdWxlLmpzIiwiY29tbW9uL25hdmNvbktlbmRvVGFibGUuanMiLCJjb21tb24vbmF2Y29uTWVudXJvdXRlLmpzIiwiY29tbW9uL25hdmNvblBhZ2UuanMiLCJjb21tb24vbmF2Y29uUGFnZUFQSS5qcyIsImNvcmUvY29uZmlnLmNvbnRyb2xsZXIuanMiLCJjb3JlL2NoYXJ0ZGF0YS5qcyIsImNvcmUvY29yZS5tb2R1bGUuanMiLCJsb2dnZXIvbG9nZ2VyLmNvbnRyb2xsZXIuanMiLCJyb3V0ZXIvcm91dGVoZWxwZXIuY29udHJvbGxlci5qcyIsImV4Y2VwdGlvbi9leGNlcHRpb24taGFuZGxlci5wcm92aWRlci5qcyIsImV4Y2VwdGlvbi9leGNlcHRpb24uY29udHJvbGxlci5qcyIsInNlcnZpY2VzL2F1dGguU2VydmljZS5qcyIsInNlcnZpY2VzL2F1dGhJbnRlcmNlcHRvci5TZXJ2aWNlLmpzIiwic2VydmljZXMvZGF0YS5TZXJ2aWNlLmpzIiwic2VydmljZXMvbG9hZGluZ092ZXJsYXkuU2VydmljZS5qcyIsInNlcnZpY2VzL3NpZ25hbFJIdWJQcm94eS5TZXJ2aWNlLmpzIiwiYXBwL2NoYW5nZXBhc3N3b3JkL2NoYW5nZXBhc3N3b3JkLmNvbnRyb2xsZXIuanMiLCJhcHAvbG9naW4vbG9naW4uY29udHJvbGxlci5qcyIsImFwcC9waG90by9hcHBJbmZvLmNvbnRyb2xsZXIuanMiLCJhcHAvcGhvdG8vZWdGaWxlcy5jb250cm9sbGVyLmpzIiwiYXBwL3Bob3RvL2VnUGhvdG9VcGxvYWRlci5jb250cm9sbGVyLmpzIiwiYXBwL3Bob3RvL2VnVXBsb2FkLmNvbnRyb2xsZXIuanMiLCJhcHAvcGhvdG8vcGhvdG9NYW5hZ2VyLmNvbnRyb2xsZXIuanMiLCJhcHAvcGhvdG8vcGhvdG9NYW5hZ2VyQ2xpZW50LmNvbnRyb2xsZXIuanMiLCJhcHAvcGhvdG8vcGhvdG9zLmNvbnRyb2xsZXIuanMiLCJhcHAvcm9sZW1hbmFnZW1lbnQvcm9sZW1hbmFnZW1lbnQuY29udHJvbGxlci5qcyIsImFwcC90aWxlcy90aWxlcy5jb250cm9sbGVyLmpzIiwiYXBwL3VzZXJhY2Nlc3NyaWdodHMvdXNlcmFjY2Vzc3JpZ2h0cy5jb250cm9sbGVyLmpzIiwiYXBwL3VzZXJpbXBvcnQvdXNlcmltcG9ydC5jb250cm9sbGVyLmpzIiwiYXBwL3VzZXJtYW5hZ2VtZW50L3VzZXJtYW5hZ2VtZW50LmNvbnRyb2xsZXIuanMiLCJhcHAvdXNlcnByb2ZpbGUvdXNlcnByb2ZpbGUuY29udHJvbGxlci5qcyIsImFwcC9uZXdzL25ld3MuY29udHJvbGxlci5qcyIsImV4dC1tb2R1bGVzL25hdmNvbkZyYW1ld29yay9uYXZjb25GcmFtZXdvcmsuY29udHJvbGxlci5qcyIsImV4dC1tb2R1bGVzL25hdmNvbk1lbnUvbmF2Y29uTWVudS5jb250cm9sbGVyLmpzIiwiYXBwL2Rhc2hib2FyZC9kYXNoYm9hcmQuZGlyZWN0aXZlLmpzIiwiYXBwL2Rhc2hib2FyZC9kaXJlY3RpdmVzL215Y291bnQuZGlyZWN0aXZlLmpzIiwiYXBwL2Rhc2hib2FyZC9kaXJlY3RpdmVzL215cmVwb3J0LmRpcmVjdGl2ZS5qcyIsImFwcC9kYXNoYm9hcmQvZGlyZWN0aXZlcy9teXJpc2ttYXRyaXguZGlyZWN0aXZlLmpzIiwiYXBwL2Rhc2hib2FyZC9kaXJlY3RpdmVzL215c3VtbWFyeS5kaXJlY3RpdmUuanMiLCJhcHAvbG9naW4vZGlyZWN0aXZlcy9sb2dpbi5kaXJlY3RpdmUuanMiLCJhcHAvd2lkZ2V0cy9uYXZjb25DaGFydC9uYXZjb25DaGFydC5kaXJlY3RpdmUuanMiLCJhcHAvZGVsZXRlL2RlbGV0ZS5kaXJlY3RpdmVzLmpzIiwiZXh0LW1vZHVsZXMvbmF2Y29uQ2FsZW5kYXIvbmF2Y29uQ2FsZW5kYXIuZGlyZWN0aXZlLmpzIiwiZXh0LW1vZHVsZXMvbmF2Y29uQ2FsZW5kYXIvbmF2Y29uT3JnY2hhcnQuZGlyZWN0aXZlLmpzIiwiZXh0LW1vZHVsZXMvbmF2Y29uRGFzaGJvYXJkL25hdmNvbkRhc2hib2FyZC5kaXJlY3RpdmUuanMiLCJleHQtbW9kdWxlcy9uYXZjb25EYXNoYm9hcmQvbmF2Y29uV2lkZ2V0Qm9keS5kaXJlY3RpdmUuanMiLCJleHQtbW9kdWxlcy9uYXZjb25Ecm9wZG93bi9uYXZjb25Ecm9wZG93bi5kaXJlY3RpdmUuanMiLCJleHQtbW9kdWxlcy9uYXZjb25FdmFsdWF0aW9uL25hdmNvbkV2YWx1YXRpb24uZGlyZWN0aXZlLmpzIiwiZXh0LW1vZHVsZXMvbmF2Y29uRkNoYXJ0L25hdmNvbkZDaGFydC5kaXJlY3RpdmUuanMiLCJleHQtbW9kdWxlcy9uYXZjb25GaWVsZC9uYXZjb25GaWVsZC5kaXJlY3RpdmUuanMiLCJleHQtbW9kdWxlcy9uYXZjb25GaWVsZC9uYXZjb25WYWxpZGF0aW9uLmRpcmVjdGl2ZS5qcyIsImV4dC1tb2R1bGVzL25hdmNvbkRlbGV0ZS9uYXZjb25EZWxldGUuZGlyZWN0aXZlLmpzIiwiZXh0LW1vZHVsZXMvbmF2Y29uRm9ybS9uYXZjb25Gb3JtLmRpcmVjdGl2ZS5qcyIsImV4dC1tb2R1bGVzL25hdmNvbkZyYW1ld29yay9uYXZjb25GcmFtZXdvcmsuZGlyZWN0aXZlLmpzIiwiZXh0LW1vZHVsZXMvbmF2Y29uS2VuZG8vbmF2Y29uS2VuZG9GaWVsZC5kaXJlY3RpdmUuanMiLCJleHQtbW9kdWxlcy9uYXZjb25LZW5kby9uYXZjb25LZW5kb1NjaGVkdWxlLmRpcmVjdGl2ZS5qcyIsImV4dC1tb2R1bGVzL25hdmNvbktlbmRvL25hdmNvbktlbmRvVGFibGUuZGlyZWN0aXZlLmpzIiwiZXh0LW1vZHVsZXMvbmF2Y29uS2VuZG8vbmF2Y29uS2VuZG9UZW1wbGF0ZS5kaXJlY3RpdmUuanMiLCJleHQtbW9kdWxlcy9uYXZjb25NZW51L25hdmNvbk1lbnUuZGlyZWN0aXZlLmpzIiwiZXh0LW1vZHVsZXMvbmF2Y29uTWVudS9uYXZjb25NZW51R3JvdXAuZGlyZWN0aXZlLmpzIiwiZXh0LW1vZHVsZXMvbmF2Y29uTWVudS9uYXZjb25NZW51SXRlbS5kaXJlY3RpdmUuanMiLCJleHQtbW9kdWxlcy9uYXZjb25Nb2RhbC9uYXZjb25Nb2RhbC5kaXJlY3RpdmUuanMiLCJleHQtbW9kdWxlcy9uYXZjb25QYWdlYmFyL25hdmNvblBhZ2ViYXIuZGlyZWN0aXZlLmpzIiwiZXh0LW1vZHVsZXMvbmF2Y29uUmF0aW5nL25hdmNvblJhdGluZy5kaXJlY3RpdmUuanMiLCJleHQtbW9kdWxlcy9uYXZjb25Qb3BvdmVyL25hdmNvblBvcG92ZXIuZGlyZWN0aXZlLmpzIiwiZXh0LW1vZHVsZXMvbmF2Y29uUG9wb3Zlci9uYXZjb25SZWFkbW9yZS5kaXJlY3RpdmUuanMiLCJleHQtbW9kdWxlcy9uYXZjb25Qb3J0bGV0L25hdmNvblBvcnRsZXQuZGlyZWN0aXZlLmpzIiwiZXh0LW1vZHVsZXMvbmF2Y29uUmVwb3J0L25hdmNvblJlcG9ydC5kaXJlY3RpdmUuanMiLCJleHQtbW9kdWxlcy9uYXZjb25SZXBvcnQvbmF2Y29uUmVwb3J0UGFnZS5kaXJlY3RpdmUuanMiLCJleHQtbW9kdWxlcy9uYXZjb25UYWJsZS9uYXZjb25UYWJsZS5kaXJlY3RpdmUuanMiLCJleHQtbW9kdWxlcy9uYXZjb25UYWJsZUVkaXRvci9uYXZjb25UYWJsZUVkaXRvci5kaXJlY3RpdmUuanMiLCJleHQtbW9kdWxlcy9uYXZjb25UcmVlL25hdmNvblRyZWUuZGlyZWN0aXZlLmpzIiwiZXh0LW1vZHVsZXMvbmF2Y29uVXBsb2FkL25hdmNvblVwbG9hZC5kaXJlY3RpdmUuanMiLCJleHQtbW9kdWxlcy9uYXZjb25GcmFtZXdvcmsvbmF2Y29uVXNlclByb2ZpbGUvbmF2Y29uVXNlclByb2ZpbGUuZGlyZWN0aXZlLmpzIiwiZXh0LW1vZHVsZXMvbmF2Y29uRnJhbWV3b3JrL25hdmNvblVzZXJQcm9maWxlL25hdmNvblVzZXJQcm9maWxlU21hbGwuZGlyZWN0aXZlLmpzIiwiYXBwL211bHRpc2VsZWN0L211bHRpc2VsZWN0Y2hlY2tib3guanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUN2Q0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUMzNElBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDN0NBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDdEdBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDOWpDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQzNqQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUN2YUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUN2eUJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNqSkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQzFEQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNodENBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNoQkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDM0RBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDdk9BO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDM0VBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDeEJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQzVSQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDNUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUM5VUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDUkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDNUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDdERBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ2hYQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNoQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQzlDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDL0JBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDakNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQzFIQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDbkJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDcENBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ2xWQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDL0JBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDOVdBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNwR0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUM5QkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQzNPQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDclJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDdGhCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUM5REE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDanhCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ2hEQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDckZBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ2xQQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDM0ZBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNySUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQzdWQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUMzR0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDaENBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ2hDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDekVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUN2TUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ3pCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDNUhBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ3ZFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ2poQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUM3VUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUM3Q0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUMxUkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ25CQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUMxdUJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNyTEE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUM3Q0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUM5RUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDcEJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNyQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ2xDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNyR0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDdkJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNwREE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNyRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNqRkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQzdEQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ3BGQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUM5SkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQzFHQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQy9NQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNwS0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDamlCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ1RBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDVEE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EiLCJmaWxlIjoicm1zX2FwcC43MGNkN2Q1Zi5qcyIsInNvdXJjZXNDb250ZW50IjpbIihmdW5jdGlvbigpIHtcclxuICAgICd1c2Ugc3RyaWN0JztcclxuICAgIGFuZ3VsYXIubW9kdWxlKCdhcHAuY29yZScsIFtcclxuICAgICAgICAvKlxyXG4gICAgICAgICAqIEFuZ3VsYXIgbW9kdWxlc1xyXG4gICAgICAgICAqL1xyXG4gICAgICAgICduZ0FuaW1hdGUnLCAnbmdSb3V0ZScsICduZ1Nhbml0aXplJyxcclxuICAgICAgICAvKlxyXG4gICAgICAgICAqIE91ciByZXVzYWJsZSBjcm9zcyBhcHAgY29kZSBtb2R1bGVzXHJcbiAgICAgICAgICovXHJcbiAgICAgICAgJ2Jsb2Nrcy5leGNlcHRpb24nLCAnYmxvY2tzLmxvZ2dlcicsICdibG9ja3Mucm91dGVyJyxcclxuICAgICAgICAvKlxyXG4gICAgICAgICAqIDNyZCBQYXJ0eSBtb2R1bGVzXHJcbiAgICAgICAgICovXHJcbiAgICAgICAgJ25ncGx1cydcclxuICAgIF0pO1xyXG5cclxuICAgIGFuZ3VsYXIubW9kdWxlKCdibG9ja3MubG9nZ2VyJywgW10pO1xyXG4gICAgYW5ndWxhci5tb2R1bGUoJ2Jsb2Nrcy5yb3V0ZXInLCBbXHJcbiAgICAgICAgJ25nUm91dGUnLFxyXG4gICAgICAgICdibG9ja3MubG9nZ2VyJ1xyXG4gICAgXSk7XHJcbiAgICBhbmd1bGFyLm1vZHVsZSgnYmxvY2tzLmV4Y2VwdGlvbicsIFsnYmxvY2tzLmxvZ2dlciddKTtcclxuXHJcbiAgICBhbmd1bGFyLm1vZHVsZShcIm5hdmNvbkRhc2hib2FyZFwiLCBbXCJncmlkc3RlclwiLCBcInVpLmJvb3RzdHJhcFwiLCBcIm5nLWZ1c2lvbmNoYXJ0c1wiXSk7XHJcbiAgICBhbmd1bGFyLm1vZHVsZShcIm5hdmNvbkZyYW1ld29ya1wiLCBbXCJuYXZjb25NZW51XCIsIFwibmF2Y29uRGFzaGJvYXJkXCJdKTtcclxuICAgIGFuZ3VsYXIubW9kdWxlKFwibmF2Y29uTWVudVwiLCBbXCJuZ0FuaW1hdGVcIl0pO1xyXG5cclxuICAgIGFuZ3VsYXIubW9kdWxlKCdhcHAuY2hhbmdlcGFzc3dvcmQnLCBbXSk7XHJcbiAgICBhbmd1bGFyLm1vZHVsZSgnYXBwLmRhc2hib2FyZCcsIFtdKTtcclxuICAgIGFuZ3VsYXIubW9kdWxlKCdhcHAubG9naW4nLCBbXSk7XHJcbiAgICBhbmd1bGFyLm1vZHVsZSgnYXBwLnVzZXJwcm9maWxlJywgW10pO1xyXG4gICAgYW5ndWxhci5tb2R1bGUoJ2FwcC5yb2xlbWFuYWdlbWVudCcsIFtdKTtcclxuICAgIGFuZ3VsYXIubW9kdWxlKCdhcHAudGlsZXMnLCBbXSk7XHJcbiAgICBhbmd1bGFyLm1vZHVsZSgnYXBwLnVzZXJhY2Nlc3NyaWdodHMnLCBbXSk7XHJcbiAgICBhbmd1bGFyLm1vZHVsZSgnYXBwLnVzZXJtYW5hZ2VtZW50JywgW10pO1xyXG4gICAgYW5ndWxhci5tb2R1bGUoJ2FwcC5waG90bycsIFtdKTtcclxuICAgIGFuZ3VsYXIubW9kdWxlKCdhcHAubmV3cycsIFtdKTtcclxuICAgIGFuZ3VsYXIubW9kdWxlKCdhcHAudXNlcmltcG9ydCcsIFtdKTtcclxufSkoKTsiLCJ2YXIgbmF2Y29uID0gKGZ1bmN0aW9uICgpIHtcclxuXHJcbiAgICB2YXIgd2ViVXJsID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHJldHVybiB3aW5kb3cuZG9jdW1lbnQuVVJMO1xyXG4gICAgfTtcclxuXHJcbiAgICB2YXIgZ2V0QXBwU2NvcGUgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgdmFyIGFwcEVsZW1lbnQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCdbbmctYXBwPWFwcF0nKTtcclxuICAgICAgICB2YXIgYXBwU2NvcGUgPSBhbmd1bGFyLmVsZW1lbnQoYXBwRWxlbWVudCkuc2NvcGUoKTtcclxuICAgICAgICByZXR1cm4gZ2V0QXBwU2NvcGU7XHJcbiAgICB9XHJcbiAgICB2YXIgZGVmYXVsdEZvcm1hdCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICB2YXIgZm9ybWF0RGF0YSA9IHtcclxuICAgICAgICAgICAgXCJkYXRlXCI6IFwiREQvTU0vWVlZWVwiLFxyXG4gICAgICAgICAgICBcImRhdGV0aW1lXCI6IFwiREQvTU0vWVlZWSBoaDptbTpzcyBBXCIsXHJcbiAgICAgICAgICAgIFwidXRjXCI6IFwiWVlZWS1NTS1ERCBISDptbTpzc1wiLFxyXG4gICAgICAgICAgICBcInRpbWVab25lXCI6ICgoLTEpICogKG5ldyBEYXRlKCkuZ2V0VGltZXpvbmVPZmZzZXQoKSkpLFxyXG4gICAgICAgICAgICBcImRhdGV0eXBlXCI6IFwiZGF0ZS11a1wiLFxyXG4gICAgICAgICAgICBcImRhdGVEaXNwbGF5XCI6IFwiTU1NTSBELCBZWVlZXCIsXHJcbiAgICAgICAgICAgIFwia2RhdGVcIjogXCJkZC9NTS95eXl5XCIsXHJcbiAgICAgICAgfTtcclxuICAgICAgICByZXR1cm4gZm9ybWF0RGF0YTtcclxuICAgIH07XHJcbiAgICB2YXIgZ2V0RGlzdGluY3Rmcm9tSlNPTiA9IGZ1bmN0aW9uIChvYmosIGtleSkge1xyXG4gICAgICAgIHZhciBkaXN0aW5jdElkcyA9IFtdO1xyXG4gICAgICAgIHZhciBkaXN0aW5jdEFycmF5ID0gW107XHJcbiAgICAgICAgb2JqLmZpbHRlcihmdW5jdGlvbiAodiwgaSkge1xyXG4gICAgICAgICAgICBpZiAoZGlzdGluY3RJZHMuaW5kZXhPZih2W2tleV0pID09IC0xKSB7XHJcbiAgICAgICAgICAgICAgICBkaXN0aW5jdElkcy5wdXNoKHZba2V5XSk7XHJcbiAgICAgICAgICAgICAgICBkaXN0aW5jdEFycmF5LnB1c2godik7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgICAgICBvYmogPSBkaXN0aW5jdEFycmF5O1xyXG4gICAgICAgIHJldHVybiBvYmo7XHJcbiAgICB9O1xyXG5cclxuICAgIHZhciBnZXRGaWx0ZXJvYmplY3Rmcm9tSlNPTiA9IGZ1bmN0aW9uIChvYmosIGtleTEsIHZhbHVlKSB7XHJcblxyXG4gICAgICAgIHZhciBNYXRjaGVkQXJyYXkgPSBbXTtcclxuICAgICAgICAkLmVhY2gob2JqLCBmdW5jdGlvbiAodiwgaSkge1xyXG4gICAgICAgICAgICBpZiAoaVtrZXkxXSA9PSB2YWx1ZSkge1xyXG4gICAgICAgICAgICAgICAgTWF0Y2hlZEFycmF5LnB1c2goaSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgICAgICByZXR1cm4gTWF0Y2hlZEFycmF5O1xyXG4gICAgfTtcclxuXHJcbiAgICB2YXIgZ2V0TWF0Y2hlZG9iamVjdGZyb21KU09OID0gZnVuY3Rpb24gKG9iaiwga2V5MSwga2V5MiwgdmFsdWUpIHtcclxuXHJcbiAgICAgICAgdmFyIGRpc3RpbmN0TWF0Y2hlZEFycmF5ID0gW107XHJcbiAgICAgICAgdmFyIGRpc3RpbmN0SWRzID0gW107XHJcbiAgICAgICAgJC5lYWNoKG9iaiwgZnVuY3Rpb24gKHYsIGkpIHtcclxuICAgICAgICAgICAgaWYgKGlba2V5MV0gPT0gdmFsdWUgJiYgZGlzdGluY3RJZHMuaW5kZXhPZihpW2tleTJdKSA9PSAtMSkge1xyXG4gICAgICAgICAgICAgICAgZGlzdGluY3RJZHMucHVzaChpW2tleTJdKTtcclxuICAgICAgICAgICAgICAgIGRpc3RpbmN0TWF0Y2hlZEFycmF5LnB1c2goaSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgICAgICByZXR1cm4gZGlzdGluY3RNYXRjaGVkQXJyYXk7XHJcbiAgICB9O1xyXG5cclxuICAgIHZhciB0YWJsZVNvcnRERE1NWVlZRUV4dCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICBqUXVlcnkuZXh0ZW5kKGpRdWVyeS5mbi5kYXRhVGFibGVFeHQub1NvcnQsIHtcclxuICAgICAgICAgICAgXCJkYXRlLXVrLXByZVwiOiBmdW5jdGlvbiAoYSkge1xyXG4gICAgICAgICAgICAgICAgdmFyIHVrRGF0ZXRpbWVhID0gYS5zcGxpdChcIiBcIik7XHJcblxyXG4gICAgICAgICAgICAgICAgdmFyIHVrRGF0ZWEgPSB1a0RhdGV0aW1lYVswXS5zcGxpdCgnLycpO1xyXG4gICAgICAgICAgICAgICAgaWYgKHVrRGF0ZWEubGVuZ3RoID09PSAxICYmIHVrRGF0ZWFbMF0gPT09IFwiXCIpXHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIDE7XHJcbiAgICAgICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAodWtEYXRldGltZWEubGVuZ3RoID4gMSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgdWt0aW1lYSA9IHVrRGF0ZXRpbWVhWzFdLnNwbGl0KFwiOlwiKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHVrYW0gPSAxO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAodWtEYXRldGltZWEubGVuZ3RoID4gMikgdWthbSA9IHVrRGF0ZXRpbWVhWzJdLnRvU3RyaW5nKCkgPT09IFwiUE1cIiA/IDIgOiAxO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICh1a0RhdGVhWzJdICsgdWtEYXRlYVsxXSArIHVrRGF0ZWFbMF0gKyB1a2FtICsgdWt0aW1lYVswXSArIHVrdGltZWFbMV0gKyB1a3RpbWVhWzJdKSAqIDE7XHJcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICh1a0RhdGVhWzJdICsgdWtEYXRlYVsxXSArIHVrRGF0ZWFbMF0pICogMTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0sXHJcblxyXG4gICAgICAgICAgICBcImRhdGUtdWstYXNjXCI6IGZ1bmN0aW9uIChhLCBiKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gKChhIDwgYikgPyAtMSA6ICgoYSA+IGIpID8gMSA6IDApKTtcclxuICAgICAgICAgICAgfSxcclxuXHJcbiAgICAgICAgICAgIFwiZGF0ZS11ay1kZXNjXCI6IGZ1bmN0aW9uIChhLCBiKSB7XHJcblxyXG4gICAgICAgICAgICAgICAgcmV0dXJuICgoYSA8IGIpID8gMSA6ICgoYSA+IGIpID8gLTEgOiAwKSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgIH1cclxuXHJcbiAgICB2YXIgdGFibGVTZXR0aW5nID0gZnVuY3Rpb24gKGVsLCBvcHRpb25zLCBzY29wZSkge1xyXG5cclxuICAgICAgICB2YXIgdGFibGUgPSAkKCQoZWwpLmZpbmQoJ3RhYmxlJylbMF0pO1xyXG5cclxuICAgICAgICB2YXIgc2VsZiA9IHRoaXM7XHJcblxyXG4gICAgICAgIHZhciBmaWx0ZXJCYXIgPSB7fTtcclxuICAgICAgICBpZiAob3B0aW9ucyAhPSB1bmRlZmluZWQgJiYgb3B0aW9ucy5maWx0ZXJCYXIgIT09IHVuZGVmaW5lZCkgZmlsdGVyQmFyID0gb3B0aW9ucy5maWx0ZXJCYXI7XHJcblxyXG4gICAgICAgIGlmIChvcHRpb25zLmFvQ29sdW1uRGVmcyAhPT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgICAgIG9wdGlvbnMuYW9Db2x1bW5EZWZzLnB1c2goe1xyXG4gICAgICAgICAgICAgICAgXCJyZW5kZXJcIjogZnVuY3Rpb24gKGRhdGEsIHR5cGUsIHJvdywgcG9zKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHBvcy5zZXR0aW5ncy5hb0NvbHVtbnNbcG9zLmNvbF0udGltZSAhPT0gdW5kZWZpbmVkICYmIHBvcy5zZXR0aW5ncy5hb0NvbHVtbnNbcG9zLmNvbF0udGltZSA9PT0gdHJ1ZSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGRhdGVGcm9tVVRDVG9Mb2NhbChkYXRhLCAoZGVmYXVsdEZvcm1hdCgpLmRhdGV0aW1lIHx8ICdERC9NTS9ZWVlZIEhIOm1tOnNzJykpO1xyXG4gICAgICAgICAgICAgICAgICAgIGVsc2VcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGRhdGVGcm9tVVRDVG9Mb2NhbChkYXRhLCAoZGVmYXVsdEZvcm1hdCgpLmRhdGUgfHwgXCJERC9NTS9ZWVlZXCIpKTtcclxuICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICBcInRhcmdldHNcIjogb3B0aW9ucy5kYXRlRmllbGRzXHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgdmFyIGRhdGF0YWJsZURhdGVDb2x1bVR5cGUgPSBmdW5jdGlvbiAob3B0aW9ucywgY29sdW1zKSB7XHJcbiAgICAgICAgICAgIGlmIChvcHRpb25zLmRhdGVGaWVsZHMgIT09IHVuZGVmaW5lZCAmJiBvcHRpb25zLmRhdGVGaWVsZHMgIT09IG51bGwgJiYgb3B0aW9ucy5kYXRlRmllbGRzLmxlbmd0aCAhPT0gMCkge1xyXG4gICAgICAgICAgICAgICAgJC5tYXAoY29sdW1zLCBmdW5jdGlvbiAoaXRlbSwgaW5kZXgpIHtcclxuICAgICAgICAgICAgICAgICAgICAkLm1hcChvcHRpb25zLmRhdGVGaWVsZHMsIGZ1bmN0aW9uIChkYXRhLCBpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChkYXRhID09PSBpbmRleCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaXRlbVtcInR5cGVcIl0gPSBkZWZhdWx0Rm9ybWF0KCkuZGF0ZXR5cGU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpdGVtW1wic1R5cGVcIl0gPSBkZWZhdWx0Rm9ybWF0KCkuZGF0ZXR5cGU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHJldHVybiBjb2x1bXM7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIG9UYWJsZSA9IHRhYmxlLkRhdGFUYWJsZSh7XHJcbiAgICAgICAgICAgIFwib0xhbmd1YWdlXCI6IHtcclxuICAgICAgICAgICAgICAgIFwic1NlYXJjaFwiOiBcIjxzcGFuIGNsYXNzPSdpbnB1dC1pbmxpbmUgZHRGaWx0ZXJTZWFyY2gnPjxpIGNsYXNzPSdmYSBmYS1zZWFyY2gnPjwvaT48L3NwYW4+XCJcclxuICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgc2VsZWN0OiB0cnVlLFxyXG4gICAgICAgICAgICAvKnNlbGVjdDoge1xyXG4gICAgICAgICAgICAgICAgc3R5bGU6ICdzaW5nbGUnXHJcbiAgICAgICAgICAgIH0sKi9cclxuICAgICAgICAgICAgYnV0dG9uczogb3B0aW9ucy5idXR0b25zLFxyXG4gICAgICAgICAgICBcImJEZXN0cm95XCI6IHRydWUsXHJcbiAgICAgICAgICAgIFwiYlBhZ2luYXRlXCI6IGZpbHRlckJhci5wYWdpbmF0ZSAhPT0gdW5kZWZpbmVkID8gZmlsdGVyQmFyLnBhZ2luYXRlIDogdHJ1ZSwgLy9oaWRlIHBhZ2luYXRpb25cclxuICAgICAgICAgICAgXCJiRmlsdGVyXCI6IGZpbHRlckJhci5maWx0ZXIgIT09IHVuZGVmaW5lZCA/IGZpbHRlckJhci5maWx0ZXIgOiB0cnVlLCAvL2hpZGUgU2VhcmNoIGJhclxyXG4gICAgICAgICAgICBcImJJbmZvXCI6IGZpbHRlckJhci5pbmZvICE9PSB1bmRlZmluZWQgPyBmaWx0ZXJCYXIuaW5mbyA6IHRydWUsIC8vIGhpZGUgc2hvd2luZyBlbnRyaWVzXHJcbiAgICAgICAgICAgIFwiYkF1dG9XaWR0aFwiOiBvcHRpb25zLmF1dG9XaWR0aCxcclxuICAgICAgICAgICAgXCJsYW5ndWFnZVwiOiB7XHJcbiAgICAgICAgICAgICAgICBcImFyaWFcIjoge1xyXG4gICAgICAgICAgICAgICAgICAgIFwic29ydEFzY2VuZGluZ1wiOiBcIjogYWN0aXZhdGUgdG8gc29ydCBjb2x1bW4gYXNjZW5kaW5nXCIsXHJcbiAgICAgICAgICAgICAgICAgICAgXCJzb3J0RGVzY2VuZGluZ1wiOiBcIjogYWN0aXZhdGUgdG8gc29ydCBjb2x1bW4gZGVzY2VuZGluZ1wiXHJcbiAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgXCJlbXB0eVRhYmxlXCI6IFwiTm8gZGF0YSBhdmFpbGFibGUgaW4gdGFibGVcIixcclxuICAgICAgICAgICAgICAgIFwiaW5mb1wiOiBcIlNob3dpbmcgX1NUQVJUXyB0byBfRU5EXyBvZiBfVE9UQUxfIGVudHJpZXNcIixcclxuICAgICAgICAgICAgICAgIFwiaW5mb0VtcHR5XCI6IFwiTm8gZW50cmllcyBmb3VuZFwiLFxyXG4gICAgICAgICAgICAgICAgXCJpbmZvRmlsdGVyZWRcIjogXCIoZmlsdGVyZWQxIGZyb20gX01BWF8gdG90YWwgZW50cmllcylcIixcclxuICAgICAgICAgICAgICAgIFwibGVuZ3RoTWVudVwiOiBcIlNob3cgX01FTlVfIGVudHJpZXNcIixcclxuICAgICAgICAgICAgICAgIFwic2VhcmNoXCI6IFwiU2VhcmNoOlwiLFxyXG4gICAgICAgICAgICAgICAgXCJ6ZXJvUmVjb3Jkc1wiOiBcIk5vIG1hdGNoaW5nIHJlY29yZHMgZm91bmRcIlxyXG4gICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICBcImRvbVwiOiBcIjwncm93JyA8J2NvbC1tZC0xMidUPj48J3Jvdyc8J2NvbC1tZC02IGNvbC1zbS0xMidsPjwnY29sLW1kLTYgY29sLXNtLTEyJ2Y+cj48J3RhYmxlLXNjcm9sbGFibGUndD48J3Jvdyc8J2NvbC1tZC01IGNvbC1zbS0xMidpPjwnY29sLW1kLTcgY29sLXNtLTEyJ3A+PlwiLFxyXG4gICAgICAgICAgICBcImFvQ29sdW1uRGVmc1wiOiBvcHRpb25zLmFvQ29sdW1uRGVmcyxcclxuICAgICAgICAgICAgXCJvcmRlclwiOiBvcHRpb25zLm9yZGVyLFxyXG4gICAgICAgICAgICBcImxlbmd0aE1lbnVcIjogW1s1LCAxMCwgMTUsIDIwLCAtMV0sIFs1LCAxMCwgMTUsIDIwLCBcIkFsbFwiXV0sLy8gY2hhbmdlIHBlciBwYWdlIHZhbHVlcyBoZXJlXHJcbiAgICAgICAgICAgIFwiaURpc3BsYXlMZW5ndGhcIjogb3B0aW9ucy5pRGlzcGxheUxlbmd0aCxcclxuICAgICAgICAgICAgLy8gc2V0IHRoZSBpbml0aWFsIHZhbHVlXHJcbiAgICAgICAgICAgIFwicGFnZUxlbmd0aFwiOiBvcHRpb25zLnBhZ2VMZW5ndGgsXHJcbiAgICAgICAgICAgIGRhdGE6IG9wdGlvbnMuZGF0YSxcclxuICAgICAgICAgICAgY29sdW1uczogZGF0YXRhYmxlRGF0ZUNvbHVtVHlwZShvcHRpb25zLCBvcHRpb25zLmNvbHVtbnMpLFxyXG4gICAgICAgICAgICBjcmVhdGVkUm93OiBmdW5jdGlvbiAocm93LCBkYXRhLCBpbmRleCkge1xyXG4gICAgICAgICAgICAgICAgLy9zZXRBcHBydm9lZFRhYmxlQ29sdW1uT3B0aW9ucyhyb3csIGRhdGEsIG9wdGlvbnMpO1xyXG4gICAgICAgICAgICAgICAgaWYgKG9wdGlvbnMuY29sdW1ucyAhPT0gdW5kZWZpbmVkICYmIG9wdGlvbnMuY29sdW1ucy5sZW5ndGggPiAwKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgJC5tYXAob3B0aW9ucy5jb2x1bW5zLCBmdW5jdGlvbiAoaXRlbSwgY29sSW5kZXgpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGl0ZW0uc2VyaWFsTm9Db2x1bW4gIT09IHVuZGVmaW5lZCAmJiBpdGVtLnNlcmlhbE5vQ29sdW1uICE9IG51bGwpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICQocm93KS5jaGlsZHJlbigpLmVxKGl0ZW0uc2VyaWFsTm9Db2x1bW4pLmh0bWwoKGluZGV4ICsgMSkpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBpZiAoc2NvcGUubmF2Y29uRGF0YS50YWJsZVJvd1VwZGF0ZSAhPT0gdW5kZWZpbmVkKVxyXG4gICAgICAgICAgICAgICAgICAgIHNjb3BlLm5hdmNvbkRhdGEudGFibGVSb3dVcGRhdGUocm93LCBkYXRhLCBpbmRleCwgc2NvcGUudHlwZSwgdGhpcywgb1RhYmxlLCBvcHRpb25zLmNvbHVtbnMpO1xyXG4gICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICBpbml0Q29tcGxldGU6IGZ1bmN0aW9uIChzZXR0aW5ncywganNvbikge1xyXG5cclxuICAgICAgICAgICAgICAgICQoXCIuZGF0YVRhYmxlc19maWx0ZXJcIikuZmluZChcImlucHV0XCIpLmFkZENsYXNzKFwiZm9ybS1jb250cm9sIGlucHV0LW1lZGl1bSBpbnB1dC1pbmxpbmVcIik7XHJcbiAgICAgICAgICAgICAgICB2YXIgaVRhYmxlID0gdGhpcy5EYXRhVGFibGUoKTtcclxuXHJcbiAgICAgICAgICAgICAgICBpZiAob3B0aW9ucy5idXR0b25zICE9PSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoJChcIiNEYXRhVGFibGVzX1RhYmxlXzBfZmlsdGVyXCIpLmZpbmQoJy5kdC1idXR0b25zJykubGVuZ3RoID09PSAwKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBwcmludE9iaiA9IHRoaXMucGFyZW50cygnLnBvcnRsZXQnKS5maXJzdCgpLmZpbmQoXCIudG9vbHM6Zmlyc3RcIik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlUYWJsZS5idXR0b25zKCkuY29udGFpbmVyKCkuYXBwZW5kVG8ocHJpbnRPYmopO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBwcmludE9iai5maW5kKFwiLmR0LWJ1dHRvbnNcIikuY2hpbGRyZW4oKS51bndyYXAoKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHByaW50QnV0ID0gcHJpbnRPYmouZmluZCgnLmR0LWJ1dHRvbicpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBwcmludEJ1dC5jc3MoXCJiYWNrZ3JvdW5kXCIsIFwibm9uZVwiKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcHJpbnRCdXQuY3NzKFwiYmFja2dyb3VuZC1pbWFnZVwiLCBcIm5vbmVcIik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHByaW50QnV0LmNzcyhcImJvcmRlclwiLCBcIjBweFwiKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcHJpbnRCdXQuY3NzKFwicGFkZGluZ1wiLCBcIjBweFwiKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcHJpbnRCdXQuY3NzKFwicGFkZGluZy10b3BcIiwgXCIzcHhcIik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHByaW50QnV0LmNzcyhcInRvcFwiLCBcIi0zcHhcIik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHByaW50QnV0LmNzcyhcInBvc2l0aW9uXCIsIFwicmVsYXRpdmVcIik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHByaW50QnV0LmFkZENsYXNzKFwiZmEgZmEtcHJpbnRcIik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHByaW50QnV0LmZpbmQoXCJzcGFuXCIpLnRleHQoXCJcIik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciB0YWJsZUlkID0gJChcIi50b29sczpmaXJzdFwiKS5wYXJlbnRzKFwiLnBvcnRsZXQ6Zmlyc3RcIikuZmluZChcInRhYmxlOmZpcnN0XCIpLmF0dHIoXCJpZFwiKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGlUYWJsZS5vbignYnV0dG9ucy1hY3Rpb24nLCBmdW5jdGlvbiAoZSwgYnV0dG9uQXBpLCBkYXRhVGFibGUsIG5vZGUsIGNvbmZpZykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAvL2NvbnNvbGUubG9nKCdCdXR0b24gJyArIGJ1dHRvbkFwaS50ZXh0KCkgKyAnIHdhcyBhY3RpdmF0ZWQnKTtcclxuICAgICAgICAgICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKCQoXCIjRGF0YVRhYmxlc19UYWJsZV8wX2ZpbHRlclwiKS5maW5kKCcuZHQtYnV0dG9ucycpLmxlbmd0aCA9PT0gMClcclxuICAgICAgICAgICAgICAgICAgICAgICAgaVRhYmxlLmJ1dHRvbnMoKS5jb250YWluZXIoKS5hcHBlbmRUbygkKFwiI0RhdGFUYWJsZXNfVGFibGVfMF9maWx0ZXJcIikpXHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgaWYgKG9wdGlvbnMuY29sdW1uRmlsdGVyICE9PSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLmNvbHVtbkZpbHRlcih7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHNQbGFjZUhvbGRlcjogXCJoZWFkOmFmdGVyXCIsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGFvQ29sdW1uczogb3B0aW9ucy5jb2x1bW5GaWx0ZXIuYW9Db2x1bW5zXHJcbiAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgaWYgKG9wdGlvbnMucm93c0dyb3VwICE9PSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgICAgICAgICAgICBuZXcgJC5mbi5kYXRhVGFibGUuUm93c0dyb3VwKGlUYWJsZSwgb3B0aW9ucy5yb3dzR3JvdXApO1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIG5hdmNvbi52aWV3Q29udGVudExvYWRlZCgpO1xyXG5cclxuXHJcbiAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgIGhlYWRlckNhbGxiYWNrOiBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICAvL3ZhciBzcyA9ICQodGFibGUpLmZpbmQoJ3Rib2R5Jyk7XHJcbiAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgIGRyYXdDYWxsYmFjazogZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgaWYgKHNjb3BlLm5hdmNvbkRhdGEucmlnaHRzICE9PSB1bmRlZmluZWQpXHJcbiAgICAgICAgICAgICAgICAgICAgc2V0RGlzYWJsZWRFbmFibGVkQnlSaWdodHMoc2NvcGUubmF2Y29uRGF0YS5yaWdodHMpO1xyXG5cclxuICAgICAgICAgICAgICAgIC8vRW1wdHkgcm93IGNvbHNwYW4gYW5kIHRleHQgYXNzaWduXHJcbiAgICAgICAgICAgICAgICAvL2lmICgkKHRoaXMpLmF0dHIoXCJhcmlhLWRlc2NyaWJlZGJ5XCIpICE9PSB1bmRlZmluZWQgJiYgJCh0aGlzKS5maW5kKFwidGJvZHkgdHIgdGRbY2xhc3M9ZGF0YVRhYmxlc19lbXB0eV1cIikubGVuZ3RoID09IDApIHtcclxuICAgICAgICAgICAgICAgIC8vICAgIHNldEFwcHJ2b2VkVGFibGVDb2xsZWN0aW9uKCQodGhpcyksIG9wdGlvbnMpO1xyXG4gICAgICAgICAgICAgICAgLy99XHJcbiAgICAgICAgICAgICAgICB2YXIgaVRhYmxlID0gdGhpcy5EYXRhVGFibGUoKTtcclxuICAgICAgICAgICAgICAgICQoXCIuZGF0YVRhYmxlc19maWx0ZXJcIikuZmluZChcImlucHV0XCIpLmFkZENsYXNzKFwiZm9ybS1jb250cm9sIGlucHV0LW1lZGl1bSBpbnB1dC1pbmxpbmVcIik7XHJcbiAgICAgICAgICAgICAgICAvLyAgdmFyIGlUYWJsZSA9IHRoaXMuRGF0YVRhYmxlKCk7XHJcblxyXG4gICAgICAgICAgICAgICAgaWYgKG9wdGlvbnMuYnV0dG9ucyAhPT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKCQoXCIjRGF0YVRhYmxlc19UYWJsZV8wX2ZpbHRlclwiKS5maW5kKCcuZHQtYnV0dG9ucycpLmxlbmd0aCA9PT0gMCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgcHJpbnRPYmogPSB0aGlzLnBhcmVudHMoJy5wb3J0bGV0JykuZmlyc3QoKS5maW5kKFwiLnRvb2xzOmZpcnN0XCIpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpVGFibGUuYnV0dG9ucygpLmNvbnRhaW5lcigpLmFwcGVuZFRvKHByaW50T2JqKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcHJpbnRPYmouZmluZChcIi5kdC1idXR0b25zXCIpLmNoaWxkcmVuKCkudW53cmFwKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBwcmludEJ1dCA9IHByaW50T2JqLmZpbmQoJy5kdC1idXR0b24nKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcHJpbnRCdXQuY3NzKFwiYmFja2dyb3VuZFwiLCBcIm5vbmVcIik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHByaW50QnV0LmNzcyhcImJhY2tncm91bmQtaW1hZ2VcIiwgXCJub25lXCIpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBwcmludEJ1dC5jc3MoXCJib3JkZXJcIiwgXCIwcHhcIik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHByaW50QnV0LmNzcyhcInBhZGRpbmdcIiwgXCIwcHhcIik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHByaW50QnV0LmNzcyhcInBhZGRpbmctdG9wXCIsIFwiM3B4XCIpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBwcmludEJ1dC5jc3MoXCJ0b3BcIiwgXCItM3B4XCIpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBwcmludEJ1dC5jc3MoXCJwb3NpdGlvblwiLCBcInJlbGF0aXZlXCIpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBwcmludEJ1dC5hZGRDbGFzcyhcImZhIGZhLXByaW50XCIpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBwcmludEJ1dC5maW5kKFwic3BhblwiKS50ZXh0KFwiXCIpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgdGFibGVJZCA9ICQoXCIudG9vbHM6Zmlyc3RcIikucGFyZW50cyhcIi5wb3J0bGV0OmZpcnN0XCIpLmZpbmQoXCJ0YWJsZTpmaXJzdFwiKS5hdHRyKFwiaWRcIik7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICAgICBpVGFibGUub24oJ2J1dHRvbnMtYWN0aW9uJywgZnVuY3Rpb24gKGUsIGJ1dHRvbkFwaSwgZGF0YVRhYmxlLCBub2RlLCBjb25maWcpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgLy9jb25zb2xlLmxvZygnQnV0dG9uICcgKyBidXR0b25BcGkudGV4dCgpICsgJyB3YXMgYWN0aXZhdGVkJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGlmICgkKFwiI0RhdGFUYWJsZXNfVGFibGVfMF9maWx0ZXJcIikuZmluZCgnLmR0LWJ1dHRvbnMnKS5sZW5ndGggPT09IDApXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlUYWJsZS5idXR0b25zKCkuY29udGFpbmVyKCkuYXBwZW5kVG8oJChcIiNEYXRhVGFibGVzX1RhYmxlXzBfZmlsdGVyXCIpKVxyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIGlmIChvcHRpb25zLmNvbHVtbkZpbHRlciAhPT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5jb2x1bW5GaWx0ZXIoe1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBzUGxhY2VIb2xkZXI6IFwiaGVhZDphZnRlclwiLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBhb0NvbHVtbnM6IG9wdGlvbnMuY29sdW1uRmlsdGVyLmFvQ29sdW1uc1xyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuXHJcblxyXG4gICAgICAgICAgICAgICAgbmF2Y29uLnZpZXdDb250ZW50TG9hZGVkKCk7XHJcblxyXG5cclxuICAgICAgICAgICAgICAgIC8vRW1wdHkgcm93IGNvbHNwYW4gYW5kIHRleHQgYXNzaWduXHJcbiAgICAgICAgICAgICAgICBpZiAoJCh0aGlzKS5maW5kKFwidGJvZHkgdHIgdGRbY2xhc3M9ZGF0YVRhYmxlc19lbXB0eV1cIikubGVuZ3RoID09IDEpIHtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIHRvdGFsQ29sdW1uID0gJCh0aGlzKS5maW5kKFwidGhlYWQgdHIgdGhcIikubGVuZ3RoO1xyXG4gICAgICAgICAgICAgICAgICAgICQodGhpcykuZmluZChcInRib2R5IHRyIHRkW2NsYXNzPWRhdGFUYWJsZXNfZW1wdHldXCIpLmF0dHIoXCJjb2xzcGFuXCIsIHRvdGFsQ29sdW1uKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIGRpc3BsYXlUZXh0ID0gXCJObyByZWNvcmRzIGZvdW5kXCI7IC8vXCJObyBkYXRhIGF2YWlsYWJsZSBpbiB0YWJsZVwiO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmICgkKHRoaXMpLnBhcmVudCgpICE9PSB1bmRlZmluZWRcclxuICAgICAgICAgICAgICAgICAgICAgICAgJiYgJCh0aGlzKS5wYXJlbnQoKS5wYXJlbnQoKSAhPT0gdW5kZWZpbmVkXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICYmICQodGhpcykucGFyZW50KCkucGFyZW50KCkucGFyZW50KCkgIT09IHVuZGVmaW5lZFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAmJiAkKHRoaXMpLnBhcmVudCgpLnBhcmVudCgpLnBhcmVudCgpLnBhcmVudCgpICE9PSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHNldHRpbmdzID0gJCh0aGlzKS5wYXJlbnQoKS5wYXJlbnQoKS5wYXJlbnQoKS5wYXJlbnQoKS5hdHRyKFwidGFibGUtc2V0dGluZ3NcIik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChzZXR0aW5ncy50b1N0cmluZygpLmxhc3RJbmRleE9mKFwiLlwiKSA+IDApIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBuYXZkYXRhID0gc2NvcGUubmF2Y29uRGF0YVtzZXR0aW5ncy50b1N0cmluZygpLnN1YnN0cmluZyhzZXR0aW5ncy50b1N0cmluZygpLmxhc3RJbmRleE9mKFwiLlwiKSArIDEpXTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChuYXZkYXRhICE9PSB1bmRlZmluZWQgJiYgbmF2ZGF0YS5lbXB0eVRleHQgIT09IHVuZGVmaW5lZClcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkaXNwbGF5VGV4dCA9IG5hdmRhdGEuZW1wdHlUZXh0O1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIG5hdmRhdGEgPSBzY29wZS5uYXZjb25EYXRhW3NldHRpbmdzLnRvU3RyaW5nKCldO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKG5hdmRhdGEgIT09IHVuZGVmaW5lZCAmJiBuYXZkYXRhLmVtcHR5VGV4dCAhPT0gdW5kZWZpbmVkKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRpc3BsYXlUZXh0ID0gbmF2ZGF0YS5lbXB0eVRleHQ7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICQodGhpcykuZmluZChcInRib2R5IHRyIHRkW2NsYXNzPWRhdGFUYWJsZXNfZW1wdHldXCIpLnRleHQoZGlzcGxheVRleHQpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIC8vIHNldFRpbWVvdXQoZnVuY3Rpb24oKXtcclxuICAgICAgICAgICAgICAgICQoJy5kYXRhVGFibGVzX3BhZ2luYXRlLnBhZ2luZ19zaW1wbGVfbnVtYmVycycpLmZpcnN0KCkucGFyZW50KCkuY3NzKFwibWFyZ2luLWxlZnRcIiwgXCItMTVweFwiKTtcclxuICAgICAgICAgICAgICAgIC8vJCgnLnBhZ2luYXRlX2J1dHRvbi5uZXh0JykuZmlyc3QoKS5jc3MoXCJtYXJnaW4tbGVmdFwiLFwiM3B4XCIpO1xyXG4gICAgICAgICAgICAgICAgLy99LDUwKVxyXG5cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICAvL2ZvY3Vzb3V0IGNsaWNrXHJcbiAgICAgICAgJCh0YWJsZSkuZmluZCgndGJvZHknKS5vbignY2hhbmdlJywgJ3RkJywgZnVuY3Rpb24gKGVsKSB7XHJcbiAgICAgICAgICAgIHZhciB0ciA9ICQodGhpcykuY2xvc2VzdChcInRyXCIpO1xyXG4gICAgICAgICAgICB2YXIgcm93ID0gdHIuaW5kZXgoKTtcclxuICAgICAgICAgICAgdmFyIGluZGV4ID0gb1RhYmxlLmNlbGwodGhpcykuaW5kZXgoKTtcclxuICAgICAgICAgICAgdmFyIGNvbHVtbiA9IGluZGV4LmNvbHVtbjtcclxuICAgICAgICAgICAgdmFyIHJvd0RhdGEgPSBvVGFibGUucm93KHRyKS5kYXRhKCk7XHJcbiAgICAgICAgICAgIHZhciBjZWxsRGF0YSA9IG9UYWJsZS5jZWxsKHRoaXMpLmRhdGEoKTtcclxuICAgICAgICAgICAgdmFyIGNvbEhlYWRlciA9ICQob1RhYmxlLmNvbHVtbihjb2x1bW4pLmhlYWRlcigpKS5odG1sKCk7XHJcblxyXG4gICAgICAgICAgICBpZiAoZWwuc3JjRWxlbWVudC50eXBlID09IFwiY2hlY2tib3hcIikge1xyXG4gICAgICAgICAgICAgICAgaWYgKGVsLnNyY0VsZW1lbnQuY2hlY2tlZCA9PT0gdHJ1ZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChvVGFibGUucm93KHRyKS5kYXRhKClbY29sSGVhZGVyXSAhPT0gdW5kZWZpbmVkKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICBvVGFibGUucm93KHRyKS5kYXRhKClbY29sSGVhZGVyXSA9IDE7XHJcbiAgICAgICAgICAgICAgICAgICAgZWxzZVxyXG4gICAgICAgICAgICAgICAgICAgICAgICBvVGFibGUucm93KHRyKS5kYXRhKClbY29sSGVhZGVyLnRvTG93ZXJDYXNlKCldID0gMTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChvVGFibGUucm93KHRyKS5kYXRhKClbY29sSGVhZGVyXSAhPT0gdW5kZWZpbmVkKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICBvVGFibGUucm93KHRyKS5kYXRhKClbY29sSGVhZGVyXSA9IDA7XHJcbiAgICAgICAgICAgICAgICAgICAgZWxzZVxyXG4gICAgICAgICAgICAgICAgICAgICAgICBvVGFibGUucm93KHRyKS5kYXRhKClbY29sSGVhZGVyLnRvTG93ZXJDYXNlKCldID0gMDtcclxuICAgICAgICAgICAgICAgIH1cclxuXHJcblxyXG4gICAgICAgICAgICB9IGVsc2UgaWYgKGVsLnNyY0VsZW1lbnQudHlwZSA9PSBcInRleHRcIikge1xyXG4gICAgICAgICAgICAgICAgb1RhYmxlLmNlbGwodGhpcykuZGF0YShzZXRUYWJsZUNlbGxWYWx1ZShjZWxsRGF0YSwgZWwuc3JjRWxlbWVudCkpO1xyXG4gICAgICAgICAgICAgICAgc2V0VGFibGVUb3RhbENlbGxWYWx1ZShvVGFibGUsIHRoaXMsIG9wdGlvbnMsIGNvbHVtbiwgY29sSGVhZGVyKTtcclxuXHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBvVGFibGUuY2VsbCh0aGlzKS5kYXRhKHNldFRhYmxlQ2VsbFZhbHVlKGNlbGxEYXRhLCBlbC5zcmNFbGVtZW50KSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgICAgICAvL2NlbGwgY2xpY2tcclxuICAgICAgICAkKHRhYmxlKS5maW5kKCd0Ym9keScpLm9uKCdjbGljaycsICd0ZCcsIGZ1bmN0aW9uIChlbCwgdHQpIHtcclxuXHJcbiAgICAgICAgICAgICQoXCIuc2VsZWN0ZWRcIikucmVtb3ZlQ2xhc3MoXCJzZWxlY3RlZFwiKTtcclxuICAgICAgICAgICAgJChlbC5jdXJyZW50VGFyZ2V0KS5wYXJlbnQoKS5hZGRDbGFzcyhcInNlbGVjdGVkXCIpO1xyXG4gICAgICAgICAgICB2YXIgY29sdW1uLCBjb2xIZWFkZXIsIGRhdGEsIGhlYWRlclRpdGxlO1xyXG4gICAgICAgICAgICAkKCQoZWwuY3VycmVudFRhcmdldCkucGFyZW50cygndGFibGUnKVswXSkuZmluZCgndHI6bm90KDpmaXJzdC1jaGlsZCknKS5jc3MoXCJiYWNrZ3JvdW5kLWNvbG9yXCIsIFwidHJhbnNwYXJlbnRcIik7XHJcbiAgICAgICAgICAgIHZhciB0ciA9ICQodGhpcykuY2xvc2VzdChcInRyXCIpO1xyXG4gICAgICAgICAgICB2YXIgcm93ID0gdHIuaW5kZXgoKTtcclxuXHJcbiAgICAgICAgICAgIC8vbmVlZCB0byBjaGFuZ2Ugc3RhdGljIGNvbG9yXHJcbiAgICAgICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgJCh0clswXSkuY3NzKFwiYmFja2dyb3VuZC1jb2xvclwiLCBcIiNCMEJFRDlcIik7XHJcbiAgICAgICAgICAgIH0sIDIwMCk7XHJcblxyXG4gICAgICAgICAgICBpZiAodHIgPT09IHVuZGVmaW5lZCB8fCBvVGFibGUucm93KHRyKS5kYXRhKCkgPT09IHVuZGVmaW5lZCkge1xyXG4gICAgICAgICAgICAgICAgZGF0YSA9IG9UYWJsZS5yb3coJCh0aGlzKS5wYXJlbnQoKS5wcmV2KCkpLmRhdGEoKTtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIGRhdGEgPSBvVGFibGUucm93KHRyKS5kYXRhKCk7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGlmIChvVGFibGUuY2VsbCh0aGlzKS5pbmRleCgpID09PSB1bmRlZmluZWQgJiYgJChlbC50YXJnZXQpLmNsb3Nlc3QoJ2xpJykubGVuZ3RoICE9PSAwKSB7XHJcbiAgICAgICAgICAgICAgICBjb2x1bW4gPSBwYXJzZUZsb2F0KCQoZWwudGFyZ2V0KS5jbG9zZXN0KCdsaScpLmF0dHIoXCJkYXRhLWR0LWNvbHVtblwiKSk7XHJcbiAgICAgICAgICAgICAgICBjb2xIZWFkZXIgPSAkKGVsLnRhcmdldCkuY2xvc2VzdCgnbGknKS5maW5kKCdzcGFuW2NsYXNzPVwiZHRyLXRpdGxlXCJdJykudGV4dCgpO1xyXG4gICAgICAgICAgICAgICAgaGVhZGVyVGl0bGUgPSAkKGVsLnRhcmdldCkuY2xvc2VzdCgnbGknKS5maW5kKCdzcGFuW2NsYXNzPVwiZHRyLXRpdGxlXCJdJykudGV4dCgpLnRvTG93ZXJDYXNlKCk7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBjb2x1bW4gPSBvVGFibGUuY2VsbCh0aGlzKS5pbmRleCgpLmNvbHVtbjtcclxuICAgICAgICAgICAgICAgIGNvbEhlYWRlciA9IG9UYWJsZS5jb2x1bW4oY29sdW1uKS5oZWFkZXIoKTtcclxuICAgICAgICAgICAgICAgIGhlYWRlclRpdGxlID0gJChjb2xIZWFkZXIpLmh0bWwoKS50b0xvd2VyQ2FzZSgpO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBpZiAoc2NvcGUubmF2Y29uRGF0YS5yaWdodHMgIT09IHVuZGVmaW5lZCAmJiAoKCFzY29wZS5uYXZjb25EYXRhLnJpZ2h0cy5BZGQgJiYgaGVhZGVyVGl0bGUgPT09IFwiYWRkXCIpIHx8ICghc2NvcGUubmF2Y29uRGF0YS5yaWdodHMuRWRpdCAmJiBoZWFkZXJUaXRsZSA9PT0gXCJlZGl0XCIpIHx8ICgoIXNjb3BlLm5hdmNvbkRhdGEucmlnaHRzLlZpZXcgJiYgIXNjb3BlLm5hdmNvbkRhdGEucmlnaHRzLkFwcHJvdmUpICYmIGhlYWRlclRpdGxlID09PSBcInZpZXdcIikgfHwgKCFzY29wZS5uYXZjb25EYXRhLnJpZ2h0cy5EZWxldGUgJiYgaGVhZGVyVGl0bGUgPT09IFwiZGVsZXRlXCIpKSkgcmV0dXJuIGZhbHNlO1xyXG5cclxuICAgICAgICAgICAgLyogaWYgKHNjb3BlLm5hdmNvbkRhdGEucmlnaHRzICE9PSB1bmRlZmluZWQgJiYgKCghc2NvcGUubmF2Y29uRGF0YS5yaWdodHMuQWRkICYmIGhlYWRlclRpdGxlID09PSBcImFkZFwiKSB8fCAoIXNjb3BlLm5hdmNvbkRhdGEucmlnaHRzLkVkaXQgJiYgaGVhZGVyVGl0bGUgPT09IFwiZWRpdFwiKSB8fCAoIXNjb3BlLm5hdmNvbkRhdGEucmlnaHRzLkRlbGV0ZSAmJiBoZWFkZXJUaXRsZSA9PT0gXCJkZWxldGVcIikpKSByZXR1cm4gZmFsc2U7Ki9cclxuXHJcblxyXG5cclxuICAgICAgICAgICAgaWYgKGhlYWRlclRpdGxlID09PSBcImFkZFwiIHx8IGhlYWRlclRpdGxlID09PSBcImVkaXRcIiB8fCBoZWFkZXJUaXRsZSA9PT0gXCJkZWxldGVcIiB8fCBoZWFkZXJUaXRsZSA9PT0gXCJ2aWV3XCIgfHwgaGVhZGVyVGl0bGUgPT09IFwibWFuYWdlXCIgfHwgaGVhZGVyVGl0bGUgPT09IFwiY3VzdG9tZXIgZm9ybXNcIikge1xyXG4gICAgICAgICAgICAgICAgaWYgKCQoZWwudGFyZ2V0LmNoaWxkcmVuKS5jc3MoXCJkaXNwbGF5XCIpID09PSBcIm5vbmVcIiB8fCAkKGVsLnRhcmdldC5jaGlsZHJlbikuYXR0cihcInJlYWRPbmx5XCIpID09PSB0cnVlIHx8ICQoZWwudGFyZ2V0LmNoaWxkcmVuKS5hdHRyKFwiZGlzYWJsZWRcIikgPT09IFwiZGlzYWJsZWRcIikgcmV0dXJuO1xyXG5cclxuICAgICAgICAgICAgICAgIGlmIChzY29wZS50YWJsZVNldHRpbmdzLnRhYmxlQWN0aW9uICE9PSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoc2NvcGUudGFibGVTZXR0aW5ncy50YWJsZUFjdGlvbiA9PT0gdW5kZWZpbmVkKSByZXR1cm47XHJcbiAgICAgICAgICAgICAgICAgICAgc2NvcGUudGFibGVTZXR0aW5ncy50YWJsZUFjdGlvbihoZWFkZXJUaXRsZSwgcm93LCBjb2x1bW4sIGRhdGEsIHNjb3BlLnR5cGUsIHRoaXMsIG9UYWJsZSk7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChzY29wZS5uYXZjb25EYXRhLnRhYmxlQWN0aW9uID09PSB1bmRlZmluZWQpIHJldHVybjtcclxuICAgICAgICAgICAgICAgICAgICBzY29wZS5uYXZjb25EYXRhLnRhYmxlQWN0aW9uKGhlYWRlclRpdGxlLCByb3csIGNvbHVtbiwgZGF0YSwgc2NvcGUudHlwZSwgdGhpcywgb1RhYmxlKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIGlmIChzY29wZS50YWJsZVNldHRpbmdzLnRhYmxlQ2VsbENsaWNrICE9PSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoc2NvcGUudGFibGVTZXR0aW5ncy50YWJsZUNlbGxDbGljayA9PT0gdW5kZWZpbmVkKSByZXR1cm47XHJcbiAgICAgICAgICAgICAgICAgICAgc2NvcGUudGFibGVTZXR0aW5ncy50YWJsZUNlbGxDbGljayhyb3csIGNvbHVtbiwgZGF0YSwgc2NvcGUudHlwZSwgdGhpcywgb1RhYmxlKTtcclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHNjb3BlLm5hdmNvbkRhdGEudGFibGVDZWxsQ2xpY2sgPT09IHVuZGVmaW5lZCkgcmV0dXJuO1xyXG4gICAgICAgICAgICAgICAgICAgIHNjb3BlLm5hdmNvbkRhdGEudGFibGVDZWxsQ2xpY2socm93LCBjb2x1bW4sIGRhdGEsIHNjb3BlLnR5cGUsIHRoaXMsIG9UYWJsZSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgJCh0YWJsZSkuZmluZCgndGJvZHknKS5vbignY2xpY2snLCAndGgnLCBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIHZhciByb3cgPSBvVGFibGUuY2VsbCh0aGlzKS5pbmRleCgpLnJvdztcclxuICAgICAgICAgICAgdmFyIGNvbHVtbiA9IG9UYWJsZS5jZWxsKHRoaXMpLmluZGV4KCkuY29sdW1uO1xyXG4gICAgICAgICAgICB2YXIgZGF0YSA9IG9UYWJsZS5jZWxsKHRoaXMpLmRhdGEoKTtcclxuXHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIG9UYWJsZS5vbignY2xpY2snLCAndGgnLCBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIHZhciBjb2x1bW4gPSBvVGFibGUuY29sdW1uKHRoaXMpLmluZGV4KCk7XHJcblxyXG4gICAgICAgICAgICB2YXIgY29sSGVhZGVyID0gb1RhYmxlLmNvbHVtbihjb2x1bW4pLmhlYWRlcigpO1xyXG4gICAgICAgICAgICB2YXIgZGF0YSA9ICQoY29sSGVhZGVyKS5odG1sKCkudG9Mb3dlckNhc2UoKTtcclxuXHJcblxyXG4gICAgICAgICAgICBpZiAoJChvVGFibGUpLmNvbnRleHQgIT09IHVuZGVmaW5lZCAmJiAkKG9UYWJsZSkuY29udGV4dC5sZW5ndGggPiAwKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgdGFibGVEYXRhID0gJChvVGFibGUpLmNvbnRleHRbMF07XHJcbiAgICAgICAgICAgICAgICBpZiAodGFibGVEYXRhLmFvQ29sdW1ucyAhPT0gdW5kZWZpbmVkICYmIHRhYmxlRGF0YS5hb0NvbHVtbnMubGVuZ3RoID4gMCkge1xyXG4gICAgICAgICAgICAgICAgICAgICQubWFwKHRhYmxlRGF0YS5hb0NvbHVtbnMsIGZ1bmN0aW9uIChjb2x1bW5EYXRhLCBjb2xJbmRleCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoY29sdW1uRGF0YS5zZXJpYWxOb0NvbHVtbiAhPT0gdW5kZWZpbmVkICYmIGNvbHVtbkRhdGEuc2VyaWFsTm9Db2x1bW4gIT0gbnVsbCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGlMb29wID0gMTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICQubWFwKCQodGFibGVEYXRhLm5UYWJsZSkuZmluZChcInRyXCIpLCBmdW5jdGlvbiAoaXRlbSwgaW5kZXgpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoaW5kZXggPiAwKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciByb3cgPSAkKGl0ZW0pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkKHJvdy5maW5kKFwidGRcIilbY29sdW1uRGF0YS5zZXJpYWxOb0NvbHVtbl0pLnRleHQoaUxvb3ApXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlMb29wKys7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgaWYgKHNjb3BlLm5hdmNvbkRhdGEudGFibGVIZWFkZXJDZWxsQ2xpY2sgPT09IHVuZGVmaW5lZCkgcmV0dXJuO1xyXG4gICAgICAgICAgICBzY29wZS5uYXZjb25EYXRhLnRhYmxlSGVhZGVyQ2VsbENsaWNrKGNvbHVtbiwgZGF0YSwgc2NvcGUudHlwZSwgdGhpcywgb1RhYmxlKTtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgb1RhYmxlLm9uKCdjbGljaycsICdpbnB1dFt0eXBlPVwiY2hlY2tib3hcIl0nLCBmdW5jdGlvbiAoZSkge1xyXG4gICAgICAgICAgICB2YXIgJHJvdyA9ICQodGhpcykuY2xvc2VzdCgndHInKTtcclxuXHJcbiAgICAgICAgICAgIC8vIEdldCByb3cgZGF0YVxyXG4gICAgICAgICAgICB2YXIgZGF0YSA9IG9UYWJsZS5yb3coJHJvdykuZGF0YSgpO1xyXG5cclxuICAgICAgICAgICAgLy9pZiAodGhpcy5jaGVja2VkICYmIG9UYWJsZS5jZWxsKCQodGhpcykucGFyZW50KCkpLmluZGV4KCkuY29sdW1uID09PSAwKVxyXG4gICAgICAgICAgICBpZiAob1RhYmxlLmNlbGwoJCh0aGlzKS5wYXJlbnQoKSkuaW5kZXgoKS5jb2x1bW4gPT09IDApXHJcbiAgICAgICAgICAgICAgICBvVGFibGUucm93KCRyb3cpLmRhdGEoKVtcIlJvd19DaGVja2VkXCJdID0gdGhpcy5jaGVja2VkO1xyXG5cclxuICAgICAgICAgICAgaWYgKG9UYWJsZS5yb3coJHJvdykuZGF0YSgpW1wiQ2hlY2tfRmllbGRcIl0gIT09IHVuZGVmaW5lZCAmJiBvVGFibGUucm93KCRyb3cpLmRhdGEoKVtcIkNoZWNrX0ZpZWxkXCJdICE9PSBudWxsICYmIG9UYWJsZS5yb3coJHJvdykuZGF0YSgpW1wiQ2hlY2tfRmllbGRcIl0gIT09IFwiXCIpIHtcclxuICAgICAgICAgICAgICAgIHZhciBmaWVsZCA9IG9UYWJsZS5yb3coJHJvdykuZGF0YSgpW1wiQ2hlY2tfRmllbGRcIl07XHJcbiAgICAgICAgICAgICAgICBvVGFibGUucm93KCRyb3cpLmRhdGEoKVtmaWVsZF0gPSB0aGlzLmNoZWNrZWRcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAvLyBHZXQgcm93IElEXHJcbiAgICAgICAgICAgIHZhciByb3dJZCA9IGRhdGFbMF07XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIG9UYWJsZS5vbignY2xpY2snLCAnaW5wdXRbdHlwZT1cInRleHRcIl0nLCBmdW5jdGlvbiAoZSkge1xyXG4gICAgICAgICAgICAvL2NvbnNvbGUubG9nKCQodGhpcykudmFsdWUoKSk7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIHZhciB0YWJXcmFwcGVyID0gJCh0YWJsZSkucGFyZW50KCkucGFyZW50KCk7XHJcbiAgICAgICAgaWYgKCQodGFiV3JhcHBlcikuZmluZChcIi5kYXRhVGFibGVzX2ZpbHRlclwiKS5sZW5ndGggPT09IDApIHtcclxuICAgICAgICAgICAgJCh0YWJXcmFwcGVyKS5jc3MoXCJtYXJnaW4tdG9wXCIsIFwiLTEycHhcIik7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBzY29wZS5uYXZjb25EYXRhLm9UYWJsZSA9IG9UYWJsZTtcclxuICAgIH07XHJcblxyXG4gICAgdmFyIFByaW50RnVuY3Rpb24gPSBmdW5jdGlvbiAoaVRhYmxlLCBvcHRpb25zKSB7XHJcblxyXG4gICAgICAgICQoXCIuZGF0YVRhYmxlc19maWx0ZXJcIikuZmluZChcImlucHV0XCIpLmFkZENsYXNzKFwiZm9ybS1jb250cm9sIGlucHV0LW1lZGl1bSBpbnB1dC1pbmxpbmVcIik7XHJcbiAgICAgICAgLy8gIHZhciBpVGFibGUgPSB0aGlzLkRhdGFUYWJsZSgpO1xyXG5cclxuICAgICAgICBpZiAob3B0aW9ucy5idXR0b25zICE9PSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgICAgaWYgKCQoXCIjRGF0YVRhYmxlc19UYWJsZV8wX2ZpbHRlclwiKS5maW5kKCcuZHQtYnV0dG9ucycpLmxlbmd0aCA9PT0gMCkge1xyXG4gICAgICAgICAgICAgICAgdmFyIHByaW50T2JqID0gdGhpcy5wYXJlbnRzKCcucG9ydGxldCcpLmZpcnN0KCkuZmluZChcIi50b29sczpmaXJzdFwiKTtcclxuICAgICAgICAgICAgICAgIGlUYWJsZS5idXR0b25zKCkuY29udGFpbmVyKCkuYXBwZW5kVG8ocHJpbnRPYmopO1xyXG4gICAgICAgICAgICAgICAgcHJpbnRPYmouZmluZChcIi5kdC1idXR0b25zXCIpLmNoaWxkcmVuKCkudW53cmFwKCk7XHJcbiAgICAgICAgICAgICAgICB2YXIgcHJpbnRCdXQgPSBwcmludE9iai5maW5kKCcuZHQtYnV0dG9uJyk7XHJcbiAgICAgICAgICAgICAgICBwcmludEJ1dC5jc3MoXCJiYWNrZ3JvdW5kXCIsIFwibm9uZVwiKTtcclxuICAgICAgICAgICAgICAgIHByaW50QnV0LmNzcyhcImJhY2tncm91bmQtaW1hZ2VcIiwgXCJub25lXCIpO1xyXG4gICAgICAgICAgICAgICAgcHJpbnRCdXQuY3NzKFwiYm9yZGVyXCIsIFwiMHB4XCIpO1xyXG4gICAgICAgICAgICAgICAgcHJpbnRCdXQuY3NzKFwicGFkZGluZ1wiLCBcIjBweFwiKTtcclxuICAgICAgICAgICAgICAgIHByaW50QnV0LmNzcyhcInBhZGRpbmctdG9wXCIsIFwiM3B4XCIpO1xyXG4gICAgICAgICAgICAgICAgcHJpbnRCdXQuY3NzKFwidG9wXCIsIFwiLTNweFwiKTtcclxuICAgICAgICAgICAgICAgIHByaW50QnV0LmNzcyhcInBvc2l0aW9uXCIsIFwicmVsYXRpdmVcIik7XHJcbiAgICAgICAgICAgICAgICBwcmludEJ1dC5hZGRDbGFzcyhcImZhIGZhLXByaW50XCIpO1xyXG4gICAgICAgICAgICAgICAgcHJpbnRCdXQuZmluZChcInNwYW5cIikudGV4dChcIlwiKTtcclxuICAgICAgICAgICAgICAgIHZhciB0YWJsZUlkID0gJChcIi50b29sczpmaXJzdFwiKS5wYXJlbnRzKFwiLnBvcnRsZXQ6Zmlyc3RcIikuZmluZChcInRhYmxlOmZpcnN0XCIpLmF0dHIoXCJpZFwiKTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgaVRhYmxlLm9uKCdidXR0b25zLWFjdGlvbicsIGZ1bmN0aW9uIChlLCBidXR0b25BcGksIGRhdGFUYWJsZSwgbm9kZSwgY29uZmlnKSB7XHJcbiAgICAgICAgICAgICAgICAvL2NvbnNvbGUubG9nKCdCdXR0b24gJyArIGJ1dHRvbkFwaS50ZXh0KCkgKyAnIHdhcyBhY3RpdmF0ZWQnKTtcclxuICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICBpZiAoJChcIiNEYXRhVGFibGVzX1RhYmxlXzBfZmlsdGVyXCIpLmZpbmQoJy5kdC1idXR0b25zJykubGVuZ3RoID09PSAwKVxyXG4gICAgICAgICAgICAgICAgaVRhYmxlLmJ1dHRvbnMoKS5jb250YWluZXIoKS5hcHBlbmRUbygkKFwiI0RhdGFUYWJsZXNfVGFibGVfMF9maWx0ZXJcIikpXHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpZiAob3B0aW9ucy5jb2x1bW5GaWx0ZXIgIT09IHVuZGVmaW5lZCkge1xyXG4gICAgICAgICAgICB0aGlzLmNvbHVtbkZpbHRlcih7XHJcbiAgICAgICAgICAgICAgICBzUGxhY2VIb2xkZXI6IFwiaGVhZDphZnRlclwiLFxyXG4gICAgICAgICAgICAgICAgYW9Db2x1bW5zOiBvcHRpb25zLmNvbHVtbkZpbHRlci5hb0NvbHVtbnNcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpZiAob3B0aW9ucy5yb3dzR3JvdXAgIT09IHVuZGVmaW5lZCkge1xyXG4gICAgICAgICAgICBuZXcgJC5mbi5kYXRhVGFibGUuUm93c0dyb3VwKGlUYWJsZSwgb3B0aW9ucy5yb3dzR3JvdXApO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgbmF2Y29uLnZpZXdDb250ZW50TG9hZGVkKCk7XHJcbiAgICB9XHJcblxyXG4gICAgdmFyIHNldFRhYmxlVG90YWxDZWxsVmFsdWUgPSBmdW5jdGlvbiAob1RhYmxlLCBjdHJsLCBvcHRpb25zLCBjb2x1bW4sIGNvbEhlYWRlcikge1xyXG4gICAgICAgIHZhciBjb2x1bW5UaXRsZSA9IFwiXCI7XHJcblxyXG4gICAgICAgIC8vVG90YWwgQ2FsY3VsYXRpb25cclxuICAgICAgICBpZiAob3B0aW9ucy5sYXN0Um93QXNUb3RhbCAhPT0gdW5kZWZpbmVkICYmIG9wdGlvbnMubGFzdFJvd0FzVG90YWwpIHtcclxuICAgICAgICAgICAgdmFyIGxhc3RUciA9ICQoY3RybCkucGFyZW50KCkucGFyZW50KCkuY2hpbGRyZW4oKS5sYXN0KCkuY2xvc2VzdChcInRyXCIpO1xyXG4gICAgICAgICAgICB2YXIgbGFzdFRySW5kZXggPSBsYXN0VHIuaW5kZXgoKTtcclxuXHJcbiAgICAgICAgICAgIHZhciB0b3RhbFZhbHVlID0gMDtcclxuICAgICAgICAgICAgdmFyIHRyQ29sbGVjdGlvbiA9ICQoY3RybCkucGFyZW50KCkucGFyZW50KCkuZmluZChcInRyXCIpO1xyXG4gICAgICAgICAgICBmb3IgKHZhciBpUm93ID0gMDsgaVJvdyA8IHRyQ29sbGVjdGlvbi5sZW5ndGggLSAxOyBpUm93KyspIHtcclxuICAgICAgICAgICAgICAgIC8vdmFyIGNvbFZhbHVlID0gcGFyc2VJbnQob1RhYmxlLnJvdyh0ckNvbGxlY3Rpb25baVJvd10pLmRhdGEoKVtjb2xIZWFkZXJdKTtcclxuICAgICAgICAgICAgICAgIHZhciBjb2xWYWx1ZSA9IHBhcnNlRmxvYXQoJCgkKCQoY3RybCkucGFyZW50KCkucGFyZW50KCkuY2hpbGRyZW4oKVtpUm93XSkuY2hpbGRyZW4oKVtjb2x1bW5dKS5jaGlsZHJlbigpWzBdLnZhbHVlKTtcclxuICAgICAgICAgICAgICAgIHRvdGFsVmFsdWUgKz0gaXNOYU4oY29sVmFsdWUpID8gMCA6IGNvbFZhbHVlO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAvL29UYWJsZS5yb3cobGFzdFRySW5kZXgpLmRhdGEoKVtjb2x1bW5UaXRsZV0gPSB0b3RhbFZhbHVlO1xyXG4gICAgICAgICAgICB2YXIgbG9vcENvbHVtbiA9IDA7XHJcbiAgICAgICAgICAgIGZvciAodmFyIGtleSBpbiBvVGFibGUucm93KGxhc3RUckluZGV4KS5kYXRhKCkpIHtcclxuICAgICAgICAgICAgICAgIGlmIChsb29wQ29sdW1uID09PSBjb2x1bW4pIHtcclxuICAgICAgICAgICAgICAgICAgICBjb2x1bW5UaXRsZSA9IGtleTtcclxuICAgICAgICAgICAgICAgICAgICAkKG9UYWJsZS5yb3cobGFzdFRySW5kZXgpLmRhdGEoKVtjb2x1bW5UaXRsZV0pLnZhbCh0b3RhbFZhbHVlKTtcclxuICAgICAgICAgICAgICAgICAgICAkKG9UYWJsZS5yb3cobGFzdFRySW5kZXgpLmRhdGEoKVtjb2x1bW5UaXRsZV0pLnRleHQodG90YWxWYWx1ZSk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIG9UYWJsZS5yb3cobGFzdFRySW5kZXgpLmRhdGEoKVtjb2x1bW5UaXRsZV0gPSBcIjxpbnB1dCB0eXBlPSd0ZXh0JyB2YWx1ZT0nXCIgKyB0b3RhbFZhbHVlICsgXCInPlwiO1xyXG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgbG9vcENvbHVtbiArPSAxO1xyXG4gICAgICAgICAgICB9XHJcblxyXG5cclxuICAgICAgICAgICAgJCgkKGxhc3RUclswXSkuY2hpbGRyZW4oKVtjb2x1bW5dKS5jaGlsZHJlbigpWzBdLnZhbHVlID0gdG90YWxWYWx1ZTtcclxuICAgICAgICAgICAgJCgkKGxhc3RUclswXSkuY2hpbGRyZW4oKVtjb2x1bW5dKS5jaGlsZHJlbigpLnRleHQodG90YWxWYWx1ZSk7XHJcbiAgICAgICAgICAgIC8vJCgkKGxhc3RUclswXSkuY2hpbGRyZW4oKVtjb2x1bW5dKS5jaGlsZHJlbigpWzBdLnJlYWRPbmx5ID0gdHJ1ZTtcclxuICAgICAgICAgICAgJCgkKGxhc3RUclswXSkuY2hpbGRyZW4oKVtjb2x1bW5dKS5jaGlsZHJlbigpWzBdLmRpc2FibGVkID0gdHJ1ZTtcclxuICAgICAgICB9XHJcbiAgICB9O1xyXG5cclxuICAgIHZhciBzZXRUYWJsZUNlbGxWYWx1ZSA9IGZ1bmN0aW9uICh2YWx1ZSwgdGFyZ2V0VmFsKSB7XHJcbiAgICAgICAgdmFyIHJldFZhbCA9IHZhbHVlO1xyXG4gICAgICAgIGlmICh2YWx1ZS5pbmRleE9mID09PSB1bmRlZmluZWQpIHJldHVybiB2YWx1ZTtcclxuICAgICAgICBpZiAodmFsdWUuaW5kZXhPZignPGlucHV0JykgIT09IC0xIHx8IHZhbHVlLmluZGV4T2YoJzx0ZXh0YXJlYScpICE9PSAtMSkge1xyXG4gICAgICAgICAgICB2YXIgdmFsdWVPYmogPSAkKHZhbHVlKTtcclxuICAgICAgICAgICAgaWYgKHRhcmdldFZhbC50eXBlID09PSBcImNoZWNrYm94XCIpIHtcclxuICAgICAgICAgICAgICAgIGlmICh0YXJnZXRWYWwuY2hlY2tlZClcclxuICAgICAgICAgICAgICAgICAgICAkKHZhbHVlT2JqKS5hdHRyKFwiY2hlY2tlZFwiLCBcImNoZWNrZWRcIik7XHJcbiAgICAgICAgICAgICAgICBlbHNlXHJcbiAgICAgICAgICAgICAgICAgICAgJCh2YWx1ZU9iaikucmVtb3ZlQXR0cihcImNoZWNrZWRcIik7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAkKHZhbHVlT2JqKS5hdHRyKFwidmFsdWVcIiwgdGFyZ2V0VmFsLnZhbHVlKVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHZhciBtb2RTdHIgPSB2YWx1ZU9iai5wcm9wKCdvdXRlckhUTUwnKTtcclxuICAgICAgICAgICAgcmV0VmFsID0gbW9kU3RyLnJlcGxhY2UoL1wiL2dpLCBcIidcIik7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgcmV0VmFsID0gdmFsdWU7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiByZXRWYWw7XHJcbiAgICB9O1xyXG5cclxuICAgIHZhciBnZXRUYWJsZUNlbGxWYWx1ZSA9IGZ1bmN0aW9uICh2YWx1ZSkge1xyXG4gICAgICAgIHZhciByZXRWYWwgPSB2YWx1ZTtcclxuICAgICAgICBpZiAodmFsdWUgPT09IG51bGwgfHwgdmFsdWUgPT09IHVuZGVmaW5lZCB8fCB2YWx1ZS5pbmRleE9mID09PSB1bmRlZmluZWQpIHJldHVybiB2YWx1ZTtcclxuICAgICAgICBpZiAodmFsdWUuaW5kZXhPZignPGlucHV0JykgIT09IC0xIHx8IHZhbHVlLmluZGV4T2YoJzx0ZXh0YXJlYScpICE9PSAtMSkge1xyXG4gICAgICAgICAgICB2YXIgdmFsdWVPYmogPSAkKHZhbHVlKTtcclxuICAgICAgICAgICAgcmV0VmFsID0gJCh2YWx1ZU9iaikuYXR0cihcInZhbHVlXCIpXHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgcmV0VmFsID0gdmFsdWU7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiByZXRWYWw7XHJcbiAgICB9O1xyXG5cclxuICAgIHZhciBnZXRUYWJsZUluc3RhbmNlID0gZnVuY3Rpb24gKHR5cGUpIHtcclxuICAgICAgICB2YXIgbmF2VGFibGUgPSAkKFwibmF2Y29uLXRhYmxlW3R5cGU9J1wiICsgdHlwZSArIFwiJ11cIik7XHJcbiAgICAgICAgdmFyIHRhYmxlID0gJCgkKG5hdlRhYmxlKS5maW5kKCd0YWJsZScpWzBdKTtcclxuICAgICAgICB2YXIgb1RhYmxlID0gdGFibGUuRGF0YVRhYmxlKCk7XHJcbiAgICAgICAgcmV0dXJuIG9UYWJsZTtcclxuICAgIH07XHJcblxyXG4gICAgdmFyIGNsZWFyVGFibGVEYXRhID0gZnVuY3Rpb24gKHR5cGUsIGRhdGEpIHtcclxuICAgICAgICAkLm1hcChkYXRhLCBmdW5jdGlvbiAoaXRlbSwgaW5kZXgpIHtcclxuICAgICAgICAgICAgZm9yICh2YXIgayBpbiBpdGVtKSB7XHJcbiAgICAgICAgICAgICAgICBpdGVtW2tdID0gc2V0VGFibGVDZWxsVmFsdWUoaXRlbVtrXSwgXCJcIik7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgICAgICB2YXIgb1RhYmxlID0gZ2V0VGFibGVJbnN0YW5jZSh0eXBlKTtcclxuICAgICAgICBvVGFibGUuY2xlYXIoKTtcclxuICAgICAgICBvVGFibGUucm93cy5hZGQoZGF0YSkuZHJhdygpO1xyXG4gICAgfTtcclxuXHJcbiAgICB2YXIgdXBkYXRlVGFibGVEYXRhID0gZnVuY3Rpb24gKHR5cGUsIGRhdGEsIHRhcmdldERhdGEsIGlkKSB7XHJcbiAgICAgICAgaWYgKGlkID09PSB1bmRlZmluZWQgfHwgaWQgPT09IFwiXCIpXHJcbiAgICAgICAgICAgIGlkID0gXCJyb3dcIjtcclxuXHJcbiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBkYXRhLmxlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgICAgIGZvciAodmFyIGsgaW4gZGF0YVtpXSkge1xyXG4gICAgICAgICAgICAgICAgaWYgKGsgPT09IGkpIGNvbnRpbnVlO1xyXG4gICAgICAgICAgICAgICAgdmFyIGlkVmFsID0gKGlkID09PSBcInJvd1wiID8gaSA6IGRhdGFbaV1baWRdKTtcclxuICAgICAgICAgICAgICAgIHZhciB2YWx1T2JqID0gZ2V0SXRlbUJ5S2V5VmFsdWUodGFyZ2V0RGF0YSwgaWQsIGlkVmFsKTtcclxuICAgICAgICAgICAgICAgIGlmICh2YWx1T2JqICE9PSAtMSlcclxuICAgICAgICAgICAgICAgICAgICBkYXRhW2ldW2tdID0gc2V0VGFibGVDZWxsVmFsdWUoZGF0YVtpXVtrXSwgdmFsdU9ialtrXSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgdmFyIG9UYWJsZSA9IGdldFRhYmxlSW5zdGFuY2UodHlwZSk7XHJcbiAgICAgICAgb1RhYmxlLmNsZWFyKCk7XHJcbiAgICAgICAgb1RhYmxlLnJvd3MuYWRkKGRhdGEpLmRyYXcoKTtcclxuICAgIH07XHJcblxyXG4gICAgdmFyIGdldEl0ZW1CeVByb3BlcnR5ID0gZnVuY3Rpb24gKGl0ZW1zLCBrZXkpIHtcclxuICAgICAgICB2YXIgdmFsdWUgPSAkLmdyZXAoaXRlbXMsIGZ1bmN0aW9uIChlKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBlLmtleSA9PT0ga2V5O1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICBpZiAodmFsdWUubGVuZ3RoID4gMClcclxuICAgICAgICAgICAgcmV0dXJuIHZhbHVlWzBdO1xyXG4gICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAvL2FsZXJ0KCdpdGVtIG5vdCBmb3VuZC4uLicpO1xyXG4gICAgICAgICAgICByZXR1cm4gLTE7XHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxuXHJcbiAgICB2YXIgZ2V0VGFibGVEYXRhID0gZnVuY3Rpb24gKHR5cGUsIGlkLCBjaGVja2VkLCBrZXksIGNoZWNrZWRDb2wsIG9sZERhdGEsIG1vZGUpIHtcclxuICAgICAgICBpZiAoaWQgPT09IHVuZGVmaW5lZCB8fCBpZCA9PT0gXCJcIilcclxuICAgICAgICAgICAgaWQgPSBcInJvd1wiO1xyXG4gICAgICAgIHZhciBkYXRhID0gW107XHJcbiAgICAgICAgdmFyIG5hdlRhYmxlID0gJChcIm5hdmNvbi10YWJsZVt0eXBlPSdcIiArIHR5cGUgKyBcIiddXCIpO1xyXG4gICAgICAgIHZhciB0YWJsZSA9ICQoJChuYXZUYWJsZSkuZmluZCgndGFibGUnKVswXSk7XHJcbiAgICAgICAgdmFyIG9UYWJsZSA9IGdldFRhYmxlSW5zdGFuY2UodHlwZSk7XHJcbiAgICAgICAgJC5tYXAob1RhYmxlLnJvd3MoKS5kYXRhKCksIGZ1bmN0aW9uIChpdGVtLCBpbmRleCkge1xyXG4gICAgICAgICAgICBpZiAoY2hlY2tlZCAhPT0gdW5kZWZpbmVkICYmIGNoZWNrZWQpIHtcclxuICAgICAgICAgICAgICAgIHZhciBjb2xGaWVsZCA9IFwiXCJcclxuICAgICAgICAgICAgICAgIGlmIChjaGVja2VkQ29sICE9PSB1bmRlZmluZWQpXHJcbiAgICAgICAgICAgICAgICAgICAgY29sRmllbGQgPSBjaGVja2VkQ29sO1xyXG4gICAgICAgICAgICAgICAgaWYgKGl0ZW1bY29sRmllbGRdID09PSB1bmRlZmluZWQgfHwgIWl0ZW1bY29sRmllbGRdKVxyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB2YXIgb2JqID0ge307XHJcbiAgICAgICAgICAgIG9ialtpZF0gPSBpbmRleDtcclxuICAgICAgICAgICAgZm9yICh2YXIgayBpbiBpdGVtKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoaXRlbS5oYXNPd25Qcm9wZXJ0eShrKSkge1xyXG4gICAgICAgICAgICAgICAgICAgIG9ialtrXSA9IGdldFRhYmxlQ2VsbFZhbHVlKGl0ZW1ba10pO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmIChpdGVtW2tleV0gPT09IHVuZGVmaW5lZCkge1xyXG4gICAgICAgICAgICAgICAgaXRlbVtrZXldID0gMDtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZiAoaXRlbVtrZXldID09PSBudWxsIHx8IGl0ZW1ba2V5XSA9PT0gMCkge1xyXG4gICAgICAgICAgICAgICAgb2JqW1wiT2JqZWN0U3RhdGVcIl0gPSAoaXRlbVtcIk9iamVjdFN0YXRlXCJdICE9PSB1bmRlZmluZWQgJiYgaXRlbVtcIk9iamVjdFN0YXRlXCJdICE9PSBudWxsICYmIGl0ZW1bXCJPYmplY3RTdGF0ZVwiXSAhPT0gXCJcIiAmJiBpdGVtW1wiT2JqZWN0U3RhdGVcIl0gIT09IFwiMFwiICYmIGl0ZW1bXCJPYmplY3RTdGF0ZVwiXSAhPT0gMCkgPyBwYXJzZUludChpdGVtW1wiT2JqZWN0U3RhdGVcIl0pIDogMTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgIG9ialtcIk9iamVjdFN0YXRlXCJdID0gKGl0ZW1bXCJPYmplY3RTdGF0ZVwiXSAhPT0gdW5kZWZpbmVkICYmIGl0ZW1bXCJPYmplY3RTdGF0ZVwiXSAhPT0gbnVsbCAmJiBpdGVtW1wiT2JqZWN0U3RhdGVcIl0gIT09IFwiXCIgJiYgaXRlbVtcIk9iamVjdFN0YXRlXCJdICE9PSBcIjBcIiAmJiBpdGVtW1wiT2JqZWN0U3RhdGVcIl0gIT09IDApID8gcGFyc2VJbnQoaXRlbVtcIk9iamVjdFN0YXRlXCJdKSA6IDI7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIG9ialtcIlN0YXR1c1wiXSA9IChpdGVtW1wiU3RhdHVzXCJdICE9PSB1bmRlZmluZWQgJiYgaXRlbVtcIlN0YXR1c1wiXSAhPT0gbnVsbCAmJiBpdGVtW1wiU3RhdHVzXCJdICE9PSBcIlwiICYmIGl0ZW1bXCJTdGF0dXNcIl0gIT09IFwiMFwiKSA/IHBhcnNlSW50KGl0ZW1bXCJTdGF0dXNcIl0pIDogMDtcclxuXHJcbiAgICAgICAgICAgIGRhdGEucHVzaChvYmopO1xyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIGlmIChtb2RlLnRvTG93ZXJDYXNlKCkgPT0gXCJzYXZlXCIpXHJcbiAgICAgICAgICAgIHJldHVybiBkYXRhO1xyXG4gICAgICAgIGVsc2VcclxuICAgICAgICAgICAgcmV0dXJuIGluc2VydERlbGV0ZWRpdGVtcyhkYXRhLCBvbGREYXRhLCBrZXksIFwidGFibGVcIik7XHJcbiAgICB9O1xyXG5cclxuICAgIHZhciB0YWJsZVJlZnJlc2ggPSBmdW5jdGlvbiAoZWwsIHNldHRpbmcsIHNjb3BlKSB7XHJcbiAgICAgICAgaWYgKHNldHRpbmcuZGF0YS5sZW5ndGggPT09IDApIHNldHRpbmcuZGF0YSA9IFtdO1xyXG4gICAgICAgIHZhciB0YWJsZSA9ICQoJChlbCkuZmluZCgndGFibGUnKVswXSk7XHJcbiAgICAgICAgdmFyIHRhYkluc3QgPSB0YWJsZS5EYXRhVGFibGUuZm5UYWJsZXMoKTtcclxuICAgICAgICBpZiAoJCh0YWJJbnN0KS5wYXJlbnRzKFwibmF2Y29uLXRhYmxlW3R5cGU9J1wiICsgJChlbCkuYXR0cihcInR5cGVcIikgKyBcIiddXCIpLmxlbmd0aCA9PT0gMCB8fCB0YWJsZS5jaGlsZHJlbigpLmxlbmd0aCA9PT0gMCkge1xyXG4gICAgICAgICAgICB0YWJsZVNldHRpbmcoZWwsIHNldHRpbmcsIHNjb3BlKTtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuICAgICAgICB2YXIgb1RhYmxlID0gdGFibGUuRGF0YVRhYmxlKCk7XHJcbiAgICAgICAgb1RhYmxlLmNsZWFyKCk7XHJcbiAgICAgICAgb1RhYmxlLnJvd3MuYWRkKHNldHRpbmcuZGF0YSkuZHJhdygpO1xyXG4gICAgfTtcclxuXHJcbiAgICB2YXIgdGFibGVDZWxsRWRpdFNldHRpbmcgPSBmdW5jdGlvbiAocm93LCBjb2x1bW4sIGRhdGEsIGNlbGxPYmosIG9UYWJsZSwgJHNjb3BlLCAkY29tcGlsZSkge1xyXG5cclxuICAgICAgICB2YXIgY29sSGVhZGVyID0gb1RhYmxlLmNvbHVtbihjb2x1bW4pLmhlYWRlcigpO1xyXG4gICAgICAgIHZhciBoZWFkZXJUaXRsZSA9ICQoY29sSGVhZGVyKS5odG1sKCkudG9Mb3dlckNhc2UoKTtcclxuICAgICAgICB2YXIgY29sdW1uU2V0dGluZyA9IG9UYWJsZS5zZXR0aW5ncygpWzBdLmFvQ29sdW1uc1tjb2x1bW5dO1xyXG4gICAgICAgIGlmIChjb2x1bW5TZXR0aW5nLmVkaXQgPT09IHRydWUgJiYgY2VsbE9iai5jaGlsZHJlbi5sZW5ndGggPT09IDApIHtcclxuICAgICAgICAgICAgdmFyIGhlaWdodCA9IGNlbGxPYmoub2Zmc2V0SGVpZ2h0ICsgXCJweDtcIjtcclxuICAgICAgICAgICAgdmFyIHdpZHRoID0gY2VsbE9iai5vZmZzZXRXaWR0aCArIFwicHg7XCJcclxuICAgICAgICAgICAgJChjZWxsT2JqKS5lbXB0eSgpLmFwcGVuZCgkKFwiPG5hdmNvbi1kcm9wZG93biBzZWxlY3Qtb3B0aW9ucz0ndm0uc2VsZWN0T3B0aW9ucyc+PC9uYXZjb24tZHJvcGRvd24+XCIsIHtcclxuICAgICAgICAgICAgICAgIFwic3R5bGVcIjogXCJoZWlnaHQ6Y2FsYygxMDAlICsgMTJweCk7d2lkdGg6Y2FsYygxMDAlICsgMTJweCk7IG1hcmdpbi1sZWZ0Oi02cHg7IG1hcmdpbi10b3A6LTZweDtcIlxyXG4gICAgICAgICAgICB9KS5hcHBlbmQoZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgdmFyIG9wdGlvbnMgPSBbXTtcclxuICAgICAgICAgICAgICAgICQuZWFjaChbXSwgZnVuY3Rpb24gKGssIHYpIHtcclxuICAgICAgICAgICAgICAgICAgICBvcHRpb25zLnB1c2goJChcIjxvcHRpb24+PC9vcHRpb24+XCIsIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgXCJ0ZXh0XCI6IHYsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIFwidmFsdWVcIjogdlxyXG4gICAgICAgICAgICAgICAgICAgIH0pKVxyXG4gICAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgICAgIHJldHVybiBvcHRpb25zO1xyXG4gICAgICAgICAgICB9KSk7XHJcblxyXG4gICAgICAgICAgICAkY29tcGlsZSgkKGNlbGxPYmopKSgkc2NvcGUpO1xyXG5cclxuICAgICAgICB9XHJcbiAgICB9O1xyXG5cclxuICAgIHZhciBjYWxlbmRhclNldHRpbmcgPSBmdW5jdGlvbiAoZWwsIGRhdGEsIHNjb3BlKSB7XHJcbiAgICAgICAgdmFyIGNhbGVuZGFyID0gJCgkKGVsKS5maW5kKFwiZGl2W3R5cGU9J2NhbGVuZGFyJ11cIilbMF0pO1xyXG4gICAgICAgIGNhbGVuZGFyLmZ1bGxDYWxlbmRhcihcImRlc3Ryb3lcIik7XHJcblxyXG4gICAgICAgIGNhbGVuZGFyLmZ1bGxDYWxlbmRhcihcImRlc3Ryb3lcIik7XHJcbiAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIGNhbGVuZGFyLmZ1bGxDYWxlbmRhcih7XHJcbiAgICAgICAgICAgICAgICBub3c6IGRhdGEubm93LFxyXG4gICAgICAgICAgICAgICAgZWRpdGFibGU6IGRhdGEuZWRpdGFibGUsXHJcbiAgICAgICAgICAgICAgICBjb250ZW50SGVpZ2h0OiBkYXRhLmNvbnRlbnRIZWlnaHQsXHJcbiAgICAgICAgICAgICAgICBkcmFnU2Nyb2xsOiBkYXRhLmRyYWdTY3JvbGwsXHJcbiAgICAgICAgICAgICAgICBoZWFkZXI6IGRhdGEuaGVhZGVyLFxyXG4gICAgICAgICAgICAgICAgZGVmYXVsdFZpZXc6IGRhdGEuZGVmYXVsdFZpZXcsXHJcbiAgICAgICAgICAgICAgICB2aWV3czogZGF0YS52aWV3cyxcclxuICAgICAgICAgICAgICAgIHJlc291cmNlQXJlYVdpZHRoOiBkYXRhLnJlc291cmNlQXJlYVdpZHRoLFxyXG4gICAgICAgICAgICAgICAgcmVzb3VyY2VDb2x1bW5zOiBkYXRhLnJlc291cmNlQ29sdW1ucyxcclxuICAgICAgICAgICAgICAgIHJlc291cmNlczogZGF0YS5yZXNvdXJjZXMsXHJcbiAgICAgICAgICAgICAgICBldmVudHM6IGRhdGEuZXZlbnRzLFxyXG4gICAgICAgICAgICAgICAgZXZlbnRTdGFydEVkaXRhYmxlOiBmYWxzZSxcclxuICAgICAgICAgICAgICAgIGV2ZW50RHVyYXRpb25FZGl0YWJsZTogZmFsc2UsXHJcbiAgICAgICAgICAgICAgICBkYXlDbGljazogZnVuY3Rpb24gKGNhbEV2ZW50LCBqc0V2ZW50LCB2aWV3KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIHJlc291cmNlSWQgPSAkKGpzRXZlbnQudGFyZ2V0KS5wYXJlbnQoKS5wYXJlbnQoKS5hdHRyKFwiZGF0YS1yZXNvdXJjZS1pZFwiKTtcclxuICAgICAgICAgICAgICAgICAgICBzY29wZS5uYXZjb25EYXRhLmNhbGVuZGVyQWN0aW9uQ2xpY2soXCJjbGlja1wiLCBjYWxFdmVudCwgcmVzb3VyY2VJZCwgdmlldyk7XHJcbiAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgZXZlbnRSZW5kZXI6IGZ1bmN0aW9uIChldmVudCwgZWxlbWVudCwgdmlldykge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChkYXRhLnRvZGF5VmlzaWJsZSAhPT0gdW5kZWZpbmVkICYmICFkYXRhLnRvZGF5VmlzaWJsZSkgJChcIi5mYy10b2RheVwiKS5yZW1vdmVDbGFzcyhcImZjLXRvZGF5XCIpOy8vIHJlbW92ZSBmb3IgY3VycmVudCBkYXRlIGNvbG9yIGRpc3BsYXlcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGRhdGEubnVtYmVyRGlzcGxheSAhPT0gdW5kZWZpbmVkICYmIGRhdGEubnVtYmVyRGlzcGxheSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgaURheSA9IDE7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICQoXCIuZmMtd2lkZ2V0LWhlYWRlciBcIikuZWFjaChmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoJCh0aGlzKS5hdHRyKFwiZGF0YS1kYXRlXCIpICE9IHVuZGVmaW5lZCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICgkKHRoaXMpLmF0dHIoXCJjb2xzcGFuXCIpICE9IHVuZGVmaW5lZCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkKHRoaXMpLnBhcmVudCgpLmhpZGUoKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICQodGhpcykuZmluZChcIi5mYy1jZWxsLWNvbnRlbnRcIikuZWFjaChmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoJCh0aGlzKS5jaGlsZHJlbigpLmxlbmd0aCA9PT0gMSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICQodGhpcykuZmluZChcIi5mYy1jZWxsLXRleHRcIikuaHRtbChcIlwiICsgaURheS50b1N0cmluZygpKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpRGF5ICs9IDE7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy9pZiAoaURheSA+IDE1MSkgJCh0aGlzKS5wYXJlbnQoKS5oaWRlKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgIGV2ZW50Q2xpY2s6IGZ1bmN0aW9uIChjYWxFdmVudCwganNFdmVudCwgdmlldykge1xyXG4gICAgICAgICAgICAgICAgICAgIC8vYWxlcnQoJ0V2ZW50OiAnICsgY2FsRXZlbnQudGl0bGUpO1xyXG4gICAgICAgICAgICAgICAgICAgIC8vJCh0aGlzKS5jc3MoJ2JvcmRlci1jb2xvcicsICdyZWQnKTtcclxuICAgICAgICAgICAgICAgICAgICBzY29wZS5uYXZjb25EYXRhLmNhbGVuZGVyQWN0aW9uQ2xpY2soXCJjbGlja1wiLCBjYWxFdmVudCwgY2FsRXZlbnQucmVzb3VyY2VJZCwgdmlldyk7XHJcbiAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgZXZlbnRSZXNpemVTdGFydDogZnVuY3Rpb24gKGV2ZW50LCBqc0V2ZW50LCB1aSwgdmlldykge1xyXG4gICAgICAgICAgICAgICAgICAgIHNjb3BlLm5hdmNvbkRhdGEuY2FsZW5kZXJBY3Rpb25DbGljayhcInJlc2l6ZVN0YXJ0XCIsIGV2ZW50LCBldmVudC5yZXNvdXJjZUlkLCB2aWV3KTtcclxuICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICBldmVudFJlc2l6ZTogZnVuY3Rpb24gKGV2ZW50LCBkZWx0YSwgcmV2ZXJ0RnVuYykge1xyXG4gICAgICAgICAgICAgICAgICAgIC8vYWxlcnQoZXZlbnQudGl0bGUgKyBcIiBlbmQgaXMgbm93IFwiICsgZXZlbnQuZW5kLmZvcm1hdCgpKTtcclxuICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICBldmVudE92ZXJsYXA6IGZ1bmN0aW9uIChzdGlsbEV2ZW50LCBtb3ZpbmdFdmVudCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9LCA1MDApO1xyXG4gICAgfTtcclxuXHJcbiAgICB2YXIgY2FsbFByaW50ID0gZnVuY3Rpb24gKHJlcG9ydCwgcmVwb3J0SWQsIGNhbGxiYWNrKSB7XHJcbiAgICAgICAgaWYgKHJlcG9ydC5yZXBvcnRGcm9tID09PSB1bmRlZmluZWQpXHJcbiAgICAgICAgICAgIHJlcG9ydC5yZXBvcnRGcm9tID0gXCJwYWdlXCI7XHJcbiAgICAgICAgdmFyIGRhdGFzZXJ2aWNlID0gYW5ndWxhci5lbGVtZW50KGRvY3VtZW50KS5pbmplY3RvcigpLmludm9rZShmdW5jdGlvbiAoZGF0YXNlcnZpY2UpIHsgcmV0dXJuIGRhdGFzZXJ2aWNlOyB9KTtcclxuICAgICAgICB2YXIgbmdBdXRoU2V0dGluZ3MgPSBhbmd1bGFyLmVsZW1lbnQoZG9jdW1lbnQpLmluamVjdG9yKCkuaW52b2tlKGZ1bmN0aW9uIChuZ0F1dGhTZXR0aW5ncykgeyByZXR1cm4gbmdBdXRoU2V0dGluZ3M7IH0pO1xyXG4gICAgICAgIHZhciByZXBvcnRVUkwgPSBuZ0F1dGhTZXR0aW5ncy5hcHBVUkwgKyBcIlZpZXdzU3RhdGljL1JlcG9ydEZvcm0uYXNweD9cIlxyXG4gICAgICAgIHZhciBhdXRoU2VydmljZSA9IGFuZ3VsYXIuZWxlbWVudChkb2N1bWVudCkuaW5qZWN0b3IoKS5pbnZva2UoZnVuY3Rpb24gKGF1dGhTZXJ2aWNlKSB7IHJldHVybiBhdXRoU2VydmljZTsgfSk7XHJcbiAgICAgICAgdmFyIHVzZXJJZCA9IFwiMFwiO1xyXG4gICAgICAgIGlmIChhdXRoU2VydmljZS5hdXRoZW50aWNhdGlvbiAhPT0gdW5kZWZpbmVkICYmIGF1dGhTZXJ2aWNlLmF1dGhlbnRpY2F0aW9uLnVzZXJJZCAhPT0gdW5kZWZpbmVkICYmIGF1dGhTZXJ2aWNlLmF1dGhlbnRpY2F0aW9uLnVzZXJJZCAhPT0gXCJcIilcclxuICAgICAgICAgICAgdXNlcklkID0gYXV0aFNlcnZpY2UuYXV0aGVudGljYXRpb24udXNlcklkLnRvU3RyaW5nKCk7XHJcbiAgICAgICAgdmFyIHBvc3REYXRhID0geyBcIlJlcG9ydFJlcXVlc3RJZFwiOiBcIjBcIiwgXCJSZXBvcnREZXRhaWxJZFwiOiByZXBvcnRJZCwgXCJPYmplY3RTdGF0ZVwiOiAxLCBcIlN0YXR1c1wiOiAwLCBcIlNvdXJjZVwiOiByZXBvcnQucmVwb3J0RnJvbSB9O1xyXG4gICAgICAgIGRhdGFzZXJ2aWNlLnBvc3RTZXJ2ZXJEYXRhKFwiUmVwb3J0c1NhdmVcIiwgcG9zdERhdGEpLnRoZW4oZnVuY3Rpb24gKGRhdGEpIHtcclxuICAgICAgICAgICAgcmVwb3J0LnRpdGxlID0gZGF0YS50aXRsZSB8fCByZXBvcnQudGl0bGUgfHwgXCJcIjtcclxuICAgICAgICAgICAgcmVwb3J0LmV4cG9ydCA9IHJlcG9ydC5leHBvcnQgfHwgXCJmYWxzZVwiO1xyXG5cclxuICAgICAgICAgICAgaWYgKHJlcG9ydC5wYXJhbWV0ZXJzICE9PSB1bmRlZmluZWQgJiYgcmVwb3J0LnBhcmFtZXRlcnMgIT09IG51bGwgJiYgcmVwb3J0LnBhcmFtZXRlcnMubGVuZ3RoICE9PSAwKVxyXG4gICAgICAgICAgICAgICAgcmVwb3J0LnNvdXJjZSA9IHJlcG9ydFVSTCArIFwicj1cIiArIGRhdGEuR3VJZCArIFwiJnJwPVwiICsgSlNPTi5zdHJpbmdpZnkocmVwb3J0LnBhcmFtZXRlcnMpICsgXCImZXhwb3J0PVwiICsgcmVwb3J0LmV4cG9ydCArIFwiJnRpdGxlPVwiICsgcmVwb3J0LnRpdGxlICsgXCImdXNlcmlkPVwiICsgdXNlcklkO1xyXG4gICAgICAgICAgICBlbHNlXHJcbiAgICAgICAgICAgICAgICByZXBvcnQuc291cmNlID0gcmVwb3J0VVJMICsgXCJyPVwiICsgZGF0YS5HdUlkICsgXCImZXhwb3J0PVwiICsgcmVwb3J0LmV4cG9ydCArIFwiJnRpdGxlPVwiICsgcmVwb3J0LnRpdGxlICsgXCImdXNlcmlkPVwiICsgdXNlcklkO1xyXG5cclxuICAgICAgICAgICAgY2FsbGJhY2soZGF0YSk7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9O1xyXG5cclxuICAgIHZhciBjaGFydFNldHRpbmcgPSBmdW5jdGlvbiAoZWwsIGRhdGEsIHNjb3BlKSB7XHJcbiAgICAgICAgb3JnX2NoYXJ0ID0gbnVsbDtcclxuICAgICAgICB2YXIgY2hhcnQgPSAkKCQoZWwpLmZpbmQoXCJkaXZbdHlwZT0nb3JnQ2hhcnQnXVwiKVswXSk7XHJcbiAgICAgICAgLy9jaGFydC5vcmdDaGFydChcImRlc3Ryb3lcIik7XHJcblxyXG4gICAgICAgIG9yZ19jaGFydCA9IGNoYXJ0Lm9yZ0NoYXJ0KHtcclxuICAgICAgICAgICAgbW9kZWxJZDogZGF0YS5tb2RlbElkLFxyXG4gICAgICAgICAgICBkYXRhOiBkYXRhLmRhdGEsXHJcbiAgICAgICAgICAgIHNob3dDb250cm9sczogZGF0YS5zaG93Q29udHJvbHMsXHJcbiAgICAgICAgICAgIGFsbG93RWRpdDogZGF0YS5hbGxvd0VkaXQsXHJcbiAgICAgICAgICAgIG5ld05vZGVUZXh0OiBkYXRhLm5ld05vZGVUZXh0LFxyXG4gICAgICAgICAgICBkcmFnQW5kRHJvcDogZGF0YS5kcmFnQW5kRHJvcCxcclxuICAgICAgICAgICAgcGFuZWxIZWlnaHQ6IGRhdGEucGFuZWxIZWlnaHQsXHJcbiAgICAgICAgICAgIGVudHJ5VHlwZTogZGF0YS5lbnRyeVR5cGUsXHJcbiAgICAgICAgICAgIGZpcnN0TGV2ZWw6IGRhdGEuZmlyc3RMZXZlbCxcclxuICAgICAgICAgICAgbmV4dExldmVsOiBkYXRhLm5leHRMZXZlbCxcclxuICAgICAgICAgICAgb25BZGROb2RlOiBmdW5jdGlvbiAoZXZlbnQsIGVsZW1lbnQsIHZpZXcpIHtcclxuICAgICAgICAgICAgICAgIGlmIChzY29wZS5uYXZjb25EYXRhLmNoYXJ0QWN0aW9uQ2xpY2sgIT09IG51bGwpIHtcclxuICAgICAgICAgICAgICAgICAgICBzY29wZS5uYXZjb25EYXRhLmNoYXJ0QWN0aW9uQ2xpY2soXCJBZGRcIiwgc2NvcGUudHlwZSwgZXZlbnQsIG9yZ19jaGFydC5vcHRzLmRhdGEsIG9yZ19jaGFydCwgZnVuY3Rpb24gKGRhdGEpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgb3JnX2NoYXJ0Lm5ld05vZGUoZXZlbnQuZGF0YS5pZCk7XHJcbiAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBlbHNlXHJcbiAgICAgICAgICAgICAgICAgICAgb3JnX2NoYXJ0Lm5ld05vZGUoZXZlbnQuZGF0YS5pZCk7XHJcbiAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgIG9uVXBkYXRlTm9kZTogZnVuY3Rpb24gKGV2ZW50LCBlbGVtZW50LCB2aWV3KSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoc2NvcGUubmF2Y29uRGF0YS5jaGFydEFjdGlvbkNsaWNrICE9PSBudWxsKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgc2NvcGUubmF2Y29uRGF0YS5jaGFydEFjdGlvbkNsaWNrKFwiU2F2ZVwiLCBzY29wZS50eXBlLCBldmVudCwgb3JnX2NoYXJ0Lm9wdHMuZGF0YSwgb3JnX2NoYXJ0KTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgb25EZWxldGVOb2RlOiBmdW5jdGlvbiAobm9kZSkge1xyXG4gICAgICAgICAgICAgICAgLy9sb2coJ0RlbGV0ZWQgbm9kZSAnK25vZGUuZGF0YS5pZCk7XHJcbiAgICAgICAgICAgICAgICBvcmdfY2hhcnQuZGVsZXRlTm9kZShub2RlLmRhdGEuaWQpO1xyXG5cclxuICAgICAgICAgICAgICAgIGlmIChzY29wZS5uYXZjb25EYXRhLmNoYXJ0QWN0aW9uQ2xpY2sgIT09IG51bGwpIHtcclxuICAgICAgICAgICAgICAgICAgICBzY29wZS5uYXZjb25EYXRhLmNoYXJ0QWN0aW9uQ2xpY2soXCJEZWxldGVcIiwgc2NvcGUudHlwZSwgbm9kZS5kYXRhLCBvcmdfY2hhcnQub3B0cy5kYXRhLCBvcmdfY2hhcnQpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICBvbkNsaWNrTm9kZTogZnVuY3Rpb24gKG5vZGUpIHtcclxuICAgICAgICAgICAgICAgIC8vbG9nKCdDbGlja2VkIG5vZGUgJytub2RlLmRhdGEuaWQpO1xyXG4gICAgICAgICAgICAgICAgLy9hbGVydChcInRlc3Q6IG5vZGUgY2xpY2tlZFwiKTtcclxuICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgb25EYXRhOiBmdW5jdGlvbiAoZGF0YSkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5kYXRhID0gZGF0YTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG4gICAgfTtcclxuXHJcbiAgICB2YXIgdHJlZVNldHRpbmcgPSBmdW5jdGlvbiAoZWwsIG9wdGlvbnMsIHNjb3BlLCBmaWVsZHMsIGlzRXhwYW5kKSB7XHJcbiAgICAgICAgdmFyIHNlbGYgPSB0aGlzO1xyXG4gICAgICAgIHNlbGYub3B0aW9ucyA9IG9wdGlvbnM7XHJcbiAgICAgICAgc2VsZi5zY29wZSA9IHNjb3BlO1xyXG4gICAgICAgIHNlbGYuZmllbGRzID0gZmllbGRzO1xyXG4gICAgICAgIHNlbGYuaXNFeHBhbmQgPSBpc0V4cGFuZDtcclxuXHJcbiAgICAgICAgc2VsZi50cmVlID0gJCgkKGVsKS5maW5kKFwiZGl2W3R5cGU9J3RyZWUnXVwiKVswXSk7XHJcbiAgICAgICAgc2VsZi50cmVlLmpzdHJlZShcImRlc3Ryb3lcIik7XHJcblxyXG4gICAgICAgIHNlbGYudHJlZS5qc3RyZWUoe1xyXG4gICAgICAgICAgICBjb3JlOiBvcHRpb25zLmNvcmUsXHJcbiAgICAgICAgICAgIGdyaWQ6IG9wdGlvbnMuZ3JpZCxcclxuICAgICAgICAgICAgc2VhcmNoOiB7IFwic2hvd19vbmx5X21hdGNoZXNcIjogdHJ1ZSB9LFxyXG4gICAgICAgICAgICBwbHVnaW5zOiBvcHRpb25zLnBsdWdpbnMgIT09IHVuZGVmaW5lZCA/IG9wdGlvbnMucGx1Z2lucyA6IFsnZ3JpZCcsICd0eXBlcycsICdzZWFyY2gnXSxcclxuICAgICAgICAgICAgY2hlY2tib3g6IG9wdGlvbnMuY2hlY2tib3hcclxuICAgICAgICB9KTtcclxuXHJcblxyXG5cclxuICAgICAgICBzZWxmLnRyZWUuYmluZChcInNlbGVjdF9ub2RlLmpzdHJlZVwiLCBmdW5jdGlvbiAoZXZ0LCBkYXRhKSB7XHJcbiAgICAgICAgICAgIHNlbGYuc2NvcGUudHlwZSA9ICQoZXZlbnQudGFyZ2V0KS5wYXJlbnRzKCduYXZjb24tdHJlZScpLmZpcnN0KCkuYXR0cihcInR5cGVcIikgfHwgc2NvcGUudHlwZTtcclxuXHJcbiAgICAgICAgICAgIHZhciB0YXJnZXQgPSAkKGV2ZW50LnRhcmdldCk7XHJcblxyXG4gICAgICAgICAgICAvL3NldFZpZXdDb250ZW50RGlzYWJsZWQoXCJcIik7XHJcblxyXG4gICAgICAgICAgICBpZiAodGFyZ2V0LmlzKCcuZmEtdHJhc2gtbycpKSB7XHJcbiAgICAgICAgICAgICAgICAvL2lmICh0YXJnZXQucGFyZW50KCkgIT09IG51bGwgJiYgdGFyZ2V0LnBhcmVudCgpLmF0dHIoXCJkaXNibGVkXCIpID09PSBcImRpc2FibGVkXCIpIHJldHVybiB0cnVlO1xyXG5cclxuICAgICAgICAgICAgICAgIHNlbGYuc2NvcGUubmF2Y29uRGF0YS50cmVlQWN0aW9uQ2xpY2soXCJkZWxldGVcIiwgc2VsZi5zY29wZS50eXBlLCBkYXRhLCBzZWxmLnRyZWUpO1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZSBpZiAodGFyZ2V0LmlzKCcuZmEtZXllJykpIHtcclxuICAgICAgICAgICAgICAgIHNlbGYuc2NvcGUubmF2Y29uRGF0YS50cmVlQWN0aW9uQ2xpY2soXCJ2aWV3XCIsIHNlbGYuc2NvcGUudHlwZSwgZGF0YSwgc2VsZi50cmVlKTtcclxuICAgICAgICAgICAgICAgIC8vc2V0Vmlld0NvbnRlbnREaXNhYmxlZChcInZpZXdcIik7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBlbHNlIGlmICh0YXJnZXQuaXMoJy5mYS1maWxlLW8nKSkge1xyXG4gICAgICAgICAgICAgICAgc2VsZi5zY29wZS5uYXZjb25EYXRhLnRyZWVBY3Rpb25DbGljayhcImFkZFwiLCBzZWxmLnNjb3BlLnR5cGUsIGRhdGEsIHNlbGYudHJlZSk7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBlbHNlIGlmICh0YXJnZXQuaXMoJy5mYS1lZGl0JykpIHtcclxuICAgICAgICAgICAgICAgIC8vaWYgKHRhcmdldC5wYXJlbnQoKSAhPT0gbnVsbCAmJiB0YXJnZXQucGFyZW50KCkuYXR0cihcImRpc2JsZWRcIikgPT09IFwiZGlzYWJsZWRcIikgcmV0dXJuIHRydWU7XHJcblxyXG4gICAgICAgICAgICAgICAgc2VsZi5zY29wZS5uYXZjb25EYXRhLnRyZWVBY3Rpb25DbGljayhcImVkaXRcIiwgc2VsZi5zY29wZS50eXBlLCBkYXRhLCBzZWxmLnRyZWUpO1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZSBpZiAodGFyZ2V0LmlzKCcuZmEtYW5nbGUtZG93bicpKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAodGFyZ2V0LnBhcmVudCgpLnBhcmVudCgpLnBhcmVudCgpLmZpbmQoXCIuZHJvcGRvd25cIikgPT09IHVuZGVmaW5lZCB8fCB0YXJnZXQucGFyZW50KCkucGFyZW50KCkucGFyZW50KCkuZmluZChcIi5kcm9wZG93blwiKS5sZW5ndGggPT09IDApIHtcclxuICAgICAgICAgICAgICAgICAgICB0YXJnZXQud3JhcChcIjx1bCBjbGFzcz0nbmF2IHB1bGwtcmlnaHQnID48bGkgY2xhc3M9J2Ryb3Bkb3duIGRyb3Bkb3duLWV4dGVuZGVkIGRyb3Bkb3duLXRhc2tzJz48YSBocmVmPSdqYXZhc2NyaXB0OjsnIGRhdGEtdG9nZ2xlPSdkcm9wZG93bicgZGF0YS1ob3Zlcj0nZHJvcGRvd24nIGRhdGEtY2xvc2Utb3RoZXJzPSd0cnVlJz48L2E+PGxpPjwvdWw+XCIpO1xyXG4gICAgICAgICAgICAgICAgICAgIHRhcmdldC5wYXJlbnQoKS5wYXJlbnQoKS5hcHBlbmQoJzx1bCBjbGFzcz1cImRyb3Bkb3duLW1lbnUgZXh0ZW5kZWQgdGFza3NcIiBpZD1cIicgKyBzZWxmLnNjb3BlLnR5cGUgKyAnZGF0YVwiPjwvdWw+Jyk7XHJcbiAgICAgICAgICAgICAgICAgICAgZm9yIChpID0gMDsgaSA8IGRhdGEubm9kZS5kYXRhLmFjdGlvbmRhdGEubGVuZ3RoOyBpKyspXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRhcmdldC5wYXJlbnQoKS5wYXJlbnQoKS5maW5kKFwiW2lkPVwiICsgc2VsZi5zY29wZS50eXBlICsgXCJkYXRhXVwiKS5hcHBlbmQoJzxsaSBjbGFzcz1cImV4dGVybmFsXCI+PGRpdiBjbGFzcz1cImg0IHRleHQtY2VudGVyXCI+JyArIGRhdGEubm9kZS5kYXRhLmFjdGlvbmRhdGFbaV0gKyAnPC9kaXY+PC9saT4nKTtcclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAkKFwiW3R5cGU9XCIgKyBzZWxmLnNjb3BlLnR5cGUgKyBcIl1cIikuZmluZCgnLm5hdicpLmVhY2goZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgICAgICQodGhpcykuY3NzKFwicG9zaXRpb25cIiwgXCJpbmhlcml0XCIpO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICB0YXJnZXQucGFyZW50KCkucGFyZW50KCkucGFyZW50KCkuY3NzKFwicG9zaXRpb25cIiwgXCJmaXhlZFwiKTtcclxuXHJcbiAgICAgICAgICAgICAgICAkKFwiW3R5cGU9XCIgKyBzZWxmLnNjb3BlLnR5cGUgKyBcIl1cIikuZmluZCgnLm5hdiBhJykuZWFjaChmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgJCh0aGlzKS5jc3MoXCJkaXNwbGF5XCIsIFwiYmxvY2tcIik7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgIHRhcmdldC5wYXJlbnQoKS5jc3MoXCJkaXNwbGF5XCIsIFwibm9uZVwiKTtcclxuXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZSBpZiAodGFyZ2V0LmlzKCcuaDQudGV4dC1jZW50ZXInKSkge1xyXG4gICAgICAgICAgICAgICAgc2VsZi5zY29wZS5uYXZjb25EYXRhLnRyZWVBY3Rpb25DbGljayhcImFjdGlvbmRhdGFcIiwgdGFyZ2V0LnRleHQoKSwgZGF0YSwgc2VsZi50cmVlKTtcclxuICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgaWYgKCQoZXZlbnQudGFyZ2V0KS5maW5kKFwiT1BUSU9OXCIpLmxlbmd0aCA+IDApIHtcclxuICAgICAgICAgICAgICAgICAgICAkKGV2ZW50LnRhcmdldCkuZm9jdXMoKTtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBpZiAoJChldmVudC50YXJnZXQpLmZpbmQoXCIubmF2XCIpLmNoaWxkcmVuKCkubGVuZ3RoID4gMCkge1xyXG4gICAgICAgICAgICAgICAgICAgICQoXCJbdHlwZT0nXCIgKyBzZWxmLnNjb3BlLnR5cGUgKyBcIiddXCIpLmZpbmQoJy5uYXYnKS5lYWNoKGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgJCh0aGlzKS5jc3MoXCJwb3NpdGlvblwiLCBcImluaGVyaXRcIik7XHJcbiAgICAgICAgICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICQoXCJbdHlwZT0nXCIgKyBzZWxmLnNjb3BlLnR5cGUgKyBcIiddXCIpLmZpbmQoJy5uYXYgYScpLmVhY2goZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAkKHRoaXMpLmNzcyhcImRpc3BsYXlcIiwgXCJibG9ja1wiKTtcclxuICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGlmIChzZWxmLnNjb3BlLm5hdmNvbkRhdGEudHJlZUFjdGlvbkNsaWNrICE9PSB1bmRlZmluZWQpXHJcbiAgICAgICAgICAgICAgICAgICAgc2VsZi5zY29wZS5uYXZjb25EYXRhLnRyZWVBY3Rpb25DbGljayhcImNlbGxDbGlja1wiLCBkYXRhLm5vZGUudGV4dCwgZGF0YSwgc2VsZi50cmVlKTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgaWYgKHNlbGYuc2NvcGUubmF2Y29uRGF0YS50cmVlQWN0aW9uQ2xpY2sgIT09IHVuZGVmaW5lZClcclxuICAgICAgICAgICAgICAgIHNlbGYuc2NvcGUubmF2Y29uRGF0YS50cmVlQWN0aW9uQ2xpY2soXCJjZWxsQ2xpY2tcIiwgc2VsZi5zY29wZS50eXBlLCBkYXRhLm5vZGUudGV4dCwgZGF0YSwgc2VsZi50cmVlLCB0YXJnZXQpO1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICBzZWxmLnRyZWUuYmluZChcImluaXQuanN0cmVlXCIsIGZ1bmN0aW9uIChldmVudCkge1xyXG5cclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgLy9zZWxmLnRyZWUuYmluZChcImNoYW5nZWQuanN0cmVlXCIsIGZ1bmN0aW9uIChldmVudCxkYXRhKSB7XHJcbiAgICAgICAgLy8gICAgc2V0QXBwcnZvZWRUcmVlZUNvbHVtbk9wdGlvbnMoc2VsZi5zY29wZS50eXBlLCBzZWxmLm9wdGlvbnMpO1xyXG4gICAgICAgIC8vfSk7XHJcblxyXG5cclxuICAgICAgICBzZWxmLnRyZWUuYmluZChcImxvYWRlZC5qc3RyZWVcIiwgZnVuY3Rpb24gKGV2ZW50LCBkYXRhKSB7XHJcbiAgICAgICAgICAgIHNlbGYudHJlZUNsaWNrRXZlbnQoKTtcclxuXHJcbiAgICAgICAgICAgIGlmIChzZWxmLmlzRXhwYW5kID09PSBcInRydWVcIiB8fCBzZWxmLmlzRXhwYW5kID09PSB0cnVlKSB7XHJcbiAgICAgICAgICAgICAgICBzZWxmLnRyZWUuanN0cmVlKCdvcGVuX2FsbCcpO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgc2VsZi50cmVlLmpzdHJlZSgnY2xvc2VfYWxsJyk7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIHNldERpc2FibGVkRW5hYmxlZEJ5UmlnaHRzKHNjb3BlLm5hdmNvbkRhdGEucmlnaHRzKTtcclxuICAgICAgICAgICAgdmFyIHZpZXdNb2RlID0gc2NvcGUubmF2Y29uRGF0YVtzY29wZS5maWVsZFNldF0ubW9kZSA9PT0gdW5kZWZpbmVkID8gXCJcIiA6IHNjb3BlLm5hdmNvbkRhdGFbc2NvcGUuZmllbGRTZXRdLm1vZGU7XHJcbiAgICAgICAgICAgIHNldFZpZXdDb250ZW50RGlzYWJsZWQodmlld01vZGUudG9Mb3dlckNhc2UoKSA9PT0gXCJwcmludFwiID8gXCJ2aWV3XCIgOiB2aWV3TW9kZSk7XHJcbiAgICAgICAgICAgIC8vc2V0QXBwcnZvZWRUcmVlZUNvbHVtbk9wdGlvbnMoc2VsZi5zY29wZS50eXBlLHNlbGYub3B0aW9ucyk7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIHNlbGYudHJlZS5iaW5kKFwibG9hZGVkX2dyaWQuanN0cmVlXCIsIGZ1bmN0aW9uIChldmVudCwgZGF0YSkge1xyXG4gICAgICAgICAgICAvL2NvbnNvbGUubG9nKGRhdGEpO1xyXG4gICAgICAgICAgICAvL3NldEFwcHJ2b2VkVHJlZWVDb2x1bW5PcHRpb25zKHNlbGYuc2NvcGUudHlwZSwgc2VsZi5vcHRpb25zKTtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgc2VsZi50cmVlLmJpbmQoXCJhZnRlcl9vcGVuLmpzdHJlZVwiLCBmdW5jdGlvbiAoZXZlbnQsIGRhdGEpIHtcclxuICAgICAgICAgICAgLy9jb25zb2xlLmxvZyhldmVudCk7XHJcbiAgICAgICAgICAgIHNlbGYudHJlZUNsaWNrRXZlbnQoKTtcclxuXHJcbiAgICAgICAgICAgIHNldERpc2FibGVkRW5hYmxlZEJ5UmlnaHRzKHNjb3BlLm5hdmNvbkRhdGEucmlnaHRzKTtcclxuICAgICAgICAgICAgLy9zZXRWaWV3Q29udGVudERpc2FibGVkKHNjb3BlLm5hdmNvbkRhdGFbc2NvcGUuZmllbGRTZXRdLm1vZGUpO1xyXG4gICAgICAgICAgICAvL3NldEFwcHJ2b2VkVHJlZWVDb2x1bW5PcHRpb25zKHNlbGYuc2NvcGUudHlwZSxzZWxmLm9wdGlvbnMpO1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICBzZWxmLnRyZWUuYmluZChcInJlZHJhdy5qc3RyZWVcIiwgZnVuY3Rpb24gKGV2dCwgZGF0YSkge1xyXG4gICAgICAgICAgICBzZWxmLmRhdGEgPSBkYXRhO1xyXG4gICAgICAgICAgICBzZWxmLnRyZWVDbGlja0V2ZW50KCk7XHJcbiAgICAgICAgICAgIHNldERpc2FibGVkRW5hYmxlZEJ5UmlnaHRzKHNjb3BlLm5hdmNvbkRhdGEucmlnaHRzKTtcclxuICAgICAgICAgICAgLy9zZXRWaWV3Q29udGVudERpc2FibGVkKHNjb3BlLm5hdmNvbkRhdGFbc2NvcGUuZmllbGRTZXRdLm1vZGUpO1xyXG4gICAgICAgICAgICAvL3NldEFwcHJ2b2VkVHJlZWVDb2x1bW5PcHRpb25zKHNlbGYuc2NvcGUudHlwZSwgc2VsZi5vcHRpb25zKTtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgc2VsZi50cmVlLmJpbmQoXCJjcmVhdGVfbm9kZS5qc3RyZWVcIiwgZnVuY3Rpb24gKGV2dCwgZGF0YSkge1xyXG4gICAgICAgICAgICBzZWxmLmRhdGEgPSBkYXRhO1xyXG4gICAgICAgICAgICBzZWxmLnRyZWVDbGlja0V2ZW50KCk7XHJcbiAgICAgICAgICAgIHNldERpc2FibGVkRW5hYmxlZEJ5UmlnaHRzKHNjb3BlLm5hdmNvbkRhdGEucmlnaHRzKTtcclxuICAgICAgICAgICAgLy9zZXRWaWV3Q29udGVudERpc2FibGVkKHNjb3BlLm5hdmNvbkRhdGFbc2NvcGUuZmllbGRTZXRdLm1vZGUpO1xyXG4gICAgICAgICAgICAvL3NldEFwcHJ2b2VkVHJlZWVDb2x1bW5PcHRpb25zKHNlbGYuc2NvcGUudHlwZSwgc2VsZi5vcHRpb25zKTtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgc2VsZi50cmVlQ2xpY2tFdmVudCA9IGZ1bmN0aW9uICgpIHtcclxuXHJcbiAgICAgICAgICAgICQoJy5qc3RyZWUtZ3JpZC1taWR3cmFwcGVyJykuZmluZCgnaW5wdXRbdHlwZT1jaGVja2JveF0nKS5jbGljayhmdW5jdGlvbiAoZXZlbnQsIHR0KSB7XHJcbiAgICAgICAgICAgICAgICAvL2NvbnNvbGUubG9nKFwiY2xpY2stY2hlY2tib3hcIik7XHJcbiAgICAgICAgICAgICAgICB2YXIgaGVhZGVyID0gJCgkKCQoZXZlbnQuY3VycmVudFRhcmdldC5vZmZzZXRQYXJlbnQpLnBhcmVudCgpLmNoaWxkcmVuKClbMF0pLmZpbmQoJ2RpdicpWzBdKS50ZXh0KCk7XHJcbiAgICAgICAgICAgICAgICB2YXIgbm9kZSA9IHNlbGYuZGF0YS5pbnN0YW5jZS5nZXRfbm9kZSgkKGV2ZW50LmN1cnJlbnRUYXJnZXQub2Zmc2V0UGFyZW50KS5hdHRyKCdkYXRhLWpzdHJlZWdyaWQnKSk7XHJcbiAgICAgICAgICAgICAgICB2YXIgY29sdW1ucyA9IHNlbGYuZGF0YS5pbnN0YW5jZS5fZ3JpZFNldHRpbmdzLmNvbHVtbnM7XHJcbiAgICAgICAgICAgICAgICB2YXIgZmllbGQgPSBzZWxmLmdldENvbHVtblZhbHVlKGhlYWRlciwgY29sdW1ucyk7XHJcbiAgICAgICAgICAgICAgICB2YXIgdmFsdWUgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgIGlmICgkKGV2ZW50LnRhcmdldCkuYXR0cihcImNoZWNrZWRcIikgPT09IFwiY2hlY2tlZFwiKVxyXG4gICAgICAgICAgICAgICAgICAgIHZhbHVlID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgIHZhciB1cGRWYWx1ZSA9IHVwZGF0ZVRyZWVEYXRhKHNlbGYuZGF0YS5pbnN0YW5jZS5zZXR0aW5ncy5jb3JlLmRhdGEsICh0eXBlb2Ygbm9kZS5pZCA9PT0gXCJzdHJpbmdcIiA/IG5vZGUuaWQgOiBwYXJzZUludChub2RlLmlkKSksIGZpZWxkLCB2YWx1ZSk7XHJcbiAgICAgICAgICAgICAgICBub2RlLmRhdGFbZmllbGRdID0gdmFsdWUgPT09IHRydWUgPyAxIDogMDtcclxuICAgICAgICAgICAgICAgIGlmIChzZWxmLnNjb3BlLm5hdmNvbkRhdGEgIT09IHVuZGVmaW5lZCAmJiBzZWxmLnNjb3BlLm5hdmNvbkRhdGEudHJlZUNlbGxDbGljayAhPT0gdW5kZWZpbmVkKVxyXG4gICAgICAgICAgICAgICAgICAgIHNlbGYuc2NvcGUubmF2Y29uRGF0YS50cmVlQ2VsbENsaWNrKG5vZGUuaWQsIGZpZWxkLCB2YWx1ZSwgbm9kZSwgc2VsZi50cmVlLCAkKHRoaXMpKVxyXG4gICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgICQoJy5qc3RyZWUtZ3JpZC1taWR3cmFwcGVyJykuZmluZCgnaW5wdXRbdHlwZT10ZXh0XScpLmNsaWNrKGZ1bmN0aW9uIChldmVudCwgdHQpIHtcclxuICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgICAgICQoZXZlbnQudGFyZ2V0KS5mb2N1cygpO1xyXG4gICAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICAkKCcuanN0cmVlLWdyaWQtbWlkd3JhcHBlcicpLmZpbmQoJ3RleHRhcmVhJykuY2xpY2soZnVuY3Rpb24gKGV2ZW50LCB0dCkge1xyXG4gICAgICAgICAgICAgICAgLy9zZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgIC8vICAgICQoZXZlbnQudGFyZ2V0KS5mb2N1cygpO1xyXG4gICAgICAgICAgICAgICAgLy99KVxyXG4gICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgICQoJy5qc3RyZWUtZ3JpZC1taWR3cmFwcGVyJykuZmluZCgnc2VsZWN0JykuY2xpY2soZnVuY3Rpb24gKGV2ZW50LCB0dCkge1xyXG4gICAgICAgICAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgJChldmVudC50YXJnZXQpLmZvY3VzKCk7XHJcbiAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgICQoJy5qc3RyZWUtZ3JpZC1taWR3cmFwcGVyJykuZmluZCgnc2VsZWN0JykuYmx1cihmdW5jdGlvbiAoZXZlbnQsIHR0KSB7XHJcbiAgICAgICAgICAgICAgICAkKHRoaXMpLmF0dHIoXCJzaXplXCIsIDEpLmNzcygnei1pbmRleCcsICcxJyk7XHJcbiAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgJCgnLmpzdHJlZS1ncmlkLW1pZHdyYXBwZXInKS5maW5kKCdzZWxlY3QnKS5mb2N1cyhmdW5jdGlvbiAoZXZlbnQsIHR0KSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoJChldmVudC50YXJnZXQpLmlzKCdvcHRpb24nKSkgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgLy8kKGV2ZW50LnRhcmdldCkuY3NzKFwibGVmdFwiLCQoZXZlbnQudGFyZ2V0KS5wYXJlbnRzKCdkaXYnKS5maXJzdCgpLm9mZnNldCgpLmxlZnQgKyBcInB4XCIpO1xyXG4gICAgICAgICAgICAgICAgdmFyIGV4cGFuZHRvID0gJChldmVudC50YXJnZXQpLmZpbmQoJ29wdGlvbicpLmxlbmd0aDtcclxuICAgICAgICAgICAgICAgIGlmIChleHBhbmR0byA+IDUpIGV4cGFuZHRvID0gNTtcclxuICAgICAgICAgICAgICAgICQodGhpcykuYXR0cihcInNpemVcIiwgZXhwYW5kdG8pLmNzcygnei1pbmRleCcsIDIpO1xyXG4gICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgICQoJy5qc3RyZWUtZ3JpZC1taWR3cmFwcGVyJykuZmluZCgnaW5wdXRbdHlwZT10ZXh0XScpLmJsdXIoZnVuY3Rpb24gKGV2ZW50LCB0dCkge1xyXG4gICAgICAgICAgICAgICAgdmFyIGhlYWRlciA9ICQoJCgkKGV2ZW50LmN1cnJlbnRUYXJnZXQub2Zmc2V0UGFyZW50KS5wYXJlbnQoKS5jaGlsZHJlbigpWzBdKS5maW5kKCdkaXYnKVswXSkudGV4dCgpO1xyXG4gICAgICAgICAgICAgICAgdmFyIG5vZGUgPSBzZWxmLmRhdGEuaW5zdGFuY2UuZ2V0X25vZGUoJChldmVudC5jdXJyZW50VGFyZ2V0Lm9mZnNldFBhcmVudCkuYXR0cignZGF0YS1qc3RyZWVncmlkJykpO1xyXG4gICAgICAgICAgICAgICAgdmFyIGNvbHVtbnMgPSBzZWxmLmRhdGEuaW5zdGFuY2UuX2dyaWRTZXR0aW5ncy5jb2x1bW5zO1xyXG4gICAgICAgICAgICAgICAgdmFyIGZpZWxkID0gc2VsZi5nZXRDb2x1bW5WYWx1ZShoZWFkZXIsIGNvbHVtbnMpO1xyXG4gICAgICAgICAgICAgICAgdmFyIHZhbHVlID0gJChldmVudC50YXJnZXQpLnZhbCgpO1xyXG4gICAgICAgICAgICAgICAgdmFyIHVwZFZhbHVlID0gdXBkYXRlVHJlZURhdGEoc2VsZi5kYXRhLmluc3RhbmNlLnNldHRpbmdzLmNvcmUuZGF0YSwgcGFyc2VJbnQobm9kZS5pZCksIGZpZWxkLCB2YWx1ZSk7XHJcbiAgICAgICAgICAgICAgICBub2RlLmRhdGFbZmllbGRdID0gdmFsdWU7XHJcbiAgICAgICAgICAgICAgICBpZiAoc2VsZi5zY29wZS5uYXZjb25EYXRhICE9PSB1bmRlZmluZWQgJiYgc2VsZi5zY29wZS5uYXZjb25EYXRhLnRyZWVDZWxsQ2xpY2sgIT09IHVuZGVmaW5lZClcclxuICAgICAgICAgICAgICAgICAgICBzZWxmLnNjb3BlLm5hdmNvbkRhdGEudHJlZUNlbGxDbGljayhub2RlLmlkLCBmaWVsZCwgdmFsdWUsIG5vZGUsIHNlbGYudHJlZSwgJCh0aGlzKSlcclxuICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICAkKCcuanN0cmVlLWdyaWQtbWlkd3JhcHBlcicpLmZpbmQoJ3RleHRhcmVhJykuYmx1cihmdW5jdGlvbiAoZXZlbnQsIHR0KSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgaGVhZGVyID0gJCgkKCQoZXZlbnQuY3VycmVudFRhcmdldC5vZmZzZXRQYXJlbnQpLnBhcmVudCgpLmNoaWxkcmVuKClbMF0pLmZpbmQoJ2RpdicpWzBdKS50ZXh0KCk7XHJcbiAgICAgICAgICAgICAgICB2YXIgbm9kZSA9IHNlbGYuZGF0YS5pbnN0YW5jZS5nZXRfbm9kZSgkKGV2ZW50LmN1cnJlbnRUYXJnZXQub2Zmc2V0UGFyZW50KS5hdHRyKCdkYXRhLWpzdHJlZWdyaWQnKSk7XHJcbiAgICAgICAgICAgICAgICB2YXIgY29sdW1ucyA9IHNlbGYuZGF0YS5pbnN0YW5jZS5fZ3JpZFNldHRpbmdzLmNvbHVtbnM7XHJcbiAgICAgICAgICAgICAgICB2YXIgZmllbGQgPSBzZWxmLmdldENvbHVtblZhbHVlKGhlYWRlciwgY29sdW1ucyk7XHJcbiAgICAgICAgICAgICAgICB2YXIgdmFsdWUgPSAkKGV2ZW50LnRhcmdldCkudmFsKCk7XHJcbiAgICAgICAgICAgICAgICB2YXIgdXBkVmFsdWUgPSB1cGRhdGVUcmVlRGF0YShzZWxmLmRhdGEuaW5zdGFuY2Uuc2V0dGluZ3MuY29yZS5kYXRhLCBwYXJzZUludChub2RlLmlkKSwgZmllbGQsIHZhbHVlKTtcclxuICAgICAgICAgICAgICAgIG5vZGUuZGF0YVtmaWVsZF0gPSB2YWx1ZTtcclxuICAgICAgICAgICAgICAgIGlmIChzZWxmLnNjb3BlLm5hdmNvbkRhdGEgIT09IHVuZGVmaW5lZCAmJiBzZWxmLnNjb3BlLm5hdmNvbkRhdGEudHJlZUNlbGxDbGljayAhPT0gdW5kZWZpbmVkKVxyXG4gICAgICAgICAgICAgICAgICAgIHNlbGYuc2NvcGUubmF2Y29uRGF0YS50cmVlQ2VsbENsaWNrKG5vZGUuaWQsIGZpZWxkLCB2YWx1ZSwgbm9kZSwgc2VsZi50cmVlLCAkKHRoaXMpKVxyXG4gICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgICQoJy5qc3RyZWUtZ3JpZC1taWR3cmFwcGVyJykuZmluZCgnc2VsZWN0JykuY2hhbmdlKGZ1bmN0aW9uIChldmVudCwgdHQpIHtcclxuICAgICAgICAgICAgICAgICQodGhpcykuYXR0cihcInNpemVcIiwgMSkuY3NzKCd6LWluZGV4JywgJzEnKTtcclxuICAgICAgICAgICAgICAgIHZhciBoZWFkZXIgPSAkKCQoZXZlbnQuY3VycmVudFRhcmdldC5wYXJlbnROb2RlLnBhcmVudE5vZGUpLnBhcmVudCgpLmNoaWxkcmVuKClbMF0pLnRleHQoKTtcclxuICAgICAgICAgICAgICAgIHZhciBub2RlID0gc2VsZi5kYXRhLmluc3RhbmNlLmdldF9ub2RlKCQoZXZlbnQuY3VycmVudFRhcmdldC5wYXJlbnROb2RlLnBhcmVudE5vZGUpLmF0dHIoJ2RhdGEtanN0cmVlZ3JpZCcpKTtcclxuICAgICAgICAgICAgICAgIHZhciBjb2x1bW5zID0gc2VsZi5kYXRhLmluc3RhbmNlLl9ncmlkU2V0dGluZ3MuY29sdW1ucztcclxuICAgICAgICAgICAgICAgIHZhciBmaWVsZCA9IHNlbGYuZ2V0Q29sdW1uVmFsdWUoaGVhZGVyLCBjb2x1bW5zKTtcclxuICAgICAgICAgICAgICAgIHZhciB2YWx1ZSA9ICQoZXZlbnQudGFyZ2V0KS52YWwoKTtcclxuICAgICAgICAgICAgICAgIHZhciB1cGRWYWx1ZSA9IHVwZGF0ZVRyZWVEYXRhKHNlbGYuZGF0YS5pbnN0YW5jZS5zZXR0aW5ncy5jb3JlLmRhdGEsIHBhcnNlSW50KG5vZGUuaWQpLCBmaWVsZCwgdmFsdWUpO1xyXG4gICAgICAgICAgICAgICAgbm9kZS5kYXRhW2ZpZWxkXSA9IHZhbHVlO1xyXG4gICAgICAgICAgICAgICAgaWYgKHNlbGYuc2NvcGUubmF2Y29uRGF0YSAhPT0gdW5kZWZpbmVkICYmIHNlbGYuc2NvcGUubmF2Y29uRGF0YS50cmVlQ2VsbENsaWNrICE9PSB1bmRlZmluZWQpXHJcbiAgICAgICAgICAgICAgICAgICAgc2VsZi5zY29wZS5uYXZjb25EYXRhLnRyZWVDZWxsQ2xpY2sobm9kZS5pZCwgZmllbGQsIHZhbHVlLCBub2RlLCBzZWxmLnRyZWUsICQodGhpcykpXHJcbiAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgLy9zZXRBcHBydm9lZFRyZWVlQ29sdW1uT3B0aW9ucyhzZWxmLnNjb3BlLnR5cGUsIHNlbGYub3B0aW9ucyk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgc2VsZi5nZXRDb2x1bW5WYWx1ZSA9IGZ1bmN0aW9uIChoZWFkZXIsIGNvbHVtbnMpIHtcclxuICAgICAgICAgICAgZm9yIChrZXkgaW4gY29sdW1ucykge1xyXG4gICAgICAgICAgICAgICAgaWYgKGNvbHVtbnNba2V5XS52YWx1ZSA9PT0gdW5kZWZpbmVkKSBjb250aW51ZTtcclxuICAgICAgICAgICAgICAgIHZhciBjb2xIZWFkZXIgPSBjb2x1bW5zW2tleV0uaGVhZGVyO1xyXG4gICAgICAgICAgICAgICAgdmFyIHRleHQgPSBjb2xIZWFkZXI7XHJcbiAgICAgICAgICAgICAgICBpZiAoY29sSGVhZGVyLmluZGV4T2YoJzxkaXYnKSAhPT0gLTEpXHJcbiAgICAgICAgICAgICAgICAgICAgdGV4dCA9ICQoY29sSGVhZGVyKS50ZXh0KCk7XHJcbiAgICAgICAgICAgICAgICBpZiAodGV4dC50b0xvd2VyQ2FzZSgpLnRyaW0oKSA9PT0gaGVhZGVyLnRvTG93ZXJDYXNlKCkudHJpbSgpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKCEkLmlzRnVuY3Rpb24oY29sdW1uc1trZXldLnZhbHVlKSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGNvbHVtbnNba2V5XS52YWx1ZTtcclxuICAgICAgICAgICAgICAgICAgICBlbHNlXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBjb2x1bW5zW2tleV0uZmllbGQ7XHJcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICBzZWxmLmdldFRyZWVTZWxlY3RlZFZhbHVlID0gZnVuY3Rpb24gKHZhbHVlLCB0YXJnZXRWYWx1ZSkge1xyXG4gICAgICAgICAgICBpZiAodmFsdWUgPT09IHVuZGVmaW5lZCkgcmV0dXJuIHRhcmdldFZhbHVlO1xyXG4gICAgICAgICAgICB2YXIgcmV0VmFsID0gdGFyZ2V0VmFsdWU7XHJcbiAgICAgICAgICAgIGlmICh2YWx1ZSAhPT0gbnVsbCAmJiB2YWx1ZS50b1N0cmluZygpLmluZGV4T2YoJzxpbnB1dCcpICE9PSAtMSkge1xyXG4gICAgICAgICAgICAgICAgdmFyIHZhbHVlT2JqID0gJCh2YWx1ZSk7XHJcbiAgICAgICAgICAgICAgICBpZiAodmFsdWVPYmoucHJvcChcInR5cGVcIikgPT09IFwiY2hlY2tib3hcIikge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmICgkKGV2ZW50LnRhcmdldCkuYXR0cihcImNoZWNrZWRcIikgPT09IFwiY2hlY2tlZFwiKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICQodmFsdWVPYmopLmF0dHIoXCJjaGVja2VkXCIsIFwiY2hlY2tlZFwiKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCQodmFsdWVPYmopLmF0dHIoXCJjaGVja2VkXCIpICE9PSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlT2JqLnJlbW92ZUF0dHIoXCJjaGVja2VkXCIpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICB2YWx1ZU9iai5hdHRyKFwidmFsdWVcIiwgdGFyZ2V0VmFsdWUpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgdmFyIG1vZFN0ciA9IHZhbHVlT2JqLnByb3AoJ291dGVySFRNTCcpO1xyXG4gICAgICAgICAgICAgICAgcmV0VmFsID0gbW9kU3RyLnJlcGxhY2UoL1wiL2dpLCBcIidcIik7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgcmV0dXJuIHJldFZhbDtcclxuICAgICAgICB9O1xyXG5cclxuICAgIH07XHJcblxyXG4gICAgdmFyIHVwZGF0ZVRyZWVEYXRhID0gZnVuY3Rpb24gKGRhdGEsIGlkLCBmaWVsZCwgdmFsdWUpIHtcclxuICAgICAgICB2YXIgcmV0dXJuVmFsdWUgPSB2YWx1ZTtcclxuICAgICAgICB2YXIgaXRlbXMgPSBkYXRhO1xyXG4gICAgICAgIGlmIChpdGVtcy5sZW5ndGggPT09IDApIHJldHVybjtcclxuICAgICAgICB2YXIgdHJlZURhdGEgPSBnZXREYXRhRnJvbVRyZWUoaXRlbXMpO1xyXG4gICAgICAgIGZvciAodmFyIGkgPSAwLCBsZW4gPSB0cmVlRGF0YS5sZW5ndGg7IGkgPCBsZW4gOyBpKyspIHtcclxuICAgICAgICAgICAgdmFyIGl0ZW0gPSB0cmVlRGF0YVtpXTtcclxuICAgICAgICAgICAgaWYgKCEkLmlzRW1wdHlPYmplY3QoaXRlbSkpIHtcclxuICAgICAgICAgICAgICAgIGlmIChpdGVtLmlkICE9PSB1bmRlZmluZWQgJiYgKGl0ZW0uaWQgPT09IGlkIHx8IGl0ZW0uaWQudG9TdHJpbmcoKSA9PT0gaWQudG9TdHJpbmcoKSkpIHtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgcmV0VmFsID0gc2VsZi5nZXRUcmVlU2VsZWN0ZWRWYWx1ZShpdGVtLmRhdGFbZmllbGRdLCB2YWx1ZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgaXRlbS5kYXRhW2ZpZWxkXSA9IHJldFZhbDtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmV0VmFsO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfTtcclxuICAgICAgICByZXR1cm4gcmV0dXJuVmFsdWU7XHJcbiAgICB9O1xyXG5cclxuICAgIHZhciBnZXROb2RlRnJvbVRyZWVEYXRhQnlGaWVsZCA9IGZ1bmN0aW9uIChpdGVtcywgZmllbGQsIHZhbHVlKSB7XHJcbiAgICAgICAgaWYgKGl0ZW1zLmxlbmd0aCA9PT0gMCkgcmV0dXJuIC0xO1xyXG4gICAgICAgIHZhciB0cmVlRGF0YSA9IGdldERhdGFGcm9tVHJlZShpdGVtcyk7XHJcbiAgICAgICAgZm9yICh2YXIgaSA9IDAsIGxlbiA9IHRyZWVEYXRhLmxlbmd0aDsgaSA8IGxlbiA7IGkrKykge1xyXG4gICAgICAgICAgICB2YXIgaXRlbSA9IHRyZWVEYXRhW2ldO1xyXG4gICAgICAgICAgICBpZiAoISQuaXNFbXB0eU9iamVjdChpdGVtKSkge1xyXG4gICAgICAgICAgICAgICAgaWYgKGl0ZW1bZmllbGRdICE9PSB1bmRlZmluZWQgJiYgaXRlbVtmaWVsZF0gIT09IG51bGwgJiYgKGl0ZW1bZmllbGRdID09PSB2YWx1ZSB8fCBpdGVtW2ZpZWxkXS50b1N0cmluZygpID09PSB2YWx1ZSkpIHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gaXRlbTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gLTE7XHJcbiAgICB9O1xyXG5cclxuICAgIHZhciBpbnNlcnRDaGlsZHJlblRyZWVEYXRhID0gZnVuY3Rpb24gKGRhdGEsIGlkLCBub2RlKSB7XHJcbiAgICAgICAgdmFyIGl0ZW1zID0gZGF0YTtcclxuICAgICAgICBpZiAoaXRlbXMubGVuZ3RoID09PSAwKSByZXR1cm47XHJcbiAgICAgICAgdmFyIHRyZWVEYXRhID0gZ2V0RGF0YUZyb21UcmVlKGl0ZW1zKTtcclxuICAgICAgICBmb3IgKHZhciBpID0gMCwgbGVuID0gdHJlZURhdGEubGVuZ3RoOyBpIDwgbGVuIDsgaSsrKSB7XHJcbiAgICAgICAgICAgIHZhciBpdGVtID0gdHJlZURhdGFbaV07XHJcbiAgICAgICAgICAgIGlmICghJC5pc0VtcHR5T2JqZWN0KGl0ZW0pKSB7XHJcbiAgICAgICAgICAgICAgICAvKmlmIChpdGVtLkNvbW1vbklkICE9PSB1bmRlZmluZWQpXHJcbiAgICAgICAgICAgICAgICAgICAgaXRlbS5pZCA9IGl0ZW0uQ29tbW9uSWQ7Ki9cclxuICAgICAgICAgICAgICAgIGlmIChpdGVtLmlkICE9PSB1bmRlZmluZWQgJiYgKGl0ZW0uaWQgPT09IGlkIHx8IGl0ZW0uaWQudG9TdHJpbmcoKSA9PT0gaWQpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGl0ZW0uY2hpbGRyZW4gPT09IHVuZGVmaW5lZCB8fCBpdGVtLmNoaWxkcmVuID09PSBudWxsKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICBpdGVtLmNoaWxkcmVuID0gW107XHJcbiAgICAgICAgICAgICAgICAgICAgaXRlbS5jaGlsZHJlbi5wdXNoKG5vZGUpO1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgIH07XHJcblxyXG4gICAgdmFyIGNob29zZVRyZWUgPSBmdW5jdGlvbiAodHlwZSwgY2hlY2tlZERhdGEsIHRhcmdldFR5cGUsIHRhcmdldERhdGEsIHZtLCBjYWxsYmFjaywgaW5zTm9kZSkge1xyXG4gICAgICAgIHZhciB0cmVlID0gbmF2Y29uLnRyZWVJbnN0YW5jZSh0eXBlKTtcclxuICAgICAgICB2YXIgdGFyZ2V0VHJlZSA9IG5hdmNvbi50cmVlSW5zdGFuY2UodGFyZ2V0VHlwZSk7XHJcbiAgICAgICAgJChjaGVja2VkRGF0YSkuZWFjaChmdW5jdGlvbiAoaW5kZXgpIHtcclxuICAgICAgICAgICAgdmFyIGN1cnJOb2RlID0gdHJlZS5qc3RyZWUoKS5nZXRfbm9kZSh0aGlzKTtcclxuICAgICAgICAgICAgdmFyIGNoZWNrSW5UYXJnZXQgPSB0YXJnZXRUcmVlLmpzdHJlZSgpLmdldF9ub2RlKHRoaXMpO1xyXG4gICAgICAgICAgICBpZiAoIWNoZWNrSW5UYXJnZXQpIHtcclxuICAgICAgICAgICAgICAgIHZhciBwYXJlbnRzID0gY3Vyck5vZGUucGFyZW50cztcclxuICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSBwYXJlbnRzLmxlbmd0aCAtIDE7IGkgPj0gMCA7IGktLSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBub2RlSWQgPSBwYXJlbnRzW2ldO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChub2RlSWQgPT09IFwiI1wiKSBjb250aW51ZTtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgbmV3Tm9kZSA9IHRyZWUuanN0cmVlKCkuZ2V0X25vZGUobm9kZUlkKTtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgdGFyZ2V0UGFyZW50ID0gdGFyZ2V0VHJlZS5qc3RyZWUoKS5nZXRfbm9kZShub2RlSWQpO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmICghdGFyZ2V0UGFyZW50KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vY3JlYXRlIHBhcmVudCBub2RlXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNyZWF0ZU5ld1RyZWVOb2RlKG5ld05vZGUsIHRyZWUsIHRhcmdldFR5cGUsIHRhcmdldFRyZWUsIHRhcmdldERhdGEsIHZtLCBjYWxsYmFjaywgaW5zTm9kZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgLy9jcmVhdGUgbm9kZVxyXG4gICAgICAgICAgICAgICAgY3JlYXRlTmV3VHJlZU5vZGUoY3Vyck5vZGUsIHRyZWUsIHRhcmdldFR5cGUsIHRhcmdldFRyZWUsIHRhcmdldERhdGEsIHZtLCBjYWxsYmFjaywgaW5zTm9kZSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KVxyXG5cclxuICAgICAgICBmdW5jdGlvbiBjcmVhdGVOZXdUcmVlTm9kZShub2RlLCB0cmVlLCB0YXJnZXRUeXBlLCB0YXJnZXRUcmVlLCB0YXJnZXREYXRhLCB2bSwgY2FsbGJhY2ssIGluc05vZGUpIHtcclxuICAgICAgICAgICAgdmFyIGluc05vZGUgPSBhbmd1bGFyLmNvcHkodm0ucGFnZUNvbmZpZy50cmVlc1tpbnNOb2RlXSk7XHJcbiAgICAgICAgICAgIC8vaW5zTm9kZS5pZCA9IHBhcnNlSW50KG5vZGUuaWQpO1xyXG4gICAgICAgICAgICBpbnNOb2RlLmlkID0gbm9kZS5pZDtcclxuICAgICAgICAgICAgaW5zTm9kZS5QYXJlbnRJZCA9IG5vZGUucGFyZW50O1xyXG4gICAgICAgICAgICAvL2luc05vZGUuZGF0YS5pZCA9IHBhcnNlSW50KG5vZGUuaWQpO1xyXG4gICAgICAgICAgICBpbnNOb2RlLmRhdGEuaWQgPSBub2RlLmlkO1xyXG4gICAgICAgICAgICBpbnNOb2RlLmRhdGEuUGFyZW50SWQgPSBub2RlLnBhcmVudDtcclxuICAgICAgICAgICAgaW5zTm9kZS50ZXh0ID0gbm9kZS50ZXh0O1xyXG4gICAgICAgICAgICBpZiAodm1bY2FsbGJhY2tdICE9PSB1bmRlZmluZWQpXHJcbiAgICAgICAgICAgICAgICBpbnNOb2RlID0gdm1bY2FsbGJhY2tdKHRyZWUsIHRhcmdldFRyZWUsIHRhcmdldERhdGEsIGluc05vZGUsIG5vZGUpO1xyXG5cclxuICAgICAgICAgICAgdmFyIGlkRXhpc3RzID0gZ2V0Tm9kZUZyb21UcmVlRGF0YUJ5RmllbGQodGFyZ2V0RGF0YSwgJ2lkJywgbm9kZS5pZCk7XHJcbiAgICAgICAgICAgIGlmIChpZEV4aXN0cyA9PT0gLTEpIHtcclxuICAgICAgICAgICAgICAgIGlmIChub2RlLnBhcmVudCAhPT0gXCIjXCIpIHtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgY2hpbGRyZW5JbnMgPSBuYXZjb24uaW5zZXJ0Q2hpbGRyZW5UcmVlRGF0YSh0YXJnZXREYXRhLCBub2RlLnBhcmVudCwgaW5zTm9kZSlcclxuICAgICAgICAgICAgICAgICAgICBpZiAoIWNoaWxkcmVuSW5zKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB0YXJnZXREYXRhLnB1c2goaW5zTm9kZSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBlbHNlXHJcbiAgICAgICAgICAgICAgICAgICAgdGFyZ2V0RGF0YS5wdXNoKGluc05vZGUpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHZhciB1cGRhdGVUcmVlTm9kZSA9IGZ1bmN0aW9uICh0eXBlLCBkYXRhLCB1cGRhdGVkTm9kZSwgY2FsbGJhY2spIHtcclxuICAgICAgICB2YXIgdHJlZSA9ICQoXCJuYXZjb24tdHJlZVt0eXBlPSdcIiArIHR5cGUgKyBcIiddXCIpLmZpbmQoJy5qc3RyZWUnKS5maW5kKFwiZGl2W3JvbGU9J3RyZWUnXVwiKS5qc3RyZWUodHJ1ZSk7XHJcbiAgICAgICAgaWYgKGRhdGEubGVuZ3RoID09PSAwICYmIHVwZGF0ZWROb2RlID09PSB1bmRlZmluZWQpIHJldHVybjtcclxuXHJcbiAgICAgICAgJC5tYXAodXBkYXRlZE5vZGUsIGZ1bmN0aW9uIChpdGVtLCBpbmRleCkge1xyXG4gICAgICAgICAgICAvL2ZvciAodmFyIGsgaW4gaXRlbSkge1xyXG4gICAgICAgICAgICAvL2lmIChrID09PSBcImlkXCIgfHwgaXRlbVtrXSA9PT0gMCkgY29udGludWU7XHJcbiAgICAgICAgICAgIHVwZGF0ZVRyZWVEYXRhQnlOb2RlKGRhdGEsIGl0ZW0uaWQsIGl0ZW0pO1xyXG4gICAgICAgICAgICAvL31cclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgaWYgKGNhbGxiYWNrICE9PSB1bmRlZmluZWQpIGNhbGxiYWNrKGRhdGEpO1xyXG5cclxuICAgICAgICByZXR1cm4gZGF0YTtcclxuICAgIH07XHJcblxyXG4gICAgdmFyIHVwZGF0ZVRyZWVEYXRhQnlOb2RlID0gZnVuY3Rpb24gKGl0ZW1zLCBpZCwgdGFyZ2V0Tm9kZSwgY2FsbGJhY2spIHtcclxuICAgICAgICB2YXIgcmV0VmFsID0gMDtcclxuICAgICAgICBpZiAoaWQgIT09IHVuZGVmaW5lZCB8fCBpZCAhPT0gXCJcIilcclxuICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBpdGVtcy5sZW5ndGg7IGkrKykge1xyXG4gICAgICAgICAgICAgICAgaWYgKCEkLmlzRW1wdHlPYmplY3QoaXRlbXNbaV0pKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGl0ZW1zW2ldLmlkLnRvU3RyaW5nKCkgPT09IGlkLnRvU3RyaW5nKCkpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGl0ZW1zW2ldICE9PSB1bmRlZmluZWQgJiYgdGFyZ2V0Tm9kZSAhPT0gdW5kZWZpbmVkKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaXRlbXNbaV0gPSB0YXJnZXROb2RlO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGNhbGxiYWNrICE9PSB1bmRlZmluZWQpIGNhbGxiYWNrKHRydWUpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gMTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGl0ZW1zW2ldLmNoaWxkcmVuICE9PSB1bmRlZmluZWQgJiYgaXRlbXNbaV0uY2hpbGRyZW4gIT09IG51bGwgJiYgaXRlbXNbaV0uY2hpbGRyZW4ubGVuZ3RoID4gMCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgZm91bmQgPSB1cGRhdGVUcmVlRGF0YUJ5Tm9kZShpdGVtc1tpXS5jaGlsZHJlbiwgaWQsIHRhcmdldE5vZGUpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoZm91bmQgPT09IDEpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldFZhbCA9IDE7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiBpdGVtcztcclxuICAgIH07XHJcblxyXG4gICAgLy92YXIgcmVtb3ZlTm9kZUZyb21UcmVlID0gZnVuY3Rpb24gKHR5cGUsIGl0ZW1zKSB7XHJcbiAgICAvLyAgICBpZiAodHlwZSAhPT0gdW5kZWZpbmVkICYmIGl0ZW1zID09PSB1bmRlZmluZWQpIHtcclxuICAgIC8vICAgICAgICB2YXIgdGFyZ2V0VHJlZSA9IG5hdmNvbi50cmVlSW5zdGFuY2UodHlwZSk7XHJcbiAgICAvLyAgICAgICAgdmFyIGluc1RyZWUgPSB0YXJnZXRUcmVlLmpzdHJlZSgpO1xyXG4gICAgLy8gICAgICAgIGlmIChpbnNUcmVlICE9PSB1bmRlZmluZWQpIHtcclxuICAgIC8vICAgICAgICAgICAgaXRlbXMgPSBpbnNUcmVlLnNldHRpbmdzLmNvcmUuZGF0YTtcclxuICAgIC8vICAgICAgICB9XHJcbiAgICAvLyAgICB9XHJcblxyXG4gICAgLy8gICAgdmFyIHJldFZhbCA9IDA7XHJcbiAgICAvLyAgICBmb3IgKHZhciBpID0gMDsgaSA8IGl0ZW1zLmxlbmd0aDsgaSsrKSB7XHJcbiAgICAvLyAgICAgICAgaWYgKCEkLmlzRW1wdHlPYmplY3QoaXRlbXNbaV0pKSB7XHJcbiAgICAvLyAgICAgICAgICAgIGlmIChpdGVtc1tpXS5kYXRhICE9PSB1bmRlZmluZWQgJiYgaXRlbXNbaV0uZGF0YS5TdGF0dXMgIT09IHVuZGVmaW5lZCAmJiBpdGVtc1tpXS5kYXRhLlN0YXR1cy50b1N0cmluZygpID09PSBcIjFcIikge1xyXG4gICAgLy8gICAgICAgICAgICAgICAgcmVtb3ZlVHJlZU5vZGUodHlwZSwgaXRlbXNbaV0pO1xyXG4gICAgLy8gICAgICAgICAgICB9XHJcbiAgICAvLyAgICAgICAgICAgIGlmIChpdGVtc1tpXS5jaGlsZHJlbiAhPT0gdW5kZWZpbmVkICYmIGl0ZW1zW2ldLmNoaWxkcmVuICE9PSBudWxsICYmIGl0ZW1zW2ldLmNoaWxkcmVuLmxlbmd0aCA+IDApIHtcclxuICAgIC8vICAgICAgICAgICAgICAgIHZhciBmb3VuZCA9IHJlYXNzaWduVHJlZURhdGEodHlwZSwgaXRlbXNbaV0uY2hpbGRyZW4pO1xyXG4gICAgLy8gICAgICAgICAgICB9XHJcbiAgICAvLyAgICAgICAgfVxyXG4gICAgLy8gICAgfVxyXG4gICAgLy8gICAgcmV0dXJuIGl0ZW1zO1xyXG4gICAgLy99O1xyXG5cclxuICAgIHZhciByZW1vdmVFeGlzdHNUcmVlTm9kZSA9IGZ1bmN0aW9uIChzb3VyY2VUcmVlVHlwZSwgdGFyZ2V0VHJlZVR5cGUsIHNvdXJjZVRyZWVEYXRhLCB0YXJnZXRUcmVlRGF0YSkge1xyXG4gICAgICAgIHZhciB0YXJnZXRUcmVlID0gdHJlZUluc3RhbmNlKHRhcmdldFRyZWVUeXBlKTtcclxuICAgICAgICB2YXIgc291cmNlVHJlZSA9IHRyZWVJbnN0YW5jZShzb3VyY2VUcmVlVHlwZSk7XHJcblxyXG4gICAgICAgIHZhciB0cmVlRGF0YSA9IGdldERhdGFGcm9tVHJlZSh0YXJnZXRUcmVlRGF0YSk7XHJcbiAgICAgICAgZm9yICh2YXIgaSA9IDAsIGxlbiA9IHRyZWVEYXRhLmxlbmd0aDsgaSA8IGxlbiA7IGkrKykge1xyXG4gICAgICAgICAgICB2YXIgaXRlbSA9IHRyZWVEYXRhW2ldO1xyXG4gICAgICAgICAgICBpZiAoISQuaXNFbXB0eU9iamVjdChpdGVtKSkge1xyXG4gICAgICAgICAgICAgICAgLyppZiAoaXRlbS5Db21tb25JZCAhPT0gdW5kZWZpbmVkKVxyXG4gICAgICAgICAgICAgICAgICAgIGl0ZW0uaWQgPSBpdGVtLkNvbW1vbklkOyovXHJcbiAgICAgICAgICAgICAgICBpZiAoaXRlbS5pZCAhPT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgZGlzYWJsZVRyZWVOb2RlQnlJZChzb3VyY2VUcmVlLCBpdGVtLmlkLCBzb3VyY2VUcmVlRGF0YSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9O1xyXG5cclxuICAgIHZhciBkaXNhYmxlVHJlZU5vZGVCeUlkID0gZnVuY3Rpb24gKHNvdXJjZVRyZWUsIGlkLCBzb3VyY2VUcmVlRGF0YSkge1xyXG4gICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgc291cmNlVHJlZURhdGEubGVuZ3RoOyBpKyspIHtcclxuICAgICAgICAgICAgdmFyIGl0ZW0gPSBzb3VyY2VUcmVlRGF0YVtpXTtcclxuICAgICAgICAgICAgaWYgKGl0ZW0uaWQgIT09IHVuZGVmaW5lZCAmJiAoaXRlbS5pZCA9PT0gaWQgfHwgaXRlbS5pZC50b1N0cmluZygpID09PSBpZCkpIHtcclxuICAgICAgICAgICAgICAgIGlmIChpdGVtLnN0YXRlID09PSB1bmRlZmluZWQpIGl0ZW0uc3RhdGUgPSB7fTtcclxuICAgICAgICAgICAgICAgIGl0ZW0uc3RhdGVbXCJkaXNhYmxlZFwiXSA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICBpZiAoaXRlbS5jaGlsZHJlbiAhPT0gbnVsbCAmJiBpdGVtLmNoaWxkcmVuLmxlbmd0aCA8PSAwKVxyXG4gICAgICAgICAgICAgICAgICAgIGl0ZW0uc3RhdGVbXCJzZWxlY3RlZFwiXSA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIGlmIChpdGVtLmNoaWxkcmVuICE9PSB1bmRlZmluZWQgJiYgaXRlbS5jaGlsZHJlbiAhPT0gbnVsbCAmJiBpdGVtLmNoaWxkcmVuLmxlbmd0aCA+IDApIHtcclxuICAgICAgICAgICAgICAgICAgICBkaXNhYmxlVHJlZU5vZGVCeUlkKHNvdXJjZVRyZWUsIGlkLCBpdGVtLmNoaWxkcmVuKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH07XHJcblxyXG4gICAgdmFyIGdldERhdGFGcm9tVHJlZSA9IGZ1bmN0aW9uIChpdGVtcywgZGF0YSwgc2VxTm8pIHtcclxuICAgICAgICBpZiAoZGF0YSA9PT0gdW5kZWZpbmVkIHx8IGRhdGEgPT09IFwiXCIpXHJcbiAgICAgICAgICAgIGRhdGEgPSBbXTtcclxuICAgICAgICAkLm1hcChpdGVtcywgZnVuY3Rpb24gKGl0ZW0sIGluZGV4KSB7XHJcbiAgICAgICAgICAgIGlmICghJC5pc0VtcHR5T2JqZWN0KGl0ZW0pKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoc2VxTm8gIT09IHVuZGVmaW5lZCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGl0ZW0uZGF0YVsnU2VxTm8nXSA9IHNlcU5vO1xyXG4gICAgICAgICAgICAgICAgICAgIHNlcU5vKys7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBkYXRhLnB1c2goaXRlbSlcclxuICAgICAgICAgICAgICAgIGlmIChpdGVtLmNoaWxkcmVuICE9PSB1bmRlZmluZWQgJiYgaXRlbS5jaGlsZHJlbiAhPT0gbnVsbCAmJiBpdGVtLmNoaWxkcmVuLmxlbmd0aCA+IDApIHtcclxuICAgICAgICAgICAgICAgICAgICBnZXREYXRhRnJvbVRyZWUoaXRlbS5jaGlsZHJlbiwgZGF0YSwgMCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgcmV0dXJuIGRhdGE7XHJcbiAgICB9O1xyXG5cclxuXHJcbiAgICB2YXIgZ2V0VGV4dEZyb21UcmVlID0gZnVuY3Rpb24gKGl0ZW1zLCBkYXRhLCBwYXJlbnQpIHtcclxuICAgICAgICB2YXIgdGV4dCA9IFwiXCI7XHJcbiAgICAgICAgJC5tYXAoaXRlbXMsIGZ1bmN0aW9uIChpdGVtLCBpbmRleCkge1xyXG4gICAgICAgICAgICBpZiAoISQuaXNFbXB0eU9iamVjdChpdGVtKSkge1xyXG4gICAgICAgICAgICAgICAgdmFyIHBhcmVudElEID0gXCJcIjtcclxuICAgICAgICAgICAgICAgIGlmIChkYXRhID09PSBcIlwiKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgZGF0YSA9IGl0ZW0udGV4dDtcclxuICAgICAgICAgICAgICAgICAgICBwYXJlbnRJRCA9IFwiXCI7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHBhcmVudCA9PT0gXCIjXCIgJiYgZGF0YSAhPT0gXCJcIikge1xyXG4gICAgICAgICAgICAgICAgICAgIGRhdGEgPSBkYXRhICsgXCI7XCIgKyBpdGVtLnRleHQ7XHJcbiAgICAgICAgICAgICAgICAgICAgcGFyZW50SUQgPSBcIlwiO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICBkYXRhID0gZGF0YSArIFwiXFxcXFwiICsgaXRlbS50ZXh0O1xyXG4gICAgICAgICAgICAgICAgICAgIHBhcmVudElEID0gaXRlbS5QYXJlbnRJZDtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGlmIChpdGVtLmNoaWxkcmVuICE9PSB1bmRlZmluZWQgJiYgaXRlbS5jaGlsZHJlbiAhPT0gbnVsbCAmJiBpdGVtLmNoaWxkcmVuLmxlbmd0aCA+IDApIHtcclxuICAgICAgICAgICAgICAgICAgICBkYXRhID0gZ2V0VGV4dEZyb21UcmVlKGl0ZW0uY2hpbGRyZW4sIGRhdGEsIHBhcmVudElEKTtcclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgICAgICByZXR1cm4gZGF0YTtcclxuICAgIH07XHJcblxyXG4gICAgdmFyIHVwZGF0ZVRyZWVWYWx1ZUJ5SWQgPSBmdW5jdGlvbiAoaXRlbXMsIGlkLCB0YXJnZXRWYWx1ZSwga2V5KSB7XHJcbiAgICAgICAgdmFyIHJldFZhbCA9IDA7XHJcbiAgICAgICAgaWYgKGlkICE9PSB1bmRlZmluZWQgfHwgaWQgIT09IFwiXCIpXHJcbiAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgaXRlbXMubGVuZ3RoOyBpKyspIHtcclxuICAgICAgICAgICAgICAgIGlmICghJC5pc0VtcHR5T2JqZWN0KGl0ZW1zW2ldKSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChpdGVtc1tpXS5pZCA9PT0gaWQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGl0ZW1zW2ldLmRhdGFba2V5XSAhPT0gdW5kZWZpbmVkICYmIHRhcmdldFZhbHVlICE9PSB1bmRlZmluZWQpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpdGVtc1tpXS5kYXRhW2tleV0gPSBzZXRDZWxsQ29udHJvbFZhbHVlKGl0ZW1zW2ldLmRhdGFba2V5XSwgdGFyZ2V0VmFsdWUpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gMTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGl0ZW1zW2ldLmNoaWxkcmVuICE9PSB1bmRlZmluZWQgJiYgaXRlbXNbaV0uY2hpbGRyZW4gIT09IG51bGwgJiYgaXRlbXNbaV0uY2hpbGRyZW4ubGVuZ3RoID4gMCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgZm91bmQgPSB1cGRhdGVUcmVlVmFsdWVCeUlkKGl0ZW1zW2ldLmNoaWxkcmVuLCBpZCwgdGFyZ2V0VmFsdWUsIGtleSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChmb3VuZCA9PT0gMSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0VmFsID0gMTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIGl0ZW1zO1xyXG4gICAgfTtcclxuXHJcbiAgICB2YXIgbG9hZFRyZWVEYXRhID0gZnVuY3Rpb24gKHR5cGUsIGRhdGEsIHRhcmdldERhdGEpIHtcclxuICAgICAgICB2YXIgdHJlZSA9ICQoXCJuYXZjb24tdHJlZVt0eXBlPSdcIiArIHR5cGUgKyBcIiddXCIpLmZpbmQoJy5qc3RyZWUnKS5maW5kKFwiZGl2W3JvbGU9J3RyZWUnXVwiKS5qc3RyZWUodHJ1ZSk7XHJcbiAgICAgICAgaWYgKGRhdGEubGVuZ3RoID09PSAwKSByZXR1cm47XHJcbiAgICAgICAgJC5tYXAoSlNPTi5wYXJzZSh0YXJnZXREYXRhKSwgZnVuY3Rpb24gKGl0ZW0sIGluZGV4KSB7XHJcbiAgICAgICAgICAgIGZvciAodmFyIGsgaW4gaXRlbSkge1xyXG4gICAgICAgICAgICAgICAgaWYgKGsgPT09IFwiaWRcIiB8fCBpdGVtW2tdID09PSAwKSBjb250aW51ZTtcclxuICAgICAgICAgICAgICAgIHVwZGF0ZVRyZWVWYWx1ZUJ5SWQoZGF0YSwgaXRlbVtcImlkXCJdLCBpdGVtW2tdLCBrKTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICB9KTtcclxuICAgICAgICByZXR1cm4gZGF0YTtcclxuICAgIH07XHJcblxyXG4gICAgdmFyIHRyZWVJbnN0YW5jZSA9IGZ1bmN0aW9uICh0eXBlKSB7XHJcbiAgICAgICAgdmFyIHRyZWUgPSAkKFwibmF2Y29uLXRyZWVbdHlwZT0nXCIgKyB0eXBlICsgXCInXVwiKS5maW5kKCcuanN0cmVlJykuZmluZChcImRpdltyb2xlPSd0cmVlJ11cIik7XHJcbiAgICAgICAgcmV0dXJuIHRyZWU7XHJcbiAgICB9XHJcblxyXG4gICAgdmFyIGdldENoZWNrZWRUcmVlTm9kZXMgPSBmdW5jdGlvbiAodHlwZSkge1xyXG4gICAgICAgIHZhciB0cmVlID0gdHJlZUluc3RhbmNlKHR5cGUpO1xyXG4gICAgICAgIHZhciBkYXRhID0gdHJlZS5qc3RyZWUoJ2dldF9jaGVja2VkJyk7XHJcbiAgICAgICAgcmV0dXJuIGRhdGE7XHJcbiAgICB9XHJcblxyXG4gICAgdmFyIHNldFRyZWVHcmlkQ29sdW1uVmFsdWUgPSBmdW5jdGlvbiAoY29sdW1ucywgaXRlbSwgb2JqKSB7XHJcbiAgICAgICAgJC5tYXAoY29sdW1ucywgZnVuY3Rpb24gKHByb3AsIGtleSkge1xyXG4gICAgICAgICAgICBpZiAocHJvcFtcInZhbHVlXCJdID09PSB1bmRlZmluZWQgfHwgKHByb3BbXCJzYXZlXCJdICE9PSB1bmRlZmluZWQgJiYgcHJvcFtcInNhdmVcIl0gPT09IGZhbHNlKSkgcmV0dXJuO1xyXG4gICAgICAgICAgICB2YXIgZmllbGQgPSBcIlwiO1xyXG4gICAgICAgICAgICBpZiAoISQuaXNGdW5jdGlvbihwcm9wW1widmFsdWVcIl0pKVxyXG4gICAgICAgICAgICAgICAgZmllbGQgPSBwcm9wW1widmFsdWVcIl0uY2hhckF0KDApLnRvVXBwZXJDYXNlKCkgKyBwcm9wW1widmFsdWVcIl0uc2xpY2UoMSk7XHJcbiAgICAgICAgICAgIGVsc2VcclxuICAgICAgICAgICAgICAgIGZpZWxkID0gcHJvcFtcImZpZWxkXCJdLmNoYXJBdCgwKS50b1VwcGVyQ2FzZSgpICsgcHJvcFtcImZpZWxkXCJdLnNsaWNlKDEpO1xyXG5cclxuICAgICAgICAgICAgaWYgKGZpZWxkICE9PSB1bmRlZmluZWQgJiYgaXRlbS5kYXRhW2ZpZWxkXSAhPT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgdmFsdWUgPSBnZXRDZWxsQ29udHJvbFZhbHVlKGl0ZW0uZGF0YVtmaWVsZF0pO1xyXG4gICAgICAgICAgICAgICAgb2JqW2ZpZWxkXSA9IHZhbHVlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIHJldHVybiBvYmo7XHJcbiAgICB9O1xyXG5cclxuICAgIHZhciBnZXRUcmVlRGF0YSA9IGZ1bmN0aW9uICh0eXBlLCBmaWVsZCwgbW9kZSwgZmllbGRzKSB7XHJcbiAgICAgICAgaWYgKG1vZGUgPT09IHVuZGVmaW5lZClcclxuICAgICAgICAgICAgbW9kZSA9IFwic2F2ZVwiO1xyXG5cclxuICAgICAgICB2YXIgZGF0YUxpc3QgPSBbXTtcclxuICAgICAgICB2YXIgdHJlZURhdGE7XHJcbiAgICAgICAgdmFyIGNvbHVtbnMgPSBcIlwiO1xyXG4gICAgICAgIHZhciBzZXFEYXRhID0gW107XHJcblxyXG4gICAgICAgIGlmICh0eXBlICE9PSB1bmRlZmluZWQgJiYgdHlwZSAhPT0gbnVsbCAmJiB0eXBlICE9PSBcIlwiKSB7XHJcbiAgICAgICAgICAgIHZhciB0cmVlID0gJChcIm5hdmNvbi10cmVlW3R5cGU9J1wiICsgdHlwZSArIFwiJ11cIikuZmluZCgnLmpzdHJlZScpLmZpbmQoXCJkaXZbcm9sZT0ndHJlZSddXCIpLmpzdHJlZSh0cnVlKTtcclxuICAgICAgICAgICAgc2VxRGF0YSA9IGdldERhdGFGcm9tVHJlZSh0cmVlLmdldF9qc29uKCcjJywgeyBmbGF0OiBmYWxzZSB9KSwgJycsIDApO1xyXG4gICAgICAgICAgICB0cmVlRGF0YSA9IGdldERhdGFGcm9tVHJlZSh0cmVlLnNldHRpbmdzLmNvcmUuZGF0YSwgJycsIDApO1xyXG4gICAgICAgICAgICBjb2x1bW5zID0gdHJlZS5fZ3JpZFNldHRpbmdzLmNvbHVtbnM7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgdHJlZURhdGEgPSBnZXREYXRhRnJvbVRyZWUoZmllbGQuZGF0YSwgJycsIDApO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaWYgKGZpZWxkLm9sZERhdGEgIT09IHVuZGVmaW5lZCAmJiBmaWVsZC5vbGREYXRhICE9PSBcIlwiKSB0cmVlRGF0YSA9IGluc2VydERlbGV0ZWRpdGVtcyh0cmVlRGF0YSwgZ2V0RGF0YUZyb21UcmVlKGZpZWxkLm9sZERhdGEpLCBcImlkXCIsIFwidHJlZVwiKTtcclxuXHJcblxyXG5cclxuICAgICAgICAkLm1hcCh0cmVlRGF0YSwgZnVuY3Rpb24gKGl0ZW0sIGluZGV4KSB7XHJcbiAgICAgICAgICAgIHZhciBvYmogPSB7fTtcclxuICAgICAgICAgICAgaWYgKCEkLmlzRW1wdHlPYmplY3QoaXRlbSkpIHtcclxuICAgICAgICAgICAgICAgIGlmIChpdGVtWydDb21tb25JZCddICE9PSB1bmRlZmluZWQgJiYgaXRlbVsnQ29tbW9uSWQnXSAhPT0gJycpXHJcbiAgICAgICAgICAgICAgICAgICAgaXRlbVtmaWVsZC5pZF0gPSBpdGVtWydDb21tb25JZCddO1xyXG5cclxuICAgICAgICAgICAgICAgIGlmIChtb2RlLnRvTG93ZXJDYXNlKCkgPT09IFwidXBkYXRlXCIpIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoaXRlbVtmaWVsZC5pZF0gIT09IHVuZGVmaW5lZClcclxuICAgICAgICAgICAgICAgICAgICAgICAgb2JqW2ZpZWxkLmlkXSA9IGl0ZW1bZmllbGQuaWRdO1xyXG4gICAgICAgICAgICAgICAgICAgIGVsc2VcclxuICAgICAgICAgICAgICAgICAgICAgICAgb2JqW2ZpZWxkLmlkXSA9IDA7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGlmIChmaWVsZC5yZWZrZXkgIT09IHVuZGVmaW5lZCAmJiBpdGVtW2ZpZWxkLnJlZmtleV0gIT09IHVuZGVmaW5lZClcclxuICAgICAgICAgICAgICAgICAgICAgICAgb2JqW2ZpZWxkLnJlZmtleV0gPSBpdGVtW2ZpZWxkLnJlZmtleV07XHJcbiAgICAgICAgICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciByZWZJbmRleCA9IG5hdmNvbi5nZXRJdGVtSW5kZXhCeVByb3BlcnR5KGZpZWxkcywgZmllbGQucmVma2V5KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHJlZkluZGV4ICE9PSB1bmRlZmluZWQgJiYgcmVmSW5kZXggIT09IC0xKSBvYmpbZmllbGQucmVma2V5XSA9IGZpZWxkc1tyZWZJbmRleF0uZGF0YTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICBvYmpbZmllbGQuaWRdID0gMDtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIG9iai5pZCA9IGl0ZW0uaWQ7XHJcbiAgICAgICAgICAgICAgICBvYmoucGFyZW50SWQgPSAoKGl0ZW0ucGFyZW50IHx8IGl0ZW0uUGFyZW50SWQpID09PSBcIiNcIiA/IG51bGwgOiAoaXRlbS5wYXJlbnQgfHwgaXRlbS5QYXJlbnRJZCkpO1xyXG4gICAgICAgICAgICAgICAgb2JqLnRleHQgPSBpdGVtLnRleHQgfHwgXCJcIjtcclxuICAgICAgICAgICAgICAgIGlmIChpdGVtLmRhdGEgIT09IHVuZGVmaW5lZCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChjb2x1bW5zICE9PSB1bmRlZmluZWQgJiYgY29sdW1ucyAhPT0gXCJcIikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBvYmogPSBzZXRUcmVlR3JpZENvbHVtblZhbHVlKGNvbHVtbnMsIGl0ZW0sIG9iaik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChtb2RlLnRvTG93ZXJDYXNlKCkgPT09IFwidXBkYXRlXCIpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChmaWVsZC5yZWZrZXkgIT09IHVuZGVmaW5lZCAmJiBpdGVtW2ZpZWxkLnJlZmtleV0gIT09IHVuZGVmaW5lZClcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvYmpbZmllbGQucmVma2V5XSA9IGl0ZW1bZmllbGQucmVma2V5XTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciByZWZJbmRleCA9IG5hdmNvbi5nZXRJdGVtSW5kZXhCeVByb3BlcnR5KGZpZWxkcywgZmllbGQucmVma2V5KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAocmVmSW5kZXggIT09IHVuZGVmaW5lZCAmJiByZWZJbmRleCAhPT0gLTEpIG9ialtmaWVsZC5yZWZrZXldID0gZmllbGRzW3JlZkluZGV4XS5kYXRhO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBlbHNlIHsgLy9FdmFsdWF0aW9uIHR5cGUgZGF0YSBkZXRhaWxzIGFzc2lnblxyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgZmllbGRMaXN0ID0gW107XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICQubWFwKGl0ZW0uZGF0YSwgZnVuY3Rpb24gKGtleSwgaW5kZXgpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChpbmRleC50b0xvd2VyQ2FzZSgpICE9PSBcIiRpZFwiKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHR5cGVvZiBrZXkgPT09IFwib2JqZWN0XCIpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpZWxkTGlzdC5wdXNoKHsgXCJ0eXBlXCI6IFwidGV4dFwiLCBcImtleVwiOiBpbmRleCwgXCJkYXRhXCI6IGtleVtpbmRleF0gfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSBpZiAoaW5kZXgudG9Mb3dlckNhc2UoKSA9PT0gXCJwYXJlbnRpZFwiKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChrZXkgPT09IFwiI1wiKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZmllbGRMaXN0LnB1c2goeyBcInR5cGVcIjogXCJ0ZXh0XCIsIFwia2V5XCI6IGluZGV4LCBcImRhdGFcIjogMCB9KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZmllbGRMaXN0LnB1c2goeyBcInR5cGVcIjogXCJ0ZXh0XCIsIFwia2V5XCI6IGluZGV4LCBcImRhdGFcIjogcGFyc2VJbnQoa2V5KSB9KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmaWVsZExpc3QucHVzaCh7IFwidHlwZVwiOiBcInRleHRcIiwgXCJrZXlcIjogaW5kZXgsIFwiZGF0YVwiOiBrZXkgfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBvYmogPSBnZXRGaWVsZHNEYXRhVG9TYXZlKGZpZWxkTGlzdCwgbW9kZSwgZmllbGQuaWQpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBpZiAobW9kZS50b0xvd2VyQ2FzZSgpID09PSBcInNhdmVcIiB8fCBtb2RlLnRvTG93ZXJDYXNlKCkgPT09IFwic2F2ZWFzXCIpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgb2JqW1wiT2JqZWN0U3RhdGVcIl0gPSAoaXRlbS5kYXRhW1wiT2JqZWN0U3RhdGVcIl0gIT09IHVuZGVmaW5lZCAmJiBpdGVtLmRhdGFbXCJPYmplY3RTdGF0ZVwiXS50b1N0cmluZygpICE9PSBcIlwiICYmIGl0ZW0uZGF0YVtcIk9iamVjdFN0YXRlXCJdLnRvU3RyaW5nKCkgIT09IFwiMFwiKSA/IHBhcnNlSW50KGl0ZW0uZGF0YVtcIk9iamVjdFN0YXRlXCJdKSA6IDE7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG9ialtcIlN0YXR1c1wiXSA9IChpdGVtLmRhdGFbXCJTdGF0dXNcIl0gIT09IHVuZGVmaW5lZCAmJiBpdGVtLmRhdGFbXCJTdGF0dXNcIl0udG9TdHJpbmcoKSAhPT0gXCJcIiAmJiBpdGVtLmRhdGFbXCJTdGF0dXNcIl0udG9TdHJpbmcoKSAhPT0gXCIwXCIpID8gcGFyc2VJbnQoaXRlbS5kYXRhW1wiU3RhdHVzXCJdKSA6IDA7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoaXRlbVtmaWVsZC5pZF0gIT09IHVuZGVmaW5lZClcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9ialtcIk9iamVjdFN0YXRlXCJdID0gKGl0ZW0uZGF0YVtcIk9iamVjdFN0YXRlXCJdICE9PSB1bmRlZmluZWQgJiYgaXRlbS5kYXRhW1wiT2JqZWN0U3RhdGVcIl0udG9TdHJpbmcoKSAhPT0gXCJcIiAmJiBpdGVtLmRhdGFbXCJPYmplY3RTdGF0ZVwiXS50b1N0cmluZygpICE9PSBcIjBcIikgPyBwYXJzZUludChpdGVtLmRhdGFbXCJPYmplY3RTdGF0ZVwiXSkgOiAyO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBlbHNlXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBvYmpbXCJPYmplY3RTdGF0ZVwiXSA9IChpdGVtLmRhdGFbXCJPYmplY3RTdGF0ZVwiXSAhPT0gdW5kZWZpbmVkICYmIGl0ZW0uZGF0YVtcIk9iamVjdFN0YXRlXCJdLnRvU3RyaW5nKCkgIT09IFwiXCIgJiYgaXRlbS5kYXRhW1wiT2JqZWN0U3RhdGVcIl0udG9TdHJpbmcoKSAhPT0gXCIwXCIpID8gcGFyc2VJbnQoaXRlbS5kYXRhW1wiT2JqZWN0U3RhdGVcIl0pIDogMTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgb2JqW1wiU3RhdHVzXCJdID0gKGl0ZW0uZGF0YVtcIlN0YXR1c1wiXSAhPT0gdW5kZWZpbmVkICYmIGl0ZW0uZGF0YVtcIlN0YXR1c1wiXS50b1N0cmluZygpICE9PSBcIlwiICYmIGl0ZW0uZGF0YVtcIlN0YXR1c1wiXS50b1N0cmluZygpICE9PSBcIjBcIikgPyBwYXJzZUludChpdGVtLmRhdGFbXCJTdGF0dXNcIl0pIDogMDtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgb2JqWydTZXFObyddID0gZmluZFNlcU5vKHNlcURhdGEsIG9iai5pZCk7XHJcbiAgICAgICAgICAgICAgICAgICAgZGF0YUxpc3QucHVzaChvYmopO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgcmV0dXJuIGRhdGFMaXN0O1xyXG4gICAgfTtcclxuXHJcbiAgICB2YXIgZmluZFNlcU5vID0gZnVuY3Rpb24gKHNlcURhdGEsIGlkKSB7XHJcbiAgICAgICAgdmFyIHZhbHVlID0gJC5ncmVwKHNlcURhdGEsIGZ1bmN0aW9uIChlKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBlWydpZCddID09PSBpZC50b1N0cmluZygpO1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICBpZiAodmFsdWUubGVuZ3RoID4gMCkge1xyXG4gICAgICAgICAgICByZXR1cm4gdmFsdWVbMF0uZGF0YVsnU2VxTm8nXTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICByZXR1cm4gMDtcclxuICAgICAgICB9XHJcbiAgICB9O1xyXG5cclxuICAgIHZhciBnZXRDZWxsQ29udHJvbFZhbHVlID0gZnVuY3Rpb24gKHZhbHVlKSB7XHJcbiAgICAgICAgaWYgKHZhbHVlID09PSBudWxsIHx8IHZhbHVlLmluZGV4T2YgPT09IHVuZGVmaW5lZCkgcmV0dXJuIHZhbHVlO1xyXG4gICAgICAgIHZhciByZXRWYWwgPSB2YWx1ZTtcclxuICAgICAgICBpZiAodmFsdWUuaW5kZXhPZignPGlucHV0JykgIT09IC0xKSB7XHJcbiAgICAgICAgICAgIHZhciB2YWx1ZU9iaiA9ICQodmFsdWUpO1xyXG4gICAgICAgICAgICBpZiAodmFsdWVPYmoucHJvcChcInR5cGVcIikgPT09IFwidGV4dFwiKSB7XHJcbiAgICAgICAgICAgICAgICByZXRWYWwgPSB2YWx1ZU9iai52YWwoKTtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIGlmICgkKHZhbHVlT2JqKS5hdHRyKFwiY2hlY2tlZFwiKSAhPT0gdW5kZWZpbmVkKVxyXG4gICAgICAgICAgICAgICAgICAgIHJldFZhbCA9IDE7XHJcbiAgICAgICAgICAgICAgICBlbHNlXHJcbiAgICAgICAgICAgICAgICAgICAgcmV0VmFsID0gMDtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0gZWxzZSBpZiAodmFsdWUuaW5kZXhPZignPGEnKSAhPT0gLTEpIHtcclxuICAgICAgICAgICAgdmFyIHZhbHVlT2JqID0gJCh2YWx1ZSk7XHJcbiAgICAgICAgICAgIHJldFZhbCA9IHZhbHVlT2JqLnRleHQoKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIHJldFZhbDtcclxuICAgIH07XHJcblxyXG4gICAgdmFyIHNldENlbGxDb250cm9sVmFsdWUgPSBmdW5jdGlvbiAodmFsdWUsIHRhcmdldFZhbHVlKSB7XHJcbiAgICAgICAgdmFyIHJldFZhbCA9IHZhbHVlO1xyXG4gICAgICAgIGlmICh2YWx1ZS50b1N0cmluZygpLmluZGV4T2YoJzxpbnB1dCcpICE9PSAtMSkge1xyXG4gICAgICAgICAgICB2YXIgdmFsdWVPYmogPSAkKHZhbHVlKTtcclxuICAgICAgICAgICAgaWYgKHRhcmdldFZhbHVlID09PSAxKVxyXG4gICAgICAgICAgICAgICAgdmFsdWVPYmouYXR0cihcImNoZWNrZWRcIiwgXCJjaGVja2VkXCIpO1xyXG4gICAgICAgICAgICBlbHNlXHJcbiAgICAgICAgICAgICAgICB2YWx1ZU9iai5yZW1vdmVBdHRyKFwiY2hlY2tlZFwiKTtcclxuXHJcbiAgICAgICAgICAgIHZhciBtb2RTdHIgPSB2YWx1ZU9iai5wcm9wKCdvdXRlckhUTUwnKTtcclxuICAgICAgICAgICAgcmV0VmFsID0gbW9kU3RyLnJlcGxhY2UoL1wiL2dpLCBcIidcIik7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiByZXRWYWw7XHJcbiAgICB9O1xyXG5cclxuICAgIHZhciBzZXRWYWx1ZVRvQ29udHJvbCA9IGZ1bmN0aW9uICh2YWx1ZSwgdGFyZ2V0VmFsdWUpIHtcclxuICAgICAgICB2YXIgcmV0VmFsID0gdGFyZ2V0VmFsdWVcclxuICAgICAgICBpZiAodmFsdWUudG9TdHJpbmcoKS5pbmRleE9mKCc8aW5wdXQnKSAhPT0gLTEpIHtcclxuICAgICAgICAgICAgdmFyIHZhbHVlT2JqID0gJCh2YWx1ZSk7XHJcbiAgICAgICAgICAgIHZhbHVlT2JqLmF0dHIoXCJ2YWx1ZVwiLCB0YXJnZXRWYWx1ZSk7XHJcbiAgICAgICAgICAgIHZhciBtb2RTdHIgPSB2YWx1ZU9iai5wcm9wKCdvdXRlckhUTUwnKTtcclxuICAgICAgICAgICAgcmV0VmFsID0gbW9kU3RyLnJlcGxhY2UoL1wiL2dpLCBcIidcIik7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiByZXRWYWw7XHJcbiAgICB9O1xyXG5cclxuICAgIHZhciBnZXRJdGVtQnlQcm9wZXJ0eSA9IGZ1bmN0aW9uIChpdGVtcywga2V5KSB7XHJcbiAgICAgICAgdmFyIHZhbHVlID0gJC5ncmVwKGl0ZW1zLCBmdW5jdGlvbiAoZSkge1xyXG4gICAgICAgICAgICByZXR1cm4gZS5rZXkgPT09IGtleTtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgaWYgKHZhbHVlLmxlbmd0aCA+IDApXHJcbiAgICAgICAgICAgIHJldHVybiB2YWx1ZVswXTtcclxuICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgLy9hbGVydCgnaXRlbSBub3QgZm91bmQuLi4nKTtcclxuICAgICAgICAgICAgcmV0dXJuIC0xO1xyXG4gICAgICAgIH1cclxuICAgIH07XHJcblxyXG4gICAgdmFyIGdldEl0ZW1CeUtleVZhbHVlID0gZnVuY3Rpb24gKGl0ZW1zLCBrZXksIHZhbHVlLCBsb3dlcmNhc2UpIHtcclxuICAgICAgICBpZiAoaXRlbXMgPT09IG51bGwgfHwgaXRlbXMgPT09IHVuZGVmaW5lZCB8fCBpdGVtcy5sZW5ndGggPT09IHVuZGVmaW5lZCkgcmV0dXJuIC0xXHJcbiAgICAgICAgdmFyIHZhbHVlID0gJC5ncmVwKGl0ZW1zLCBmdW5jdGlvbiAoZSkge1xyXG4gICAgICAgICAgICBpZiAobG93ZXJjYXNlICE9PSB1bmRlZmluZWQgJiYgbG93ZXJjYXNlKVxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGVba2V5XS50b1N0cmluZygpLnRvTG93ZXJDYXNlKCkgPT09IHZhbHVlLnRvU3RyaW5nKCkudG9Mb3dlckNhc2UoKTtcclxuICAgICAgICAgICAgZWxzZVxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGVba2V5XSA9PT0gdmFsdWU7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIGlmICh2YWx1ZS5sZW5ndGggPiAwKSB7XHJcbiAgICAgICAgICAgIHJldHVybiB2YWx1ZVswXTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgIHJldHVybiAtMTtcclxuICAgICAgICB9XHJcbiAgICB9O1xyXG5cclxuICAgIHZhciBnZXRJdGVtc0ZpbHRlckJ5S2V5VmFsdWUgPSBmdW5jdGlvbiAoaXRlbXMsIGtleSwgdmFsdWUpIHtcclxuICAgICAgICB2YXIgdmFsdWUgPSAkLmdyZXAoaXRlbXMsIGZ1bmN0aW9uIChlKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBlW2tleV0gPT09IHZhbHVlO1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICBpZiAodmFsdWUubGVuZ3RoID4gMCkge1xyXG4gICAgICAgICAgICByZXR1cm4gdmFsdWU7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICByZXR1cm4gW107XHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxuXHJcblxyXG4gICAgdmFyIGdldEl0ZW1zTm90SW5PdGhlckl0ZW1zID0gZnVuY3Rpb24gKGl0ZW1zLCBub3RJbkl0ZW1zLCBpdGVtRmllbGQsIG5vdEluRmlsZWQpIHtcclxuICAgICAgICB2YXIgdmFsdWUgPSAkLmdyZXAoaXRlbXMsIGZ1bmN0aW9uIChlLCBpKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBlW2l0ZW1GaWVsZF0gIT09IHVuZGVmaW5lZCAmJiBnZXRJdGVtc0ZpbHRlckJ5S2V5VmFsdWUobm90SW5JdGVtcywgKG5vdEluRmlsZWQgfHwgaXRlbUZpZWxkKSwgZVtpdGVtRmllbGRdKS5sZW5ndGggPT09IDBcclxuICAgICAgICB9KTtcclxuICAgICAgICByZXR1cm4gdmFsdWU7XHJcbiAgICB9O1xyXG5cclxuXHJcbiAgICB2YXIgZ2V0SXRlbXNGaWx0ZXJCeU9iamVjdCA9IGZ1bmN0aW9uIChpdGVtcywgb2JqZWN0KSB7XHJcbiAgICAgICAgdmFyIHZhbHVlID0gJC5ncmVwKGl0ZW1zLCBmdW5jdGlvbiAoZSkge1xyXG4gICAgICAgICAgICB2YXIgZm91bmRDb3VudCA9IDA7XHJcbiAgICAgICAgICAgICQubWFwKE9iamVjdC5rZXlzKG9iamVjdCksIGZ1bmN0aW9uIChwcm9wLCBrZXkpIHtcclxuICAgICAgICAgICAgICAgIGlmIChlW3Byb3BdID09PSBvYmplY3RbcHJvcF0pXHJcbiAgICAgICAgICAgICAgICAgICAgZm91bmRDb3VudCsrO1xyXG5cclxuICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgcmV0dXJuIE9iamVjdC5rZXlzKG9iamVjdCkubGVuZ3RoID09PSAoZm91bmRDb3VudCk7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIGlmICh2YWx1ZS5sZW5ndGggPiAwKSB7XHJcbiAgICAgICAgICAgIHJldHVybiB2YWx1ZTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgIHJldHVybiBbXTtcclxuICAgICAgICB9XHJcbiAgICB9O1xyXG5cclxuXHJcblxyXG4gICAgdmFyIGdldEl0ZW1JbmRleEJ5S2V5VmFsdWUgPSBmdW5jdGlvbiAoaXRlbXMsIGtleSwgdmFsdWUpIHtcclxuICAgICAgICB2YXIgaW5kZXggPSAtMTtcclxuICAgICAgICB2YXIgdmFsdWUgPSAkLmdyZXAoaXRlbXMsIGZ1bmN0aW9uIChlLCBpKSB7XHJcbiAgICAgICAgICAgIGlmIChlW2tleV0gIT09IHVuZGVmaW5lZCAmJiBlW2tleV0gIT09IG51bGwgJiYgdmFsdWUgIT09IHVuZGVmaW5lZCAmJiB2YWx1ZSAhPT0gbnVsbCkge1xyXG4gICAgICAgICAgICAgICAgaWYgKGVba2V5XS50b1N0cmluZygpID09PSB2YWx1ZS50b1N0cmluZygpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaW5kZXggPSBpO1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgICAgICAgICAvKn0gZWxzZSBpZiAoZS5jaGlsZHJlbiAhPT0gdW5kZWZpbmVkICYmIGUuY2hpbGRyZW4gIT09IG51bGwpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgYXJyYXlpbmRleC5wdXNoKGkpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpbmRleCA9IGdldEl0ZW1JbmRleEJ5S2V5VmFsdWUoZS5jaGlsZHJlbiwga2V5LCB2YWx1ZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChpbmRleCAhPT0gLTEpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGluZGV4ID0gaTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSovXHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgcmV0dXJuIGluZGV4O1xyXG5cclxuICAgIH07XHJcblxyXG4gICAgdmFyIGdldEl0ZW1JbmRleEJ5UHJvcGVydHkgPSBmdW5jdGlvbiAoaXRlbXMsIGtleSkge1xyXG4gICAgICAgIGlmIChpdGVtcyA9PT0gdW5kZWZpbmVkIHx8IGl0ZW1zLmxlbmd0aCA9PT0gMCkgcmV0dXJuO1xyXG4gICAgICAgIHZhciBpbmRleCA9IC0xO1xyXG4gICAgICAgIHZhciB2YWx1ZSA9ICQuZ3JlcChpdGVtcywgZnVuY3Rpb24gKGUsIGkpIHtcclxuICAgICAgICAgICAgaWYgKGUua2V5ID09PSBrZXkpIHtcclxuICAgICAgICAgICAgICAgIGluZGV4ID0gaTtcclxuICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICBpZiAoaW5kZXggIT0gLTEpXHJcbiAgICAgICAgICAgIHJldHVybiBpbmRleDtcclxuICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgLy9hbGVydCgnaXRlbSBub3QgZm91bmQuLi4nKTtcclxuICAgICAgICAgICAgcmV0dXJuIGluZGV4O1xyXG4gICAgICAgIH1cclxuICAgIH07XHJcblxyXG4gICAgdmFyIGNsb3NlTW9kYWwgPSBmdW5jdGlvbiAoaWQpIHtcclxuICAgICAgICBuYXZjb24uc2V0Vmlld0NvbnRlbnREaXNhYmxlZChcIlwiKTtcclxuICAgICAgICB2YXIgc21QYWRkaW5nID0gJChcIi5wYWdlLXNpZGViYXItbWVudVwiKS5jc3MoXCJwYWRkaW5nXCIpO1xyXG4gICAgICAgICQoXCIucGFnZS1zaWRlYmFyLW1lbnVcIikuY3NzKFwicGFkZGluZ1wiLCBcIjBweFwiKTtcclxuICAgICAgICAkKFwiLnBhZ2Utc2lkZWJhci1tZW51XCIpLmNzcyhcInBhZGRpbmdcIiwgc21QYWRkaW5nICsgXCJweFwiKTtcclxuICAgICAgICBpZiAoaWQgIT09IHVuZGVmaW5lZCAmJiBpZCAhPT0gbnVsbCAmJiBpZCAhPT0gJycpXHJcbiAgICAgICAgICAgICQoXCJkaXZbaWQ9XCIgKyBpZCArIFwiXVwiKS5tb2RhbCgnaGlkZScpO1xyXG4gICAgfTtcclxuXHJcbiAgICB2YXIgY2xvc2VSZXBvcnQgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgJCgnLm1vZGFsJykubW9kYWwoJ2hpZGUnKTtcclxuICAgIH07XHJcblxyXG4gICAgdmFyIG9wZW5Nb2RhbCA9IGZ1bmN0aW9uIChpZCwgY2FsbGJhY2spIHtcclxuICAgICAgICAkKCcjJyArIGlkKS5tb2RhbCh7XHJcbiAgICAgICAgICAgIHNob3c6IHRydWVcclxuICAgICAgICB9KTtcclxuICAgICAgICAkKCcjJyArIGlkKS5vbignc2hvd24uYnMubW9kYWwnLCBmdW5jdGlvbiAoZSkge1xyXG4gICAgICAgICAgICBpZiAoY2FsbGJhY2sgIT09IHVuZGVmaW5lZClcclxuICAgICAgICAgICAgICAgIHJldHVybiBjYWxsYmFjayh0cnVlKTtcclxuICAgICAgICAgICAgZWxzZVxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9O1xyXG5cclxuICAgIHZhciBnZXRGaWVsZHNEYXRhID0gZnVuY3Rpb24gKGZpZWxkcykge1xyXG4gICAgICAgIHZhciBvYmogPSB7fTtcclxuICAgICAgICAkLm1hcChmaWVsZHMsIGZ1bmN0aW9uIChpdGVtLCBpbmRleCkge1xyXG4gICAgICAgICAgICBvYmpbaXRlbS5rZXldID0gaXRlbS5kYXRhO1xyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIHJldHVybiBvYmo7XHJcbiAgICB9O1xyXG5cclxuICAgIHZhciBzZXRGaWVsZEZvY3VzID0gZnVuY3Rpb24gKGZpZWxkcykge1xyXG4gICAgICAgIHZhciBpdGVtT2JqO1xyXG4gICAgICAgIHZhciAkcm9vdFNjb3BlID0gYW5ndWxhci5lbGVtZW50KGRvY3VtZW50KS5pbmplY3RvcigpLmludm9rZShmdW5jdGlvbiAoJHJvb3RTY29wZSkgeyByZXR1cm4gJHJvb3RTY29wZTsgfSk7XHJcbiAgICAgICAgdmFyICR0aW1lb3V0ID0gYW5ndWxhci5lbGVtZW50KGRvY3VtZW50KS5pbmplY3RvcigpLmludm9rZShmdW5jdGlvbiAoJHRpbWVvdXQpIHsgcmV0dXJuICR0aW1lb3V0OyB9KTtcclxuICAgICAgICB2YXIgJHNjb3BlID0gYW5ndWxhci5lbGVtZW50KGRvY3VtZW50KS5pbmplY3RvcigpLmludm9rZShmdW5jdGlvbiAoJHRpbWVvdXQpIHsgcmV0dXJuICRzY29wZTsgfSlcclxuXHJcbiAgICAgICAgJC5tYXAoZmllbGRzLCBmdW5jdGlvbiAoaXRlbSwgaW5kZXgpIHtcclxuICAgICAgICAgICAgaWYgKGl0ZW0udGVtcGxhdGVPcHRpb25zICE9PSB1bmRlZmluZWQgJiYgaXRlbS50ZW1wbGF0ZU9wdGlvbnMuZm9jdXMgIT09IHVuZGVmaW5lZCkge1xyXG4gICAgICAgICAgICAgICAgaXRlbS50ZW1wbGF0ZU9wdGlvbnMuZm9jdXMgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgJHRpbWVvdXQoZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgICAgICRyb290U2NvcGUuJGJyb2FkY2FzdCgnU0VULUZPQ1VTJywgdHJ1ZSk7XHJcbiAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICB9O1xyXG5cclxuICAgIHZhciBzYXZlVGFibGVzID0gZnVuY3Rpb24gKHZtLCBkYXRhc2VydmljZSwgdHlwZSwgZmllbGRzLCByZWZJZCwgcmVmVmFsdWUsIHBvcHVwLCBjYWxsYmFjaykge1xyXG4gICAgICAgIGZvciAoaSA9IDAsIGxlbiA9IGZpZWxkcy5sZW5ndGg7IGkgPCBsZW47IGkrKykge1xyXG4gICAgICAgICAgICBpZiAoZmllbGRzW2ldLnR5cGUgIT09IHVuZGVmaW5lZCAmJiBmaWVsZHNbaV0udHlwZSA9PT0gJ3RhYmxlJyAmJiBmaWVsZHNbaV0ubmFtZSA9PT0gdHlwZSkge1xyXG4gICAgICAgICAgICAgICAgaWYgKHJlZklkICE9PSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgcmVmSW5kZXggPSBuYXZjb24uZ2V0SXRlbUluZGV4QnlQcm9wZXJ0eSh2bVtmaWVsZHNbaV0uZmllbGRdLCByZWZJZCk7XHJcbiAgICAgICAgICAgICAgICAgICAgdm1bZmllbGRzW2ldLmZpZWxkXVtyZWZJbmRleF0uZGF0YSA9IHJlZlZhbHVlO1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIHZhciB1cGxvYWREYXRhID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICBpZiAoZmllbGRzW2ldLnVwbG9hZCAhPT0gdW5kZWZpbmVkICYmIGZpZWxkc1tpXS51cGxvYWQgIT09IG51bGwgJiYgZmllbGRzW2ldLnVwbG9hZCAhPT0gXCJcIilcclxuICAgICAgICAgICAgICAgICAgICB1cGxvYWREYXRhID0gZmllbGRzW2ldLnVwbG9hZDtcclxuXHJcbiAgICAgICAgICAgICAgICB2YXIgZGF0YSA9IG5hdmNvbi5zYXZlLnNhdmVPcHRpb24odm0sIGRhdGFzZXJ2aWNlLCB2bVtmaWVsZHNbaV0uZmllbGRdLm1vZGUsIHR5cGUsIHZtW2ZpZWxkc1tpXS50YWJsZURhdGFGaWVsZF0sIHZtW2ZpZWxkc1tpXS5maWVsZF0sIFwiMFwiLCBmaWVsZHNbaV0uaWQsIGZpZWxkc1tpXS5kaXNwbGF5ZmllbGQsIDAsIHVwbG9hZERhdGEsIHBvcHVwLCB0eXBlLCBmdW5jdGlvbiAoZGF0YSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChjYWxsYmFjayAhPT0gdW5kZWZpbmVkKSBjYWxsYmFjayhkYXRhKTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGRhdGE7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9O1xyXG5cclxuICAgIHZhciBhZGROZXdUYWJsZXMgPSBmdW5jdGlvbiAoJHNjb3BlLCB2bSwgdHlwZSwgZmllbGRzLCBwYWdlQ29uZmlnLCBjYWxsYmFjaykge1xyXG4gICAgICAgIGlmIChwYWdlQ29uZmlnID09PSB1bmRlZmluZWQgfHwgcGFnZUNvbmZpZyA9PT0gbnVsbCB8fCBwYWdlQ29uZmlnID09PSBcIlwiKVxyXG4gICAgICAgICAgICBwYWdlQ29uZmlnID0gdm0ucGFnZUNvbmZpZztcclxuXHJcbiAgICAgICAgZm9yIChpID0gMCwgbGVuID0gZmllbGRzLmxlbmd0aDsgaSA8IGxlbjsgaSsrKSB7XHJcbiAgICAgICAgICAgIGlmIChmaWVsZHNbaV0udHlwZSAhPT0gdW5kZWZpbmVkICYmIGZpZWxkc1tpXS50eXBlID09PSAndGFibGUnICYmIGZpZWxkc1tpXS5uYW1lID09PSB0eXBlKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgdGl0bGUgPSBmaWVsZHNbaV0udGl0bGU7XHJcbiAgICAgICAgICAgICAgICB2bVtmaWVsZHNbaV0uZmllbGRdW1wibW9kZVwiXSA9IFwiU2F2ZVwiO1xyXG4gICAgICAgICAgICAgICAgdmFyIHN1YkZvcm1UaXRsZSA9IG5hdmNvbi5zYXZlLmFkZE5ld09wdGlvbigkc2NvcGUsIHBhZ2VDb25maWcuZmllbGRzW2ZpZWxkc1tpXS5maWVsZF0sIHZtW2ZpZWxkc1tpXS5maWVsZF0sIHRpdGxlIHx8IFwiXCIsIFwiXCIsIGZ1bmN0aW9uIChkYXRhKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGNhbGxiYWNrICE9PSB1bmRlZmluZWQpIGNhbGxiYWNrKGRhdGEpO1xyXG4gICAgICAgICAgICAgICAgfSwgdHlwZSk7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gc3ViRm9ybVRpdGxlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxuXHJcbiAgICB2YXIgZWRpdFRhYmxlcyA9IGZ1bmN0aW9uICgkc2NvcGUsIHZtLCB0eXBlLCBmaWVsZHMsIGFjdGlvbiwgZGF0YSwgY2FsbGJhY2ssIHBvcHVwKSB7XHJcbiAgICAgICAgZm9yIChpID0gMCwgbGVuID0gZmllbGRzLmxlbmd0aDsgaSA8IGxlbjsgaSsrKSB7XHJcbiAgICAgICAgICAgIGlmIChmaWVsZHNbaV0udHlwZSAhPT0gdW5kZWZpbmVkICYmIGZpZWxkc1tpXS50eXBlID09PSAndGFibGUnICYmIGZpZWxkc1tpXS5uYW1lID09PSB0eXBlKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgdGl0bGUgPSBmaWVsZHNbaV0udGl0bGU7XHJcblxyXG4gICAgICAgICAgICAgICAgLy92bVtmaWVsZHNbaV0uZmllbGRdW1wibW9kZVwiXSA9IFwiVXBkYXRlXCI7XHJcbiAgICAgICAgICAgICAgICBpZiAoYWN0aW9uLnRvTG93ZXJDYXNlKCkgPT09IFwiZWRpdFwiKSB2bVtmaWVsZHNbaV0uZmllbGRdW1wibW9kZVwiXSA9IFwiVXBkYXRlXCI7XHJcbiAgICAgICAgICAgICAgICBpZiAoYWN0aW9uLnRvTG93ZXJDYXNlKCkgPT09IFwiZGVsZXRlXCIpIHZtW2ZpZWxkc1tpXS5maWVsZF1bXCJtb2RlXCJdID0gXCJEZWxldGVcIjtcclxuICAgICAgICAgICAgICAgIGlmIChhY3Rpb24udG9Mb3dlckNhc2UoKSA9PT0gXCJ2aWV3XCIpIHZtW2ZpZWxkc1tpXS5maWVsZF1bXCJtb2RlXCJdID0gXCJQcmludFwiO1xyXG5cclxuICAgICAgICAgICAgICAgIC8vdm0uc2VsZWN0ZWRDaGlsZFJvdyA9IG5hdmNvbi5zYXZlLnNlbGVjdGVkUm93SW5kZXgodm1bZmllbGRzW2ldLnRhYmxlRGF0YUZpZWxkXSwgZGF0YSwgZmllbGRzW2ldLmlkKTtcclxuICAgICAgICAgICAgICAgIHZtW2ZpZWxkc1tpXS5maWVsZF0uc2VsZWN0ZWRSb3cgPSBuYXZjb24uc2F2ZS5zZWxlY3RlZFJvd0luZGV4KHZtW2ZpZWxkc1tpXS50YWJsZURhdGFGaWVsZF0sIGRhdGEsIGZpZWxkc1tpXS5pZCk7XHJcbiAgICAgICAgICAgICAgICB2YXIgcHJpbWFyeUtleTtcclxuICAgICAgICAgICAgICAgIGlmIChmaWVsZHNbaV0uYWx0ZXJuYXRla2V5ICE9PSB1bmRlZmluZWQgJiYgZmllbGRzW2ldLmFsdGVybmF0ZWtleSAhPT0gXCJcIilcclxuICAgICAgICAgICAgICAgICAgICBwcmltYXJ5S2V5ID0gZmllbGRzW2ldLmFsdGVybmF0ZWtleTtcclxuICAgICAgICAgICAgICAgIGVsc2VcclxuICAgICAgICAgICAgICAgICAgICBwcmltYXJ5S2V5ID0gZmllbGRzW2ldLmlkO1xyXG5cclxuICAgICAgICAgICAgICAgIHZhciByZXR1cm5EYXRhID0gbnVsbDtcclxuICAgICAgICAgICAgICAgICRzY29wZS4kYXBwbHkoZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybkRhdGEgPSBuYXZjb24uc2F2ZS52aWV3T3B0aW9uKCRzY29wZSwgYWN0aW9uLCB0eXBlLCB2bVtmaWVsZHNbaV0udGFibGVEYXRhRmllbGRdLCB2bVtmaWVsZHNbaV0uZmllbGRdLCBkYXRhLCBwcmltYXJ5S2V5LCBmaWVsZHNbaV0uZGlzcGxheWZpZWxkLCB1bmRlZmluZWQsIGZhbHNlLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBmdW5jdGlvbiAoZGF0YSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGNhbGxiYWNrICE9PSB1bmRlZmluZWQpIGNhbGxiYWNrKGRhdGEpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9LCBcIlwiLCBwb3B1cCk7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgICAgICByZXR1cm4gcmV0dXJuRGF0YTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH07XHJcblxyXG4gICAgdmFyIHVwZGF0ZVRhYmxlRWRpdG9yRGF0YSA9IGZ1bmN0aW9uIChkYXRhLCBmaWVsZCwgJHNjb3BlLCBpc0Rpc2FibGVkLCB2bSkge1xyXG4gICAgICAgIHZhciBpdGVtTGlzdCA9IFtdO1xyXG4gICAgICAgIHZhciB2YWx1ZSA9IGFuZ3VsYXIuY29weShkYXRhKTtcclxuICAgICAgICBpZiAodmFsdWUgPT09IG51bGwgfHwgdmFsdWUgPT09IHVuZGVmaW5lZCkgcmV0dXJuIGl0ZW1MaXN0O1xyXG5cclxuICAgICAgICBmb3IgKHZhciBpID0gMCwgbGVuID0gdmFsdWUubGVuZ3RoOyBpIDwgbGVuOyBpKyspIHtcclxuICAgICAgICAgICAgdmFyIHNldHRpbmcgPSBhbmd1bGFyLmNvcHkoJHNjb3BlW2ZpZWxkLnRlbXBsYXRlT3B0aW9ucy5zZXR0aW5nc10pO1xyXG4gICAgICAgICAgICB2YXIgaXRlbSA9IHZhbHVlW2ldO1xyXG4gICAgICAgICAgICB2YXIgcmV0RGF0YSA9IHt9O1xyXG4gICAgICAgICAgICByZXREYXRhLmZpZWxkcyA9IGFuZ3VsYXIuY29weSh1cGRhdGVGaWVsZHNEYXRhKHNldHRpbmcuZmllbGRzLCBpdGVtLCAkc2NvcGUsIGlzRGlzYWJsZWQsIHZtKSk7XHJcbiAgICAgICAgICAgIHJldERhdGEuZmllbGRzLnNubyA9IChpICsgMSk7XHJcbiAgICAgICAgICAgIGl0ZW1MaXN0LnB1c2gocmV0RGF0YSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiBpdGVtTGlzdDtcclxuICAgIH07XHJcblxyXG4gICAgdmFyIHVwZGF0ZUZpZWxkc0RhdGEgPSBmdW5jdGlvbiAoZmllbGRzLCBpdGVtLCAkc2NvcGUsIGlzRGlzYWJsZWQsIHZtKSB7XHJcbiAgICAgICAgdG9vbFRpcFNldHRpbmcoKTtcclxuICAgICAgICBmb3IgKHZhciBrZXkgaW4gZmllbGRzKSB7XHJcbiAgICAgICAgICAgIHZhciBmaWVsZCA9IGZpZWxkc1trZXldO1xyXG4gICAgICAgICAgICB2YXIga2V5TmFtZSA9IGZpZWxkLmtleTtcclxuXHJcbiAgICAgICAgICAgIGlmIChpdGVtICE9PSBudWxsICYmIGl0ZW1ba2V5TmFtZV0gPT09IHVuZGVmaW5lZCkge1xyXG4gICAgICAgICAgICAgICAgaWYgKGZpZWxkLmFsdGVybmF0ZWtleSAhPT0gdW5kZWZpbmVkICYmIGZpZWxkLmFsdGVybmF0ZWtleSAhPT0gXCJcIilcclxuICAgICAgICAgICAgICAgICAgICBrZXlOYW1lID0gZmllbGQuYWx0ZXJuYXRla2V5O1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmIChrZXlOYW1lID09IFwiZnVhdHRhY2htZW50c1wiKSB7XHJcbiAgICAgICAgICAgICAgICBrZXlOYW1lID0ga2V5TmFtZTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgaWYgKGZpZWxkLnR5cGUgIT0gdW5kZWZpbmVkICYmIGZpZWxkLnR5cGUudG9Mb3dlckNhc2UoKSA9PT0gXCJsYWJlbFwiICYmIGZpZWxkLmFsdGVybmF0ZVR5cGUgIT0gdW5kZWZpbmVkICYmIGZpZWxkLmFsdGVybmF0ZVR5cGUudG9Mb3dlckNhc2UoKSA9PT0gXCJsYXN0dXBkYXRlZFwiKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoaXRlbSAhPT0gbnVsbCAmJiBpdGVtW1wiVXBkYXRlZEJ5XCJdICE9PSB1bmRlZmluZWQgJiYgaXRlbVtcIkxhc3RVcGRhdGVEYXRlXCJdICE9PSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoZmllbGRzLm1vZGUgIT09IHVuZGVmaW5lZCAmJiAoZmllbGRzLm1vZGUudG9Mb3dlckNhc2UoKSA9PT0gXCJ1cGRhdGVcIiB8fCBmaWVsZHMubW9kZS50b0xvd2VyQ2FzZSgpID09PSBcImRlbGV0ZVwiKSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBmaWVsZC5kYXRhID0gXCJNb2RpZmllZCBieSBcIiArIGl0ZW1bXCJVcGRhdGVkQnlcIl0udG9TdHJpbmcoKSArIFwiIG9uIFwiICsgbmF2Y29uLmRhdGVGcm9tVVRDVG9Mb2NhbChpdGVtW1wiTGFzdFVwZGF0ZURhdGVcIl0pLnRvU3RyaW5nKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGZpZWxkLnRlbXBsYXRlT3B0aW9ucy5sYWJlbCA9IFwiTW9kaWZpZWQgYnkgXCIgKyBpdGVtW1wiVXBkYXRlZEJ5XCJdLnRvU3RyaW5nKCkgKyBcIiBvbiBcIiArIG5hdmNvbi5kYXRlRnJvbVVUQ1RvTG9jYWwoaXRlbVtcIkxhc3RVcGRhdGVEYXRlXCJdLCBcIkREL01NL1lZWVkgaGg6bW06c3MgQVwiKS50b1N0cmluZygpO1xyXG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGZpZWxkLmRhdGEgPSBcIlwiO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBmaWVsZC50ZW1wbGF0ZU9wdGlvbnMubGFiZWwgPSBcIlwiO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgaWYgKGl0ZW0gIT09IG51bGwgJiYgaXRlbVtrZXlOYW1lXSAhPT0gdW5kZWZpbmVkKSB7IC8vZGF0YSBjb2xsZWN0ZWQgZnJvbSB0YWJsZVxyXG4gICAgICAgICAgICAgICAgaWYgKGZpZWxkLnR5cGUudG9Mb3dlckNhc2UoKSA9PT0gXCJkYXRlXCIgfHwgKGZpZWxkLmFsdGVybmF0ZVR5cGUgIT0gdW5kZWZpbmVkICYmIGZpZWxkLmFsdGVybmF0ZVR5cGUudG9Mb3dlckNhc2UoKSA9PT0gXCJkYXRlXCIpIHx8IGZpZWxkLnR5cGUudG9Mb3dlckNhc2UoKSA9PT0gXCJrZW5kb2RhdGVcIikge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChpdGVtW2tleU5hbWVdICE9PSB1bmRlZmluZWQgJiYgaXRlbVtrZXlOYW1lXSAhPT0gbnVsbCAmJiBpdGVtW2tleU5hbWVdICE9PSBcIlwiICYmIGl0ZW1ba2V5TmFtZV0gIT09IFwiMFwiKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICBmaWVsZC5kYXRhID0gbmF2Y29uLmRhdGVGcm9tVVRDVG9Mb2NhbChpdGVtW2tleU5hbWVdKTtcclxuICAgICAgICAgICAgICAgICAgICBlbHNlXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGZpZWxkLmRhdGEgPSBcIlwiO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmIChmaWVsZC50eXBlLnRvTG93ZXJDYXNlKCkgPT09IFwiZGF0ZXRpbWVcIiB8fCBmaWVsZC50eXBlLnRvTG93ZXJDYXNlKCkgPT09IFwia2VuZG9kYXRldGltZVwiKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGZpZWxkLnRlbXBsYXRlT3B0aW9ucy50aW1lb25seSAhPT0gdW5kZWZpbmVkICYmIGZpZWxkLnRlbXBsYXRlT3B0aW9ucy50aW1lb25seSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgZmllbGQuZGF0YSA9IGl0ZW1ba2V5TmFtZV07XHJcbiAgICAgICAgICAgICAgICAgICAgZWxzZVxyXG4gICAgICAgICAgICAgICAgICAgICAgICBmaWVsZC5kYXRhID0gbmF2Y29uLmRhdGVGcm9tVVRDVG9Mb2NhbChpdGVtW2tleU5hbWVdLCBcIkREL01NL1lZWVkgSEg6bW06c3NcIik7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBlbHNlIGlmIChmaWVsZC50eXBlLnRvTG93ZXJDYXNlKCkgPT09IFwic2VsZWN0XCIgfHwgZmllbGQudHlwZS50b0xvd2VyQ2FzZSgpID09PSBcImtlbmRvc2VsZWN0XCIgfHwgZmllbGQudHlwZS50b0xvd2VyQ2FzZSgpID09PSBcImtlbmRvY29tYm9ib3hcIikge1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBpdGVtTGlzdCA9IC0xO1xyXG4gICAgICAgICAgICAgICAgICAgIGZpZWxkLnNlbGVjdE9wdGlvbnMuaXRlbVtcImlzU2VsZWN0XCJdID0gZmFsc2U7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGlmICgoaXRlbVtrZXlOYW1lXSAhPT0gdW5kZWZpbmVkICYmIGl0ZW1ba2V5TmFtZV0gIT09IG51bGwpIHx8IChpdGVtW2ZpZWxkLnNlbGVjdE9wdGlvbnMuaXRlbS5yZWZGaWVsZF0gIT09IHVuZGVmaW5lZCAmJiBpdGVtW2ZpZWxkLnNlbGVjdE9wdGlvbnMuaXRlbS5yZWZGaWVsZF0gIT09IG51bGwpKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICBpdGVtTGlzdCA9IGdldEl0ZW1CeUtleVZhbHVlKGZpZWxkLnNlbGVjdE9wdGlvbnMuaXRlbXMsIChmaWVsZC5zZWxlY3RPcHRpb25zLml0ZW0uZGF0YUZpZWxkIHx8IFwiaWRcIiksIGl0ZW1bZmllbGQuc2VsZWN0T3B0aW9ucy5pdGVtLnJlZkZpZWxkIHx8IGtleU5hbWVdKVxyXG4gICAgICAgICAgICAgICAgICAgIGlmIChpdGVtTGlzdCA9PT0gLTEpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGZpZWxkLmRhdGEgPSBcIlwiO1xyXG4gICAgICAgICAgICAgICAgICAgIGVsc2VcclxuICAgICAgICAgICAgICAgICAgICAgICAgZmllbGQuZGF0YSA9IGl0ZW1MaXN0O1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmIChmaWVsZC50eXBlLnRvTG93ZXJDYXNlKCkgPT09IFwiY2hlY2tib3hsaXN0XCIgfHwgZmllbGQudHlwZS50b0xvd2VyQ2FzZSgpID09PSBcImdyb3VwY2hlY2tib3hsaXN0XCIpIHtcclxuICAgICAgICAgICAgICAgICAgICAvL2ZpZWxkLnNlbGVjdE9wdGlvbnMuaXRlbVtcImlzU2VsZWN0XCJdID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICAgICAgZmllbGQuZGF0YSA9IGxvYWRDaGVja0JveExpc3QoaXRlbVtrZXlOYW1lXSwgZmllbGQsIGZpZWxkcyk7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGZpZWxkLnR5cGUudG9Mb3dlckNhc2UoKSA9PT0gXCJtdWx0aXNlbGVjdFwiIHx8IGZpZWxkLnR5cGUudG9Mb3dlckNhc2UoKSA9PT0gXCJtdWx0aXNlbGVjdGNoZWNrYm94XCIgfHwgZmllbGQudHlwZS50b0xvd2VyQ2FzZSgpID09PSBcImtlbmRvbXVsdGlzZWxlY3RcIikge1xyXG4gICAgICAgICAgICAgICAgICAgIGZpZWxkLnNlbGVjdE9wdGlvbnMuaXRlbVtcImlzU2VsZWN0XCJdID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICAgICAgZmllbGQuZGF0YSA9IGxvYWRNdWx0aVNlbGVjdChpdGVtW2tleU5hbWVdLCBmaWVsZCk7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGZpZWxkLnR5cGUudG9Mb3dlckNhc2UoKSA9PT0gXCJmaWxldXBsb2FkXCIpIHtcclxuICAgICAgICAgICAgICAgICAgICBmaWVsZC5kYXRhID0gaXRlbVtrZXlOYW1lXTtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoaXNEaXNhYmxlZCAhPT0gdW5kZWZpbmVkKSBmaWVsZC5pc2NoYW5nZWFibGUgPSAhaXNEaXNhYmxlZDtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoZmllbGQucmVhZG9ubHkgIT09IHVuZGVmaW5lZCAmJiBmaWVsZC5yZWFkb25seSkgZmllbGQuaXNjaGFuZ2VhYmxlID0gIWZpZWxkLnJlYWRvbmx5O1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmIChmaWVsZC50eXBlLnRvTG93ZXJDYXNlKCkgPT09IFwidGFibGVlZGl0b3JcIikge1xyXG4gICAgICAgICAgICAgICAgICAgIGZpZWxkLmRhdGEgPSB1cGRhdGVUYWJsZUVkaXRvckRhdGEoaXRlbVtrZXlOYW1lXSwgZmllbGQsICRzY29wZSwgaXNEaXNhYmxlZCwgdm0pO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmIChmaWVsZC50eXBlLnRvTG93ZXJDYXNlKCkgPT09IFwidGFibGVcIikge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmICgkc2NvcGUgIT09IHVuZGVmaW5lZCAmJiAkc2NvcGVbZmllbGQudGFibGVEYXRhRmllbGRdICE9PSB1bmRlZmluZWQpICRzY29wZVtmaWVsZC50YWJsZURhdGFGaWVsZF0uZGF0YSA9IFtdO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmICgkc2NvcGUgIT09IHVuZGVmaW5lZCAmJiAkc2NvcGUubmF2Y29uRGF0YSAhPT0gdW5kZWZpbmVkICYmICRzY29wZS5uYXZjb25EYXRhW2ZpZWxkLnRhYmxlRGF0YUZpZWxkXSAhPT0gdW5kZWZpbmVkKSAkc2NvcGUubmF2Y29uRGF0YVtmaWVsZC50YWJsZURhdGFGaWVsZF0uZGF0YSA9IFtdO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmICh2bSAhPT0gdW5kZWZpbmVkICYmIHZtW2ZpZWxkLnRhYmxlRGF0YUZpZWxkXSAhPT0gdW5kZWZpbmVkKSB2bVtmaWVsZC50YWJsZURhdGFGaWVsZF0uZGF0YSA9IFtdO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmICh2bSAhPT0gdW5kZWZpbmVkICYmIHZtW2ZpZWxkLnRhYmxlRGF0YUZpZWxkXSA9PT0gdW5kZWZpbmVkICYmIHZtW2ZpZWxkLmZpZWxkXSAhPT0gdW5kZWZpbmVkKSBuYXZjb24uY2xlYXJGaWVsZHNEYXRhKHZtW2ZpZWxkLmZpZWxkXSwgJHNjb3BlLCBmYWxzZSk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGlmIChpdGVtW2tleU5hbWVdICE9PSB1bmRlZmluZWQgJiYgaXRlbVtrZXlOYW1lXSAhPT0gbnVsbCAmJiAkc2NvcGVbZmllbGQudGFibGVEYXRhRmllbGRdICE9PSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgJHNjb3BlW2ZpZWxkLnRhYmxlRGF0YUZpZWxkXS5kYXRhID0gaXRlbVtrZXlOYW1lXTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgJHNjb3BlW2ZpZWxkLnRhYmxlRGF0YUZpZWxkXS5vbGREYXRhID0gYW5ndWxhci5jb3B5KGl0ZW1ba2V5TmFtZV0pO1xyXG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoaXRlbVtrZXlOYW1lXSAhPT0gdW5kZWZpbmVkICYmIGl0ZW1ba2V5TmFtZV0gIT09IG51bGwgJiYgJHNjb3BlICE9PSB1bmRlZmluZWQgJiYgJHNjb3BlLm5hdmNvbkRhdGEgIT09IHVuZGVmaW5lZCAmJiAkc2NvcGUubmF2Y29uRGF0YVtmaWVsZC50YWJsZURhdGFGaWVsZF0gIT09IHVuZGVmaW5lZCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAkc2NvcGUubmF2Y29uRGF0YVtmaWVsZC50YWJsZURhdGFGaWVsZF0uZGF0YSA9IGl0ZW1ba2V5TmFtZV07XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICRzY29wZS5uYXZjb25EYXRhW2ZpZWxkLnRhYmxlRGF0YUZpZWxkXS5vbGREYXRhID0gYW5ndWxhci5jb3B5KGl0ZW1ba2V5TmFtZV0pO1xyXG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoaXRlbVtrZXlOYW1lXSAhPT0gdW5kZWZpbmVkICYmIGl0ZW1ba2V5TmFtZV0gIT09IG51bGwgJiYgdm0gIT09IHVuZGVmaW5lZCAmJiB2bVtmaWVsZC50YWJsZURhdGFGaWVsZF0gIT09IHVuZGVmaW5lZCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2bVtmaWVsZC50YWJsZURhdGFGaWVsZF0uZGF0YSA9IGl0ZW1ba2V5TmFtZV07XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZtW2ZpZWxkLnRhYmxlRGF0YUZpZWxkXS5vbGREYXRhID0gYW5ndWxhci5jb3B5KGl0ZW1ba2V5TmFtZV0pO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGZpZWxkLmNoaWxkcmVuRmllbGQgIT09IHVuZGVmaW5lZCAmJiBmaWVsZC5jaGlsZHJlbkZpZWxkICYmIGl0ZW1ba2V5TmFtZV1bMF0gIT09IHVuZGVmaW5lZCAmJiBpdGVtW2tleU5hbWVdWzBdICE9PSBudWxsKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdXBkYXRlRmllbGRzRGF0YSh2bVtmaWVsZC5maWVsZF0sIGl0ZW1ba2V5TmFtZV1bMF0sICRzY29wZSwgaXNEaXNhYmxlZCwgdm0pO1xyXG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAodm0gIT09IHVuZGVmaW5lZCAmJiB2bVtmaWVsZC5maWVsZF0gIT09IHVuZGVmaW5lZCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAvL30gZWxzZSBpZiAoaXRlbVtrZXlOYW1lXSAhPT0gdW5kZWZpbmVkICYmIGl0ZW1ba2V5TmFtZV0gIT09IG51bGwgJiYgdm0gIT09IHVuZGVmaW5lZCAmJiB2bVtmaWVsZC5maWVsZF0gIT09IHVuZGVmaW5lZCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAodHlwZW9mIGl0ZW1ba2V5TmFtZV0gPT09IFwib2JqZWN0XCIpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB1cGRhdGVGaWVsZHNEYXRhKHZtW2ZpZWxkLmZpZWxkXSwgaXRlbVtrZXlOYW1lXSwgJHNjb3BlLCBpc0Rpc2FibGVkLCB2bSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2VcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVwZGF0ZUZpZWxkc0RhdGEodm1bZmllbGQuZmllbGRdLCBpdGVtW2tleU5hbWVdWzBdLCAkc2NvcGUsIGlzRGlzYWJsZWQsIHZtKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGZpZWxkLmRhdGEgPSBpdGVtW2tleU5hbWVdO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmIChmaWVsZC50eXBlLnRvTG93ZXJDYXNlKCkgPT09IFwidHJlZVwiIHx8IGZpZWxkLnR5cGUudG9Mb3dlckNhc2UoKSA9PT0gXCJldmFsdWF0aW9uXCIpIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAodm0gPT09IHVuZGVmaW5lZCkgdm0gPSAkc2NvcGU7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGl0ZW1ba2V5TmFtZV0gIT09IHVuZGVmaW5lZCAmJiBpdGVtW2tleU5hbWVdICE9PSBudWxsICYmIHZtW2ZpZWxkLnRyZWVEYXRhRmllbGRdKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZtW2ZpZWxkLnRyZWVEYXRhRmllbGRdLmNvcmUuZGF0YSA9IFtdO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2bVtmaWVsZC50cmVlRGF0YUZpZWxkXS5jb3JlLmRhdGEgPSBpdGVtW2tleU5hbWVdO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoZmllbGQubmFtZSAhPT0gdW5kZWZpbmVkICYmIGZpZWxkLm5hbWUgIT09IFwiXCIpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2bVtmaWVsZC50cmVlRGF0YUZpZWxkXS5jb3JlLnRyZWVUeXBlID0gZmllbGQubmFtZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdm1bZmllbGQudHJlZURhdGFGaWVsZF0uY29yZS5vbGREYXRhID0gYW5ndWxhci5jb3B5KGl0ZW1ba2V5TmFtZV0pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBmaWVsZC5kYXRhID0gaXRlbVtrZXlOYW1lXTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBlbHNlIGlmIChmaWVsZC50eXBlLnRvTG93ZXJDYXNlKCkgPT09IFwicmF0aW5nXCIpIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoaXRlbVtrZXlOYW1lXSA9PT0gbnVsbClcclxuICAgICAgICAgICAgICAgICAgICAgICAgZmllbGQuZGF0YSA9IDA7XHJcbiAgICAgICAgICAgICAgICAgICAgZWxzZVxyXG4gICAgICAgICAgICAgICAgICAgICAgICBmaWVsZC5kYXRhID0gaXRlbVtrZXlOYW1lXTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChpdGVtW2tleU5hbWVdICE9IG51bGwgJiYgaXRlbVtrZXlOYW1lXSAhPT0gdW5kZWZpbmVkKSBmaWVsZC5kYXRhID0gaXRlbVtrZXlOYW1lXSA9PSBudWxsID8gXCJcIiA6IGl0ZW1ba2V5TmFtZV07XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgaWYgKGlzRGlzYWJsZWQgIT09IHVuZGVmaW5lZCkgZmllbGQuZGlzYWJsZWQgPSBpc0Rpc2FibGVkO1xyXG4gICAgICAgICAgICAgICAgaWYgKGZpZWxkLnJlYWRvbmx5ICE9PSB1bmRlZmluZWQgJiYgZmllbGQucmVhZG9ubHkpIGZpZWxkLmRpc2FibGVkID0gZmllbGQucmVhZG9ubHk7XHJcbiAgICAgICAgICAgIH0gZWxzZSBpZiAoaXRlbSAhPT0gbnVsbCAmJiBpdGVtW2tleV0gIT09IHVuZGVmaW5lZCkgey8vZGF0YSBjb2xsZWN0ZWQgZnJvbSBjb21tb24gZmllbGRzXHJcbiAgICAgICAgICAgICAgICBpZiAoaXRlbVtrZXldLmRhdGEgIT09IHVuZGVmaW5lZCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChpdGVtW2tleV0gIT0gbnVsbCAmJiBpdGVtW2tleV0gIT09IHVuZGVmaW5lZCkgZmllbGQuZGF0YSA9IGl0ZW1ba2V5XS5kYXRhO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICBpZiAoZmllbGQudHlwZS50b0xvd2VyQ2FzZSgpID09PSBcImZpbGV1cGxvYWRcIikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoaXNEaXNhYmxlZCAhPT0gdW5kZWZpbmVkKSBmaWVsZC5pc2NoYW5nZWFibGUgPSAhaXNEaXNhYmxlZDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGZpZWxkLnJlYWRvbmx5ICE9PSB1bmRlZmluZWQgJiYgZmllbGQucmVhZG9ubHkpIGZpZWxkLmlzY2hhbmdlYWJsZSA9ICFmaWVsZC5yZWFkb25seTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGlmIChpc0Rpc2FibGVkICE9PSB1bmRlZmluZWQpIGZpZWxkLmRpc2FibGVkID0gaXNEaXNhYmxlZDtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoZmllbGQucmVhZG9ubHkgIT09IHVuZGVmaW5lZCAmJiBmaWVsZC5yZWFkb25seSkgZmllbGQuZGlzYWJsZWQgPSBmaWVsZC5yZWFkb25seTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIGlmIChpdGVtICE9PSBudWxsICYmIGl0ZW0uZGF0YSAhPT0gdW5kZWZpbmVkKSB7Ly9kYXRhIGNvbGxlY3RlZCBmcm9tIHRyZWUgLyBzdWJjaGlsZFxyXG4gICAgICAgICAgICAgICAgICAgIGlmIChpdGVtLmRhdGFba2V5TmFtZV0gIT09IHVuZGVmaW5lZCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAkc2NvcGUuJGFwcGx5KGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpZWxkLmRhdGEgPSBpdGVtLmRhdGFba2V5TmFtZV07XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGlzRGlzYWJsZWQgIT09IHVuZGVmaW5lZCkgZmllbGQuZGlzYWJsZWQgPSBpc0Rpc2FibGVkO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGZpZWxkLnJlYWRvbmx5ICE9PSB1bmRlZmluZWQgJiYgZmllbGQucmVhZG9ubHkpIGZpZWxkLmRpc2FibGVkID0gZmllbGQucmVhZG9ubHk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgaWYgKGlzRGlzYWJsZWQgIT09IHVuZGVmaW5lZCkgZmllbGQuZGlzYWJsZWQgPSBpc0Rpc2FibGVkO1xyXG4gICAgICAgICAgICBpZiAoZmllbGQucmVhZG9ubHkgIT09IHVuZGVmaW5lZCAmJiBmaWVsZC5yZWFkb25seSkgZmllbGQuZGlzYWJsZWQgPSBmaWVsZC5yZWFkb25seTtcclxuXHJcbiAgICAgICAgICAgIGZpZWxkLm9sZERhdGEgPSBhbmd1bGFyLmNvcHkoZmllbGQuZGF0YSk7XHJcblxyXG4gICAgICAgICAgICBpZiAoZmllbGQucmVhZE9ubHlUZXh0ICE9IHVuZGVmaW5lZCkge1xyXG4gICAgICAgICAgICAgICAgZmllbGQucmVhZE9ubHlUZXh0ID0gZGlzcGxheXJlYWRvbmx5RmllbGQoZmllbGQpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGVsc2UgaWYgKGZpZWxkLnR5cGUgIT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoZmllbGQudHlwZSAhPSB1bmRlZmluZWQgJiYgZmllbGQudHlwZS50b0xvd2VyQ2FzZSgpID09PSBcInJhZGlvXCIpIHtcclxuICAgICAgICAgICAgICAgICAgICAkLmVhY2goZmllbGQudGVtcGxhdGVPcHRpb25zLml0ZW1zLCBmdW5jdGlvbiAoa2V5LCBpdGVtKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChpdGVtLnZhbHVlID09IGZpZWxkLmRhdGEpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpZWxkLnJlYWRPbmx5VGV4dCA9IGl0ZW0ubGFiZWw7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9KVxyXG5cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciByZXN1bHQgPSBkaXNwbGF5RmllbGQoZmllbGQpO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChyZXN1bHQub2xkRGF0YSAhPSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgZmllbGQucmVhZE9ubHlUZXh0ID0gcmVzdWx0LmRhdGE7XHJcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgZmllbGQucmVhZE9ubHlUZXh0ID0gcmVzdWx0O1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiBmaWVsZHM7XHJcbiAgICB9O1xyXG5cclxuICAgIGZ1bmN0aW9uIGRpc3BsYXlyZWFkb25seUZpZWxkKGl0ZW0pIHtcclxuICAgICAgICB2YXIgcmV0dXJuVmFsdWUgPSBpdGVtLmRhdGE7XHJcbiAgICAgICAgaWYgKGl0ZW0udHlwZSA9PT0gXCJzZWxlY3RcIiB8fCBpdGVtLnR5cGUgPT09IFwia2VuZG9zZWxlY3RcIiB8fCBpdGVtLnR5cGUgPT09IFwia2VuZG9jb21ib2JveFwiKSB7XHJcbiAgICAgICAgICAgIHJldHVyblZhbHVlID0gaXRlbS5kYXRhW2l0ZW0uc2VsZWN0T3B0aW9ucy5pdGVtLmRpc3BsYXlGaWVsZF07XHJcbiAgICAgICAgfSBlbHNlIGlmIChpdGVtLnR5cGUgPT09IFwibXVsdGlzZWxlY3RcIiB8fCBpdGVtLnR5cGUgPT09IFwibXVsdGlzZWxlY3RjaGVja2JveFwiIHx8IGl0ZW0udHlwZS50b0xvd2VyQ2FzZSgpID09PSBcImtlbmRvbXVsdGlzZWxlY3RcIikge1xyXG4gICAgICAgICAgICB2YXIgbGlzdCA9IFtdO1xyXG4gICAgICAgICAgICBpZiAoaXRlbS5kYXRhID09IHVuZGVmaW5lZCB8fCBpdGVtLmRhdGEgPT0gXCJcIiB8fCBpdGVtLmRhdGEgPT0gbnVsbCkge1xyXG4gICAgICAgICAgICAgICAgaXRlbS5kYXRhID0gW107XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZm9yICh2YXIgaSA9IDAsIGxlbiA9IGl0ZW0uZGF0YS5sZW5ndGg7IGkgPCBsZW47IGkrKykge1xyXG4gICAgICAgICAgICAgICAgdmFyIG9iaiA9IGl0ZW0uZGF0YVtpXTtcclxuICAgICAgICAgICAgICAgIGxpc3QucHVzaChvYmpbaXRlbS5zZWxlY3RPcHRpb25zLml0ZW0uZGlzcGxheUZpZWxkXSlcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICByZXR1cm5WYWx1ZSA9IGxpc3Quam9pbihcIjsgXCIpO1xyXG4gICAgICAgIH0gZWxzZSBpZiAoaXRlbS50eXBlID09PSBcImNoZWNrYm94XCIpIHtcclxuICAgICAgICAgICAgaWYgKGl0ZW0uZGF0YSB8fCBpdGVtLmRhdGEgPT09IDEgfHwgaXRlbS5kYXRhID09PSBcInRydWVcIilcclxuICAgICAgICAgICAgICAgIHJldHVyblZhbHVlID0gaXRlbS50ZW1wbGF0ZU9wdGlvbnMuc3VmZml4TGFiZWw7XHJcbiAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgaWYgKGl0ZW0udGVtcGxhdGVPcHRpb25zLnN1ZmZpeExhYmVsZmFsc2UgIT09IHVuZGVmaW5lZClcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm5WYWx1ZSA9IGl0ZW0udGVtcGxhdGVPcHRpb25zLnN1ZmZpeExhYmVsZmFsc2U7XHJcbiAgICAgICAgICAgICAgICBlbHNlXHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuVmFsdWUgPSBcIk5vXCI7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9IGVsc2UgaWYgKGl0ZW0udHlwZSA9PT0gXCJyYWRpb1wiKSB7XHJcbiAgICAgICAgICAgIHZhciBpdGVtcyA9IGl0ZW0udGVtcGxhdGVPcHRpb25zLml0ZW1zO1xyXG4gICAgICAgICAgICB2YXIgZmluZE9iaiA9IG5hdmNvbi5nZXRJdGVtQnlLZXlWYWx1ZShpdGVtcywgXCJ2YWx1ZVwiLCBpdGVtLmRhdGEpO1xyXG4gICAgICAgICAgICBpZiAoZmluZE9iaiAhPT0gLTEpIHtcclxuICAgICAgICAgICAgICAgIGlmIChpdGVtLnRlbXBsYXRlT3B0aW9ucy5zdWZmaXhMYWJlbGZhbHNlICE9PSB1bmRlZmluZWQpXHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuVmFsdWUgPSBmaW5kT2JqLnN1ZmZpeExhYmVsO1xyXG4gICAgICAgICAgICAgICAgZWxzZVxyXG4gICAgICAgICAgICAgICAgICAgIHJldHVyblZhbHVlID0gZmluZE9iai5sYWJlbDtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIGlmIChpdGVtLnRlbXBsYXRlT3B0aW9ucy5zdWZmaXhMYWJlbGZhbHNlICE9PSB1bmRlZmluZWQpXHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuVmFsdWUgPSBpdGVtc1swXS5zdWZmaXhMYWJlbDtcclxuICAgICAgICAgICAgICAgIGVsc2VcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm5WYWx1ZSA9IGl0ZW0uZGF0YTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgcmV0dXJuVmFsdWUgPSBpdGVtLmRhdGE7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmIChyZXR1cm5WYWx1ZSAhPSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgICAgcmV0dXJuVmFsdWUuZGF0YSA9IHJldHVyblZhbHVlLmRhdGEgIT0gdW5kZWZpbmVkID8gcmV0dXJuVmFsdWUuZGF0YSA6IFwiXCJcclxuICAgICAgICAgICAgcmV0dXJuVmFsdWUub2xkRGF0YSA9IHJldHVyblZhbHVlLm9sZERhdGEgIT0gdW5kZWZpbmVkID8gcmV0dXJuVmFsdWUub2xkRGF0YSA6IFwiXCJcclxuICAgICAgICAgICAgaWYgKHJldHVyblZhbHVlLmRhdGEgPT0gXCJcIiAmJiByZXR1cm5WYWx1ZS5vbGREYXRhID09IFwiXCIpIHtcclxuICAgICAgICAgICAgICAgIHJldHVyblZhbHVlID0gXCJcIjtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gcmV0dXJuVmFsdWUgIT0gdW5kZWZpbmVkID8gcmV0dXJuVmFsdWUgOiBcIlwiO1xyXG4gICAgfTtcclxuXHJcbiAgICB2YXIgbG9hZE11bHRpU2VsZWN0ID0gZnVuY3Rpb24gKGl0ZW1zLCBmaWVsZCkge1xyXG4gICAgICAgIGlmIChpdGVtcyA9PT0gdW5kZWZpbmVkIHx8IGl0ZW1zID09PSBudWxsIHx8IGl0ZW1zID09PSBcIlwiKVxyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgdmFyIGxpc3QgPSBbXTtcclxuICAgICAgICAkLm1hcChpdGVtcywgZnVuY3Rpb24gKGl0ZW0sIGtleSkge1xyXG4gICAgICAgICAgICB2YXIgb2JqVmFsdWUgPSBnZXRJdGVtQnlLZXlWYWx1ZShmaWVsZC5zZWxlY3RPcHRpb25zLml0ZW1zLCAoZmllbGQuc2VsZWN0T3B0aW9ucy5pdGVtLmRhdGFGaWVsZCB8fCBcImlkXCIpLCBpdGVtWyhmaWVsZC5zZWxlY3RPcHRpb25zLml0ZW0uZGF0YUZpZWxkIHx8IFwiaWRcIildKTtcclxuICAgICAgICAgICAgaWYgKG9ialZhbHVlID09PSAtMSkge1xyXG4gICAgICAgICAgICAgICAgbGlzdC5wdXNoKGl0ZW0pO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgaWYgKGZpZWxkW1wiYWx0a2V5XCJdICE9PSB1bmRlZmluZWQpXHJcbiAgICAgICAgICAgICAgICAgICAgb2JqVmFsdWVbZmllbGRbXCJhbHRrZXlcIl1dID0gaXRlbVtmaWVsZFtcImFsdGtleVwiXV07XHJcblxyXG4gICAgICAgICAgICAgICAgaWYgKGZpZWxkW1wicmVma2V5XCJdICE9PSB1bmRlZmluZWQpXHJcbiAgICAgICAgICAgICAgICAgICAgb2JqVmFsdWVbZmllbGRbXCJyZWZrZXlcIl1dID0gaXRlbVtmaWVsZFtcInJlZmtleVwiXV07XHJcbiAgICAgICAgICAgICAgICBsaXN0LnB1c2gob2JqVmFsdWUpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgcmV0dXJuIGxpc3Q7XHJcbiAgICB9XHJcblxyXG4gICAgdmFyIGxvYWRDaGVja0JveExpc3QgPSBmdW5jdGlvbiAoaXRlbXMsIGZpZWxkLCBmaWVsZHMpIHtcclxuICAgICAgICBpZiAoaXRlbXMgPT09IHVuZGVmaW5lZCB8fCBpdGVtcyA9PT0gbnVsbCB8fCBpdGVtcyA9PT0gXCJcIikgcmV0dXJuO1xyXG4gICAgICAgIHZhciBsaXN0ID0gW107XHJcbiAgICAgICAgdmFyIGZpZWxkRGF0YSA9IGZpZWxkLmRhdGE7XHJcbiAgICAgICAgdmFyIHJlZklkID0gXCJcIjtcclxuICAgICAgICBpZiAoZmllbGQubGlzdERpc3BsYXkgIT09IHVuZGVmaW5lZCAmJiBmaWVsZC5saXN0RGlzcGxheSkge1xyXG4gICAgICAgICAgICAkLm1hcChmaWVsZHMsIGZ1bmN0aW9uIChmaWVsZEl0ZW0sIGluZGV4KSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoKGZpZWxkSXRlbS50eXBlID09PSBcImNoZWNrYm94bGlzdFwiIHx8IGZpZWxkSXRlbS50eXBlID09PSBcImdyb3VwY2hlY2tib3hsaXN0XCIpICYmIGZpZWxkSXRlbS5saXN0RGlzcGxheSAhPT0gdW5kZWZpbmVkICYmIGZpZWxkSXRlbS5saXN0RGlzcGxheSAmJiBmaWVsZEl0ZW0uZ3JvdXAgIT09IHVuZGVmaW5lZCkge1xyXG4gICAgICAgICAgICAgICAgICAgICQubWFwKGZpZWxkSXRlbS5kYXRhLCBmdW5jdGlvbiAoZGF0YUl0ZW0sIGRhdGFJbmRleCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgZXZlbnRJbmRleCA9IGdldEl0ZW1JbmRleEJ5S2V5VmFsdWUoaXRlbXMsIChmaWVsZC50ZW1wbGF0ZU9wdGlvbnMuaXRlbS5kYXRhRmllbGQgfHwgXCJFdmVudElEXCIpLCBkYXRhSXRlbVsoZmllbGQudGVtcGxhdGVPcHRpb25zLml0ZW0uZGF0YUZpZWxkIHx8IFwiRXZlbnRJRFwiKV0pXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChldmVudEluZGV4ICE9PSAtMSAmJiBmaWVsZEl0ZW0uZ3JvdXAuaW5kZXhPZihkYXRhSXRlbS5FdmVudFNlY3Rpb24pICE9PSAtMSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZGF0YUl0ZW0udmFsdWUgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgJC5tYXAoaXRlbXMsIGZ1bmN0aW9uIChpdGVtLCBrZXkpIHtcclxuICAgICAgICAgICAgICAgIHZhciBncm91cE9iamVjdCA9IGdldEl0ZW1CeUtleVZhbHVlKGZpZWxkRGF0YSwgKGZpZWxkLnRlbXBsYXRlT3B0aW9ucy5pdGVtLmRhdGFGaWVsZCB8fCBcIlBhcmVudElEXCIpLCBpdGVtWyhmaWVsZC50ZW1wbGF0ZU9wdGlvbnMuaXRlbS5ncm91cEZpZWxkIHx8IFwiUGFyZW50SURcIildKTtcclxuICAgICAgICAgICAgICAgIGlmIChncm91cE9iamVjdCAhPT0gdW5kZWZpbmVkICYmIGdyb3VwT2JqZWN0ICE9PSAtMSkge1xyXG5cclxuICAgICAgICAgICAgICAgICAgICB2YXIgZXZlbnRJbmRleCA9IGdldEl0ZW1JbmRleEJ5S2V5VmFsdWUoZ3JvdXBPYmplY3QuZGF0YSwgKGZpZWxkLnRlbXBsYXRlT3B0aW9ucy5pdGVtLmRhdGFGaWVsZCB8fCBcIkV2ZW50SURcIiksIGl0ZW1bKGZpZWxkLnRlbXBsYXRlT3B0aW9ucy5pdGVtLmRhdGFGaWVsZCB8fCBcIkV2ZW50SURcIildKTtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoZXZlbnRJbmRleCAhPT0gdW5kZWZpbmVkICYmIGV2ZW50SW5kZXggIT09IC0xKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBFdmVudE5hbWUgPSBncm91cE9iamVjdC5kYXRhW2V2ZW50SW5kZXhdLkV2ZW50TmFtZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgZ3JvdXBPYmplY3QuZGF0YVtldmVudEluZGV4XSA9IGl0ZW07XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGdyb3VwT2JqZWN0LmRhdGFbZXZlbnRJbmRleF0uRXZlbnROYW1lID0gRXZlbnROYW1lO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBncm91cE9iamVjdC5kYXRhW2V2ZW50SW5kZXhdLnZhbHVlID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gZmllbGREYXRhO1xyXG4gICAgfVxyXG5cclxuICAgIHZhciBpbnNlcnREZWxldGVkaXRlbXMgPSBmdW5jdGlvbiAobmV3SXRlbXMsIG9sZEl0ZW1zLCB0YWJsZUtleSwgY29udHJvbFR5cGUpIHtcclxuICAgICAgICBpZiAob2xkSXRlbXMgPT09IHVuZGVmaW5lZCkgcmV0dXJuIG5ld0l0ZW1zO1xyXG4gICAgICAgIGlmIChjb250cm9sVHlwZSAhPT0gXCJ0YWJsZUVkaXRvclwiKSB7XHJcbiAgICAgICAgICAgICQubWFwKG9sZEl0ZW1zLCBmdW5jdGlvbiAoaXRlbSwga2V5KSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoaXRlbVsnQ29tbW9uSWQnXSAhPT0gdW5kZWZpbmVkICYmIGl0ZW1bJ0NvbW1vbklkJ10gIT09ICcnKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaXRlbVt0YWJsZUtleV0gPSBpdGVtWydDb21tb25JZCddO1xyXG4gICAgICAgICAgICAgICAgICAgIHRhYmxlS2V5ID0gJ0NvbW1vbklkJztcclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICB2YXIgdmFsdWUgPSBnZXRJdGVtQnlLZXlWYWx1ZShuZXdJdGVtcywgdGFibGVLZXksIGl0ZW1bdGFibGVLZXldKTtcclxuICAgICAgICAgICAgICAgIGlmICh2YWx1ZSA9PT0gLTEpIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoY29udHJvbFR5cGUgIT09IHVuZGVmaW5lZCAmJiBjb250cm9sVHlwZSAhPT0gXCJcIiAmJiBjb250cm9sVHlwZS50b1N0cmluZygpLnRvTG93ZXJDYXNlKCkgPT09IFwidHJlZVwiKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGl0ZW0uZGF0YVtcIk9iamVjdFN0YXRlXCJdID0gMjtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaXRlbS5kYXRhW1wiU3RhdHVzXCJdID0gMTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGl0ZW1bXCJPYmplY3RTdGF0ZVwiXSA9IDI7XHJcbiAgICAgICAgICAgICAgICAgICAgaXRlbVtcIlN0YXR1c1wiXSA9IDE7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGNvbnRyb2xUeXBlICE9PSB1bmRlZmluZWQgJiYgY29udHJvbFR5cGUgIT09IFwiXCIgJiYgY29udHJvbFR5cGUudG9TdHJpbmcoKS50b0xvd2VyQ2FzZSgpID09PSBcInRhYmxlXCIpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaXRlbVtcIk9iamVjdFN0YXRlXCJdID0gMjtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaXRlbVtcIlN0YXR1c1wiXSA9IDE7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIG5ld0l0ZW1zLnB1c2goaXRlbSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2UgaWYgKGNvbnRyb2xUeXBlID09PSBcInRhYmxlRWRpdG9yXCIpIHtcclxuICAgICAgICAgICAgdmFyIG9sZGl0ZW1MaXN0ID0gW107XHJcbiAgICAgICAgICAgIHZhciBvbGRQcmltYXJ5S2V5ID0gW107XHJcbiAgICAgICAgICAgIHZhciBuZXdQcmltYXJ5S2V5ID0gW107XHJcbiAgICAgICAgICAgIGZvciAodmFyIGkgPSAwLCBsZW4gPSBvbGRJdGVtcy5sZW5ndGg7IGkgPCBsZW47IGkrKykge1xyXG4gICAgICAgICAgICAgICAgdmFyIGl0ZW0gPSBvbGRJdGVtc1tpXTtcclxuICAgICAgICAgICAgICAgIHZhciByZXRTYXRhID0gZ2V0RmllbGRzRGF0YVRvU2F2ZShpdGVtLmZpZWxkcywgJ1VwZGF0ZScsIHRhYmxlS2V5KTtcclxuXHJcbiAgICAgICAgICAgICAgICBvbGRpdGVtTGlzdC5wdXNoKHJldFNhdGEpO1xyXG4gICAgICAgICAgICAgICAgb2xkUHJpbWFyeUtleS5wdXNoKHJldFNhdGFbdGFibGVLZXldKTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgZm9yICh2YXIgaiA9IDA7IGogPCBuZXdJdGVtcy5sZW5ndGg7IGorKykge1xyXG4gICAgICAgICAgICAgICAgdmFyIGl0ZW0gPSBuZXdJdGVtc1tqXTtcclxuICAgICAgICAgICAgICAgIG5ld1ByaW1hcnlLZXkucHVzaChpdGVtW3RhYmxlS2V5XSlcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgZm9yICh2YXIgaiA9IDA7IGogPCBvbGRQcmltYXJ5S2V5Lmxlbmd0aDsgaisrKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAobmV3UHJpbWFyeUtleS5pbmRleE9mKG9sZFByaW1hcnlLZXlbal0pID09PSAtMSkge1xyXG4gICAgICAgICAgICAgICAgICAgIG9sZGl0ZW1MaXN0W2pdLk9iamVjdFN0YXRlID0gMjtcclxuICAgICAgICAgICAgICAgICAgICBvbGRpdGVtTGlzdFtqXS5TdGF0dXMgPSAxO1xyXG4gICAgICAgICAgICAgICAgICAgIG5ld0l0ZW1zLnB1c2gob2xkaXRlbUxpc3Rbal0pXHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiBuZXdJdGVtcztcclxuICAgIH07XHJcblxyXG4gICAgdmFyIGdldEZpZWxkc0NvbHVtbiA9IGZ1bmN0aW9uIChjb2x1bW5zKSB7XHJcbiAgICAgICAgdmFyIG9iaiA9IHt9O1xyXG4gICAgICAgIGlmIChjb2x1bW5zLmxlbmd0aCA+IDApIHtcclxuICAgICAgICAgICAgJC5tYXAoY29sdW1ucywgZnVuY3Rpb24gKGl0ZW0sIGtleSkge1xyXG4gICAgICAgICAgICAgICAgaWYgKGl0ZW0uZGF0YSAhPT0gbnVsbCkge1xyXG4gICAgICAgICAgICAgICAgICAgIG9ialtpdGVtLmRhdGFdID0gXCJcIjtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiBvYmo7XHJcbiAgICB9O1xyXG5cclxuICAgIHZhciBjbGVhcktleVZha3VlcyA9IGZ1bmN0aW9uIChvYmplY3QpIHtcclxuICAgICAgICBmb3IgKGtleSBpbiBvYmplY3QpIHtcclxuICAgICAgICAgICAgb2JqZWN0W2tleV0gPSBcIlwiO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gb2JqZWN0O1xyXG4gICAgfTtcclxuXHJcbiAgICB2YXIgYWRkRGF0YUxpc3QgPSBmdW5jdGlvbiAodm0sIGZpZWxkcywgdGFibGVPcHRpb25zLCB1bmlxdWVLZXkpIHtcclxuICAgICAgICB2YXIgaXRlbSA9IG5hdmNvbi5nZXRGaWVsZHNEYXRhKGZpZWxkcyk7XHJcbiAgICAgICAgdmFyIGl0ZW1zID0gdGFibGVPcHRpb25zO1xyXG4gICAgICAgIHZhciB0YWJsZURhdGEgPSB7fTtcclxuICAgICAgICBpZiAoaXRlbXMuZGF0YS5sZW5ndGggPiAwKSB7XHJcbiAgICAgICAgICAgIHZhciBpbmRleCA9IGdldEl0ZW1JbmRleEJ5S2V5VmFsdWUoaXRlbXMuZGF0YSwgdW5pcXVlS2V5LCBpdGVtW3VuaXF1ZUtleV0pO1xyXG4gICAgICAgICAgICBpZiAoaW5kZXggIT09IC0xKSB7XHJcbiAgICAgICAgICAgICAgICB0YWJsZURhdGEgPSBpdGVtcy5kYXRhW2luZGV4XTtcclxuICAgICAgICAgICAgICAgIGl0ZW1zLmRhdGEuc3BsaWNlKGluZGV4LCAxKTtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIHRhYmxlRGF0YSA9IGdldEZpZWxkc0NvbHVtbihpdGVtcy5jb2x1bW5zKTtcclxuICAgICAgICAgICAgICAgICQuZXh0ZW5kKHRhYmxlRGF0YSwgaXRlbSk7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICQubWFwKE9iamVjdC5rZXlzKGl0ZW0pLCBmdW5jdGlvbiAocHJvcCwga2V5KSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoaXRlbVtwcm9wXSAhPT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIGZpZWxkID0gZmllbGRzW2tleV07XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGZpZWxkLnR5cGUudG9VcHBlckNhc2UoKSA9PT0gXCJTRUxFQ1RcIilcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGFibGVEYXRhW3Byb3BdID0gdGFibGVEYXRhW3Byb3BdLmlkIHx8IHRhYmxlRGF0YVtwcm9wXS5JZCB8fCB0YWJsZURhdGFbcHJvcF0uY29kZSB8fCB0YWJsZURhdGFbcHJvcF0uQ29kZTtcclxuICAgICAgICAgICAgICAgICAgICBlbHNlIGlmIChmaWVsZC50eXBlLnRvVXBwZXJDYXNlKCkgPT09IFwiREFURVwiKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChpdGVtW3Byb3BdICE9PSB1bmRlZmluZWQgJiYgaXRlbVtwcm9wXSAhPT0gbnVsbCAmJiBpdGVtW3Byb3BdICE9PSBcIlwiICYmIGl0ZW1bcHJvcF0gIT09IFwiMFwiKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGFibGVEYXRhW3Byb3BdID0gbmF2Y29uLmRhdGVUb1VUQyhpdGVtW3Byb3BdKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgZWxzZVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGFibGVEYXRhW3Byb3BdID0gXCJcIjtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgZWxzZVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB0YWJsZURhdGFbcHJvcF0gPSBpdGVtW3Byb3BdO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICB0YWJsZURhdGEgPSBnZXRGaWVsZHNDb2x1bW4oaXRlbXMuY29sdW1ucyk7XHJcbiAgICAgICAgICAgICQuZXh0ZW5kKHRhYmxlRGF0YSwgaXRlbSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGl0ZW1zLmRhdGEucHVzaCh0YWJsZURhdGEpO1xyXG4gICAgICAgIHJldHVybiB0YWJsZURhdGE7XHJcbiAgICB9O1xyXG5cclxuICAgIHZhciBnZXRUYWJsZUVkaXRvckRhdGEgPSBmdW5jdGlvbiAoZGF0YSwgbW9kZSwgZmllbGRJdGVtLCBwcmltYXJ5S2V5LCBmaWVsZHMpIHtcclxuICAgICAgICB2YXIgaXRlbUxpc3QgPSBbXTtcclxuICAgICAgICB2YXIgaW5kZXggPSBuYXZjb24uZ2V0SXRlbUluZGV4QnlQcm9wZXJ0eShmaWVsZHMsIHByaW1hcnlLZXkpO1xyXG4gICAgICAgIHZhciBwcmltYXJ5S2V5VmFsdWUgPSBmaWVsZHNbaW5kZXhdLmRhdGE7XHJcbiAgICAgICAgZm9yICh2YXIgaSA9IDAsIGxlbiA9IGRhdGEubGVuZ3RoOyBpIDwgbGVuOyBpKyspIHtcclxuICAgICAgICAgICAgdmFyIGl0ZW0gPSBkYXRhW2ldO1xyXG4gICAgICAgICAgICB2YXIgcmV0U2F0YSA9IGdldEZpZWxkc0RhdGFUb1NhdmUoaXRlbS5maWVsZHMsIG1vZGUsIHByaW1hcnlLZXkpO1xyXG4gICAgICAgICAgICBpZiAobW9kZSAhPT0gdW5kZWZpbmVkICYmIG1vZGUudG9Mb3dlckNhc2UoKSA9PT0gXCJ1cGRhdGVcIikge1xyXG4gICAgICAgICAgICAgICAgLy8gZmllbGRJdGVtLnRlbXBsYXRlT3B0aW9ucy5rZXkgPSBcIkNhdXNlQWN0aXZlRmFpbHVyZUlkXCI7XHJcbiAgICAgICAgICAgICAgICBpZiAoZmllbGRJdGVtLnRlbXBsYXRlT3B0aW9ucy5rZXkgIT09IHVuZGVmaW5lZCAmJiBmaWVsZEl0ZW0udGVtcGxhdGVPcHRpb25zLmtleSAhPT0gXCJcIikge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChyZXRTYXRhW2ZpZWxkSXRlbS50ZW1wbGF0ZU9wdGlvbnMua2V5XSAhPT0gdW5kZWZpbmVkICYmIChyZXRTYXRhW2ZpZWxkSXRlbS50ZW1wbGF0ZU9wdGlvbnMua2V5XSA9PT0gMCB8fCByZXRTYXRhW2ZpZWxkSXRlbS50ZW1wbGF0ZU9wdGlvbnMua2V5XSA9PT0gXCIwXCIpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldFNhdGEuT2JqZWN0U3RhdGUgPSAxO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAocmV0U2F0YVtwcmltYXJ5S2V5XSAhPT0gdW5kZWZpbmVkKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0U2F0YVtwcmltYXJ5S2V5XSA9IHByaW1hcnlLZXlWYWx1ZTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaXRlbUxpc3QucHVzaChyZXRTYXRhKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgLy9yZXR1cm4gaXRlbUxpc3Q7XHJcbiAgICAgICAgaWYgKG1vZGUudG9Mb3dlckNhc2UoKSA9PT0gXCJzYXZlXCIpXHJcbiAgICAgICAgICAgIHJldHVybiBpdGVtTGlzdDtcclxuICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgcmV0dXJuIGluc2VydERlbGV0ZWRpdGVtcyhpdGVtTGlzdCwgZmllbGRJdGVtLm9sZERhdGEsIChmaWVsZEl0ZW0udGVtcGxhdGVPcHRpb25zLmtleSB8fCAnaWQnKSwgXCJ0YWJsZUVkaXRvclwiKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgfVxyXG5cclxuICAgIHZhciBpc1NhdmUgPSBmdW5jdGlvbiAoZmllbGRzLCBlZGl0b3JzYXZlKSB7XHJcbiAgICAgICAgdmFyIHNhdmUgPSBmYWxzZVxyXG4gICAgICAgIGlmIChlZGl0b3JzYXZlICE9PSB1bmRlZmluZWQgJiYgZWRpdG9yc2F2ZSAhPT0gXCJcIilcclxuICAgICAgICAgICAgc2F2ZSA9IGVkaXRvcnNhdmU7XHJcbiAgICAgICAgJC5tYXAoZmllbGRzLCBmdW5jdGlvbiAoaXRlbSwgaW5kZXgpIHtcclxuICAgICAgICAgICAgaWYgKGl0ZW0ua2V5LnRvTG93ZXJDYXNlKCkgIT09IFwib2JqZWN0c3RhdGVcIiB8fCBpdGVtLmtleS50b0xvd2VyQ2FzZSgpICE9PSBcInN0YXR1c1wiKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoaXRlbS50eXBlID09PSBcInRhYmxlZWRpdG9yXCIpIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoKGl0ZW0uZGF0YSAhPT0gdW5kZWZpbmVkKSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBpID0gMCwgbGVuID0gaXRlbS5kYXRhLmxlbmd0aDsgaSA8IGxlbjsgaSsrKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgZGF0YSA9IGl0ZW0uZGF0YVtpXTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChkYXRhLmZpZWxkcyAhPT0gdW5kZWZpbmVkKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNhdmUgPSBpc1NhdmUoZGF0YS5maWVsZHMsIHNhdmUpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHNhdmUpIHJldHVybiBzYXZlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoaXRlbS5vbGREYXRhICE9PSB1bmRlZmluZWQgJiYgSlNPTi5zdHJpbmdpZnkoYW5ndWxhci5jb3B5KGl0ZW0ub2xkRGF0YSkpICE9PSBKU09OLnN0cmluZ2lmeShhbmd1bGFyLmNvcHkoaXRlbS5kYXRhKSkpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgc2F2ZSA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBzYXZlO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZiAoc2F2ZSkgcmV0dXJuIHNhdmU7XHJcbiAgICAgICAgfSlcclxuICAgICAgICByZXR1cm4gc2F2ZTtcclxuICAgIH07XHJcblxyXG4gICAgdmFyIGNvbXBhcmVkYXRhID0gZnVuY3Rpb24gKGZpZWxkcywgcGFnZW5hbWUsIHNlY3Rpb24sIHBrbmFtZSwgcGtpZCwgaWRlbnRpZmllciwgcHVzaGVkRGF0YSkge1xyXG4gICAgICAgIHZhciBjaGFuZ2VkSXRlbXM7XHJcbiAgICAgICAgaWYgKHB1c2hlZERhdGEgIT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgICAgIGNoYW5nZWRJdGVtcyA9IHB1c2hlZERhdGE7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgY2hhbmdlZEl0ZW1zID0gW107XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHZhciAkcm9vdFNjb3BlID0gYW5ndWxhci5lbGVtZW50KGRvY3VtZW50KS5pbmplY3RvcigpLmludm9rZShmdW5jdGlvbiAoJHJvb3RTY29wZSkgeyByZXR1cm4gJHJvb3RTY29wZTsgfSk7XHJcbiAgICAgICAgdmFyIHBhZ2VuYW1lID0gJHJvb3RTY29wZS5jb25maWdIZWFkZXJNZW51ID09ICdib3d0aWVhbmFseXNpcycgPyAncmlza2FnZ3JlZ2F0aW9uJyA6ICRyb290U2NvcGUuY29uZmlnSGVhZGVyTWVudTtcclxuICAgICAgICB2YXIgQmF0Y2hkYXRlID0gbmV3IERhdGUoKTtcclxuICAgICAgICB2YXIga2V5d29yZCA9IGlkZW50aWZpZXIgfHwgXCJcIjtcclxuICAgICAgICAvLyBCYXRjaGRhdGUgPSBCYXRjaGRhdGUuZ2V0VGltZSgpO1xyXG4gICAgICAgICQubWFwKGZpZWxkcywgZnVuY3Rpb24gKGl0ZW0sIGluZGV4KSB7XHJcbiAgICAgICAgICAgIGlmIChpdGVtLmtleS50b0xvd2VyQ2FzZSgpICE9PSBcIkNvbXBpbGVkQnlJZE5hbWVcIiAmJiBpdGVtLmtleS50b0xvd2VyQ2FzZSgpICE9PSBcIm9iamVjdHN0YXRlXCIgJiYgaXRlbS5rZXkudG9Mb3dlckNhc2UoKSAhPT0gXCJzdGF0dXNcIiAmJiAhKGl0ZW0ua2V5LnRvTG93ZXJDYXNlKCkuaW5kZXhPZihcIml0YXJ3YXJuaW5nXCIpICE9IC0xKSkge1xyXG4gICAgICAgICAgICAgICAgaWYgKGl0ZW0udHlwZSA9PT0gXCJ0YWJsZWVkaXRvclwiKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKChpdGVtLmRhdGEgIT09IHVuZGVmaW5lZCkpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDAsIGxlbiA9IGl0ZW0uZGF0YS5sZW5ndGg7IGkgPCBsZW47IGkrKykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGRhdGEgPSBpdGVtLmRhdGFbaV07XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoZGF0YS5maWVsZHMgIT09IHVuZGVmaW5lZCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBrZXkgPSBpdGVtLmtleTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgZ3JvdXBuYW1lID0gaXRlbS50ZW1wbGF0ZU9wdGlvbnMubGFiZWwgIT0gdW5kZWZpbmVkID8gaXRlbS50ZW1wbGF0ZU9wdGlvbnMubGFiZWwgOiBcIlwiO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciB0ZW1wID0gW107XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJC5lYWNoKGRhdGEuZmllbGRzLCBmdW5jdGlvbiAoaW5kZXgsIHZhbHVlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh2YWx1ZS5rZXkudG9Mb3dlckNhc2UoKSAhPT0gXCJvYmplY3RzdGF0ZVwiICYmIHZhbHVlLmtleS50b0xvd2VyQ2FzZSgpICE9PSBcInN0YXR1c1wiKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZS50YWJsZUVkaXRvciA9IGtleTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh2YWx1ZS5vbGREYXRhID09IHVuZGVmaW5lZCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlLm9sZERhdGEgPSBcIlwiO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHZhbHVlLm9sZERhdGEgIT09IHVuZGVmaW5lZCAmJiB2YWx1ZS5kYXRhICE9PSB1bmRlZmluZWQgJiYgSlNPTi5zdHJpbmdpZnkoYW5ndWxhci5jb3B5KHZhbHVlLm9sZERhdGEpKSAhPT0gSlNPTi5zdHJpbmdpZnkoYW5ndWxhci5jb3B5KHZhbHVlLmRhdGEpKSAmJiB2YWx1ZS5uYW1lICE9IHVuZGVmaW5lZCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciByZXR1cm5EYXRhID0gZGlzcGxheUZpZWxkKHZhbHVlKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vdGVtcC5wdXNoKHsgbmFtZTogdmFsdWUubmFtZSwgb2xkRGF0YTogcmV0dXJuRGF0YS5vbGREYXRhLCBkYXRhOiByZXR1cm5EYXRhLmRhdGEgfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHJldHVybkRhdGEuZGF0YSA9PSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuRGF0YS5kYXRhID0gXCJcIjtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHJldHVybkRhdGEub2xkRGF0YSA9PSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuRGF0YS5vbGREYXRhID0gXCJcIjtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHJldHVybkRhdGEuZGF0YSAhPSByZXR1cm5EYXRhLm9sZERhdGEpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNoYW5nZWRJdGVtcy5wdXNoKHsgSGlzdG9yeUlkOiAwLCBGaWVsZDogdmFsdWUubmFtZS5yZXBsYWNlKCc6JywgJycpLCBvbGREYXRhOiByZXR1cm5EYXRhLm9sZERhdGEsIE5ld0RhdGE6IHJldHVybkRhdGEuZGF0YSwgcm93OiBpICsgMSwgU3ViU2VjdGlvbjogZ3JvdXBuYW1lLCBQYWdlOiBwYWdlbmFtZSwgT2JqZWN0U3RhdGU6IDAsIFNlY3Rpb246IHNlY3Rpb24sIFBLTmFtZTogcGtuYW1lLCBQS0lkOiBwa2lkLCBCYXRjaDogQmF0Y2hkYXRlLCBrZXl3b3JkOiBrZXl3b3JkIH0pXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBpZiAoaXRlbS5kYXRhLmxlbmd0aCA8IGl0ZW0ub2xkRGF0YS5sZW5ndGgpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIG9sZFByaW1hcmtleXMgPSBbXTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGN1clByaW1hcmtleXMgPSBbXTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGl0ZW0ub2xkRGF0YSAhPSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSAwLCBsZW4gPSBpdGVtLm9sZERhdGEubGVuZ3RoOyBpIDwgbGVuOyBpKyspIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgZGF0YSA9IGl0ZW0ub2xkRGF0YVtpXTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkLmVhY2goZGF0YS5maWVsZHMsIGZ1bmN0aW9uIChpbmRleCwgdmFsdWUpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHZhbHVlLmtleSA9PT0gaXRlbS50ZW1wbGF0ZU9wdGlvbnMua2V5KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvbGRQcmltYXJrZXlzLnB1c2godmFsdWUuZGF0YSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSAwLCBsZW4gPSBpdGVtLmRhdGEubGVuZ3RoOyBpIDwgbGVuOyBpKyspIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBjdXJkYXRhID0gaXRlbS5kYXRhW2ldO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJC5lYWNoKGN1cmRhdGEuZmllbGRzLCBmdW5jdGlvbiAoaW5kZXgsIHZhbHVlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHZhbHVlLmtleSA9PT0gaXRlbS50ZW1wbGF0ZU9wdGlvbnMua2V5KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGN1clByaW1hcmtleXMucHVzaCh2YWx1ZS5kYXRhKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBqID0gMDsgaiA8IG9sZFByaW1hcmtleXMubGVuZ3RoOyBqKyspIHtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBsb29rIGZvciBzYW1lIHRoaW5nIGluIG5ldyBhcnJheVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGN1clByaW1hcmtleXMuaW5kZXhPZihvbGRQcmltYXJrZXlzW2pdKSA9PSAtMSlcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDAsIGxlbiA9IGl0ZW0ub2xkRGF0YS5sZW5ndGg7IGkgPCBsZW47IGkrKykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgZGF0YSA9IGl0ZW0ub2xkRGF0YVtpXTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJC5lYWNoKGRhdGEuZmllbGRzLCBmdW5jdGlvbiAoaW5kZXgsIHZhbHVlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodmFsdWUuZGF0YSA9PT0gb2xkUHJpbWFya2V5c1tqXSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICQuZWFjaChkYXRhLmZpZWxkcywgZnVuY3Rpb24gKGksIHZhbHVlRGF0YSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodmFsdWVEYXRhLm5hbWUgIT09IHVuZGVmaW5lZCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHJldHVybkRhdGEgPSBkaXNwbGF5RmllbGQodmFsdWVEYXRhKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNoYW5nZWRJdGVtcy5wdXNoKHsgSGlzdG9yeUlkOiAwLCBGaWVsZDogdmFsdWVEYXRhLm5hbWUsIG9sZERhdGE6IHJldHVybkRhdGEub2xkRGF0YSwgTmV3RGF0YTogJ0RlbGV0ZWQnLCByb3c6IGogKyAxLCBTdWJTZWN0aW9uOiBncm91cG5hbWUsIFBhZ2U6IHBhZ2VuYW1lLCBPYmplY3RTdGF0ZTogMCwgU2VjdGlvbjogc2VjdGlvbiwgUEtOYW1lOiBwa25hbWUsIFBLSWQ6IHBraWQsIEJhdGNoOiBCYXRjaGRhdGUsIGtleXdvcmQ6IGtleXdvcmQgfSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIGVsc2UgaWYgKGl0ZW0udHlwZSA9PT0gXCJ0YWJsZVwiKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGl0ZW0ub2xkRGF0YSA9PSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaXRlbS5vbGREYXRhID0gXCJcIjtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGlmICgoaXRlbS5kYXRhICE9PSB1bmRlZmluZWQpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBncm91cG5hbWUgPSBpdGVtLmxhYmVsICE9IHVuZGVmaW5lZCA/IGl0ZW0ubGFiZWwgOiBcIlwiO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgb2xkUHJpbWFya2V5cyA9IFtdO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgY3VyUHJpbWFya2V5cyA9IFtdO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBpID0gMCwgbGVuID0gaXRlbS5vbGREYXRhLmxlbmd0aDsgaSA8IGxlbjsgaSsrKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgZGF0YSA9IGl0ZW0ub2xkRGF0YVtpXTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9sZFByaW1hcmtleXMucHVzaChkYXRhW2l0ZW0ucHJpbWFyeUtleV0pO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBpID0gMCwgbGVuID0gaXRlbS5kYXRhLmxlbmd0aDsgaSA8IGxlbjsgaSsrKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgY3VyZGF0YSA9IGl0ZW0uZGF0YVtpXTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGN1clByaW1hcmtleXMucHVzaChjdXJkYXRhW2l0ZW0ucHJpbWFyeUtleV0pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBJbnNlcnRGaWVsZHMgPSBpdGVtLkluc2VydEZpZWxkcztcclxuICAgICAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgaiA9IDA7IGogPCBvbGRQcmltYXJrZXlzLmxlbmd0aDsgaisrKSB7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gbG9vayBmb3Igc2FtZSB0aGluZyBpbiBuZXcgYXJyYXlcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChjdXJQcmltYXJrZXlzLmluZGV4T2Yob2xkUHJpbWFya2V5c1tqXSkgPT0gLTEpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgZGF0YSA9IGl0ZW0ub2xkRGF0YVtqXTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKG9sZFByaW1hcmtleXNbal0gPT0gZGF0YVtpdGVtLnByaW1hcnlLZXldKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICQuZWFjaChJbnNlcnRGaWVsZHMsIGZ1bmN0aW9uIChrZXksIGl0ZW1WYWx1ZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIG9sZERhdGEgPSBkYXRhW2l0ZW1WYWx1ZS5maWVsZF07XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjaGFuZ2VkSXRlbXMucHVzaCh7IEhpc3RvcnlJZDogMCwgRmllbGQ6IGl0ZW1WYWx1ZS5sYWJlbCwgb2xkRGF0YTogb2xkRGF0YSwgTmV3RGF0YTogXCJEZWxldGVkXCIsIHJvdzogaiArIDEsIFN1YlNlY3Rpb246IGdyb3VwbmFtZSwgUGFnZTogcGFnZW5hbWUsIE9iamVjdFN0YXRlOiAwLCBTZWN0aW9uOiBzZWN0aW9uLCBQS05hbWU6IHBrbmFtZSwgUEtJZDogcGtpZCwgQmF0Y2g6IEJhdGNoZGF0ZSB9KVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBqID0gMDsgaiA8IGN1clByaW1hcmtleXMubGVuZ3RoOyBqKyspIHtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBsb29rIGZvciBzYW1lIHRoaW5nIGluIG5ldyBhcnJheVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKG9sZFByaW1hcmtleXMuaW5kZXhPZihjdXJQcmltYXJrZXlzW2pdKSA9PSAtMSkge1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgY3VyZGF0YSA9IGl0ZW0uZGF0YVtqXTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGN1clByaW1hcmtleXNbal0gPT0gY3VyZGF0YVtpdGVtLnByaW1hcnlLZXldKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICQuZWFjaChJbnNlcnRGaWVsZHMsIGZ1bmN0aW9uIChrZXksIGl0ZW1WYWx1ZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIG5ld0RhdGEgPSBjdXJkYXRhW2l0ZW1WYWx1ZS5maWVsZF07XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjaGFuZ2VkSXRlbXMucHVzaCh7IEhpc3RvcnlJZDogMCwgRmllbGQ6IGl0ZW1WYWx1ZS5sYWJlbCwgb2xkRGF0YTogJy0tJywgTmV3RGF0YTogbmV3RGF0YSwgcm93OiBqICsgMSwgU3ViU2VjdGlvbjogZ3JvdXBuYW1lLCBQYWdlOiBwYWdlbmFtZSwgT2JqZWN0U3RhdGU6IDAsIFNlY3Rpb246IHNlY3Rpb24sIFBLTmFtZTogcGtuYW1lLCBQS0lkOiBwa2lkLCBCYXRjaDogQmF0Y2hkYXRlLCBrZXl3b3JkOiBrZXl3b3JkIH0pXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgZWxzZSBpZiAoaXRlbS50eXBlID09PSBcImZpbGV1cGxvYWRcIikge1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBvbGRGaWxlcyA9IFwiXCI7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIG5ld0ZpbGVzID0gXCJcIjtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoaXRlbS5vbGREYXRhID09PSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgb2xkRmlsZXMgPSBcIlwiO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpdGVtLm9sZERhdGEgPSBbXTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGl0ZW0ub2xkRGF0YSAhPT0gdW5kZWZpbmVkICYmIEpTT04uc3RyaW5naWZ5KGFuZ3VsYXIuY29weShpdGVtLm9sZERhdGEpKSAhPT0gSlNPTi5zdHJpbmdpZnkoYW5ndWxhci5jb3B5KGl0ZW0uZGF0YSkpKSB7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAkLmVhY2goaXRlbS5vbGREYXRhLCBmdW5jdGlvbiAoaSwgaXRlbSkge1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9sZEZpbGVzICs9IGl0ZW0ubmFtZSArIFwiLFwiO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgb2xkRmlsZXMgPSBvbGRGaWxlcy5zdWJzdHJpbmcoMCwgb2xkRmlsZXMubGVuZ3RoIC0gMSk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAkLmVhY2goaXRlbS5kYXRhLCBmdW5jdGlvbiAoaywgbmV3SXRlbSkge1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5ld0ZpbGVzICs9IG5ld0l0ZW0ubmFtZSArIFwiLFwiO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG5ld0ZpbGVzID0gbmV3RmlsZXMuc3Vic3RyaW5nKDAsIG5ld0ZpbGVzLmxlbmd0aCAtIDEpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgcmV0dXJuRGF0YSA9IGRpc3BsYXlGaWVsZChpdGVtKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICgoaXRlbS5kYXRhID09IHVuZGVmaW5lZCB8fCBpdGVtLmRhdGEgPT0gXCJcIiB8fCBpdGVtLmRhdGEubGVuZ3RoID09IDApICYmIGl0ZW0ub2xkRGF0YS5sZW5ndGggPT0gMCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgY2hhbmdlZEl0ZW1zLnB1c2goeyBIaXN0b3J5SWQ6IDAsIEZpZWxkOiBpdGVtLnRlbXBsYXRlT3B0aW9ucy5sYWJlbC5yZXBsYWNlKCc6JywgJycpLCBvbGREYXRhOiBvbGRGaWxlcywgTmV3RGF0YTogbmV3RmlsZXMsIHJvdzogXCJcIiwgU3ViU2VjdGlvbjogXCJcIiwgUGFnZTogcGFnZW5hbWUsIE9iamVjdFN0YXRlOiAwLCBTZWN0aW9uOiBzZWN0aW9uLCBQS05hbWU6IHBrbmFtZSwgUEtJZDogcGtpZCwgQmF0Y2g6IEJhdGNoZGF0ZSwga2V5d29yZDoga2V5d29yZCB9KTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgZWxzZSBpZiAoaXRlbS50eXBlID09PSBcImdyb3VwY2hlY2tib3hsaXN0XCIpIHtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgb2xkYXJyYXkgPSBbXTtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgbmV3YXJyYXkgPSBbXTtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgZGF0YUZpZWxkID0gaXRlbS50ZW1wbGF0ZU9wdGlvbnMuaXRlbS5kYXRhRmllbGQ7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIEZpZWxkbmFtZSA9IGl0ZW0udGVtcGxhdGVPcHRpb25zLml0ZW0uZGlzcGxheUZpZWxkO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChpdGVtLm9sZERhdGEgIT0gdW5kZWZpbmVkICYmIGl0ZW0ub2xkRGF0YS5sZW5ndGggPiAwKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChpdGVtLmRhdGEgIT0gdW5kZWZpbmVkICYmIGl0ZW0uZGF0YS5sZW5ndGggPiAwKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkLmVhY2goaXRlbS5vbGREYXRhLCBmdW5jdGlvbiAoaW5kZXgsIHZhbHVlRGF0YSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9sZGFycmF5ID0gdmFsdWVEYXRhO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICQuZWFjaChpdGVtLmRhdGEsIGZ1bmN0aW9uIChpbmRleCwgaXRlbURhdGEpIHtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChvbGRhcnJheVtkYXRhRmllbGRdID09IGl0ZW1EYXRhW2RhdGFGaWVsZF0gJiYgaXRlbURhdGEudmFsdWUgIT0gdW5kZWZpbmVkICYmIGl0ZW1EYXRhLnZhbHVlICE9IG9sZGFycmF5LnZhbHVlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjaGFuZ2VkSXRlbXMucHVzaCh7IEhpc3RvcnlJZDogMCwgRmllbGQ6IGl0ZW1EYXRhW0ZpZWxkbmFtZV0sIG9sZERhdGE6IG9sZGFycmF5LnZhbHVlID09IHVuZGVmaW5lZCA/ICd1bmNoZWNrZWQnIDogKG9sZGFycmF5LnZhbHVlID8gJ2NoZWNrZWQnIDogJ3VuY2hlY2tlZCcpLCBOZXdEYXRhOiBpdGVtRGF0YS52YWx1ZSA/ICdjaGVja2VkJyA6ICd1bmNoZWNrZWQnLCByb3c6IFwiXCIsIFN1YlNlY3Rpb246IFwiXCIsIFBhZ2U6IHBhZ2VuYW1lLCBPYmplY3RTdGF0ZTogMCwgU2VjdGlvbjogc2VjdGlvbiwgUEtOYW1lOiBwa25hbWUsIFBLSWQ6IHBraWQsIEJhdGNoOiBCYXRjaGRhdGUsIGtleXdvcmQ6IGtleXdvcmQgfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBlbHNlIGlmIChpdGVtLnR5cGUgPT09IFwiY2hlY2tib3hsaXN0XCIpIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoaXRlbS5vbGREYXRhICE9IHVuZGVmaW5lZCAmJiBpdGVtLm9sZERhdGEubGVuZ3RoID4gMCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoaXRlbS5kYXRhICE9IHVuZGVmaW5lZCAmJiBpdGVtLmRhdGEubGVuZ3RoID4gMCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIG9sZERhdGFBcnJheSA9IFtdO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGRhdGFBcnJheSA9IFtdO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGRhdGFGaWVsZCA9IGl0ZW0udGVtcGxhdGVPcHRpb25zLml0ZW0uZGF0YUZpZWxkO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIEZpZWxkbmFtZSA9IGl0ZW0udGVtcGxhdGVPcHRpb25zLml0ZW0uZGlzcGxheUZpZWxkO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJC5lYWNoKGl0ZW0ub2xkRGF0YSwgZnVuY3Rpb24gKGluZGV4LCBWYWx1ZURhdGEpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvbGREYXRhQXJyYXkgPSBWYWx1ZURhdGEuZGF0YVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChvbGREYXRhQXJyYXkgPT0gbnVsbCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvbGREYXRhQXJyYXkgPSBbXTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICQuZWFjaChpdGVtLmRhdGEsIGZ1bmN0aW9uIChpbmRleCwgdmFsdWUpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGF0YUFycmF5ID0gdmFsdWUuZGF0YVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyAgaWYgKG9sZERhdGFBcnJheSAhPSBudWxsICYmIGRhdGFBcnJheSAhPSBudWxsKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChkYXRhQXJyYXkgPT0gbnVsbCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGF0YUFycmF5ID0gW107XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJC5lYWNoKG9sZERhdGFBcnJheSwgZnVuY3Rpb24gKGluZGV4LCBpdGVtRGF0YSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJC5lYWNoKGRhdGFBcnJheSwgZnVuY3Rpb24gKGluZGV4LCBpdGVtKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGl0ZW1bZGF0YUZpZWxkXSA9PSBpdGVtRGF0YVtkYXRhRmllbGRdICYmIGl0ZW0udmFsdWUgIT0gaXRlbURhdGEudmFsdWUpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2hhbmdlZEl0ZW1zLnB1c2goeyBIaXN0b3J5SWQ6IDAsIEZpZWxkOiBpdGVtW0ZpZWxkbmFtZV0sIG9sZERhdGE6IGl0ZW1EYXRhLnZhbHVlID8gJ2NoZWNrZWQnIDogJ3VuY2hlY2tlZCcsIE5ld0RhdGE6IGl0ZW0udmFsdWUgPyAnY2hlY2tlZCcgOiAndW5jaGVja2VkJywgcm93OiBcIlwiLCBTdWJTZWN0aW9uOiBcIlwiLCBQYWdlOiBwYWdlbmFtZSwgT2JqZWN0U3RhdGU6IDAsIFNlY3Rpb246IHNlY3Rpb24sIFBLTmFtZTogcGtuYW1lLCBQS0lkOiBwa2lkLCBCYXRjaDogQmF0Y2hkYXRlLCBrZXl3b3JkOiBrZXl3b3JkIH0pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgZWxzZSBpZiAoaXRlbS50eXBlID09IFwibXVsdGlzZWxlY3RjaGVja2JveFwiIHx8IGl0ZW0udHlwZS50b0xvd2VyQ2FzZSgpID09PSBcImtlbmRvbXVsdGlzZWxlY3RcIiApIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoaXRlbS5vbGREYXRhID09PSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaXRlbS5vbGREYXRhID0gXCJcIjtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGlmIChpdGVtLmRhdGEgPT09IHVuZGVmaW5lZCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpdGVtLmRhdGEgPSBcIlwiO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB2YXIgUHJpbWFyeUlkID0gaXRlbS5zZWxlY3RPcHRpb25zLml0ZW0uZGF0YUZpZWxkO1xyXG5cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGl0ZW0ub2xkRGF0YSAhPSBcIlwiICYmIGl0ZW0uZGF0YSAhPSBcIlwiKSB7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgbWF0Y2hlZGRhdGEgPSBhbmd1bGFyLmNvcHkoaXRlbS5kYXRhKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICQuZWFjaChtYXRjaGVkZGF0YSwgZnVuY3Rpb24gKG1hc3RlcmluZGV4LCBpdGVtVmFsdWUpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICQuZWFjaChpdGVtLm9sZERhdGEsIGZ1bmN0aW9uIChrZXlJbmRleCwgaXRlbURhdGEpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoaXRlbVZhbHVlICE9IHVuZGVmaW5lZCAmJiBpdGVtVmFsdWVbUHJpbWFyeUlkXSA9PSBpdGVtRGF0YVtQcmltYXJ5SWRdKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1hdGNoZWRkYXRhLnNwbGljZShtYXN0ZXJpbmRleCwgMSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSlcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChtYXRjaGVkZGF0YS5sZW5ndGggPiAwKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgcmV0dXJuRGF0YSA9IGRpc3BsYXlGaWVsZChpdGVtKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChyZXR1cm5EYXRhICE9IHVuZGVmaW5lZCAmJiByZXR1cm5EYXRhLmRhdGEgIT0gcmV0dXJuRGF0YS5vbGREYXRhKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNoYW5nZWRJdGVtcy5wdXNoKHsgSGlzdG9yeUlkOiAwLCBGaWVsZDogaXRlbS50ZW1wbGF0ZU9wdGlvbnMubGFiZWwucmVwbGFjZSgnOicsICcnKSwgb2xkRGF0YTogcmV0dXJuRGF0YS5vbGREYXRhLCBOZXdEYXRhOiByZXR1cm5EYXRhLmRhdGEsIHJvdzogXCJcIiwgU3ViU2VjdGlvbjogXCJcIiwgUGFnZTogcGFnZW5hbWUsIE9iamVjdFN0YXRlOiAwLCBTZWN0aW9uOiBzZWN0aW9uLCBQS05hbWU6IHBrbmFtZSwgUEtJZDogcGtpZCwgQmF0Y2g6IEJhdGNoZGF0ZSwga2V5d29yZDoga2V5d29yZCB9KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSBpZiAoaXRlbS5vbGREYXRhICE9IHVuZGVmaW5lZCAmJiBpdGVtLm9sZERhdGEgIT0gXCJcIiAmJiBpdGVtLm9sZERhdGEubGVuZ3RoID4gaXRlbS5kYXRhLmxlbmd0aCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIG1hdGNoZWRvbGRkYXRhID0gYW5ndWxhci5jb3B5KGl0ZW0ub2xkRGF0YSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkLmVhY2gobWF0Y2hlZG9sZGRhdGEsIGZ1bmN0aW9uIChtYXN0ZXJpbmRleCwgaXRlbVZhbHVlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJC5lYWNoKGl0ZW0uZGF0YSwgZnVuY3Rpb24gKGtleUluZGV4LCBpdGVtRGF0YSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoaXRlbVZhbHVlICE9IHVuZGVmaW5lZCAmJiBpdGVtVmFsdWVbUHJpbWFyeUlkXSA9PSBpdGVtRGF0YVtQcmltYXJ5SWRdKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtYXRjaGVkb2xkZGF0YS5zcGxpY2UobWFzdGVyaW5kZXgsIDEpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAobWF0Y2hlZG9sZGRhdGEgIT0gdW5kZWZpbmVkICYmIG1hdGNoZWRvbGRkYXRhLmxlbmd0aCA+IDApIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgcmV0dXJuRGF0YSA9IGRpc3BsYXlGaWVsZChpdGVtKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAocmV0dXJuRGF0YSAhPSB1bmRlZmluZWQgJiYgcmV0dXJuRGF0YS5kYXRhICE9IHJldHVybkRhdGEub2xkRGF0YSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2hhbmdlZEl0ZW1zLnB1c2goeyBIaXN0b3J5SWQ6IDAsIEZpZWxkOiBpdGVtLnRlbXBsYXRlT3B0aW9ucy5sYWJlbC5yZXBsYWNlKCc6JywgJycpLCBvbGREYXRhOiByZXR1cm5EYXRhLm9sZERhdGEsIE5ld0RhdGE6IHJldHVybkRhdGEuZGF0YSwgcm93OiBcIlwiLCBTdWJTZWN0aW9uOiBcIlwiLCBQYWdlOiBwYWdlbmFtZSwgT2JqZWN0U3RhdGU6IDAsIFNlY3Rpb246IHNlY3Rpb24sIFBLTmFtZTogcGtuYW1lLCBQS0lkOiBwa2lkLCBCYXRjaDogQmF0Y2hkYXRlLCBrZXl3b3JkOiBrZXl3b3JkIH0pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBlbHNlIGlmIChpdGVtLm9sZERhdGEgPT0gXCJcIiAmJiBpdGVtLmRhdGEgIT0gXCJcIikge1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHJldHVybkRhdGEgPSBkaXNwbGF5RmllbGQoaXRlbSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChyZXR1cm5EYXRhICE9IHVuZGVmaW5lZCAmJiByZXR1cm5EYXRhLmRhdGEgIT0gcmV0dXJuRGF0YS5vbGREYXRhKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY2hhbmdlZEl0ZW1zLnB1c2goeyBIaXN0b3J5SWQ6IDAsIEZpZWxkOiBpdGVtLnRlbXBsYXRlT3B0aW9ucy5sYWJlbC5yZXBsYWNlKCc6JywgJycpLCBvbGREYXRhOiBcIlwiLCBOZXdEYXRhOiByZXR1cm5EYXRhLmRhdGEsIHJvdzogXCJcIiwgU3ViU2VjdGlvbjogXCJcIiwgUGFnZTogcGFnZW5hbWUsIE9iamVjdFN0YXRlOiAwLCBTZWN0aW9uOiBzZWN0aW9uLCBQS05hbWU6IHBrbmFtZSwgUEtJZDogcGtpZCwgQmF0Y2g6IEJhdGNoZGF0ZSwga2V5d29yZDoga2V5d29yZCB9KTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKGl0ZW0ub2xkRGF0YSAhPSBcIlwiICYmIGl0ZW0uZGF0YSA9PSBcIlwiKSB7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgcmV0dXJuRGF0YSA9IGRpc3BsYXlGaWVsZChpdGVtKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHJldHVybkRhdGEgIT0gdW5kZWZpbmVkICYmIHJldHVybkRhdGEuZGF0YSAhPSByZXR1cm5EYXRhLm9sZERhdGEpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjaGFuZ2VkSXRlbXMucHVzaCh7IEhpc3RvcnlJZDogMCwgRmllbGQ6IGl0ZW0udGVtcGxhdGVPcHRpb25zLmxhYmVsLnJlcGxhY2UoJzonLCAnJyksIG9sZERhdGE6IHJldHVybkRhdGEub2xkRGF0YSwgTmV3RGF0YTogXCJcIiwgcm93OiBcIlwiLCBTdWJTZWN0aW9uOiBcIlwiLCBQYWdlOiBwYWdlbmFtZSwgT2JqZWN0U3RhdGU6IDAsIFNlY3Rpb246IHNlY3Rpb24sIFBLTmFtZTogcGtuYW1lLCBQS0lkOiBwa2lkLCBCYXRjaDogQmF0Y2hkYXRlLCBrZXl3b3JkOiBrZXl3b3JkIH0pO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGVsc2UgaWYgKGl0ZW0udHlwZSA9PT0gXCJodG1sdGFibGVcIikge1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBvbGREYXRhQXJyYXkgPSBbXTtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgZGF0YUFycmF5ID0gW107XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGlmIChpdGVtLm9sZERhdGEgPT09IHVuZGVmaW5lZCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpdGVtLm9sZERhdGEgPSBbXTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGlmIChpdGVtLmRhdGEgPT09IHVuZGVmaW5lZCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpdGVtLmRhdGEgPSBbXTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIHZhciBjb2x1bW5zID0gaXRlbS5jb2x1bW5zO1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBsYWJlbGNvbHVtbnMgPSBpdGVtLmxhYmVsY29sdW1ucztcclxuICAgICAgICAgICAgICAgICAgICB2YXIgc2NvcGV2YXJpYWJsZSA9IGl0ZW0uc2NvcGV2YXJpYWJsZSB8fCBcIlwiO1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBvYmplY3R0eXBlID0gaXRlbS5vYmplY3R0eXBlIHx8IFwiXCI7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGlmIChzY29wZXZhcmlhYmxlICE9IHVuZGVmaW5lZCAmJiBzY29wZXZhcmlhYmxlICE9IFwiXCIpIHtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBfc2NvcGV2YXJpYWJsZSA9IGFuZ3VsYXIuZWxlbWVudCgnIycgKyBzY29wZXZhcmlhYmxlKS5zY29wZSgpLiRwYXJlbnQ7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgcGFuZWxkYXRhID0gX3Njb3BldmFyaWFibGUuZm9ybU1hbmFnZVtpdGVtLnBhbmVsdmFyaWFibGVdO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAocGFuZWxkYXRhICE9IHVuZGVmaW5lZCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgbSA9IDA7IG0gPCBwYW5lbGRhdGEubGVuZ3RoOyBtKyspIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjaGFuZ2VkSXRlbXMgPSBjb21wYXJlZGF0YShwYW5lbGRhdGFbbV0sIHBhZ2VuYW1lLCBzZWN0aW9uLCBwa25hbWUsIHBraWQsIGlkZW50aWZpZXIsIGNoYW5nZWRJdGVtcylcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBlbHNlIGlmIChpdGVtLm9iamVjdHR5cGUgIT0gdW5kZWZpbmVkICYmIGl0ZW0ub2JqZWN0dHlwZSAhPSBcIlwiKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChpdGVtLmRhdGEgIT0gdW5kZWZpbmVkICYmIGl0ZW0uZGF0YSAhPSBudWxsKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkLmVhY2goaXRlbS5kYXRhLCBmdW5jdGlvbiAoaW5kZXgsIGl0ZW1EYXRhKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHBhcmVudFNlY3Rpb24gPSBpdGVtRGF0YVtpdGVtLnNlY3Rpb25dO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBvbGREYXRhT2JqZWN0O1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChpdGVtLm9iamVjdHR5cGUgIT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9sZERhdGFPYmplY3QgPSBpdGVtLm9sZERhdGFbaW5kZXhdW29iamVjdHR5cGVdO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9sZERhdGFPYmplY3QgPSBpdGVtLm9sZERhdGFbaW5kZXhdO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGl0ZW1EYXRhW29iamVjdHR5cGVdICE9IHVuZGVmaW5lZCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkLmVhY2goaXRlbURhdGFbb2JqZWN0dHlwZV0sIGZ1bmN0aW9uIChrZXksIHZhbHVlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgY2hpbGRTZWN0aW9uID0gdmFsdWVbaXRlbS5zdWJzZWN0aW9uXTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChvbGREYXRhT2JqZWN0W2tleV0gIT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgayA9IDA7IGsgPCBjb2x1bW5zLmxlbmd0aDsgaysrKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh2YWx1ZVtjb2x1bW5zW2tdXSAhPSBvbGREYXRhT2JqZWN0W2tleV1bY29sdW1uc1trXV0pIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNoYW5nZWRJdGVtcy5wdXNoKHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBIaXN0b3J5SWQ6IDAsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgRmllbGQ6IGxhYmVsY29sdW1uc1trXSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvbGREYXRhOiBvbGREYXRhT2JqZWN0W2tleV1bY29sdW1uc1trXV0sXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgTmV3RGF0YTogdmFsdWVbY29sdW1uc1trXV0sXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcm93OiBcIlwiLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFN1YlNlY3Rpb246IGNoaWxkU2VjdGlvbixcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBQYWdlOiBwYWdlbmFtZSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBPYmplY3RTdGF0ZTogMCxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBTZWN0aW9uOiBwYXJlbnRTZWN0aW9uLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFBLTmFtZTogcGtuYW1lLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFBLSWQ6IHBraWQsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgQmF0Y2g6IEJhdGNoZGF0ZSwga2V5d29yZDoga2V5d29yZFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciAodmFyIGsgPSAwOyBrIDwgY29sdW1ucy5sZW5ndGg7IGsrKykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjaGFuZ2VkSXRlbXMucHVzaCh7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBIaXN0b3J5SWQ6IDAsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBGaWVsZDogbGFiZWxjb2x1bW5zW2tdLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb2xkRGF0YTogXCJcIixcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIE5ld0RhdGE6IHZhbHVlW2NvbHVtbnNba11dLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcm93OiBcIlwiLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgU3ViU2VjdGlvbjogY2hpbGRTZWN0aW9uLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgUGFnZTogcGFnZW5hbWUsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBPYmplY3RTdGF0ZTogMCxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFNlY3Rpb246IHBhcmVudFNlY3Rpb24sXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBQS05hbWU6IHBrbmFtZSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFBLSWQ6IHBraWQsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBCYXRjaDogQmF0Y2hkYXRlLCBrZXl3b3JkOiBrZXl3b3JkXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBjaGlsZFNlY3Rpb24gPSBpdGVtRGF0YVtpdGVtLnN1YnNlY3Rpb25dO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAob2xkRGF0YU9iamVjdCAhPSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciAodmFyIGsgPSAwOyBrIDwgY29sdW1ucy5sZW5ndGg7IGsrKykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChpdGVtRGF0YVtjb2x1bW5zW2tdXSAhPSBvbGREYXRhT2JqZWN0W2NvbHVtbnNba11dKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNoYW5nZWRJdGVtcy5wdXNoKHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEhpc3RvcnlJZDogMCxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEZpZWxkOiBsYWJlbGNvbHVtbnNba10sXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvbGREYXRhOiBvbGREYXRhT2JqZWN0W2NvbHVtbnNba11dLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgTmV3RGF0YTogaXRlbURhdGFbY29sdW1uc1trXV0sXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByb3c6IFwiXCIsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBTdWJTZWN0aW9uOiBjaGlsZFNlY3Rpb24sXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBQYWdlOiBwYWdlbmFtZSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIE9iamVjdFN0YXRlOiAwLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgU2VjdGlvbjogcGFyZW50U2VjdGlvbixcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFBLTmFtZTogcGtuYW1lLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgUEtJZDogcGtpZCxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEJhdGNoOiBCYXRjaGRhdGUsIGtleXdvcmQ6IGtleXdvcmRcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgayA9IDA7IGsgPCBjb2x1bW5zLmxlbmd0aDsgaysrKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2hhbmdlZEl0ZW1zLnB1c2goe1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBIaXN0b3J5SWQ6IDAsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEZpZWxkOiBsYWJlbGNvbHVtbnNba10sXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9sZERhdGE6IFwiXCIsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIE5ld0RhdGE6IGl0ZW1EYXRhW2NvbHVtbnNba11dLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByb3c6IFwiXCIsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFN1YlNlY3Rpb246IGNoaWxkU2VjdGlvbixcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgUGFnZTogcGFnZW5hbWUsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIE9iamVjdFN0YXRlOiAwLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBTZWN0aW9uOiBwYXJlbnRTZWN0aW9uLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBQS05hbWU6IHBrbmFtZSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgUEtJZDogcGtpZCxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgQmF0Y2g6IEJhdGNoZGF0ZSwga2V5d29yZDoga2V5d29yZFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgJC5lYWNoKGl0ZW0uZGF0YSwgZnVuY3Rpb24gKGluZGV4LCBpdGVtRGF0YSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIG9sZERhdGFPYmplY3QgPSBpdGVtLm9sZERhdGFbaW5kZXhdO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKG9sZERhdGFPYmplY3QgPT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb2xkRGF0YU9iamVjdCA9IFtdO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHBhcmVudFNlY3Rpb24gPSBpdGVtRGF0YVtpdGVtLnNlY3Rpb25dO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgayA9IDA7IGsgPCBjb2x1bW5zLmxlbmd0aDsgaysrKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGl0ZW1EYXRhW2NvbHVtbnNba11dICE9IG9sZERhdGFPYmplY3RbY29sdW1uc1trXV0pIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2hhbmdlZEl0ZW1zLnB1c2goeyBIaXN0b3J5SWQ6IDAsIEZpZWxkOiBsYWJlbGNvbHVtbnNba10sIG9sZERhdGE6IG9sZERhdGFPYmplY3RbY29sdW1uc1trXV0sIE5ld0RhdGE6IGl0ZW1EYXRhW2NvbHVtbnNba11dLCByb3c6IFwiXCIsIFN1YlNlY3Rpb246IHBhcmVudFNlY3Rpb24sIFBhZ2U6IHBhZ2VuYW1lLCBPYmplY3RTdGF0ZTogMCwgU2VjdGlvbjogc2VjdGlvbiwgUEtOYW1lOiBwa25hbWUsIFBLSWQ6IHBraWQsIEJhdGNoOiBCYXRjaGRhdGUsIGtleXdvcmQ6IGtleXdvcmQgfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGVsc2UgaWYgKGl0ZW0udHlwZSA9PT0gXCJ0cmVlXCIpIHtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgb2xkRGF0YUFycmF5ID0gW107XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIGRhdGFBcnJheSA9IFtdO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICBpZiAoaXRlbS5vbGREYXRhID09PSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaXRlbS5vbGREYXRhID0gW107XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICAgICBpZiAoaXRlbS5kYXRhID09PSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaXRlbS5kYXRhID0gW107XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIHZhciBvYmplY3R0eXBlID0gaXRlbS5vYmplY3R0eXBlIHx8IFwiXCI7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIGNoaWxkb2JqZWN0ID0gaXRlbS5jaGlsZG9iamVjdCB8fCBcIlwiO1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBjb2x1bW5zID0gaXRlbS5jb2x1bW5zO1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBsYWJlbGNvbHVtbnMgPSBpdGVtLmxhYmVsY29sdW1ucztcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIHNjb3BldmFyaWFibGUgPSBpdGVtLnNjb3BldmFyaWFibGUgfHwgXCJcIjtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoc2NvcGV2YXJpYWJsZSAhPSB1bmRlZmluZWQgJiYgc2NvcGV2YXJpYWJsZSAhPSBcIlwiKSB7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgX3Njb3BldmFyaWFibGUgPSBhbmd1bGFyLmVsZW1lbnQoJyMnICsgc2NvcGV2YXJpYWJsZSkuc2NvcGUoKS4kcGFyZW50O1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHRyZWVkYXRhID0gX3Njb3BldmFyaWFibGUuZm9ybU1hbmFnZVtpdGVtLnRyZWV2YXJpYWJsZV07XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0cmVlZGF0YSAhPSB1bmRlZmluZWQgJiYgdHJlZWRhdGEuZGF0YSAhPSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBjdXJkYXRhID0gdHJlZWRhdGEuZGF0YTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBwcmV2ZGF0YSA9IHRyZWVkYXRhLm9sZERhdGE7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGN1cmRhdGEgIT0gdW5kZWZpbmVkICYmIGN1cmRhdGEgIT0gXCJcIiAmJiBwcmV2ZGF0YSAhPSB1bmRlZmluZWQgJiYgcHJldmRhdGEgIT0gXCJcIikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciAodmFyIGluZGV4ID0gMDsgaW5kZXggPCBjdXJkYXRhLmxlbmd0aDsgaW5kZXgrKykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBjb2wgPSAwOyBjb2wgPCBjb2x1bW5zLmxlbmd0aDsgY29sKyspIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChjdXJkYXRhW2luZGV4XS5kYXRhW2NvbHVtbnNbY29sXV0gIT0gcHJldmRhdGFbaW5kZXhdLmRhdGFbY29sdW1uc1tjb2xdXSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNoYW5nZWRJdGVtcy5wdXNoKHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgSGlzdG9yeUlkOiAwLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBGaWVsZDogbGFiZWxjb2x1bW5zW2NvbF0sXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9sZERhdGE6IHByZXZkYXRhW2luZGV4XS5kYXRhW2NvbHVtbnNbY29sXV0sXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIE5ld0RhdGE6IGN1cmRhdGFbaW5kZXhdLmRhdGFbY29sdW1uc1tjb2xdXSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcm93OiBcIlwiLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBTdWJTZWN0aW9uOiBjdXJkYXRhW2luZGV4XS50ZXh0LFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBQYWdlOiBwYWdlbmFtZSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgT2JqZWN0U3RhdGU6IDAsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFNlY3Rpb246IFwiXCIsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFBLTmFtZTogcGtuYW1lLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBQS0lkOiBwa2lkLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBCYXRjaDogQmF0Y2hkYXRlLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBrZXl3b3JkOiBrZXl3b3JkXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoaXRlbS5vbGREYXRhID09PSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaXRlbS5vbGREYXRhID0gXCJcIjtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGlmIChpdGVtLmRhdGEgPT09IHVuZGVmaW5lZCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpdGVtLmRhdGEgPSBcIlwiO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGl0ZW0ub2xkRGF0YSAhPT0gdW5kZWZpbmVkICYmIEpTT04uc3RyaW5naWZ5KGFuZ3VsYXIuY29weShpdGVtLm9sZERhdGEpKSAhPT0gSlNPTi5zdHJpbmdpZnkoYW5ndWxhci5jb3B5KGl0ZW0uZGF0YSkpICYmIGl0ZW0udHlwZS50b0xvd2VyQ2FzZSgpICE9PSBcInRhYmxlXCIgJiYgaXRlbS50eXBlLnRvTG93ZXJDYXNlKCkgIT09IFwibGFiZWxcIiAmJiBpdGVtLmtleS50b0xvd2VyQ2FzZSgpICE9PSBcIklUQVJcIikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgcmV0dXJuRGF0YSA9IGRpc3BsYXlGaWVsZChpdGVtKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHJldHVybkRhdGEgIT0gdW5kZWZpbmVkICYmIHJldHVybkRhdGEuZGF0YSAhPSByZXR1cm5EYXRhLm9sZERhdGEpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChyZXR1cm5EYXRhLmRhdGEgIT0gdW5kZWZpbmVkICYmIHJldHVybkRhdGEuZGF0YSA9PSAnQVVUSE9SSVNFRCcpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm5EYXRhLmRhdGEgPSAnQVVUSE9SSVpFRCdcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNoYW5nZWRJdGVtcy5wdXNoKHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBIaXN0b3J5SWQ6IDAsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgRmllbGQ6IGl0ZW0udGVtcGxhdGVPcHRpb25zLmxhYmVsLnJlcGxhY2UoJzonLCAnJyksXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb2xkRGF0YTogcmV0dXJuRGF0YS5vbGREYXRhLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIE5ld0RhdGE6IHJldHVybkRhdGEuZGF0YSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByb3c6IFwiXCIsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgU3ViU2VjdGlvbjogXCJcIixcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBQYWdlOiBwYWdlbmFtZSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBPYmplY3RTdGF0ZTogMCxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBTZWN0aW9uOiBzZWN0aW9uLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFBLTmFtZTogcGtuYW1lLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFBLSWQ6IHBraWQsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgQmF0Y2g6IEJhdGNoZGF0ZSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBrZXl3b3JkOiBrZXl3b3JkXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pXHJcbiAgICAgICAgcmV0dXJuIGNoYW5nZWRJdGVtcztcclxuICAgIH07XHJcbiAgICBmdW5jdGlvbiBnZXREaWZmZXJlbmNlcyhvbGRPYmosIG5ld09iaikge1xyXG4gICAgICAgIHZhciBkaWZmID0ge307XHJcblxyXG4gICAgICAgIGZvciAodmFyIGsgaW4gb2xkT2JqKSB7XHJcbiAgICAgICAgICAgIGlmICghKGsgaW4gbmV3T2JqKSlcclxuICAgICAgICAgICAgICAgIGRpZmZba10gPSB1bmRlZmluZWQ7ICAvLyBwcm9wZXJ0eSBnb25lIHNvIGV4cGxpY2l0bHkgc2V0IGl0IHVuZGVmaW5lZFxyXG4gICAgICAgICAgICBlbHNlIGlmIChvbGRPYmpba10gIT09IG5ld09ialtrXSlcclxuICAgICAgICAgICAgICAgIGRpZmZba10gPSBuZXdPYmpba107ICAvLyBwcm9wZXJ0eSBpbiBib3RoIGJ1dCBoYXMgY2hhbmdlZFxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZm9yIChrIGluIG5ld09iaikge1xyXG4gICAgICAgICAgICBpZiAoIShrIGluIG9sZE9iaikpXHJcbiAgICAgICAgICAgICAgICBkaWZmW2tdID0gbmV3T2JqW2tdOyAvLyBwcm9wZXJ0eSBpcyBuZXdcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHJldHVybiBkaWZmO1xyXG4gICAgfVxyXG4gICAgdmFyIEJyb3dzZXJEZXRlY3QgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgdmFyIG5hdiA9IHdpbmRvdy5uYXZpZ2F0b3IsXHJcbiAgICAgICAgdWEgPSB3aW5kb3cubmF2aWdhdG9yLnVzZXJBZ2VudC50b0xvd2VyQ2FzZSgpO1xyXG4gICAgICAgIC8vIGRldGVjdCBicm93c2VycyAob25seSB0aGUgb25lcyB0aGF0IGhhdmUgc29tZSBraW5kIG9mIHF1aXJrIHdlIG5lZWQgdG8gd29yayBhcm91bmQpXHJcbiAgICAgICAgaWYgKHVhLm1hdGNoKC9pcGFkL2kpICE9PSBudWxsKVxyXG4gICAgICAgICAgICByZXR1cm4gXCJpUG9kXCI7XHJcbiAgICAgICAgaWYgKHVhLm1hdGNoKC9pcGhvbmUvaSkgIT09IG51bGwpXHJcbiAgICAgICAgICAgIHJldHVybiBcImlQaG9uZVwiO1xyXG4gICAgICAgIGlmICh1YS5tYXRjaCgvYW5kcm9pZC9pKSAhPT0gbnVsbClcclxuICAgICAgICAgICAgcmV0dXJuIFwiQW5kcm9pZFwiO1xyXG4gICAgICAgIGlmICgobmF2LmFwcE5hbWUudG9Mb3dlckNhc2UoKS5pbmRleE9mKFwibWljcm9zb2Z0XCIpICE9IC0xIHx8IG5hdi5hcHBOYW1lLnRvTG93ZXJDYXNlKCkubWF0Y2goL3RyaWRlbnQvZ2kpICE9PSBudWxsKSlcclxuICAgICAgICAgICAgcmV0dXJuIFwiSUVcIjtcclxuICAgICAgICBpZiAodWEubWF0Y2goL2Nocm9tZS9naSkgIT09IG51bGwpXHJcbiAgICAgICAgICAgIHJldHVybiBcIkNocm9tZVwiO1xyXG4gICAgICAgIGlmICh1YS5tYXRjaCgvZmlyZWZveC9naSkgIT09IG51bGwpXHJcbiAgICAgICAgICAgIHJldHVybiBcIkZpcmVmb3hcIjtcclxuICAgICAgICBpZiAodWEubWF0Y2goL3dlYmtpdC9naSkgIT09IG51bGwpXHJcbiAgICAgICAgICAgIHJldHVybiBcIldlYmtpdFwiO1xyXG4gICAgICAgIGlmICh1YS5tYXRjaCgvZ2Vja28vZ2kpICE9PSBudWxsKVxyXG4gICAgICAgICAgICByZXR1cm4gXCJHZWNrb1wiO1xyXG4gICAgICAgIGlmICh1YS5tYXRjaCgvb3BlcmEvZ2kpICE9PSBudWxsKVxyXG4gICAgICAgICAgICByZXR1cm4gXCJPcGVyYVwiO1xyXG4gICAgICAgIC8vSWYgYW55IGNhc2UgbWlzcyB3ZSB3aWxsIHJldHVybiBudWxsXHJcbiAgICAgICAgcmV0dXJuIG51bGxcclxuICAgIH1cclxuXHJcbiAgICBmdW5jdGlvbiBkaXNwbGF5RmllbGQoaXRlbSkge1xyXG4gICAgICAgIHZhciByZXR1cm5WYWx1ZSA9IHt9O1xyXG4gICAgICAgIGlmIChpdGVtLnR5cGUgPT09IFwic2VsZWN0XCIgfHwgaXRlbS50eXBlID09PSBcImtlbmRvc2VsZWN0XCIgfHwgaXRlbS50eXBlID09PSBcImtlbmRvY29tYm9ib3hcIikge1xyXG4gICAgICAgICAgICByZXR1cm5WYWx1ZS5kYXRhID0gaXRlbS5kYXRhW2l0ZW0uc2VsZWN0T3B0aW9ucy5pdGVtLmRpc3BsYXlGaWVsZF07XHJcbiAgICAgICAgICAgIGlmIChpdGVtLm9sZERhdGEgIT0gdW5kZWZpbmVkICYmIGl0ZW0ub2xkRGF0YSAhPSBcIlwiKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm5WYWx1ZS5vbGREYXRhID0gaXRlbS5vbGREYXRhW2l0ZW0uc2VsZWN0T3B0aW9ucy5pdGVtLmRpc3BsYXlGaWVsZF07XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm5WYWx1ZS5vbGREYXRhID0gXCJcIjtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICB9IGVsc2UgaWYgKGl0ZW0udHlwZSA9PT0gXCJtdWx0aXNlbGVjdFwiIHx8IGl0ZW0udHlwZSA9PT0gXCJtdWx0aXNlbGVjdGNoZWNrYm94XCIgfHwgaXRlbS50eXBlLnRvTG93ZXJDYXNlKCkgPT09IFwia2VuZG9tdWx0aXNlbGVjdFwiKSB7XHJcbiAgICAgICAgICAgIHZhciBsaXN0ID0gW107XHJcbiAgICAgICAgICAgIHZhciBvbGRsaXN0ID0gW107XHJcbiAgICAgICAgICAgIGlmIChpdGVtLmRhdGEgPT0gdW5kZWZpbmVkKSBpdGVtLmRhdGEgPSBbXTtcclxuICAgICAgICAgICAgZm9yICh2YXIgaSA9IDAsIGxlbiA9IGl0ZW0uZGF0YS5sZW5ndGg7IGkgPCBsZW47IGkrKykge1xyXG4gICAgICAgICAgICAgICAgdmFyIG9iaiA9IGl0ZW0uZGF0YVtpXTtcclxuICAgICAgICAgICAgICAgIHZhciBnZXRkYXRhID0gb2JqW2l0ZW0uc2VsZWN0T3B0aW9ucy5pdGVtLmRpc3BsYXlGaWVsZF07XHJcbiAgICAgICAgICAgICAgICBpZiAoaXRlbS5zZWxlY3RPcHRpb25zLml0ZW0uc2Vjb25kRGlzcGxheUZpZWxkICE9IHVuZGVmaW5lZCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGdldGRhdGEgPSBvYmpbaXRlbS5zZWxlY3RPcHRpb25zLml0ZW0uZGlzcGxheUZpZWxkXSArICcvJyArIG9ialtpdGVtLnNlbGVjdE9wdGlvbnMuaXRlbS5zZWNvbmREaXNwbGF5RmllbGRdO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgbGlzdC5wdXNoKGdldGRhdGEpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmIChpdGVtLm9sZERhdGEgIT0gdW5kZWZpbmVkICYmIGl0ZW0ub2xkRGF0YSAhPSBcIlwiKSB7XHJcbiAgICAgICAgICAgICAgICBmb3IgKHZhciBpID0gMCwgbGVuID0gaXRlbS5vbGREYXRhLmxlbmd0aDsgaSA8IGxlbjsgaSsrKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIG9iaiA9IGl0ZW0ub2xkRGF0YVtpXTtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgZ2V0ZGF0YSA9IG9ialtpdGVtLnNlbGVjdE9wdGlvbnMuaXRlbS5kaXNwbGF5RmllbGRdO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChpdGVtLnNlbGVjdE9wdGlvbnMuaXRlbS5zZWNvbmREaXNwbGF5RmllbGQgIT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGdldGRhdGEgPSBvYmpbaXRlbS5zZWxlY3RPcHRpb25zLml0ZW0uZGlzcGxheUZpZWxkXSArICcvJyArIG9ialtpdGVtLnNlbGVjdE9wdGlvbnMuaXRlbS5zZWNvbmREaXNwbGF5RmllbGRdO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBvbGRsaXN0LnB1c2goZ2V0ZGF0YSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBvbGRsaXN0ID0gW107XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgcmV0dXJuVmFsdWUuZGF0YSA9IGxpc3Quam9pbihcIjsgXCIpO1xyXG4gICAgICAgICAgICByZXR1cm5WYWx1ZS5vbGREYXRhID0gb2xkbGlzdC5qb2luKFwiOyBcIik7XHJcblxyXG4gICAgICAgIH0gZWxzZSBpZiAoaXRlbS50eXBlID09PSBcImNoZWNrYm94XCIpIHtcclxuICAgICAgICAgICAgaWYgKGl0ZW0ub2xkRGF0YSAhPSB1bmRlZmluZWQgJiYgaXRlbS5vbGREYXRhICE9IFwiXCIpIHtcclxuICAgICAgICAgICAgICAgIGlmIChpdGVtLm9sZERhdGEgfHwgaXRlbS5vbGREYXRhID09PSAxIHx8IGl0ZW0ub2xkRGF0YSA9PT0gXCJ0cnVlXCIpIHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm5WYWx1ZS5vbGREYXRhID0gaXRlbS50ZW1wbGF0ZU9wdGlvbnMuc3VmZml4TGFiZWw7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm5WYWx1ZS5vbGREYXRhID0gXCJcIjtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgaWYgKGl0ZW0uZGF0YSB8fCBpdGVtLmRhdGEgPT09IDEgfHwgaXRlbS5kYXRhID09PSBcInRydWVcIikge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuVmFsdWUuZGF0YSA9IGl0ZW0udGVtcGxhdGVPcHRpb25zLnN1ZmZpeExhYmVsO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgaWYgKGl0ZW0udGVtcGxhdGVPcHRpb25zLnN1ZmZpeExhYmVsZmFsc2UgIT09IHVuZGVmaW5lZClcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm5WYWx1ZS5kYXRhID0gaXRlbS50ZW1wbGF0ZU9wdGlvbnMuc3VmZml4TGFiZWxmYWxzZTtcclxuICAgICAgICAgICAgICAgIGVsc2VcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm5WYWx1ZS5kYXRhID0gXCJOb1wiO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSBlbHNlIGlmIChpdGVtLnR5cGUgPT09IFwicmFkaW9cIikge1xyXG4gICAgICAgICAgICB2YXIgaXRlbXMgPSBpdGVtLnRlbXBsYXRlT3B0aW9ucy5pdGVtcztcclxuICAgICAgICAgICAgaWYgKGl0ZW0ub2xkRGF0YSAhPSB1bmRlZmluZWQgJiYgaXRlbS5vbGREYXRhICE9IG51bGwgJiYgaXRlbS5vbGREYXRhLnRvU3RyaW5nKCkgIT0gXCJcIikge1xyXG4gICAgICAgICAgICAgICAgdmFyIGZpbmRvYmpvbGQgPSBnZXRJdGVtQnlLZXlWYWx1ZShpdGVtcywgXCJ2YWx1ZVwiLCBpdGVtLm9sZERhdGEpO1xyXG4gICAgICAgICAgICAgICAgaWYgKGZpbmRvYmpvbGQgIT09IC0xKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuVmFsdWUub2xkRGF0YSA9IGZpbmRvYmpvbGQubGFiZWw7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVyblZhbHVlLm9sZERhdGEgPSBpdGVtLm9sZERhdGE7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm5WYWx1ZS5vbGREYXRhID0gXCJcIjtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgdmFyIGZpbmRPYmogPSBnZXRJdGVtQnlLZXlWYWx1ZShpdGVtcywgXCJ2YWx1ZVwiLCBpdGVtLmRhdGEpO1xyXG4gICAgICAgICAgICBpZiAoZmluZE9iaiAhPT0gLTEpIHtcclxuICAgICAgICAgICAgICAgIHJldHVyblZhbHVlLmRhdGEgPSBmaW5kT2JqLmxhYmVsO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuVmFsdWUuZGF0YSA9IGl0ZW0uZGF0YTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgcmV0dXJuVmFsdWUuZGF0YSA9IGl0ZW0uZGF0YTtcclxuICAgICAgICAgICAgaWYgKGl0ZW0ub2xkRGF0YSAhPSB1bmRlZmluZWQgJiYgaXRlbS5vbGREYXRhICE9IFwiXCIpIHtcclxuICAgICAgICAgICAgICAgIHJldHVyblZhbHVlLm9sZERhdGEgPSBpdGVtLm9sZERhdGE7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm5WYWx1ZS5vbGREYXRhID0gXCJcIjtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaWYgKHJldHVyblZhbHVlICE9IHVuZGVmaW5lZCkge1xyXG4gICAgICAgICAgICByZXR1cm5WYWx1ZS5kYXRhID0gcmV0dXJuVmFsdWUuZGF0YSAhPSB1bmRlZmluZWQgPyByZXR1cm5WYWx1ZS5kYXRhIDogXCJcIlxyXG4gICAgICAgICAgICByZXR1cm5WYWx1ZS5vbGREYXRhID0gcmV0dXJuVmFsdWUub2xkRGF0YSAhPSB1bmRlZmluZWQgPyByZXR1cm5WYWx1ZS5vbGREYXRhIDogXCJcIlxyXG4gICAgICAgICAgICBpZiAocmV0dXJuVmFsdWUuZGF0YSA9PSBcIlwiICYmIHJldHVyblZhbHVlLm9sZERhdGEgPT0gXCJcIikge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuVmFsdWUgPSBcIlwiO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiByZXR1cm5WYWx1ZSAhPSB1bmRlZmluZWQgPyByZXR1cm5WYWx1ZSA6IFwiXCI7XHJcbiAgICB9XHJcblxyXG4gICAgdmFyIGdldEZpZWxkc0RhdGFUb1NhdmUgPSBmdW5jdGlvbiAoZmllbGRzLCBtb2RlLCBrZXksIHVwbG9hZCkge1xyXG4gICAgICAgIHZhciBvYmogPSB7fTtcclxuICAgICAgICB2YXIgZm9ybURhdGEgPSBuZXcgRm9ybURhdGEoKTtcclxuICAgICAgICB2YXIgdHlwZTtcclxuICAgICAgICAkLm1hcChmaWVsZHMsIGZ1bmN0aW9uIChpdGVtLCBpbmRleCkge1xyXG4gICAgICAgICAgICBpZiAoaXRlbSAhPSB1bmRlZmluZWQgJiYgaXRlbSAhPSBudWxsICYmIGl0ZW0gIT0gXCJcIikge1xyXG4gICAgICAgICAgICAgICAgaWYgKGl0ZW0uc2F2ZSAhPT0gdW5kZWZpbmVkICYmIGl0ZW0uc2F2ZSA9PT0gZmFsc2UpIHJldHVybiB0cnVlO1xyXG4gICAgICAgICAgICAgICAgaWYgKGl0ZW0udHlwZSAhPSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgICAgICAgICAgICB0eXBlID0gMDtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoaXRlbS50eXBlLnRvTG93ZXJDYXNlKCkgPT09IFwic2VsZWN0XCIgfHwgaXRlbS50eXBlLnRvTG93ZXJDYXNlKCkgPT09IFwia2VuZG9zZWxlY3RcIiB8fCBpdGVtLnR5cGUudG9Mb3dlckNhc2UoKSA9PT0gXCJrZW5kb2NvbWJvYm94XCIpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGl0ZW0uZGF0YSA9PSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGl0ZW0uZGF0YSA9IFwiXCI7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHNlbGVjdGVkRGF0YSA9IChpdGVtLmRhdGFbaXRlbS5zZWxlY3RPcHRpb25zLml0ZW0uZGF0YUZpZWxkXSB8fCBpdGVtLmRhdGEuSWQgfHwgaXRlbS5kYXRhLmlkKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgb2JqW2l0ZW0ua2V5XSA9IChzZWxlY3RlZERhdGEgIT09IHVuZGVmaW5lZCAmJiBzZWxlY3RlZERhdGEgIT09IFwiXCIgPyBzZWxlY3RlZERhdGEgOiBudWxsKTtcclxuICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGl0ZW0udHlwZS50b0xvd2VyQ2FzZSgpID09PSBcInRhYlwiKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBzZWxlY3RlZERhdGEgPSAoaXRlbS5kYXRhW2l0ZW0uc2VsZWN0T3B0aW9ucy5pdGVtLmRhdGFGaWVsZF0gfHwgaXRlbS5kYXRhLklkIHx8IGl0ZW0uZGF0YS5pZCB8fCBpdGVtLmRhdGEpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBvYmpbaXRlbS5rZXldID0gKHNlbGVjdGVkRGF0YSAhPT0gdW5kZWZpbmVkICYmIHNlbGVjdGVkRGF0YSAhPT0gXCJcIiA/IHNlbGVjdGVkRGF0YSA6IG51bGwpO1xyXG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoaXRlbS50eXBlLnRvTG93ZXJDYXNlKCkgPT09IFwibXVsdGlzZWxlY3RcIiB8fCBpdGVtLnR5cGUudG9Mb3dlckNhc2UoKSA9PT0gXCJtdWx0aXNlbGVjdGNoZWNrYm94XCIgfHwgaXRlbS50eXBlLnRvTG93ZXJDYXNlKCkgPT09IFwia2VuZG9tdWx0aXNlbGVjdFwiKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG9ialtpdGVtLmtleV0gPSB1cGRhdGVNdWx0aXNlbGVjdERhdGEoaXRlbSwgbW9kZSwgZmllbGRzLCBrZXkpO1xyXG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoaXRlbS50eXBlLnRvTG93ZXJDYXNlKCkgPT09IFwiY2hlY2tib3hsaXN0XCIgfHwgaXRlbS50eXBlLnRvTG93ZXJDYXNlKCkgPT09IFwiZ3JvdXBjaGVja2JveGxpc3RcIikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBvYmpbaXRlbS5rZXldID0gdXBkYXRlQ2hlY2tCb3hMaXN0RGF0YShpdGVtLCBtb2RlLCBmaWVsZHMsIGtleSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChpdGVtLnR5cGUudG9Mb3dlckNhc2UoKSA9PT0gXCJ0YWJsZWVkaXRvclwiKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG9ialtpdGVtLmtleV0gPSBnZXRUYWJsZUVkaXRvckRhdGEoaXRlbS5kYXRhLCBtb2RlLCBpdGVtLCBrZXksIGZpZWxkcyk7XHJcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChpdGVtLnR5cGUudG9Mb3dlckNhc2UoKSA9PT0gXCJ0YWJsZVwiKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChpdGVtLmNoZWNrZWRGaWVsZCAhPT0gdW5kZWZpbmVkICYmIGl0ZW0uY2hlY2tlZEZpZWxkICE9PSBcIlwiICYmIGl0ZW0uY2hlY2tlZEZpZWxkLnRvU3RyaW5nKCkudG9Mb3dlckNhc2UoKSA9PT0gXCJhbGxcIikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgb2JqW2l0ZW0ua2V5XSA9IGl0ZW0uZGF0YTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBjaGVja2VkID0gKGl0ZW0uY2hlY2tlZEZpZWxkID09PSB1bmRlZmluZWQgfHwgaXRlbS5jaGVja2VkRmllbGQgPT09ICcnKSA/IGZhbHNlIDogdHJ1ZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9ialtpdGVtLmtleV0gPSBuYXZjb24uZ2V0VGFibGVEYXRhKGl0ZW0ubmFtZSwgJycsIGNoZWNrZWQsIChpdGVtLmlkIHx8ICcnKSwgY2hlY2tlZCA/IGl0ZW0uY2hlY2tlZEZpZWxkIDogJycsIGl0ZW0ub2xkRGF0YSwgbW9kZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGl0ZW0udHlwZS50b0xvd2VyQ2FzZSgpID09PSBcInRyZWVcIikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBvYmpbaXRlbS5rZXldID0gZ2V0VHJlZURhdGEoaXRlbS5uYW1lLCBpdGVtLCBtb2RlLCBmaWVsZHMpO1xyXG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoaXRlbS50eXBlLnRvTG93ZXJDYXNlKCkgPT09IFwiZXZhbHVhdGlvblwiKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG9ialtpdGVtLmtleV0gPSBnZXRUcmVlRGF0YShcIlwiLCBpdGVtLCBtb2RlLCBmaWVsZHMpO1xyXG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoaXRlbS50eXBlLnRvTG93ZXJDYXNlKCkgPT09IFwiY2hlY2tib3hcIikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoaXRlbS5kYXRhID09PSBmYWxzZSB8fCBpdGVtLmRhdGEgPT09IFwiXCIgfHwgaXRlbS5kYXRhID09PSB1bmRlZmluZWQpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBvYmpbaXRlbS5rZXldID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2VcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9ialtpdGVtLmtleV0gPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoaXRlbS50eXBlLnRvTG93ZXJDYXNlKCkgPT09IFwicmFkaW9cIikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBvYmpbaXRlbS5rZXldID0gKGl0ZW0uZGF0YSAhPSB1bmRlZmluZWQgJiYgaXRlbS5kYXRhLnRvU3RyaW5nKCkgIT0gXCJcIikgPyBpdGVtLmRhdGEgOiBudWxsO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBlbHNlIGlmIChpdGVtLnR5cGUudG9Mb3dlckNhc2UoKSA9PT0gXCJkYXRlXCIgfHwgaXRlbS50eXBlLnRvTG93ZXJDYXNlKCkgPT09IFwia2VuZG9kYXRlXCIpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGl0ZW0uZGF0YSAhPT0gdW5kZWZpbmVkICYmIGl0ZW0uZGF0YSAhPT0gbnVsbCAmJiBpdGVtLmRhdGEgIT09IFwiXCIgJiYgaXRlbS5kYXRhICE9PSBcIjBcIilcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9ialtpdGVtLmtleV0gPSBuYXZjb24uZGF0ZVRvVVRDKGl0ZW0uZGF0YSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2VcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9ialtpdGVtLmtleV0gPSBudWxsO1xyXG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoaXRlbS50eXBlLnRvTG93ZXJDYXNlKCkgPT09IFwiZGF0ZXRpbWVcIiB8fCBpdGVtLnR5cGUudG9Mb3dlckNhc2UoKSA9PT0gXCJrZW5kb2RhdGV0aW1lXCIpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGl0ZW0uZGF0YSAhPT0gdW5kZWZpbmVkICYmIGl0ZW0uZGF0YSAhPT0gbnVsbCAmJiBpdGVtLmRhdGEgIT09IFwiXCIgJiYgaXRlbS5kYXRhICE9PSBcIjBcIikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGl0ZW0udGVtcGxhdGVPcHRpb25zLnRpbWVvbmx5ICE9PSB1bmRlZmluZWQgJiYgaXRlbS50ZW1wbGF0ZU9wdGlvbnMudGltZW9ubHkpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb2JqW2l0ZW0ua2V5XSA9IGl0ZW0uZGF0YTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2VcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvYmpbaXRlbS5rZXldID0gbmF2Y29uLmRhdGVUb1VUQyhpdGVtLmRhdGEsIFwiREQvTU0vWVlZWSBISDptbTpzc1wiKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICBlbHNlXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBvYmpbaXRlbS5rZXldID0gbnVsbDtcclxuICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGl0ZW0udHlwZS50b0xvd2VyQ2FzZSgpID09PSBcImZpbGV1cGxvYWRcIiB8fCBpdGVtLnR5cGUudG9Mb3dlckNhc2UoKSA9PT0gXCJwaG90b3VwbG9hZFwiKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGFuZ3VsYXIuZm9yRWFjaChpdGVtLmRhdGEsIGZ1bmN0aW9uIChmKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoZi5zdGF0dXMgIT09IHVuZGVmaW5lZCAmJiBmLnN0YXR1cyA9PT0gXCJuZXdcIikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBibG9iID0gYmFzZTY0VG9CbG9iKGYuYmFzZTY0LCBmLnR5cGUpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvcm1EYXRhLmFwcGVuZChcImJsb2JcIiwgYmxvYiwgZi5uYW1lKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG9ialtpdGVtLmtleV0gPSBpdGVtLmRhdGE7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGl0ZW0uZGF0YSA9IFwiXCI7XHJcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKChpdGVtLmRhdGF0eXBlICE9PSB1bmRlZmluZWQgJiYgaXRlbS5kYXRhdHlwZS50b0xvd2VyQ2FzZSgpID09PSBcImludGVnZXJcIikgJiYgKGl0ZW0uZGF0YSA9PT0gdW5kZWZpbmVkIHx8IGl0ZW0uZGF0YSA9PT0gbnVsbCB8fCBpdGVtLmRhdGEgPT09IFwiXCIpKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgb2JqW2l0ZW0ua2V5XSA9IG51bGw7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvKmVsc2UgaWYgKGl0ZW0uZGF0YSA9PT0gXCJcIiB8fCBpdGVtLmRhdGEgPT09IHVuZGVmaW5lZClcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvYmpbaXRlbS5rZXldID0gbnVsbDsqL1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBlbHNlXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoaXRlbS5rZXkgPT0gXCJIaXN0b3J5XCIgfHwgaXRlbS5rZXkgPT0gXCJIaXN0b3J5UmVtYXJrc1wiKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb2JqW2l0ZW0ua2V5XSA9IGl0ZW0uZGF0YSA9PSAwID8gXCJcIiA6IGl0ZW0uZGF0YTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9ialtpdGVtLmtleV0gPSBpdGVtLmRhdGEgPT09IHVuZGVmaW5lZCA/IFwiXCIgOiBpdGVtLmRhdGE7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdHlwZSA9IC0xO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgdHlwZSA9IC0xO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIC8vaWYgKG1vZGUgIT09IHVuZGVmaW5lZCAmJiBtb2RlLnRvTG93ZXJDYXNlKCkgPT09IFwic2F2ZVwiKSB7XHJcbiAgICAgICAgLy8gICAgaWYgKGZpZWxkc1snb2JqZWN0c3RhdGUnXSAhPT0gdW5kZWZpbmVkKSBmaWVsZHNbJ29iamVjdHN0YXRlJ10gPSAxO1xyXG4gICAgICAgIC8vICAgIGlmIChmaWVsZHNba2V5XSAhPT0gdW5kZWZpbmVkKSBmaWVsZHNba2V5XSA9IDA7XHJcbiAgICAgICAgLy99IGVsc2UgaWYgKG1vZGUgIT09IHVuZGVmaW5lZCAmJiBtb2RlLnRvTG93ZXJDYXNlKCkgPT09IFwidXBkYXRlXCIpIHtcclxuICAgICAgICAvLyAgICBpZiAoZmllbGRzWydvYmplY3RzdGF0ZSddICE9PSB1bmRlZmluZWQpIGZpZWxkc1snb2JqZWN0c3RhdGUnXSA9IDI7XHJcbiAgICAgICAgLy99XHJcbiAgICAgICAgaWYgKHR5cGUgPT09IDApIHtcclxuICAgICAgICAgICAgdmFyIG9iakluZGV4ID0gbmF2Y29uLmdldEl0ZW1JbmRleEJ5UHJvcGVydHkoZmllbGRzLCBcIk9iamVjdFN0YXRlXCIpO1xyXG4gICAgICAgICAgICBpZiAobW9kZSAhPT0gdW5kZWZpbmVkICYmIG1vZGUudG9Mb3dlckNhc2UoKSA9PT0gXCJzYXZlXCIpIHtcclxuICAgICAgICAgICAgICAgIGlmIChmaWVsZHNbb2JqSW5kZXhdICE9PSB1bmRlZmluZWQgJiYgKG9iai5PYmplY3RTdGF0ZSA9PT0gXCJcIiB8fCBvYmouT2JqZWN0U3RhdGUgPT09IFwiMFwiIHx8IG9iai5PYmplY3RTdGF0ZSA9PT0gMCkpIG9iai5PYmplY3RTdGF0ZSA9IDE7XHJcbiAgICAgICAgICAgICAgICBpZiAoZmllbGRzW2tleV0gIT09IHVuZGVmaW5lZCkgb2JqW2tleV0gPSAwO1xyXG4gICAgICAgICAgICB9IGVsc2UgaWYgKG1vZGUgIT09IHVuZGVmaW5lZCAmJiBtb2RlLnRvTG93ZXJDYXNlKCkgPT09IFwidXBkYXRlXCIpIHtcclxuICAgICAgICAgICAgICAgIGlmIChmaWVsZHNbb2JqSW5kZXhdICE9PSB1bmRlZmluZWQgJiYgKG9iai5PYmplY3RTdGF0ZSA9PT0gXCJcIiB8fCBvYmouT2JqZWN0U3RhdGUgPT09IFwiMFwiIHx8IG9iai5PYmplY3RTdGF0ZSA9PT0gMCkpIG9iai5PYmplY3RTdGF0ZSA9IDI7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGlmICh1cGxvYWQgIT09IHVuZGVmaW5lZCAmJiB1cGxvYWQpXHJcbiAgICAgICAgICAgICAgICBvYmpbXCJmaWxlc1VwbG9hZFwiXSA9IGZvcm1EYXRhO1xyXG5cclxuICAgICAgICAgICAgcmV0dXJuIG9iajtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgIHJldHVybiBmaWVsZHM7XHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxuXHJcbiAgICB2YXIgYmFzZTY0VG9CbG9iID0gZnVuY3Rpb24gKGI2NERhdGEsIGNvbnRlbnRUeXBlKSB7XHJcbiAgICAgICAgdmFyIGJ5dGVDaGFyYWN0ZXJzID0gYXRvYihiNjREYXRhLnNwbGl0KCcsJylbMV0pO1xyXG4gICAgICAgIHZhciBieXRlTnVtYmVycyA9IG5ldyBBcnJheShieXRlQ2hhcmFjdGVycy5sZW5ndGgpO1xyXG4gICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgYnl0ZUNoYXJhY3RlcnMubGVuZ3RoOyBpKyspIHtcclxuICAgICAgICAgICAgYnl0ZU51bWJlcnNbaV0gPSBieXRlQ2hhcmFjdGVycy5jaGFyQ29kZUF0KGkpO1xyXG4gICAgICAgIH1cclxuICAgICAgICB2YXIgYnl0ZUFycmF5ID0gbmV3IFVpbnQ4QXJyYXkoYnl0ZU51bWJlcnMpO1xyXG4gICAgICAgIHZhciBibG9iID0gbmV3IEJsb2IoW2J5dGVBcnJheV0sIHsgdHlwZTogY29udGVudFR5cGUgfSk7XHJcbiAgICAgICAgcmV0dXJuIGJsb2I7XHJcbiAgICB9XHJcblxyXG4gICAgdmFyIHVwZGF0ZU11bHRpc2VsZWN0RGF0YSA9IGZ1bmN0aW9uIChpdGVtLCBtb2RlLCBmaWVsZHMsIGtleSkge1xyXG4gICAgICAgIHZhciBsaXN0ID0gW107XHJcbiAgICAgICAgaWYgKGl0ZW0uZGF0YSA9PT0gdW5kZWZpbmVkIHx8IGl0ZW0uZGF0YSA9PT0gXCJcIiB8fCBpdGVtLmRhdGEgPT09IG51bGwpIHtcclxuICAgICAgICAgICAgaXRlbS5kYXRhID0gW107XHJcbiAgICAgICAgICAgIHJldHVybiBpdGVtLmRhdGE7XHJcbiAgICAgICAgfVxyXG4gICAgICAgICQubWFwKGl0ZW0uZGF0YSwgZnVuY3Rpb24gKHZhbHVlLCBpbmRleCkge1xyXG4gICAgICAgICAgICB2YXIgb2JqID0ge307XHJcbiAgICAgICAgICAgIC8vb2JqW2l0ZW0uc2VsZWN0T3B0aW9ucy5pdGVtLmRhdGFGaWVsZCB8fCAnaWQnXSA9IHZhbHVlW2l0ZW0uc2VsZWN0T3B0aW9ucy5pdGVtLmRhdGFGaWVsZF0gfHwgdmFsdWUuSWQ7XHJcbiAgICAgICAgICAgIG9ialtpdGVtLnNlbGVjdE9wdGlvbnMuaXRlbS5kYXRhRmllbGQgfHwgJ2lkJ10gPSB2YWx1ZVtpdGVtLnNlbGVjdE9wdGlvbnMuaXRlbS5kYXRhRmllbGQgfHwgJ0lkJ107XHJcblxyXG4gICAgICAgICAgICBpZiAoKG1vZGUudG9Mb3dlckNhc2UoKSA9PT0gXCJzYXZlXCIgfHwgbW9kZS50b0xvd2VyQ2FzZSgpID09PSBcInNhdmVhc1wiKSAmJiB2YWx1ZVtpdGVtLmFsdGtleSB8fCAnSWQnXSA9PSAwKSB7XHJcbiAgICAgICAgICAgICAgICBvYmouT2JqZWN0U3RhdGUgPSAxO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgLy9yZXREYXRhID0gbmF2Y29uLmdldEl0ZW1CeUtleVZhbHVlKGl0ZW0ub2xkRGF0YSwgKGl0ZW0uc2VsZWN0T3B0aW9ucy5pdGVtLmRhdGFGaWVsZCB8fCAnaWQnKSwgKHZhbHVlW2l0ZW0uc2VsZWN0T3B0aW9ucy5pdGVtLmRhdGFGaWVsZF0gfHwgdmFsdWUuSWQpKVxyXG4gICAgICAgICAgICAgICAgcmV0RGF0YSA9IG5hdmNvbi5nZXRJdGVtQnlLZXlWYWx1ZShpdGVtLm9sZERhdGEsIChpdGVtLnNlbGVjdE9wdGlvbnMuaXRlbS5kYXRhRmllbGQgfHwgJ2lkJyksICh2YWx1ZVtpdGVtLnNlbGVjdE9wdGlvbnMuaXRlbS5kYXRhRmllbGQgfHwgJ0lkJ10pKVxyXG4gICAgICAgICAgICAgICAgaWYgKHJldERhdGEgIT09IC0xKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgb2JqLk9iamVjdFN0YXRlID0gMjtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoaXRlbS5yZWZrZXkgIT09IHVuZGVmaW5lZCAmJiBpdGVtLnJlZmtleSAhPT0gbnVsbCkgb2JqW2l0ZW0ucmVma2V5XSA9IHZhbHVlW2l0ZW0ucmVma2V5XTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIG9iai5PYmplY3RTdGF0ZSA9IDE7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIGtleUluZGV4ID0gbmF2Y29uLmdldEl0ZW1JbmRleEJ5UHJvcGVydHkoZmllbGRzLCBpdGVtLnJlZmtleSk7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGtleUluZGV4ICE9PSB1bmRlZmluZWQgJiYga2V5SW5kZXggIT09IC0xKSBvYmpbaXRlbS5yZWZrZXldID0gZmllbGRzW2tleUluZGV4XS5kYXRhO1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIGlmIChpdGVtLmFsdGtleSAhPT0gdW5kZWZpbmVkICYmIGl0ZW0uYWx0a2V5ICE9PSBudWxsKSBvYmpbaXRlbS5hbHRrZXldID0gKHZhbHVlW2l0ZW0uYWx0a2V5XSA9PT0gdW5kZWZpbmVkID8gMCA6IHZhbHVlW2l0ZW0uYWx0a2V5XSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgb2JqLlN0YXR1cyA9IDA7XHJcbiAgICAgICAgICAgIGlmIChpdGVtLnNlbGVjdE9wdGlvbnMuaXRlbS50eXBlICE9PSB1bmRlZmluZWQgJiYgdmFsdWVbaXRlbS5zZWxlY3RPcHRpb25zLml0ZW0udHlwZV0pXHJcbiAgICAgICAgICAgICAgICBvYmpbaXRlbS5zZWxlY3RPcHRpb25zLml0ZW0udHlwZV0gPSB2YWx1ZVtpdGVtLnNlbGVjdE9wdGlvbnMuaXRlbS50eXBlXTtcclxuICAgICAgICAgICAgbGlzdC5wdXNoKG9iaik7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIC8vaWYgKG1vZGUudG9Mb3dlckNhc2UoKSA9PT0gXCJzYXZlXCIpXHJcbiAgICAgICAgLy8gICAgcmV0dXJuIGxpc3Q7XHJcbiAgICAgICAgLy9lbHNlXHJcbiAgICAgICAgcmV0dXJuIGluc2VydERlbGV0ZWRpdGVtcyhsaXN0LCBpdGVtLm9sZERhdGEsIChpdGVtLnNlbGVjdE9wdGlvbnMuaXRlbS5kYXRhRmllbGQgfHwgJ2lkJykpO1xyXG4gICAgfTtcclxuXHJcbiAgICB2YXIgdXBkYXRlQ2hlY2tCb3hMaXN0RGF0YSA9IGZ1bmN0aW9uIChpdGVtLCBtb2RlLCBmaWVsZHMsIGtleSkge1xyXG4gICAgICAgIHZhciBsaXN0ID0gW107XHJcbiAgICAgICAgaWYgKGl0ZW0uZGF0YSA9PT0gdW5kZWZpbmVkIHx8IGl0ZW0uZGF0YSA9PT0gXCJcIiB8fCBpdGVtLmRhdGEgPT09IG51bGwgfHwgaXRlbS5kYXRhLmxlbmd0aCA9PT0gdW5kZWZpbmVkIHx8IGl0ZW0uZGF0YS5sZW5ndGggPT09IDApIHJldHVybjtcclxuICAgICAgICBpZiAoaXRlbS5saXN0RGlzcGxheSAhPT0gdW5kZWZpbmVkICYmIGl0ZW0ubGlzdERpc3BsYXkpIHtcclxuICAgICAgICAgICAgJC5tYXAoZmllbGRzLCBmdW5jdGlvbiAoZmllbGRJdGVtLCBpbmRleCkge1xyXG4gICAgICAgICAgICAgICAgaWYgKChmaWVsZEl0ZW0udHlwZSA9PT0gXCJjaGVja2JveGxpc3RcIiB8fCBmaWVsZEl0ZW0udHlwZSA9PT0gXCJncm91cGNoZWNrYm94bGlzdFwiKSAmJiBmaWVsZEl0ZW0ubGlzdERpc3BsYXkgIT09IHVuZGVmaW5lZCAmJiBmaWVsZEl0ZW0ubGlzdERpc3BsYXkpIHtcclxuICAgICAgICAgICAgICAgICAgICAkLm1hcChmaWVsZEl0ZW0uZGF0YSwgZnVuY3Rpb24gKGRhdGFJdGVtLCBkYXRhSW5kZXgpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGRhdGFJdGVtLnZhbHVlICE9PSB1bmRlZmluZWQgJiYgZGF0YUl0ZW0udmFsdWUpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRhdGFJdGVtLlN0YXR1cyA9IDA7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHJlZmtleUluZGV4ID0gbmF2Y29uLmdldEl0ZW1JbmRleEJ5UHJvcGVydHkoZmllbGRzLCBpdGVtLnJlZmtleSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAocmVma2V5SW5kZXggIT09IHVuZGVmaW5lZCAmJiByZWZrZXlJbmRleCAhPT0gLTEpIGRhdGFJdGVtW2l0ZW0ucmVma2V5XSA9IGZpZWxkc1tyZWZrZXlJbmRleF0uZGF0YTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAobW9kZS50b0xvd2VyQ2FzZSgpID09PSBcInNhdmVcIiB8fCBtb2RlLnRvTG93ZXJDYXNlKCkgPT09IFwic2F2ZWFzXCIpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkYXRhSXRlbS5PYmplY3RTdGF0ZSA9IDE7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRhdGFJdGVtLk9iamVjdFN0YXRlID0gMTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgZXZlbnRJbmRleCA9IGdldEl0ZW1JbmRleEJ5S2V5VmFsdWUobGlzdCwgKGZpZWxkSXRlbS50ZW1wbGF0ZU9wdGlvbnMuaXRlbS5kYXRhRmllbGQgfHwgXCJFdmVudElEXCIpLCBkYXRhSXRlbVsoZmllbGRJdGVtLnRlbXBsYXRlT3B0aW9ucy5pdGVtLmRhdGFGaWVsZCB8fCBcIkV2ZW50SURcIildKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChldmVudEluZGV4ID09PSAtMSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxpc3QucHVzaChkYXRhSXRlbSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSlcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAkLm1hcChpdGVtLmRhdGEsIGZ1bmN0aW9uIChwYXJlbnRkYXRhLCBpbmRleCkge1xyXG4gICAgICAgICAgICAgICAgJC5tYXAocGFyZW50ZGF0YS5kYXRhLCBmdW5jdGlvbiAoZXZlbnRkYXRhLCBpbmQpIHtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgb2JqID0ge307XHJcbiAgICAgICAgICAgICAgICAgICAgb2JqID0gZXZlbnRkYXRhO1xyXG4gICAgICAgICAgICAgICAgICAgIG9iai5TdGF0dXMgPSAwO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICB2YXIgcmVma2V5SW5kZXggPSBuYXZjb24uZ2V0SXRlbUluZGV4QnlQcm9wZXJ0eShmaWVsZHMsIGl0ZW0ucmVma2V5KTtcclxuICAgICAgICAgICAgICAgICAgICBpZiAocmVma2V5SW5kZXggIT09IHVuZGVmaW5lZCAmJiByZWZrZXlJbmRleCAhPT0gLTEpIG9ialtpdGVtLnJlZmtleV0gPSBmaWVsZHNbcmVma2V5SW5kZXhdLmRhdGE7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGlmIChtb2RlLnRvTG93ZXJDYXNlKCkgPT09IFwic2F2ZVwiIHx8IG1vZGUudG9Mb3dlckNhc2UoKSA9PT0gXCJzYXZlYXNcIikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBvYmouT2JqZWN0U3RhdGUgPSAxO1xyXG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG9iai5PYmplY3RTdGF0ZSA9IDE7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICAgICBpZiAob2JqLnZhbHVlID09PSB0cnVlKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoZXZlbnRkYXRhLnZhbHVlKSBsaXN0LnB1c2gob2JqKTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcblxyXG5cclxuICAgICAgICByZXR1cm4gbGlzdDtcclxuICAgIH07XHJcblxyXG4gICAgLyp2YXIgdHJlZURhdGFVcGRhdGUgPSBmdW5jdGlvbiAodHlwZSwgaWQsIG1vZGUpIHtcclxuICAgICAgICBnZXREYXRhRnJvbVRyZWUoaXRlbXMpXHJcbiAgICAgICAgcmV0dXJuIGdldFRyZWVEYXRhKHR5cGUsIGlkLCBtb2RlKTtcclxuICAgIH0qL1xyXG5cclxuICAgIHZhciBjbGVhckZpZWxkc0RhdGEgPSBmdW5jdGlvbiAoZmllbGRzLCAkc2NvcGUsIHVwbG9hZENsZWFyKSB7XHJcbiAgICAgICAgJC5tYXAoZmllbGRzLCBmdW5jdGlvbiAoaXRlbSwgaW5kZXgpIHtcclxuICAgICAgICAgICAgaWYgKGl0ZW0udHlwZS50b0xvd2VyQ2FzZSgpID09PSBcImZpbGV1cGxvYWRcIiB8fCBpdGVtLnR5cGUudG9Mb3dlckNhc2UoKSA9PT0gXCJwaG90b3VwbG9hZFwiKSB7XHJcbiAgICAgICAgICAgICAgICBpdGVtLmRhdGEgPSBbXTtcclxuICAgICAgICAgICAgICAgIGlmIChpdGVtLnR5cGUudG9Mb3dlckNhc2UoKSA9PT0gXCJmaWxldXBsb2FkXCIpIHtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgZWxlbSA9IGFuZ3VsYXIuZWxlbWVudChkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCdbbmctYXBwXScpKTtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgaW5qZWN0b3IgPSBlbGVtLmluamVjdG9yKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyICRyb290U2NvcGUgPSBpbmplY3Rvci5nZXQoJyRyb290U2NvcGUnKTtcclxuICAgICAgICAgICAgICAgICAgICBpZiAodXBsb2FkQ2xlYXIgIT09IHVuZGVmaW5lZCAmJiAhdXBsb2FkQ2xlYXIpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICRyb290U2NvcGUuJGJyb2FkY2FzdCgnRklMRVVQTE9BRC1DTEVBUicsIHRydWUsIGZhbHNlKTtcclxuICAgICAgICAgICAgICAgICAgICBlbHNlXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICRyb290U2NvcGUuJGJyb2FkY2FzdCgnRklMRVVQTE9BRC1DTEVBUicsIHRydWUsIHRydWUpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9IGVsc2UgaWYgKGl0ZW0udHlwZS50b0xvd2VyQ2FzZSgpID09PSBcImxhYmVsXCIgJiYgaXRlbS5hbHRlcm5hdGVUeXBlICE9IHVuZGVmaW5lZCAmJiBpdGVtLmFsdGVybmF0ZVR5cGUudG9Mb3dlckNhc2UoKSA9PT0gXCJsYXN0dXBkYXRlZFwiKSB7XHJcbiAgICAgICAgICAgICAgICBpdGVtLmRhdGEgPSBcIlwiO1xyXG4gICAgICAgICAgICAgICAgaXRlbS50ZW1wbGF0ZU9wdGlvbnMubGFiZWwgPSBcIlwiO1xyXG4gICAgICAgICAgICB9IGVsc2UgaWYgKGl0ZW0udHlwZS50b0xvd2VyQ2FzZSgpID09PSBcInJhdGluZ1wiKSB7XHJcbiAgICAgICAgICAgICAgICBpdGVtLmRhdGEgPSBcIjBcIjtcclxuICAgICAgICAgICAgfSBlbHNlIGlmIChpdGVtLnR5cGUudG9Mb3dlckNhc2UoKSA9PT0gXCJ0YWJsZWVkaXRvclwiKSB7XHJcblxyXG4gICAgICAgICAgICB9IGVsc2UgaWYgKGl0ZW0udHlwZS50b0xvd2VyQ2FzZSgpID09PSBcIm11bHRpc2VsZWN0Y2hlY2tib3hcIiB8fCBpdGVtLnR5cGUudG9Mb3dlckNhc2UoKSA9PT0gXCJrZW5kb211bHRpc2VsZWN0XCIgfHwgaXRlbS50eXBlLnRvTG93ZXJDYXNlKCkgPT09IFwia2VuZG9zZWxlY3RcIiB8fCBpdGVtLnR5cGUudG9Mb3dlckNhc2UoKSA9PT0gXCJrZW5kb2NvbWJvYm94XCIpIHtcclxuICAgICAgICAgICAgICAgIGl0ZW0uZGF0YSA9IFtdO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGVsc2UgaWYgKGl0ZW0udHlwZS50b0xvd2VyQ2FzZSgpID09PSBcImxhYmVsXCIgJiYgKGl0ZW0udGVtcGxhdGVPcHRpb25zID09PSB1bmRlZmluZWQgfHwgaXRlbS50ZW1wbGF0ZU9wdGlvbnMgPT09IG51bGwpKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoaXRlbS5PbGRkYXRhID09PSBudWxsKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaXRlbS5kYXRhID0gbnVsbDtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIGl0ZW0uZGF0YSA9IFwiMFwiO1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgfSBlbHNlIGlmICgoaXRlbS5kYXRhdHlwZSAhPT0gdW5kZWZpbmVkICYmIGl0ZW0uZGF0YXR5cGUgIT09IG51bGwgJiYgaXRlbS5kYXRhdHlwZSAhPT0gXCJcIiAmJiBpdGVtLmRhdGF0eXBlLnRvTG93ZXJDYXNlKCkgPT09IFwiaW50ZWdlclwiKSkge1xyXG4gICAgICAgICAgICAgICAgaXRlbS5kYXRhID0gXCJcIjtcclxuICAgICAgICAgICAgfSBlbHNlXHJcbiAgICAgICAgICAgICAgICBpdGVtLmRhdGEgPSBcIlwiO1xyXG5cclxuICAgICAgICAgICAgaXRlbS52YWxpZCA9IGZhbHNlO1xyXG5cclxuICAgICAgICAgICAgaWYgKGl0ZW0uZm9ybSAhPT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoaXRlbS5mb3JtW2l0ZW0ua2V5XSAhPT0gdW5kZWZpbmVkICYmIGl0ZW0uZm9ybVtpdGVtLmtleV0uJHNldFZhbGlkaXR5ICE9PSB1bmRlZmluZWQgJiYgdHlwZW9mIGl0ZW0uZm9ybVtpdGVtLmtleV0uJHNldFZhbGlkaXR5ID09PSBcImZ1bmN0aW9uXCIpXHJcbiAgICAgICAgICAgICAgICAgICAgaXRlbS5mb3JtW2l0ZW0ua2V5XS4kc2V0VmFsaWRpdHkoJ2lzRXhpc3QnLCB0cnVlKVxyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBpZiAoaXRlbS5vbGREYXRhICE9IHVuZGVmaW5lZCkge1xyXG4gICAgICAgICAgICAgICAgaXRlbS5vbGREYXRhID0gXCJcIjtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG4gICAgfTtcclxuXHJcbiAgICB2YXIgY2xlYXJUcmVlRGF0YSA9IGZ1bmN0aW9uICh0eXBlKSB7XHJcbiAgICAgICAgLy92YXIgY2hlY2tib3ggPSAkKFwibmF2Y29uLXRyZWVbdHlwZT0nXCIgKyB0eXBlICsgXCInXVwiKS5maW5kKCcuanN0cmVlJykuZmluZChcImlucHV0W3R5cGU9J2NoZWNrYm94J11cIik7XHJcbiAgICAgICAgdmFyIGNoZWNrYm94ID0gJChcIm5hdmNvbi10cmVlW3R5cGU9J1wiICsgdHlwZSArIFwiJ11cIikuZmluZCgnLmpzdHJlZScpLmZpbmQoXCJpbnB1dFt0eXBlPSdjaGVja2JveCddW2NoZWNrZWQ9J2NoZWNrZWQnXVwiKVxyXG4gICAgICAgICQoY2hlY2tib3gpLnJlbW92ZUF0dHIoXCJjaGVja2VkXCIpO1xyXG4gICAgfTtcclxuXHJcbiAgICB2YXIgdHJlZURhdGFSZWZyZXNoID0gZnVuY3Rpb24gKGRhdGEsIHR5cGUsIGNhbGxiYWNrKSB7XHJcbiAgICAgICAgdmFyIHRyZWUgPSAkKFwibmF2Y29uLXRyZWVbdHlwZT0nXCIgKyB0eXBlICsgXCInXVwiKS5maW5kKCcuanN0cmVlJykuZmluZChcImRpdltyb2xlPSd0cmVlJ11cIikuanN0cmVlKHRydWUpO1xyXG4gICAgICAgIGlmICh0cmVlLnNldHRpbmdzID09PSB1bmRlZmluZWQpIHJldHVybjtcclxuICAgICAgICB0cmVlLnNldHRpbmdzLmNvcmUuZGF0YSA9IGRhdGE7XHJcbiAgICAgICAgdHJlZS5yZWZyZXNoKCk7XHJcbiAgICAgICAgdHJlZS5yZWRyYXcodHJ1ZSk7XHJcbiAgICAgICAgaWYgKGNhbGxiYWNrICE9PSB1bmRlZmluZWQpXHJcbiAgICAgICAgICAgIGNhbGxiYWNrKGRhdGEpO1xyXG4gICAgfTtcclxuXHJcbiAgICB2YXIgZGVsZXRlRGF0YUxpc3QgPSBmdW5jdGlvbiAodGFibGVPcHRpb25zLCByb3cpIHtcclxuICAgICAgICBpZiAodGFibGVPcHRpb25zICE9PSB1bmRlZmluZWQgJiYgcm93ICE9PSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgICAgdGFibGVPcHRpb25zLmRhdGEuc3BsaWNlKHJvdywgMSk7XHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxuXHJcbiAgICB2YXIgY3JlYXRlVHJlZU5vZGUgPSBmdW5jdGlvbiAodHlwZSwgY3VycmVudE5vZGUsIG5ld05vZGUsIHBvc2l0aW9uKSB7XHJcbiAgICAgICAgdmFyIHRyZWUgPSAkKFwibmF2Y29uLXRyZWVbdHlwZT0nXCIgKyB0eXBlICsgXCInXVwiKS5maW5kKCcuanN0cmVlJykuZmluZChcImRpdltyb2xlPSd0cmVlJ11cIik7XHJcbiAgICAgICAgdHJlZS5qc3RyZWUoJ2NyZWF0ZV9ub2RlJywgY3VycmVudE5vZGUuaWQsIG5ld05vZGUsIHBvc2l0aW9uKTtcclxuICAgIH07XHJcblxyXG4gICAgdmFyIHJlbW92ZVRyZWVOb2RlID0gZnVuY3Rpb24gKHR5cGUsIGN1cnJlbnROb2RlLCB0cmVlU2V0dGluZ3MsIGhhc1BhcmVudFJlbW92ZSkge1xyXG4gICAgICAgIC8vLypiZWxvdyAyIGxpbmUgdXNlZCBmb3Igc2V0Vmlld0NvbnRlbnREaXNhYmxlZCBmdW5jdGlvbiwgZG9uJ3QgcmVtb3ZlKi9cclxuICAgICAgICAvL2lmIChzY29wZS5uYXZjb25EYXRhW3Njb3BlLmZpZWxkU2V0XSAhPT0gdW5kZWZpbmVkICYmIHNjb3BlLm5hdmNvbkRhdGFbc2NvcGUuZmllbGRTZXRdLm1vZGUgIT09IHVuZGVmaW5lZClcclxuICAgICAgICAvLyAgICBzY29wZS5uYXZjb25EYXRhW3Njb3BlLmZpZWxkU2V0XS5tb2RlID0gXCJcIjtcclxuXHJcbiAgICAgICAgLypzZWxlY3RlZCBub2RlIHJlbW92ZSovXHJcbiAgICAgICAgdmFyIHRyZWUgPSAkKFwibmF2Y29uLXRyZWVbdHlwZT0nXCIgKyB0eXBlICsgXCInXVwiKS5maW5kKCcuanN0cmVlJykuZmluZChcImRpdltyb2xlPSd0cmVlJ11cIik7XHJcbiAgICAgICAgdHJlZS5qc3RyZWUoKS5kZWxldGVfbm9kZSgkKCcjJyArIGN1cnJlbnROb2RlLmlkKSk7XHJcblxyXG4gICAgICAgIHZhciBwYXJlbnRSZW1vdmUgPSBmYWxzZTtcclxuICAgICAgICBpZiAoaGFzUGFyZW50UmVtb3ZlICE9PSB1bmRlZmluZWQgJiYgaGFzUGFyZW50UmVtb3ZlICE9PSBudWxsICYmIGhhc1BhcmVudFJlbW92ZSAhPT0gXCJcIilcclxuICAgICAgICAgICAgcGFyZW50UmVtb3ZlID0gaGFzUGFyZW50UmVtb3ZlO1xyXG4gICAgICAgIGVsc2VcclxuICAgICAgICAgICAgcGFyZW50UmVtb3ZlID0gY3VycmVudE5vZGUucGFyZW50ICE9PSBcIiNcIiA/IHRydWUgOiBmYWxzZTtcclxuXHJcbiAgICAgICAgLypQYXJlbnQgbm9kZSByZW1vdmUqL1xyXG4gICAgICAgIGlmIChwYXJlbnRSZW1vdmUpIHtcclxuICAgICAgICAgICAgdmFyIHBhcmVudE5vZGUgPSB0cmVlLmpzdHJlZSgpLmdldF9ub2RlKGN1cnJlbnROb2RlLnBhcmVudCk7XHJcbiAgICAgICAgICAgIGlmIChwYXJlbnROb2RlLmNoaWxkcmVuLmxlbmd0aCA9PT0gMCkge1xyXG4gICAgICAgICAgICAgICAgcmVtb3ZlVHJlZU5vZGUodHlwZSwgcGFyZW50Tm9kZSwgdHJlZVNldHRpbmdzLCBoYXNQYXJlbnRSZW1vdmUpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvKmN1cnJlbnQgbm9kZSB0cmVlc2V0dGluZyByZWJpbmQqL1xyXG4gICAgICAgIHZhciBqc0luc3RhbmNlID0gdHJlZS5qc3RyZWUodHJ1ZSk7XHJcbiAgICAgICAgaWYgKGpzSW5zdGFuY2UgIT09IHVuZGVmaW5lZCAmJiBqc0luc3RhbmNlICE9PSBudWxsKSB7XHJcbiAgICAgICAgICAgIC8vdHJlZSBkYXRhIHZhbHVlIHJlbW92ZVxyXG4gICAgICAgICAgICBpZiAodHJlZVNldHRpbmdzICE9PSB1bmRlZmluZWQgJiYgdHJlZVNldHRpbmdzICE9PSBcIlwiKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgY2hlY2tkYXRhID0gYW5ndWxhci5jb3B5KHRyZWVTZXR0aW5ncy5jb3JlLmRhdGEpO1xyXG4gICAgICAgICAgICAgICAgaWYgKGNoZWNrZGF0YSAhPT0gdW5kZWZpbmVkICYmIGNoZWNrZGF0YSAhPT0gXCJcIikge1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBkYXRhID0gZGVsZXRlVHJlZVZhbHVlQnlOb2RlKGNoZWNrZGF0YSwgY3VycmVudE5vZGVbXCJpZFwiXSk7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHR5cGVvZiBkYXRhID09PSBcIm9iamVjdFwiKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciByZXR1cm5EYXRhID0gcmVvcmRlclRyZWVEYXRhKGRhdGEpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0cmVlU2V0dGluZ3MuY29yZS5kYXRhID0gW107XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRyZWVTZXR0aW5ncy5jb3JlLmRhdGEgPSBhbmd1bGFyLmNvcHkocmV0dXJuRGF0YSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIGVsc2VcclxuICAgICAgICAgICAgICAgICAgICAgICAgdHJlZVNldHRpbmdzLmNvcmUuZGF0YS5zcGxpY2UoZGF0YSwgMSk7XHJcbiAgICAgICAgICAgICAgICAgICAganNJbnN0YW5jZS5zZXR0aW5ncy5jb3JlLmRhdGEgPSB0cmVlU2V0dGluZ3MuY29yZS5kYXRhO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxuXHJcbiAgICB2YXIgZGVsZXRlVHJlZVZhbHVlQnlOb2RlID0gZnVuY3Rpb24gKGl0ZW1zLCB0YXJnZXRWYWx1ZSkge1xyXG4gICAgICAgIHZhciByZXRWYWwgPSAwO1xyXG4gICAgICAgIGlmICh0YXJnZXRWYWx1ZSAhPT0gdW5kZWZpbmVkIHx8IHRhcmdldFZhbHVlICE9PSBcIlwiKSB7XHJcbiAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgaXRlbXMubGVuZ3RoOyBpKyspIHtcclxuICAgICAgICAgICAgICAgIGlmICghJC5pc0VtcHR5T2JqZWN0KGl0ZW1zW2ldKSkge1xyXG4gICAgICAgICAgICAgICAgICAgIC8qaWYgKGl0ZW1zW2ldLmlkID09PSB1bmRlZmluZWQgfHwgaXRlbXNbaV0uaWQgPT09IG51bGwpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGl0ZW1zW2ldLmlkID0gaXRlbXNbaV0uQ29tbW9uSWQ7Ki9cclxuICAgICAgICAgICAgICAgICAgICBpZiAoaXRlbXNbaV0uaWQudG9TdHJpbmcoKSA9PT0gdGFyZ2V0VmFsdWUudG9TdHJpbmcoKSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBkZWxldGUgaXRlbXNbaV07XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBpZiAoaXRlbXNbaV0uY2hpbGRyZW4gIT09IHVuZGVmaW5lZCAmJiBpdGVtc1tpXS5jaGlsZHJlbiAhPT0gbnVsbCAmJiBpdGVtc1tpXS5jaGlsZHJlbi5sZW5ndGggPiAwKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBmb3VuZCA9IGRlbGV0ZVRyZWVWYWx1ZUJ5Tm9kZShpdGVtc1tpXS5jaGlsZHJlbiwgdGFyZ2V0VmFsdWUpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoKGZvdW5kICE9PSB1bmRlZmluZWQpICYmICh0eXBlb2YgZm91bmQgIT09IFwib2JqZWN0XCIpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXRWYWwgPSAxO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIGl0ZW1zO1xyXG4gICAgfTtcclxuXHJcbiAgICB2YXIgcmVvcmRlclRyZWVEYXRhID0gZnVuY3Rpb24gKGRhdGEpIHtcclxuICAgICAgICB2YXIgY2hpbGREYXRhID0gW107XHJcbiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBkYXRhLmxlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgICAgIGlmIChkYXRhW2ldICE9PSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgICAgICAgIHZhciBjdXJyZW50RGF0YSA9IGFuZ3VsYXIuY29weShkYXRhW2ldKTtcclxuICAgICAgICAgICAgICAgIGN1cnJlbnREYXRhLmNoaWxkcmVuID0ge307XHJcblxyXG4gICAgICAgICAgICAgICAgY2hpbGREYXRhLnB1c2goY3VycmVudERhdGEpO1xyXG5cclxuICAgICAgICAgICAgICAgIGlmIChkYXRhW2ldLmNoaWxkcmVuICE9PSB1bmRlZmluZWQgJiYgZGF0YVtpXS5jaGlsZHJlbiAhPT0gbnVsbCAmJiBkYXRhW2ldLmNoaWxkcmVuLmxlbmd0aCA+IDApIHtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgcmV0dXJuVmFsID0gcmVvcmRlclRyZWVEYXRhKGRhdGFbaV0uY2hpbGRyZW4pO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChyZXR1cm5WYWwgIT0gdW5kZWZpbmVkICYmIHJldHVyblZhbC5sZW5ndGggPiAwKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBjaGlsZExvb3AgPSBjaGlsZERhdGEubGVuZ3RoIC0gMTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY2hpbGREYXRhW2NoaWxkTG9vcF0uY2hpbGRyZW4gPSByZXR1cm5WYWw7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICByZXR1cm4gY2hpbGREYXRhO1xyXG4gICAgfTtcclxuXHJcbiAgICB2YXIgZ2V0VHJlZURhdGFCeUlkID0gZnVuY3Rpb24gKHRyZWVEYXRhLCBwYXJlbnRJZCwgbm9kZVR5cGUpIHtcclxuICAgICAgICAvL3ZhciBnZXRUcmVlRGF0YSA9IFtdO1xyXG4gICAgICAgIHZhciBnZXREYXRhQ29sbGVjdCA9IFtdO1xyXG4gICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdHJlZURhdGEubGVuZ3RoOyBpKyspIHtcclxuICAgICAgICAgICAgdmFyIGl0ZW0gPSBhbmd1bGFyLmNvcHkodHJlZURhdGFbaV0pO1xyXG4gICAgICAgICAgICBpZiAoaXRlbS5pZCAhPT0gdW5kZWZpbmVkICYmIGl0ZW0uaWQgIT09IG51bGwgJiYgKGl0ZW0uaWQgPT09IHBhcmVudElkIHx8IGl0ZW0uaWQudG9TdHJpbmcoKSA9PT0gcGFyZW50SWQudG9TdHJpbmcoKSkpIHtcclxuICAgICAgICAgICAgICAgIGlmIChub2RlVHlwZSAhPT0gdW5kZWZpbmVkICYmIChub2RlVHlwZS50b0xvd2VyQ2FzZSgpID09PSBcImNoaWxkXCIgfHwgbm9kZVR5cGUudG9Mb3dlckNhc2UoKSA9PT0gXCJjaGlsZHJlblwiKSlcclxuICAgICAgICAgICAgICAgICAgICBnZXREYXRhQ29sbGVjdCA9IGl0ZW0uY2hpbGRyZW47XHJcbiAgICAgICAgICAgICAgICBlbHNlXHJcbiAgICAgICAgICAgICAgICAgICAgZ2V0RGF0YUNvbGxlY3QucHVzaChpdGVtKTtcclxuXHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIGlmIChpdGVtLmNoaWxkcmVuICE9PSB1bmRlZmluZWQgJiYgaXRlbS5jaGlsZHJlbiAhPT0gbnVsbCAmJiBpdGVtLmNoaWxkcmVuLmxlbmd0aCA+IDApIHtcclxuICAgICAgICAgICAgICAgICAgICBnZXREYXRhQ29sbGVjdCA9IGdldFRyZWVEYXRhQnlJZChpdGVtLmNoaWxkcmVuLCBwYXJlbnRJZCwgbm9kZVR5cGUpO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChnZXREYXRhQ29sbGVjdC5sZW5ndGggPiAwKSBicmVhaztcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcmV0dXJuIGdldERhdGFDb2xsZWN0O1xyXG4gICAgfTtcclxuXHJcbiAgICB2YXIgZWRpdFRyZWVOb2RlID0gZnVuY3Rpb24gKHR5cGUsIGN1cnJlbnROb2RlLCB0ZXh0KSB7XHJcbiAgICAgICAgdmFyIHRyZWUgPSAkKFwibmF2Y29uLXRyZWVbdHlwZT0nXCIgKyB0eXBlICsgXCInXVwiKS5maW5kKCcuanN0cmVlJykuZmluZChcImRpdltyb2xlPSd0cmVlJ11cIik7XHJcbiAgICAgICAgdHJlZS5qc3RyZWUoKS5yZW5hbWVfbm9kZShjdXJyZW50Tm9kZSwgdGV4dCk7XHJcbiAgICB9O1xyXG5cclxuICAgIHZhciB1cGRhdGVUcmVlU2luZ2xlRGF0YSA9IGZ1bmN0aW9uICh0eXBlLCBjdXJyZW50Tm9kZSwgY29sdW1uTmFtZSwgdGV4dCwgY29sdW1uTm8sIGNvbnRyb2xUeXBlKSB7XHJcbiAgICAgICAgdmFyIHRyZWUgPSAkKFwibmF2Y29uLXRyZWVbdHlwZT0nXCIgKyB0eXBlICsgXCInXVwiKS5maW5kKCcuanN0cmVlJykuZmluZChcImRpdltyb2xlPSd0cmVlJ11cIik7XHJcbiAgICAgICAgdmFyIG5vZGVJZDtcclxuICAgICAgICBpZiAoY3VycmVudE5vZGUuZGF0YS5pZCAhPT0gdW5kZWZpbmVkICYmIGN1cnJlbnROb2RlLmRhdGEuaWQgIT09IG51bGwpXHJcbiAgICAgICAgICAgIG5vZGVJZCA9IChjdXJyZW50Tm9kZS5kYXRhLmlkIHx8IGN1cnJlbnROb2RlLmRhdGEuSWQpO1xyXG4gICAgICAgIGVsc2VcclxuICAgICAgICAgICAgbm9kZUlkID0gKGN1cnJlbnROb2RlLmlkIHx8IGN1cnJlbnROb2RlLklkKTtcclxuXHJcbiAgICAgICAgdmFyIHBhcmVudE5vZGUgPSB0cmVlLmpzdHJlZSgpLmdldF9ub2RlKG5vZGVJZCk7XHJcbiAgICAgICAgcGFyZW50Tm9kZS5kYXRhW2NvbHVtbk5hbWVdID0gdGV4dDtcclxuXHJcbiAgICAgICAgaWYgKGNvbHVtbk5vID09PSB1bmRlZmluZWQgfHwgY29sdW1uTm8gPT09IG51bGwgfHwgY29sdW1uTm8gPT09IFwiXCIpIGNvbHVtbk5vID0gMTtcclxuICAgICAgICB2YXIgZ2V0Q29sdW1uID0gJCh0cmVlKS5wYXJlbnQoKS5wYXJlbnQoKS5maW5kKFwiZGl2W2lkPSdqc2dyaWRfXCIgKyBub2RlSWQgKyBcIl9jb2xcIiArIGNvbHVtbk5vICsgXCInXVwiKTtcclxuICAgICAgICBpZiAoZ2V0Q29sdW1uICE9PSB1bmRlZmluZWQgJiYgZ2V0Q29sdW1uLmNoaWxkcmVuLmxlbmd0aCAhPT0gMCkge1xyXG4gICAgICAgICAgICBpZiAoY29udHJvbFR5cGUgIT09IHVuZGVmaW5lZCAmJiBjb250cm9sVHlwZSAhPT0gbnVsbCAmJiBjb250cm9sVHlwZSAhPT0gXCJcIikge1xyXG4gICAgICAgICAgICAgICAgdmFyIGdldEN0cmwgPSAkKGdldENvbHVtbi5jaGlsZHJlbigpLmZpbmQoY29udHJvbFR5cGUpKTtcclxuICAgICAgICAgICAgICAgIGlmIChnZXRDdHJsICE9PSB1bmRlZmluZWQpXHJcbiAgICAgICAgICAgICAgICAgICAgZ2V0Q3RybC52YWwodGV4dCk7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAkKGdldENvbHVtbi5jaGlsZHJlbigpWzBdKS5odG1sKHRleHQpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxuXHJcbiAgICB2YXIgZGF0ZUNvbnZlcnQgPSBmdW5jdGlvbiAoZGF0ZSwgaXNVVEMsIGZvcm1hdCkge1xyXG4gICAgICAgIHZhciByZXR1cm5EYXRhID0gXCJcIjtcclxuXHJcbiAgICAgICAgaWYgKGZvcm1hdCA9PT0gdW5kZWZpbmVkIHx8IGZvcm1hdCA9PT0gXCJcIikgZm9ybWF0ID0gXCJZWVlZLU1NLUREIEhIOm1tOnNzXCI7XHJcbiAgICAgICAgaWYgKGlzVVRDID09PSB1bmRlZmluZWQgfHwgaXNVVEMgPT09IFwiXCIpIGlzVVRDID0gdHJ1ZTtcclxuXHJcbiAgICAgICAgaWYgKGlzVVRDKSB7XHJcbiAgICAgICAgICAgIHJldHVybkRhdGEgPSBtb21lbnQudXRjKGRhdGUpLmZvcm1hdChmb3JtYXQpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgdmFyIGxvY2FsVGltZSA9IG1vbWVudC51dGMoZGF0ZSkudG9EYXRlKCk7XHJcbiAgICAgICAgICAgIHJldHVybkRhdGEgPSBtb21lbnQobG9jYWxUaW1lKS5mb3JtYXQoZm9ybWF0KTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHJldHVybiByZXR1cm5EYXRhO1xyXG4gICAgfTtcclxuXHJcbiAgICB2YXIgZGF0ZVRvVVRDID0gZnVuY3Rpb24gKGRhdGUsIGZvcm1hdCkge1xyXG4gICAgICAgIHZhciBmb3JtYXQgPSBmb3JtYXQgfHwgXCJERC9NTS9ZWVlZXCI7XHJcbiAgICAgICAgaWYgKGRhdGUgIT09IHVuZGVmaW5lZCAmJiBkYXRlICE9PSBcIlwiKVxyXG4gICAgICAgICAgICByZXR1cm4gbW9tZW50KGRhdGUsIGZvcm1hdCkudXRjKCkuZm9ybWF0KFwiWVlZWS1NTS1ERCBISDptbTpzc1wiKTtcclxuICAgICAgICBlbHNlXHJcbiAgICAgICAgICAgIHJldHVybiBudWxsO1xyXG4gICAgfTtcclxuXHJcbiAgICB2YXIgZGF0ZUZyb21VVENUb0xvY2FsID0gZnVuY3Rpb24gKGRhdGUsIGZvcm1hdCkge1xyXG4gICAgICAgIHZhciBmb3JtYXQgPSBmb3JtYXQgfHwgXCJERC9NTS9ZWVlZXCI7XHJcbiAgICAgICAgdmFyIGxvY2FsVGltZSA9IG1vbWVudC51dGMoZGF0ZSkudG9EYXRlKCk7XHJcbiAgICAgICAgcmV0dXJuIG1vbWVudChsb2NhbFRpbWUpLmZvcm1hdChmb3JtYXQpO1xyXG4gICAgfTtcclxuXHJcbiAgICB2YXIgZGF0ZUZvcm1hdCA9IGZ1bmN0aW9uIChkYXRlLCBmb3JtYXQpIHtcclxuICAgICAgICB2YXIgZm9ybWF0ID0gZm9ybWF0IHx8IFwiREQvTU0vWVlZWVwiO1xyXG4gICAgICAgIHJldHVybiBtb21lbnQoZGF0ZSwgZm9ybWF0KTtcclxuICAgIH07XHJcblxyXG4gICAgdmFyIGdldEN1cnJlbnREYXRlID0gZnVuY3Rpb24gKGZvcm1hdCkge1xyXG4gICAgICAgIHJldHVybiBcIkRhdGU6IFwiICsgbW9tZW50KCkuZm9ybWF0KGZvcm1hdCB8fCBcIkRELU1NLVlZWVlcIik7XHJcbiAgICB9XHJcblxyXG4gICAgdmFyIGluc2VydENvbnRyb2wgPSBmdW5jdGlvbiAodHlwZSwgZGF0YSkge1xyXG4gICAgICAgIHZhciB2YWx1ZU9iaiA9IFwiXCI7XHJcbiAgICAgICAgaWYgKGRhdGEudG9TdHJpbmcoKS5pbmRleE9mKCc8aW5wdXQnKSAhPT0gLTEpIHJldHVybiBkYXRhO1xyXG4gICAgICAgIGlmICh0eXBlID09PSBcImNoZWNrYm94XCIpIHtcclxuICAgICAgICAgICAgdmFsdWVPYmogPSBcIjxpbnB1dCB0eXBlPSdjaGVja2JveCc+XCI7XHJcbiAgICAgICAgICAgIGlmIChkYXRhID09PSAxIHx8IGRhdGEgPT09IHRydWUgfHwgZGF0YSA9PT0gXCIxXCIpXHJcbiAgICAgICAgICAgICAgICAkKHZhbHVlT2JqKS5hdHRyKFwiY2hlY2tlZFwiLCBcImNoZWNrZWRcIik7XHJcbiAgICAgICAgICAgIGVsc2VcclxuICAgICAgICAgICAgICAgICQodmFsdWVPYmopLnJlbW92ZUF0dHIoXCJjaGVja2VkXCIpO1xyXG4gICAgICAgIH0gZWxzZSBpZiAodHlwZSA9PT0gXCJ0ZXh0XCIpIHtcclxuICAgICAgICAgICAgdmFsdWVPYmogPSBcIjxpbnB1dCB0eXBlPSd0ZXh0JyB2YWx1ZT0nXCIgKyBkYXRhLnRvU3RyaW5nKCkgKyBcIicgc3R5bGU9J3dpZHRoOiA1MHB4JyBtYXhsZW5ndGg9JzUnPlwiO1xyXG4gICAgICAgIH1cclxuICAgICAgICB2YXIgaHRtbCA9ICQodmFsdWVPYmopLnByb3AoJ291dGVySFRNTCcpO1xyXG4gICAgICAgIGlmIChodG1sID09PSB1bmRlZmluZWQpIHJldHVybiBkYXRhO1xyXG4gICAgICAgIHJldHVybiBodG1sLnJlcGxhY2UoL1wiL2dpLCBcIidcIik7XHJcbiAgICB9O1xyXG5cclxuICAgIHZhciBsb2FkRGF0YSA9IGZ1bmN0aW9uIChub2RlLCBvYmopIHtcclxuICAgICAgICB2YXIgdmFsdWUgPSBub2RlLmRhdGFbb2JqLmZpZWxkXTtcclxuICAgICAgICB2YXIgZmllbGRUeXBlID0gb2JqLmZpZWxkVHlwZSB8fCAnJztcclxuICAgICAgICB2YXIgcGFyZW50ID0gb2JqLnBhcmVudCB8fCBmYWxzZTtcclxuICAgICAgICBpZiAobm9kZS5jaGlsZHJlbiAhPT0gdW5kZWZpbmVkICYmIG5vZGUuY2hpbGRyZW4ubGVuZ3RoID4gMCAmJiBmaWVsZFR5cGUgIT09IHVuZGVmaW5lZCAmJiBmaWVsZFR5cGUgIT09ICcnICYmIHBhcmVudCA9PT0gZmFsc2UpXHJcbiAgICAgICAgICAgIHJldHVybiBcIlwiO1xyXG5cclxuICAgICAgICB2YXIgdmFsdWVPYmogPSBcIlwiO1xyXG4gICAgICAgIGlmIChmaWVsZFR5cGUgPT09IFwiY2hlY2tib3hcIikge1xyXG4gICAgICAgICAgICBpZiAodmFsdWUgPT09IDEgfHwgdmFsdWUgPT09IHRydWUgfHwgdmFsdWUgPT09IFwiMVwiICYmIHZhbHVlICE9PSBudWxsKSB7XHJcbiAgICAgICAgICAgICAgICB2YWx1ZU9iaiA9IFwiPGRpdiBzdHlsZSA9ICd0ZXh0LWFsaWduOmNlbnRlcjsnPjxpbnB1dCB0eXBlPSdjaGVja2JveCcgY2hlY2tlZD0nY2hlY2tlZCc+PC9kaXY+XCI7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICB2YWx1ZU9iaiA9IFwiPGRpdiBzdHlsZT0ndGV4dC1hbGlnbjpjZW50ZXI7Jz48aW5wdXQgdHlwZT0nY2hlY2tib3gnPjwvZGl2PlwiO1xyXG4gICAgICAgICAgICAgICAgLy9kZWZhdWx0IGRhdGEgYXNzaWduXHJcbiAgICAgICAgICAgICAgICBpZiAoKHZhbHVlID09PSAwIHx8IHZhbHVlID09PSBcIjBcIiB8fCB2YWx1ZSA9PT0gXCJcIiB8fCB2YWx1ZSA9PT0gdW5kZWZpbmVkKSkgbm9kZS5kYXRhW29iai5maWVsZF0gPSAwO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAvL2RlZmF1bHQgZGF0YSBhc3NpZ25cclxuICAgICAgICAgICAgaWYgKHNlbGYuc2NvcGUubmF2Y29uRGF0YSAhPT0gdW5kZWZpbmVkICYmIHNlbGYuc2NvcGUubmF2Y29uRGF0YS50cmVlQ2VsbENsaWNrICE9PSB1bmRlZmluZWQpXHJcbiAgICAgICAgICAgICAgICBzZWxmLnNjb3BlLm5hdmNvbkRhdGEudHJlZUNlbGxDbGljayhub2RlLmlkLCBvYmouZmllbGQsIHZhbHVlICE9PSB1bmRlZmluZWQgJiYgdmFsdWUgIT09IG51bGwgPyB2YWx1ZSA6IDAsIG5vZGUsIG51bGwsICQodGhpcykpO1xyXG5cclxuICAgICAgICB9IGVsc2UgaWYgKGZpZWxkVHlwZSA9PT0gXCJ0ZXh0XCIpIHtcclxuICAgICAgICAgICAgaWYgKG9iai5mb3JtYXQgIT09IHVuZGVmaW5lZCAmJiBvYmouZm9ybWF0LnRvTG93ZXJDYXNlKCkgPT09IFwiZGF0ZVwiICYmIHZhbHVlICE9PSBcIlwiKVxyXG4gICAgICAgICAgICAgICAgdmFsdWUgPSBkYXRlRnJvbVVUQ1RvTG9jYWwodmFsdWUudG9TdHJpbmcoKSk7XHJcbiAgICAgICAgICAgIHZhbHVlT2JqID0gXCI8ZGl2IHN0eWxlPSd0ZXh0LWFsaWduOmNlbnRlcjsnPjxpbnB1dCB0eXBlPSd0ZXh0JyB2YWx1ZT0nXCIgKyB2YWx1ZS50b1N0cmluZygpICsgXCInPjwvZGl2PlwiO1xyXG4gICAgICAgIH0gZWxzZSBpZiAoZmllbGRUeXBlID09PSBcInRleHRhcmVhXCIpIHtcclxuICAgICAgICAgICAgaWYgKG9iai5mb3JtYXQgIT09IHVuZGVmaW5lZCAmJiBvYmouZm9ybWF0LnRvTG93ZXJDYXNlKCkgPT09IFwiZGF0ZVwiICYmIHZhbHVlICE9PSBcIlwiKVxyXG4gICAgICAgICAgICAgICAgdmFsdWUgPSBkYXRlRnJvbVVUQ1RvTG9jYWwodmFsdWUudG9TdHJpbmcoKSk7XHJcbiAgICAgICAgICAgIHZhbHVlT2JqID0gXCI8ZGl2Pjx0ZXh0YXJlYSBzdHlsZT0nd2lkdGg6IDk2JTsgaGVpZ2h0OiAzM3B4Oyc+XCIgKyB2YWx1ZS50b1N0cmluZygpICsgXCI8L3RleHRhcmVhPjxkaXYgdHlwZT0ndmFsaWRSZXF1aXJlZEluZGljYXRlJyB0aXRsZT0nUmVxdWlyZWQnIHN0eWxlPSdjb2xvcjogcmVkOyBmb250LXNpemU6MTVwdDsgZGlzcGxheTogbm9uZTsnPio8L2Rpdj48L2Rpdj5cIjtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSBpZiAoZmllbGRUeXBlID09PSBcInNlbGVjdFwiKSB7XHJcbiAgICAgICAgICAgIHZhciBkYXRhID0gbm9kZS5kYXRhLk9wdGlvbkRhdGE7XHJcbiAgICAgICAgICAgIHZhciBvcHRpb25EYXRhID0gXCJcIjtcclxuICAgICAgICAgICAgZm9yICh2YXIgaUxvb3AgPSAwOyBpTG9vcCA8IGRhdGEubGVuZ3RoOyBpTG9vcCsrKSB7XHJcbiAgICAgICAgICAgICAgICBvcHRpb25EYXRhICs9IFwiPG9wdGlvbiB2YWx1ZT0nXCIgKyBkYXRhW2lMb29wXS5pZCArIFwiJz5cIiArIGRhdGFbaUxvb3BdLnRleHQgKyBcIjwvb3B0aW9uPlwiO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIC8vZGVmYXVsdCBkYXRhIGFzc2lnblxyXG4gICAgICAgICAgICBpZiAoZGF0YS5sZW5ndGggPiAwICYmICh2YWx1ZSA9PT0gMCB8fCB2YWx1ZSA9PT0gXCIwXCIgfHwgdmFsdWUgPT09IFwiXCIgfHwgdmFsdWUgPT09IHVuZGVmaW5lZCkpIHtcclxuICAgICAgICAgICAgICAgIGlmIChzZWxmLnNjb3BlLm5hdmNvbkRhdGEgIT09IHVuZGVmaW5lZCAmJiBzZWxmLnNjb3BlLm5hdmNvbkRhdGEudHJlZUNlbGxDbGljayAhPT0gdW5kZWZpbmVkKVxyXG4gICAgICAgICAgICAgICAgICAgIHNlbGYuc2NvcGUubmF2Y29uRGF0YS50cmVlQ2VsbENsaWNrKG5vZGUuaWQsIG9iai5maWVsZCwgZGF0YVswXS5pZCwgbm9kZSwgbnVsbCwgJCh0aGlzKSk7XHJcblxyXG4gICAgICAgICAgICAgICAgbm9kZS5kYXRhW29iai5maWVsZF0gPSBkYXRhWzBdLmlkO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHZhbHVlT2JqID0gXCI8c2VsZWN0IHNpemU9XFxcIjFcXFwiIGV4cGFuZHRvPVxcXCI1XFxcIiBjbGFzcz1cXFwic2VsZWN0cGlja2VyXFxcIiBzdHlsZT0ncG9zaXRpb246Zml4ZWQ7IHdpZHRoOiAxNTBweDsnPlwiICsgb3B0aW9uRGF0YSArIFwiPC9zZWxlY3Q+XCI7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2UgaWYgKGZpZWxkVHlwZSA9PT0gXCJkZWxldGVcIikge1xyXG4gICAgICAgICAgICB2YWx1ZU9iaiA9IFwiPGRpdiBzdHlsZSA9ICd0ZXh0LWFsaWduOmNlbnRlcjsnPjxhIGNsYXNzPSdmbG9hdC1jZW50ZXIgZGVsZXRlIGJ0biBkZWZhdWx0IGJ0bi14cyB0cmVlYnRuJyBocmVmPSdqYXZhc2NyaXB0OjsnIGRhdGEtdGFyZ2V0PScjZGVsZXRlY29uZm9ybScgZGF0YS10b2dnbGU9J21vZGFsJz5cXFxyXG4gICAgICAgICAgICAgICAgICAgICAgICA8aSBjbGFzcz0nZmEgZmEtdHJhc2gtbyc+PC9pPiA8L2E+PC9kaXY+XCI7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2UgaWYgKGZpZWxkVHlwZSA9PT0gXCJhbmNob3JcIikge1xyXG4gICAgICAgICAgICB2YWx1ZU9iaiA9IFwiPGRpdiBzdHlsZT0ndGV4dC1hbGlnbjpjZW50ZXI7Jz48YSAgaHJlZj0namF2YXNjcmlwdDo7JyBjbGFzcz0nbWFuZGF0b3J5Jz5cIiArIHZhbHVlLnRvU3RyaW5nKCkgKyBcIjwvYT48L2Rpdj5cIjtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICBpZiAob2JqLmZvcm1hdCAhPT0gdW5kZWZpbmVkICYmIG9iai5mb3JtYXQudG9Mb3dlckNhc2UoKSA9PT0gXCJkYXRlXCIgJiYgdmFsdWUgIT09IFwiXCIgJiYgdmFsdWUgIT09IG51bGwpXHJcbiAgICAgICAgICAgICAgICB2YWx1ZU9iaiA9IGRhdGVGcm9tVVRDVG9Mb2NhbCh2YWx1ZSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICByZXR1cm4gdmFsdWVPYmo7XHJcbiAgICB9O1xyXG5cclxuICAgIHZhciBsb2FkVGFibGVEYXRhID0gZnVuY3Rpb24gKG5vZGUsIGZpZWxkLCBmaWVsZFR5cGUpIHtcclxuICAgICAgICB2YXIgdmFsdWUgPSBub2RlW2ZpZWxkXTtcclxuICAgICAgICAvL3ZhciBmaWVsZFR5cGUgPSBvYmouZmllbGRUeXBlO1xyXG4gICAgICAgIGlmIChub2RlLmNoaWxkcmVuICE9PSB1bmRlZmluZWQgJiYgbm9kZS5jaGlsZHJlbi5sZW5ndGggPiAwKVxyXG4gICAgICAgICAgICByZXR1cm4gXCJcIjtcclxuICAgICAgICB2YXIgdmFsdWVPYmogPSBcIlwiO1xyXG4gICAgICAgIGlmIChmaWVsZFR5cGUgPT09IFwiY2hlY2tib3hcIikge1xyXG4gICAgICAgICAgICBpZiAodmFsdWUgPT09IDEgfHwgdmFsdWUgPT09IHRydWUgfHwgdmFsdWUgPT09IFwiMVwiKVxyXG4gICAgICAgICAgICAgICAgdmFsdWVPYmogPSBcIjxpbnB1dCB0eXBlPSdjaGVja2JveCcgY2hlY2tlZD0nY2hlY2tlZCc+XCI7XHJcbiAgICAgICAgICAgIGVsc2VcclxuICAgICAgICAgICAgICAgIHZhbHVlT2JqID0gXCI8aW5wdXQgdHlwZT0nY2hlY2tib3gnPlwiO1xyXG5cclxuICAgICAgICAgICAgbm9kZVtcIkNoZWNrX0ZpZWxkXCJdID0gZmllbGQ7XHJcbiAgICAgICAgICAgIG5vZGVbZmllbGRdID0gbm9kZVtcIlJvd19DaGVja2VkXCJdICE9PSB1bmRlZmluZWQgJiYgbm9kZVtcIlJvd19DaGVja2VkXCJdICE9PSBudWxsID8gbm9kZVtcIlJvd19DaGVja2VkXCJdIDogdmFsdWU7XHJcbiAgICAgICAgfSBlbHNlIGlmIChmaWVsZFR5cGUgPT09IFwidGV4dFwiKSB7XHJcbiAgICAgICAgICAgIHZhbHVlT2JqID0gXCI8aW5wdXQgdHlwZT0ndGV4dCcgdmFsdWU9J1wiICsgdmFsdWUudG9TdHJpbmcoKSArIFwiJz5cIjtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSBpZiAoZmllbGRUeXBlID09PSBcImFuY2hvclwiKSB7XHJcbiAgICAgICAgICAgIHZhbHVlT2JqID0gXCI8ZGl2IHN0eWxlID0gJ3RleHQtYWxpZ246Y2VudGVyOyc+PGEgIGhyZWY9J2phdmFzY3JpcHQ6OycgY2xhc3M9J21hbmRhdG9yeSc+XCIgKyB2YWx1ZS50b1N0cmluZygpICsgXCI8L2E+PC9kaXY+XCI7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiB2YWx1ZU9iajtcclxuICAgIH07XHJcblxyXG4gICAgdmFyIGpzb25UcmFuc2Zvcm1lZCA9IGZ1bmN0aW9uIChkYXRhKSB7XHJcblxyXG4gICAgICAgIGlmIChkYXRhICE9PSB1bmRlZmluZWQgJiYgZGF0YSAhPT0gbnVsbCkge1xyXG4gICAgICAgICAgICB2YXIganNvblRleHQgPSBKU09OLnN0cmluZ2lmeShkYXRhKTtcclxuICAgICAgICAgICAgZGF0YSA9IGZ1bmN0aW9uQ29udmVydChqc29uVGV4dCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICByZXR1cm4gZGF0YTtcclxuXHJcbiAgICAgICAgZnVuY3Rpb24gZnVuY3Rpb25Db252ZXJ0KGpzb25UZXh0KSB7XHJcbiAgICAgICAgICAgIHZhciBqc29uRmluYWwgPSBKU09OLnBhcnNlKGpzb25UZXh0LCBmdW5jdGlvbiAoa2V5LCB2YWx1ZSkge1xyXG4gICAgICAgICAgICAgICAgaWYgKHZhbHVlICYmICh0eXBlb2YgdmFsdWUgPT09ICdzdHJpbmcnKSAmJiB2YWx1ZS5pbmRleE9mKFwiZnVuY3Rpb25cIikgPT09IDApIHtcclxuICAgICAgICAgICAgICAgICAgICAvLyB3ZSBjYW4gb25seSBwYXNzIGEgZnVuY3Rpb24gYXMgc3RyaW5nIGluIEpTT04gPT0+IGRvaW5nIGEgcmVhbCBmdW5jdGlvblxyXG4gICAgICAgICAgICAgICAgICAgIHZhciBqc0Z1bmMgPSBuZXcgRnVuY3Rpb24oJ3JldHVybiAnICsgdmFsdWUpKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGpzRnVuYztcclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICByZXR1cm4gdmFsdWU7XHJcbiAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgcmV0dXJuIGpzb25GaW5hbDtcclxuICAgICAgICB9XHJcbiAgICB9O1xyXG5cclxuICAgIHZhciBoYW5kbGVFcnJvciA9IGZ1bmN0aW9uIChlcnJvciwgbG9nZ2VyKSB7XHJcbiAgICAgICAgaWYgKGVycm9yLmRhdGEgPT09IHVuZGVmaW5lZCkge1xyXG4gICAgICAgICAgICBsb2dnZXIuZXJyb3IoJycsICdYSFIgRmFpbGVkJyk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHZhciBtZXNzYWdlID0gZXJyb3Iuc3RhdHVzVGV4dDtcclxuICAgICAgICB2YXIgcmVhc29uID0gZXJyb3IuZGF0YS5NZXNzYWdlO1xyXG4gICAgICAgIGlmIChlcnJvci5zdGF0dXNUZXh0ID09PSBcIlVuYXV0aG9yaXplZFwiKSB7XHJcbiAgICAgICAgICAgIHJlYXNvbiA9IFwiVW5hdXRob3JpemVkXCI7XHJcbiAgICAgICAgICAgIG1lc3NhZ2UgPSBlcnJvci5kYXRhLk1lc3NhZ2U7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBsb2dnZXIuZXJyb3IobWVzc2FnZSwgcmVhc29uKTtcclxuICAgIH07XHJcblxyXG4gICAgdmFyIG1lbnVSaWdodHNDaGVjayA9IGZ1bmN0aW9uIChtZW51U2V0dGluZ3MsIG1haW5NZW51LCBzdWJNZW51KSB7XHJcbiAgICAgICAgdmFyIHJldFZhbHVlID0gZmFsc2U7XHJcbiAgICAgICAgdmFyIG1haW4gPSBnZXRJdGVtQnlLZXlWYWx1ZShtZW51U2V0dGluZ3MuZGF0YSwgJ0NvbmZpZ05hbWUnLCBtYWluTWVudSk7XHJcbiAgICAgICAgaWYgKG1haW4gIT09IC0xKSB7XHJcbiAgICAgICAgICAgIHZhciBpdGVtID0gZ2V0SXRlbUJ5S2V5VmFsdWUobWFpbi5jaGlsZHJlbiwgJ0NvbmZpZ05hbWUnLCBzdWJNZW51KTtcclxuICAgICAgICAgICAgaWYgKGl0ZW0gIT09IC0xKVxyXG4gICAgICAgICAgICAgICAgcmV0VmFsdWUgPSB0cnVlO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gcmV0VmFsdWU7XHJcbiAgICAgICAgLy9yZXR1cm4gdHJ1ZTtcclxuICAgIH1cclxuXHJcbiAgICB2YXIgZ2V0VXNlclJpZ2h0cyA9IGZ1bmN0aW9uIChtZW51U2V0dGluZ3MsIG1haW5NZW51LCBzdWJNZW51KSB7XHJcbiAgICAgICAgdmFyIHJldFZhbHVlID0ge307XHJcbiAgICAgICAgaWYgKG1haW5NZW51ICE9PSB1bmRlZmluZWQgJiYgbWFpbk1lbnUgPT09IFwiXCIpIHtcclxuICAgICAgICAgICAgdmFyIG1haW4gPSBnZXRJdGVtQnlLZXlWYWx1ZShtZW51U2V0dGluZ3MuZGF0YSwgJ01lbnVDb2RlJywgc3ViTWVudSk7XHJcbiAgICAgICAgICAgIGlmIChtYWluICE9PSAtMSlcclxuICAgICAgICAgICAgICAgIHJldFZhbHVlID0gbWFpbi5kYXRhO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIHZhciBtYWluID0gZ2V0SXRlbUJ5S2V5VmFsdWUobWVudVNldHRpbmdzLmRhdGEsICdNZW51Q29kZScsIG1haW5NZW51KTtcclxuICAgICAgICAgICAgaWYgKG1haW4gIT09IC0xKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgaXRlbSA9IGdldEl0ZW1CeUtleVZhbHVlKG1haW4uY2hpbGRyZW4sICdNZW51Q29kZScsIHN1Yk1lbnUpO1xyXG4gICAgICAgICAgICAgICAgaWYgKGl0ZW0gIT09IC0xKVxyXG4gICAgICAgICAgICAgICAgICAgIHJldFZhbHVlID0gaXRlbS5kYXRhO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiByZXRWYWx1ZTtcclxuICAgIH1cclxuXHJcblxyXG4gICAgdmFyIGdldFN1Yk1lbnVzID0gZnVuY3Rpb24gKG1lbnVTZXR0aW5ncywgbWFpbk1lbnUpIHtcclxuICAgICAgICB2YXIgcmV0VmFsdWUgPSBbXTtcclxuICAgICAgICB2YXIgbWFpbiA9IGdldEl0ZW1CeUtleVZhbHVlKG1lbnVTZXR0aW5ncy5kYXRhLCAnQ29uZmlnTmFtZScsIG1haW5NZW51KTtcclxuICAgICAgICBpZiAobWFpbiAhPT0gLTEpIHtcclxuICAgICAgICAgICAgcmV0VmFsdWUgPSBtYWluLmNoaWxkcmVuO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gcmV0VmFsdWU7XHJcbiAgICB9XHJcblxyXG4gICAgdmFyIGdldE1lbnVUaXRsZSA9IGZ1bmN0aW9uIChtZW51U2V0dGluZ3MsIG1haW5NZW51KSB7XHJcbiAgICAgICAgLyp2YXIgc2NvcGUgPSBnZXRBcHBTY29wZSgpO1xyXG4gICAgICAgIHZhciAkaW5qZWN0b3IgPSBhbmd1bGFyLmluamVjdG9yKCk7XHJcbiAgICAgICAgJGluamVjdG9yLmludm9rZShbJ2JzTG9hZGluZ092ZXJsYXlTZXJ2aWNlJywgZnVuY3Rpb24oYnNMb2FkaW5nT3ZlcmxheVNlcnZpY2Upe1xyXG4gICAgICAgICAgICBjb25zb2xlLmxvZyhic0xvYWRpbmdPdmVybGF5U2VydmljZSk7XHJcbiAgICAgICAgfV0pOyovXHJcbiAgICAgICAgdmFyIHJldFZhbHVlID0gXCJcIjtcclxuICAgICAgICB2YXIgbWFpbiA9IGdldEl0ZW1CeUtleVZhbHVlKG1lbnVTZXR0aW5ncy5kYXRhLCAnQ29uZmlnTmFtZScsIG1haW5NZW51KTtcclxuICAgICAgICBpZiAobWFpbiAhPT0gLTEpIHtcclxuICAgICAgICAgICAgcmV0VmFsdWUgPSBtYWluLnRleHQ7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiByZXRWYWx1ZTtcclxuICAgIH07XHJcblxyXG4gICAgdmFyIHNldFZpZXdDb250ZW50RGlzYWJsZWQgPSBmdW5jdGlvbiAoY3VycmVudE1vZGUpIHtcclxuICAgICAgICBpZiAoY3VycmVudE1vZGUgIT09IHVuZGVmaW5lZCkge1xyXG4gICAgICAgICAgICBpZiAoY3VycmVudE1vZGUudG9Mb3dlckNhc2UoKSA9PT0gXCJ2aWV3XCIgfHwgY3VycmVudE1vZGUudG9Mb3dlckNhc2UoKSA9PT0gXCJkZWxldGVcIikge1xyXG4gICAgICAgICAgICAgICAgJChcIi5qc3RyZWUtZ3JpZC13cmFwcGVyXCIpLmNzcyh7IFwicG9pbnRlci1ldmVudHNcIjogXCJub25lXCIsIFwiYmFja2dyb3VuZC1jb2xvclwiOiBcImFsaWNlYmx1ZVwiIH0pO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgJChcIi5qc3RyZWUtZ3JpZC13cmFwcGVyXCIpLmNzcyh7IFwicG9pbnRlci1ldmVudHNcIjogXCJhdXRvXCIsIFwiYmFja2dyb3VuZC1jb2xvclwiOiBcInRyYW5zcGFyZW50XCIgfSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9O1xyXG5cclxuICAgIHZhciBzZXRBcHBydm9lZFRhYmxlQ29sbGVjdGlvbiA9IGZ1bmN0aW9uICh0YWJsZSwgb3B0aW9ucykge1xyXG4gICAgICAgIGlmIChvcHRpb25zLmFwcHJvdmVkRGlzcGxheSA9PT0gdW5kZWZpbmVkIHx8IG9wdGlvbnMuYXBwcm92ZWREaXNwbGF5ID09PSBmYWxzZSkge1xyXG4gICAgICAgICAgICB2YXIgY29sdW1uTm8gPSBuYXZjb24uZ2V0SXRlbUluZGV4QnlLZXlWYWx1ZShvcHRpb25zLmNvbHVtbnMsIFwidGl0bGVcIiwgXCJTdGF0dXNcIik7XHJcblxyXG4gICAgICAgICAgICAkLm1hcCgkKHRhYmxlKS5maW5kKFwidGJvZHkgdHJcIiksIGZ1bmN0aW9uIChpdGVtLCBpbmRleCkge1xyXG4gICAgICAgICAgICAgICAgaWYgKCQoJChpdGVtKS5maW5kKFwidGRcIilbY29sdW1uTm9dKS50ZXh0KCkgIT09IHVuZGVmaW5lZCAmJiAkKCQoaXRlbSkuZmluZChcInRkXCIpW2NvbHVtbk5vXSkudGV4dCgpICE9PSBudWxsXHJcbiAgICAgICAgICAgICAgICAgICAgJiYgJCgkKGl0ZW0pLmZpbmQoXCJ0ZFwiKVtjb2x1bW5Ob10pLnRleHQoKS50b0xvd2VyQ2FzZSgpID09PSBcImFwcHJvdmVkXCIpIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoJChpdGVtKS5maW5kKFwiLmZhLWVkaXRcIikubGVuZ3RoID4gMClcclxuICAgICAgICAgICAgICAgICAgICAgICAgLy8kKGl0ZW0pLmZpbmQoXCIuZmEtZWRpdFwiKS5wYXJlbnQoKS5jc3MoXCJkaXNwbGF5XCIsIFwibm9uZVwiKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgJChpdGVtKS5maW5kKFwiLmZhLWVkaXRcIikucGFyZW50KCkuYXR0cihcImRpc2FibGVkXCIsIFwiZGlzYWJsZWRcIik7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKCQoaXRlbSkuZmluZChcIi5mYS10cmFzaC1vXCIpLmxlbmd0aCA+IDApXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vJChpdGVtKS5maW5kKFwiLmZhLXRyYXNoLW9cIikucGFyZW50KCkuY3NzKFwiZGlzcGxheVwiLCBcIm5vbmVcIik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICQoaXRlbSkuZmluZChcIi5mYS10cmFzaC1vXCIpLnBhcmVudCgpLmF0dHIoXCJkaXNhYmxlZFwiLCBcImRpc2FibGVkXCIpO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoJChpdGVtKS5maW5kKFwiLmZhLWVkaXRcIikubGVuZ3RoID4gMClcclxuICAgICAgICAgICAgICAgICAgICAgICAgLy8kKGl0ZW0pLmZpbmQoXCIuZmEtZWRpdFwiKS5wYXJlbnQoKS5jc3MoXCJkaXNwbGF5XCIsIFwiXCIpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAkKGl0ZW0pLmZpbmQoXCIuZmEtZWRpdFwiKS5wYXJlbnQoKS5yZW1vdmVBdHRyKFwiZGlzYWJsZWRcIik7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKCQoaXRlbSkuZmluZChcIi5mYS10cmFzaC1vXCIpLmxlbmd0aCA+IDApXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vJChpdGVtKS5maW5kKFwiLmZhLXRyYXNoLW9cIikucGFyZW50KCkuY3NzKFwiZGlzcGxheVwiLCBcIlwiKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgJChpdGVtKS5maW5kKFwiLmZhLXRyYXNoLW9cIikucGFyZW50KCkucmVtb3ZlQXR0cihcImRpc2FibGVkXCIpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcbiAgICB9O1xyXG5cclxuICAgIHZhciBzZXRBcHBydm9lZFRhYmxlQ29sdW1uT3B0aW9ucyA9IGZ1bmN0aW9uIChyb3csIGRhdGEsIG9wdGlvbnMpIHtcclxuICAgICAgICBpZiAob3B0aW9ucy5hcHByb3ZlZERpc3BsYXkgPT09IHVuZGVmaW5lZCB8fCBvcHRpb25zLmFwcHJvdmVkRGlzcGxheSA9PT0gZmFsc2UpIHtcclxuICAgICAgICAgICAgaWYgKGRhdGEuU3RhdHVzTmFtZSAhPT0gdW5kZWZpbmVkICYmIGRhdGEuU3RhdHVzTmFtZSAhPT0gbnVsbCAmJiBkYXRhLlN0YXR1c05hbWUudG9Mb3dlckNhc2UoKSA9PT0gXCJhcHByb3ZlZFwiKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoJChyb3cpLmZpbmQoXCIuZmEtZWRpdFwiKS5sZW5ndGggPiAwKVxyXG4gICAgICAgICAgICAgICAgICAgIC8vJChyb3cpLmZpbmQoXCIuZmEtZWRpdFwiKS5wYXJlbnQoKS5jc3MoXCJkaXNwbGF5XCIsIFwibm9uZVwiKTtcclxuICAgICAgICAgICAgICAgICAgICAkKHJvdykuZmluZChcIi5mYS1lZGl0XCIpLnBhcmVudCgpLmF0dHIoXCJkaXNhYmxlZFwiLCBcImRpc2FibGVkXCIpO1xyXG4gICAgICAgICAgICAgICAgaWYgKCQocm93KS5maW5kKFwiLmZhLXRyYXNoLW9cIikubGVuZ3RoID4gMClcclxuICAgICAgICAgICAgICAgICAgICAvLyQocm93KS5maW5kKFwiLmZhLXRyYXNoLW9cIikucGFyZW50KCkuY3NzKFwiZGlzcGxheVwiLCBcIm5vbmVcIik7XHJcbiAgICAgICAgICAgICAgICAgICAgJChyb3cpLmZpbmQoXCIuZmEtdHJhc2gtb1wiKS5wYXJlbnQoKS5hdHRyKFwiZGlzYWJsZWRcIiwgXCJkaXNhYmxlZFwiKTtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIGlmICgkKHJvdykuZmluZChcIi5mYS1lZGl0XCIpLmxlbmd0aCA+IDApXHJcbiAgICAgICAgICAgICAgICAgICAgLy8kKHJvdykuZmluZChcIi5mYS1lZGl0XCIpLnBhcmVudCgpLmNzcyhcImRpc3BsYXlcIiwgXCJcIik7XHJcbiAgICAgICAgICAgICAgICAgICAgJChyb3cpLmZpbmQoXCIuZmEtZWRpdFwiKS5wYXJlbnQoKS5yZW1vdmVBdHRyKFwiZGlzYWJsZWRcIik7XHJcbiAgICAgICAgICAgICAgICBpZiAoJChyb3cpLmZpbmQoXCIuZmEtdHJhc2gtb1wiKS5sZW5ndGggPiAwKVxyXG4gICAgICAgICAgICAgICAgICAgIC8vJChyb3cpLmZpbmQoXCIuZmEtdHJhc2gtb1wiKS5wYXJlbnQoKS5jc3MoXCJkaXNwbGF5XCIsIFwiXCIpO1xyXG4gICAgICAgICAgICAgICAgICAgICQocm93KS5maW5kKFwiLmZhLXRyYXNoLW9cIikucGFyZW50KCkucmVtb3ZlQXR0cihcImRpc2FibGVkXCIpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxuXHJcbiAgICB2YXIgc2V0QXBwcnZvZWRUcmVlZUNvbHVtbk9wdGlvbnMgPSBmdW5jdGlvbiAodHlwZSwgb3B0aW9ucykge1xyXG4gICAgICAgIGlmIChvcHRpb25zICE9PSB1bmRlZmluZWQgJiYgb3B0aW9ucyAhPT0gbnVsbCAmJiBvcHRpb25zLmFwcHJvdmVkRGlzcGxheSAhPT0gdW5kZWZpbmVkICYmIG9wdGlvbnMuYXBwcm92ZWREaXNwbGF5KSByZXR1cm47XHJcblxyXG4gICAgICAgIHZhciB0cmVlID0gJChcIm5hdmNvbi10cmVlW3R5cGU9J1wiICsgdHlwZSArIFwiJ11cIikuZmluZCgnLmpzdHJlZScpOy8vLmZpbmQoXCJkaXZbcm9sZT0ndHJlZSddXCIpO1xyXG4gICAgICAgIGlmICh0cmVlLmxlbmd0aCA9PT0gMCkgdHJlZSA9ICQoXCJuYXZjb24tdHJlZVt0eXBlPSdcIiArIHR5cGUgKyBcIiddXCIpLmZpbmQoJy5qc3RyZWUnKS5maW5kKFwiZGl2W3JvbGU9J3RyZWUnXVwiKTtcclxuICAgICAgICBpZiAodHJlZS5sZW5ndGggIT09IDApIHtcclxuICAgICAgICAgICAgaWYgKCQodHJlZVswXSkuanN0cmVlKCkuc2V0dGluZ3MgPT09IHVuZGVmaW5lZCkgJCh0cmVlWzBdKS5qc3RyZWUoKS5zZXR0aW5ncyA9IG9wdGlvbnM7XHJcblxyXG4gICAgICAgICAgICAvL2lmICgkKHRyZWVbMF0pLmpzdHJlZSgpLnNldHRpbmdzLmFwcHJvdmVkRGlzcGxheSA9PT0gdW5kZWZpbmVkIHx8ICQodHJlZVswXSkuanN0cmVlKCkuc2V0dGluZ3MuYXBwcm92ZWREaXNwbGF5ID09PSBmYWxzZSkge1xyXG4gICAgICAgICAgICB2YXIgZGF0YSA9ICQodHJlZVswXSkuanN0cmVlKCkuc2V0dGluZ3MuY29yZS5kYXRhO1xyXG4gICAgICAgICAgICBpZiAoZGF0YSAhPT0gdW5kZWZpbmVkICYmIGRhdGEgIT09IG51bGwgJiYgZGF0YSAhPT0gZmFsc2UgJiYgZGF0YS5sZW5ndGggIT09IDApIHtcclxuICAgICAgICAgICAgICAgICQubWFwKGRhdGEsIGZ1bmN0aW9uIChpdGVtLCBpbmRleCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBub2RlSWQgPSBpdGVtW1wiaWRcIl07XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIG5vZGVDaGlsZCA9ICQodHJlZVswXSkuanN0cmVlKCkuZ2V0X25vZGUobm9kZUlkKTtcclxuICAgICAgICAgICAgICAgICAgICBpZiAobm9kZUNoaWxkICE9PSB1bmRlZmluZWQgJiYgbm9kZUNoaWxkICE9PSBudWxsKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChpdGVtLlN0YXR1c05hbWUgIT09IHVuZGVmaW5lZCAmJiBpdGVtLlN0YXR1c05hbWUgIT09IG51bGwgJiYgaXRlbS5TdGF0dXNOYW1lLnRvTG93ZXJDYXNlKCkgPT09IFwiYXBwcm92ZWRcIikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGNvbHVtbk5vID0gNDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBnZXRDb2x1bW4gPSAkKHRyZWVbMF0pLnBhcmVudCgpLnBhcmVudCgpLmZpbmQoXCJkaXZbaWQ9J2pzZ3JpZF9cIiArIG5vZGVJZCArIFwiX2NvbFwiICsgY29sdW1uTm8gKyBcIiddXCIpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGdldENvbHVtbiAhPT0gdW5kZWZpbmVkICYmIGdldENvbHVtbi5jaGlsZHJlbi5sZW5ndGggIT09IDApIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgZ2V0Q3RybCA9ICQoZ2V0Q29sdW1uLmZpbmQoXCJhXCIpKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoZ2V0Q3RybCAhPT0gdW5kZWZpbmVkKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvL2dldEN0cmwuY3NzKFwiZGlzcGxheVwiLCBcIm5vbmVcIik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdldEN0cmwuYXR0cihcImRpc2FibGVkXCIsIFwiZGlzYWJsZWRcIik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGNvbHVtbk5vID0gNTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBnZXRDb2x1bW4gPSAkKHRyZWVbMF0pLnBhcmVudCgpLnBhcmVudCgpLmZpbmQoXCJkaXZbaWQ9J2pzZ3JpZF9cIiArIG5vZGVJZCArIFwiX2NvbFwiICsgY29sdW1uTm8gKyBcIiddXCIpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGdldENvbHVtbiAhPT0gdW5kZWZpbmVkICYmIGdldENvbHVtbi5jaGlsZHJlbi5sZW5ndGggIT09IDApIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgZ2V0Q3RybCA9ICQoZ2V0Q29sdW1uLmZpbmQoXCJhXCIpKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoZ2V0Q3RybCAhPT0gdW5kZWZpbmVkKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvL2dldEN0cmwuY3NzKFwiZGlzcGxheVwiLCBcIm5vbmVcIik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdldEN0cmwuYXR0cihcImRpc2FibGVkXCIsIFwiZGlzYWJsZWRcIik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgY29sdW1uTm8gPSA0O1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGdldENvbHVtbiA9ICQodHJlZVswXSkucGFyZW50KCkucGFyZW50KCkuZmluZChcImRpdltpZD0nanNncmlkX1wiICsgbm9kZUlkICsgXCJfY29sXCIgKyBjb2x1bW5ObyArIFwiJ11cIik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoZ2V0Q29sdW1uICE9PSB1bmRlZmluZWQgJiYgZ2V0Q29sdW1uLmNoaWxkcmVuLmxlbmd0aCAhPT0gMCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBnZXRDdHJsID0gJChnZXRDb2x1bW4uZmluZChcImFcIikpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChnZXRDdHJsICE9PSB1bmRlZmluZWQpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vZ2V0Q3RybC5jc3MoXCJkaXNwbGF5XCIsIFwiXCIpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBnZXRDdHJsLnJlbW92ZUF0dHIoXCJkaXNhYmxlZFwiKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgY29sdW1uTm8gPSA1O1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGdldENvbHVtbiA9ICQodHJlZVswXSkucGFyZW50KCkucGFyZW50KCkuZmluZChcImRpdltpZD0nanNncmlkX1wiICsgbm9kZUlkICsgXCJfY29sXCIgKyBjb2x1bW5ObyArIFwiJ11cIik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoZ2V0Q29sdW1uICE9PSB1bmRlZmluZWQgJiYgZ2V0Q29sdW1uLmNoaWxkcmVuLmxlbmd0aCAhPT0gMCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBnZXRDdHJsID0gJChnZXRDb2x1bW4uZmluZChcImFcIikpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChnZXRDdHJsICE9PSB1bmRlZmluZWQpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vZ2V0Q3RybC5jc3MoXCJkaXNwbGF5XCIsIFwiXCIpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBnZXRDdHJsLnJlbW92ZUF0dHIoXCJkaXNhYmxlZFwiKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIC8vfVxyXG4gICAgICAgIH1cclxuICAgIH07XHJcblxyXG4gICAgdmFyIHNldERpc2FibGVkRW5hYmxlZEJ5UmlnaHRzID0gZnVuY3Rpb24gKHJpZ2h0cywgYXBwSXRlbSkge1xyXG4gICAgICAgIGlmIChyaWdodHMgPT09IHVuZGVmaW5lZCB8fCBPYmplY3Qua2V5cyhyaWdodHMpLmxlbmd0aCA9PT0gMCkgcmV0dXJuIGZhbHNlO1xyXG5cclxuICAgICAgICBpZiAoYXBwSXRlbSAhPT0gdW5kZWZpbmVkICYmIGFwcEl0ZW0gIT09IFwiXCIpIHtcclxuICAgICAgICAgICAgdmFyIHN0YXR1cyA9IChyaWdodHMuQXBwcm92ZSB8fCBmYWxzZSkgPyBmYWxzZSA6IHRydWU7XHJcbiAgICAgICAgICAgIGlmIChzdGF0dXMpIHtcclxuICAgICAgICAgICAgICAgICQoXCJuYXZjb24tYnV0dG9uW2FwcHJvdmFsLWlkXj0nXCIgKyBhcHBJdGVtICsgXCInXVwiKS5maW5kKFwiYVwiKS5hdHRyKFwiZGlzYWJsZWRcIiwgXCJkaXNhYmxlZFwiKTtcclxuICAgICAgICAgICAgICAgICQoXCJuYXZjb24tYnV0dG9uW2FwcHJvdmFsLWlkXj0nXCIgKyBhcHBJdGVtICsgXCInXVwiKS5maW5kKFwiYVwiKS5jc3MoXCJwb2ludGVyRXZlbnRzXCIsIFwibm9uZVwiKTtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICQoXCJuYXZjb24tYnV0dG9uW2FwcHJvdmFsLWlkXj0nXCIgKyBhcHBJdGVtICsgXCInXVwiKS5maW5kKFwiYVwiKS5yZW1vdmVBdHRyKFwiZGlzYWJsZWRcIik7XHJcbiAgICAgICAgICAgICAgICAkKFwibmF2Y29uLWJ1dHRvblthcHByb3ZhbC1pZF49J1wiICsgYXBwSXRlbSArIFwiJ11cIikuZmluZChcImFcIikuY3NzKFwicG9pbnRlckV2ZW50c1wiLCBcImF1dG9cIik7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgdmFyIGFkZFN0YXR1cyA9IChyaWdodHMuQWRkIHx8IGZhbHNlKSA/IGZhbHNlIDogdHJ1ZTtcclxuICAgICAgICB2YXIgZWRpdFN0YXR1cyA9IChyaWdodHMuRWRpdCB8fCBmYWxzZSkgPyBmYWxzZSA6IHRydWU7XHJcbiAgICAgICAgdmFyIGRlbGV0ZVN0YXR1cyA9IChyaWdodHMuRGVsZXRlIHx8IGZhbHNlKSA/IGZhbHNlIDogdHJ1ZTtcclxuICAgICAgICB2YXIgYXBwcm92YWxTdGF0dXMgPSAocmlnaHRzLkFwcHJvdmUgfHwgZmFsc2UpID8gZmFsc2UgOiB0cnVlO1xyXG4gICAgICAgIHZhciBwcmludFN0YXR1cyA9IChyaWdodHMuVmlldyB8fCBmYWxzZSkgPyBmYWxzZSA6IHRydWU7XHJcblxyXG5cclxuICAgICAgICBpZiAoYWRkU3RhdHVzKSB7XHJcbiAgICAgICAgICAgICQoXCJhW2NsYXNzKj0nYWRkbmV3J11bZGF0YS10YXJnZXQhPScjcmVxdWVzdGxpc3QnXVwiKS5hdHRyKFwiZGlzYWJsZWRcIiwgXCJkaXNhYmxlZFwiKTtcclxuICAgICAgICAgICAgJCgnLmpzdHJlZS1ncmlkLW1pZHdyYXBwZXInKS5maW5kKCcuZmxvYXQtY2VudGVyLmFkZC5idG4uYnRudHJlZS5idG4teHMnKS5hdHRyKFwiZGlzYWJsZWRcIiwgXCJkaXNhYmxlZFwiKTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAkKFwiYVtjbGFzcyo9J2FkZG5ldyddW2RhdGEtdGFyZ2V0IT0nI3JlcXVlc3RsaXN0J11cIikucmVtb3ZlQXR0cihcImRpc2FibGVkXCIpO1xyXG4gICAgICAgICAgICAkKCcuanN0cmVlLWdyaWQtbWlkd3JhcHBlcicpLmZpbmQoJy5mbG9hdC1jZW50ZXIuYWRkLmJ0bi5idG50cmVlLmJ0bi14cycpLnJlbW92ZUF0dHIoXCJkaXNhYmxlZFwiKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGlmIChlZGl0U3RhdHVzKSB7XHJcbiAgICAgICAgICAgICQoXCJhW2NsYXNzKj0nZWRpdCddXCIpLmF0dHIoXCJkaXNhYmxlZFwiLCBcImRpc2FibGVkXCIpO1xyXG4gICAgICAgICAgICAkKCcuanN0cmVlLWdyaWQtbWlkd3JhcHBlcicpLmZpbmQoJy5mbG9hdC1jZW50ZXIuZWRpdC5idG4uYnRudHJlZS5idG4teHMnKS5hdHRyKFwiZGlzYWJsZWRcIiwgXCJkaXNhYmxlZFwiKTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAkKFwiYVtjbGFzcyo9J2VkaXQnXVwiKS5yZW1vdmVBdHRyKFwiZGlzYWJsZWRcIik7XHJcbiAgICAgICAgICAgICQoJy5qc3RyZWUtZ3JpZC1taWR3cmFwcGVyJykuZmluZCgnLmZsb2F0LWNlbnRlci5lZGl0LmJ0bi5idG50cmVlLmJ0bi14cycpLnJlbW92ZUF0dHIoXCJkaXNhYmxlZFwiKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGlmIChwcmludFN0YXR1cykge1xyXG4gICAgICAgICAgICAkKFwiYVtjbGFzcyo9J3ZpZXcnXVwiKS5hdHRyKFwiZGlzYWJsZWRcIiwgXCJkaXNhYmxlZFwiKTtcclxuICAgICAgICAgICAgJCgnLmpzdHJlZS1ncmlkLW1pZHdyYXBwZXInKS5maW5kKCcuZmxvYXQtY2VudGVyLnZpZXcuYnRuLmJ0bnRyZWUuYnRuLXhzJykuYXR0cihcImRpc2FibGVkXCIsIFwiZGlzYWJsZWRcIik7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgJChcImFbY2xhc3MqPSd2aWV3J11cIikucmVtb3ZlQXR0cihcImRpc2FibGVkXCIpO1xyXG4gICAgICAgICAgICAkKCcuanN0cmVlLWdyaWQtbWlkd3JhcHBlcicpLmZpbmQoJy5mbG9hdC1jZW50ZXIudmlldy5idG4uYnRudHJlZS5idG4teHMnKS5yZW1vdmVBdHRyKFwiZGlzYWJsZWRcIik7XHJcbiAgICAgICAgfVxyXG5cclxuXHJcbiAgICAgICAgaWYgKGRlbGV0ZVN0YXR1cykge1xyXG4gICAgICAgICAgICAkKFwiYVtjbGFzcyo9J2RlbGV0ZSddXCIpLmF0dHIoXCJkaXNhYmxlZFwiLCBcImRpc2FibGVkXCIpO1xyXG4gICAgICAgICAgICAkKCcuanN0cmVlLWdyaWQtbWlkd3JhcHBlcicpLmZpbmQoJy5mbG9hdC1jZW50ZXIuZGVsZXRlLmJ0bi5idG50cmVlLmJ0bi14cycpLmF0dHIoXCJkaXNhYmxlZFwiLCBcImRpc2FibGVkXCIpO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICQoXCJhW2NsYXNzKj0nZGVsZXRlJ11cIikucmVtb3ZlQXR0cihcImRpc2FibGVkXCIpO1xyXG4gICAgICAgICAgICAkKCcuanN0cmVlLWdyaWQtbWlkd3JhcHBlcicpLmZpbmQoJy5mbG9hdC1jZW50ZXIuZGVsZXRlLmJ0bi5idG50cmVlLmJ0bi14cycpLnJlbW92ZUF0dHIoXCJkaXNhYmxlZFwiKTtcclxuICAgICAgICB9XHJcblxyXG5cclxuICAgICAgICBpZiAoYXBwcm92YWxTdGF0dXMpIHtcclxuICAgICAgICAgICAgJChcImFbY2xhc3MqPSdhZGRuZXcnXVtkYXRhLXRhcmdldF49JyNyZXF1ZXN0bGlzdF8nXVwiKS5hdHRyKFwiZGlzYWJsZWRcIiwgXCJkaXNhYmxlZFwiKTtcclxuICAgICAgICAgICAgJChcImFbY2xhc3MqPSdhZGRuZXcnXVtkYXRhLXRhcmdldF49JyNyZXF1ZXN0bGlzdF8nXVwiKS5wYXJlbnQoKS5jc3MoXCJwb2ludGVyRXZlbnRzXCIsIFwibm9uZVwiKTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAkKFwiYVtjbGFzcyo9J2FkZG5ldyddW2RhdGEtdGFyZ2V0Xj0nI3JlcXVlc3RsaXN0XyddXCIpLnJlbW92ZUF0dHIoXCJkaXNhYmxlZFwiKTtcclxuICAgICAgICAgICAgJChcImFbY2xhc3MqPSd2aWV3J11cIikucmVtb3ZlQXR0cihcImRpc2FibGVkXCIpO1xyXG4gICAgICAgICAgICAkKCcuanN0cmVlLWdyaWQtbWlkd3JhcHBlcicpLmZpbmQoJy5mbG9hdC1jZW50ZXIudmlldy5idG4uYnRudHJlZS5idG4teHMnKS5yZW1vdmVBdHRyKFwiZGlzYWJsZWRcIik7XHJcbiAgICAgICAgICAgICQoXCJhW2NsYXNzKj0nYWRkbmV3J11bZGF0YS10YXJnZXRePScjcmVxdWVzdGxpc3RfJ11cIikucGFyZW50KCkuY3NzKFwicG9pbnRlckV2ZW50c1wiLCBcImF1dG9cIik7XHJcbiAgICAgICAgfVxyXG5cclxuICAgIH07XHJcblxyXG5cclxuICAgIHZhciBjbGVhclRhYmxlU2VsZWN0ZWRSb3dzID0gZnVuY3Rpb24gKHR5cGUpIHtcclxuICAgICAgICB2YXIgdGFibGVJbnN0YW5jZSA9IG5hdmNvbi5nZXRUYWJsZSh0eXBlKTtcclxuICAgICAgICBpZiAodGFibGVJbnN0YW5jZSAhPT0gdW5kZWZpbmVkKVxyXG4gICAgICAgICAgICB0YWJsZUluc3RhbmNlLnJvdygnLnNlbGVjdGVkJykucmVtb3ZlKCkuZHJhdyhmYWxzZSk7XHJcbiAgICB9XHJcblxyXG4gICAgdmFyIHBhZ2VDb250cm9sQWN0aW9uID0gZnVuY3Rpb24gKCRzY29wZSwgbW9kZSwgdGFibGVEZWZpbmUsIGNhbGxiYWNrKSB7XHJcbiAgICAgICAgaWYgKG1vZGUudG9Mb3dlckNhc2UoKSA9PT0gXCJ2aWV3XCIgfHwgbW9kZS50b0xvd2VyQ2FzZSgpID09PSBcInByaW50XCIgfHwgbW9kZS50b0xvd2VyQ2FzZSgpID09PSBcImRlbGV0ZVwiIHx8IG1vZGUudG9Mb3dlckNhc2UoKSA9PT0gXCJzYXZlYXNcIikge1xyXG4gICAgICAgICAgICAkLm1hcCh0YWJsZURlZmluZSwgZnVuY3Rpb24gKGl0ZW0sIGluZGV4KSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoaXRlbS50eXBlICE9PSB1bmRlZmluZWQgJiYgaXRlbS50eXBlICE9PSBcIlwiKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIHRhYmxlSW5zdGFuY2UgPSBuYXZjb24uZ2V0VGFibGUoaXRlbS50eXBlKTtcclxuICAgICAgICAgICAgICAgICAgICBpZiAodGFibGVJbnN0YW5jZSAhPT0gdW5kZWZpbmVkICYmIHRhYmxlSW5zdGFuY2UgIT09IG51bGwgJiYgaXRlbS5jb2x1bW5zICE9PSB1bmRlZmluZWQgJiYgaXRlbS5jb2x1bW5zICE9PSBcIlwiKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB0YWJsZUluc3RhbmNlLmNvbHVtbnMoaXRlbS5jb2x1bW5zKS52aXNpYmxlKGZhbHNlKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICAvLyRzY29wZS5uYXZjb25EYXRhLmhpZGVCdXR0b24gPSB0cnVlO1xyXG4gICAgICAgICAgICBpZiAoJHNjb3BlLm5hdmNvbkRhdGEgIT09IHVuZGVmaW5lZCAmJiAkc2NvcGUubmF2Y29uRGF0YS5oaWRlVGFiICE9PSB1bmRlZmluZWQgJiYgJHNjb3BlLm5hdmNvbkRhdGEuaGlkZVRhYiAhPT0gbnVsbCkgJHNjb3BlLm5hdmNvbkRhdGEuaGlkZVRhYiA9IGZhbHNlO1xyXG5cclxuICAgICAgICAgICAgaWYgKGNhbGxiYWNrICE9PSB1bmRlZmluZWQpIGNhbGxiYWNrKHRydWUpO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICQubWFwKHRhYmxlRGVmaW5lLCBmdW5jdGlvbiAoaXRlbSwgaW5kZXgpIHtcclxuICAgICAgICAgICAgICAgIGlmIChpdGVtLnR5cGUgIT09IHVuZGVmaW5lZCAmJiBpdGVtLnR5cGUgIT09IFwiXCIpIHtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgdGFibGVJbnN0YW5jZSA9IG5hdmNvbi5nZXRUYWJsZShpdGVtLnR5cGUpO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmICh0YWJsZUluc3RhbmNlICE9PSB1bmRlZmluZWQgJiYgdGFibGVJbnN0YW5jZSAhPT0gbnVsbCAmJiBpdGVtLmNvbHVtbnMgIT09IHVuZGVmaW5lZCAmJiBpdGVtLmNvbHVtbnMgIT09IFwiXCIpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRhYmxlSW5zdGFuY2UuY29sdW1ucyhpdGVtLmNvbHVtbnMpLnZpc2libGUodHJ1ZSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgLy8kc2NvcGUubmF2Y29uRGF0YS5oaWRlQnV0dG9uID0gZmFsc2U7XHJcbiAgICAgICAgICAgIGlmICgkc2NvcGUgIT09IHVuZGVmaW5lZCAmJiAkc2NvcGUubmF2Y29uRGF0YSAhPT0gdW5kZWZpbmVkKSAkc2NvcGUubmF2Y29uRGF0YS5oaWRlVGFiID0gZmFsc2U7XHJcbiAgICAgICAgICAgIGlmICgkc2NvcGUgIT09IHVuZGVmaW5lZCAmJiAkc2NvcGUubmF2Y29uRGF0YSAhPT0gdW5kZWZpbmVkICYmICRzY29wZS5uYXZjb25EYXRhLmhpZGVUYWIgIT09IHVuZGVmaW5lZCAmJiBtb2RlLnRvTG93ZXJDYXNlKCkgPT09IFwic2F2ZVwiKSAkc2NvcGUubmF2Y29uRGF0YS5oaWRlVGFiID0gdHJ1ZTtcclxuXHJcbiAgICAgICAgICAgIGlmIChjYWxsYmFjayAhPT0gdW5kZWZpbmVkKSBjYWxsYmFjayhmYWxzZSk7XHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxuXHJcblxyXG4gICAgdmFyIHNsZWVwID0gZnVuY3Rpb24gKG1pbGxpc2Vjb25kcykge1xyXG4gICAgICAgIHZhciBzdGFydCA9IG5ldyBEYXRlKCkuZ2V0VGltZSgpO1xyXG4gICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgMWU3OyBpKyspIHtcclxuICAgICAgICAgICAgaWYgKChuZXcgRGF0ZSgpLmdldFRpbWUoKSAtIHN0YXJ0KSA+IG1pbGxpc2Vjb25kcykge1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9O1xyXG5cclxuXHJcbiAgICB2YXIgZ2V0VGFibGVOb3RJbk90aGVyVGFibGUgPSBmdW5jdGlvbiAobW9kZSwgc2VsZWN0ZWRJdGVtLCBjb2xsZWN0aW9uSXRlbSwgcHJpbWFyeUtleSwgZGVsZXRlUm93SXRlbSwgYXNzaWduUHJpbWFyeUtleSkge1xyXG4gICAgICAgIGlmIChtb2RlLnRvTG93ZXJDYXNlKCkgPT09IFwiYWRkXCIpIHtcclxuICAgICAgICAgICAgaWYgKGNvbGxlY3Rpb25JdGVtICE9PSB1bmRlZmluZWQgJiYgY29sbGVjdGlvbkl0ZW0gIT09IG51bGwpIHtcclxuICAgICAgICAgICAgICAgIGlmIChjb2xsZWN0aW9uSXRlbS5vbGREYXRhID09PSB1bmRlZmluZWQgfHwgY29sbGVjdGlvbkl0ZW0ub2xkRGF0YSA9PT0gbnVsbCkgY29sbGVjdGlvbkl0ZW0ub2xkRGF0YSA9IGNvbGxlY3Rpb25JdGVtLmRhdGE7XHJcblxyXG4gICAgICAgICAgICAgICAgdmFyIGZpbHRlck1lbWJlcnMgPSBuYXZjb24uZ2V0SXRlbXNOb3RJbk90aGVySXRlbXMoY29sbGVjdGlvbkl0ZW0uZGF0YSwgc2VsZWN0ZWRJdGVtICE9PSB1bmRlZmluZWQgJiYgc2VsZWN0ZWRJdGVtICE9PSBudWxsID8gc2VsZWN0ZWRJdGVtLmRhdGEgOiBbXSwgcHJpbWFyeUtleSk7XHJcbiAgICAgICAgICAgICAgICAkLm1hcChmaWx0ZXJNZW1iZXJzLCBmdW5jdGlvbiAoaXRlbSwgaW5kZXgpIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoYXNzaWduUHJpbWFyeUtleSAhPT0gdW5kZWZpbmVkICYmIGFzc2lnblByaW1hcnlLZXkgIT09IFwiXCIgJiYgaXRlbVthc3NpZ25QcmltYXJ5S2V5XSAhPT0gdW5kZWZpbmVkKSBpdGVtW2Fzc2lnblByaW1hcnlLZXldID0gbnVsbDtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoaXRlbS5Sb3dfQ2hlY2tlZCAhPT0gdW5kZWZpbmVkKSBpdGVtLlJvd19DaGVja2VkID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGl0ZW0uQ2hlY2tfRmllbGQgIT09IHVuZGVmaW5lZCAmJiBpdGVtW2l0ZW0uQ2hlY2tfRmllbGRdICE9PSB1bmRlZmluZWQpIGl0ZW1baXRlbS5DaGVja19GaWVsZF0gPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgICAgIGNvbGxlY3Rpb25JdGVtLmRhdGEgPSBmaWx0ZXJNZW1iZXJzO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSBlbHNlIGlmIChtb2RlLnRvTG93ZXJDYXNlKCkgPT09IFwiZGVsZXRlXCIpIHtcclxuICAgICAgICAgICAgaWYgKGRlbGV0ZVJvd0l0ZW0gIT09IHVuZGVmaW5lZCAmJiBkZWxldGVSb3dJdGVtICE9PSBudWxsKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAobmF2Y29uLmdldEl0ZW1JbmRleEJ5S2V5VmFsdWUoY29sbGVjdGlvbkl0ZW0uZGF0YSwgcHJpbWFyeUtleSwgZGVsZXRlUm93SXRlbVtwcmltYXJ5S2V5XSkgPT09IC0xKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIHNlbGVjdGVkUm93SW5kZXggPSBuYXZjb24uc2F2ZS5zZWxlY3RlZFJvd0luZGV4KGNvbGxlY3Rpb25JdGVtLm9sZERhdGEsIGRlbGV0ZVJvd0l0ZW0sIHByaW1hcnlLZXkpO1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBpdGVtSW5zZXJ0ID0gbmF2Y29uLmdldEl0ZW1CeUtleVZhbHVlKGNvbGxlY3Rpb25JdGVtLm9sZERhdGEsIHByaW1hcnlLZXksIGRlbGV0ZVJvd0l0ZW1bcHJpbWFyeUtleV0pO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChpdGVtSW5zZXJ0ICE9PSAtMSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoYXNzaWduUHJpbWFyeUtleSAhPT0gdW5kZWZpbmVkICYmIGFzc2lnblByaW1hcnlLZXkgIT09IFwiXCIgJiYgaXRlbUluc2VydFthc3NpZ25QcmltYXJ5S2V5XSAhPT0gdW5kZWZpbmVkKSBpdGVtSW5zZXJ0W2Fzc2lnblByaW1hcnlLZXldID0gbnVsbDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGl0ZW1JbnNlcnQuUm93X0NoZWNrZWQgIT09IHVuZGVmaW5lZCkgaXRlbUluc2VydC5Sb3dfQ2hlY2tlZCA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoaXRlbUluc2VydC5DaGVja19GaWVsZCAhPT0gdW5kZWZpbmVkICYmIGl0ZW1JbnNlcnRbaXRlbUluc2VydC5DaGVja19GaWVsZF0gIT09IHVuZGVmaW5lZCkgaXRlbUluc2VydFtpdGVtSW5zZXJ0LkNoZWNrX0ZpZWxkXSA9IGZhbHNlO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgLy9jb2xsZWN0aW9uSXRlbS5kYXRhLnNwbGljZShzZWxlY3RlZFJvd0luZGV4LCAwLCBpdGVtSW5zZXJ0KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY29sbGVjdGlvbkl0ZW0uZGF0YS5wdXNoKGl0ZW1JbnNlcnQpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH07XHJcblxyXG5cclxuICAgIHZhciBnZXRPYmplY3RzZnJvbUpTT04gPSBmdW5jdGlvbiAob2JqLCBrZXksIHZhbCkge1xyXG4gICAgICAgIHZhciBuZXdPYmogPSBmYWxzZTtcclxuICAgICAgICB2YXIgZGF0YSA9IFtdO1xyXG4gICAgICAgICQuZWFjaChvYmosIGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgdmFyIHRlc3RPYmplY3QgPSB0aGlzO1xyXG4gICAgICAgICAgICBpZiAodGVzdE9iamVjdFtrZXldID09PSB2YWwpXHJcbiAgICAgICAgICAgIHsgZGF0YS5wdXNoKHRlc3RPYmplY3QpOyB9XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIHJldHVybiBkYXRhO1xyXG4gICAgfVxyXG5cclxuICAgIHZhciBnZXRUZW1wbGF0ZVVybCA9IGZ1bmN0aW9uIChwYXRoKSB7XHJcbiAgICAgICAgdmFyIGVudmlyb25tZW50ID0gZ2V0QXBwbGljYXRpb25FbnZpcm9ubWVudCgpO1xyXG4gICAgICAgIHZhciB2ZXJzaW9uID0gZ2V0QXBwbGljYXRpb25WZXJzaW9uKCk7XHJcbiAgICAgICAgdmFyIGNhY2hlQnVzdCA9IChuZXcgRGF0ZSgpKS5nZXRUaW1lKCk7XHJcbiAgICAgICAgaWYgKGVudmlyb25tZW50ID09PSBcInByb2R1Y3Rpb25cIilcclxuICAgICAgICAgICAgY2FjaGVCdXN0ID0gdmVyc2lvbi5zcGxpdCgnLicpLmpvaW4oJycpOyAvL3ZlcnNpb247XHJcbiAgICAgICAgdmFyIHJldHVyblVybCA9IFwiXCI7XHJcbiAgICAgICAgcGF0aCA9IHBhdGgudG9Mb3dlckNhc2UoKTtcclxuXHJcbiAgICAgICAgdmFyIHRlbXBsYXRlQXBwUGF0aCA9IChlbnZpcm9ubWVudCA9PT0gXCJwcm9kdWN0aW9uXCIpID8gXCIvcGFydGlhbHMvXCIgOiBcImFwcC9cIjtcclxuICAgICAgICB2YXIgdGVtcGxhdGVFeHRQYXRoID0gKGVudmlyb25tZW50ID09PSBcInByb2R1Y3Rpb25cIikgPyBcIi9wYXJ0aWFscy9cIiA6IFwiZXh0LW1vZHVsZXMvXCI7XHJcbiAgICAgICAgaWYgKHBhdGggPT09IFwia2VuZG9tdWx0aXNlbGVjdFwiKSB7XHJcbiAgICAgICAgICAgIHJldHVyblVybCA9IHRlbXBsYXRlQXBwUGF0aCArICdrZW5kb211bHRpc2VsZWN0L2tlbmRvbXVsdGlzZWxlY3QuaHRtbCc7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2UgaWYgKHBhdGggPT09IFwiZGFzaGJvYXJkXCIpIHtcclxuICAgICAgICAgICAgcmV0dXJuVXJsID0gdGVtcGxhdGVBcHBQYXRoICsgJ2Rhc2hib2FyZC9kYXNoYm9hcmRUZW1wbGF0ZS5odG1sJztcclxuICAgICAgICB9IGVsc2UgaWYgKHBhdGggPT09IFwiNDA0XCIpIHtcclxuICAgICAgICAgICAgcmV0dXJuVXJsID0gdGVtcGxhdGVBcHBQYXRoICsgJzQwNC80MDQuaHRtbCc7XHJcbiAgICAgICAgfSBlbHNlIGlmIChwYXRoID09PSBcInNvcnRcIikge1xyXG4gICAgICAgICAgICByZXR1cm5VcmwgPSB0ZW1wbGF0ZUFwcFBhdGggKyAnc29ydC9zb3J0Lmh0bWwnO1xyXG4gICAgICAgIH0gZWxzZSBpZiAocGF0aCA9PT0gXCJoYXphcmRtYW5hZ2VtZW50XCIpIHtcclxuICAgICAgICAgICAgcmV0dXJuVXJsID0gdGVtcGxhdGVBcHBQYXRoICsgJ2hhemFyZG1hbmFnZW1lbnQvaGF6YXJkbWFuYWdlbWVudC5odG1sJztcclxuICAgICAgICB9IGVsc2UgaWYgKHBhdGggPT09IFwic29ydHBhZ2UxXCIpIHtcclxuICAgICAgICAgICAgcmV0dXJuVXJsID0gdGVtcGxhdGVBcHBQYXRoICsgJ3NvcnQvcGFnZTEvcGFnZTEuaHRtbCc7XHJcbiAgICAgICAgfSBlbHNlIGlmIChwYXRoID09PSBcInNvcnRwYWdlMlwiKSB7XHJcbiAgICAgICAgICAgIHJldHVyblVybCA9IHRlbXBsYXRlQXBwUGF0aCArICdzb3J0L3BhZ2UyL3BhZ2UyLmh0bWwnO1xyXG4gICAgICAgIH0gZWxzZSBpZiAocGF0aCA9PT0gXCJzb3J0cGFnZTJncm91bmRtYXJpbmVsYW5kXCIpIHtcclxuICAgICAgICAgICAgcmV0dXJuVXJsID0gdGVtcGxhdGVBcHBQYXRoICsgJ3NvcnQvcGFnZTIvZ3JvdW5kLm1hcmluZS5sYW5kLmh0bWwnO1xyXG4gICAgICAgIH0gZWxzZSBpZiAocGF0aCA9PT0gXCJzb3J0cGFnZTNcIikge1xyXG4gICAgICAgICAgICByZXR1cm5VcmwgPSB0ZW1wbGF0ZUFwcFBhdGggKyAnc29ydC9wYWdlMy9wYWdlMy5odG1sJztcclxuICAgICAgICB9IGVsc2UgaWYgKHBhdGggPT09IFwic29ydHBhZ2UzZXF1aXBtZW50ZGV0YWlsc1wiKSB7XHJcbiAgICAgICAgICAgIHJldHVyblVybCA9IHRlbXBsYXRlQXBwUGF0aCArICdzb3J0L3BhZ2UzL2VxdWlwbWVudGRldGFpbHMuaHRtbCc7XHJcbiAgICAgICAgfSBlbHNlIGlmIChwYXRoID09PSBcInNvcnRjb25maWd1cmF0aW9uXCIpIHtcclxuICAgICAgICAgICAgcmV0dXJuVXJsID0gdGVtcGxhdGVBcHBQYXRoICsgJ3NvcnQvc29ydGNvbmZpZ3VyYXRpb24vc29ydGNvbmZpZ3VyYXRpb24uaHRtbCc7XHJcbiAgICAgICAgfSBlbHNlIGlmIChwYXRoID09PSBcImFjdGlvbnN0cmFja2VyXCIpIHtcclxuICAgICAgICAgICAgcmV0dXJuVXJsID0gdGVtcGxhdGVBcHBQYXRoICsgJ3NvcnQvYWN0aW9uc3RyYWNrZXIvYWN0aW9uc3RyYWNrZXIuaHRtbCc7XHJcbiAgICAgICAgfSBlbHNlIGlmIChwYXRoID09PSBcInNvcnRtYW5hZ2VtZW50XCIpIHtcclxuICAgICAgICAgICAgcmV0dXJuVXJsID0gdGVtcGxhdGVBcHBQYXRoICsgJ3NvcnRtYW5hZ2VtZW50L3NvcnRtYW5hZ2VtZW50Lmh0bWwnO1xyXG4gICAgICAgIH0gZWxzZSBpZiAocGF0aCA9PT0gXCJlZGFcIikge1xyXG4gICAgICAgICAgICByZXR1cm5VcmwgPSB0ZW1wbGF0ZUFwcFBhdGggKyAnZWRhL2VkYS5odG1sJztcclxuICAgICAgICB9IGVsc2UgaWYgKHBhdGggPT09IFwiZWRhbWFuYWdlbWVudFwiKSB7XHJcbiAgICAgICAgICAgIHJldHVyblVybCA9IHRlbXBsYXRlQXBwUGF0aCArICdlZGFtYW5hZ2VtZW50L2VkYW1hbmFnZW1lbnQuaHRtbCc7XHJcbiAgICAgICAgfSBlbHNlIGlmIChwYXRoID09PSBcImhhemFyZHN5c3RlbWNvbmZpZ1wiKSB7XHJcbiAgICAgICAgICAgIHJldHVyblVybCA9IHRlbXBsYXRlQXBwUGF0aCArICdoYXphcmRtYW5hZ2VtZW50L2hhemFyZHN5c3RlbWNvbmZpZy9oYXphcmRzeXN0ZW1jb25maWcuaHRtbCc7XHJcbiAgICAgICAgfSBlbHNlIGlmIChwYXRoID09PSBcImNvbnRyb2xtYW5hZ2VtZW50XCIpIHtcclxuICAgICAgICAgICAgcmV0dXJuVXJsID0gdGVtcGxhdGVBcHBQYXRoICsgJ2NvbnRyb2xtYW5hZ2VtZW50L2NvbnRyb2xtYW5hZ2VtZW50Lmh0bWwnO1xyXG4gICAgICAgIH0gZWxzZSBpZiAocGF0aCA9PT0gXCJyaXNrYWdncmVnYXRpb25cIikge1xyXG4gICAgICAgICAgICByZXR1cm5VcmwgPSB0ZW1wbGF0ZUFwcFBhdGggKyAncmlza2FnZ3JlZ2F0aW9uL3Jpc2thZ2dyZWdhdGlvbi5odG1sJztcclxuICAgICAgICB9IGVsc2UgaWYgKHBhdGggPT09IFwiaGF6YXJkaW1wb3J0XCIpIHtcclxuICAgICAgICAgICAgcmV0dXJuVXJsID0gdGVtcGxhdGVBcHBQYXRoICsgJ2hhemFyZGltcG9ydC9oYXphcmRpbXBvcnQuaHRtbCc7XHJcbiAgICAgICAgfSBlbHNlIGlmIChwYXRoID09PSBcImJvd3RpZVwiKSB7XHJcbiAgICAgICAgICAgIHJldHVyblVybCA9IHRlbXBsYXRlQXBwUGF0aCArICdib3d0aWVhbmFseXNpcy9ib3d0aWUuaHRtbCc7XHJcbiAgICAgICAgfSBlbHNlIGlmIChwYXRoID09PSBcImhhemFyZHJlcG9ydHNcIikge1xyXG4gICAgICAgICAgICByZXR1cm5VcmwgPSB0ZW1wbGF0ZUFwcFBhdGggKyAnaGF6YXJkcmVwb3J0cy9oYXphcmRyZXBvcnRzLmh0bWwnO1xyXG4gICAgICAgIH0gZWxzZSBpZiAocGF0aCA9PT0gXCJzb3J0cmVwb3J0c1wiKSB7XHJcbiAgICAgICAgICAgIHJldHVyblVybCA9IHRlbXBsYXRlQXBwUGF0aCArICdzb3J0cmVwb3J0cy9zb3J0cmVwb3J0cy5odG1sJztcclxuICAgICAgICB9IGVsc2UgaWYgKHBhdGggPT09IFwicHNtbWNvbmZpZ3VyYXRpb25cIikge1xyXG4gICAgICAgICAgICByZXR1cm5VcmwgPSB0ZW1wbGF0ZUFwcFBhdGggKyAncHNtbWNvbmZpZ3VyYXRpb24vcHNtbWNvbmZpZ3VyYXRpb24uaHRtbCc7XHJcbiAgICAgICAgfSBlbHNlIGlmIChwYXRoID09PSBcInBzbW1jb21wbGlhbmNlXCIpIHtcclxuICAgICAgICAgICAgcmV0dXJuVXJsID0gdGVtcGxhdGVBcHBQYXRoICsgJ3BzbW1jb21wbGlhbmNlL3BzbW1jb21wbGlhbmNlLmh0bWwnO1xyXG4gICAgICAgIH0gZWxzZSBpZiAocGF0aCA9PT0gXCJwc21tbWF0dXJpdHlcIikge1xyXG4gICAgICAgICAgICByZXR1cm5VcmwgPSB0ZW1wbGF0ZUFwcFBhdGggKyAncHNtbW1hdHVyaXR5L3BzbW1tYXR1cml0eS5odG1sJztcclxuICAgICAgICB9IGVsc2UgaWYgKHBhdGggPT09IFwicHNtbXJlcG9ydHNcIikge1xyXG4gICAgICAgICAgICByZXR1cm5VcmwgPSB0ZW1wbGF0ZUFwcFBhdGggKyAncHNtbXJlcG9ydHMvcHNtbXJlcG9ydHMuaHRtbCc7XHJcbiAgICAgICAgfSBlbHNlIGlmIChwYXRoID09PSBcImFkbWlucmVwb3J0c1wiKSB7XHJcbiAgICAgICAgICAgIHJldHVyblVybCA9IHRlbXBsYXRlQXBwUGF0aCArICdhZG1pbnJlcG9ydHMvYWRtaW5yZXBvcnRzLmh0bWwnO1xyXG4gICAgICAgIH0gZWxzZSBpZiAocGF0aCA9PT0gXCJtcnJcIikge1xyXG4gICAgICAgICAgICByZXR1cm5VcmwgPSB0ZW1wbGF0ZUFwcFBhdGggKyAnZm9ybS9tcnIvbXJyLmh0bWwnO1xyXG4gICAgICAgIH0gZWxzZSBpZiAocGF0aCA9PT0gXCJmb2NcIikge1xyXG4gICAgICAgICAgICByZXR1cm5VcmwgPSB0ZW1wbGF0ZUFwcFBhdGggKyAnZm9ybS9mbGlnaHRvcGVyYXRpb25jYXVzZS9mb2MuaHRtbCc7XHJcbiAgICAgICAgfSBlbHNlIGlmIChwYXRoID09PSBcImZvcm1jb25maWd1cmF0aW9uXCIpIHtcclxuICAgICAgICAgICAgcmV0dXJuVXJsID0gdGVtcGxhdGVBcHBQYXRoICsgJ2Zvcm0vZm9ybWNvbmZpZ3VyYXRpb24vZm9ybWNvbmZpZ3VyYXRpb24uaHRtbCc7XHJcbiAgICAgICAgfSBlbHNlIGlmIChwYXRoID09PSBcImZvcm1zXCIpIHtcclxuICAgICAgICAgICAgcmV0dXJuVXJsID0gdGVtcGxhdGVBcHBQYXRoICsgJ2Zvcm1zL2Zvcm1zLmh0bWwnO1xyXG4gICAgICAgIH0gZWxzZSBpZiAocGF0aCA9PT0gXCJyZWZlcmVuY2VtYW5hZ2VtZW50XCIpIHtcclxuICAgICAgICAgICAgcmV0dXJuVXJsID0gdGVtcGxhdGVBcHBQYXRoICsgJ3JlZmVyZW5jZW1hbmFnZW1lbnQvcmVmZXJlbmNlbWFuYWdlbWVudC5odG1sJztcclxuICAgICAgICB9IGVsc2UgaWYgKHBhdGggPT09IFwidGlsZXNcIikge1xyXG4gICAgICAgICAgICByZXR1cm5VcmwgPSB0ZW1wbGF0ZUFwcFBhdGggKyAndGlsZXMvdGlsZXMuaHRtbCc7XHJcbiAgICAgICAgfSBlbHNlIGlmIChwYXRoID09PSBcInVzZXJtYW5hZ2VtZW50XCIpIHtcclxuICAgICAgICAgICAgcmV0dXJuVXJsID0gdGVtcGxhdGVBcHBQYXRoICsgJ3VzZXJtYW5hZ2VtZW50L3VzZXJtYW5hZ2VtZW50Lmh0bWwnO1xyXG4gICAgICAgIH0gZWxzZSBpZiAocGF0aCA9PT0gXCJyb2xlbWFuYWdlbWVudFwiKSB7XHJcbiAgICAgICAgICAgIHJldHVyblVybCA9IHRlbXBsYXRlQXBwUGF0aCArICdyb2xlbWFuYWdlbWVudC9yb2xlbWFuYWdlbWVudC5odG1sJztcclxuICAgICAgICB9IGVsc2UgaWYgKHBhdGggPT09IFwidXNlcmFjY2Vzc3JpZ2h0c1wiKSB7XHJcbiAgICAgICAgICAgIHJldHVyblVybCA9IHRlbXBsYXRlQXBwUGF0aCArICd1c2VyYWNjZXNzcmlnaHRzL3VzZXJhY2Nlc3NyaWdodHMuaHRtbCc7XHJcbiAgICAgICAgfSBlbHNlIGlmIChwYXRoID09PSBcIm1hc3RlcmNvbmZpZ3VyYXRpb25cIikge1xyXG4gICAgICAgICAgICByZXR1cm5VcmwgPSB0ZW1wbGF0ZUFwcFBhdGggKyAnbWFzdGVyY29uZmlndXJhdGlvbi9tYXN0ZXJjb25maWd1cmF0aW9uLmh0bWwnO1xyXG4gICAgICAgIH0gZWxzZSBpZiAocGF0aCA9PT0gXCJhY3Rpb25sb2dcIikge1xyXG4gICAgICAgICAgICByZXR1cm5VcmwgPSB0ZW1wbGF0ZUFwcFBhdGggKyAnYWN0aW9ubG9nL2FjdGlvbmxvZy5odG1sJztcclxuICAgICAgICB9IGVsc2UgaWYgKHBhdGggPT09IFwibm90aWZpY2F0aW9uc2V0dXBcIikge1xyXG4gICAgICAgICAgICByZXR1cm5VcmwgPSB0ZW1wbGF0ZUFwcFBhdGggKyAnbm90aWZpY2F0aW9uc2V0dXAvbm90aWZpY2F0aW9uc2V0dXAuaHRtbCc7XHJcbiAgICAgICAgfSBlbHNlIGlmIChwYXRoID09PSBcIm5vdGlmaWNhdGlvbnNcIikge1xyXG4gICAgICAgICAgICByZXR1cm5VcmwgPSB0ZW1wbGF0ZUFwcFBhdGggKyAnbm90aWZpY2F0aW9ucy9ub3RpZmljYXRpb25zLmh0bWwnO1xyXG4gICAgICAgIH0gZWxzZSBpZiAocGF0aCA9PT0gXCJ1c2VyaW1wb3J0XCIpIHtcclxuICAgICAgICAgICAgcmV0dXJuVXJsID0gdGVtcGxhdGVBcHBQYXRoICsgJ3VzZXJpbXBvcnQvdXNlcmltcG9ydC5odG1sJztcclxuICAgICAgICB9IGVsc2UgaWYgKHBhdGggPT09IFwicXVhcmFudGluZVwiKSB7XHJcbiAgICAgICAgICAgIHJldHVyblVybCA9IHRlbXBsYXRlQXBwUGF0aCArICdxdWFyYW50aW5lL3F1YXJhbnRpbmUuaHRtbCc7XHJcbiAgICAgICAgfSBlbHNlIGlmIChwYXRoID09PSBcInVzZXJwcm9maWxlXCIpIHtcclxuICAgICAgICAgICAgcmV0dXJuVXJsID0gdGVtcGxhdGVBcHBQYXRoICsgJ3VzZXJwcm9maWxlL3VzZXJwcm9maWxlLmh0bWwnO1xyXG4gICAgICAgIH0gZWxzZSBpZiAocGF0aCA9PT0gXCJjaGFuZ2VwYXNzd29yZFwiKSB7XHJcbiAgICAgICAgICAgIHJldHVyblVybCA9IHRlbXBsYXRlQXBwUGF0aCArICdjaGFuZ2VwYXNzd29yZC9jaGFuZ2VwYXNzd29yZC5odG1sJztcclxuICAgICAgICB9IGVsc2UgaWYgKHBhdGggPT09IFwiZGFzaGJvYXJkbWFuYWdlbWVudFwiKSB7XHJcbiAgICAgICAgICAgIHJldHVyblVybCA9IHRlbXBsYXRlQXBwUGF0aCArICdkYXNoYm9hcmRtYW5hZ2VtZW50L2Rhc2hib2FyZG1hbmFnZW1lbnQuaHRtbCc7XHJcbiAgICAgICAgfSBlbHNlIGlmIChwYXRoID09PSBcImRhc2hib2FyZHJlcG9ydHNcIikge1xyXG4gICAgICAgICAgICByZXR1cm5VcmwgPSB0ZW1wbGF0ZUFwcFBhdGggKyAnZGFzaGJvYXJkcmVwb3J0cy9kYXNoYm9hcmRyZXBvcnRzLmh0bWwnO1xyXG4gICAgICAgIH0gZWxzZSBpZiAocGF0aCA9PT0gXCJuZXdzXCIpIHtcclxuICAgICAgICAgICAgcmV0dXJuVXJsID0gdGVtcGxhdGVBcHBQYXRoICsgJ25ld3MvbmV3cy5odG1sJztcclxuICAgICAgICB9IGVsc2UgaWYgKHBhdGggPT09IFwibm90aWZpY2F0aW9ubWFzdGVyXCIpIHtcclxuICAgICAgICAgICAgcmV0dXJuVXJsID0gdGVtcGxhdGVBcHBQYXRoICsgJ25vdGlmaWNhdGlvbm1hc3Rlci9ub3RpZmljYXRpb25tYXN0ZXIuaHRtbCc7XHJcblxyXG4gICAgICAgIH0gZWxzZSBpZiAocGF0aCA9PT0gXCJuZXdjb250cm9sXCIpIHtcclxuICAgICAgICAgICAgcmV0dXJuVXJsID0gdGVtcGxhdGVBcHBQYXRoICsgJ2NvbnRyb2xtYW5hZ2VtZW50L25ld2NvbnRyb2wvbmV3Y29udHJvbC5odG1sJztcclxuICAgICAgICB9IGVsc2UgaWYgKHBhdGggPT09IFwibWFpbmNvbnRyb2xcIikge1xyXG4gICAgICAgICAgICByZXR1cm5VcmwgPSB0ZW1wbGF0ZUFwcFBhdGggKyAnY29udHJvbG1hbmFnZW1lbnQvbmV3Y29udHJvbC9tYWluY29udHJvbC5odG1sJztcclxuICAgICAgICB9IGVsc2UgaWYgKHBhdGggPT09IFwiZGFzaGJvYXJkZGV0YWlsc1wiKSB7XHJcbiAgICAgICAgICAgIHJldHVyblVybCA9IHRlbXBsYXRlQXBwUGF0aCArICdkYXNoYm9hcmRkZXRhaWxzL2Rhc2hib2FyZGRldGFpbHMuaHRtbCc7XHJcbiAgICAgICAgfSBlbHNlIGlmIChwYXRoID09PSBcImRlbGV0ZVwiKSB7XHJcbiAgICAgICAgICAgIHJldHVyblVybCA9IHRlbXBsYXRlQXBwUGF0aCArICdkZWxldGUvZGVsZXRlLmh0bWwnO1xyXG4gICAgICAgIH0gZWxzZSBpZiAocGF0aCA9PT0gXCJjZm1haW50ZW5hbmNlaHVtYW5mYWN0b3JzXCIpIHtcclxuICAgICAgICAgICAgcmV0dXJuVXJsID0gdGVtcGxhdGVBcHBQYXRoICsgJ2VkYS9jZm1haW50ZW5hbmNlaHVtYW5mYWN0b3JzL2NmbWFpbnRlbmFuY2VodW1hbmZhY3RvcnMuaHRtbCc7XHJcbiAgICAgICAgfSBlbHNlIGlmIChwYXRoID09PSBcImNmcGVyc29uYWxpbmp1cnlcIikge1xyXG4gICAgICAgICAgICByZXR1cm5VcmwgPSB0ZW1wbGF0ZUFwcFBhdGggKyAnZWRhL2NmcGVyc29uYWxpbmp1cnkvY2ZwZXJzb25hbGluanVyeS5odG1sJztcclxuICAgICAgICB9IGVsc2UgaWYgKHBhdGggPT09IFwiY29udHJpYnV0aW5nZmFjdG9yc2NoZWNrbGlzdFwiKSB7XHJcbiAgICAgICAgICAgIHJldHVyblVybCA9IHRlbXBsYXRlQXBwUGF0aCArICdlZGEvY29udHJpYnV0aW5nZmFjdG9yc2NoZWNrbGlzdC9jb250cmlidXRpbmdmYWN0b3JzY2hlY2tsaXN0Lmh0bWwnO1xyXG4gICAgICAgIH0gZWxzZSBpZiAocGF0aCA9PT0gXCJlcnJvcnByZXZlbnRpb25zdHJhdGVnaWVzXCIpIHtcclxuICAgICAgICAgICAgcmV0dXJuVXJsID0gdGVtcGxhdGVBcHBQYXRoICsgJ2VkYS9lcnJvcnByZXZlbnRpb25zdHJhdGVnaWVzL2Vycm9ycHJldmVudGlvbnN0cmF0ZWdpZXMuaHRtbCc7XHJcbiAgICAgICAgfSBlbHNlIGlmIChwYXRoID09PSBcImdlbmVyYWxpbmZvcm1hdGlvblwiKSB7XHJcbiAgICAgICAgICAgIHJldHVyblVybCA9IHRlbXBsYXRlQXBwUGF0aCArICdlZGEvZ2VuZXJhbGluZm9ybWF0aW9uL2dlbmVyYWxpbmZvcm1hdGlvbi5odG1sJztcclxuICAgICAgICB9IGVsc2UgaWYgKHBhdGggPT09IFwib2NjdXJyZW5jZVwiKSB7XHJcbiAgICAgICAgICAgIHJldHVyblVybCA9IHRlbXBsYXRlQXBwUGF0aCArICdlZGEvb2NjdXJyZW5jZS9vY2N1cnJlbmNlLmh0bWwnO1xyXG4gICAgICAgIH0gZWxzZSBpZiAocGF0aCA9PT0gXCJzdW1tYXJ5XCIpIHtcclxuICAgICAgICAgICAgcmV0dXJuVXJsID0gdGVtcGxhdGVBcHBQYXRoICsgJ2VkYS9zdW1tYXJ5L3N1bW1hcnkuaHRtbCc7XHJcbiAgICAgICAgfSBlbHNlIGlmIChwYXRoID09PSBcImNhdXNlYW5hbHlzaXNcIikge1xyXG4gICAgICAgICAgICByZXR1cm5VcmwgPSB0ZW1wbGF0ZUFwcFBhdGggKyAnaGF6YXJkbWFuYWdlbWVudC9jYXVzZWFuYWx5c2lzL2NhdXNlYW5hbHlzaXMuaHRtbCc7XHJcbiAgICAgICAgfSBlbHNlIGlmIChwYXRoID09PSBcImNhdXNlZGV0YWlsc1wiKSB7XHJcbiAgICAgICAgICAgIHJldHVyblVybCA9IHRlbXBsYXRlQXBwUGF0aCArICdoYXphcmRtYW5hZ2VtZW50L2NhdXNlZGV0YWlscy9jYXVzZWRldGFpbHMuaHRtbCc7XHJcbiAgICAgICAgfSBlbHNlIGlmIChwYXRoID09PSBcImhpc3RvcnlcIikge1xyXG4gICAgICAgICAgICByZXR1cm5VcmwgPSB0ZW1wbGF0ZUFwcFBhdGggKyAnaGlzdG9yeS9oaXN0b3J5Lmh0bWwnO1xyXG4gICAgICAgIH0gZWxzZSBpZiAocGF0aCA9PT0gXCJwaG90b3VwbG9hZGVyXCIpIHtcclxuICAgICAgICAgICAgcmV0dXJuVXJsID0gdGVtcGxhdGVBcHBQYXRoICsgJ3Bob3RvL2VnUGhvdG9VcGxvYWRlci5odG1sJztcclxuICAgICAgICB9IGVsc2UgaWYgKHBhdGggPT09IFwicGNjY29tcGxpYW5jZXRlbXBsYXRlc1wiKSB7XHJcbiAgICAgICAgICAgIHJldHVyblVybCA9IHRlbXBsYXRlQXBwUGF0aCArICdwc21tY29uZmlndXJhdGlvbi9wY2Njb21wbGlhbmNldGVtcGxhdGVzL3BjY2NvbXBsaWFuY2V0ZW1wbGF0ZXMuaHRtbCc7XHJcbiAgICAgICAgfSBlbHNlIGlmIChwYXRoID09PSBcInBjY3JlcXVpcmVtZW50c1wiKSB7XHJcbiAgICAgICAgICAgIHJldHVyblVybCA9IHRlbXBsYXRlQXBwUGF0aCArICdwc21tY29uZmlndXJhdGlvbi9wY2NyZXF1aXJlbWVudHMvcGNjcmVxdWlyZW1lbnRzLmh0bWwnO1xyXG4gICAgICAgIH0gZWxzZSBpZiAocGF0aCA9PT0gXCJwbWNsZWFkaW5naW5kaWNhdG9yc2NhbGN1bGF0aW9uXCIpIHtcclxuICAgICAgICAgICAgcmV0dXJuVXJsID0gdGVtcGxhdGVBcHBQYXRoICsgJ3BzbW1jb25maWd1cmF0aW9uL3BtY2xlYWRpbmdpbmRpY2F0b3JzY2FsY3VsYXRpb24vcG1jbGVhZGluZ2luZGljYXRvcnNjYWxjdWxhdGlvbi5odG1sJztcclxuICAgICAgICB9IGVsc2UgaWYgKHBhdGggPT09IFwicG1jbGVhZGluZ2luZGljYXRvcnNzdGF0dXNcIikge1xyXG4gICAgICAgICAgICByZXR1cm5VcmwgPSB0ZW1wbGF0ZUFwcFBhdGggKyAncHNtbWNvbmZpZ3VyYXRpb24vcG1jbGVhZGluZ2luZGljYXRvcnNzdGF0dXMvcG1jbGVhZGluZ2luZGljYXRvcnNzdGF0dXMuaHRtbCc7XHJcbiAgICAgICAgfSBlbHNlIGlmIChwYXRoID09PSBcInBtY3N1YmplY3RpbmRpY2F0b3JcIikge1xyXG4gICAgICAgICAgICByZXR1cm5VcmwgPSB0ZW1wbGF0ZUFwcFBhdGggKyAncHNtbWNvbmZpZ3VyYXRpb24vcG1jc3ViamVjdGluZGljYXRvci9wbWNzdWJqZWN0aW5kaWNhdG9yLmh0bWwnO1xyXG4gICAgICAgIH0gZWxzZSBpZiAocGF0aCA9PT0gXCJwbWN0ZW1wbGF0ZXNcIikge1xyXG4gICAgICAgICAgICByZXR1cm5VcmwgPSB0ZW1wbGF0ZUFwcFBhdGggKyAncHNtbWNvbmZpZ3VyYXRpb24vcG1jdGVtcGxhdGVzL3BtY3RlbXBsYXRlcy5odG1sJztcclxuICAgICAgICB9IGVsc2UgaWYgKHBhdGggPT09IFwicHJvZ3JhbW1lXCIpIHtcclxuICAgICAgICAgICAgcmV0dXJuVXJsID0gdGVtcGxhdGVBcHBQYXRoICsgJ3BzbW1jb25maWd1cmF0aW9uL3Byb2dyYW1tZS9wcm9ncmFtbWUuaHRtbCc7XHJcbiAgICAgICAgfSBlbHNlIGlmIChwYXRoID09PSBcInBzbW1wYW5lbFwiKSB7XHJcbiAgICAgICAgICAgIHJldHVyblVybCA9IHRlbXBsYXRlQXBwUGF0aCArICdwc21tcGFuZWwvcHNtbXBhbmVsLmh0bWwnO1xyXG4gICAgICAgIH0gZWxzZSBpZiAocGF0aCA9PT0gXCJyZWZlcmVuY2VwYWdlXCIpIHtcclxuICAgICAgICAgICAgcmV0dXJuVXJsID0gdGVtcGxhdGVBcHBQYXRoICsgJ3JlZmVyZW5jZW1hbmFnZW1lbnQvZGlyZWN0aXZlcy9yZWZlcmVuY2VwYWdlLmh0bWwnO1xyXG4gICAgICAgIH0gZWxzZSBpZiAocGF0aCA9PT0gXCJzdW1tYXJ5YWNjaWRlbnRzdGF0ZVwiKSB7XHJcbiAgICAgICAgICAgIHJldHVyblVybCA9IHRlbXBsYXRlQXBwUGF0aCArICdyaXNrYWdncmVnYXRpb24vc3VtbWFyeWFjY2lkZW50c3RhdGUvc3VtbWFyeWFjY2lkZW50c3RhdGUuaHRtbCc7XHJcbiAgICAgICAgfSBlbHNlIGlmIChwYXRoID09PSBcInN1bW1hcnloYXphcmRzdGF0ZVwiKSB7XHJcbiAgICAgICAgICAgIHJldHVyblVybCA9IHRlbXBsYXRlQXBwUGF0aCArICdyaXNrYWdncmVnYXRpb24vc3VtbWFyeWhhemFyZHN0YXRlL3N1bW1hcnloYXphcmRzdGF0ZS5odG1sJztcclxuICAgICAgICB9IGVsc2UgaWYgKHBhdGggPT09IFwiYWN0aW9uaW52ZXN0aWdhdGlvblwiKSB7XHJcbiAgICAgICAgICAgIHJldHVyblVybCA9IHRlbXBsYXRlQXBwUGF0aCArICdzb3J0L2FjdGlvbnN0cmFja2VyL2RpcmVjdGl2ZS9hY3Rpb25pbnZlc3RpZ2F0aW9udGVtcGxhdGUuaHRtbCc7XHJcbiAgICAgICAgfSBlbHNlIGlmIChwYXRoID09PSBcImFjdGlvbnN0cmFja2VydGVtcGxhdGVcIikge1xyXG4gICAgICAgICAgICByZXR1cm5VcmwgPSB0ZW1wbGF0ZUFwcFBhdGggKyAnc29ydC9hY3Rpb25zdHJhY2tlci9kaXJlY3RpdmUvYWN0aW9uc3RyYWNrZXJ0ZW1wbGF0ZS5odG1sJztcclxuICAgICAgICB9IGVsc2UgaWYgKHBhdGggPT09IFwiYWlycHJveGltaXR5XCIpIHtcclxuICAgICAgICAgICAgcmV0dXJuVXJsID0gdGVtcGxhdGVBcHBQYXRoICsgJ3NvcnQvYWlycHJveGltaXR5L2FpcnByb3hpbWl0eS5odG1sJztcclxuICAgICAgICB9IGVsc2UgaWYgKHBhdGggPT09IFwiYWlydHJhZmZpY21hbmFnZW1lbnRcIikge1xyXG4gICAgICAgICAgICByZXR1cm5VcmwgPSB0ZW1wbGF0ZUFwcFBhdGggKyAnc29ydC9haXJ0cmFmZmljbWFuYWdlbWVudC9haXJ0cmFmZmljbWFuYWdlbWVudC5odG1sJztcclxuICAgICAgICB9IGVsc2UgaWYgKHBhdGggPT09IFwiYmlyZHN0cmlrZVwiKSB7XHJcbiAgICAgICAgICAgIHJldHVyblVybCA9IHRlbXBsYXRlQXBwUGF0aCArICdzb3J0L2JpcmRzdHJpa2UvYmlyZHN0cmlrZS5odG1sJztcclxuICAgICAgICB9IGVsc2UgaWYgKHBhdGggPT09IFwidGlyZWJ1cnN0XCIpIHtcclxuICAgICAgICAgICAgcmV0dXJuVXJsID0gdGVtcGxhdGVBcHBQYXRoICsgJ3NvcnQvdGlyZWJ1cnN0L3RpcmVidXJzdC5odG1sJztcclxuICAgICAgICB9IGVsc2UgaWYgKHBhdGggPT09IFwic29ydGNsb3NpbmdcIikge1xyXG4gICAgICAgICAgICByZXR1cm5VcmwgPSB0ZW1wbGF0ZUFwcFBhdGggKyAnc29ydGNsb3Npbmcvc29ydGNsb3NpbmcuaHRtbCc7XHJcbiAgICAgICAgfSBlbHNlIGlmIChwYXRoID09PSBcImVkYWludmVzdGlnYXRpb25cIikge1xyXG4gICAgICAgICAgICByZXR1cm5VcmwgPSB0ZW1wbGF0ZUFwcFBhdGggKyAnc29ydGRlY2lzaW9uL2VkYWludmVzdGlnYXRpb24vZWRhaW52ZXN0aWdhdGlvbi5odG1sJztcclxuICAgICAgICB9IGVsc2UgaWYgKHBhdGggPT09IFwic29ydGRlY2lzaW9uXCIpIHtcclxuICAgICAgICAgICAgcmV0dXJuVXJsID0gdGVtcGxhdGVBcHBQYXRoICsgJ3NvcnRkZWNpc2lvbi9zb3J0ZGVjaXNpb24uaHRtbCc7XHJcbiAgICAgICAgfSBlbHNlIGlmIChwYXRoID09PSBcInNvcnRmaW5kaW5nc1wiKSB7XHJcbiAgICAgICAgICAgIHJldHVyblVybCA9IHRlbXBsYXRlQXBwUGF0aCArICdzb3J0ZmluZGluZ3MvZmluZGluZ3MuaHRtbCc7XHJcbiAgICAgICAgfSBlbHNlIGlmIChwYXRoID09PSBcIm15Y291bnR0ZW1wbGF0ZVwiKSB7XHJcbiAgICAgICAgICAgIHJldHVyblVybCA9IHRlbXBsYXRlQXBwUGF0aCArICdkYXNoYm9hcmQvZGlyZWN0aXZlcy9teWNvdW50VGVtcGxhdGUuaHRtbCc7XHJcbiAgICAgICAgfSBlbHNlIGlmIChwYXRoID09PSBcIm15cmVwb3J0dGVtcGxhdGVcIikge1xyXG4gICAgICAgICAgICByZXR1cm5VcmwgPSB0ZW1wbGF0ZUFwcFBhdGggKyAnZGFzaGJvYXJkL2RpcmVjdGl2ZXMvbXlyZXBvcnRUZW1wbGF0ZS5odG1sJztcclxuICAgICAgICB9IGVsc2UgaWYgKHBhdGggPT09IFwibXlyaXNrbWF0cml4dGVtcGxhdGVcIikge1xyXG4gICAgICAgICAgICByZXR1cm5VcmwgPSB0ZW1wbGF0ZUFwcFBhdGggKyAnZGFzaGJvYXJkL2RpcmVjdGl2ZXMvbXlyaXNrbWF0cml4VGVtcGxhdGUuaHRtbCc7XHJcbiAgICAgICAgfSBlbHNlIGlmIChwYXRoID09PSBcIm15c3VtbWFyeXRlbXBsYXRlXCIpIHtcclxuICAgICAgICAgICAgcmV0dXJuVXJsID0gdGVtcGxhdGVBcHBQYXRoICsgJ2Rhc2hib2FyZC9kaXJlY3RpdmVzL215c3VtbWFyeVRlbXBsYXRlLmh0bWwnO1xyXG4gICAgICAgIH0gZWxzZSBpZiAocGF0aCA9PT0gXCJwcm9iYWJpbGl0eVwiKSB7XHJcbiAgICAgICAgICAgIHJldHVyblVybCA9IHRlbXBsYXRlQXBwUGF0aCArICdoYXphcmRtYW5hZ2VtZW50L2hhemFyZHN5c3RlbWNvbmZpZy9wcm9iYWJpbGl0eS9wcm9iYWJpbGl0eS5odG1sJztcclxuICAgICAgICB9IGVsc2UgaWYgKHBhdGggPT09IFwicmlza2NsYXNzXCIpIHtcclxuICAgICAgICAgICAgcmV0dXJuVXJsID0gdGVtcGxhdGVBcHBQYXRoICsgJ2hhemFyZG1hbmFnZW1lbnQvaGF6YXJkc3lzdGVtY29uZmlnL3Jpc2tjbGFzcy9yaXNrY2xhc3MuaHRtbCc7XHJcbiAgICAgICAgfSBlbHNlIGlmIChwYXRoID09PSBcInNldmVyaXR5XCIpIHtcclxuICAgICAgICAgICAgcmV0dXJuVXJsID0gdGVtcGxhdGVBcHBQYXRoICsgJ2hhemFyZG1hbmFnZW1lbnQvaGF6YXJkc3lzdGVtY29uZmlnL3NldmVyaXR5L3NldmVyaXR5Lmh0bWwnO1xyXG4gICAgICAgIH0gZWxzZSBpZiAocGF0aCA9PT0gXCJuYXZjb25jaGFydFwiKSB7XHJcbiAgICAgICAgICAgIHJldHVyblVybCA9IHRlbXBsYXRlQXBwUGF0aCArICd3aWRnZXRzL25hdmNvbkNoYXJ0L25hdmNvbkNoYXJ0VGVtcGxhdGUuaHRtbCc7XHJcblxyXG4gICAgICAgIH0gZWxzZSBpZiAocGF0aCA9PT0gXCJuYXZjb25kYXNoYm9hcmRcIikge1xyXG4gICAgICAgICAgICByZXR1cm5VcmwgPSB0ZW1wbGF0ZUV4dFBhdGggKyAnbmF2Y29uRGFzaGJvYXJkL25hdmNvbkRhc2hib2FyZFRlbXBsYXRlLmh0bWwnO1xyXG4gICAgICAgIH0gZWxzZSBpZiAocGF0aCA9PT0gXCJuYXZjb253aWRnZXRib2R5XCIpIHtcclxuICAgICAgICAgICAgcmV0dXJuVXJsID0gdGVtcGxhdGVFeHRQYXRoICsgJ25hdmNvbkRhc2hib2FyZC9uYXZjb25XaWRnZXRCb2R5VGVtcGxhdGUuaHRtbCc7XHJcbiAgICAgICAgfSBlbHNlIGlmIChwYXRoID09PSBcIm5hdmNvbmRlbGV0ZVwiKSB7XHJcbiAgICAgICAgICAgIHJldHVyblVybCA9IHRlbXBsYXRlRXh0UGF0aCArICduYXZjb25EZWxldGUvbmF2Y29uRGVsZXRlVGVtcGxhdGUuaHRtbCc7XHJcbiAgICAgICAgfSBlbHNlIGlmIChwYXRoID09PSBcIm5hdmNvbmV2YWx1YXRpb25cIikge1xyXG4gICAgICAgICAgICByZXR1cm5VcmwgPSB0ZW1wbGF0ZUV4dFBhdGggKyAnbmF2Y29uRXZhbHVhdGlvbi9uYXZjb25FdmFsdWF0aW9uVGVtcGxhdGUuaHRtbCc7XHJcbiAgICAgICAgfSBlbHNlIGlmIChwYXRoID09PSBcIm5hdmNvbmZvcm1cIikge1xyXG4gICAgICAgICAgICByZXR1cm5VcmwgPSB0ZW1wbGF0ZUV4dFBhdGggKyAnbmF2Y29uRm9ybS9uYXZjb25Gb3JtVGVtcGxhdGUuaHRtbCc7XHJcbiAgICAgICAgfSBlbHNlIGlmIChwYXRoID09PSBcIm5hdmNvbmZyYW1ld29ya1wiKSB7XHJcbiAgICAgICAgICAgIHJldHVyblVybCA9IHRlbXBsYXRlRXh0UGF0aCArICduYXZjb25GcmFtZXdvcmsvbmF2Y29uRnJhbWV3b3JrVGVtcGxhdGUuaHRtbCc7XHJcbiAgICAgICAgfSBlbHNlIGlmIChwYXRoID09PSBcIm5hdmNvbnVzZXJwcm9maWxlXCIpIHtcclxuICAgICAgICAgICAgcmV0dXJuVXJsID0gdGVtcGxhdGVFeHRQYXRoICsgJ25hdmNvbkZyYW1ld29yay9uYXZjb25Vc2VyUHJvZmlsZS9uYXZjb25Vc2VyUHJvZmlsZVRlbXBsYXRlLmh0bWwnO1xyXG4gICAgICAgIH0gZWxzZSBpZiAocGF0aCA9PT0gXCJuYXZjb251c2VycHJvZmlsZXNtYWxsXCIpIHtcclxuICAgICAgICAgICAgcmV0dXJuVXJsID0gdGVtcGxhdGVFeHRQYXRoICsgJ25hdmNvbkZyYW1ld29yay9uYXZjb25Vc2VyUHJvZmlsZS9uYXZjb25Vc2VyUHJvZmlsZVNtYWxsVGVtcGxhdGUuaHRtbCc7XHJcbiAgICAgICAgfSBlbHNlIGlmIChwYXRoID09PSBcIm5hdmNvbm1lbnVcIikge1xyXG4gICAgICAgICAgICByZXR1cm5VcmwgPSB0ZW1wbGF0ZUV4dFBhdGggKyAnbmF2Y29uTWVudS9uYXZjb25NZW51VGVtcGxhdGUuaHRtbCc7XHJcbiAgICAgICAgfSBlbHNlIGlmIChwYXRoID09PSBcIm5hdmNvbm1lbnVncm91cFwiKSB7XHJcbiAgICAgICAgICAgIHJldHVyblVybCA9IHRlbXBsYXRlRXh0UGF0aCArICduYXZjb25NZW51L25hdmNvbk1lbnVHcm91cFRlbXBsYXRlLmh0bWwnO1xyXG4gICAgICAgIH0gZWxzZSBpZiAocGF0aCA9PT0gXCJuYXZjb25tZW51aXRlbVwiKSB7XHJcbiAgICAgICAgICAgIHJldHVyblVybCA9IHRlbXBsYXRlRXh0UGF0aCArICduYXZjb25NZW51L25hdmNvbk1lbnVJdGVtVGVtcGxhdGUuaHRtbCc7XHJcbiAgICAgICAgfSBlbHNlIGlmIChwYXRoID09PSBcIm5hdmNvbm1vZGFsXCIpIHtcclxuICAgICAgICAgICAgcmV0dXJuVXJsID0gdGVtcGxhdGVFeHRQYXRoICsgJ25hdmNvbk1vZGFsL25hdmNvbk1vZGFsVGVtcGxhdGUuaHRtbCc7XHJcbiAgICAgICAgfSBlbHNlIGlmIChwYXRoID09PSBcIm5hdmNvbnBhZ2ViYXJcIikge1xyXG4gICAgICAgICAgICByZXR1cm5VcmwgPSB0ZW1wbGF0ZUV4dFBhdGggKyAnbmF2Y29uUGFnZWJhci9uYXZjb25QYWdlYmFyVGVtcGxhdGUuaHRtbCc7XHJcbiAgICAgICAgfSBlbHNlIGlmIChwYXRoID09PSBcIm5hdmNvbnBvcnRsZXRcIikge1xyXG4gICAgICAgICAgICByZXR1cm5VcmwgPSB0ZW1wbGF0ZUV4dFBhdGggKyAnbmF2Y29uUG9ydGxldC9uYXZjb25Qb3J0bGV0VGVtcGxhdGUuaHRtbCc7XHJcbiAgICAgICAgfSBlbHNlIGlmIChwYXRoID09PSBcIm5hdmNvbnJhdGluZ1wiKSB7XHJcbiAgICAgICAgICAgIHJldHVyblVybCA9IHRlbXBsYXRlRXh0UGF0aCArICduYXZjb25SYXRpbmcvbmF2Y29uUmF0aW5nVGVtcGxhdGUuaHRtbCc7XHJcbiAgICAgICAgfSBlbHNlIGlmIChwYXRoID09PSBcIm5hdmNvbnJlcG9ydFwiKSB7XHJcbiAgICAgICAgICAgIHJldHVyblVybCA9IHRlbXBsYXRlRXh0UGF0aCArICduYXZjb25SZXBvcnQvbmF2Y29uUmVwb3J0VGVtcGxhdGUuaHRtbCc7XHJcbiAgICAgICAgfSBlbHNlIGlmIChwYXRoID09PSBcIm5hdmNvbnJlcG9ydHBhZ2VcIikge1xyXG4gICAgICAgICAgICByZXR1cm5VcmwgPSB0ZW1wbGF0ZUV4dFBhdGggKyAnbmF2Y29uUmVwb3J0L25hdmNvblJlcG9ydFBhZ2VUZW1wbGF0ZS5odG1sJztcclxuICAgICAgICB9IGVsc2UgaWYgKHBhdGggPT09IFwibmF2Y29udGFibGVcIikge1xyXG4gICAgICAgICAgICByZXR1cm5VcmwgPSB0ZW1wbGF0ZUV4dFBhdGggKyAnbmF2Y29uVGFibGUvbmF2Y29uVGFibGVUZW1wbGF0ZS5odG1sJztcclxuICAgICAgICB9IGVsc2UgaWYgKHBhdGggPT09IFwibmF2Y29udGFibGVlZGl0b3JcIikge1xyXG4gICAgICAgICAgICByZXR1cm5VcmwgPSB0ZW1wbGF0ZUV4dFBhdGggKyAnbmF2Y29uVGFibGVFZGl0b3IvbmF2Y29uVGFibGVFZGl0b3JUZW1wbGF0ZS5odG1sJztcclxuICAgICAgICB9IGVsc2UgaWYgKHBhdGggPT09IFwibmF2Y29udHJlZVwiKSB7XHJcbiAgICAgICAgICAgIHJldHVyblVybCA9IHRlbXBsYXRlRXh0UGF0aCArICduYXZjb25UcmVlL25hdmNvblRyZWVUZW1wbGF0ZS5odG1sJztcclxuICAgICAgICB9IGVsc2UgaWYgKHBhdGggPT09IFwibmF2Y29uZmlsZXVwbG9hZFwiKSB7XHJcbiAgICAgICAgICAgIHJldHVyblVybCA9IHRlbXBsYXRlRXh0UGF0aCArICduYXZjb25VcGxvYWQvbmF2Y29uRmlsZVVwbG9hZFRlbXBsYXRlLmh0bWwnO1xyXG4gICAgICAgIH0gZWxzZSBpZiAocGF0aCA9PT0gXCJuYXZjb25waG90b3VwbG9hZFwiKSB7XHJcbiAgICAgICAgICAgIHJldHVyblVybCA9IHRlbXBsYXRlRXh0UGF0aCArICduYXZjb25VcGxvYWQvbmF2Y29uUGhvdG9VcGxvYWRUZW1wbGF0ZS5odG1sJztcclxuICAgICAgICB9IGVsc2UgaWYgKHBhdGggPT09IFwibG9naW5cIikge1xyXG4gICAgICAgICAgICByZXR1cm5VcmwgPSB0ZW1wbGF0ZUFwcFBhdGggKyAnbG9naW4vbG9naW4uaHRtbCc7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpZiAoZW52aXJvbm1lbnQgIT09IFwicHJvZHVjdGlvblwiKSByZXR1cm5VcmwgKyBcIj92PVwiICsgY2FjaGVCdXN0O1xyXG4gICAgICAgIHJldHVybiByZXR1cm5Vcmw7XHJcbiAgICB9XHJcblxyXG4gICAgdmFyIHBhZ2VDaGFuZ2VzID0gZnVuY3Rpb24gKGZ1bmNQYWdlQ2hhbmdlLCBmdW5jcGFnZVNhdmUsIGNhbGxiYWNrKSB7XHJcbiAgICAgICAgdmFyIGNoYW5nZXMgPSBmdW5jUGFnZUNoYW5nZSgpO1xyXG4gICAgICAgIGlmIChjaGFuZ2VzKSB7XHJcbiAgICAgICAgICAgIEJvb3RzdHJhcERpYWxvZy5zaG93KHtcclxuICAgICAgICAgICAgICAgIHRpdGxlOiAnQ29uZmlybWF0aW9uJyxcclxuICAgICAgICAgICAgICAgIGNsb3NhYmxlOiBmYWxzZSxcclxuICAgICAgICAgICAgICAgIG1lc3NhZ2U6ICdEbyB5b3Ugd2FudCB0byBkaXNjYXJkIHRoZSBjaGFuZ2VzPycsXHJcbiAgICAgICAgICAgICAgICBidXR0b25zOiBbe1xyXG4gICAgICAgICAgICAgICAgICAgIGljb246ICdnbHlwaGljb24gZ2x5cGhpY29uLW9rLWNpcmNsZScsXHJcbiAgICAgICAgICAgICAgICAgICAgbGFiZWw6ICdZZXMnLFxyXG4gICAgICAgICAgICAgICAgICAgIGNzc0NsYXNzOiAnYnRuLXByaW1hcnkgZ3JlZW4nLFxyXG4gICAgICAgICAgICAgICAgICAgIGFjdGlvbjogZnVuY3Rpb24gKGRpYWxvZ0l0c2VsZikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoZnVuY3BhZ2VTYXZlICE9PSB1bmRlZmluZWQgJiYgZnVuY3BhZ2VTYXZlICE9PSBcIlwiKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZnVuY3BhZ2VTYXZlKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGRpYWxvZ0l0c2VsZi5jbG9zZSgpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjYWxsYmFjayhmYWxzZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICBpY29uOiAnZ2x5cGhpY29uIGdseXBoaWNvbi1yZW1vdmUtY2lyY2xlJyxcclxuICAgICAgICAgICAgICAgICAgICBsYWJlbDogJ05vJyxcclxuICAgICAgICAgICAgICAgICAgICBjc3NDbGFzczogJ2J0bi1wcmltYXJ5IHJlZCcsXHJcbiAgICAgICAgICAgICAgICAgICAgYWN0aW9uOiBmdW5jdGlvbiAoZGlhbG9nSXRzZWxmKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGRpYWxvZ0l0c2VsZi5jbG9zZSgpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjYWxsYmFjayh0cnVlKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XVxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICBjYWxsYmFjayhmYWxzZSk7XHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxuXHJcbiAgICB2YXIgZ2V0QXBwbGljYXRpb25WZXJzaW9uID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHZlcnNpb24gPSBcIjEuMC4wXCI7XHJcblxyXG4gICAgICAgIHZhciBuZ0F1dGhTZXR0aW5ncyA9IGFuZ3VsYXIuZWxlbWVudChkb2N1bWVudCkuaW5qZWN0b3IoKS5pbnZva2UoZnVuY3Rpb24gKG5nQXV0aFNldHRpbmdzKSB7IHJldHVybiBuZ0F1dGhTZXR0aW5nczsgfSk7XHJcbiAgICAgICAgdmFyIGxvY2FsU3RvcmFnZVNlcnZpY2UgPSBhbmd1bGFyLmVsZW1lbnQoZG9jdW1lbnQpLmluamVjdG9yKCkuaW52b2tlKGZ1bmN0aW9uIChsb2NhbFN0b3JhZ2VTZXJ2aWNlKSB7IHJldHVybiBsb2NhbFN0b3JhZ2VTZXJ2aWNlOyB9KTtcclxuICAgICAgICB2YXIgYXV0aERhdGEgPSBsb2NhbFN0b3JhZ2VTZXJ2aWNlLmdldCgnYXV0aG9yaXphdGlvbkRhdGEnKTtcclxuICAgICAgICBpZiAoYXV0aERhdGEgIT09IHVuZGVmaW5lZCAmJiBhdXRoRGF0YSAhPT0gbnVsbCkge1xyXG4gICAgICAgICAgICAvL3ZhciB2ZXJzaW9uID0gbmdBdXRoU2V0dGluZ3MudmVyc2lvbjtcclxuICAgICAgICAgICAgdmFyIHZlcnNpb24gPSBhdXRoRGF0YS5TYWZldGFsVmVyc2lvbjtcclxuICAgICAgICAgICAgaWYgKHZlcnNpb24gPT09IHVuZGVmaW5lZCB8fCB2ZXJzaW9uID09PSBcIlwiKVxyXG4gICAgICAgICAgICAgICAgdmVyc2lvbiA9IFwiMS4wLjBcIjtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIHZlcnNpb247XHJcbiAgICB9XHJcblxyXG4gICAgdmFyIGdldEFwcGxpY2F0aW9uRW52aXJvbm1lbnQgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgdmFyIG5nQXV0aFNldHRpbmdzID0gYW5ndWxhci5lbGVtZW50KGRvY3VtZW50KS5pbmplY3RvcigpLmludm9rZShmdW5jdGlvbiAobmdBdXRoU2V0dGluZ3MpIHsgcmV0dXJuIG5nQXV0aFNldHRpbmdzOyB9KTtcclxuICAgICAgICB2YXIgZW52aXJvbm1lbnQgPSBuZ0F1dGhTZXR0aW5ncy5lbnZpcm9ubWVudDtcclxuICAgICAgICBpZiAoZW52aXJvbm1lbnQgPT09IHVuZGVmaW5lZCB8fCBlbnZpcm9ubWVudCA9PT0gXCJcIilcclxuICAgICAgICAgICAgZW52aXJvbm1lbnQgPSBcImRldmVsb3BtZW50XCI7XHJcbiAgICAgICAgcmV0dXJuIGVudmlyb25tZW50LnRvTG93ZXJDYXNlKCk7XHJcbiAgICB9XHJcblxyXG4gICAgdmFyIGdldFBhZ2VDb25maWcgPSBmdW5jdGlvbiAoc2NvcGUsIHBhZ2VDb25maWcsIGZpZWxkQ29uZmlnTmFtZSkge1xyXG4gICAgICAgIGlmIChwYWdlQ29uZmlnICE9PSB1bmRlZmluZWQgJiYgcGFnZUNvbmZpZyAhPT0gbnVsbCAmJiBwYWdlQ29uZmlnICE9PSBcIlwiKSB7XHJcbiAgICAgICAgICAgIC8qYnJlYWRjcnVtYnMqL1xyXG4gICAgICAgICAgICBpZiAocGFnZUNvbmZpZy5icmVhZGNydW1icyAhPT0gdW5kZWZpbmVkICYmIHBhZ2VDb25maWcuYnJlYWRjcnVtYnMgIT09IG51bGwgJiYgc2NvcGUgIT09IHVuZGVmaW5lZCAmJiBzY29wZSAhPT0gbnVsbCAmJiBzY29wZSAhPT0gXCJcIilcclxuICAgICAgICAgICAgICAgIHNjb3BlW1wiYnJlYWRjcnVtYnNcIl0gPSBwYWdlQ29uZmlnLmJyZWFkY3J1bWJzO1xyXG5cclxuICAgICAgICAgICAgLy9GaWVsZCBBc3NpZ25cclxuICAgICAgICAgICAgaWYgKHBhZ2VDb25maWcuZmllbGRzICE9PSB1bmRlZmluZWQgJiYgcGFnZUNvbmZpZy5maWVsZHMgIT09IG51bGwgJiYgcGFnZUNvbmZpZy5maWVsZHMubGVuZ3RoICE9PSAwKSB7XHJcbiAgICAgICAgICAgICAgICAkLm1hcChwYWdlQ29uZmlnLmZpZWxkcywgZnVuY3Rpb24gKGZpZWxkcywgaW5kZXgpIHtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHNjb3BlICE9PSB1bmRlZmluZWQgJiYgc2NvcGUgIT09IG51bGwgJiYgc2NvcGUgIT09IFwiXCIpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgc2NvcGVbaW5kZXhdID0gYW5ndWxhci5jb3B5KGZpZWxkcyk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICB1cGRhdGVGaWVsZHMoc2NvcGVbaW5kZXhdKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vRGF0YSBBc3NpZ25cclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHBhZ2VDb25maWcuZGF0YSAhPT0gdW5kZWZpbmVkICYmIHBhZ2VDb25maWcuZGF0YSAhPT0gbnVsbCAmJiBwYWdlQ29uZmlnLmRhdGEubGVuZ3RoICE9PSAwKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBuYXZjb24uc2F2ZS5sb2FkTGlzdERlZmF1bHREYXRhKHBhZ2VDb25maWcuZGF0YSwgc2NvcGVbaW5kZXhdKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIHVwZGF0ZUZpZWxkcyhwYWdlQ29uZmlnKTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgaWYgKHNjb3BlICE9PSB1bmRlZmluZWQgJiYgc2NvcGUgIT09IG51bGwgJiYgc2NvcGUgIT09IFwiXCIpIHtcclxuXHJcbiAgICAgICAgICAgICAgICAvL1RhYmxlIEFzc2lnblxyXG4gICAgICAgICAgICAgICAgaWYgKHBhZ2VDb25maWcudGFibGVzICE9PSB1bmRlZmluZWQgJiYgcGFnZUNvbmZpZy50YWJsZXMgIT09IG51bGwgJiYgcGFnZUNvbmZpZy50YWJsZXMubGVuZ3RoICE9PSAwKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgJC5tYXAocGFnZUNvbmZpZy50YWJsZXMsIGZ1bmN0aW9uICh0YWJsZSwgaW5kZXgpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgc2NvcGVbaW5kZXhdID0gYW5ndWxhci5jb3B5KHBhZ2VDb25maWcudGFibGVzW2luZGV4XSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgLy9UcmVlIEFzc2lnblxyXG4gICAgICAgICAgICAgICAgaWYgKHBhZ2VDb25maWcudHJlZXMgIT09IHVuZGVmaW5lZCAmJiBwYWdlQ29uZmlnLnRyZWVzICE9PSBudWxsICYmIHBhZ2VDb25maWcudHJlZXMubGVuZ3RoICE9PSAwKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgJC5tYXAocGFnZUNvbmZpZy50cmVlcywgZnVuY3Rpb24gKHRyZWUsIGluZGV4KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHNjb3BlW2luZGV4XSA9IGFuZ3VsYXIuY29weShwYWdlQ29uZmlnLnRyZWVzW2luZGV4XSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgLy90YWJsZUVkaXRvciBBc3NpZ25cclxuICAgICAgICAgICAgICAgIGlmIChwYWdlQ29uZmlnLnRhYmxlRWRpdG9yICE9PSB1bmRlZmluZWQgJiYgcGFnZUNvbmZpZy50YWJsZUVkaXRvciAhPT0gbnVsbCAmJiBwYWdlQ29uZmlnLnRhYmxlRWRpdG9yLmxlbmd0aCAhPT0gMCkge1xyXG4gICAgICAgICAgICAgICAgICAgICQubWFwKHBhZ2VDb25maWcudGFibGVFZGl0b3IsIGZ1bmN0aW9uICh0YWJsZUVkaXRvciwgaW5kZXgpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgc2NvcGVbaW5kZXhdID0gYW5ndWxhci5jb3B5KHBhZ2VDb25maWcudGFibGVFZGl0b3JbaW5kZXhdKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgc2NvcGVbaW5kZXhdLnRhYmxlQWN0aW9uID0ge307XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAodGFibGVFZGl0b3IudGVtcGxhdGVPcHRpb25zLnByaW1hcnlLZXkgIT09IHVuZGVmaW5lZCAmJiB0YWJsZUVkaXRvci50ZW1wbGF0ZU9wdGlvbnMucHJpbWFyeUtleSAhPT0gbnVsbCAmJiB0YWJsZUVkaXRvci50ZW1wbGF0ZU9wdGlvbnMucHJpbWFyeUtleSAhPT0gXCJcIikgc2NvcGVbaW5kZXhdLnByaW1hcnlLZXkgPSB0YWJsZUVkaXRvci50ZW1wbGF0ZU9wdGlvbnMucHJpbWFyeUtleTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRhYmxlRWRpdG9yLnRlbXBsYXRlT3B0aW9ucy5kaXNwbGF5S2V5ICE9PSB1bmRlZmluZWQgJiYgdGFibGVFZGl0b3IudGVtcGxhdGVPcHRpb25zLmRpc3BsYXlLZXkgIT09IG51bGwgJiYgdGFibGVFZGl0b3IudGVtcGxhdGVPcHRpb25zLmRpc3BsYXlLZXkgIT09IFwiXCIpIHNjb3BlW2luZGV4XS5kaXNwbGF5S2V5ID0gdGFibGVFZGl0b3IudGVtcGxhdGVPcHRpb25zLmRpc3BsYXlLZXk7XHJcbiAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIHVwZGF0ZUZpZWxkcyhmaWVsZHMpIHtcclxuICAgICAgICAgICAgaWYgKGZpZWxkQ29uZmlnTmFtZSA9PT0gdW5kZWZpbmVkIHx8IGZpZWxkQ29uZmlnTmFtZSA9PT0gbnVsbCB8fCBmaWVsZENvbmZpZ05hbWUgPT09IFwiXCIpIGZpZWxkQ29uZmlnTmFtZSA9IFwiZmllbGRDb25maWdcIjtcclxuICAgICAgICAgICAgdmFyIGZpZWxkUHJpbWFyeUluZGV4ID0gbmF2Y29uLmdldEl0ZW1JbmRleEJ5UHJvcGVydHkoZmllbGRzLCBmaWVsZENvbmZpZ05hbWUpO1xyXG4gICAgICAgICAgICBpZiAoZmllbGRQcmltYXJ5SW5kZXggIT09IHVuZGVmaW5lZCAmJiBmaWVsZFByaW1hcnlJbmRleCAhPT0gLTEpIHtcclxuICAgICAgICAgICAgICAgIHZhciBmaWVsZERhdGEgPSBmaWVsZHNbZmllbGRQcmltYXJ5SW5kZXhdO1xyXG5cclxuICAgICAgICAgICAgICAgIGlmIChmaWVsZERhdGEucHJpbWFyeUtleSAhPT0gdW5kZWZpbmVkICYmIGZpZWxkRGF0YS5wcmltYXJ5S2V5ICE9PSBudWxsICYmIGZpZWxkRGF0YS5wcmltYXJ5S2V5ICE9PSBcIlwiKSBmaWVsZHMucHJpbWFyeUtleSA9IGZpZWxkRGF0YS5wcmltYXJ5S2V5O1xyXG4gICAgICAgICAgICAgICAgaWYgKGZpZWxkRGF0YS5kaXNwbGF5S2V5ICE9PSB1bmRlZmluZWQgJiYgZmllbGREYXRhLmRpc3BsYXlLZXkgIT09IG51bGwgJiYgZmllbGREYXRhLmRpc3BsYXlLZXkgIT09IFwiXCIpIGZpZWxkcy5kaXNwbGF5S2V5ID0gZmllbGREYXRhLmRpc3BsYXlLZXk7XHJcbiAgICAgICAgICAgICAgICBpZiAoZmllbGREYXRhLmFsdGVybmF0ZVByaW1hcnlLZXkgIT09IHVuZGVmaW5lZCAmJiBmaWVsZERhdGEuYWx0ZXJuYXRlUHJpbWFyeUtleSAhPT0gbnVsbCAmJiBmaWVsZERhdGEuYWx0ZXJuYXRlUHJpbWFyeUtleSAhPT0gXCJcIikgZmllbGRzLmFsdGVybmF0ZVByaW1hcnlLZXkgPSBmaWVsZERhdGEuYWx0ZXJuYXRlUHJpbWFyeUtleTtcclxuICAgICAgICAgICAgICAgIGlmIChmaWVsZERhdGEuYWx0ZXJuYXRlRGlzcGxheUtleSAhPT0gdW5kZWZpbmVkICYmIGZpZWxkRGF0YS5hbHRlcm5hdGVEaXNwbGF5S2V5ICE9PSBudWxsICYmIGZpZWxkRGF0YS5hbHRlcm5hdGVEaXNwbGF5S2V5ICE9PSBcIlwiKSBmaWVsZHMuYWx0ZXJuYXRlRGlzcGxheUtleSA9IGZpZWxkRGF0YS5hbHRlcm5hdGVEaXNwbGF5S2V5O1xyXG4gICAgICAgICAgICAgICAgaWYgKGZpZWxkRGF0YS50aXRsZSAhPT0gdW5kZWZpbmVkICYmIGZpZWxkRGF0YS50aXRsZSAhPT0gbnVsbCAmJiBmaWVsZERhdGEudGl0bGUgIT09IFwiXCIpIGZpZWxkcy50aXRsZSA9IGZpZWxkRGF0YS50aXRsZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH07XHJcblxyXG4gICAgdmFyIGdldFNlcXVlbmNlTm8gPSBmdW5jdGlvbiAob3B0aW9ucywgY2FsbGJhY2spIHtcclxuICAgICAgICB2YXIgcmV0dXJuRGF0YTtcclxuICAgICAgICBpZiAob3B0aW9ucy50YWJsZSAhPT0gdW5kZWZpbmVkICYmIG9wdGlvbnMudGFibGUgIT09IG51bGwpIHtcclxuICAgICAgICAgICAgaWYgKG9wdGlvbnMudGFibGUuY29sdW1uTmFtZSAhPT0gdW5kZWZpbmVkICYmIG9wdGlvbnMudGFibGUuY29sdW1uTmFtZSAhPT0gbnVsbCkge1xyXG4gICAgICAgICAgICAgICAgdmFyIGN1cnJlbnREYXRhID0gMDtcclxuICAgICAgICAgICAgICAgICQubWFwKG9wdGlvbnMudGFibGUsIGZ1bmN0aW9uIChpdGVtLCBpbmRleCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChwYXJzZUludChpdGVtW29wdGlvbnMudGFibGUuY29sdW1uTmFtZV0pID4gcGFyc2VJbnQoY3VycmVudERhdGEpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGN1cnJlbnREYXRhID0gaXRlbVtvcHRpb25zLnRhYmxlLmNvbHVtbk5hbWVdO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgICAgIHJldHVybkRhdGEgPSAoY3VycmVudERhdGEgKyAxKTtcclxuXHJcbiAgICAgICAgICAgICAgICBpZiAob3B0aW9ucy5maWVsZHMgIT09IHVuZGVmaW5lZCAmJiBvcHRpb25zLmZpZWxkcyAhPT0gbnVsbCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChvcHRpb25zLmZpZWxkcy5rZXkgIT09IHVuZGVmaW5lZCAmJiBvcHRpb25zLmZpZWxkcy5rZXkgIT09IG51bGwpIHsvL0ZpZWxkIGtleSBhc3NpZ25lZFxyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgZmllbGRzS2V5SW5kZXggPSBuYXZjb24uZ2V0SXRlbUluZGV4QnlQcm9wZXJ0eShvcHRpb25zLmZpZWxkcywgb3B0aW9ucy5maWVsZHMua2V5KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGZpZWxkc0tleUluZGV4ICE9PSBudWxsICYmIGZpZWxkc0tleUluZGV4ICE9PSAtMSAmJiBmaWVsZHNLZXlJbmRleC5sZW5ndGggIT09IDApIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9wdGlvbnMuZmllbGRzW2ZpZWxkc0tleUluZGV4XS5kYXRhID0gcmV0dXJuRGF0YTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSBlbHNlIHsgLy9ObyB0YWJsZSBjb2x1bW4gYXNzaWduZWRcclxuICAgICAgICAgICAgICAgIHZhciBjdXJyZW50RGF0YSA9IDA7XHJcbiAgICAgICAgICAgICAgICByZXR1cm5EYXRhID0gMDtcclxuXHJcbiAgICAgICAgICAgICAgICBpZiAob3B0aW9ucy50YWJsZS5jb2x1bW5zLmxlbmd0aCAhPT0gMCkgeyAvLyBzZXJpYWxOb0NvbHVtbiBiYXNlZCBkYXRhXHJcbiAgICAgICAgICAgICAgICAgICAgJC5tYXAob3B0aW9ucy50YWJsZS5jb2x1bW5zLCBmdW5jdGlvbiAoaXRlbSwgY29sSW5kZXgpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGl0ZW0uc2VyaWFsTm9Db2x1bW4gIT09IHVuZGVmaW5lZCAmJiBpdGVtLnNlcmlhbE5vQ29sdW1uICE9IG51bGwpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChwYXJzZUludChpdGVtLnNlcmlhbE5vQ29sdW0pID4gcGFyc2VJbnQoY3VycmVudERhdGEpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY3VycmVudERhdGEgPSBpdGVtLnNlcmlhbE5vQ29sdW07XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm5EYXRhID0gKGN1cnJlbnREYXRhICsgMSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgaWYgKG9wdGlvbnMuZmllbGRzICE9PSB1bmRlZmluZWQgJiYgb3B0aW9ucy5maWVsZHMgIT09IG51bGwpIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAob3B0aW9ucy5maWVsZHMua2V5ICE9PSB1bmRlZmluZWQgJiYgb3B0aW9ucy5maWVsZHMua2V5ICE9PSBudWxsKSB7Ly9GaWVsZCBrZXkgYXNzaWduZWRcclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGZpZWxkc0tleUluZGV4ID0gbmF2Y29uLmdldEl0ZW1JbmRleEJ5UHJvcGVydHkob3B0aW9ucy5maWVsZHMsIG9wdGlvbnMuZmllbGRzLmtleSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChmaWVsZHNLZXlJbmRleCAhPT0gbnVsbCAmJiBmaWVsZHNLZXlJbmRleCAhPT0gLTEgJiYgZmllbGRzS2V5SW5kZXgubGVuZ3RoICE9PSAwKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBvcHRpb25zLmZpZWxkc1tmaWVsZHNLZXlJbmRleF0uZGF0YSA9IHJldHVybkRhdGE7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9IGVsc2UgeyAvLyBubyB0YWJsZSBhc3NpZ25lZFxyXG4gICAgICAgICAgICByZXR1cm5EYXRhID0gMDtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGlmIChjYWxsYmFjayAhPT0gdW5kZWZpbmVkKSBjYWxsYmFjayhyZXR1cm5EYXRhKTtcclxuICAgICAgICByZXR1cm4gcmV0dXJuRGF0YTtcclxuICAgIH07XHJcblxyXG4gICAgdmFyIGdldEVtYWlsUGF0dGVybiA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICB2YXIgZW1haWxQYXR0ZXJuID0gXCIoPzpbYS16MC05ISMkJSYnKisvPT9eX2B7fH1+LV0rKD86XFwuW2EtejAtOSEjJCUmJyorLz0/Xl9ge3x9fi1dKykqfCg/OltcXHgwMS1cXHgwOFxceDBiXFx4MGNcXHgwZS1cXHgxZlxceDIxXFx4MjMtXFx4NWJcXHg1ZC1cXHg3Zl18XFxcXFtcXHgwMS1cXHgwOVxceDBiXFx4MGNcXHgwZS1cXHg3Zl0pKilAKD86KD86W2EtejAtOV0oPzpbYS16MC05LV0qW2EtejAtOV0pP1xcLikrW2EtejAtOV0oPzpbYS16MC05LV0qW2EtejAtOV0pP3xcXFsoPzooPzoyNVswLTVdfDJbMC00XVswLTldfFswMV0/WzAtOV1bMC05XT8pXFwuKXszfSg/OjI1WzAtNV18MlswLTRdWzAtOV18WzAxXT9bMC05XVswLTldP3xbYS16MC05LV0qW2EtejAtOV06KD86W1xceDAxLVxceDA4XFx4MGJcXHgwY1xceDBlLVxceDFmXFx4MjEtXFx4NWFcXHg1My1cXHg3Zl18XFxcXFtcXHgwMS1cXHgwOVxceDBiXFx4MGNcXHgwZS1cXHg3Zl0pKylcXF0pXCI7XHJcbiAgICAgICAgcmV0dXJuIGVtYWlsUGF0dGVybjtcclxuICAgIH07XHJcblxyXG4gICAgdmFyIHZpZXdDb250ZW50TG9hZGVkID0gZnVuY3Rpb24gKGNvbmZpZ01lbnUpIHtcclxuICAgICAgICAvLyAkKFwiLnBhZ2UtY29udGFpbmVyXCIpLmNzcyhcIm1hcmdpbi10b3BcIiwgXCJcIik7XHJcbiAgICAgICAgdG9vbFRpcFNldHRpbmcoKTtcclxuICAgICAgICBpbml0RXZlbnRzKCk7XHJcblxyXG4gICAgICAgIGNoYXJ0VG9vbFRpcENsb3NlKGNvbmZpZ01lbnUpO1xyXG5cclxuICAgICAgICAvL3NldFRpbWVvdXQoJyQoXCIucGFnZS1jb250YWluZXJcIikuY3NzKFwibWFyZ2luLXRvcFwiLCBcIjU4cHhcIik7JywgMTAwMClcclxuICAgIH1cclxuXHJcblxyXG5cclxuICAgIGZ1bmN0aW9uIHRvb2xUaXBTZXR0aW5nKCkge1xyXG4gICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAkKCcuZmEuZmEtcHJpbnQnKS5hdHRyKFwiZGF0YS10b2dnbGVcIiwgXCJ0b29sdGlwXCIpO1xyXG4gICAgICAgICAgICAkKCcuZmEuZmEtcHJpbnQnKS5hdHRyKFwiZGF0YS1vcmlnaW5hbC10aXRsZVwiLCBcIlByaW50XCIpO1xyXG4gICAgICAgICAgICAkKCcuZmEuZmEtcHJpbnQnKS5hdHRyKFwiZGF0YS1wbGFjZW1lbnRcIiwgXCJib3R0b21cIik7XHJcblxyXG4gICAgICAgICAgICAkKCcucG9ydGxldCAuY29sbGFwc2UgPiBhJykuYXR0cihcImRhdGEtdG9nZ2xlXCIsIFwidG9vbHRpcFwiKTtcclxuICAgICAgICAgICAgJCgnLnBvcnRsZXQgLmNvbGxhcHNlID4gYScpLmF0dHIoXCJkYXRhLW9yaWdpbmFsLXRpdGxlXCIsIFwiQ29sbGFwc2VcIik7XHJcbiAgICAgICAgICAgICQoJy5wb3J0bGV0IC5jb2xsYXBzZSA+IGEnKS5hdHRyKFwiZGF0YS1wbGFjZW1lbnRcIiwgXCJib3R0b21cIik7XHJcblxyXG4gICAgICAgICAgICAkKCcucG9ydGxldCAuY29sbGFwc2UgPiBhJykuYXR0cihcImRhdGEtdG9nZ2xlXCIsIFwidG9vbHRpcFwiKTtcclxuICAgICAgICAgICAgJCgnLnBvcnRsZXQgLmNvbGxhcHNlID4gYScpLmF0dHIoXCJkYXRhLW9yaWdpbmFsLXRpdGxlXCIsIFwiRXhwYW5kXCIpO1xyXG4gICAgICAgICAgICAkKCcucG9ydGxldCAuY29sbGFwc2UgPiBhJykuYXR0cihcImRhdGEtcGxhY2VtZW50XCIsIFwiYm90dG9tXCIpO1xyXG5cclxuICAgICAgICAgICAgJCgnbGlbZGF0YS10b2dnbGU9XCJ0b29sdGlwXCJdJykudG9vbHRpcCgpO1xyXG4gICAgICAgICAgICAkKCdhW2RhdGEtdG9nZ2xlPVwidG9vbHRpcFwiXScpLnRvb2x0aXAoKTtcclxuXHJcbiAgICAgICAgICAgIGlmICgkKCduYXZjb24tYnV0dG9uJykuYXR0cihcInRleHRcIikgIT09IHVuZGVmaW5lZCAmJiAkKCduYXZjb24tYnV0dG9uJykuYXR0cihcInRleHRcIikudG9Mb3dlckNhc2UoKSA9PT0gXCJjYW5jZWxcIikge1xyXG4gICAgICAgICAgICAgICAgJCgnbmF2Y29uLWJ1dHRvbicpLmF0dHIoXCJ0ZXh0XCIsIFwiQ2FuY2VsXCIpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSwgNTAwKTtcclxuICAgIH1cclxuXHJcbiAgICBmdW5jdGlvbiBpbml0RXZlbnRzKCkge1xyXG4gICAgICAgICQoJy5wb3J0bGV0IC5jb2xsYXBzZScpLm9uKFwiY2xpY2tcIiwgZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICBpZiAoJCh0aGlzKSA9PT0gdW5kZWZpbmVkKSByZXR1cm47XHJcbiAgICAgICAgICAgIGlmICgkKHRoaXMpLmhhc0NsYXNzKCdjb2xsYXBzZScpKVxyXG4gICAgICAgICAgICAgICAgJCh0aGlzKS5hdHRyKFwiZGF0YS1vcmlnaW5hbC10aXRsZVwiLCBcIkV4cGFuZFwiKTtcclxuICAgICAgICAgICAgZWxzZVxyXG4gICAgICAgICAgICAgICAgJCh0aGlzKS5hdHRyKFwiZGF0YS1vcmlnaW5hbC10aXRsZVwiLCBcIkNvbGxhcHNlXCIpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ3Njcm9sbCcsIGZ1bmN0aW9uIChlKSB7XHJcbiAgICAgICAgICAgIGlmICgkKCcuc3AtY29udGFpbmVyJykuaXMoXCI6dmlzaWJsZVwiKSkge1xyXG4gICAgICAgICAgICAgICAgJCgnLnNwLWNvbnRhaW5lcicpLmFkZENsYXNzKFwic3AtaGlkZGVuXCIpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSwgdHJ1ZSk7XHJcbiAgICB9XHJcblxyXG4gICAgZnVuY3Rpb24gY29sb3JwaWNrZXJIaWRlKCkge1xyXG4gICAgICAgICQoJy5zcC1jb250YWluZXInKS5hZGRDbGFzcyhcInNwLWhpZGRlblwiKTtcclxuICAgIH1cclxuXHJcbiAgICB2YXIgcmlza0FnZ3Jlc3Npb25Nb2RhbENsb3NlID0gZnVuY3Rpb24gKGNvbmZpZ0hlYWRlck1lbnUsIGV2ZW50KSB7Ly9ib3d0aWUgcmlza2FnZ3Jlc3Npb24gbW9kYWwgY2xvc2VcclxuICAgICAgICBpZiAoY29uZmlnSGVhZGVyTWVudSAhPT0gdW5kZWZpbmVkICYmIGNvbmZpZ0hlYWRlck1lbnUgIT09IG51bGwgJiYgY29uZmlnSGVhZGVyTWVudS50b0xvd2VyQ2FzZSgpID09PSBcImJvd3RpZWFuYWx5c2lzXCIpIHtcclxuICAgICAgICAgICAgdmFyIHRhcmdldElkID0gZXZlbnQudGFyZ2V0LmlkO1xyXG4gICAgICAgICAgICBpZiAodGFyZ2V0SWQgIT09IHVuZGVmaW5lZCAmJiB0YXJnZXRJZCAhPT0gbnVsbCAmJiB0YXJnZXRJZC50b0xvd2VyQ2FzZSgpID09PSBcImhhemFyZGNsYXNzaWZpY2F0aW9uXCIpIHsvLyAkKFwiLm1vZGFsLmluXCIpLmZpbmQoXCJuYXZjb24tbW9kYWxbaWQ9XCIgKyB0YXJnZXRJZCArIFwiXVwiKS5sZW5ndGggIT09IDApIHtcclxuICAgICAgICAgICAgICAgIHZhciB0YXJnZXRTY29wZSA9ICQoXCIubW9kYWwuaW5cIikuZmluZChcIm5hdmNvbi1tb2RhbFtpZD1cIiArIHRhcmdldElkICsgXCJdXCIpLnNjb3BlKCk7XHJcbiAgICAgICAgICAgICAgICBpZiAodGFyZ2V0U2NvcGUgIT09IHVuZGVmaW5lZCAmJiB0YXJnZXRTY29wZSAhPT0gbnVsbCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBwYXJlbnRTY29wZSA9IHRhcmdldFNjb3BlLiRwYXJlbnQ7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHBhcmVudFNjb3BlICE9PSB1bmRlZmluZWQgJiYgcGFyZW50U2NvcGUgIT09IG51bGwgJiYgcGFyZW50U2NvcGUuY2FuY2VsICE9PSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHR5cGUgPSBwYXJlbnRTY29wZS50eXBlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBwYXJlbnRTY29wZS5jYW5jZWwodHlwZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIGZ1bmN0aW9uIGNoYXJ0VG9vbFRpcENsb3NlKGNvbmZpZ01lbnUpIHtcclxuICAgICAgICBpZiAoY29uZmlnTWVudSAhPT0gdW5kZWZpbmVkICYmIGNvbmZpZ01lbnUgIT09IG51bGwgJiYgY29uZmlnTWVudS50b0xvd2VyQ2FzZSgpID09PSBcImRhc2hib2FyZFwiKSB7XHJcbiAgICAgICAgICAgIGlmICgkKFwiLmNoYXJ0VG9vbFRpcFwiKSAhPT0gdW5kZWZpbmVkICYmICQoXCIuY2hhcnRUb29sVGlwXCIpLmxlbmd0aCAhPT0gMCkge1xyXG5cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0gZWxzZSBpZiAoJChcIiNmdXNpb25jaGFydHMtdG9vbHRpcC1lbGVtZW50XCIpICE9PSB1bmRlZmluZWQgJiYgJChcIiNmdXNpb25jaGFydHMtdG9vbHRpcC1lbGVtZW50XCIpLmxlbmd0aCAhPT0gMCkge1xyXG4gICAgICAgICAgICAkKFwiI2Z1c2lvbmNoYXJ0cy10b29sdGlwLWVsZW1lbnRcIikuaGlkZSgpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICAvLyBSZXZlYWwgcHVibGljIHBvaW50ZXJzIHRvXHJcbiAgICAvLyBwcml2YXRlIGZ1bmN0aW9ucyBhbmQgcHJvcGVydGllc1xyXG5cclxuICAgIHJldHVybiB7XHJcbiAgICAgICAgZ2V0U2l0ZVVSTDogd2ViVXJsLFxyXG4gICAgICAgIGdldFBhZ2VDb25maWc6IGZ1bmN0aW9uIChzY29wZSwgcGFnZUNvbmZpZywgZmllbGRDb25maWdOYW1lKSB7IHJldHVybiBnZXRQYWdlQ29uZmlnKHNjb3BlLCBwYWdlQ29uZmlnLCBmaWVsZENvbmZpZ05hbWUpIH0sXHJcbiAgICAgICAgZ2V0U2VxdWVuY2VObzogZnVuY3Rpb24gKG9wdGlvbnMpIHsgcmV0dXJuIGdldFNlcXVlbmNlTm8ob3B0aW9ucykgfSxcclxuICAgICAgICAvKkZpZWxkcyovXHJcbiAgICAgICAgZ2V0RmllbGRzRGF0YTogZnVuY3Rpb24gKGZpZWxkcykgeyByZXR1cm4gZ2V0RmllbGRzRGF0YShmaWVsZHMpIH0sXHJcbiAgICAgICAgdXBkYXRlRmllbGRzRGF0YTogZnVuY3Rpb24gKGZpZWxkcywgaXRlbSwgJHNjb3BlLCBpc0Rpc2FibGVkLCAkdGltZW91dCkgeyByZXR1cm4gdXBkYXRlRmllbGRzRGF0YShmaWVsZHMsIGl0ZW0sICRzY29wZSwgaXNEaXNhYmxlZCwgJHRpbWVvdXQpIH0sXHJcbiAgICAgICAgY2xlYXJGaWVsZHNEYXRhOiBmdW5jdGlvbiAoZmllbGRzLCAkc2NvcGUsIHVwbG9hZENsZWFyKSB7IGNsZWFyRmllbGRzRGF0YShmaWVsZHMsICRzY29wZSwgdXBsb2FkQ2xlYXIpIH0sXHJcbiAgICAgICAgc2V0RmllbGRGb2N1czogZnVuY3Rpb24gKGZpZWxkcykgeyBzZXRGaWVsZEZvY3VzKGZpZWxkcykgfSxcclxuICAgICAgICBnZXRGaWVsZHNEYXRhVG9TYXZlOiBmdW5jdGlvbiAoZmllbGRzLCBtb2RlLCBrZXksIHVwbG9hZCkgeyByZXR1cm4gZ2V0RmllbGRzRGF0YVRvU2F2ZShmaWVsZHMsIG1vZGUsIGtleSwgdXBsb2FkKSB9LFxyXG4gICAgICAgIC8qVGFibGVzKi9cclxuICAgICAgICBzZXRUYWJsZVNldHRpbmc6IGZ1bmN0aW9uIChlbCwgZGF0YSwgc2NvcGUpIHsgdGFibGVTZXR0aW5nKGVsLCBkYXRhLCBzY29wZSkgfSxcclxuICAgICAgICB0YWJsZVJlZnJlc2g6IGZ1bmN0aW9uIChlbCwgc2V0dGluZywgc2NvcGUpIHsgdGFibGVSZWZyZXNoKGVsLCBzZXR0aW5nLCBzY29wZSkgfSxcclxuICAgICAgICB0YWJsZUNlbGxFZGl0U2V0dGluZzogZnVuY3Rpb24gKHJvdywgY29sdW1uLCBkYXRhLCBjZWxsT2JqLCBvVGFibGUsICRzY29wZSwgJGNvbXBpbGUpIHsgcmV0dXJuIHRhYmxlQ2VsbEVkaXRTZXR0aW5nKHJvdywgY29sdW1uLCBkYXRhLCBjZWxsT2JqLCBvVGFibGUsICRzY29wZSwgJGNvbXBpbGUpIH0sXHJcbiAgICAgICAgZ2V0VGFibGVEYXRhOiBmdW5jdGlvbiAodHlwZSwgaWQsIGNoZWNrZWQsIGtleSwgY2hlY2tlZENvbCwgb2xkRGF0YSwgbW9kZSkgeyByZXR1cm4gZ2V0VGFibGVEYXRhKHR5cGUsIGlkLCBjaGVja2VkLCBrZXksIGNoZWNrZWRDb2wsIG9sZERhdGEsIG1vZGUpIH0sXHJcbiAgICAgICAgZ2V0VGFibGU6IGZ1bmN0aW9uICh0eXBlLCBpZCwgbW9kZSwgZmllbGRzKSB7IHJldHVybiBnZXRUYWJsZUluc3RhbmNlKHR5cGUpIH0sXHJcbiAgICAgICAgY2xlYXJUYWJsZURhdGE6IGZ1bmN0aW9uICh0eXBlLCBkYXRhKSB7IHJldHVybiBjbGVhclRhYmxlRGF0YSh0eXBlLCBkYXRhKSB9LFxyXG4gICAgICAgIHVwZGF0ZVRhYmxlRGF0YTogZnVuY3Rpb24gKHR5cGUsIGRhdGEsIHRhcmdldERhdGEsIGlkKSB7IHVwZGF0ZVRhYmxlRGF0YSh0eXBlLCBkYXRhLCB0YXJnZXREYXRhLCBpZCkgfSxcclxuICAgICAgICBzYXZlVGFibGVzOiBmdW5jdGlvbiAodm0sIGRhdGFzZXJ2aWNlLCB0eXBlLCBmaWVsZHMsIHJlZklkLCByZWZWYWx1ZSwgcG9wdXAsIGNhbGxiYWNrKSB7IHJldHVybiBzYXZlVGFibGVzKHZtLCBkYXRhc2VydmljZSwgdHlwZSwgZmllbGRzLCByZWZJZCwgcmVmVmFsdWUsIHBvcHVwLCBjYWxsYmFjaykgfSxcclxuICAgICAgICBhZGROZXdUYWJsZXM6IGZ1bmN0aW9uICgkc2NvcGUsIHZtLCB0eXBlLCBmaWVsZHMsIHBhZ2VDb25maWcsIGNhbGxiYWNrKSB7IHJldHVybiBhZGROZXdUYWJsZXMoJHNjb3BlLCB2bSwgdHlwZSwgZmllbGRzLCBwYWdlQ29uZmlnLCBjYWxsYmFjaykgfSxcclxuICAgICAgICBlZGl0VGFibGVzOiBmdW5jdGlvbiAoJHNjb3BlLCB2bSwgdHlwZSwgZmllbGRzLCBhY3Rpb24sIGRhdGEsIGNhbGxiYWNrLCBwb3B1cCkgeyByZXR1cm4gZWRpdFRhYmxlcygkc2NvcGUsIHZtLCB0eXBlLCBmaWVsZHMsIGFjdGlvbiwgZGF0YSwgY2FsbGJhY2ssIHBvcHVwKSB9LFxyXG4gICAgICAgIGxvYWRUYWJsZURhdGE6IGZ1bmN0aW9uIChub2RlLCBmaWVsZCwgZmllbGRUeXBlKSB7IHJldHVybiBsb2FkVGFibGVEYXRhKG5vZGUsIGZpZWxkLCBmaWVsZFR5cGUpIH0sXHJcbiAgICAgICAgZ2V0VGFibGVOb3RJbk90aGVyVGFibGU6IGZ1bmN0aW9uIChtb2RlLCBzZWxlY3RlZEl0ZW0sIGNvbGxlY3Rpb25JdGVtLCBwcmltYXJ5S2V5LCBkZWxldGVSb3dJdGVtLCBhc3NpZ25QcmltYXJ5S2V5KSB7IHJldHVybiBnZXRUYWJsZU5vdEluT3RoZXJUYWJsZShtb2RlLCBzZWxlY3RlZEl0ZW0sIGNvbGxlY3Rpb25JdGVtLCBwcmltYXJ5S2V5LCBkZWxldGVSb3dJdGVtLCBhc3NpZ25QcmltYXJ5S2V5KSB9LFxyXG4gICAgICAgIHVwZGF0ZVRhYmxlRWRpdG9yRGF0YTogZnVuY3Rpb24gKGRhdGEsIGZpZWxkLCAkc2NvcGUsIGlzRGlzYWJsZWQsIHZtKSB7IHJldHVybiB1cGRhdGVUYWJsZUVkaXRvckRhdGEoZGF0YSwgZmllbGQsICRzY29wZSwgaXNEaXNhYmxlZCwgdm0pIH0sXHJcbiAgICAgICAgLypUcmVlcyovXHJcbiAgICAgICAgc2V0VHJlZVNldHRpbmc6IGZ1bmN0aW9uIChlbCwgZGF0YSwgc2NvcGUsIGZpZWxkcywgaXNFeHBhbmQpIHsgdHJlZVNldHRpbmcoZWwsIGRhdGEsIHNjb3BlLCBmaWVsZHMsIGlzRXhwYW5kKSB9LFxyXG4gICAgICAgIGNsZWFyVHJlZURhdGE6IGZ1bmN0aW9uICh0eXBlKSB7IGNsZWFyVHJlZURhdGEodHlwZSkgfSxcclxuICAgICAgICB0cmVlRGF0YVJlZnJlc2g6IGZ1bmN0aW9uIChkYXRhLCB0eXBlLCBjYWxsYmFjaykgeyB0cmVlRGF0YVJlZnJlc2goZGF0YSwgdHlwZSwgY2FsbGJhY2spIH0sXHJcbiAgICAgICAgY3JlYXRlVHJlZU5vZGU6IGZ1bmN0aW9uICh0cmVlLCBjdXJyZW50Tm9kZSwgbmV3Tm9kZSwgcG9zaXRpb24pIHsgY3JlYXRlVHJlZU5vZGUodHJlZSwgY3VycmVudE5vZGUsIG5ld05vZGUsIHBvc2l0aW9uKSB9LFxyXG4gICAgICAgIHJlbW92ZVRyZWVOb2RlOiBmdW5jdGlvbiAodHlwZSwgY3VycmVudE5vZGUsIHRyZWVTZXR0aW5ncywgaGFzUGFyZW50RGVsZXRlKSB7IHJlbW92ZVRyZWVOb2RlKHR5cGUsIGN1cnJlbnROb2RlLCB0cmVlU2V0dGluZ3MsIGhhc1BhcmVudERlbGV0ZSkgfSxcclxuICAgICAgICBlZGl0VHJlZU5vZGU6IGZ1bmN0aW9uICh0cmVlLCBjdXJyZW50Tm9kZSwgdGV4dCkgeyBlZGl0VHJlZU5vZGUodHJlZSwgY3VycmVudE5vZGUsIHRleHQpIH0sXHJcbiAgICAgICAgZ2V0VHJlZURhdGE6IGZ1bmN0aW9uICh0eXBlLCBpZCwgbW9kZSwgZmllbGRzKSB7IHJldHVybiBnZXRUcmVlRGF0YSh0eXBlLCBpZCwgbW9kZSwgZmllbGRzKSB9LFxyXG4gICAgICAgIHRyZWVJbnN0YW5jZTogZnVuY3Rpb24gKHR5cGUpIHsgcmV0dXJuIHRyZWVJbnN0YW5jZSh0eXBlKSB9LFxyXG4gICAgICAgIGxvYWRUcmVlRGF0YTogZnVuY3Rpb24gKHR5cGUsIGRhdGEsIHRhcmdldERhdGEpIHsgcmV0dXJuIGxvYWRUcmVlRGF0YSh0eXBlLCBkYXRhLCB0YXJnZXREYXRhKSB9LFxyXG4gICAgICAgIGdldERhdGFGcm9tVHJlZTogZnVuY3Rpb24gKGl0ZW1zLCBkYXRhKSB7IHJldHVybiBnZXREYXRhRnJvbVRyZWUoaXRlbXMsIGRhdGEpIH0sXHJcbiAgICAgICAgdXBkYXRlVHJlZURhdGE6IGZ1bmN0aW9uIChkYXRhLCBpZCwgZmllbGQsIHZhbHVlKSB7IHJldHVybiB1cGRhdGVUcmVlRGF0YShkYXRhLCBpZCwgZmllbGQsIHZhbHVlKSB9LFxyXG4gICAgICAgIHVwZGF0ZVRyZWVOb2RlOiBmdW5jdGlvbiAodHlwZSwgZGF0YSwgdXBkYXRlZE5vZGUsIGNhbGxiYWNrKSB7IHJldHVybiB1cGRhdGVUcmVlTm9kZSh0eXBlLCBkYXRhLCB1cGRhdGVkTm9kZSwgY2FsbGJhY2spIH0sXHJcbiAgICAgICAgaW5zZXJ0Q2hpbGRyZW5UcmVlRGF0YTogZnVuY3Rpb24gKGRhdGEsIGlkLCBub2RlKSB7IHJldHVybiBpbnNlcnRDaGlsZHJlblRyZWVEYXRhKGRhdGEsIGlkLCBub2RlKSB9LFxyXG4gICAgICAgIGNob29zZVRyZWU6IGZ1bmN0aW9uICh0eXBlLCBjaGVja2VkRGF0YSwgdGFyZ2V0VHlwZSwgdGFyZ2V0RGF0YSwgc2NvcGUsIGNhbGxiYWNrLCBpbnNOb2RlKSB7IHJldHVybiBjaG9vc2VUcmVlKHR5cGUsIGNoZWNrZWREYXRhLCB0YXJnZXRUeXBlLCB0YXJnZXREYXRhLCBzY29wZSwgY2FsbGJhY2ssIGluc05vZGUpIH0sXHJcbiAgICAgICAgcmVtb3ZlRXhpc3RzVHJlZU5vZGU6IGZ1bmN0aW9uIChzb3VyY2VUcmVlVHlwZSwgdGFyZ2V0VHJlZVR5cGUsIHNvdXJjZVRyZWVEYXRhLCB0YXJnZXRUcmVlRGF0YSkgeyByZXR1cm4gcmVtb3ZlRXhpc3RzVHJlZU5vZGUoc291cmNlVHJlZVR5cGUsIHRhcmdldFRyZWVUeXBlLCBzb3VyY2VUcmVlRGF0YSwgdGFyZ2V0VHJlZURhdGEpIH0sXHJcbiAgICAgICAgZGlzYWJsZVRyZWVOb2RlQnlJZDogZnVuY3Rpb24gKHNvdXJjZVRyZWUsIGlkLCBzb3VyY2VUcmVlRGF0YSkgeyByZXR1cm4gZGlzYWJsZVRyZWVOb2RlQnlJZChzb3VyY2VUcmVlLCBpZCwgc291cmNlVHJlZURhdGEpIH0sXHJcbiAgICAgICAgZ2V0Tm9kZUZyb21UcmVlRGF0YUJ5RmllbGQ6IGZ1bmN0aW9uIChpdGVtcywgZmllbGQsIHZhbHVlKSB7IHJldHVybiBnZXROb2RlRnJvbVRyZWVEYXRhQnlGaWVsZChpdGVtcywgZmllbGQsIHZhbHVlKSB9LFxyXG4gICAgICAgIGdldENoZWNrZWRUcmVlTm9kZXM6IGZ1bmN0aW9uICh0eXBlKSB7IHJldHVybiBnZXRDaGVja2VkVHJlZU5vZGVzKHR5cGUpIH0sXHJcbiAgICAgICAgZ2V0VHJlZURhdGFCeUlkOiBmdW5jdGlvbiAodHJlZURhdGEsIHBhcmVudElkLCBub2RlVHlwZSkgeyByZXR1cm4gZ2V0VHJlZURhdGFCeUlkKHRyZWVEYXRhLCBwYXJlbnRJZCwgbm9kZVR5cGUpIH0sXHJcbiAgICAgICAgdXBkYXRlVHJlZVNpbmdsZURhdGE6IGZ1bmN0aW9uICh0cmVlLCBjdXJyZW50Tm9kZSwgY29sdW1uTmFtZSwgdGV4dCwgY29sdW1uTm8sIGNvbnRyb2xUeXBlKSB7IHVwZGF0ZVRyZWVTaW5nbGVEYXRhKHRyZWUsIGN1cnJlbnROb2RlLCBjb2x1bW5OYW1lLCB0ZXh0LCBjb2x1bW5ObywgY29udHJvbFR5cGUpIH0sXHJcbiAgICAgICAgLypDYWxlbmRhciovXHJcbiAgICAgICAgY2FsZW5kYXJTZXR0aW5nOiBmdW5jdGlvbiAoZWwsIGRhdGEsIHNjb3BlKSB7IGNhbGVuZGFyU2V0dGluZyhlbCwgZGF0YSwgc2NvcGUpIH0sXHJcbiAgICAgICAgLypQcmludCovXHJcbiAgICAgICAgY2FsbFByaW50OiBmdW5jdGlvbiAocmVwb3J0LCByZXBvcnRJZCwgY2FsbGJhY2spIHsgY2FsbFByaW50KHJlcG9ydCwgcmVwb3J0SWQsIGNhbGxiYWNrKSB9LFxyXG4gICAgICAgIC8qQ2hhcnQqL1xyXG4gICAgICAgIGNoYXJ0U2V0dGluZzogZnVuY3Rpb24gKGVsLCBkYXRhLCBzY29wZSkgeyBjaGFydFNldHRpbmcoZWwsIGRhdGEsIHNjb3BlKSB9LFxyXG4gICAgICAgIC8qUGFnZSovXHJcbiAgICAgICAgcGFnZUNvbnRyb2xBY3Rpb246IGZ1bmN0aW9uICgkc2NvcGUsIG1vZGUsIHRhYmxlRGVmaW5lLCBjYWxsYmFjaykgeyByZXR1cm4gcGFnZUNvbnRyb2xBY3Rpb24oJHNjb3BlLCBtb2RlLCB0YWJsZURlZmluZSwgY2FsbGJhY2spIH0sXHJcbiAgICAgICAgb3Blbk1vZGFsOiBmdW5jdGlvbiAoaWQsIGNhbGxiYWNrKSB7IHJldHVybiBvcGVuTW9kYWwoaWQsIGNhbGxiYWNrKSB9LFxyXG4gICAgICAgIGNsb3NlTW9kYWw6IGZ1bmN0aW9uIChpZCkgeyByZXR1cm4gY2xvc2VNb2RhbChpZCkgfSxcclxuICAgICAgICAvKkNvbW1vbiovXHJcbiAgICAgICAgZ2V0SXRlbUJ5UHJvcGVydHk6IGZ1bmN0aW9uIChpdGVtcywga2V5KSB7IHJldHVybiBnZXRJdGVtQnlQcm9wZXJ0eShpdGVtcywga2V5KSB9LFxyXG4gICAgICAgIGdldEl0ZW1JbmRleEJ5UHJvcGVydHk6IGZ1bmN0aW9uIChpdGVtcywga2V5KSB7IHJldHVybiBnZXRJdGVtSW5kZXhCeVByb3BlcnR5KGl0ZW1zLCBrZXkpIH0sXHJcbiAgICAgICAgZ2V0SXRlbUJ5S2V5VmFsdWU6IGZ1bmN0aW9uIChpdGVtcywga2V5LCB2YWx1ZSwgbG93ZXJjYXNlKSB7IHJldHVybiBnZXRJdGVtQnlLZXlWYWx1ZShpdGVtcywga2V5LCB2YWx1ZSwgbG93ZXJjYXNlKSB9LFxyXG4gICAgICAgIGdldEl0ZW1JbmRleEJ5S2V5VmFsdWU6IGZ1bmN0aW9uIChpdGVtcywga2V5LCB2YWx1ZSkgeyByZXR1cm4gZ2V0SXRlbUluZGV4QnlLZXlWYWx1ZShpdGVtcywga2V5LCB2YWx1ZSkgfSxcclxuICAgICAgICBhZGREYXRhTGlzdDogZnVuY3Rpb24gKHZtLCBmaWVsZHMsIHRhYmxlT3B0aW9ucywgdW5pcXVlS2V5KSB7IHJldHVybiBhZGREYXRhTGlzdCh2bSwgZmllbGRzLCB0YWJsZU9wdGlvbnMsIHVuaXF1ZUtleSkgfSxcclxuICAgICAgICBkZWxldGVEYXRhTGlzdDogZnVuY3Rpb24gKHRhYmxlT3B0aW9ucywgcm93KSB7IGRlbGV0ZURhdGFMaXN0KHRhYmxlT3B0aW9ucywgcm93KSB9LFxyXG4gICAgICAgIGRhdGVDb252ZXJ0OiBmdW5jdGlvbiAoZGF0ZSwgZm9ybWF0KSB7IHJldHVybiBkYXRlQ29udmVydChkYXRlLCBmb3JtYXQpIH0sXHJcbiAgICAgICAgZGF0ZVRvVVRDOiBmdW5jdGlvbiAoZGF0ZSwgZm9ybWF0KSB7IHJldHVybiBkYXRlVG9VVEMoZGF0ZSwgZm9ybWF0KSB9LFxyXG4gICAgICAgIGRhdGVGcm9tVVRDVG9Mb2NhbDogZnVuY3Rpb24gKGRhdGUsIGZvcm1hdCkgeyByZXR1cm4gZGF0ZUZyb21VVENUb0xvY2FsKGRhdGUsIGZvcm1hdCkgfSxcclxuICAgICAgICBnZXRJdGVtc0ZpbHRlckJ5S2V5VmFsdWU6IGZ1bmN0aW9uIChpdGVtcywga2V5LCB2YWx1ZSkgeyByZXR1cm4gZ2V0SXRlbXNGaWx0ZXJCeUtleVZhbHVlKGl0ZW1zLCBrZXksIHZhbHVlKSB9LFxyXG4gICAgICAgIHNldFZhbHVlVG9Db250cm9sOiBmdW5jdGlvbiAodmFsdWUsIHRhcmdldFZhbHVlKSB7IHJldHVybiBzZXRWYWx1ZVRvQ29udHJvbCh2YWx1ZSwgdGFyZ2V0VmFsdWUpIH0sXHJcbiAgICAgICAgaW5zZXJ0Q29udHJvbDogZnVuY3Rpb24gKHR5cGUsIGRhdGEpIHsgcmV0dXJuIGluc2VydENvbnRyb2wodHlwZSwgZGF0YSkgfSxcclxuICAgICAgICBpbnNlcnREZWxldGVkaXRlbXM6IGZ1bmN0aW9uIChuZXdJdGVtcywgb2xkSXRlbXMsIHRhYmxlS2V5LCBjb250cm9sVHlwZSkgeyByZXR1cm4gaW5zZXJ0RGVsZXRlZGl0ZW1zKG5ld0l0ZW1zLCBvbGRJdGVtcywgdGFibGVLZXksIGNvbnRyb2xUeXBlKSB9LFxyXG4gICAgICAgIGxvYWREYXRhOiBmdW5jdGlvbiAobm9kZSwgb2JqKSB7IHJldHVybiBsb2FkRGF0YShub2RlLCBvYmopIH0sXHJcbiAgICAgICAganNvblRyYW5zZm9ybWVkOiBmdW5jdGlvbiAoZGF0YSkgeyByZXR1cm4ganNvblRyYW5zZm9ybWVkKGRhdGEpIH0sXHJcbiAgICAgICAgaGFuZGxlRXJyb3I6IGZ1bmN0aW9uIChlcnJvciwgbG9nZ2VyKSB7IHJldHVybiBoYW5kbGVFcnJvcihlcnJvciwgbG9nZ2VyKSB9LFxyXG4gICAgICAgIGRhdGVGb3JtYXQ6IGZ1bmN0aW9uIChkYXRlLCBmb3JtYXQpIHsgcmV0dXJuIGRhdGVGb3JtYXQoZGF0ZSwgZm9ybWF0KSB9LFxyXG4gICAgICAgIG1lbnVSaWdodHNDaGVjazogZnVuY3Rpb24gKG1lbnVTZXR0aW5ncywgbWFpbk1lbnUsIHN1Yk1lbnUpIHsgcmV0dXJuIG1lbnVSaWdodHNDaGVjayhtZW51U2V0dGluZ3MsIG1haW5NZW51LCBzdWJNZW51KSB9LFxyXG4gICAgICAgIHVwZGF0ZU11bHRpc2VsZWN0RGF0YTogZnVuY3Rpb24gKGl0ZW0sIG1vZGUsIGZpZWxkcywga2V5KSB7IHJldHVybiB1cGRhdGVNdWx0aXNlbGVjdERhdGEoaXRlbSwgbW9kZSwgZmllbGRzLCBrZXkpIH0sXHJcbiAgICAgICAgbG9hZE11bHRpU2VsZWN0OiBmdW5jdGlvbiAoaXRlbXMsIGZpZWxkKSB7IHJldHVybiBsb2FkTXVsdGlTZWxlY3QoaXRlbXMsIGZpZWxkKSB9LFxyXG4gICAgICAgIHVwZGF0ZUNoZWNrQm94TGlzdERhdGE6IGZ1bmN0aW9uIChpdGVtLCBtb2RlLCBmaWVsZHMsIGtleSkgeyByZXR1cm4gdXBkYXRlQ2hlY2tCb3hMaXN0RGF0YShpdGVtLCBtb2RlLCBmaWVsZHMsIGtleSkgfSxcclxuICAgICAgICBsb2FkQ2hlY2tCb3hMaXN0OiBmdW5jdGlvbiAoaXRlbXMsIGZpZWxkLCBmaWVsZHMpIHsgcmV0dXJuIGxvYWRDaGVja0JveExpc3QoaXRlbXMsIGZpZWxkLCBmaWVsZHMpIH0sXHJcbiAgICAgICAgZ2V0VXNlclJpZ2h0czogZnVuY3Rpb24gKG1lbnVTZXR0aW5ncywgbWFpbk1lbnUsIHN1Yk1lbnUpIHsgcmV0dXJuIGdldFVzZXJSaWdodHMobWVudVNldHRpbmdzLCBtYWluTWVudSwgc3ViTWVudSkgfSxcclxuICAgICAgICBzZXREaXNhYmxlZEVuYWJsZWRCeVJpZ2h0czogZnVuY3Rpb24gKHJpZ2h0cywgYXBwSXRlbSkgeyByZXR1cm4gc2V0RGlzYWJsZWRFbmFibGVkQnlSaWdodHMocmlnaHRzLCBhcHBJdGVtKSB9LFxyXG4gICAgICAgIGdldEN1cnJlbnREYXRlOiBmdW5jdGlvbiAoZm9ybWF0KSB7IHJldHVybiBnZXRDdXJyZW50RGF0ZShmb3JtYXQpIH0sXHJcbiAgICAgICAgZ2V0SXRlbXNGaWx0ZXJCeU9iamVjdDogZnVuY3Rpb24gKGl0ZW1zLCBvYmplY3QpIHsgcmV0dXJuIGdldEl0ZW1zRmlsdGVyQnlPYmplY3QoaXRlbXMsIG9iamVjdCkgfSxcclxuICAgICAgICBnZXRTdWJNZW51czogZnVuY3Rpb24gKG1lbnVTZXR0aW5ncywgbWFpbk1lbnUpIHsgcmV0dXJuIGdldFN1Yk1lbnVzKG1lbnVTZXR0aW5ncywgbWFpbk1lbnUpIH0sXHJcbiAgICAgICAgZ2V0TWVudVRpdGxlOiBmdW5jdGlvbiAobWVudVNldHRpbmdzLCBtYWluTWVudSkgeyByZXR1cm4gZ2V0TWVudVRpdGxlKG1lbnVTZXR0aW5ncywgbWFpbk1lbnUpIH0sXHJcbiAgICAgICAgZ2V0SXRlbXNOb3RJbk90aGVySXRlbXM6IGZ1bmN0aW9uIChpdGVtcywgbm90SW5JdGVtcywgaXRlbUZpZWxkLCBub3RJbkZpbGVkKSB7IHJldHVybiBnZXRJdGVtc05vdEluT3RoZXJJdGVtcyhpdGVtcywgbm90SW5JdGVtcywgaXRlbUZpZWxkLCBub3RJbkZpbGVkKSB9LFxyXG4gICAgICAgIHNldFZpZXdDb250ZW50RGlzYWJsZWQ6IGZ1bmN0aW9uIChjdXJyZW50TW9kZSkgeyByZXR1cm4gc2V0Vmlld0NvbnRlbnREaXNhYmxlZChjdXJyZW50TW9kZSkgfSxcclxuICAgICAgICBnZXRUZXh0RnJvbVRyZWU6IGZ1bmN0aW9uIChpdGVtcywgZGF0YSwgcGFyZW50KSB7IHJldHVybiBnZXRUZXh0RnJvbVRyZWUoaXRlbXMsIGRhdGEsIHBhcmVudCkgfSxcclxuICAgICAgICBzbGVlcDogZnVuY3Rpb24gKG1pbGxpc2Vjb25kcykgeyBzbGVlcChtaWxsaXNlY29uZHMpIH0sXHJcbiAgICAgICAgZ2V0T2JqZWN0c2Zyb21KU09OOiBmdW5jdGlvbiAob2JqLCBrZXksIHZhbCkgeyByZXR1cm4gZ2V0T2JqZWN0c2Zyb21KU09OKG9iaiwga2V5LCB2YWwpIH0sXHJcbiAgICAgICAgaXNTYXZlOiBmdW5jdGlvbiAoZmllbGRzKSB7IHJldHVybiBpc1NhdmUoZmllbGRzKSB9LFxyXG4gICAgICAgIGNvbXBhcmVkYXRhOiBmdW5jdGlvbiAoZmllbGRzLCBwYWdlbmFtZSwgc2VjdGlvbiwgcGtuYW1lLCBwa2lkLCBrZXl3b3JkKSB7IHJldHVybiBjb21wYXJlZGF0YShmaWVsZHMsIHBhZ2VuYW1lLCBzZWN0aW9uLCBwa25hbWUsIHBraWQsIGtleXdvcmQpIH0sXHJcbiAgICAgICAgY2xlYXJUYWJsZVNlbGVjdGVkUm93czogZnVuY3Rpb24gKHR5cGUpIHsgcmV0dXJuIGNsZWFyVGFibGVTZWxlY3RlZFJvd3ModHlwZSkgfSxcclxuICAgICAgICBjbG9zZVJlcG9ydDogZnVuY3Rpb24gKCkgeyByZXR1cm4gY2xvc2VSZXBvcnQoKSB9LFxyXG4gICAgICAgIGdldFRlbXBsYXRlVXJsOiBmdW5jdGlvbiAocGF0aCkgeyByZXR1cm4gZ2V0VGVtcGxhdGVVcmwocGF0aCkgfSxcclxuICAgICAgICBnZXRBcHBsaWNhdGlvblZlcnNpb246IGZ1bmN0aW9uICgpIHsgcmV0dXJuIGdldEFwcGxpY2F0aW9uVmVyc2lvbigpIH0sXHJcbiAgICAgICAgZ2V0QXBwbGljYXRpb25FbnZpcm9ubWVudDogZnVuY3Rpb24gKCkgeyByZXR1cm4gZ2V0QXBwbGljYXRpb25FbnZpcm9ubWVudCgpIH0sXHJcbiAgICAgICAgZGVmYXVsdEZvcm1hdDogZnVuY3Rpb24gKCkgeyByZXR1cm4gZGVmYXVsdEZvcm1hdCgpIH0sXHJcbiAgICAgICAgZ2V0RGlzdGluY3Rmcm9tSlNPTjogZnVuY3Rpb24gKG9iaiwga2V5KSB7IHJldHVybiBnZXREaXN0aW5jdGZyb21KU09OKG9iaiwga2V5KSB9LFxyXG4gICAgICAgIGdldE1hdGNoZWRvYmplY3Rmcm9tSlNPTjogZnVuY3Rpb24gKG9iaiwga2V5MSwga2V5MiwgdmFsdWUpIHsgcmV0dXJuIGdldE1hdGNoZWRvYmplY3Rmcm9tSlNPTihvYmosIGtleTEsIGtleTIsIHZhbHVlKSB9LFxyXG4gICAgICAgIGdldEZpbHRlcm9iamVjdGZyb21KU09OOiBmdW5jdGlvbiAob2JqLCBrZXkxLCB2YWx1ZSkgeyByZXR1cm4gZ2V0RmlsdGVyb2JqZWN0ZnJvbUpTT04ob2JqLCBrZXkxLCB2YWx1ZSkgfSxcclxuICAgICAgICBwYWdlQ2hhbmdlczogZnVuY3Rpb24gKGZ1bmNQYWdlQ2hhbmdlLCBmdW5jcGFnZVNhdmUsIGNhbGxiYWNrKSB7IHJldHVybiBwYWdlQ2hhbmdlcyhmdW5jUGFnZUNoYW5nZSwgZnVuY3BhZ2VTYXZlLCBjYWxsYmFjaykgfSxcclxuICAgICAgICB0YWJsZVNvcnRERE1NWVlZRUV4dDogZnVuY3Rpb24gKCkgeyByZXR1cm4gdGFibGVTb3J0RERNTVlZWUVFeHQoKSB9LFxyXG4gICAgICAgIGdldEVtYWlsUGF0dGVybjogZnVuY3Rpb24gKCkgeyByZXR1cm4gZ2V0RW1haWxQYXR0ZXJuKCkgfSxcclxuICAgICAgICB2aWV3Q29udGVudExvYWRlZDogZnVuY3Rpb24gKGNvbmZpZ01lbnUpIHsgcmV0dXJuIHZpZXdDb250ZW50TG9hZGVkKGNvbmZpZ01lbnUpIH0sXHJcbiAgICAgICAgY29sb3JwaWNrZXJIaWRlOiBmdW5jdGlvbiAoKSB7IHJldHVybiBjb2xvcnBpY2tlckhpZGUoKSB9LFxyXG4gICAgICAgIHJpc2tBZ2dyZXNzaW9uTW9kYWxDbG9zZTogZnVuY3Rpb24gKGNvbmZpZ0hlYWRlck1lbnUsIGV2ZW50KSB7IHJldHVybiByaXNrQWdncmVzc2lvbk1vZGFsQ2xvc2UoY29uZmlnSGVhZGVyTWVudSwgZXZlbnQpIH1cclxuICAgIH07XHJcblxyXG59KCkpOyIsIihmdW5jdGlvbiAobmF2Y29uKSB7XHJcbiAgICBuYXZjb24uYWxlcnQgPSB7XHJcbiAgICAgICAgbG9hZDogZnVuY3Rpb24gKHNpZ25hbFJIdWJQcm94eSwgbmdBdXRoU2V0dGluZ3MsIGxvZ2dlciwgYXV0aFNlcnZpY2UsICRyb290U2NvcGUpe1xyXG4gICAgICAgICAgICB2YXIgY2xpZW50UHVzaEh1YlByb3h5ID0gc2lnbmFsUkh1YlByb3h5KG5nQXV0aFNldHRpbmdzLnNpZ25hbFJTZXJ2ZXIsICdOb3RpZmljYXRpb25IdWInLCB7IGxvZ2dpbmc6IHRydWUgfSk7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICBjbGllbnRQdXNoSHViUHJveHkub24oJ2FkZE5ld05vdGlmaWNhdGlvbicsIGZ1bmN0aW9uIChkYXRhKXtcclxuICAgICAgICAgICAgICAgICBuYXZjb24uYWxlcnQuZGlzcGxheUFsbE5vdGlmaWNhdGlvbihkYXRhLCBhdXRoU2VydmljZS5hdXRoZW50aWNhdGlvbi51c2VySWQsIGxvZ2dlciwgJHJvb3RTY29wZSk7ICBcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICBjbGllbnRQdXNoSHViUHJveHkub24oJ0RlbGV0ZU5vdGlmaWNhdGlvbkRldGFpbCcsIGZ1bmN0aW9uIChpZCl7XHJcbiAgICAgICAgICAgICAgICAgbmF2Y29uLmFsZXJ0LmRlbGV0ZVVzZXJOb3RpZmljYXRpb24oaWQsIGF1dGhTZXJ2aWNlLmF1dGhlbnRpY2F0aW9uLnVzZXJJZCwgbG9nZ2VyLCAkcm9vdFNjb3BlKTsgICAgIFxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIGNsaWVudFB1c2hIdWJQcm94eS5vbignRGVsZXRlTm90aWZpY2F0aW9uJywgZnVuY3Rpb24gKGlkKXtcclxuICAgICAgICAgICAgICAgICBuYXZjb24uYWxlcnQuZGVsZXRlQWxsTm90aWZpY2F0aW9uKGlkLCBhdXRoU2VydmljZS5hdXRoZW50aWNhdGlvbi51c2VySWQsIGxvZ2dlciwgJHJvb3RTY29wZSk7ICAgICAgIFxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9LFxyXG4gICAgICAgIGRpc3BsYXlBbGxOb3RpZmljYXRpb246IGZ1bmN0aW9uKGRhdGEsIGxvZ2luSWQsIGxvZ2dlciwgJHJvb3RTY29wZSl7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICBpZihkYXRhLk5vdGlmaWNhdGlvbkRldGFpbCA9PT0gdW5kZWZpbmVkKSByZXR1cm47XHJcbiAgICAgICAgICAgIGZvcihpPTAsIGxlbiA9IGRhdGEuTm90aWZpY2F0aW9uRGV0YWlsLmxlbmd0aDsgaSA8IGxlbiA7IGkrKyl7XHJcbiAgICAgICAgICAgICAgICB2YXIgaXRlbSA9IGRhdGEuTm90aWZpY2F0aW9uRGV0YWlsW2ldO1xyXG4gICAgICAgICAgICAgICAgaWYoaXRlbS5Vc2VySWQgPT09IGxvZ2luSWQpe1xyXG4gICAgICAgICAgICAgICAgICAgIGRpc3BsYXlOb3RpZmljYXRpb24oaXRlbS5SZWFkU3RhdHVzLCBpdGVtLk5vdGlmaWNhdGlvbkRldGFpbElkKTtcclxuICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgIH0gXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIGZ1bmN0aW9uIGRpc3BsYXlOb3RpZmljYXRpb24ocmVhZFN0YXR1cyxub3RpZmljYXRpb25JZCl7XHJcbiAgICAgICAgICAgICAgICBkYXRhLk5GRGV0YWlsc0lkID0gbm90aWZpY2F0aW9uSWQ7XHJcbiAgICAgICAgICAgICAgICBkYXRhLk5vdGlmaWNhdGlvbkRldGFpbElkID0gbm90aWZpY2F0aW9uSWQ7XHJcbiAgICAgICAgICAgICAgICB2YXIgaXRlbXMgPSBbXTtcclxuICAgICAgICAgICAgICAgIGl0ZW1zLnB1c2goZGF0YSk7XHJcbiAgICAgICAgICAgICAgICAkcm9vdFNjb3BlLiRicm9hZGNhc3QoJ0FMRVJULURBVEEtUkVGUkVTSCcsIGl0ZW1zLCBmYWxzZSk7XHJcbiAgICAgICAgICAgICAgICBsb2dnZXIuaW5mbyhkYXRhLk1lc3NhZ2UgfHwgXCJOb3RpZmljYXRpb24gcmVjZWl2ZWQuLlwiLCBcIlwiLCBcIlwiKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0sXHJcbiAgICAgICAgZGVsZXRlVXNlck5vdGlmaWNhdGlvbjogZnVuY3Rpb24oaWQsIGxvZ2luSWQsIGxvZ2dlciwgJHJvb3RTY29wZSl7XHJcbiAgICAgICAgICAgICRyb290U2NvcGUuJGJyb2FkY2FzdCgnQUxFUlQtREFUQS1ERUxFVEUnLCBpZCwgXCJ1c2VyXCIpO1xyXG4gICAgICAgIH0sXHJcbiAgICAgICAgZGVsZXRlQWxsTm90aWZpY2F0aW9uOiBmdW5jdGlvbihpZCwgbG9naW5JZCwgbG9nZ2VyLCAkcm9vdFNjb3BlKXtcclxuICAgICAgICAgICAgJHJvb3RTY29wZS4kYnJvYWRjYXN0KCdBTEVSVC1EQVRBLURFTEVURScsIGlkLCBcImFsbFwiKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgXHJcbiAgICB9O1xyXG59KG5hdmNvbiB8fCB7fSkpOyIsIihmdW5jdGlvbiAobmF2Y29uKSB7XHJcbiAgICBuYXZjb24ua2VuZG8gPSB7XHJcbiAgICAgICAgbG9hZExpc3REZWZhdWx0RGF0YTogZnVuY3Rpb24gKGRhdGEsIGZpZWxkcykge1xyXG4gICAgICAgICAgICAkLm1hcChmaWVsZHMsIGZ1bmN0aW9uIChpdGVtLCBrZXkpIHtcclxuICAgICAgICAgICAgICAgIGlmIChpdGVtLnR5cGUudG9Mb3dlckNhc2UoKSA9PT0gXCJrZW5kb211bHRpc2VsZWN0XCIgfHwgaXRlbS50eXBlLnRvTG93ZXJDYXNlKCkgPT09IFwia2VuZG9zZWxlY3RcIiB8fCBpdGVtLnR5cGUudG9Mb3dlckNhc2UoKSA9PT0gXCJrZW5kb2NvbWJvYm94XCIpIHtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgZGVmYXVsdEZpZWxkID0gaXRlbS5zZWxlY3RPcHRpb25zLml0ZW0uZGVmYXVsdEZpZWxkO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChkZWZhdWx0RmllbGQgIT09IHVuZGVmaW5lZCAmJiBkZWZhdWx0RmllbGQgIT09IFwiXCIpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGRhdGFbZGVmYXVsdEZpZWxkXSAhPT0gdW5kZWZpbmVkICYmIGRhdGFbZGVmYXVsdEZpZWxkXSAhPT0gbnVsbCAmJiBkYXRhW2RlZmF1bHRGaWVsZF0gIT09IFwiXCIpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpdGVtLnNlbGVjdE9wdGlvbnMuaXRlbXMgPSBhbmd1bGFyLmNvcHkobmF2Y29uLmdldERpc3RpbmN0ZnJvbUpTT04oZGF0YVtkZWZhdWx0RmllbGRdLCBpdGVtLnNlbGVjdE9wdGlvbnMuaXRlbS5kYXRhRmllbGQpKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH0sXHJcbiAgICAgICAgbG9hZExpc3RTaW5nbGVEYXRhOiBmdW5jdGlvbiAoZGF0YSwgZmllbGRzLCBrZXkpIHtcclxuICAgICAgICAgICAgdmFyIGtleUluZGV4ID0gbmF2Y29uLmdldEl0ZW1JbmRleEJ5UHJvcGVydHkoZmllbGRzLCBrZXkpO1xyXG4gICAgICAgICAgICB2YXIgaXRlbSA9IGZpZWxkc1trZXlJbmRleF07XHJcbiAgICAgICAgICAgIGlmIChrZXlJbmRleCAhPT0gLTEgJiYgaXRlbSAhPT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoaXRlbS50eXBlLnRvTG93ZXJDYXNlKCkgPT09IFwia2VuZG9tdWx0aXNlbGVjdFwiIHx8IGl0ZW0udHlwZS50b0xvd2VyQ2FzZSgpID09PSBcImtlbmRvc2VsZWN0XCIgfHwgaXRlbS50eXBlLnRvTG93ZXJDYXNlKCkgPT09IFwia2VuZG9jb21ib2JveFwiKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIGRlZmF1bHRGaWVsZCA9IGl0ZW0uc2VsZWN0T3B0aW9ucy5pdGVtLmRlZmF1bHRGaWVsZDtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoZGVmYXVsdEZpZWxkICE9PSB1bmRlZmluZWQgJiYgZGVmYXVsdEZpZWxkICE9PSBcIlwiKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChkYXRhW2RlZmF1bHRGaWVsZF0gIT09IHVuZGVmaW5lZCAmJiBkYXRhW2RlZmF1bHRGaWVsZF0gIT09IG51bGwgJiYgZGF0YVtkZWZhdWx0RmllbGRdICE9PSBcIlwiKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaXRlbS5zZWxlY3RPcHRpb25zLml0ZW1zID0gYW5ndWxhci5jb3B5KGRhdGFbZGVmYXVsdEZpZWxkXSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSxcclxuICAgICAgICByZXF1aXJlZFZhbGlkYXRpb246IGZ1bmN0aW9uIChteUZpZWxkcywgZmllbGROYW1lLCB2YWxpZGF0aW9uKSB7XHJcbiAgICAgICAgICAgIC8vUmVxdWlyZWQgbWVzc2FnZVxyXG4gICAgICAgICAgICBpZiAodmFsaWRhdGlvbi5yZXF1aXJlZCAhPT0gdW5kZWZpbmVkICYmIHZhbGlkYXRpb24ucmVxdWlyZWQgIT09IG51bGwgJiYgKHZhbGlkYXRpb24ucmVxdWlyZWQgfHwgdmFsaWRhdGlvbi5yZXF1aXJlZC50b0xvd2VyQ2FzZSgpID09PSBcInllc1wiKSkge1xyXG4gICAgICAgICAgICAgICAgaWYgKHZhbGlkYXRpb24ucmVxdWlyZWRNZXNzYWdlICE9PSB1bmRlZmluZWQgJiYgdmFsaWRhdGlvbi5yZXF1aXJlZE1lc3NhZ2UgIT09IG51bGwgJiYgdmFsaWRhdGlvbi5yZXF1aXJlZE1lc3NhZ2UgIT09IFwiXCIpXHJcbiAgICAgICAgICAgICAgICAgICAgbXlGaWVsZHMudmFsaWRhdGlvbltcInJlcXVpcmVkXCJdID0geyBcIm1lc3NhZ2VcIjogdmFsaWRhdGlvbi5yZXF1aXJlZE1lc3NhZ2UgfTtcclxuICAgICAgICAgICAgICAgIGVsc2VcclxuICAgICAgICAgICAgICAgICAgICBteUZpZWxkcy52YWxpZGF0aW9uW1wicmVxdWlyZWRcIl0gPSAodmFsaWRhdGlvbi5yZXF1aXJlZCB8fCB2YWxpZGF0aW9uLnJlcXVpcmVkLnRvTG93ZXJDYXNlKCkgPT09IFwieWVzXCIgPyB0cnVlIDogZmFsc2UpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSxcclxuICAgICAgICBtaW5pbXVtVmFsaWRhdGlvbjogZnVuY3Rpb24gKG15RmllbGRzLCBmaWVsZE5hbWUsIHZhbGlkYXRpb24pIHtcclxuICAgICAgICAgICAgLy9NaW5pdW0gbWVzc2FnZVxyXG4gICAgICAgICAgICBpZiAodmFsaWRhdGlvbi5taW5sZW5ndGggIT09IHVuZGVmaW5lZCAmJiB2YWxpZGF0aW9uLm1pbmxlbmd0aCAhPT0gbnVsbCAmJiB2YWxpZGF0aW9uLm1pbmxlbmd0aCAhPT0gXCJcIikge1xyXG4gICAgICAgICAgICAgICAgdmFyIG1lc3NhZ2VNaW4gPSB2YWxpZGF0aW9uLm1pbmxlbmd0aE1lc3NhZ2UgIT09IHVuZGVmaW5lZCAmJiB2YWxpZGF0aW9uLm1pbmxlbmd0aE1lc3NhZ2UgIT09IFwiXCIgPyB2YWxpZGF0aW9uLm1pbmxlbmd0aE1lc3NhZ2UgOiBcIk1pbmltdW0gXCIgKyB2YWxpZGF0aW9uLm1pbmxlbmd0aCArIFwiIGNoYXJhY3RlciByZXF1aXJlZC5cIjtcclxuICAgICAgICAgICAgICAgIG15RmllbGRzLnZhbGlkYXRpb25bZmllbGROYW1lLnRvTG93ZXJDYXNlKCkgKyBcIm1pblwiXSA9IGZ1bmN0aW9uIChpbnB1dCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChpbnB1dC5pcyhcIltuYW1lPSdcIiArIGZpZWxkTmFtZSArIFwiJ11cIikgJiYgaW5wdXQudmFsKCkubGVuZ3RoIDwgdmFsaWRhdGlvbi5taW5sZW5ndGgpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaW5wdXQuYXR0cihcImRhdGEtXCIgKyBmaWVsZE5hbWUudG9Mb3dlckNhc2UoKSArIFwibWluLW1zZ1wiLCBcIlwiICsgdmFsaWRhdGlvbi5taW5sZW5ndGhNZXNzYWdlICsgXCJcIik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9LFxyXG4gICAgICAgIG1heGltdW1WYWxpZGF0aW9uOiBmdW5jdGlvbiAobXlGaWVsZHMsIGZpZWxkTmFtZSwgdmFsaWRhdGlvbikge1xyXG4gICAgICAgICAgICAvL01heGltdW0gbWVzc2FnZVxyXG4gICAgICAgICAgICBpZiAodmFsaWRhdGlvbi5tYXhsZW5ndGggIT09IHVuZGVmaW5lZCAmJiB2YWxpZGF0aW9uLm1heGxlbmd0aCAhPT0gbnVsbCAmJiB2YWxpZGF0aW9uLm1heGxlbmd0aCAhPT0gXCJcIikge1xyXG4gICAgICAgICAgICAgICAgdmFyIG1lc3NhZ2VNaW4gPSB2YWxpZGF0aW9uLm1heGxlbmd0aE1lc3NhZ2UgIT09IHVuZGVmaW5lZCAmJiB2YWxpZGF0aW9uLm1heGxlbmd0aE1lc3NhZ2UgIT09IFwiXCIgPyB2YWxpZGF0aW9uLm1heGxlbmd0aE1lc3NhZ2UgOiBcIk1heGltdW0gXCIgKyB2YWxpZGF0aW9uLm1heGxlbmd0aCArIFwiIG9ubHkgYWxsb3dlZC5cIjtcclxuICAgICAgICAgICAgICAgIG15RmllbGRzLnZhbGlkYXRpb25bZmllbGROYW1lLnRvTG93ZXJDYXNlKCkgKyBcIm1heFwiXSA9IGZ1bmN0aW9uIChpbnB1dCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChpbnB1dC5pcyhcIltuYW1lPSdcIiArIGZpZWxkTmFtZSArIFwiJ11cIikgJiYgaW5wdXQudmFsKCkubGVuZ3RoID4gdmFsaWRhdGlvbi5tYXhsZW5ndGgpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaW5wdXQuYXR0cihcImRhdGEtXCIgKyBmaWVsZE5hbWUudG9Mb3dlckNhc2UoKSArIFwibWF4LW1zZ1wiLCBcIlwiICsgdmFsaWRhdGlvbi5tYXhsZW5ndGhNZXNzYWdlICsgXCJcIik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9LFxyXG4gICAgICAgIHBhdHRlcm5WYWxpZGF0aW9uOiBmdW5jdGlvbiAobXlGaWVsZHMsIGZpZWxkTmFtZSwgdmFsaWRhdGlvbikge1xyXG4gICAgICAgICAgICAvL1BhdHRlcm4gbWVzc2FnZVxyXG4gICAgICAgICAgICBpZiAodmFsaWRhdGlvbi5wYXR0ZXJuICE9PSB1bmRlZmluZWQgJiYgdmFsaWRhdGlvbi5wYXR0ZXJuICE9PSBudWxsICYmIHZhbGlkYXRpb24ucGF0dGVybiAhPT0gXCJcIikge1xyXG4gICAgICAgICAgICAgICAgdmFyIHBhdHRlcm5SZWdleCA9IG5ldyBSZWdFeHAodmFsaWRhdGlvbi5wYXR0ZXJuLnRvU3RyaW5nKCkpO1xyXG4gICAgICAgICAgICAgICAgdmFyIG1lc3NhZ2VNaW4gPSB2YWxpZGF0aW9uLnBhdHRlcm5NZXNzYWdlICE9PSB1bmRlZmluZWQgJiYgdmFsaWRhdGlvbi5wYXR0ZXJuTWVzc2FnZSAhPT0gXCJcIiA/IHZhbGlkYXRpb24ucGF0dGVybk1lc3NhZ2UgOiBcIkFscGhhIG51bWVyaWMgb25seSBhbGxvd2VkLlwiO1xyXG4gICAgICAgICAgICAgICAgbXlGaWVsZHMudmFsaWRhdGlvbltmaWVsZE5hbWUudG9Mb3dlckNhc2UoKSArIFwicGF0dGVyblwiXSA9IGZ1bmN0aW9uIChpbnB1dCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChpbnB1dC5pcyhcIltuYW1lPSdcIiArIGZpZWxkTmFtZSArIFwiJ11cIikgJiYgaW5wdXQudmFsKCkgIT0gXCJcIikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpbnB1dC5hdHRyKFwiZGF0YS1cIiArIGZpZWxkTmFtZS50b0xvd2VyQ2FzZSgpICsgXCJwYXR0ZXJuLW1zZ1wiLCBcIlwiICsgdmFsaWRhdGlvbi5wYXR0ZXJuTWVzc2FnZSArIFwiXCIpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gcGF0dGVyblJlZ2V4LnRlc3QoaW5wdXQudmFsKCkpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0sXHJcbiAgICAgICAgZXhpc3REYXRhVmFsaWRhdGlvbjogZnVuY3Rpb24gKG15RmllbGRzLCBmaWVsZE5hbWUsIGZpZWxkS2V5LCB2YWxpZGF0aW9uLCBzY29wZSkge1xyXG4gICAgICAgICAgICAvL0V4aXN0RGF0YSBtZXNzYWdlXHJcbiAgICAgICAgICAgIGlmICh2YWxpZGF0aW9uLmlzRXhpc3REYXRhICE9PSB1bmRlZmluZWQgJiYgdmFsaWRhdGlvbi5pc0V4aXN0RGF0YSAhPT0gbnVsbCAmJiB2YWxpZGF0aW9uLmlzRXhpc3REYXRhICE9PSBcIlwiKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgc2NvcGVEYXRhID0gc2NvcGUubmF2Y29uRGF0YVt2YWxpZGF0aW9uLmlzRXhpc3REYXRhXTtcclxuICAgICAgICAgICAgICAgIHZhciBrZXlPbGREYXRhID0gXCJcIjtcclxuXHJcbiAgICAgICAgICAgICAgICB2YXIgbWVzc2FnZU1pbiA9IHZhbGlkYXRpb24uaXNFeGlzdE1lc3NhZ2UgIT09IHVuZGVmaW5lZCAmJiB2YWxpZGF0aW9uLmlzRXhpc3RNZXNzYWdlICE9PSBcIlwiID8gdmFsaWRhdGlvbi5pc0V4aXN0TWVzc2FnZSA6IFwiYWxyZWFkeSBleGlzdHMuLlwiO1xyXG4gICAgICAgICAgICAgICAgbXlGaWVsZHMudmFsaWRhdGlvbltmaWVsZE5hbWUudG9Mb3dlckNhc2UoKSArIFwiZXhpc3RzXCJdID0gZnVuY3Rpb24gKGlucHV0KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGlucHV0LmlzKFwiW25hbWU9J1wiICsgZmllbGROYW1lICsgXCInXVwiKSAmJiBpbnB1dC52YWwoKSAhPSBcIlwiKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChzY29wZS5maWVsZHMuZ2V0QnlJZCAhPT0gdW5kZWZpbmVkICYmIHNjb3BlLmZpZWxkcy5nZXRCeUlkICE9PSBudWxsKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAga2V5T2xkRGF0YSA9IHNjb3BlLmZpZWxkcy5nZXRCeUlkW2ZpZWxkS2V5XTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldFZhbCA9IG5hdmNvbi5nZXRJdGVtQnlLZXlWYWx1ZShzY29wZURhdGEsIGZpZWxkS2V5LCBpbnB1dC52YWwoKS50b1N0cmluZygpLnRyaW0oKSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChyZXRWYWwgIT09IC0xICYmIGlucHV0LnZhbCgpLnRvU3RyaW5nKCkudHJpbSgpICE9PSBrZXlPbGREYXRhLnRvU3RyaW5nKCkudHJpbSgpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbnB1dC5hdHRyKFwiZGF0YS1cIiArIGZpZWxkTmFtZS50b0xvd2VyQ2FzZSgpICsgXCJleGlzdHMtbXNnXCIsIFwiXCIgKyB2YWxpZGF0aW9uLmlzRXhpc3RNZXNzYWdlICsgXCJcIik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXRWYWwgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICBlbHNlXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXRWYWwgPSB0cnVlO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJldFZhbDtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9XHJcbn0obmF2Y29uIHx8IHt9KSk7IiwiKGZ1bmN0aW9uIChuYXZjb24pIHtcclxuICAgIG5hdmNvbi5rZW5kby5zY2hlZHVsZSA9IHtcclxuICAgICAgICAvKmRpc3RpbmN0RGF0YTogZnVuY3Rpb24gKGNvbGxlY3Rpb25EYXRhLCBkaXN0aW5jdEZpZWxkKSB7XHJcbiAgICAgICAgICAgIHZhciBmaWx0ZXJEYXRhID0gW107XHJcbiAgICAgICAgICAgIGlmIChjb2xsZWN0aW9uRGF0YSAhPT0gdW5kZWZpbmVkICYmIGNvbGxlY3Rpb25EYXRhICE9PSBudWxsICYmIGNvbGxlY3Rpb25EYXRhLmxlbmd0aCAhPT0gMCkge1xyXG4gICAgICAgICAgICAgICAgJC5lYWNoKGNvbGxlY3Rpb25EYXRhLCBmdW5jdGlvbiAoaW5kZXgsIGV2ZW50KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIGV2ZW50cyA9ICQuZ3JlcChmaWx0ZXJEYXRhLCBmdW5jdGlvbiAoZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZXZlbnRbZGlzdGluY3RGaWVsZF0gPT09IGVbZGlzdGluY3RGaWVsZF07XHJcbiAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGV2ZW50cy5sZW5ndGggPT09IDApIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgZmlsdGVyRGF0YS5wdXNoKGV2ZW50KTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICByZXR1cm4gZmlsdGVyRGF0YTtcclxuICAgICAgICB9LFxyXG4gICAgICAgIGZpbHRlckRyb3BEb3duOiBmdW5jdGlvbiAoZWxlbWVudCwgZmllbGROYW1lLCBzZXR0aW5ncykge1xyXG4gICAgICAgICAgICAvL3ZhciBkYXRhU291cmNlID0gbmV3IGtlbmRvLmRhdGEuRGF0YVNvdXJjZSh7IGRhdGE6IHRoaXMuZGF0YVMuZGF0YSgpLnRvSlNPTigpIH0pO1xyXG5cclxuICAgICAgICAgICAgdmFyIGRhdGEgPSBuYXZjb24ua2VuZG8uc2NoZWR1bGUuZGlzdGluY3REYXRhKHNldHRpbmdzLmRhdGEsIGZpZWxkTmFtZSk7XHJcblxyXG4gICAgICAgICAgICBlbGVtZW50LmtlbmRvRHJvcERvd25MaXN0KHtcclxuICAgICAgICAgICAgICAgIGRhdGFTb3VyY2U6IHtcclxuICAgICAgICAgICAgICAgICAgICBkYXRhOiBkYXRhXHJcbiAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgZ3JvdXA6IHsgZmllbGQ6IGZpZWxkTmFtZSB9LFxyXG4gICAgICAgICAgICAgICAgc2VydmVyRmlsdGVyaW5nOiB0cnVlLFxyXG4gICAgICAgICAgICAgICAgZGF0YVRleHRGaWVsZDogZmllbGROYW1lLFxyXG4gICAgICAgICAgICAgICAgZGF0YVZhbHVlRmllbGQ6IGZpZWxkTmFtZSxcclxuICAgICAgICAgICAgICAgIG9wdGlvbkxhYmVsOiBcIi0tU2VsZWN0IFZhbHVlLS1cIlxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9LFxyXG4gICAgICAgIGVkaXREcm9wRG93bjogZnVuY3Rpb24gKGNvbnRhaW5lciwgb3B0aW9ucywgc2VydmljZU1ldGhvZCkge1xyXG4gICAgICAgICAgICAvL3ZhciBkYXRhc2VydmljZSA9IGFuZ3VsYXIuZWxlbWVudChkb2N1bWVudCkuaW5qZWN0b3IoKS5pbnZva2UoZnVuY3Rpb24gKGRhdGFzZXJ2aWNlKSB7IHJldHVybiBkYXRhc2VydmljZTsgfSk7XHJcblxyXG4gICAgICAgICAgICB2YXIgZmllbGRJZCA9IHRoaXMub3B0aW9uLmlkO1xyXG4gICAgICAgICAgICB2YXIgZmllbGRUZXh0ID0gdGhpcy5vcHRpb24udGV4dDtcclxuICAgICAgICAgICAgdmFyIGRhdGFTb3VyY2UgPSB0aGlzLmRhdGFzZXQ7XHJcblxyXG4gICAgICAgICAgICBpZiAoc2VydmljZU1ldGhvZCAhPT0gdW5kZWZpbmVkICYmIHNlcnZpY2VNZXRob2QgIT09IG51bGwgJiYgc2VydmljZU1ldGhvZCAhPT0gXCJcIikge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGRhdGFzZXJ2aWNlLmdldFNlcnZlckRhdGEoc2VydmljZU1ldGhvZCwgJycpLnRoZW4oZnVuY3Rpb24gKHJldHVybkRhdGEpIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAocmV0dXJuRGF0YSA9PT0gdW5kZWZpbmVkIHx8IHJldHVybkRhdGEgPT09IG51bGwgfHwgcmV0dXJuRGF0YS5sZW5ndGggPT09IDApIHJldHVybjtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIGRhdGEgPSBuYXZjb24ua2VuZG8uc2NoZWR1bGUuZGlzdGluY3REYXRhKHJldHVybkRhdGEsIGZpZWxkSWQpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAkKCc8aW5wdXQgcmVxdWlyZWQgbmFtZT1cIicgKyBvcHRpb25zLmZpZWxkICsgJ1wiLz4nKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAuYXBwZW5kVG8oY29udGFpbmVyKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAua2VuZG9Ecm9wRG93bkxpc3Qoe1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZGF0YVZhbHVlRmllbGQ6IGZpZWxkSWQsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkYXRhVGV4dEZpZWxkOiBmaWVsZFRleHQsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkYXRhU291cmNlOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogXCJvZGF0YVwiLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRhdGE6IGRhdGEsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgZGF0YSA9IG5hdmNvbi5rZW5kby5zY2hlZHVsZS5kaXN0aW5jdERhdGEoZGF0YVNvdXJjZS5kYXRhLCBmaWVsZElkKTtcclxuXHJcbiAgICAgICAgICAgICAgICAkKCc8aW5wdXQgcmVxdWlyZWQgbmFtZT1cIicgKyBvcHRpb25zLmZpZWxkICsgJ1wiLz4nKVxyXG4gICAgICAgICAgICAgICAgICAgIC5hcHBlbmRUbyhjb250YWluZXIpXHJcbiAgICAgICAgICAgICAgICAgICAgLmtlbmRvRHJvcERvd25MaXN0KHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgZGF0YVZhbHVlRmllbGQ6IGZpZWxkSWQsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGRhdGFUZXh0RmllbGQ6IGZpZWxkVGV4dCxcclxuICAgICAgICAgICAgICAgICAgICAgICAgZGF0YVNvdXJjZToge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogXCJvZGF0YVwiLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZGF0YTogZGF0YSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSwqL1xyXG4gICAgICAgIHJlc291cmNlU2V0dGluZzogZnVuY3Rpb24gKHNldHRpbmdzLCBzY29wZSwgb2JqUGFyYW0pIHtcclxuICAgICAgICAgICAgdmFyIGl0ZW1zID0gW107XHJcblxyXG4gICAgICAgICAgICBpZiAob2JqUGFyYW0gIT09IHVuZGVmaW5lZCAmJiBvYmpQYXJhbS5yZXNvdXJjZXMgIT09IHVuZGVmaW5lZCAmJiBvYmpQYXJhbS5yZXNvdXJjZXMgIT09IG51bGwgJiYgb2JqUGFyYW0ucmVzb3VyY2VzLmxlbmd0aCAhPT0gMClcclxuICAgICAgICAgICAgICAgIGl0ZW1zID0gb2JqUGFyYW0ucmVzb3VyY2VzXHJcbiAgICAgICAgICAgIGVsc2VcclxuICAgICAgICAgICAgICAgIGl0ZW1zID0gc2V0dGluZ3MucmVzb3VyY2VzO1xyXG5cclxuICAgICAgICAgICAgcmV0dXJuIGl0ZW1zO1xyXG4gICAgICAgIH0sXHJcbiAgICAgICAgZXZlbnRTZXR0aW5nOiBmdW5jdGlvbiAoc2V0dGluZ3MsIHNjb3BlKSB7XHJcbiAgICAgICAgICAgIHZhciBpdGVtcyA9IFtdO1xyXG4gICAgICAgICAgICBpdGVtcyA9IHNldHRpbmdzLmV2ZW50cztcclxuXHJcbiAgICAgICAgICAgIHZhciByZXNvdXJjZXMgPSBzZXR0aW5ncy5yZXNvdXJjZXM7XHJcblxyXG4gICAgICAgICAgICB2YXIgbW9kZWxGaWVsZHMgPSBzZXR0aW5ncy5tb2RlbC5maWVsZHM7XHJcbiAgICAgICAgICAgIGlmIChtb2RlbEZpZWxkcy5jb2xvciA9PT0gdW5kZWZpbmVkIHx8IG1vZGVsRmllbGRzLmNvbG9yID09PSBudWxsKSBtb2RlbEZpZWxkcy5jb2xvciA9IHsgZnJvbTogXCJDb2xvclwiLCBmaWVsZEtleTogXCJcIiB9O1xyXG5cclxuICAgICAgICAgICAgLyppZiAobW9kZWxGaWVsZHMuZGVzY3JpcHRpb24gPT09IHVuZGVmaW5lZCB8fCBtb2RlbEZpZWxkcy5kZXNjcmlwdGlvbiA9PT0gbnVsbCkgbW9kZWxGaWVsZHMuZGVzY3JpcHRpb24gPSB7IGZyb206IFwiRGVzY3JpcHRpb25cIixmaWVsZEtleTogXCJcIiB9O1xyXG4gICAgICAgICAgICBpZiAobW9kZWxGaWVsZHMuc3RhcnRUaW1lem9uZSA9PT0gdW5kZWZpbmVkIHx8IG1vZGVsRmllbGRzLnN0YXJ0VGltZXpvbmUgPT09IG51bGwpIG1vZGVsRmllbGRzLnN0YXJ0VGltZXpvbmUgPSB7IGZyb206IFwiU3RhcnRUaW1lem9uZVwiLGZpZWxkS2V5OiBcIlwiIH07XHJcbiAgICAgICAgICAgIGlmIChtb2RlbEZpZWxkcy5lbmRUaW1lem9uZSA9PT0gdW5kZWZpbmVkIHx8IG1vZGVsRmllbGRzLmVuZFRpbWV6b25lID09PSBudWxsKSBtb2RlbEZpZWxkcy5lbmRUaW1lem9uZSA9IHsgZnJvbTogXCJFbmRUaW1lem9uZVwiLGZpZWxkS2V5OiBcIlwiIH07XHJcbiAgICAgICAgICAgIGlmIChtb2RlbEZpZWxkcy5yZWN1cnJlbmNlUnVsZSA9PT0gdW5kZWZpbmVkIHx8IG1vZGVsRmllbGRzLnJlY3VycmVuY2VSdWxlID09PSBudWxsKSBtb2RlbEZpZWxkcy5yZWN1cnJlbmNlUnVsZSA9IHsgZnJvbTogXCJSZWN1cnJlbmNlUnVsZVwiLGZpZWxkS2V5OiBcIlwiIH07XHJcbiAgICAgICAgICAgIGlmIChtb2RlbEZpZWxkcy5yZWN1cnJlbmNlSUQgPT09IHVuZGVmaW5lZCB8fCBtb2RlbEZpZWxkcy5yZWN1cnJlbmNlSUQgPT09IG51bGwpIG1vZGVsRmllbGRzLnJlY3VycmVuY2VJRCA9IHsgZnJvbTogXCJSZWN1cnJlbmNlSURcIixmaWVsZEtleTogXCJcIiB9O1xyXG4gICAgICAgICAgICBpZiAobW9kZWxGaWVsZHMucmVjdXJyZW5jZUV4Y2VwdGlvbiA9PT0gdW5kZWZpbmVkIHx8IG1vZGVsRmllbGRzLnJlY3VycmVuY2VFeGNlcHRpb24gPT09IG51bGwpIG1vZGVsRmllbGRzLnJlY3VycmVuY2VFeGNlcHRpb24gPSB7IGZyb206IFwiUmVjdXJyZW5jZUV4Y2VwdGlvblwiLGZpZWxkS2V5OiBcIlwiIH07XHJcbiAgICAgICAgICAgIGlmIChtb2RlbEZpZWxkcy5pc0FsbERheSA9PT0gdW5kZWZpbmVkIHx8IG1vZGVsRmllbGRzLmlzQWxsRGF5ID09PSBudWxsKSBtb2RlbEZpZWxkcy5pc0FsbERheSA9IHsgSXNBbGxEYXk6IGZhbHNlLGZpZWxkS2V5OiBcIlwiIH07Ki9cclxuXHJcbiAgICAgICAgICAgICQubWFwKGl0ZW1zLCBmdW5jdGlvbiAoaXRlbSwgaW5kZXgpIHtcclxuICAgICAgICAgICAgICAgICQuZWFjaChtb2RlbEZpZWxkcywgZnVuY3Rpb24gKGtleSwgdmFsdWUpIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAobW9kZWxGaWVsZHNba2V5XS50eXBlICE9PSB1bmRlZmluZWQgJiYgbW9kZWxGaWVsZHNba2V5XS50eXBlLnRvTG93ZXJDYXNlKCkgPT09IFwiZGF0ZVwiKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vaXRlbVttb2RlbEZpZWxkc1trZXldLmZyb21dID0gRGF0ZShpdGVtW21vZGVsRmllbGRzW2tleV0uZnJvbV0pO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgICAgIGlmIChpdGVtLkNvbG9yID09PSB1bmRlZmluZWQgfHwgaXRlbS5Db2xvciA9PT0gbnVsbCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBjb2xvclZhbHVlID0gW3sgY29sb3I6IFwiXCIgfV07XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIGlMb29wID0gMDtcclxuICAgICAgICAgICAgICAgICAgICAvL2ZvciAodmFyIGlMb29wID0gMCwgbGVuZ3RoID0gcmVzb3VyY2VzLmxlbmd0aDsgaUxvb3AgPCBsZW5ndGg7IGlMb29wKyspIHtcclxuICAgICAgICAgICAgICAgICAgICAkLmVhY2goaXRlbSwgZnVuY3Rpb24gKGtleSwgdmFsdWUpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHJlc291cmNlc1tpTG9vcF0uZmllbGQgPT09IGtleSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29sb3JWYWx1ZSA9IHJlc291cmNlc1tpTG9vcF0uZGF0YVNvdXJjZS5maWx0ZXIoZnVuY3Rpb24gKGUpIHsgcmV0dXJuIGUudmFsdWUgPT09IGl0ZW1ba2V5XSB9KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgICAgIC8vfVxyXG4gICAgICAgICAgICAgICAgICAgIGl0ZW1bXCJDb2xvclwiXSA9IGNvbG9yVmFsdWVbMF0uY29sb3I7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAvKmlmIChpdGVtLkRlc2NyaXB0aW9uID09PSB1bmRlZmluZWQgfHwgaXRlbS5EZXNjcmlwdGlvbiA9PT0gbnVsbCkgaXRlbS5EZXNjcmlwdGlvbiA9IFwiXCI7XHJcbiAgICAgICAgICAgICAgICBpZiAoaXRlbS5TdGFydFRpbWV6b25lID09PSB1bmRlZmluZWQgfHwgaXRlbS5TdGFydFRpbWV6b25lID09PSBudWxsKSBpdGVtLlN0YXJ0VGltZXpvbmUgPSBudWxsXCI7XHJcbiAgICAgICAgICAgICAgICBpZiAoaXRlbS5FbmRUaW1lem9uZSA9PT0gdW5kZWZpbmVkIHx8IGl0ZW0uRW5kVGltZXpvbmUgPT09IG51bGwpIGl0ZW0uRW5kVGltZXpvbmUgPSBudWxsO1xyXG4gICAgICAgICAgICAgICAgaWYgKGl0ZW0uUmVjdXJyZW5jZVJ1bGUgPT09IHVuZGVmaW5lZCB8fCBpdGVtLlJlY3VycmVuY2VSdWxlID09PSBudWxsKSBpdGVtLlJlY3VycmVuY2VSdWxlID0gbnVsbDtcclxuICAgICAgICAgICAgICAgIGlmIChpdGVtLlJlY3VycmVuY2VJRCA9PT0gdW5kZWZpbmVkIHx8IGl0ZW0uUmVjdXJyZW5jZUlEID09PSBudWxsKSBpdGVtLlJlY3VycmVuY2VJRCA9IG51bGw7XHJcbiAgICAgICAgICAgICAgICBpZiAoaXRlbS5SZWN1cnJlbmNlRXhjZXB0aW9uID09PSB1bmRlZmluZWQgfHwgaXRlbS5SZWN1cnJlbmNlRXhjZXB0aW9uID09PSBudWxsKSBpdGVtLlJlY3VycmVuY2VFeGNlcHRpb24gPSBudWxsO1xyXG4gICAgICAgICAgICAgICAgaWYgKGl0ZW0uSXNBbGxEYXkgPT09IHVuZGVmaW5lZCB8fCBpdGVtLklzQWxsRGF5ID09PSBudWxsKSBpdGVtLklzQWxsRGF5ID0gZmFsc2U7Ki9cclxuICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICB2YXIgZGF0YVNvdXJjZSA9IHtcclxuICAgICAgICAgICAgICAgIHR5cGU6IFwib2RhdGFcIixcclxuICAgICAgICAgICAgICAgIGJhdGNoOiB0cnVlLFxyXG4gICAgICAgICAgICAgICAgLyp0cmFuc3BvcnQ6IHtcclxuICAgICAgICAgICAgICAgICAgICByZWFkOiBmdW5jdGlvbiAoZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBlLnN1Y2Nlc3MoZGF0YSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgICAgICBwYXJhbWV0ZXJNYXA6IGZ1bmN0aW9uIChvcHRpb25zLCBvcGVyYXRpb24pIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKG9wZXJhdGlvbiAhPT0gXCJyZWFkXCIgJiYgb3B0aW9ucy5tb2RlbHMpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB7IG1vZGVsczoga2VuZG8uc3RyaW5naWZ5KG9wdGlvbnMubW9kZWxzKSB9O1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIH0sKi9cclxuICAgICAgICAgICAgICAgIGRhdGE6IGl0ZW1zLFxyXG4gICAgICAgICAgICAgICAgc2NoZW1hOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgbW9kZWw6IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWQ6IChzZXR0aW5ncy5tb2RlbC5pZCAhPT0gdW5kZWZpbmVkICYmIHNldHRpbmdzLm1vZGVsLmlkICE9PSBcIlwiID8gc2V0dGluZ3MubW9kZWwuaWQgOiBcImlkXCIpLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBmaWVsZHM6IG5hdmNvbi5rZW5kby5zY2hlZHVsZS52YWxpZGF0aW9uU2NoZW1hKHNldHRpbmdzLCBzY29wZSksXHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICByZXR1cm4gZGF0YVNvdXJjZTtcclxuICAgICAgICB9LFxyXG4gICAgICAgIHNldHRpbmcxOiBmdW5jdGlvbiAoZWwsIG9wdGlvbnMsIHNjb3BlLCBvYmpQYXJhbSkge1xyXG4gICAgICAgICAgICB2YXIgc2V0dGluZ3MgPSB7fTtcclxuICAgICAgICAgICAgaWYgKG9wdGlvbnMgIT0gdW5kZWZpbmVkKSBzZXR0aW5ncyA9IG9wdGlvbnM7XHJcblxyXG4gICAgICAgICAgICB2YXIga1NjaGVkdWxlciA9IG51bGw7XHJcbiAgICAgICAgICAgIHZhciBzY2hlZHVsZXIgPSAkKCQoZWwpLmZpbmQoJy5rZW5kb1NjaGVkdWxlJylbMF0pO1xyXG4gICAgICAgICAgICBpZiAoc2NoZWR1bGVyICE9PSB1bmRlZmluZWQgJiYgc2NoZWR1bGVyICE9PSBudWxsKSB7XHJcbiAgICAgICAgICAgICAgICBrZW5kby5kZXN0cm95KHNjaGVkdWxlcik7XHJcbiAgICAgICAgICAgICAgICBzY2hlZHVsZXIuZW1wdHkoKTtcclxuXHJcbiAgICAgICAgICAgICAgICAkKHNjaGVkdWxlcikua2VuZG9TY2hlZHVsZXIoe1xyXG4gICAgICAgICAgICAgICAgICAgIGRhdGU6IG5ldyBEYXRlKG5hdmNvbi5nZXRDdXJyZW50RGF0ZShcIllZWVkvTU0vRERcIikpLFxyXG4gICAgICAgICAgICAgICAgICAgIGRhdGVIZWFkZXJUZW1wbGF0ZToga2VuZG8udGVtcGxhdGUoXCI8c3Ryb25nPiM9a2VuZG8udG9TdHJpbmcoZGF0ZSwgJ2RkLU1NTS15eXl5JykjPC9zdHJvbmc+XCIpLFxyXG4gICAgICAgICAgICAgICAgICAgIC8vaGVpZ2h0OiA1MDAsXHJcbiAgICAgICAgICAgICAgICAgICAgZWRpdGFibGU6IHNldHRpbmdzLmVkaXRhYmxlICE9PSB1bmRlZmluZWQgJiYgc2V0dGluZ3MuZWRpdGFibGUuZW5hYmxlZCAhPT0gdW5kZWZpbmVkICYmIHNldHRpbmdzLmVkaXRhYmxlLmVuYWJsZWQgPyBzZXR0aW5ncy5lZGl0YWJsZS5lbmFibGVkIDogZmFsc2UsXHJcblxyXG4gICAgICAgICAgICAgICAgICAgIC8vZXZlbnRUZW1wbGF0ZTogJChcIiNldmVudC10ZW1wbGF0ZVwiKS5odG1sKCksXHJcbiAgICAgICAgICAgICAgICAgICAgYWxsRGF5U2xvdDogc2V0dGluZ3MuYWxsRGF5U2xvdCAhPT0gdW5kZWZpbmVkID8gc2V0dGluZ3MuYWxsRGF5U2xvdCA6IGZhbHNlLFxyXG4gICAgICAgICAgICAgICAgICAgIGFsbERheVNsb3RUZW1wbGF0ZTogXCI8ZGl2IHN0eWxlPSdiYWNrZ3JvdW5kOlxcXFwjQTJBMkFBOyBoZWlnaHQ6IDEwMCU7d2lkdGg6IDEwMCU7Jz48L2Rpdj5cIixcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgdmlld3M6IFtcclxuICAgICAgICAgICAgICAgICAgICAgIFwiZGF5XCIsXHJcbiAgICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogXCJrZW5kby51aS5TY2hlZHVsZXJUaW1lbGluZVllYXJWaWV3XCIsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgdGl0bGU6IFwiWWVhclwiLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgIG1ham9yVGljazogMTQ0MCxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICBtaW5vclRpY2tDb3VudDogMSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICBjb2x1bW5XaWR0aDogMTAwLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgIGdyb3VwOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRhdGU6IGZhbHNlLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcInJlc291cmNlc1wiOiBbXCJvd25lcklkXCJdLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcIm9yaWVudGF0aW9uXCI6IFwidmVydGljYWxcIlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgc2VsZWN0ZWQ6IHRydWVcclxuICAgICAgICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICAgICAgXSxcclxuICAgICAgICAgICAgICAgICAgICB0aW1lem9uZTogc2V0dGluZ3MudGltZXpvbmUgIT09IHVuZGVmaW5lZCA/IHNldHRpbmdzLnRpbWV6b25lIDogXCJFdGMvVVRDXCIsXHJcbiAgICAgICAgICAgICAgICAgICAgZGF0YVNvdXJjZToge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBiYXRjaDogdHJ1ZSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgZGF0YTogW1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLyp7IFwiVGFza0lEXCI6IDQsIFwiT3duZXJJRFwiOiAyLCBcIlRpdGxlXCI6IFwiQm93bGluZyB0b3VybmFtZW50XCIsIFwiRGVzY3JpcHRpb25cIjogXCJcIiwgXCJTdGFydFRpbWV6b25lXCI6IG51bGwsIFwiU3RhcnRcIjogXCJcXC9EYXRlKDEzNzA4MTE2MDAwMDApXFwvXCIsIFwiRW5kXCI6IFwiXFwvRGF0ZSgxMzcwODIyNDAwMDAwKVxcL1wiLCBcIkVuZFRpbWV6b25lXCI6IG51bGwsIFwiUmVjdXJyZW5jZVJ1bGVcIjogbnVsbCwgXCJSZWN1cnJlbmNlSURcIjogbnVsbCwgXCJSZWN1cnJlbmNlRXhjZXB0aW9uXCI6IG51bGwsIFwiSXNBbGxEYXlcIjogZmFsc2UgfSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHsgXCJUYXNrSURcIjogNSwgXCJPd25lcklEXCI6IDIsIFwiVGl0bGVcIjogXCJUYWtlIHRoZSBkb2cgdG8gdGhlIHZldFwiLCBcIkRlc2NyaXB0aW9uXCI6IFwiXCIsIFwiU3RhcnRUaW1lem9uZVwiOiBudWxsLCBcIlN0YXJ0XCI6IFwiXFwvRGF0ZSgxMzcwODQ3NjAwMDAwKVxcL1wiLCBcIkVuZFwiOiBcIlxcL0RhdGUoMTM3MDg1MTIwMDAwMClcXC9cIiwgXCJFbmRUaW1lem9uZVwiOiBudWxsLCBcIlJlY3VycmVuY2VSdWxlXCI6IG51bGwsIFwiUmVjdXJyZW5jZUlEXCI6IG51bGwsIFwiUmVjdXJyZW5jZUV4Y2VwdGlvblwiOiBudWxsLCBcIklzQWxsRGF5XCI6IGZhbHNlIH0sXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB7IFwiVGFza0lEXCI6IDYsIFwiT3duZXJJRFwiOiAyLCBcIlRpdGxlXCI6IFwiQ2FsbCBDaGFybGllIGFib3V0IHRoZSBwcm9qZWN0XCIsIFwiRGVzY3JpcHRpb25cIjogXCJcIiwgXCJTdGFydFRpbWV6b25lXCI6IG51bGwsIFwiU3RhcnRcIjogXCJcXC9EYXRlKDEzNzA5NTAyMDAwMDApXFwvXCIsIFwiRW5kXCI6IFwiXFwvRGF0ZSgxMzcwOTU1NjAwMDAwKVxcL1wiLCBcIkVuZFRpbWV6b25lXCI6IG51bGwsIFwiUmVjdXJyZW5jZVJ1bGVcIjogbnVsbCwgXCJSZWN1cnJlbmNlSURcIjogbnVsbCwgXCJSZWN1cnJlbmNlRXhjZXB0aW9uXCI6IG51bGwsIFwiSXNBbGxEYXlcIjogZmFsc2UgfSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHsgXCJUYXNrSURcIjogNywgXCJPd25lcklEXCI6IDMsIFwiVGl0bGVcIjogXCJNZWV0aW5nIHdpdGggQWxleFwiLCBcIkRlc2NyaXB0aW9uXCI6IFwiXCIsIFwiU3RhcnRUaW1lem9uZVwiOiBudWxsLCBcIlN0YXJ0XCI6IFwiXFwvRGF0ZSgxMzcxMDM0ODAwMDAwKVxcL1wiLCBcIkVuZFwiOiBcIlxcL0RhdGUoMTM3MTAzODQwMDAwMClcXC9cIiwgXCJFbmRUaW1lem9uZVwiOiBudWxsLCBcIlJlY3VycmVuY2VSdWxlXCI6IG51bGwsIFwiUmVjdXJyZW5jZUlEXCI6IG51bGwsIFwiUmVjdXJyZW5jZUV4Y2VwdGlvblwiOiBudWxsLCBcIklzQWxsRGF5XCI6IGZhbHNlIH0sXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB7IFwiVGFza0lEXCI6IDksIFwiT3duZXJJRFwiOiAyLCBcIlRpdGxlXCI6IFwiQWxleFxcdTAwMjdzIEJpcnRoZGF5XCIsIFwiRGVzY3JpcHRpb25cIjogXCJcIiwgXCJTdGFydFRpbWV6b25lXCI6IG51bGwsIFwiU3RhcnRcIjogXCJcXC9EYXRlKDEzNzExNzUyMDAwMDApXFwvXCIsIFwiRW5kXCI6IFwiXFwvRGF0ZSgxMzcxMTc1MjAwMDAwKVxcL1wiLCBcIkVuZFRpbWV6b25lXCI6IG51bGwsIFwiUmVjdXJyZW5jZVJ1bGVcIjogbnVsbCwgXCJSZWN1cnJlbmNlSURcIjogbnVsbCwgXCJSZWN1cnJlbmNlRXhjZXB0aW9uXCI6IG51bGwsIFwiSXNBbGxEYXlcIjogdHJ1ZSB9Ki9cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHsgXCJNZWV0aW5nSURcIjogNCwgXCJPd25lcklEXCI6IDIsIFwiVGl0bGVcIjogXCJCb3dsaW5nIHRvdXJuYW1lbnRcIiwgXCJEZXNjcmlwdGlvblwiOiBcIlwiLCBcIlN0YXJ0VGltZXpvbmVcIjogbnVsbCwgXCJTdGFydFwiOiBcIjIwMTctMDEtMDFcIiwgXCJFbmRcIjogXCIyMDE3LTAxLTAxXCIsIFwiRW5kVGltZXpvbmVcIjogbnVsbCwgXCJSZWN1cnJlbmNlUnVsZVwiOiBudWxsLCBcIlJlY3VycmVuY2VJRFwiOiBudWxsLCBcIlJlY3VycmVuY2VFeGNlcHRpb25cIjogbnVsbCwgXCJJc0FsbERheVwiOiBmYWxzZSB9LFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgeyBcIk1lZXRpbmdJRFwiOiA1LCBcIk93bmVySURcIjogMiwgXCJUaXRsZVwiOiBcIlRha2UgdGhlIGRvZyB0byB0aGUgdmV0XCIsIFwiRGVzY3JpcHRpb25cIjogXCJcIiwgXCJTdGFydFRpbWV6b25lXCI6IG51bGwsIFwiU3RhcnRcIjogXCIyMDE3LTAxLTAyXCIsIFwiRW5kXCI6IFwiMjAxNy0wMS0wMlwiLCBcIkVuZFRpbWV6b25lXCI6IG51bGwsIFwiUmVjdXJyZW5jZVJ1bGVcIjogbnVsbCwgXCJSZWN1cnJlbmNlSURcIjogbnVsbCwgXCJSZWN1cnJlbmNlRXhjZXB0aW9uXCI6IG51bGwsIFwiSXNBbGxEYXlcIjogZmFsc2UgfSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHsgXCJNZWV0aW5nSURcIjogNiwgXCJPd25lcklEXCI6IDIsIFwiVGl0bGVcIjogXCJDYWxsIENoYXJsaWUgYWJvdXQgdGhlIHByb2plY3RcIiwgXCJEZXNjcmlwdGlvblwiOiBcIlwiLCBcIlN0YXJ0VGltZXpvbmVcIjogbnVsbCwgXCJTdGFydFwiOiBcIjIwMTctMDEtMDNcIiwgXCJFbmRcIjogXCIyMDE3LTAxLTAzXCIsIFwiRW5kVGltZXpvbmVcIjogbnVsbCwgXCJSZWN1cnJlbmNlUnVsZVwiOiBudWxsLCBcIlJlY3VycmVuY2VJRFwiOiBudWxsLCBcIlJlY3VycmVuY2VFeGNlcHRpb25cIjogbnVsbCwgXCJJc0FsbERheVwiOiBmYWxzZSB9LFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgeyBcIk1lZXRpbmdJRFwiOiA3LCBcIk93bmVySURcIjogMywgXCJUaXRsZVwiOiBcIk1lZXRpbmcgd2l0aCBBbGV4XCIsIFwiRGVzY3JpcHRpb25cIjogXCJcIiwgXCJTdGFydFRpbWV6b25lXCI6IG51bGwsIFwiU3RhcnRcIjogXCIyMDE3LTAxLTA0XCIsIFwiRW5kXCI6IFwiMjAxNy0wMS0wNFwiLCBcIkVuZFRpbWV6b25lXCI6IG51bGwsIFwiUmVjdXJyZW5jZVJ1bGVcIjogbnVsbCwgXCJSZWN1cnJlbmNlSURcIjogbnVsbCwgXCJSZWN1cnJlbmNlRXhjZXB0aW9uXCI6IG51bGwsIFwiSXNBbGxEYXlcIjogZmFsc2UgfSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHsgXCJNZWV0aW5nSURcIjogOSwgXCJPd25lcklEXCI6IDIsIFwiVGl0bGVcIjogXCJBbGV4XFx1MDAyN3MgQmlydGhkYXlcIiwgXCJEZXNjcmlwdGlvblwiOiBcIlwiLCBcIlN0YXJ0VGltZXpvbmVcIjogbnVsbCwgXCJTdGFydFwiOiBcIjIwMTctMDEtMDVcIiwgXCJFbmRcIjogXCIyMDE3LTAxLTA1XCIsIFwiRW5kVGltZXpvbmVcIjogbnVsbCwgXCJSZWN1cnJlbmNlUnVsZVwiOiBudWxsLCBcIlJlY3VycmVuY2VJRFwiOiBudWxsLCBcIlJlY3VycmVuY2VFeGNlcHRpb25cIjogbnVsbCwgXCJJc0FsbERheVwiOiB0cnVlIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgXSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgc2NoZW1hOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtb2RlbDoge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlkOiBcInRhc2tJZFwiLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpZWxkczoge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvL3Rhc2tJZDogeyBmcm9tOiBcIlRhc2tJRFwiLCB0eXBlOiBcIm51bWJlclwiIH0sXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1lZXRpbmdJZDogeyBmcm9tOiBcIk1lZXRpbmdJRFwiLCB0eXBlOiBcIm51bWJlclwiIH0sXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRpdGxlOiB7IGZyb206IFwiVGl0bGVcIiwgZGVmYXVsdFZhbHVlOiBcIk5vIHRpdGxlXCIsIHZhbGlkYXRpb246IHsgcmVxdWlyZWQ6IHRydWUgfSB9LFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGFydDogeyB0eXBlOiBcImRhdGVcIiwgZnJvbTogXCJTdGFydFwiIH0sXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZDogeyB0eXBlOiBcImRhdGVcIiwgZnJvbTogXCJFbmRcIiB9LFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGFydFRpbWV6b25lOiB7IGZyb206IFwiU3RhcnRUaW1lem9uZVwiIH0sXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZFRpbWV6b25lOiB7IGZyb206IFwiRW5kVGltZXpvbmVcIiB9LFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZXNjcmlwdGlvbjogeyBmcm9tOiBcIkRlc2NyaXB0aW9uXCIgfSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVjdXJyZW5jZUlkOiB7IGZyb206IFwiUmVjdXJyZW5jZUlEXCIgfSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVjdXJyZW5jZVJ1bGU6IHsgZnJvbTogXCJSZWN1cnJlbmNlUnVsZVwiIH0sXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlY3VycmVuY2VFeGNlcHRpb246IHsgZnJvbTogXCJSZWN1cnJlbmNlRXhjZXB0aW9uXCIgfSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb3duZXJJZDogeyBmcm9tOiBcIk93bmVySURcIiwgZGVmYXVsdFZhbHVlOiAxIH0sXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlzQWxsRGF5OiB7IHR5cGU6IFwiYm9vbGVhblwiLCBmcm9tOiBcIklzQWxsRGF5XCIgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICAgICAgcmVzb3VyY2VzOiBbXHJcbiAgICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgZmllbGQ6IFwib3duZXJJZFwiLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgIHRpdGxlOiBcIk93bmVyXCIsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgZGF0YVNvdXJjZTogW1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgeyB0ZXh0OiBcIkFsZXhcIiwgdmFsdWU6IDEsIGNvbG9yOiBcIiNmOGEzOThcIiB9LFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgeyB0ZXh0OiBcIkJvYlwiLCB2YWx1ZTogMiwgY29sb3I6IFwiIzUxYTBlZFwiIH0sXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB7IHRleHQ6IFwiQ2hhcmxpZVwiLCB2YWx1ZTogMywgY29sb3I6IFwiIzU2Y2E4NVwiIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICBdXHJcbiAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgXVxyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9LFxyXG4gICAgICAgIHNjaGVkdWxlclZpZXdzOiBmdW5jdGlvbiAoc2V0dGluZ3MsIG9ialBhcmFtKSB7XHJcbiAgICAgICAgICAgIHZhciB2aWV3TGlzdCA9IFtdO1xyXG4gICAgICAgICAgICB2YXIgZGVmYXVsdFZpZXcgPSBmYWxzZTtcclxuXHJcbiAgICAgICAgICAgIHZhciBteUdyb3VwID0gbnVsbDtcclxuICAgICAgICAgICAgaWYgKG9ialBhcmFtICE9PSB1bmRlZmluZWQgJiYgb2JqUGFyYW0uZ3JvdXAgIT09IHVuZGVmaW5lZCAmJiBvYmpQYXJhbS5ncm91cCAhPT0gbnVsbCkge1xyXG4gICAgICAgICAgICAgICAgbXlHcm91cCA9IG9ialBhcmFtLmdyb3VwO1xyXG4gICAgICAgICAgICB9IGVsc2UgaWYgKHNldHRpbmdzLmdyb3VwICE9PSB1bmRlZmluZWQgJiYgc2V0dGluZ3MuZ3JvdXAuZW5hYmxlZCAhPT0gdW5kZWZpbmVkICYmIHNldHRpbmdzLmdyb3VwLmVuYWJsZWQpIHtcclxuICAgICAgICAgICAgICAgIG15R3JvdXAgPSB7XHJcbiAgICAgICAgICAgICAgICAgICAgZGF0ZTogc2V0dGluZ3MuZ3JvdXAuZGF0ZSAhPT0gdW5kZWZpbmVkICYmIHNldHRpbmdzLmdyb3VwLm9yaWVudGF0aW9uID09PSB1bmRlZmluZWQgPyBzZXR0aW5ncy5ncm91cC5kYXRlIDogZmFsc2UsXHJcbiAgICAgICAgICAgICAgICAgICAgcmVzb3VyY2VzOiBzZXR0aW5ncy5ncm91cC5yZXNvdXJjZXMgIT09IHVuZGVmaW5lZCA/IHNldHRpbmdzLmdyb3VwLnJlc291cmNlcyA6IFtdLFxyXG4gICAgICAgICAgICAgICAgICAgIG9yaWVudGF0aW9uOiBzZXR0aW5ncy5ncm91cC5vcmllbnRhdGlvbiAhPT0gdW5kZWZpbmVkID8gc2V0dGluZ3MuZ3JvdXAub3JpZW50YXRpb24gOiBcInZlcnRpY2FsXCIvL1wiaG9yaXpvbnRhbFwiXHJcbiAgICAgICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBpZiAoc2V0dGluZ3Mudmlld3MgIT09IHVuZGVmaW5lZCkge1xyXG4gICAgICAgICAgICAgICAgJC5tYXAoc2V0dGluZ3Mudmlld3MsIGZ1bmN0aW9uIChpdGVtLCBpbmRleCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChpdGVtLnRvTG93ZXJDYXNlKCkgPT09IFwiZGF5XCIpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgZGVmYXVsdFZpZXcgPSAoc2V0dGluZ3MuZGVmYXVsdFZpZXcudG9Mb3dlckNhc2UoKSA9PT0gXCJkYXlcIiA/IHRydWUgOiBmYWxzZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZpZXdMaXN0LnB1c2goe1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogXCJkYXlcIixcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNob3dXb3JrSG91cnM6IHRydWUsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aXRsZTogXCJUb2RheVwiLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZGF0ZTogbmV3IERhdGUobmF2Y29uLmdldEN1cnJlbnREYXRlKFwiWVlZWS9NTS9ERFwiKSksXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGFydFRpbWU6IG5ldyBEYXRlKG5hdmNvbi5nZXRDdXJyZW50RGF0ZShcIllZWVkvTU0vRERcIikgKyBcIiAwMDowMFwiKSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZFRpbWU6IG5ldyBEYXRlKG5hdmNvbi5nZXRDdXJyZW50RGF0ZShcIllZWVkvTU0vRERcIikgKyBcIiAyMzowMFwiKSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGVjdGVkOiBkZWZhdWx0Vmlld1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGl0ZW0udG9Mb3dlckNhc2UoKSA9PT0gXCJ3ZWVrXCIpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgZGVmYXVsdFZpZXcgPSAoc2V0dGluZ3MuZGVmYXVsdFZpZXcudG9Mb3dlckNhc2UoKSA9PT0gXCJ3ZWVrXCIgPyB0cnVlIDogZmFsc2UpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2aWV3TGlzdC5wdXNoKHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6IFwid2Vla1wiLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VsZWN0ZWQ6IGRlZmF1bHRWaWV3XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoaXRlbS50b0xvd2VyQ2FzZSgpID09PSBcIndvcmtXZWVrXCIpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgZGVmYXVsdFZpZXcgPSAoc2V0dGluZ3MuZGVmYXVsdFZpZXcudG9Mb3dlckNhc2UoKSA9PT0gXCJ3b3Jrd2Vla1wiID8gdHJ1ZSA6IGZhbHNlKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdmlld0xpc3QucHVzaCh7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiBcIndvcmtXZWVrXCIsIHdvcmtXZWVrU3RhcnQ6IDAsIHdvcmtXZWVrRW5kOiA0LFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VsZWN0ZWQ6IGRlZmF1bHRWaWV3XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoaXRlbS50b0xvd2VyQ2FzZSgpID09PSBcIm1vbnRoXCIpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgZGVmYXVsdFZpZXcgPSAoc2V0dGluZ3MuZGVmYXVsdFZpZXcudG9Mb3dlckNhc2UoKSA9PT0gXCJtb250aFwiID8gdHJ1ZSA6IGZhbHNlKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdmlld0xpc3QucHVzaCh7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiBcIm1vbnRoXCIsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBldmVudFRlbXBsYXRlOiAkKFwiI2V2ZW50LXRlbXBsYXRlXCIpLmh0bWwoKSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGVjdGVkOiBkZWZhdWx0VmlldyAgICAgICAgICAgICAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChpdGVtLnRvTG93ZXJDYXNlKCkgPT09IFwieWVhclwiKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGRlZmF1bHRWaWV3ID0gKHNldHRpbmdzLmRlZmF1bHRWaWV3LnRvTG93ZXJDYXNlKCkgPT09IFwieWVhclwiID8gdHJ1ZSA6IGZhbHNlKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdmlld0xpc3QucHVzaCh7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aXRsZTogXCJZZWFyXCIsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiBcImtlbmRvLnVpLlNjaGVkdWxlclRpbWVsaW5lWWVhclZpZXdcIixcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1ham9yVGljazogMTQ0MCxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1pbm9yVGlja0NvdW50OiAxLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29sdW1uV2lkdGg6IDEwMCxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdyb3VwOiBteUdyb3VwLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZ3JvdXBIZWFkZXJUZW1wbGF0ZTogJChcIiNncm91cEhlYWRlclRlbXBsYXRlXCIpLmh0bWwoKSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGVjdGVkOiBkZWZhdWx0Vmlld1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy9kYXlUZW1wbGF0ZToga2VuZG8udGVtcGxhdGUoXCI8c3Ryb25nPiM9IGtlbmRvLnRvU3RyaW5nKGRhdGUsICdNTU0nKSAjPC9zdHJvbmc+XCIpLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy9tYWpvclRpbWVIZWFkZXJUZW1wbGF0ZToga2VuZG8udGVtcGxhdGUoXCI8c3Ryb25nPiM9IGtlbmRvLnRvU3RyaW5nKGRhdGUsICdkZCcpICM8L3N0cm9uZz5cIiksXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvL21pbm9yVGltZUhlYWRlclRlbXBsYXRlOiBrZW5kby50ZW1wbGF0ZShcIjxzdHJvbmc+Iz0ga2VuZG8udG9TdHJpbmcoZGF0ZSwgJ2RkJykgIzwvc3Ryb25nPlwiKSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChpdGVtLnRvTG93ZXJDYXNlKCkgPT09IFwiYWdlbmRhXCIpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgZGVmYXVsdFZpZXcgPSAoc2V0dGluZ3MuZGVmYXVsdFZpZXcudG9Mb3dlckNhc2UoKSA9PT0gXCJhZ2VuZGFcIiA/IHRydWUgOiBmYWxzZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZpZXdMaXN0LnB1c2goe1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogXCJhZ2VuZGFcIixcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGV2ZW50SGVpZ2h0OiAyMDAsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxlY3RlZDogZGVmYXVsdFZpZXdcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChpdGVtLnRvTG93ZXJDYXNlKCkgPT09IFwidG9kb1wiKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGRlZmF1bHRWaWV3ID0gKHNldHRpbmdzLmRlZmF1bHRWaWV3LnRvTG93ZXJDYXNlKCkgPT09IFwidG9kb1wiID8gdHJ1ZSA6IGZhbHNlKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdmlld0xpc3QucHVzaCh7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiBcImtlbmRvLnVpLlRvRG9WaWV3XCIsIHRpdGxlOiBcIlRvIERvXCIsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxlY3RlZDogZGVmYXVsdFZpZXdcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChpdGVtLnRvTG93ZXJDYXNlKCkgPT09IFwidGltZWxpbmVcIikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBkZWZhdWx0VmlldyA9IChzZXR0aW5ncy5kZWZhdWx0Vmlldy50b0xvd2VyQ2FzZSgpID09PSBcInRpbWVsaW5lXCIgPyB0cnVlIDogZmFsc2UpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2aWV3TGlzdC5wdXNoKHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6IFwidGltZWxpbmVcIixcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGV2ZW50SGVpZ2h0OiA1MCxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGVjdGVkOiBkZWZhdWx0Vmlld1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGl0ZW0udG9Mb3dlckNhc2UoKSA9PT0gXCJ0aW1lbGluZXdvcmt3ZWVrXCIpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgZGVmYXVsdFZpZXcgPSAoc2V0dGluZ3MuZGVmYXVsdFZpZXcudG9Mb3dlckNhc2UoKSA9PT0gXCJ0aW1lbGluZXdvcmt3ZWVrXCIgPyB0cnVlIDogZmFsc2UpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2aWV3TGlzdC5wdXNoKHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6IFwidGltZWxpbmVXb3JrV2Vla1wiLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VsZWN0ZWQ6IGRlZmF1bHRWaWV3XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoaXRlbS50b0xvd2VyQ2FzZSgpID09PSBcInRpbWVsaW5lbW9udGhcIikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBkZWZhdWx0VmlldyA9IChzZXR0aW5ncy5kZWZhdWx0Vmlldy50b0xvd2VyQ2FzZSgpID09PSBcInRpbWVsaW5lbW9udGhcIiA/IHRydWUgOiBmYWxzZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZpZXdMaXN0LnB1c2goe1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogXCJ0aW1lbGluZU1vbnRoXCIsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvL3N0YXJ0VGltZTogbmV3IERhdGUobmF2Y29uLmdldEN1cnJlbnREYXRlKFwiWVlZWS9NTS9ERFwiKSArIFwiIDAwOjAwIEFNXCIpLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy9tYWpvclRpY2s6IDE0NDAsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBncm91cDogbXlHcm91cCxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdyb3VwSGVhZGVyVGVtcGxhdGU6ICQoXCIjZ3JvdXBIZWFkZXJUZW1wbGF0ZVwiKS5odG1sKCksXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxlY3RlZDogZGVmYXVsdFZpZXdcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChpdGVtLnRvTG93ZXJDYXNlKCkgPT09IFwiY3VzdG9tYWdlbmRhXCIpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgZGVmYXVsdFZpZXcgPSAoc2V0dGluZ3MuZGVmYXVsdFZpZXcudG9Mb3dlckNhc2UoKSA9PT0gXCJjdXN0b21hZ2VuZGFcIiA/IHRydWUgOiBmYWxzZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZpZXdMaXN0LnB1c2goe1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogXCJrZW5kby51aS5DdXN0b21BZ2VuZGFWaWV3XCIsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aXRsZTogXCJDdXN0b20gQWdlbmRhXCIsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxlY3RlZDogZGVmYXVsdFZpZXdcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICB2aWV3TGlzdCA9IFtcImRheVwiLCBcIm1vbnRoXCIsIFwiYWdlbmRhXCJdO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHJldHVybiB2aWV3TGlzdDtcclxuICAgICAgICB9LFxyXG4gICAgICAgIHNldHRpbmc6IGZ1bmN0aW9uIChlbCwgb3B0aW9ucywgc2NvcGUsIG9ialBhcmFtKSB7XHJcbiAgICAgICAgICAgIHZhciBzZXR0aW5ncyA9IHt9O1xyXG4gICAgICAgICAgICBpZiAob3B0aW9ucyAhPSB1bmRlZmluZWQpIHNldHRpbmdzID0gb3B0aW9ucztcclxuICAgICAgICAgICAgLy9pZiAob3B0aW9ucyAhPSB1bmRlZmluZWQgJiYgb3B0aW9ucy5vcHRpb25zICE9PSB1bmRlZmluZWQpIHNldHRpbmdzID0gb3B0aW9ucy5vcHRpb25zO1xyXG5cclxuICAgICAgICAgICAgdmFyIGtTY2hlZHVsZXIgPSBudWxsO1xyXG4gICAgICAgICAgICB2YXIgc2NoZWR1bGVyID0gJCgkKGVsKS5maW5kKCcua2VuZG9TY2hlZHVsZScpWzBdKTtcclxuICAgICAgICAgICAgaWYgKHNjaGVkdWxlciAhPT0gdW5kZWZpbmVkICYmIHNjaGVkdWxlciAhPT0gbnVsbCkge1xyXG5cclxuICAgICAgICAgICAgICAgIGtlbmRvLmRlc3Ryb3koc2NoZWR1bGVyKTtcclxuICAgICAgICAgICAgICAgIHNjaGVkdWxlci5lbXB0eSgpO1xyXG5cclxuICAgICAgICAgICAgICAgIHZhciBteUdyb3VwID0gbnVsbDtcclxuICAgICAgICAgICAgICAgIGlmIChvYmpQYXJhbSAhPT0gdW5kZWZpbmVkICYmIG9ialBhcmFtLmdyb3VwICE9PSB1bmRlZmluZWQgJiYgb2JqUGFyYW0uZ3JvdXAgIT09IG51bGwpIHtcclxuICAgICAgICAgICAgICAgICAgICBteUdyb3VwID0gb2JqUGFyYW0uZ3JvdXA7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHNldHRpbmdzLmdyb3VwICE9PSB1bmRlZmluZWQgJiYgc2V0dGluZ3MuZ3JvdXAuZW5hYmxlZCAhPT0gdW5kZWZpbmVkICYmIHNldHRpbmdzLmdyb3VwLmVuYWJsZWQpIHtcclxuICAgICAgICAgICAgICAgICAgICBteUdyb3VwID0ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBkYXRlOiBzZXR0aW5ncy5ncm91cC5kYXRlICE9PSB1bmRlZmluZWQgJiYgc2V0dGluZ3MuZ3JvdXAub3JpZW50YXRpb24gPT09IHVuZGVmaW5lZCA/IHNldHRpbmdzLmdyb3VwLmRhdGUgOiBmYWxzZSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmVzb3VyY2VzOiBzZXR0aW5ncy5ncm91cC5yZXNvdXJjZXMgIT09IHVuZGVmaW5lZCA/IHNldHRpbmdzLmdyb3VwLnJlc291cmNlcyA6IFtdLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBvcmllbnRhdGlvbjogc2V0dGluZ3MuZ3JvdXAub3JpZW50YXRpb24gIT09IHVuZGVmaW5lZCA/IHNldHRpbmdzLmdyb3VwLm9yaWVudGF0aW9uIDogXCJ2ZXJ0aWNhbFwiLy9cImhvcml6b250YWxcIlxyXG4gICAgICAgICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgdmFyIGtTY2hlZHVsZXIgPSBzY2hlZHVsZXIua2VuZG9TY2hlZHVsZXIoe1xyXG4gICAgICAgICAgICAgICAgICAgIHRpbWV6b25lOiBzZXR0aW5ncy50aW1lem9uZSAhPT0gdW5kZWZpbmVkID8gc2V0dGluZ3MudGltZXpvbmUgOiBcIkV0Yy9VVENcIixcclxuICAgICAgICAgICAgICAgICAgICBkYXRlOiBuZXcgRGF0ZShuYXZjb24uZ2V0Q3VycmVudERhdGUoXCJZWVlZL01NL0REXCIpKSxcclxuICAgICAgICAgICAgICAgICAgICAvL3N0YXJ0VGltZTogbmV3IERhdGUobmF2Y29uLmdldEN1cnJlbnREYXRlKFwiWVlZWS9NTS9ERFwiKSArIFwiIDAwOjAwIEFNXCIpLFxyXG4gICAgICAgICAgICAgICAgICAgIGRhdGVIZWFkZXJUZW1wbGF0ZToga2VuZG8udGVtcGxhdGUoXCI8c3Ryb25nPiM9a2VuZG8udG9TdHJpbmcoZGF0ZSwgJ2RkLU1NTS15eXl5JykjPC9zdHJvbmc+XCIpLFxyXG4gICAgICAgICAgICAgICAgICAgIHNlbGVjdGFibGU6IHNldHRpbmdzLnNlbGVjdGFibGUgIT09IHVuZGVmaW5lZCA/IHNldHRpbmdzLnNlbGVjdGFibGUgOiBmYWxzZSxcbiAgICAgICAgICAgICAgICAgICAgbW9iaWxlOiB0cnVlLFxyXG4gICAgICAgICAgICAgICAgICAgIC8vY3VycmVudFRpbWVNYXJrZXI6IHNldHRpbmdzLnRvZGF5VmlzaWJsZSAhPT0gdW5kZWZpbmVkID8gc2V0dGluZ3MudG9kYXlWaXNpYmxlIDogeyB1cGRhdGVJbnRlcnZhbDogMTAwLCB1c2VMb2NhbFRpbWV6b25lOiBmYWxzZSB9LFxyXG4gICAgICAgICAgICAgICAgICAgIC8vZXZlbnRIZWlnaHQ6IHNldHRpbmdzLmNvbnRlbnRIZWlnaHQgIT09IHVuZGVmaW5lZCA/IHNldHRpbmdzLmNvbnRlbnRIZWlnaHQgOiA1MCxcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgYWxsRGF5U2xvdDogKHNldHRpbmdzLmFsbERheVNsb3QgIT09IHVuZGVmaW5lZCA/IHNldHRpbmdzLmFsbERheVNsb3QgOiBmYWxzZSksXHJcbiAgICAgICAgICAgICAgICAgICAgYWxsRGF5U2xvdFRlbXBsYXRlOiBcIjxkaXYgc3R5bGU9J2JhY2tncm91bmQ6XFxcXCNBMkEyQUE7IGhlaWdodDogMTAwJTt3aWR0aDogMTAwJTsnPjwvZGl2PlwiLFxyXG5cclxuICAgICAgICAgICAgICAgICAgICAvL2V2ZW50VGVtcGxhdGU6ICQoXCIjZXZlbnQtdGVtcGxhdGVcIikuaHRtbCgpLFxyXG5cclxuICAgICAgICAgICAgICAgICAgICAvLy8vc2xvdFRlbXBsYXRlOiBrZW5kby50ZW1wbGF0ZShcIjxzdHJvbmc+Iz1rZW5kby50b1N0cmluZyhkYXRlLCAnZGQtTU1NLXl5eXknKSM8L3N0cm9uZz5cIiksXHJcbiAgICAgICAgICAgICAgICAgICAgLy8vL2FsbERheUV2ZW50VGVtcGxhdGU6ICQoXCIjZXZlbnQtdGVtcGxhdGVcIikuaHRtbCgpLFxyXG4gICAgICAgICAgICAgICAgICAgIC8vLy9kYXRlSGVhZGVyVGVtcGxhdGU6IGtlbmRvLnRlbXBsYXRlKFwiPHN0cm9uZz4jPWtlbmRvLnRvU3RyaW5nKGRhdGUsICdkJykjPC9zdHJvbmc+XCIpLFxyXG4gICAgICAgICAgICAgICAgICAgIC8vLy9ncm91cEhlYWRlclRlbXBsYXRlOiAkKFwiI2dyb3VwSGVhZGVyVGVtcGxhdGVcIikuaHRtbCgpLFxyXG4gICAgICAgICAgICAgICAgICAgIC8vLy9tYWpvclRpbWVIZWFkZXJUZW1wbGF0ZToga2VuZG8udGVtcGxhdGUoXCI8c3Ryb25nPiM9a2VuZG8udG9TdHJpbmcoZGF0ZSwgJ2gnKSM8L3N0cm9uZz48c3VwPjAwPC9zdXA+XCIpLFxyXG4gICAgICAgICAgICAgICAgICAgIC8vLy9taW5vclRpbWVIZWFkZXJUZW1wbGF0ZToga2VuZG8udGVtcGxhdGUoXCI8c3Ryb25nPiM9a2VuZG8udG9TdHJpbmcoZGF0ZSwgJ3QnKSM8L3N0cm9uZz5cIiksXHJcbiAgICAgICAgICAgICAgICAgICAgLy9ncm91cEhlYWRlclRlbXBsYXRlOiBrZW5kby50ZW1wbGF0ZShcIjxzcGFuPiM9a2VuZG8udG9TdHJpbmcoc3RhcnQsICdISDptbScpIzwvc3Bhbj4gLSA8c3Bhbj4jPWtlbmRvLnRvU3RyaW5nKGVuZCwgJ0hIOm1tJykjPC9zcGFuPlwiKSxcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgdmlld3M6IG5hdmNvbi5rZW5kby5zY2hlZHVsZS5zY2hlZHVsZXJWaWV3cyhvcHRpb25zLCBvYmpQYXJhbSksXHJcblxyXG4gICAgICAgICAgICAgICAgICAgIC8vYXV0b0JpbmQ6IHNldHRpbmdzLmF1dG9CaW5kICE9PSB1bmRlZmluZWQgPyBzZXR0aW5ncy5hdXRvQmluZCA6IGZhbHNlLFxyXG4gICAgICAgICAgICAgICAgICAgIGRhdGFTb3VyY2U6IG5hdmNvbi5rZW5kby5zY2hlZHVsZS5ldmVudFNldHRpbmcob3B0aW9ucywgc2NvcGUpLFxuXG4gICAgICAgICAgICAgICAgICAgIC8vR3JvdXAgc2V0dGluZ3NcbiAgICAgICAgICAgICAgICAgICAgLy9ncm91cDogbXlHcm91cCxcblxuICAgICAgICAgICAgICAgICAgICByZXNvdXJjZXM6IG5hdmNvbi5rZW5kby5zY2hlZHVsZS5yZXNvdXJjZVNldHRpbmcob3B0aW9ucywgc2NvcGUsIG9ialBhcmFtKSxcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgLy9FZGl0IHNldHRpbmdzXHJcbiAgICAgICAgICAgICAgICAgICAgLy9lZGl0YWJsZTogc2V0dGluZ3MuZWRpdGFibGUgIT09IHVuZGVmaW5lZCAmJiBzZXR0aW5ncy5lZGl0YWJsZS5lbmFibGVkICE9PSB1bmRlZmluZWQgJiYgc2V0dGluZ3MuZWRpdGFibGUuZW5hYmxlZCA/IHNldHRpbmdzLmVkaXRhYmxlLmVuYWJsZWQgOiBmYWxzZSxcbiAgICAgICAgICAgICAgICAgICAgZWRpdGFibGU6ICgoc2V0dGluZ3MuZWRpdGFibGUgIT09IHVuZGVmaW5lZCAmJiBzZXR0aW5ncy5lZGl0YWJsZS5lbmFibGVkICE9PSB1bmRlZmluZWQgJiYgc2V0dGluZ3MuZWRpdGFibGUuZW5hYmxlZCkgP1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25maXJtYXRpb246IHNldHRpbmdzLmVkaXRhYmxlLmNvbmZpcm1UZXh0ICE9PSB1bmRlZmluZWQgPyBzZXR0aW5ncy5lZGl0YWJsZS5jb25maXJtVGV4dCA6IFwiQXJlIHlvdSBzdXJlIHlvdSB3YW50IHRvIGRlbGV0ZSB0aGlzIG1lZXRpbmc/XCIsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjcmVhdGU6IHNldHRpbmdzLmVkaXRhYmxlLmNyZWF0ZSAhPT0gdW5kZWZpbmVkID8gc2V0dGluZ3MuZWRpdGFibGUuY3JlYXRlIDogZmFsc2UsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB1cGRhdGU6IHNldHRpbmdzLmVkaXRhYmxlLnVwZGF0ZSAhPT0gdW5kZWZpbmVkID8gc2V0dGluZ3MuZWRpdGFibGUudXBkYXRlIDogZmFsc2UsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZXN0cm95OiBzZXR0aW5ncy5lZGl0YWJsZS5kZXN0cm95ICE9PSB1bmRlZmluZWQgPyBzZXR0aW5ncy5lZGl0YWJsZS5kZXN0cm95IDogZmFsc2UsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvL2VkaXRSZWN1cnJpbmdNb2RlOiBzZXR0aW5ncy5lZGl0YWJsZS5lZGl0UmVjdXJyaW5nTW9kZSAhPT0gdW5kZWZpbmVkID8gc2V0dGluZ3MuZWRpdGFibGUuZWRpdFJlY3VycmluZ01vZGUgOiBcInNlcmllc1wiLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy9SZWN1cnJpbmcgZXZlbnRzIGVkaXQgbW9kZS4gVGhlIGF2YWlsYWJsZSBtb2RlcyBhcmU6IFwiZGlhbG9nXCIgKGRlZmF1bHQpLCBcInNlcmllc1wiIGFuZCBcIm9jY3VycmVuY2VcIi5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtb3ZlOiBzZXR0aW5ncy5lZGl0YWJsZS5tb3ZlICE9PSB1bmRlZmluZWQgPyBzZXR0aW5ncy5lZGl0YWJsZS5tb3ZlIDogZmFsc2UsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXNpemU6IHNldHRpbmdzLmVkaXRhYmxlLnJlc2l6ZSAhPT0gdW5kZWZpbmVkID8gc2V0dGluZ3MuZWRpdGFibGUucmVzaXplIDogZmFsc2UsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvL3RlbXBsYXRlOiAkKFwiI2VkaXRvclwiKS5odG1sKCksXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvL3dpbmRvdzoge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gICAgdGl0bGU6IFwiTXkgQ3VzdG9tIFRpdGxlXCIsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyAgICBhbmltYXRpb246IGZhbHNlLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gICAgb3BlbjogZnVuY3Rpb24oZSl7fVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy99LFxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9IDogbnVsbCksXHJcbiAgICAgICAgICAgICAgICAgICAgLy9mb290ZXI6IHNldHRpbmdzLmZvb3RlciAhPT0gdW5kZWZpbmVkICYmIHNldHRpbmdzLmZvb3Rlci5lbmFibGVkICE9PSB1bmRlZmluZWQgJiYgc2V0dGluZ3MuZm9vdGVyLmVuYWJsZWQgPyBzZXR0aW5ncy5mb290ZXIuZW5hYmxlZCA6IGZhbHNlLFxuICAgICAgICAgICAgICAgICAgICBkYXRhQm91bmQ6IG5hdmNvbi5rZW5kby5zY2hlZHVsZS5kYXRhQm91bmQsXHJcbiAgICAgICAgICAgICAgICAgICAgZGF0YUJpbmRpbmc6IG5hdmNvbi5rZW5kby5zY2hlZHVsZS5kYXRhQmluZGluZyxcclxuICAgICAgICAgICAgICAgICAgICBjaGFuZ2U6IHNldHRpbmdzLnNlbGVjdGFibGUgIT09IHVuZGVmaW5lZCAmJiBzZXR0aW5ncy5zZWxlY3RhYmxlID8gbmF2Y29uLmtlbmRvLnNjaGVkdWxlLmNoYW5nZSA6IG51bGwsXHJcbiAgICAgICAgICAgICAgICAgICAgYWRkOiBmdW5jdGlvbiAoZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAvL2UuZXZlbnQubG9jYXRpb24gPSAxO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAvL2UuZXZlbnQuYXBwb2ludG1lbnRUeXBlID0gMTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiQWRkXCIsIGUuZXZlbnQudGl0bGUpO1xyXG4gICAgICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICAgICAgZWRpdDogZnVuY3Rpb24gKGUpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgLy9lLnByZXZlbnREZWZhdWx0KCk7IC8vcHJldmVudCBwb3B1cCBlZGl0aW5nXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vdmFyIGRhdGFTb3VyY2UgPSB0aGlzLmRhdGFTb3VyY2U7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vdmFyIGV2ZW50ID0gZS5ldmVudDtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vaWYgKGV2ZW50LmlzTmV3KCkpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gICAgc2V0VGltZW91dChmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vICAgICAgICBkYXRhU291cmNlLmFkZChldmVudCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vICAgICAgICBuYXZjb24ua2VuZG8uc2NoZWR1bGUuZWRpdEV2ZW50KGV2ZW50KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gICAgfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gICAgbmF2Y29uLmtlbmRvLnNjaGVkdWxlLmVkaXRFdmVudChldmVudCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vfVxyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coXCJFZGl0XCIsIGUuZXZlbnQudGl0bGUpO1xyXG4gICAgICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICAgICAgc2F2ZTogZnVuY3Rpb24gKGUpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGNvbnRhaW5lciA9IGUuY29udGFpbmVyO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgZXZlbnQgPSBlLmV2ZW50O1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHNjaGVkdWxlciA9ICQoZS5zZW5kZXIuZWxlbWVudCkuZGF0YShcImtlbmRvU2NoZWR1bGVyXCIpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgZGF0YVNvdXJjZSA9IHNjaGVkdWxlci5kYXRhU291cmNlO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGV2ZW50LmlkICE9PSBcIlwiKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyQoXCIuay1zY2hlZHVsZXJcIikuZGF0YShcImtlbmRvU2NoZWR1bGVyXCIpLmRhdGFTb3VyY2Uuc3luYygpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZXZlbnQuaWQgPSAxMjI7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBldmVudC5tZWV0aW5nSWQgPSAxMjI7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkYXRhU291cmNlLm9wdGlvbnMuZGF0YS5wdXNoKGV2ZW50KTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyQoXCIuay1zY2hlZHVsZXJcIikuZGF0YShcImtlbmRvU2NoZWR1bGVyXCIpLmFkZEV2ZW50KHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vICAgIHN0YXJ0OiBuZXcgRGF0ZShldmVudC5zdGFydCksXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyAgICBlbmQ6IG5ldyBEYXRlKGV2ZW50LmVuZClcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vfSk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZGF0YVNvdXJjZS5hZGQoeyBldmVudCB9KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8qZGF0YVNvdXJjZS5hZGQoe1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1lZXRpbmdJZDogMTIyLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJvb21JRDogMyxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhdHRlbmRlZXM6IGV2ZW50LmF0dGVuZGVlcyxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGFydDogZXZlbnQuc3RhcnQsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kOiBldmVudC5lbmQsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGl0bGU6IGV2ZW50LnRpdGxlLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRlc2NyaXB0aW9uOiBldmVudC50aXRsZSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGFydFRpbWV6b25lOiBcIlwiLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZFRpbWV6b25lOiBcIlwiLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlY3VycmVuY2VSdWxlOiBcIlwiLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlY3VycmVuY2VJRDogXCJcIixcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWN1cnJlbmNlRXhjZXB0aW9uOiBcIlwiLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlzQWxsRGF5OiBldmVudC5pc0FsbERheSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1aWQ6ZXZlbnQudWlkXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTsqL1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vZS5wcmV2ZW50RGVmYXVsdCgpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhcIlNhdmluZ1wiLCBlLmV2ZW50LnRpdGxlKTtcclxuICAgICAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgICAgIHJlbW92ZTogZnVuY3Rpb24gKGUpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgLy9lLnByZXZlbnREZWZhdWx0KCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiUmVtb3ZpbmdcIiwgZS5ldmVudC50aXRsZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgICAgICBjYW5jZWw6IGZ1bmN0aW9uIChlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8va1NjaGVkdWxlLmNhbmNlbENoYW5nZXMoKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coXCJDYW5jZWxcIik7XHJcbiAgICAgICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgICAgICBtb3ZlU3RhcnQ6IG5hdmNvbi5rZW5kby5zY2hlZHVsZS5tb3ZlU3RhcnQsXHJcbiAgICAgICAgICAgICAgICAgICAgbW92ZTogbmF2Y29uLmtlbmRvLnNjaGVkdWxlLm1vdmUsXHJcbiAgICAgICAgICAgICAgICAgICAgbW92ZUVuZDogbmF2Y29uLmtlbmRvLnNjaGVkdWxlLm1vdmVFbmQsXHJcbiAgICAgICAgICAgICAgICAgICAgcmVzaXplU3RhcnQ6IG5hdmNvbi5rZW5kby5zY2hlZHVsZS5yZXNpemVTdGFydCxcclxuICAgICAgICAgICAgICAgICAgICByZXNpemU6IG5hdmNvbi5rZW5kby5zY2hlZHVsZS5yZXNpemUsXHJcbiAgICAgICAgICAgICAgICAgICAgcmVzaXplRW5kOiBuYXZjb24ua2VuZG8uc2NoZWR1bGUucmVzaXplRW5kLFxyXG4gICAgICAgICAgICAgICAgICAgIG5hdmlnYXRlOiBuYXZjb24ua2VuZG8uc2NoZWR1bGUubmF2aWdhdGUsXHJcblxyXG4gICAgICAgICAgICAgICAgICAgIC8vZm9vdGVyIHNldHRpbmdzXHJcbiAgICAgICAgICAgICAgICAgICAgZm9vdGVyOiAoKHNldHRpbmdzLmZvb3RlciAhPT0gdW5kZWZpbmVkICYmIHNldHRpbmdzLmZvb3Rlci5lbmFibGVkICE9PSB1bmRlZmluZWQgJiYgc2V0dGluZ3MuZm9vdGVyLmVuYWJsZWQpID9cclxuICAgICAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29tbWFuZDogc2V0dGluZ3MuZm9vdGVyLmNvbW1hbmQgIT09IHVuZGVmaW5lZCA/IHNldHRpbmdzLmZvb3Rlci5jb21tYW5kIDogZmFsc2UsLy9cIndvcmtEYXlcIiBcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSA6IGZhbHNlKSxcclxuICAgICAgICAgICAgICAgICAgICAvL1BERiBzZXR0aW5nc1xyXG4gICAgICAgICAgICAgICAgICAgIHRvb2xiYXI6IFt7IG5hbWU6IFwicGRmXCIsIHRleHQ6IFwiRXhwb3J0IFBERlwiLCBpY29uQ2xhc3M6IFwiay1pY29uIGstaS1jb3B5XCIgfV0sXHJcbiAgICAgICAgICAgICAgICAgICAgcGRmOiAoKHNldHRpbmdzLnBkZiAhPT0gdW5kZWZpbmVkICYmIHNldHRpbmdzLnBkZi5lbmFibGVkICE9PSB1bmRlZmluZWQgJiYgc2V0dGluZ3MucGRmLmVuYWJsZWQpID9cclxuICAgICAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYWxsUGFnZXM6IHRydWUsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhdm9pZExpbmtzOiB0cnVlLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcGFwZXJTaXplOiBcIkE0XCIsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtYXJnaW46IHsgdG9wOiBcIjJjbVwiLCByaWdodDogXCIxY21cIiwgYm90dG9tOiBcIjFjbVwiLCBsZWZ0OiBcIjFjbVwiIH0sXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsYW5kc2NhcGU6IHRydWUsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXBlYXRIZWFkZXJzOiB0cnVlLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZmlsZU5hbWU6ICQoZWwpLmF0dHIoXCJ0eXBlXCIpICsgXCIucGRmXCIsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0ZW1wbGF0ZTogJChcIiNwcmludC10ZW1wbGF0ZVwiKS5odG1sKCksXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzY2FsZTogMC44XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gOiBudWxsKSxcclxuICAgICAgICAgICAgICAgICAgICBwZGZFeHBvcnQ6IGZ1bmN0aW9uIChlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRpdGxlID0gJChlbCkuYXR0cihcInR5cGVcIik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vZGF0ZSA9IG5hdmNvbi5nZXRDdXJyZW50RGF0ZSgpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgLy9rU2NoZWR1bGUuaGlkZUNvbHVtbig0KTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vZS5wcm9taXNlLmRvbmUoZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyAgICBrU2NoZWR1bGUuc2hvd0NvbHVtbig0KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgLy99KTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9KS5kYXRhKFwia2VuZG9TY2hlZHVsZXJcIik7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIHZhciB0b29sYmFyT3B0aW9ucyA9IFtdO1xyXG5cclxuICAgICAgICAgICAgaWYgKGtTY2hlZHVsZXIgIT09IHVuZGVmaW5lZCAmJiBrU2NoZWR1bGVyICE9PSBudWxsKSB7XHJcbiAgICAgICAgICAgICAgICAvLyQoXCIjc2NoZWR1bGVyXCIpLmRhdGEoXCJrZW5kb1NjaGVkdWxlclwiKS5hZGRFdmVudCh7XHJcbiAgICAgICAgICAgICAgICAvLyAgICBzdGFydDogbmV3IERhdGUoXCIyMDEzLzYvMTNcIiksXHJcbiAgICAgICAgICAgICAgICAvLyAgICBlbmQ6IG5ldyBEYXRlKFwiMjAxMy82LzEzXCIpXHJcbiAgICAgICAgICAgICAgICAvL30pO1xyXG5cclxuICAgICAgICAgICAgICAgICQoc2NoZWR1bGVyKS5rZW5kb1Rvb2x0aXAoe1xyXG4gICAgICAgICAgICAgICAgICAgIGZpbHRlcjogXCJ0ZFtyb2xlPSdncmlkY2VsbCddXCIsXHJcbiAgICAgICAgICAgICAgICAgICAgd2lkdGg6IDMwMCxcclxuICAgICAgICAgICAgICAgICAgICBjb250ZW50OiBmdW5jdGlvbiAoZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgc2NoZWR1bGVyID0gJCgkKGVsKS5maW5kKCcua2VuZG9TY2hlZHVsZScpWzBdKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgc2NoZWR1bGVyID0gJChzY2hlZHVsZXIpLmdldEtlbmRvU2NoZWR1bGVyKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBzbG90ID0gc2NoZWR1bGVyLnNsb3RCeUVsZW1lbnQoZS50YXJnZXQpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgZXZlbnRzID0gc2NoZWR1bGVyLm9jY3VycmVuY2VzSW5SYW5nZShzbG90LnN0YXJ0RGF0ZSwgc2xvdC5lbmREYXRlKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGNvbnRlbnQgPSBcIlwiO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGV2ZW50cy5sZW5ndGg7IGkrKykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29udGVudCA9IGNvbnRlbnQgKyBcIjxkaXY+XCIgKyBldmVudHNbaV0udGl0bGUgKyBcIjwvZGl2PlwiO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBjb250ZW50ID09IFwiXCIgPyBcIk5vIGV2ZW50c1wiIDogY29udGVudDtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgICAgICAvL011bHRpc2VsZWN0IGNvbnRyb2xcclxuICAgICAgICAgICAgICAgIC8vJHRpbWVvdXQoZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgLy92YXIgc2NoZWR1bGVyTVMgPSAkKCQoZWwpLmZpbmQoJy5zY2hlZHVsZXJNUycpWzBdKTtcclxuICAgICAgICAgICAgICAgIC8vc2NoZWR1bGVyTVMua2VuZG9NdWx0aVNlbGVjdCh7XHJcbiAgICAgICAgICAgICAgICAvLyAgICBkZWxheTogMTAwMCwgLy8gd2FpdCAxIHNlY29uZCBiZWZvcmUgY2xlYXJpbmcgdGhlIHVzZXIgaW5wdXRcclxuICAgICAgICAgICAgICAgIC8vICAgIGRhdGFUZXh0RmllbGQ6IFwidGV4dFwiLFxyXG4gICAgICAgICAgICAgICAgLy8gICAgZGF0YVZhbHVlRmllbGQ6IFwidmFsdWVcIixcclxuICAgICAgICAgICAgICAgIC8vICAgIGRhdGFTb3VyY2U6IHtcclxuICAgICAgICAgICAgICAgIC8vICAgICAgICBkYXRhOiAkKHNjaGVkdWxlcikuZ2V0S2VuZG9TY2hlZHVsZXIoKS5yZXNvdXJjZXNbMF0uZGF0YVNvdXJjZS5kYXRhKCkudG9KU09OKClcclxuICAgICAgICAgICAgICAgIC8vICAgIH0sXHJcbiAgICAgICAgICAgICAgICAvLyAgICAvL3ZhbHVlOiBbJChzY2hlZHVsZXIpLmdldEtlbmRvU2NoZWR1bGVyKCkucmVzb3VyY2VzWzBdLmRhdGFTb3VyY2UuYXQoMCkudmFsdWVdLFxyXG4gICAgICAgICAgICAgICAgLy8gICAgLy9jaGFuZ2U6IG5hdmNvbi5rZW5kby5zY2hlZHVsZS5tdWx0aXNlbGVjdENoYW5nZShlbCwgc2NoZWR1bGVyLCB0aGlzLnZhbHVlKCkpLFxyXG4gICAgICAgICAgICAgICAgLy99KTtcclxuXHJcbiAgICAgICAgICAgICAgICAvL3ZhciBtdWx0aXNlbGVjdCA9ICQoc2NoZWR1bGVyTVMpLmRhdGEoXCJrZW5kb011bHRpU2VsZWN0XCIpO1xyXG4gICAgICAgICAgICAgICAgLy9tdWx0aXNlbGVjdC52YWx1ZSgkKHNjaGVkdWxlcikuZ2V0S2VuZG9TY2hlZHVsZXIoKS5yZXNvdXJjZXNbMF0uZGF0YVNvdXJjZS5hdCgwKS52YWx1ZSk7XHJcbiAgICAgICAgICAgICAgICAvLy8vbXVsdGlzZWxlY3QudHJpZ2dlcihcImNoYW5nZVwiKTtcclxuICAgICAgICAgICAgICAgIC8vbXVsdGlzZWxlY3QuYmluZChcImNoYW5nZVwiLCBuYXZjb24ua2VuZG8uc2NoZWR1bGUubXVsdGlzZWxlY3RDaGFuZ2UoZWwsIHNjaGVkdWxlciwgbXVsdGlzZWxlY3QpKTtcclxuXHJcbiAgICAgICAgICAgICAgICAvL3ZhciBzY2hlZHVsZXJNU0IgPSAkKCQoZWwpLmZpbmQoJy5zY2hlZHVsZXJNU0InKVswXSk7XHJcbiAgICAgICAgICAgICAgICAvLyQoc2NoZWR1bGVyTVNCKS5jbGljayhmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICAvLyAgICBuYXZjb24ua2VuZG8uc2NoZWR1bGUubXVsdGlzZWxlY3RHcm91cChlbCwgc2NoZWR1bGVyLCBrU2NoZWR1bGVyKVxyXG4gICAgICAgICAgICAgICAgLy99KTtcclxuICAgICAgICAgICAgICAgIC8vfSk7XHJcblxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSxcclxuICAgICAgICBjaGFuZ2U6IGZ1bmN0aW9uIChlKSB7XHJcbiAgICAgICAgICAgIC8vdmFyIHN0YXJ0ID0gZS5zdGFydDtcclxuICAgICAgICAgICAgLy92YXIgZW5kID0gZS5lbmQ7XHJcbiAgICAgICAgICAgIC8vdmFyIHNjb3BlID0gJChlLnNlbmRlci5lbGVtZW50KS5zY29wZSgpO1xyXG5cclxuICAgICAgICAgICAgLy92YXIgc2NoZWR1bGVyID0gJChlLnNlbmRlci5lbGVtZW50KS5kYXRhKFwia2VuZG9TY2hlZHVsZXJcIik7XHJcbiAgICAgICAgICAgIC8vLy9zY2hlZHVsZXIub3B0aW9ucy5ncm91cC5vcmllbnRhdGlvbiA9IHRoaXMudmFsdWUoKTtcclxuXHJcbiAgICAgICAgICAgIC8vLy9zY2hlZHVsZXIudmlldyhzY29wZS5jYWxlbmRhclNldHRpbmcuZGVmYXVsdFZpZXcpO1xyXG4gICAgICAgICAgICAvLy8vc2NoZWR1bGVyLnZpZXcoc2NoZWR1bGVyLnZpZXcoKS5uYW1lKTtcclxuXHJcbiAgICAgICAgICAgIC8vLy9jb25zb2xlLmxvZyhrZW5kby5mb3JtYXQoXCJTZWxlY3Rpb24gYmV0d2VlbiB7MDpnfSBhbmQgezE6Z31cIiwgc3RhcnQsIGVuZCkpO1xyXG4gICAgICAgIH0sXHJcbiAgICAgICAgbXVsdGlzZWxlY3RDaGFuZ2U6IGZ1bmN0aW9uIChlbCwgc2NvcGUsIHNjaGVkdWxlciwgdmFsdWVzKSB7XHJcbiAgICAgICAgICAgIHZhciBzY2hlZHVsZXIgPSAkKHNjaGVkdWxlcikuZ2V0S2VuZG9TY2hlZHVsZXIoKTtcclxuICAgICAgICAgICAgdmFyIHJlc291cmNlcyA9IHNjaGVkdWxlci5yZXNvdXJjZXM7XHJcblxyXG4gICAgICAgICAgICB2YXIgZmlsdGVycyA9IG51bGw7XHJcbiAgICAgICAgICAgIGlmICh2YWx1ZXMgIT09IHVuZGVmaW5lZCAmJiB2YWx1ZXMgIT09IG51bGwgJiYgdmFsdWVzLmxlbmd0aCAhPT0gMCkge1xyXG4gICAgICAgICAgICAgICAgZmlsdGVycyA9ICQubWFwKHZhbHVlcywgZnVuY3Rpb24gKHZhbCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB7IGZpZWxkOiBcInZhbHVlXCIsIG9wZXJhdG9yOiBcImVxXCIsIHZhbHVlOiB2YWwgfVxyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGlmIChmaWx0ZXJzICE9PSBudWxsKSB7XHJcbiAgICAgICAgICAgICAgICByZXNvdXJjZXNbMF0uZGF0YVNvdXJjZS5maWx0ZXIoe1xyXG4gICAgICAgICAgICAgICAgICAgIGxvZ2ljOiBcIm9yXCIsXHJcbiAgICAgICAgICAgICAgICAgICAgZmlsdGVyczogKChmaWx0ZXJzICE9PSB1bmRlZmluZWQgJiYgZmlsdGVycyAhPT0gbnVsbCAmJiBmaWx0ZXJzICE9PSAtMSkgPyBmaWx0ZXJzIDogbnVsbClcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgcmVzb3VyY2VzWzBdLmRhdGFTb3VyY2UuX2ZpbHRlciA9IHVuZGVmaW5lZDtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgbmF2Y29uLmtlbmRvLnNjaGVkdWxlLnNldHRpbmcoZWwsIHNjb3BlLmNhbGVuZGFyU2V0dGluZywgc2NvcGUsIHsgcmVzb3VyY2VzOiByZXNvdXJjZXMgfSk7XHJcbiAgICAgICAgfSxcclxuICAgICAgICBtdWx0aXNlbGVjdEdyb3VwOiBmdW5jdGlvbiAoZWwsIHNjb3BlKSB7XHJcbiAgICAgICAgICAgIHZhciBncm91cCA9IHNjb3BlLmNhbGVuZGFyU2V0dGluZy5ncm91cDtcclxuXHJcbiAgICAgICAgICAgIHZhciBidXR0b24gPSAkKCQoZWwpLmZpbmQoJy5zY2hlZHVsZXJNU0InKVswXSk7XHJcbiAgICAgICAgICAgIGlmIChidXR0b24udGV4dCgpID09PSBcIkdyb3VwXCIpIHtcclxuICAgICAgICAgICAgICAgIGJ1dHRvbi50ZXh0KFwiVW5ncm91cFwiKTtcclxuICAgICAgICAgICAgICAgIC8vZ3JvdXAucmVzb3VyY2VzPSBbXCJSb29tc1wiXVxyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgYnV0dG9uLnRleHQoXCJHcm91cFwiKTtcclxuICAgICAgICAgICAgICAgIGdyb3VwLnJlc291cmNlcyA9IG51bGw7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIG5hdmNvbi5rZW5kby5zY2hlZHVsZS5zZXR0aW5nKGVsLCBzY29wZS5jYWxlbmRhclNldHRpbmcsIHNjb3BlLCB7IGdyb3VwOiBncm91cCB9KTtcclxuICAgICAgICB9LFxyXG4gICAgICAgIGl0ZW1QYWdlQ2hhbmdlOiBmdW5jdGlvbiAoZWwsIHNjb3BlLCB2YWx1ZXMpIHtcclxuICAgICAgICAgICAgc2NvcGUucmVjb3Jkc19wZXJfcGFnZSA9IHZhbHVlcy50b1N0cmluZygpLnRvTG93ZXJDYXNlKCkgPT09IFwiYWxsXCIgPyBzY29wZS5vYmpKc29uLmxlbmd0aCA6IHZhbHVlcztcclxuXHJcbiAgICAgICAgICAgIHNjb3BlLmN1cnJlbnRfcGFnZS0tO1xyXG4gICAgICAgICAgICBzY29wZS5uZXh0UGFnZSgpO1xyXG4gICAgICAgIH0sXHJcbiAgICAgICAgZGF0YUJpbmRpbmc6IGZ1bmN0aW9uIChlKSB7XHJcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiZGF0YSBiaW5kaW5nXCIpO1xyXG4gICAgICAgIH0sXHJcbiAgICAgICAgZGF0YUJvdW5kOiBmdW5jdGlvbiAoZSkge1xyXG4gICAgICAgICAgICB2YXIgdmlldyA9IHRoaXMudmlldygpO1xyXG4gICAgICAgICAgICB2YXIgZXZlbnRzID0gdGhpcy5kYXRhU291cmNlLnZpZXcoKTtcclxuICAgICAgICAgICAgdmFyIGV2ZW50RWxlbWVudDtcclxuICAgICAgICAgICAgdmFyIGV2ZW50O1xyXG5cclxuICAgICAgICAgICAgdmFyIHRhYmxlMSA9ICQoXCIuay1zY2hlZHVsZXItdGltZXMgLmstc2NoZWR1bGVyLXRhYmxlXCIpO1xyXG4gICAgICAgICAgICB0YWJsZTEgPSB0YWJsZTEuZmlyc3QoKTtcclxuICAgICAgICAgICAgdGFibGUxLmZpbmQoXCJ0cjpudGgoMClcIikuY2hpbGRyZW4oKS5maXJzdCgpLnRleHQoXCJSZXNvdXJjZXNcIikuY3NzKHsgXCJ0ZXh0LWFsaWduXCI6IFwibGVmdFwiIH0pO1xyXG4gICAgICAgICAgICB0YWJsZTEuZmluZChcInRyOm50aCgxKVwiKS5oaWRlKCk7XHJcblxyXG4gICAgICAgICAgICB2YXIgdGFibGUyID0gJChcIi5rLXNjaGVkdWxlci1oZWFkZXIgLmstc2NoZWR1bGVyLWhlYWRlci13cmFwIC5rLXNjaGVkdWxlci10YWJsZVwiKTtcclxuICAgICAgICAgICAgdGFibGUyID0gdGFibGUyLmxhc3QoKTtcclxuICAgICAgICAgICAgdGFibGUyLmZpbmQoXCJ0cjpudGgoMSlcIikuaGlkZSgpO1xyXG5cclxuICAgICAgICAgICAgLy92YXIgcm93cyA9IHRhYmxlLmZpbmQoXCJ0clwiKS5oaWRlKCk7XHJcbiAgICAgICAgICAgIC8vcm93cy5lYWNoKGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgLy8gICAgJCh0aGlzKS5jaGlsZHJlbihcInRoOmxhc3RcIikuaGlkZSgpO1xyXG4gICAgICAgICAgICAvL30pO1xyXG5cclxuICAgICAgICAgICAgLypmb3IgKHZhciBpZHggPSAwLCBsZW5ndGggPSBldmVudHMubGVuZ3RoOyBpZHggPCBsZW5ndGg7IGlkeCsrKSB7XHJcbiAgICAgICAgICAgICAgICBldmVudCA9IGV2ZW50c1tpZHhdO1xyXG4gICAgICAgIFxyXG4gICAgICAgICAgICAgICAgLy9nZXQgZXZlbnQgZWxlbWVudFxyXG4gICAgICAgICAgICAgICAgZXZlbnRFbGVtZW50ID0gdmlldy5lbGVtZW50LmZpbmQoXCJbZGF0YS11aWQ9XCIgKyBldmVudC51aWQgKyBcIl1cIik7XHJcbiAgICAgICAgXHJcbiAgICAgICAgICAgICAgICAvL3NldCB0aGUgYmFja2dyb3VkIG9mIHRoZSBlbGVtZW50XHJcbiAgICAgICAgICAgICAgICBldmVudEVsZW1lbnQuY3NzKFwiYmFja2dyb3VuZC1jb2xvclwiLCBcInJlZFwiKTtcclxuICAgICAgICAgICAgfSovXHJcblxyXG4gICAgICAgICAgICBjb25zb2xlLmxvZyhcImRhdGEgYm91bmRcIik7XHJcbiAgICAgICAgfSxcclxuICAgICAgICBtZXNzYWdlc0luZm86IGZ1bmN0aW9uIChlKSB7XHJcbiAgICAgICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgICAgICBhbGxEYXk6IFwiZGFpbHlcIixcclxuICAgICAgICAgICAgICAgIGFyaWFFdmVudExhYmVsOiBcIlNlbGVjdGVkIGV2ZW50IGlzIHswfS4gSXQgc3RhcnRzIG9uIHsxOmR9IHsyOnR9XCIsXHJcbiAgICAgICAgICAgICAgICBhcmlhU2xvdExhYmVsOiBcIlNlbGVjdGVkIGZyb20gezA6Z30gdG8gezA6Z31cIixcclxuICAgICAgICAgICAgICAgIGRhdGU6IFwiRGF0ZVwiLFxyXG4gICAgICAgICAgICAgICAgZGVsZXRlV2luZG93VGl0bGU6IFwiUmVtb3ZlIGV2ZW50XCIsXHJcbiAgICAgICAgICAgICAgICBldmVudDogXCJNZWV0aW5nXCIsXHJcbiAgICAgICAgICAgICAgICBkZWZhdWx0Um93VGV4dDogXCJDb25mZXJlbmNlIHJvb21cIixcclxuICAgICAgICAgICAgICAgIHNob3dGdWxsRGF5OiBcIlNob3cgMjRoXCIsXHJcbiAgICAgICAgICAgICAgICBzaG93V29ya0RheTogXCJTaG93IHdvcmsgaG91cnNcIixcclxuICAgICAgICAgICAgICAgIHRpbWU6IFwiVGltZSBvZiB0aGUgZGF5XCIsXHJcbiAgICAgICAgICAgICAgICB0b2RheTogXCJDdXJyZW50IERhdGVcIixcclxuICAgICAgICAgICAgICAgIHByZXZpb3VzOiBcIlByZXZpb3VzXCIsXHJcbiAgICAgICAgICAgICAgICBuZXh0OiBcIk5leHRcIixcclxuICAgICAgICAgICAgICAgIHNhdmU6IFwiVXBkYXRlXCIsXHJcbiAgICAgICAgICAgICAgICBjYW5jZWw6IFwiVW5kb1wiLFxyXG4gICAgICAgICAgICAgICAgZGVzdHJveTogXCJEZXN0cm95XCIsXHJcbiAgICAgICAgICAgICAgICBwZGY6IFwiUERGIEV4cG9ydFwiLFxyXG4gICAgICAgICAgICAgICAgZWRpdGFibGU6IHtcclxuICAgICAgICAgICAgICAgICAgICBjb25maXJtYXRpb246IFwiQXJlIHlvdSBzdXJlIHlvdSB3YW50IHRvIGRlbGV0ZSB0aGlzIG1lZXRpbmc/XCIsXHJcbiAgICAgICAgICAgICAgICAgICAgYWxsRGF5RXZlbnQ6IFwiRnVsbCBkYXlcIixcclxuICAgICAgICAgICAgICAgICAgICBkZXNjcmlwdGlvbjogXCJNZXNzYWdlXCIsXHJcbiAgICAgICAgICAgICAgICAgICAgZWRpdG9yVGl0bGU6IFwiRWRpdCBldmVudFwiLFxyXG4gICAgICAgICAgICAgICAgICAgIGVuZDogXCJFbmQgb2YgdGhlIGV2ZW50XCIsXHJcbiAgICAgICAgICAgICAgICAgICAgZW5kVGltZXpvbmU6IFwiRW5kIGRhdGUgdGltZXpvbmVcIixcclxuICAgICAgICAgICAgICAgICAgICByZXBlYXQ6IFwiUmVwZWF0IHRoZSBldmVudFwiLFxyXG4gICAgICAgICAgICAgICAgICAgIHNlcGFyYXRlVGltZXpvbmVzOiBcIlNldCBkaWZmZXJlbnQgc3RhcnQgYW5kIGVuZCB0aW1lIHpvbmVzXCIsXHJcbiAgICAgICAgICAgICAgICAgICAgc3RhcnQ6IFwiU3RhcnQgb2YgdGhlIGV2ZW50XCIsXHJcbiAgICAgICAgICAgICAgICAgICAgc3RhcnRUaW1lem9uZTogXCJTdGFydCBkYXRlIHRpbWV6b25lXCIsXHJcbiAgICAgICAgICAgICAgICAgICAgdGltZXpvbmU6IFwiRXZlbnQgdGltZXpvbmVcIixcclxuICAgICAgICAgICAgICAgICAgICB0aW1lem9uZUVkaXRvckJ1dHRvbjogXCJUaW1lIHpvbmVcIixcclxuICAgICAgICAgICAgICAgICAgICB0aW1lem9uZUVkaXRvclRpdGxlOiBcIlRpbWV6b25lc1wiLFxyXG4gICAgICAgICAgICAgICAgICAgIHRpdGxlOiBcIlRpdGxlIG9mIHRoZSBldmVudFwiLFxyXG4gICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgIHJlY3VycmVuY2VFZGl0b3I6IHtcclxuICAgICAgICAgICAgICAgICAgICBkYWlseToge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpbnRlcnZhbDogXCIgZGF5cyhzKVwiLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXBlYXRFdmVyeTogXCJSZXBlYXQgb246IFwiLFxyXG4gICAgICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICAgICAgZW5kOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGFmdGVyOiBcImFmdGVyIFwiLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBvY2N1cnJlbmNlOiBcIiBvY2N1cnJlbmNlKHMpLlwiLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBsYWJlbDogXCJlbmQ6IFwiLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBuZXZlcjogXCJuZXZlclwiLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBtb2JpbGVMYWJlbDogXCJlbmRzOiBcIixcclxuICAgICAgICAgICAgICAgICAgICAgICAgb246IFwib24gXCIsXHJcblxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICByZWN1cnJlbmNlRWRpdG9yOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgZnJlcXVlbmNpZXM6IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgZGFpbHk6IFwiZGFpbHlcIixcclxuICAgICAgICAgICAgICAgICAgICAgICAgbW9udGhseTogXCJtb250aGx5XCIsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHdlZWtseTogXCJ3ZWVrbHlcIixcclxuICAgICAgICAgICAgICAgICAgICAgICAgeWVhcmx5OiBcInllYXJseVwiLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBuZXZlcjogXCJuZXZlclwiLFxyXG4gICAgICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICAgICAgbW9udGhseToge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBkYXk6IFwiZGF5IFwiLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBpbnRlcnZhbDogXCIgbW9udGgocykuXCIsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlcGVhdEV2ZXJ5OiBcIlJlcGVhdCBlYWNoOiBcIixcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmVwZWF0T246IFwicmVwZWF0IG9uOiBcIixcclxuICAgICAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgICAgIG9mZnNldFBvc2l0aW9uczoge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBmaXJzdDogXCJmaXJzdFwiLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBzZWNvbmQ6IFwic2Vjb25kXCIsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGxhc3Q6IFwibGFzdFwiLFxyXG4gICAgICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICAgICAgd2Vla2x5OiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGludGVydmFsOiBcIiB3ZWVrKHMpLlwiLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXBlYXRFdmVyeTogXCJSZXBlYXQgZWFjaDogXCIsXHJcbiAgICAgICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgICAgICB3ZWVrZGF5czoge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBkYXk6IFwiRGF5XCIsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHdlZWtkYXk6IFwiV2VlayBkYXlcIixcclxuICAgICAgICAgICAgICAgICAgICAgICAgd2Vla2VuZDogXCJXZWVrIGRheVwiXHJcbiAgICAgICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgICAgICB5ZWFybHk6IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgb2Y6IFwiIG9mIFwiLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXBlYXRFdmVyeTogXCJSZXBlYXQgZWFjaDogXCIsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlcGVhdE9uOiBcInJlcGVhdCBvbjogXCIsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGludGVydmFsOiBcIiB5ZWFyKHMpLlwiLFxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICByZWN1cnJlbmNlTWVzc2FnZXM6IHtcclxuICAgICAgICAgICAgICAgICAgICBkZWxldGVSZWN1cnJpbmc6IFwiRGVsZXRlIG9ubHkgdGhpcyBldmVudCBvY2N1cnJlbmNlIG9yIHRoZSB3aG9sZSBzZXJpZXM/XCIsXHJcbiAgICAgICAgICAgICAgICAgICAgZGVsZXRlV2luZG93T2NjdXJyZW5jZTogXCJEZWxldGUgY3VycmVudCBldmVudFwiLFxyXG4gICAgICAgICAgICAgICAgICAgIGRlbGV0ZVdpbmRvd1NlcmllczogXCJEZWxldGUgYWxsIG9jY3VycmVuY2VzXCIsXHJcbiAgICAgICAgICAgICAgICAgICAgZGVsZXRlV2luZG93VGl0bGU6IFwiRGVsZXRlIFJlY3VycmluZyBldmVudFwiLFxyXG4gICAgICAgICAgICAgICAgICAgIGVkaXRSZWN1cnJpbmc6IFwiRG8geW91IHdhbnQgdG8gZWRpdCBvbmx5IHRoaXMgZXZlbnQgb3IgdGhlIHdob2xlIHNlcmllcz9cIixcclxuICAgICAgICAgICAgICAgICAgICBlZGl0V2luZG93T2NjdXJyZW5jZTogXCJFZGl0IGN1cnJlbnQgZXZlbnRcIixcclxuICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICB2aWV3czoge1xyXG4gICAgICAgICAgICAgICAgICAgIGRheTogXCJUb2RheVwiLFxyXG4gICAgICAgICAgICAgICAgICAgIHdlZWs6IFwiV2Vla2x5XCIsXHJcbiAgICAgICAgICAgICAgICAgICAgbW9udGg6IFwiTW9udGhseVwiLFxyXG4gICAgICAgICAgICAgICAgICAgIGFnZW5kYTogXCJFdmVudHMgbGlzdFwiLFxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9O1xyXG4gICAgICAgIH0sXHJcbiAgICAgICAgZGVzdHJveUVkaXRvcigpIHtcclxuICAgICAgICAgICAgLy92YXIgZWRpdG9yID0gJChcIiNlZGl0b3JcIik7XHJcbiAgICAgICAgICAgIC8vdmFyIHRlbXBsYXRlID0ga2VuZG8udGVtcGxhdGUoJChcIiNlZGl0b3ItdGVtcGxhdGVcIikuaHRtbCgpKTtcclxuICAgICAgICAgICAgLy92YXIgc2NoZWR1bGVyID0gJChcIiNzY2hlZHVsZXJcIikuZGF0YShcImtlbmRvU2NoZWR1bGVyXCIpO1xyXG5cclxuICAgICAgICAgICAgLy9rZW5kby5kZXN0cm95KGVkaXRvcik7XHJcbiAgICAgICAgICAgIC8vZWRpdG9yLmZpbmQoXCJidXR0b25cIikub2ZmKCk7XHJcbiAgICAgICAgICAgIC8vZWRpdG9yLmh0bWwoXCJcIik7XHJcbiAgICAgICAgfSxcclxuICAgICAgICBlZGl0RXZlbnQ6IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgLy92YXIgZWRpdG9yID0gJChcIiNlZGl0b3JcIik7XHJcbiAgICAgICAgICAgIC8vdmFyIHRlbXBsYXRlID0ga2VuZG8udGVtcGxhdGUoJChcIiNlZGl0b3ItdGVtcGxhdGVcIikuaHRtbCgpKTtcclxuICAgICAgICAgICAgLy92YXIgc2NoZWR1bGVyID0gJChcIiNzY2hlZHVsZXJcIikuZGF0YShcImtlbmRvU2NoZWR1bGVyXCIpO1xyXG5cclxuICAgICAgICAgICAgLy9uYXZjb24ua2VuZG8uc2NoZWR1bGUuZGVzdHJveUVkaXRvcigpO1xyXG5cclxuICAgICAgICAgICAgLy9lZGl0b3IuaHRtbCh0ZW1wbGF0ZSh7fSkpO1xyXG4gICAgICAgICAgICAvL2tlbmRvLmJpbmQoZWRpdG9yLCBldmVudCk7IC8vQmluZCB0aGUgZWRpdG9yIGNvbnRhaW5lciAodXNlcyBNVlZNKVxyXG5cclxuICAgICAgICAgICAgLy9lZGl0b3IuZmluZChcIiNzYXZlXCIpLmNsaWNrKGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgLy8gICAgc2NoZWR1bGVyLmRhdGFTb3VyY2Uuc3luYygpO1xyXG4gICAgICAgICAgICAvLyAgICBuYXZjb24ua2VuZG8uc2NoZWR1bGUuZGVzdHJveUVkaXRvcigpO1xyXG4gICAgICAgICAgICAvL30pO1xyXG5cclxuICAgICAgICAgICAgLy9lZGl0b3IuZmluZChcIiNjYW5jZWxcIikuY2xpY2soZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAvLyAgICBzY2hlZHVsZXIuZGF0YVNvdXJjZS5jYW5jZWxDaGFuZ2VzKGN1cnJlbnRFdmVudCk7XHJcbiAgICAgICAgICAgIC8vICAgIG5hdmNvbi5rZW5kby5zY2hlZHVsZS5kZXN0cm95RWRpdG9yKCk7XHJcbiAgICAgICAgICAgIC8vfSk7XHJcbiAgICAgICAgfSwgbW92ZVN0YXJ0OiBmdW5jdGlvbiAoZSkge1xyXG4gICAgICAgICAgICBjb25zb2xlLmxvZyhcIk1vdmUgU3RhcnRcIiwgZS5ldmVudC50aXRsZSk7XHJcbiAgICAgICAgfSwgbW92ZTogZnVuY3Rpb24gKGUpIHtcclxuICAgICAgICAgICAgLy92YXIgc2NoZWR1bGVyID0gJChcIiNzY2hlZHVsZXJcIikuZGF0YShcImtlbmRvU2NoZWR1bGVyXCIpO1xyXG4gICAgICAgICAgICAvL3ZhciB2aWV3ID0gc2NoZWR1bGVyLnZpZXcoKTtcclxuICAgICAgICAgICAgLy92YXIgdGVtcGxhdGUgPSBcInlvdXIgY3VzdG9tIHRlbXBsYXRlXCI7XHJcbiAgICAgICAgICAgIC8vJChcIi5rLWV2ZW50LWRyYWctaGludFwiKS5odG1sKHRlbXBsYXRlKTtcclxuXHJcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiTW92ZVwiLCBlLnNsb3Quc3RhcnQpO1xyXG4gICAgICAgIH0sIG1vdmVFbmQ6IGZ1bmN0aW9uIChlKSB7XHJcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiTW92ZUVuZFwiLCBlLnNsb3Quc3RhcnQpO1xyXG4gICAgICAgIH0sXHJcbiAgICAgICAgbmF2aWdhdGU6IGZ1bmN0aW9uIChlKSB7XHJcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKFwibmF2aWdhdGVcIiwgZS5kYXRlKTtcclxuICAgICAgICB9LFxyXG4gICAgICAgIHJlc2l6ZVN0YXJ0OiBmdW5jdGlvbiAoZSkge1xyXG4gICAgICAgICAgICBjb25zb2xlLmxvZyhcIlJlc2l6ZSBTdGFydFwiLCBlLmV2ZW50LnRpdGxlKTtcclxuICAgICAgICB9LFxyXG4gICAgICAgIHJlc2l6ZTogZnVuY3Rpb24gKGUpIHtcclxuICAgICAgICAgICAgY29uc29sZS5sb2coXCJSZXNpemVcIiwgZS5zbG90LnN0YXJ0KTtcclxuICAgICAgICB9LFxyXG4gICAgICAgIHJlc2l6ZUVuZDogZnVuY3Rpb24gKGUpIHtcclxuICAgICAgICAgICAgY29uc29sZS5sb2coXCJSZXNpemUgRW5kXCIsIGUuc2xvdC5zdGFydCk7XHJcbiAgICAgICAgfSxcclxuICAgICAgICByZWZyZXNoOiBmdW5jdGlvbiAoZWwsIHNldHRpbmcsIHNjb3BlKSB7XHJcbiAgICAgICAgICAgIHZhciBzY2hlZHVsZXJFbGVtZW50ID0gJCgkKGVsKS5maW5kKCcua2VuZG9TY2hlZHVsZScpWzBdKTtcclxuICAgICAgICAgICAgc2NoZWR1bGVyID0gc2NoZWR1bGVyRWxlbWVudC5nZXRLZW5kb1NjaGVkdWxlcigpO1xyXG5cclxuICAgICAgICAgICAgaWYgKHNjaGVkdWxlcikge1xyXG4gICAgICAgICAgICAgICAgc2NoZWR1bGVyLmRlc3Ryb3koKTtcclxuICAgICAgICAgICAgICAgIHNjaGVkdWxlckVsZW1lbnQuZW1wdHkoKTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgbmF2Y29uLmtlbmRvLnNjaGVkdWxlLnNldHRpbmcoZWwsIHNldHRpbmcsIHNjb3BlKTtcclxuICAgICAgICB9LFxyXG4gICAgICAgIHNlbGVjdGVkUm93SW5kZXg6IGZ1bmN0aW9uICh0YWJsZSwgc2VsZWN0ZWRSb3csIGlkQ29sdW1uKSB7XHJcbiAgICAgICAgICAgIHZhciByZXR1cm5EYXRhID0gLTE7XHJcbiAgICAgICAgICAgIHZhciB0YWJsZURhdGEgPSB0YWJsZS5kYXRhICE9PSB1bmRlZmluZWQgPyB0YWJsZS5kYXRhIDogdGFibGU7XHJcblxyXG4gICAgICAgICAgICBpZiAodGFibGVEYXRhICE9PSB1bmRlZmluZWQgJiYgdGFibGVEYXRhLmxlbmd0aCA+IDApXHJcbiAgICAgICAgICAgICAgICByZXR1cm5EYXRhID0gbmF2Y29uLmdldEl0ZW1JbmRleEJ5S2V5VmFsdWUodGFibGVEYXRhLCBpZENvbHVtbiwgc2VsZWN0ZWRSb3dbaWRDb2x1bW5dKTtcclxuXHJcbiAgICAgICAgICAgIHJldHVybiByZXR1cm5EYXRhO1xyXG4gICAgICAgIH0sXHJcbiAgICAgICAgLypjb2x1bW5Bc3NpZ246IGZ1bmN0aW9uICh0YWJsZSwgY29sdW1uRGF0YSwgc2VydmljZU5hbWUsIGNvbHVtblR5cGUpIHtcclxuICAgICAgICAgICAgdmFyIHJldHVybkRhdGEgPSBcIlwiO1xyXG4gICAgICAgICAgICBpZiAoc2VydmljZU5hbWUgIT0gdW5kZWZpbmVkICYmIHNlcnZpY2VOYW1lICE9IFwiXCIpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybkRhdGEgPSBkYXRhc2VydmljZS5nZXRTZXJ2ZXJEYXRhKHNlcnZpY2VOYW1lKS50aGVuKGZ1bmN0aW9uIChkYXRhKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGRhdGEgPT09IHVuZGVmaW5lZCB8fCBkYXRhLmxlbmd0aCA9PT0gMCkgcmV0dXJuO1xyXG4gICAgICAgICAgICAgICAgICAgIHRhYmxlQ29sdW1uQ3JlYXRlKGRhdGEsIGNvbHVtblR5cGUpO1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBkYXRhO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICB0YWJsZUNvbHVtbkNyZWF0ZShjb2x1bW5EYXRhLCBjb2x1bW5UeXBlKTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgZnVuY3Rpb24gdGFibGVDb2x1bW5DcmVhdGUoZGF0YSwgY29sdW1uVHlwZSkge1xyXG4gICAgICAgICAgICAgICAgaWYgKGRhdGEgIT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIGNvbHVtbmRldGFpbHMgPSBcIlwiLCBpID0gMDtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgZm9yIChpID0gMDsgaSA8IGRhdGEubGVuZ3RoOyBpKyspIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgLy92YXIgY29sdW1uSW5kZXggPSBuYXZjb24uZ2V0SXRlbUJ5S2V5VmFsdWUodGFibGUuY29sdW1uQ29udHJvbC5leGNlcHRDb2x1bW5zLCBcImluZGV4XCIsIGkpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgY29sdW1uSW5kZXggPSB0YWJsZS5jb2x1bW5Db250cm9sLmV4Y2VwdENvbHVtbnMuaW5kZXhPZihpKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGNvbHVtbkluZGV4ICE9PSAtMSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbHVtbmRldGFpbHMgKz0gXCJ7XFxcInRpdGxlXFxcIjogXFxcIlwiICsgZGF0YVtpXS50ZXh0LnRyaW0oKSArIFwiXFxcIiwgXFxcImRhdGFcXFwiOiBcXFwiXCIgKyBkYXRhW2ldLmlkICsgXCJcXFwiLCBcXFwid2lkdGhcXFwiOiBcXFwiMTAwcHhcXFwiIH0sXCI7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2VcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbHVtbmRldGFpbHMgKz0gXCJ7XFxcInRpdGxlXFxcIjogXFxcIlwiICsgZGF0YVtpXS50ZXh0LnRyaW0oKSArIFwiXFxcIiwgXFxcIm9wdGlvbnNcXFwiIDoge1xcXCJ0eXBlXFxcIiA6IFxcXCJcIiArIHRhYmxlLmNvbHVtbkNvbnRyb2wudHlwZSArIFwiXFxcIiwgXFxcImRhdGFUeXBlXFxcIjogXFxcIlwiICsgY29sdW1uVHlwZSArIFwiXFxcIn0sIFxcXCJkYXRhXFxcIjogXFxcIlwiICsgZGF0YVtpXS5pZCArIFwiXFxcIiwgXFxcIndpZHRoXFxcIjogXFxcIjEwMHB4XFxcIiB9LFwiO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAvL2NvbHVtbmRldGFpbHMgKz0gXCJ7XFxcInRpdGxlXFxcIjogXFxcIlwiICsgZGF0YVtpXS50ZXh0LnRyaW0oKSArIFwiXFxcIiwgXFxcImRhdGFcXFwiOiBcXFwiXCIgKyBkYXRhW2ldLmlkICsgXCJcXFwiLCBcXFwiZmllbGRcXFwiOiBcXFwiXCIgKyBkYXRhW2ldLmlkICsgXCJcXFwiLCBcXFwid2lkdGhcXFwiOiBcXFwiXCIgKyBjb2x1bW5JbmRleC53aWR0aCArIFwiXFxcIiwgXFxcImZpZWxkVHlwZVxcXCI6IFxcXCJ0ZXh0XFxcIiB9LFwiO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBpZiAoY29sdW1uZGV0YWlscyAhPT0gXCJcIikgY29sdW1uZGV0YWlscyA9IGNvbHVtbmRldGFpbHMuc3Vic3RyaW5nKDAsIGNvbHVtbmRldGFpbHMubGVuZ3RoIC0gMSk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIHRhYmxlLmNvbHVtbnMgPSAkLnBhcnNlSlNPTihcIltcIiArIGNvbHVtbmRldGFpbHMgKyBcIl1cIik7XHJcbiAgICAgICAgICAgICAgICAgICAgLy90YWJsZS5jb2x1bW5zID0gbmF2Y29uLmpzb25UcmFuc2Zvcm1lZCgkLnBhcnNlSlNPTihcIltcIiArIGNvbHVtbmRldGFpbHMgKyBcIl1cIikpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGRhdGE7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9LFxyXG4gICAgICAgIG1hbmFnZURhdGE6IGZ1bmN0aW9uIChjb2x1bW5zLCBpdGVtcykge1xyXG4gICAgICAgICAgICBmb3IgKHZhciBpbmRleCBpbiBpdGVtcykge1xyXG4gICAgICAgICAgICAgICAgdmFyIGl0ZW0gPSBpdGVtc1tpbmRleF07XHJcbiAgICAgICAgICAgICAgICBmb3IgKHZhciBwIGluIGl0ZW0pIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoaXRlbS5oYXNPd25Qcm9wZXJ0eShwKSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgcHJvcFZhbCA9IGl0ZW1bcF07XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBvcHRpb25zID0gZ2V0Q29sdW1uT3B0aW9ucyhjb2x1bW5zLCBwKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKG9wdGlvbnMgIT09IC0xKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAob3B0aW9ucy50eXBlICE9PSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgcmV0VmFsID0gbmF2Y29uLmluc2VydENvbnRyb2wob3B0aW9ucy50eXBlLCBwcm9wVmFsKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpdGVtW3BdID0gcmV0VmFsO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBmdW5jdGlvbiBnZXRDb2x1bW5PcHRpb25zKGNvbHVtbnMsIHByb3ApIHtcclxuICAgICAgICAgICAgICAgIGZvciAoaW5kZXggaW4gY29sdW1ucykge1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBjb2wgPSBjb2x1bW5zW2luZGV4XTtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoY29sLmRhdGEgIT09IHVuZGVmaW5lZCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoY29sLmRhdGEgPT09IHByb3ApIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBjb2wub3B0aW9ucyB8fCAtMTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIHJldHVybiAtMTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgcmV0dXJuIGl0ZW1zO1xyXG4gICAgICAgIH0sKi9cclxuICAgICAgICBwZGZFeHBvcnQ6IGZ1bmN0aW9uIChrU2NoZWR1bGVyLCBzZXR0aW5ncywgZSkge1xyXG4gICAgICAgICAgICB2YXIgcHJvZ3Jlc3MgPSAkLkRlZmVycmVkKCk7XHJcblxyXG4gICAgICAgICAgICAvKmtlbmRvLmRyYXdpbmcuZHJhd0RPTSgkKFwiI2hlYWRlclwiKSlcclxuICAgICAgICAgICAgICAuZG9uZShmdW5jdGlvbihoZWFkZXIpIHtcclxuICAgICAgICAgICAgICAgICAga2VuZG8uZHJhd2luZy5kcmF3RE9NKCQoXCIjZm9vdGVyXCIpKVxyXG4gICAgICAgICAgICAgICAgICAgIC5kb25lKGZ1bmN0aW9uKGZvb3RlcikgeyovXHJcbiAgICAgICAgICAgIGtTY2hlZHVsZXIuX2RyYXdQREYocHJvZ3Jlc3MpXHJcbiAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24gKHJvb3QpIHtcclxuICAgICAgICAgICAgICAgICAgcm9vdC5jaGlsZHJlbi51bnNoaWZ0KGhlYWRlcik7XHJcbiAgICAgICAgICAgICAgICAgIHJvb3QuY2hpbGRyZW4ucHVzaChmb290ZXIpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgcmV0dXJuIGtlbmRvLmRyYXdpbmcuZXhwb3J0UERGKHJvb3QsIHtcclxuICAgICAgICAgICAgICAgICAgICAgIHBhcGVyU2l6ZTogXCJhdXRvXCIsXHJcbiAgICAgICAgICAgICAgICAgICAgICBtYXJnaW46IHsgbGVmdDogXCIxY21cIiwgdG9wOiBcIjFjbVwiLCByaWdodDogXCIxY21cIiwgYm90dG9tOiBcIjFjbVwiIH0sXHJcbiAgICAgICAgICAgICAgICAgICAgICBtdWx0aVBhZ2U6IHRydWVcclxuICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgICAuZG9uZShmdW5jdGlvbiAoZGF0YVVSSSkge1xyXG4gICAgICAgICAgICAgICAgICAvL2NvbnNvbGUubG9nKFwiT2theVwiKTtcclxuICAgICAgICAgICAgICAgICAga2VuZG8uc2F2ZUFzKHtcclxuICAgICAgICAgICAgICAgICAgICAgIGRhdGFVUkk6IGRhdGFVUkksXHJcbiAgICAgICAgICAgICAgICAgICAgICBmaWxlTmFtZTogXCJuYXZjb24ucGRmXCJcclxuICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICAgIHByb2dyZXNzLnJlc29sdmUoKTtcclxuICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAvKn0pO1xyXG4gICAgICAgIH0pKi9cclxuICAgICAgICB9LFxyXG4gICAgICAgIGV4cG9ydERhdGE6IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgLy9kcmF3aW5nID0ga2VuZG8uZHJhd2luZztcclxuXHJcbiAgICAgICAgICAgIC8vLy93b3JrYXJvdW5kIFBERiBleHBvcnQgcm93c3BhbiBsaW1pdGF0aW9uXHJcbiAgICAgICAgICAgIC8vJChcIi5rLXNjaGVkdWxlci1jb250ZW50IHRhYmxlIFtyb3dzcGFuXVwiKS5lYWNoKGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgLy8gICAgdmFyIGN1cnJlbnRDZWxsID0gJCh0aGlzKTtcclxuICAgICAgICAgICAgLy8gICAgdmFyIHJvd1NwYW4gPSBwYXJzZUludChjdXJyZW50Q2VsbC5hdHRyKFwicm93c3BhblwiKSk7XHJcbiAgICAgICAgICAgIC8vICAgIHZhciBjdXJyZW50Um93ID0gY3VycmVudENlbGwuY2xvc2VzdChcInRyXCIpO1xyXG5cclxuICAgICAgICAgICAgLy8gICAgdmFyIG5leHRSb3cgPSBudWxsO1xyXG4gICAgICAgICAgICAvLyAgICBmb3IgKHZhciBpID0gMDsgaSA8IHJvd1NwYW4gLSAxOyBpKyspIHtcclxuICAgICAgICAgICAgLy8gICAgICAgIG5leHRSb3cgPSBuZXh0Um93ID8gbmV4dFJvdy5uZXh0KCkgOiBjdXJyZW50Um93Lm5leHQoKTtcclxuICAgICAgICAgICAgLy8gICAgICAgIG5leHRSb3cucHJlcGVuZCgkKFwiPHRkIGNsYXNzPSdpbnNlcnRlZCc+PC90ZD5cIikpO1xyXG4gICAgICAgICAgICAvLyAgICB9XHJcblxyXG4gICAgICAgICAgICAvLyAgICBjdXJyZW50Q2VsbC5hdHRyKFwicm93c3BhblwiLCAxKTtcclxuICAgICAgICAgICAgLy99KVxyXG5cclxuICAgICAgICAgICAgLy9kcmF3aW5nLmRyYXdET00oXCIjc2NoZWR1bGVyIC5rLXNjaGVkdWxlci1jb250ZW50XCIsIHtcclxuICAgICAgICAgICAgLy8gICAgcGFwZXJTaXplOiBcIkE0XCIsXHJcbiAgICAgICAgICAgIC8vICAgIG1hcmdpbjogXCIyY21cIixcclxuICAgICAgICAgICAgLy8gICAgc2NhbGU6IDAuNlxyXG4gICAgICAgICAgICAvL30pLnRoZW4oZnVuY3Rpb24gKGdyb3VwKSB7XHJcbiAgICAgICAgICAgIC8vICAgIGRyYXdpbmcucGRmLnNhdmVBcyhncm91cCwgXCJzY2hlZHVsZXJfYWdlbmRhLnBkZlwiKTtcclxuICAgICAgICAgICAgLy8gICAgdmFyIHNjaGVkdWxlciA9ICQoXCIjc2NoZWR1bGVyXCIpLmdldEtlbmRvU2NoZWR1bGVyKCk7XHJcbiAgICAgICAgICAgIC8vICAgIHNjaGVkdWxlci52aWV3KHNjaGVkdWxlci52aWV3KCkubmFtZSk7XHJcbiAgICAgICAgICAgIC8vfSk7XHJcbiAgICAgICAgfSxcclxuICAgICAgICB2YWxpZGF0aW9uU2NoZW1hOiBmdW5jdGlvbiAoc2V0dGluZ3MsIHNjb3BlKSB7XHJcbiAgICAgICAgICAgIHZhciBteUZpZWxkcyA9IHt9O1xyXG4gICAgICAgICAgICBpZiAoc2V0dGluZ3MubW9kZWwgIT09IHVuZGVmaW5lZCAmJiBzZXR0aW5ncy5tb2RlbCAhPT0gbnVsbCkge1xyXG4gICAgICAgICAgICAgICAgdmFyIHN0ckZpZWxkcyA9IFwiXCI7XHJcbiAgICAgICAgICAgICAgICAvL215RmllbGRzID0geyBcImlkXCI6IHNldHRpbmdzLm1vZGVsLmlkICE9PSB1bmRlZmluZWQgJiYgc2V0dGluZ3MubW9kZWwuaWQgIT09IFwiXCIgPyBzZXR0aW5ncy5tb2RlbC5pZCA6IFwiaWRcIiB9O1xyXG5cclxuICAgICAgICAgICAgICAgICQuZWFjaChzZXR0aW5ncy5tb2RlbC5maWVsZHMsIGZ1bmN0aW9uIChpLCBpdGVtKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIGtleSA9IGk7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIHR5cGUgPSBpdGVtLnR5cGUgIT09IHVuZGVmaW5lZCAmJiBpdGVtLnR5cGUgIT09IFwiXCIgPyBpdGVtLnR5cGUgOiBcIlwiO1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBmaWVsZFRpdGxlID0gaXRlbS5kZWZhdWx0VmFsdWUgIT09IHVuZGVmaW5lZCAmJiBpdGVtLmRlZmF1bHRWYWx1ZSAhPT0gXCJcIiA/IGl0ZW0uZGVmYXVsdFZhbHVlIDogXCJcIjtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGZpZWxkTmFtZSA9IGl0ZW0uZnJvbSAhPT0gdW5kZWZpbmVkICYmIGl0ZW0uZnJvbSAhPT0gXCJcIiA/IGl0ZW0uZnJvbSA6IFwiXCI7XG4gICAgICAgICAgICAgICAgICAgIHZhciBudWxsYWJsZSA9IGl0ZW0ubnVsbGFibGUgIT09IHVuZGVmaW5lZCAmJiBpdGVtLm51bGxhYmxlICE9PSBcIlwiID8gaXRlbS5udWxsYWJsZSA6IHRydWU7XG4gICAgICAgICAgICAgICAgICAgIHZhciBkZWZhdWx0VmFsdWUgPSBpdGVtLmRlZmF1bHRWYWx1ZSAhPT0gdW5kZWZpbmVkICYmIGl0ZW0uZGVmYXVsdFZhbHVlICE9PSBcIlwiID8gaXRlbS5kZWZhdWx0VmFsdWUgOiBcIlwiO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICB2YXIgZmllbGRLZXkgPSBpdGVtLmZpZWxkS2V5ICE9PSB1bmRlZmluZWQgJiYgaXRlbS5maWVsZEtleSAhPT0gXCJcIiA/IGl0ZW0uZmllbGRLZXkgOiBcIlwiO1xuICAgICAgICAgICAgICAgICAgICB2YXIgZmllbGQgPSBudWxsO1xuICAgICAgICAgICAgICAgICAgICB2YXIgZmllbGRLZXlJbmRleCA9IG5hdmNvbi5nZXRJdGVtSW5kZXhCeVByb3BlcnR5KHNjb3BlLmZpZWxkcywgZmllbGRLZXkpO1xuICAgICAgICAgICAgICAgICAgICBpZiAoZmllbGRLZXlJbmRleCAhPT0gdW5kZWZpbmVkICYmIGZpZWxkS2V5SW5kZXggIT09IC0xKSBmaWVsZCA9IHNjb3BlLmZpZWxkc1tmaWVsZEtleUluZGV4XTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGZpZWxkTmFtZSAhPT0gdW5kZWZpbmVkICYmIGZpZWxkTmFtZSAhPT0gbnVsbCAmJiBmaWVsZE5hbWUgIT09IFwiXCIpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHR5cGUudG9Mb3dlckNhc2UoKSA9PT0gXCJhdXRvc2VsZWN0XCIpIHR5cGUgPSBcInN0cmluZ1wiO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgLy9teUZpZWxkc1trZXldID0geyBcImZyb21cIjogZmllbGROYW1lLCBcInR5cGVcIjogdHlwZSwgXCJkZWZhdWx0VmFsdWVcIjogZGVmYXVsdFZhbHVlLCBcIm51bGxhYmxlXCI6IG51bGxhYmxlLCBcInZhbGlkYXRpb25cIjoge30gfTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgbXlGaWVsZHNba2V5XSA9IHsgXCJmcm9tXCI6IGZpZWxkTmFtZSwgXCJ0eXBlXCI6IHR5cGUsIFwidmFsaWRhdGlvblwiOiB7fSB9O1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGZpZWxkS2V5ICE9PSB1bmRlZmluZWQgJiYgZmllbGRLZXkgIT09IG51bGwgJiYgZmllbGRLZXkgIT09IFwiXCIpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG15RmllbGRzW2tleV0udmFsaWRhdGlvbltcInR5cGVcIl0gPSB0eXBlO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChmaWVsZCAhPT0gdW5kZWZpbmVkICYmIGZpZWxkICE9PSBudWxsICYmIGZpZWxkLnRlbXBsYXRlT3B0aW9ucyAhPT0gdW5kZWZpbmVkICYmIGZpZWxkLnRlbXBsYXRlT3B0aW9ucy5sZW5ndGggIT09IDApIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgdmFsaWRhdGlvbiA9IGZpZWxkLnRlbXBsYXRlT3B0aW9ucztcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvL1JlcXVpcmVkIG1lc3NhZ2VcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBuYXZjb24ua2VuZG8ucmVxdWlyZWRWYWxpZGF0aW9uKG15RmllbGRzW2tleV0sIGZpZWxkTmFtZSwgdmFsaWRhdGlvbik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLyppZiAodmFsaWRhdGlvbi5yZXF1aXJlZCAhPT0gdW5kZWZpbmVkICYmIHZhbGlkYXRpb24ucmVxdWlyZWQgIT09IG51bGwgJiYgKHZhbGlkYXRpb24ucmVxdWlyZWQgfHwgdmFsaWRhdGlvbi5yZXF1aXJlZC50b0xvd2VyQ2FzZSgpID09PSBcInllc1wiKSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodmFsaWRhdGlvbi5yZXF1aXJlZE1lc3NhZ2UgIT09IHVuZGVmaW5lZCAmJiB2YWxpZGF0aW9uLnJlcXVpcmVkTWVzc2FnZSAhPT0gbnVsbCAmJiB2YWxpZGF0aW9uLnJlcXVpcmVkTWVzc2FnZSAhPT0gXCJcIilcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG15RmllbGRzW2ZpZWxkTmFtZV0udmFsaWRhdGlvbltcInJlcXVpcmVkXCJdID0geyBcIm1lc3NhZ2VcIjogdmFsaWRhdGlvbi5yZXF1aXJlZE1lc3NhZ2UgfTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbXlGaWVsZHNbZmllbGROYW1lXS52YWxpZGF0aW9uW1wicmVxdWlyZWRcIl0gPSAodmFsaWRhdGlvbi5yZXF1aXJlZCB8fCB2YWxpZGF0aW9uLnJlcXVpcmVkLnRvTG93ZXJDYXNlKCkgPT09IFwieWVzXCIgPyB0cnVlIDogZmFsc2UpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0qL1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvL01pbml1bSBtZXNzYWdlXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbmF2Y29uLmtlbmRvLm1pbmltdW1WYWxpZGF0aW9uKG15RmllbGRzW2tleV0sIGZpZWxkTmFtZSwgdmFsaWRhdGlvbik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLyppZiAodmFsaWRhdGlvbi5taW5sZW5ndGggIT09IHVuZGVmaW5lZCAmJiB2YWxpZGF0aW9uLm1pbmxlbmd0aCAhPT0gbnVsbCAmJiB2YWxpZGF0aW9uLm1pbmxlbmd0aCAhPT0gXCJcIikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgbWVzc2FnZU1pbiA9IHZhbGlkYXRpb24ubWlubGVuZ3RoTWVzc2FnZSAhPT0gdW5kZWZpbmVkICYmIHZhbGlkYXRpb24ubWlubGVuZ3RoTWVzc2FnZSAhPT0gXCJcIiA/IHZhbGlkYXRpb24ubWlubGVuZ3RoTWVzc2FnZSA6IFwiTWluaW11bSBcIiArIHZhbGlkYXRpb24ubWlubGVuZ3RoICsgXCIgY2hhcmFjdGVyIHJlcXVpcmVkLlwiO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBteUZpZWxkc1tmaWVsZE5hbWVdLnZhbGlkYXRpb25bZmllbGROYW1lLnRvTG93ZXJDYXNlKCkgKyBcIm1pblwiXSA9IGZ1bmN0aW9uIChpbnB1dCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGlucHV0LmlzKFwiW25hbWU9J1wiICsgZmllbGROYW1lICsgXCInXVwiKSAmJiBpbnB1dC52YWwoKS5sZW5ndGggPCB2YWxpZGF0aW9uLm1pbmxlbmd0aCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlucHV0LmF0dHIoXCJkYXRhLVwiICsgZmllbGROYW1lLnRvTG93ZXJDYXNlKCkgKyBcIm1pbi1tc2dcIiwgXCJcIiArIHZhbGlkYXRpb24ubWlubGVuZ3RoTWVzc2FnZSArIFwiXCIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9Ki9cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy9NYXhpbXVtIG1lc3NhZ2VcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBuYXZjb24ua2VuZG8ubWF4aW11bVZhbGlkYXRpb24obXlGaWVsZHNba2V5XSwgZmllbGROYW1lLCB2YWxpZGF0aW9uKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvKmlmICh2YWxpZGF0aW9uLm1heGxlbmd0aCAhPT0gdW5kZWZpbmVkICYmIHZhbGlkYXRpb24ubWF4bGVuZ3RoICE9PSBudWxsICYmIHZhbGlkYXRpb24ubWF4bGVuZ3RoICE9PSBcIlwiKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBtZXNzYWdlTWluID0gdmFsaWRhdGlvbi5tYXhsZW5ndGhNZXNzYWdlICE9PSB1bmRlZmluZWQgJiYgdmFsaWRhdGlvbi5tYXhsZW5ndGhNZXNzYWdlICE9PSBcIlwiID8gdmFsaWRhdGlvbi5tYXhsZW5ndGhNZXNzYWdlIDogXCJNYXhpbXVtIFwiICsgdmFsaWRhdGlvbi5tYXhsZW5ndGggKyBcIiBvbmx5IGFsbG93ZWQuXCI7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG15RmllbGRzW2ZpZWxkTmFtZV0udmFsaWRhdGlvbltmaWVsZE5hbWUudG9Mb3dlckNhc2UoKSArIFwibWF4XCJdID0gZnVuY3Rpb24gKGlucHV0KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoaW5wdXQuaXMoXCJbbmFtZT0nXCIgKyBmaWVsZE5hbWUgKyBcIiddXCIpICYmIGlucHV0LnZhbCgpLmxlbmd0aCA+IHZhbGlkYXRpb24ubWF4bGVuZ3RoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaW5wdXQuYXR0cihcImRhdGEtXCIgKyBmaWVsZE5hbWUudG9Mb3dlckNhc2UoKSArIFwibWF4LW1zZ1wiLCBcIlwiICsgdmFsaWRhdGlvbi5tYXhsZW5ndGhNZXNzYWdlICsgXCJcIik7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0qL1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvL1BhdHRlcm4gbWVzc2FnZVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5hdmNvbi5rZW5kby5wYXR0ZXJuVmFsaWRhdGlvbihteUZpZWxkc1trZXldLCBmaWVsZE5hbWUsIHZhbGlkYXRpb24pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8qaWYgKHZhbGlkYXRpb24ucGF0dGVybiAhPT0gdW5kZWZpbmVkICYmIHZhbGlkYXRpb24ucGF0dGVybiAhPT0gbnVsbCAmJiB2YWxpZGF0aW9uLnBhdHRlcm4gIT09IFwiXCIpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHBhdHRlcm5SZWdleCA9IG5ldyBSZWdFeHAodmFsaWRhdGlvbi5wYXR0ZXJuLnRvU3RyaW5nKCkpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgbWVzc2FnZU1pbiA9IHZhbGlkYXRpb24ucGF0dGVybk1lc3NhZ2UgIT09IHVuZGVmaW5lZCAmJiB2YWxpZGF0aW9uLnBhdHRlcm5NZXNzYWdlICE9PSBcIlwiID8gdmFsaWRhdGlvbi5wYXR0ZXJuTWVzc2FnZSA6IFwiQWxwaGEgbnVtZXJpYyBvbmx5IGFsbG93ZWQuXCI7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG15RmllbGRzW2ZpZWxkTmFtZV0udmFsaWRhdGlvbltmaWVsZE5hbWUudG9Mb3dlckNhc2UoKSArIFwicGF0dGVyblwiXSA9IGZ1bmN0aW9uIChpbnB1dCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGlucHV0LmlzKFwiW25hbWU9J1wiICsgZmllbGROYW1lICsgXCInXVwiKSAmJiBpbnB1dC52YWwoKSAhPSBcIlwiKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaW5wdXQuYXR0cihcImRhdGEtXCIgKyBmaWVsZE5hbWUudG9Mb3dlckNhc2UoKSArIFwicGF0dGVybi1tc2dcIiwgXCJcIiArIHZhbGlkYXRpb24ucGF0dGVybk1lc3NhZ2UgKyBcIlwiKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHBhdHRlcm5SZWdleC50ZXN0KGlucHV0LnZhbCgpKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0qL1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvL0V4aXN0RGF0YSBtZXNzYWdlXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbmF2Y29uLmtlbmRvLmV4aXN0RGF0YVZhbGlkYXRpb24obXlGaWVsZHNba2V5XSwgZmllbGROYW1lLCB2YWxpZGF0aW9uLCBzY29wZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLyppZiAodmFsaWRhdGlvbi5pc0V4aXN0RGF0YSAhPT0gdW5kZWZpbmVkICYmIHZhbGlkYXRpb24uaXNFeGlzdERhdGEgIT09IG51bGwgJiYgdmFsaWRhdGlvbi5pc0V4aXN0RGF0YSAhPT0gXCJcIikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgc2NvcGVEYXRhID0gc2NvcGUubmF2Y29uRGF0YVt2YWxpZGF0aW9uLmlzRXhpc3REYXRhXTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGtleU9sZERhdGEgPSBcIlwiO1xyXG4gICAgXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBtZXNzYWdlTWluID0gdmFsaWRhdGlvbi5pc0V4aXN0TWVzc2FnZSAhPT0gdW5kZWZpbmVkICYmIHZhbGlkYXRpb24uaXNFeGlzdE1lc3NhZ2UgIT09IFwiXCIgPyB2YWxpZGF0aW9uLmlzRXhpc3RNZXNzYWdlIDogXCJhbHJlYWR5IGV4aXN0cy4uXCI7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG15RmllbGRzW2ZpZWxkTmFtZV0udmFsaWRhdGlvbltmaWVsZE5hbWUudG9Mb3dlckNhc2UoKSArIFwiZXhpc3RzXCJdID0gZnVuY3Rpb24gKGlucHV0KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoaW5wdXQuaXMoXCJbbmFtZT0nXCIgKyBmaWVsZE5hbWUgKyBcIiddXCIpICYmIGlucHV0LnZhbCgpICE9IFwiXCIpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoc2NvcGUuZmllbGRzLmdldEJ5SWQgIT09IHVuZGVmaW5lZCAmJiBzY29wZS5maWVsZHMuZ2V0QnlJZCAhPT0gbnVsbClcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAga2V5T2xkRGF0YSA9IHNjb3BlLmZpZWxkcy5nZXRCeUlkW2ZpZWxkS2V5XTtcclxuICAgIFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldFZhbCA9IG5hdmNvbi5nZXRJdGVtQnlLZXlWYWx1ZShzY29wZURhdGEsIGZpZWxkS2V5LCBpbnB1dC52YWwoKS50b1N0cmluZygpLnRyaW0oKSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHJldFZhbCAhPT0gLTEgJiYgaW5wdXQudmFsKCkudG9TdHJpbmcoKS50cmltKCkgIT09IGtleU9sZERhdGEudG9TdHJpbmcoKS50cmltKCkpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaW5wdXQuYXR0cihcImRhdGEtXCIgKyBmaWVsZE5hbWUudG9Mb3dlckNhc2UoKSArIFwiZXhpc3RzLW1zZ1wiLCBcIlwiICsgdmFsaWRhdGlvbi5pc0V4aXN0TWVzc2FnZSArIFwiXCIpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXRWYWwgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXRWYWwgPSB0cnVlO1xyXG4gICAgXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiByZXRWYWw7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9Ki9cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICByZXR1cm4gbXlGaWVsZHM7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG59KG5hdmNvbiB8fCB7fSkpOyIsIihmdW5jdGlvbiAobmF2Y29uKSB7XHJcbiAgICBuYXZjb24ua2VuZG8udGFibGUgPSB7XHJcbiAgICAgICAgZGlzdGluY3REYXRhOiBmdW5jdGlvbiAoY29sbGVjdGlvbkRhdGEsIGRpc3RpbmN0RmllbGQpIHtcclxuICAgICAgICAgICAgdmFyIGZpbHRlckRhdGEgPSBbXTtcclxuICAgICAgICAgICAgaWYgKGNvbGxlY3Rpb25EYXRhICE9PSB1bmRlZmluZWQgJiYgY29sbGVjdGlvbkRhdGEgIT09IG51bGwgJiYgY29sbGVjdGlvbkRhdGEubGVuZ3RoICE9PSAwKSB7XHJcbiAgICAgICAgICAgICAgICAkLmVhY2goY29sbGVjdGlvbkRhdGEsIGZ1bmN0aW9uIChpbmRleCwgZXZlbnQpIHtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgZXZlbnRzID0gJC5ncmVwKGZpbHRlckRhdGEsIGZ1bmN0aW9uIChlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBldmVudFtkaXN0aW5jdEZpZWxkXSA9PT0gZVtkaXN0aW5jdEZpZWxkXTtcclxuICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoZXZlbnRzLmxlbmd0aCA9PT0gMCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBmaWx0ZXJEYXRhLnB1c2goZXZlbnQpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHJldHVybiBmaWx0ZXJEYXRhO1xyXG4gICAgICAgIH0sXHJcbiAgICAgICAgZmlsdGVyRHJvcERvd246IGZ1bmN0aW9uIChlbGVtZW50LCBmaWVsZE5hbWUsIHNldHRpbmdzKSB7XHJcbiAgICAgICAgICAgIC8vdmFyIGRhdGFTb3VyY2UgPSBuZXcga2VuZG8uZGF0YS5EYXRhU291cmNlKHsgZGF0YTogdGhpcy5kYXRhUy5kYXRhKCkudG9KU09OKCkgfSk7XHJcblxyXG4gICAgICAgICAgICB2YXIgZGF0YSA9IG5hdmNvbi5rZW5kby50YWJsZS5kaXN0aW5jdERhdGEoc2V0dGluZ3MuZGF0YSwgZmllbGROYW1lKTtcclxuXHJcbiAgICAgICAgICAgIGVsZW1lbnQua2VuZG9Ecm9wRG93bkxpc3Qoe1xyXG4gICAgICAgICAgICAgICAgZGF0YVNvdXJjZToge1xyXG4gICAgICAgICAgICAgICAgICAgIGRhdGE6IGRhdGFcclxuICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICBncm91cDogeyBmaWVsZDogZmllbGROYW1lIH0sXHJcbiAgICAgICAgICAgICAgICBzZXJ2ZXJGaWx0ZXJpbmc6IHRydWUsXHJcbiAgICAgICAgICAgICAgICBkYXRhVGV4dEZpZWxkOiBmaWVsZE5hbWUsXHJcbiAgICAgICAgICAgICAgICBkYXRhVmFsdWVGaWVsZDogZmllbGROYW1lLFxyXG4gICAgICAgICAgICAgICAgb3B0aW9uTGFiZWw6IFwiLS1TZWxlY3QgVmFsdWUtLVwiXHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH0sXHJcbiAgICAgICAgZWRpdERyb3BEb3duOiBmdW5jdGlvbiAoY29udGFpbmVyLCBvcHRpb25zLCBzZXJ2aWNlTWV0aG9kKSB7XHJcbiAgICAgICAgICAgIC8vdmFyIGRhdGFzZXJ2aWNlID0gYW5ndWxhci5lbGVtZW50KGRvY3VtZW50KS5pbmplY3RvcigpLmludm9rZShmdW5jdGlvbiAoZGF0YXNlcnZpY2UpIHsgcmV0dXJuIGRhdGFzZXJ2aWNlOyB9KTtcclxuXHJcbiAgICAgICAgICAgIHZhciBmaWVsZElkID0gdGhpcy5vcHRpb24uaWQ7XHJcbiAgICAgICAgICAgIHZhciBmaWVsZFRleHQgPSB0aGlzLm9wdGlvbi50ZXh0O1xyXG4gICAgICAgICAgICB2YXIgZGF0YVNvdXJjZSA9IHRoaXMuZGF0YXNldDtcclxuXHJcbiAgICAgICAgICAgIGlmIChzZXJ2aWNlTWV0aG9kICE9PSB1bmRlZmluZWQgJiYgc2VydmljZU1ldGhvZCAhPT0gbnVsbCAmJiBzZXJ2aWNlTWV0aG9kICE9PSBcIlwiKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gZGF0YXNlcnZpY2UuZ2V0U2VydmVyRGF0YShzZXJ2aWNlTWV0aG9kLCAnJykudGhlbihmdW5jdGlvbiAocmV0dXJuRGF0YSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChyZXR1cm5EYXRhID09PSB1bmRlZmluZWQgfHwgcmV0dXJuRGF0YSA9PT0gbnVsbCB8fCByZXR1cm5EYXRhLmxlbmd0aCA9PT0gMCkgcmV0dXJuO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICB2YXIgZGF0YSA9IG5hdmNvbi5rZW5kby50YWJsZS5kaXN0aW5jdERhdGEocmV0dXJuRGF0YSwgZmllbGRJZCk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICQoJzxpbnB1dCByZXF1aXJlZCBuYW1lPVwiJyArIG9wdGlvbnMuZmllbGQgKyAnXCIvPicpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC5hcHBlbmRUbyhjb250YWluZXIpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC5rZW5kb0Ryb3BEb3duTGlzdCh7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkYXRhVmFsdWVGaWVsZDogZmllbGRJZCxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRhdGFUZXh0RmllbGQ6IGZpZWxkVGV4dCxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRhdGFTb3VyY2U6IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiBcIm9kYXRhXCIsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGF0YTogZGF0YSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvKnRyYW5zcG9ydDoge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWFkOiBcImh0dHBzOi8vZGVtb3MudGVsZXJpay5jb20va2VuZG8tdWkvc2VydmljZS9Ob3J0aHdpbmQuc3ZjL0NhdGVnb3JpZXNcIlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0qL1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgdmFyIGRhdGEgPSBuYXZjb24ua2VuZG8udGFibGUuZGlzdGluY3REYXRhKGRhdGFTb3VyY2UuZGF0YSwgZmllbGRJZCk7XHJcblxyXG4gICAgICAgICAgICAgICAgJCgnPGlucHV0IHJlcXVpcmVkIG5hbWU9XCInICsgb3B0aW9ucy5maWVsZCArICdcIi8+JylcclxuICAgICAgICAgICAgICAgICAgICAuYXBwZW5kVG8oY29udGFpbmVyKVxyXG4gICAgICAgICAgICAgICAgICAgIC5rZW5kb0Ryb3BEb3duTGlzdCh7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGRhdGFWYWx1ZUZpZWxkOiBmaWVsZElkLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBkYXRhVGV4dEZpZWxkOiBmaWVsZFRleHQsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGRhdGFTb3VyY2U6IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6IFwib2RhdGFcIixcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRhdGE6IGRhdGEsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvKnRyYW5zcG9ydDoge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlYWQ6IFwiaHR0cHM6Ly9kZW1vcy50ZWxlcmlrLmNvbS9rZW5kby11aS9zZXJ2aWNlL05vcnRod2luZC5zdmMvQ2F0ZWdvcmllc1wiXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9Ki9cclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSxcclxuICAgICAgICBjb2x1bW5TZXR0aW5nOiBmdW5jdGlvbiAoc2V0dGluZ3MsIHNjb3BlKSB7XHJcbiAgICAgICAgICAgIHZhciBpdGVtcyA9IFtdO1xyXG4gICAgICAgICAgICAkLmVhY2goc2V0dGluZ3MuY29sdW1ucywgZnVuY3Rpb24gKGksIGl0ZW0pIHtcclxuICAgICAgICAgICAgICAgIGl0ZW0uZmllbGQgPSBpdGVtLmRhdGE7XHJcbiAgICAgICAgICAgICAgICBpZiAoaXRlbS52aXNpYmxlICE9PSB1bmRlZmluZWQgJiYgaXRlbS52aXNpYmxlICE9PSBcIlwiKSBpdGVtLmhpZGRlbiA9ICFpdGVtLnZpc2libGU7XHJcblxyXG4gICAgICAgICAgICAgICAgaWYgKGl0ZW0udHlwZSAhPT0gdW5kZWZpbmVkICYmIGl0ZW0udHlwZS50b0xvd2VyQ2FzZSgpID09PSBcInNlbGVjdFwiKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgLy9pdGVtLmVkaXRvciA9IG5hdmNvbi5rZW5kby50YWJsZS5lZGl0RHJvcERvd247XHJcbiAgICAgICAgICAgICAgICAgICAgaXRlbS5lZGl0b3IgPSBqUXVlcnkucHJveHkobmF2Y29uLmtlbmRvLnRhYmxlLmVkaXREcm9wRG93biwgeyBvcHRpb246IHsgaWQ6IGl0ZW0uZGF0YSwgdGV4dDogaXRlbS5kYXRhIH0sIGRhdGFzZXQ6IHNldHRpbmdzIH0pO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICBpdGVtLnRlbXBsYXRlID0gXCIjPVwiICsgaXRlbS5kYXRhICsgXCIjXCI7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGlmIChpdGVtLmZpbHRlcmFibGUgPT09IHVuZGVmaW5lZCB8fCBpdGVtLmZpbHRlcmFibGUpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaXRlbS5maWx0ZXJhYmxlID0ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY2VsbDoge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRlbXBsYXRlOiBmdW5jdGlvbiAoYXJncykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhcmdzLmVsZW1lbnQua2VuZG9Ecm9wRG93bkxpc3Qoe1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGF0YVNvdXJjZTogbmF2Y29uLmtlbmRvLnRhYmxlLmRpc3RpbmN0RGF0YShhcmdzLmRhdGFTb3VyY2Uub3B0aW9ucy5kYXRhLCBpdGVtLmRhdGEpLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGF0YVRleHRGaWVsZDogaXRlbS5kYXRhLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGF0YVZhbHVlRmllbGQ6IGl0ZW0uZGF0YSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlUHJpbWl0aXZlOiB0cnVlLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb3B0aW9uTGFiZWw6IFwiLS1TZWxlY3QgXCIgKyBpdGVtLnRpdGxlICsgXCItLVwiXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2hvd09wZXJhdG9yczogZmFsc2UsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb3BlcmF0b3I6IFwiY29udGFpbnNcIlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVpOiBmdW5jdGlvbiAoZWxlbWVudCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vbmF2Y29uLmtlbmRvLnRhYmxlLmZpbHRlckRyb3BEb3duKGVsZW1lbnQsIGl0ZW0uZGF0YSwgc2V0dGluZ3MpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGpRdWVyeS5wcm94eShuYXZjb24ua2VuZG8udGFibGUuZmlsdGVyRHJvcERvd24sIHsgb3B0aW9uOiB7IGlkOiBpdGVtLmRhdGEsIHRleHQ6IGl0ZW0uZGF0YSB9LCBkYXRhc2V0OiBzZXR0aW5ncyB9KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGl0ZW0udHlwZSAhPT0gdW5kZWZpbmVkICYmIGl0ZW0udHlwZS50b0xvd2VyQ2FzZSgpID09PSBcImRhdGVcIikge1xyXG4gICAgICAgICAgICAgICAgICAgIGl0ZW0udGVtcGxhdGUgPSBcIiM9IGtlbmRvLnRvU3RyaW5nKGtlbmRvLnBhcnNlRGF0ZShcIiArIGl0ZW0uZGF0YSArIFwiKSwgJ1wiICsgbmF2Y29uLmRlZmF1bHRGb3JtYXQoKS5rZGF0ZSArIFwiJykjXCI7XHJcbiAgICAgICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGl0ZW0uZmlsdGVyYWJsZSA9PT0gdW5kZWZpbmVkIHx8IGl0ZW0uZmlsdGVyYWJsZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpdGVtLmZpbHRlcmFibGUgPSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjZWxsOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2hvd09wZXJhdG9yczogZmFsc2UsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb3BlcmF0b3I6IFwiY29udGFpbnNcIlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVpOiBcImRhdGV0aW1lcGlja2VyXCIgLy8gdXNlIEtlbmRvIFVJIERhdGVUaW1lUGlja2VyXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvL2VsZW1lbnQua2VuZG9EYXRlVGltZVBpY2tlcigpOyAvLyBpbml0aWFsaXplIGEgS2VuZG8gVUkgRGF0ZVRpbWVQaWNrZXJcclxuICAgICAgICAgICAgICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGl0ZW0udHlwZSAhPT0gdW5kZWZpbmVkICYmIGl0ZW0udHlwZS50b0xvd2VyQ2FzZSgpID09PSBcImF1dG9zZWxlY3RcIikge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChpdGVtLmZpbHRlcmFibGUgPT09IHVuZGVmaW5lZCB8fCBpdGVtLmZpbHRlcmFibGUpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaXRlbS5maWx0ZXJhYmxlID0ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY2VsbDoge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlucHV0V2lkdGg6IFwiMTAwJVwiLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNob3dPcGVyYXRvcnM6IHRydWUsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb3BlcmF0b3I6IFwiY29udGFpbnNcIixcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdWdnZXN0aW9uT3BlcmF0b3I6IFwiY29udGFpbnNcIlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGl0ZW0udHlwZSAhPT0gdW5kZWZpbmVkICYmIGl0ZW0udHlwZSAhPT0gXCJcIikgaXRlbS50eXBlID0gXCJzdHJpbmdcIjtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoaXRlbS5maWx0ZXJhYmxlID09PSB1bmRlZmluZWQgfHwgaXRlbS5maWx0ZXJhYmxlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGl0ZW0uZmlsdGVyYWJsZSA9IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNlbGw6IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvcGVyYXRvcjogXCJjb250YWluc1wiLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN1Z2dlc3Rpb25PcGVyYXRvcjogXCJjb250YWluc1wiXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICAgICAvKml0ZW0uZWRpdG9yPSBmdW5jdGlvbiAoY29udGFpbmVyLCBvcHRpb25zKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBpbnB1dCA9ICQoXCI8aW5wdXQvPlwiKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaW5wdXQuYXR0cihcIm5hbWVcIiwgb3B0aW9ucy5maWVsZCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlucHV0LmF0dHIoXCJwbGFjZWhvbGRlclwiLCBcIihvcHRpb25hbClcIik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlucHV0LmFwcGVuZFRvKGNvbnRhaW5lcik7XHJcbiAgICAgICAgICAgICAgICAgICAgfSovXHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgaWYgKHNldHRpbmdzLm9wdGlvbnMgIT09IHVuZGVmaW5lZCAmJiBzZXR0aW5ncy5vcHRpb25zLmVkaXRhYmxlICE9PSB1bmRlZmluZWQgJiYgc2V0dGluZ3Mub3B0aW9ucy5lZGl0YWJsZS5lbmFibGVkICE9PSB1bmRlZmluZWRcclxuICAgICAgICAgICAgICAgICAgICAmJiAhc2V0dGluZ3Mub3B0aW9ucy5lZGl0YWJsZS5lbmFibGVkICYmIGl0ZW0uY29tbWFuZCAhPT0gdW5kZWZpbmVkICYmIGl0ZW0uY29tbWFuZC5sZW5ndGggIT09IDApIHJldHVybiBmYWxzZTtcclxuXHJcbiAgICAgICAgICAgICAgICBpdGVtcy5wdXNoKGl0ZW0pO1xyXG4gICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgIHJldHVybiBpdGVtcztcclxuICAgICAgICB9LFxyXG4gICAgICAgIHJvd1NldHRpbmc6IGZ1bmN0aW9uIChzZXR0aW5ncywgc2NvcGUpIHtcclxuICAgICAgICAgICAgdmFyIGl0ZW1zID0gW107XHJcbiAgICAgICAgICAgIGl0ZW1zID0gc2V0dGluZ3MuZGF0YTtcclxuXHJcbiAgICAgICAgICAgIHZhciBmaWVsZHNDb25maWcgPSBzY29wZS5maWVsZHNbMF07XHJcbiAgICAgICAgICAgIHZhciBmaWVsZCA9IHsgXCJwcmltYXJ5S2V5XCI6IFwiSWRcIiB9O1xuICAgICAgICAgICAgdmFyIGZpZWxkQ29uZmlnSW5kZXggPSBuYXZjb24uZ2V0SXRlbUluZGV4QnlQcm9wZXJ0eShzY29wZS5maWVsZHMsIFwiZmllbGRDb25maWdcIik7XG4gICAgICAgICAgICBpZiAoZmllbGRDb25maWdJbmRleCAhPT0gdW5kZWZpbmVkICYmIGZpZWxkQ29uZmlnSW5kZXggIT09IC0xKSBmaWVsZCA9IHNjb3BlLmZpZWxkc1tmaWVsZENvbmZpZ0luZGV4XTtcclxuXHJcbiAgICAgICAgICAgIHZhciBkYXRhU291cmNlID0gbmV3IGtlbmRvLmRhdGEuRGF0YVNvdXJjZSh7XHJcbiAgICAgICAgICAgICAgICB0eXBlOiBcIm9kYXRhXCIsXHJcbiAgICAgICAgICAgICAgICBkYXRhOiBpdGVtcyxcclxuICAgICAgICAgICAgICAgIHBhZ2VTaXplOiBzZXR0aW5ncy5wYWdlTGVuZ3RoICE9PSB1bmRlZmluZWQgPyBzZXR0aW5ncy5wYWdlTGVuZ3RoIDogMjAsXHJcbiAgICAgICAgICAgICAgICBiYXRjaDogdHJ1ZSxcclxuICAgICAgICAgICAgICAgIHNjaGVtYToge1xyXG4gICAgICAgICAgICAgICAgICAgIG1vZGVsOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlkOiAoc2V0dGluZ3Mub3B0aW9ucyAhPT0gdW5kZWZpbmVkICYmIHNldHRpbmdzLm9wdGlvbnMucHJpbWFyeUtleSAhPT0gdW5kZWZpbmVkID8gc2V0dGluZ3Mub3B0aW9ucy5wcmltYXJ5S2V5IDogZmllbGQucHJpbWFyeUtleSksXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGZpZWxkczogbmF2Y29uLmtlbmRvLnRhYmxlLnZhbGlkYXRpb25TY2hlbWEoc2V0dGluZ3MsIHNjb3BlKSxcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgcmV0dXJuIGRhdGFTb3VyY2U7XHJcbiAgICAgICAgfSxcclxuICAgICAgICBzZXR0aW5nOiBmdW5jdGlvbiAoZWwsIG9wdGlvbnMsIHNjb3BlKSB7XHJcbiAgICAgICAgICAgIHZhciBzZXR0aW5ncyA9IHt9O1xyXG4gICAgICAgICAgICBpZiAob3B0aW9ucyAhPSB1bmRlZmluZWQgJiYgb3B0aW9ucy5vcHRpb25zICE9PSB1bmRlZmluZWQpIHNldHRpbmdzID0gb3B0aW9ucy5vcHRpb25zO1xyXG5cclxuICAgICAgICAgICAgdmFyIG9UYWJsZSA9IG51bGw7XHJcbiAgICAgICAgICAgIHZhciB0YWJsZSA9ICQoJChlbCkuZmluZCgnLmtlbmRvR3JpZCcpWzBdKTtcclxuICAgICAgICAgICAgaWYgKHRhYmxlICE9PSB1bmRlZmluZWQgJiYgdGFibGUgIT09IG51bGwpIHtcclxuICAgICAgICAgICAgICAgIC8vdmFyIHNjb3BlID0gJCh0YWJsZSkuc2NvcGUoKTtcclxuXHJcbiAgICAgICAgICAgICAgICB2YXIgb1RhYmxlID0gdGFibGUua2VuZG9HcmlkKHtcclxuICAgICAgICAgICAgICAgICAgICB0eXBlOiAkKGVsKS5hdHRyKFwidHlwZVwiKSxcclxuICAgICAgICAgICAgICAgICAgICBzY3JvbGxhYmxlOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGVuZGxlc3M6IHRydWUsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZpcnR1YWw6IHRydWVcclxuICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICBoZWlnaHQ6IDYwMCxcbiAgICAgICAgICAgICAgICAgICAgbm9SZWNvcmRzOiB0cnVlLFxyXG4gICAgICAgICAgICAgICAgICAgIGF1dG9CaW5kOiB0cnVlLFxyXG4gICAgICAgICAgICAgICAgICAgIGF1dG9GaXRDb2x1bW46IHRydWUsXHJcbiAgICAgICAgICAgICAgICAgICAgY29sdW1uczogbmF2Y29uLmtlbmRvLnRhYmxlLmNvbHVtblNldHRpbmcob3B0aW9ucywgc2NvcGUpLFxyXG4gICAgICAgICAgICAgICAgICAgIGRhdGFTb3VyY2U6IG5ldyBuYXZjb24ua2VuZG8udGFibGUucm93U2V0dGluZyhvcHRpb25zLCBzY29wZSksXG4gICAgICAgICAgICAgICAgICAgIHJlb3JkZXJhYmxlOiB0cnVlLFxuICAgICAgICAgICAgICAgICAgICByZXNpemFibGU6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgIHNvcnRhYmxlOiBzZXR0aW5ncy5zb3J0YWJsZSAhPT0gdW5kZWZpbmVkID8gc2V0dGluZ3Muc29ydGFibGUgOiB0cnVlLFxyXG4gICAgICAgICAgICAgICAgICAgIHNlbGVjdGFibGU6IHNldHRpbmdzLnNlbGVjdGFibGUgIT09IHVuZGVmaW5lZCA/IHNldHRpbmdzLnNlbGVjdGFibGUgOiBmYWxzZSxcbiAgICAgICAgICAgICAgICAgICAgLy9zZWxlY3RhYmxlOiBcIm11bHRpcGxlLCByb3dcIlxuICAgICAgICAgICAgICAgICAgICBwYWdlYWJsZTogc2V0dGluZ3MucGFnZWFibGUgIT09IHVuZGVmaW5lZCAmJiBzZXR0aW5ncy5wYWdlYWJsZS5lbmFibGVkICE9PSB1bmRlZmluZWQgJiYgc2V0dGluZ3MucGFnZWFibGUuZW5hYmxlZCA/IHNldHRpbmdzLnBhZ2VhYmxlLmVuYWJsZWQgOiBmYWxzZSxcbiAgICAgICAgICAgICAgICAgICAgZmlsdGVyYWJsZTogc2V0dGluZ3MuZmlsdGVyYWJsZSAhPT0gdW5kZWZpbmVkICYmIHNldHRpbmdzLmZpbHRlcmFibGUuZW5hYmxlZCAhPT0gdW5kZWZpbmVkICYmIHNldHRpbmdzLmZpbHRlcmFibGUuZW5hYmxlZCA/IHNldHRpbmdzLmZpbHRlcmFibGUuZW5hYmxlZCA6IGZhbHNlLFxyXG4gICAgICAgICAgICAgICAgICAgIGVkaXRhYmxlOiBzZXR0aW5ncy5lZGl0YWJsZSAhPT0gdW5kZWZpbmVkICYmIHNldHRpbmdzLmVkaXRhYmxlLmVuYWJsZWQgIT09IHVuZGVmaW5lZCAmJiBzZXR0aW5ncy5lZGl0YWJsZS5lbmFibGVkID8gc2V0dGluZ3MuZWRpdGFibGUuZW5hYmxlZCA6IGZhbHNlLFxyXG4gICAgICAgICAgICAgICAgICAgIGdyb3VwYWJsZTogc2V0dGluZ3MuZ3JvdXBhYmxlICE9PSB1bmRlZmluZWQgJiYgc2V0dGluZ3MuZ3JvdXBhYmxlLmVuYWJsZWQgIT09IHVuZGVmaW5lZCAmJiBzZXR0aW5ncy5ncm91cGFibGUuZW5hYmxlZCA/IHNldHRpbmdzLmdyb3VwYWJsZS5lbmFibGVkIDogZmFsc2UsXHJcbiAgICAgICAgICAgICAgICAgICAgY29sdW1uTWVudTogc2V0dGluZ3MuY29sdW1uTWVudSAhPT0gdW5kZWZpbmVkICYmIHNldHRpbmdzLmNvbHVtbk1lbnUuZW5hYmxlZCAhPT0gdW5kZWZpbmVkICYmIHNldHRpbmdzLmNvbHVtbk1lbnUuZW5hYmxlZCA/IHNldHRpbmdzLmNvbHVtbk1lbnUuZW5hYmxlZCA6IGZhbHNlLFxyXG4gICAgICAgICAgICAgICAgICAgIGRhdGFCb3VuZDogbmF2Y29uLmtlbmRvLnRhYmxlLmRhdGFCb3VuZCxcclxuICAgICAgICAgICAgICAgICAgICBkYXRhQmluZGluZzogbmF2Y29uLmtlbmRvLnRhYmxlLmRhdGFCaW5kaW5nLFxyXG4gICAgICAgICAgICAgICAgICAgIHNvcnQ6IG5hdmNvbi5rZW5kby50YWJsZS5zb3J0aW5nXHJcbiAgICAgICAgICAgICAgICB9KS5kYXRhKFwia2VuZG9HcmlkXCIpO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICB2YXIgZGF0YXNlcnZpY2UgPSBhbmd1bGFyLmVsZW1lbnQoZG9jdW1lbnQpLmluamVjdG9yKCkuaW52b2tlKGZ1bmN0aW9uIChkYXRhc2VydmljZSkgeyByZXR1cm4gZGF0YXNlcnZpY2U7IH0pO1xyXG4gICAgICAgICAgICB2YXIgbG9nZ2VyID0gYW5ndWxhci5lbGVtZW50KGRvY3VtZW50KS5pbmplY3RvcigpLmludm9rZShmdW5jdGlvbiAobG9nZ2VyKSB7IHJldHVybiBsb2dnZXI7IH0pO1xyXG4gICAgICAgICAgICAvL3ZhciAkdGltZW91dCA9IGFuZ3VsYXIuZWxlbWVudChkb2N1bWVudCkuaW5qZWN0b3IoKS5pbnZva2UoZnVuY3Rpb24gKCR0aW1lb3V0KSB7IHJldHVybiAkdGltZW91dDsgfSk7XHJcbiAgICAgICAgICAgIC8vJHRpbWVvdXQoZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAvL3NldFRpbWVvdXQoZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICB2YXIgdG9vbGJhck9wdGlvbnMgPSBbXTtcclxuXHJcbiAgICAgICAgICAgIGlmIChvVGFibGUgIT09IHVuZGVmaW5lZCAmJiBvVGFibGUgIT09IG51bGwpIHtcclxuICAgICAgICAgICAgICAgIC8vU2VsZWN0YWJsZSBTZXR0aW5nc1xyXG4gICAgICAgICAgICAgICAgaWYgKHNldHRpbmdzLnNlbGVjdGFibGUgIT09IHVuZGVmaW5lZCAmJiBzZXR0aW5ncy5zZWxlY3RhYmxlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgb1RhYmxlLnNldE9wdGlvbnMoe1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjaGFuZ2U6IG5hdmNvbi5rZW5kby50YWJsZS5jaGFuZ2UsXHJcbiAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgLy9GaWx0ZXIgU2V0dGluZ3NcclxuICAgICAgICAgICAgICAgIGlmIChzZXR0aW5ncy5maWx0ZXJhYmxlICE9PSB1bmRlZmluZWQgJiYgc2V0dGluZ3MuZmlsdGVyYWJsZS5lbmFibGVkICE9PSB1bmRlZmluZWQgJiYgc2V0dGluZ3MuZmlsdGVyYWJsZS5lbmFibGVkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgb1RhYmxlLnNldE9wdGlvbnMoe1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBmaWx0ZXJhYmxlOiB7Ly9DRUxMIEZJTFRFUklORyBPUFRJT05TXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtb2RlOiBcInJvd1wiLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZXh0cmE6IGZhbHNlLCAvL3RoZSBmaWx0ZXIgbWVudSBhbGxvd3MgdGhlIHVzZXIgdG8gaW5wdXQgYSBzZWNvbmQgY3JpdGVyaW9uLlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgb3BlcmF0b3JzOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RyaW5nOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVxOiBcIkVxdWFsIHRvXCIsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5lcTogXCJOb3QgZXF1YWwgdG9cIixcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29udGFpbnM6IFwiQ29udGFpbnNcIixcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RhcnRzd2l0aDogXCJTdGFydHNcIixcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaXNlbXB0eTogXCJFbXB0eVwiXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAvKmRhdGFTb3VyY2U6IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlcnZlclBhZ2luZzogdHJ1ZSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlcnZlckZpbHRlcmluZzogdHJ1ZSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSovXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8qZmlsdGVyYWJsZTogey8vQ0VMTCBGSUxURVJJTkcgT1BUSU9OU1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbW9kZTogXCJyb3dcIixcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vbW9kZTogXCJtZW51LCByb3dcIixcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGV4dHJhOiB0cnVlLCAvL3RoZSBmaWx0ZXIgbWVudSBhbGxvd3MgdGhlIHVzZXIgdG8gaW5wdXQgYSBzZWNvbmQgY3JpdGVyaW9uLlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbWVzc2FnZXM6IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhbmQ6IFwiYW5kXCIsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb3I6IFwib3JcIixcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmaWx0ZXI6IFwiQXBwbHkgZmlsdGVyXCIsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2xlYXI6IFwiQ2xlYXIgZmlsdGVyXCIsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaW5mbzogXCJGaWx0ZXIgYnk6IFwiLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlzRmFsc2U6IFwiRmFsc2VcIixcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWFyY2g6IFwiU2VhcmNoIGNhdGVnb3J5XCIsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VsZWN0VmFsdWU6IFwiU2VsZWN0IGNhdGVnb3J5XCIsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FuY2VsOiBcIlJlamVjdFwiLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGVjdGVkSXRlbXNGb3JtYXQ6IFwiVGhlcmUgYXJlIHswfSBzZWxlY3RlZCBpdGVtc1wiLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9wZXJhdG9yOiBcIkNob29zZSBvcGVyYXRvclwiLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlOiBcIkNob29zZSB2YWx1ZVwiXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgb3BlcmF0b3JzOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RyaW5nOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVxOiBcIkVxdWFsIHRvXCIsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5lcTogXCJOb3QgZXF1YWwgdG9cIixcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaXNudWxsOiBcIk51bGxcIixcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaXNub3RudWxsOiBcIk5vdCBudWxsXCIsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlzZW1wdHk6IFwiRW1wdHlcIixcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaXNub3RlbXB0eTogXCJOb3QgZW1wdHlcIixcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RhcnRzd2l0aDogXCJTdGFydHNcIixcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29udGFpbnM6IFwiQ29udGFpbnNcIixcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZG9lc25vdGNvbnRhaW46IFwiRG9lc24ndCBjb250YWluXCIsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZHN3aXRoOiBcIkVuZHNcIlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbnVtYmVyOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVxOiBcIkVxdWFsIHRvXCIsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5lcTogXCJOb3QgZXF1YWwgdG9cIixcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbHRlOiBcIkxlc3MgdGhhbiBvciBlcXVhbCB0b1wiLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsdDogXCJMZXNzIHRoYW5cIixcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRhdGU6IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZ3Q6IFwiQWZ0ZXJcIixcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbHQ6IFwiQmVmb3JlXCJcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVudW1zOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVxOiBcIkVxdWFsIHRvXCIsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5lcTogXCJOb3QgZXF1YWwgdG9cIlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgfSovXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGZpbHRlck1lbnVJbml0OiBuYXZjb24ua2VuZG8udGFibGUuZmlsdGVyTWVudUluaXQsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGZpbHRlcjogbmF2Y29uLmtlbmRvLnRhYmxlLmZpbHRlcmluZ1xyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIC8vSGVhZGVyIG1lbnUgc2V0dGluZ3NcclxuICAgICAgICAgICAgICAgIGlmIChzZXR0aW5ncy5jb2x1bW5NZW51ICE9PSB1bmRlZmluZWQgJiYgc2V0dGluZ3MuY29sdW1uTWVudS5lbmFibGVkICE9PSB1bmRlZmluZWQgJiYgc2V0dGluZ3MuY29sdW1uTWVudS5lbmFibGVkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgb1RhYmxlLnNldE9wdGlvbnMoe1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjb2x1bW5NZW51OiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb2x1bW5zOiBzZXR0aW5ncy5jb2x1bW5NZW51LmNvbHVtbnMgIT09IHVuZGVmaW5lZCA/IHNldHRpbmdzLmNvbHVtbk1lbnUuY29sdW1ucyA6IGZhbHNlLCAvL0RJU0FCTEUgQ09MVU1OIFNFTEVDVElPTlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZmlsdGVyYWJsZTogc2V0dGluZ3MuY29sdW1uTWVudS5maWx0ZXJhYmxlICE9PSB1bmRlZmluZWQgPyBzZXR0aW5ncy5jb2x1bW5NZW51LmZpbHRlcmFibGUgOiBmYWxzZSwgLy9ESVNBQkxFIENPTFVNTiBNRU5VIEZJTFRFUklOR1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc29ydGFibGU6IHNldHRpbmdzLmNvbHVtbk1lbnUuc29ydGFibGUgIT09IHVuZGVmaW5lZCA/IHNldHRpbmdzLmNvbHVtbk1lbnUuc29ydGFibGUgOiBmYWxzZSwgLy9ESVNBQkxFIENPTFVNTiBNRU5VIFNPUlRJTkdcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8qbWVzc2FnZXM6IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb2x1bW5zOiBcIkNob29zZSBjb2x1bW5zXCIsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZmlsdGVyOiBcIkFwcGx5IGZpbHRlclwiLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNvcnRBc2NlbmRpbmc6IFwiU29ydCAoYXNjKVwiLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNvcnREZXNjZW5kaW5nOiBcIlNvcnQgKGRlc2MpXCIsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2V0dGluZ3M6IFwiQ29sdW1uIE9wdGlvbnNcIixcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkb25lOiBcIk9rXCIsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9jazogXCJQaW4gdGhpcyBjb2x1bW5cIixcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1bmxvY2s6IFwiVW5waW4gdGhpcyBjb2x1bW5cIlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSovXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAvL1BhZ2VyIHNldHRpbmdzXHJcbiAgICAgICAgICAgICAgICBpZiAoc2V0dGluZ3MucGFnZWFibGUgIT09IHVuZGVmaW5lZCAmJiBzZXR0aW5ncy5wYWdlYWJsZS5lbmFibGVkICE9PSB1bmRlZmluZWQgJiYgc2V0dGluZ3MucGFnZWFibGUuZW5hYmxlZCkge1xyXG4gICAgICAgICAgICAgICAgICAgIG9UYWJsZS5zZXRPcHRpb25zKHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcGFnZWFibGU6IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlZnJlc2g6IHRydWUsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhbHdheXNWaXNpYmxlOiBmYWxzZSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhZ2VTaXplOiBzZXR0aW5ncy5wYWdlYWJsZS5wYWdlTGVuZ3RoICE9PSB1bmRlZmluZWQgPyBzZXR0aW5ncy5wYWdlYWJsZS5wYWdlTGVuZ3RoIDogMjAsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcmV2aW91c05leHQ6IHNldHRpbmdzLnBhZ2VhYmxlLnByZXZpb3VzTmV4dCAhPT0gdW5kZWZpbmVkID8gc2V0dGluZ3MucGFnZWFibGUucHJldmlvdXNOZXh0IDogdHJ1ZSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhZ2VTaXplczogc2V0dGluZ3MucGFnZWFibGUucGFnZVNpemVzICE9PSB1bmRlZmluZWQgPyBzZXR0aW5ncy5wYWdlYWJsZS5wYWdlU2l6ZXMgOiBbNSwgMTUsIDI1LCBcImFsbFwiXSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJ1dHRvbkNvdW50OiBzZXR0aW5ncy5wYWdlYWJsZS5idXR0b25Db3VudCAhPT0gdW5kZWZpbmVkID8gc2V0dGluZ3MucGFnZWFibGUuYnV0dG9uQ291bnQgOiA1LFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbnVtZXJpYzogc2V0dGluZ3MucGFnZWFibGUucGFnZUJhZGdlICE9PSB1bmRlZmluZWQgPyBzZXR0aW5ncy5wYWdlYWJsZS5wYWdlQmFkZ2UgOiB0cnVlLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaW5wdXQ6IHNldHRpbmdzLnBhZ2VhYmxlLnBhZ2VJbnB1dCAhPT0gdW5kZWZpbmVkID8gc2V0dGluZ3MucGFnZWFibGUucGFnZUlucHV0IDogZmFsc2UsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbmZvOiBzZXR0aW5ncy5wYWdlYWJsZS5pbmZvICE9PSB1bmRlZmluZWQgPyBzZXR0aW5ncy5wYWdlYWJsZS5pbmZvIDogdHJ1ZSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1lc3NhZ2VzOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGlzcGxheTogXCJTaG93aW5nIHswfS17MX0gZnJvbSB7Mn0gZGF0YSBpdGVtc1wiLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVtcHR5OiBvcHRpb25zLmVtcHR5VGFibGUgIT09IHVuZGVmaW5lZCA/IG9wdGlvbnMuZW1wdHlUYWJsZSA6IFwiTm8gZGF0YSBhdmFpbGFibGUgaW4gdGFibGVcIixcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYWdlOiBcIkVudGVyIHBhZ2VcIixcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvZjogXCJmcm9tIHswfVwiLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGl0ZW1zUGVyUGFnZTogXCJkYXRhIGl0ZW1zIHBlciBwYWdlXCIsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZmlyc3Q6IFwiRmlyc3QgcGFnZVwiLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxhc3Q6IFwiTGFzdCBwYWdlXCIsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbmV4dDogXCJOZXh0IHBhZ2VcIixcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcmV2aW91czogXCJQcmV2aW91cyBwYWdlXCIsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVmcmVzaDogXCJSZWZyZXNoIHRoZSBncmlkXCIsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbW9yZVBhZ2VzOiBcIk1vcmUgcGFnZXNcIlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9LyosXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGRhdGFTb3VyY2U6IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhZ2VTaXplOiBzZXR0aW5ncy5wYWdlYWJsZS5wYWdlTGVuZ3RoICE9PSB1bmRlZmluZWQgPyBzZXR0aW5ncy5wYWdlYWJsZS5wYWdlTGVuZ3RoIDogMjAsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0qL1xyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICBvVGFibGUuc2V0T3B0aW9ucyh7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHNjcm9sbGFibGU6IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZGxlc3M6IHRydWUsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2aXJ0dWFsOiB0cnVlXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHBhZ2VhYmxlOiB0cnVlXHJcbiAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgLy9Hcm91cCBzZXR0aW5nc1xyXG4gICAgICAgICAgICAgICAgaWYgKHNldHRpbmdzLmdyb3VwYWJsZSAhPT0gdW5kZWZpbmVkICYmIHNldHRpbmdzLmdyb3VwYWJsZS5lbmFibGVkICE9PSB1bmRlZmluZWQgJiYgc2V0dGluZ3MuZ3JvdXBhYmxlLmVuYWJsZWQpIHtcclxuICAgICAgICAgICAgICAgICAgICBvVGFibGUuc2V0T3B0aW9ucyh7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGdyb3VwYWJsZToge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc2hvd0Zvb3RlcjogdHJ1ZSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1lc3NhZ2VzOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZW1wdHk6IFwiRHJvcCBjb2x1bW5zIGhlcmVcIlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBncm91cDogbmF2Y29uLmtlbmRvLnRhYmxlLmdyb3VwaW5nLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBncm91cEV4cGFuZDogbmF2Y29uLmtlbmRvLnRhYmxlLmdyb3VwRXhwYW5kLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBncm91cENvbGxhcHNlOiBuYXZjb24ua2VuZG8udGFibGUuZ3JvdXBDb2xsYXBzZVxyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIC8vRWRpdCBzZXR0aW5nc1xyXG4gICAgICAgICAgICAgICAgaWYgKHNldHRpbmdzLmVkaXRhYmxlICE9PSB1bmRlZmluZWQgJiYgc2V0dGluZ3MuZWRpdGFibGUuZW5hYmxlZCAhPT0gdW5kZWZpbmVkICYmIHNldHRpbmdzLmVkaXRhYmxlLmVuYWJsZWQpIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoc2V0dGluZ3MuZWRpdGFibGUuYWRkTmV3ICE9PSB1bmRlZmluZWQgJiYgc2V0dGluZ3MuZWRpdGFibGUuYWRkTmV3KVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB0b29sYmFyT3B0aW9ucy5wdXNoKHsgbmFtZTogXCJjcmVhdGVcIiwgdGV4dDogXCJBZGQgbmV3XCIgfSk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIC8vJHRpbWVvdXQoZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgICAgIG9UYWJsZS5zZXRPcHRpb25zKHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgLy90b29sYmFyOiBbeyBuYW1lOiBcImNyZWF0ZVwiLCB0ZXh0OiBcIkFkZCBuZXdcIiwgaWNvbkNsYXNzOiBcImstaWNvbiBrLWktY29weVwiIH1dLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAvL2NvbW1hbmQ6IFtcclxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gICAgeyBuYW1lOiBcImVkaXRcIiwgdGV4dDogeyBlZGl0OiBcIkVkaXRcIiwgdXBkYXRlOiBcIlVwZGF0ZVwiLCBjYW5jZWw6IFwiQ2FuY2VsXCIgfSB9LFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyAgICB7IG5hbWU6IFwiZGVzdHJveVwiLCB0ZXh0OiBcIkRlbGV0ZVwiIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgLy9dLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBlZGl0YWJsZToge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbW9kZTogc2V0dGluZ3MuZWRpdGFibGUubW9kZSAhPT0gdW5kZWZpbmVkID8gc2V0dGluZ3MuZWRpdGFibGUubW9kZSA6IFwiXCIsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjcmVhdGVBdDogc2V0dGluZ3MuZWRpdGFibGUuY3JlYXRlQXQgIT09IHVuZGVmaW5lZCA/IHNldHRpbmdzLmVkaXRhYmxlLmNyZWF0ZUF0IDogXCJib3R0b21cIiwgLy9JTlNFUlQgTkVXIERBVEEgSVRFTVMgQVQgVEhFIEJPVFRPTSB7XCJ0b3BcIixcImJvdHRvbVwifSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVwZGF0ZTogc2V0dGluZ3MuZWRpdGFibGUudXBkYXRlICE9PSB1bmRlZmluZWQgPyBzZXR0aW5ncy5lZGl0YWJsZS51cGRhdGUgOiB0cnVlLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZGVzdHJveTogc2V0dGluZ3MuZWRpdGFibGUuZGVsZXRlICE9PSB1bmRlZmluZWQgPyBzZXR0aW5ncy5lZGl0YWJsZS5kZWxldGUgOiB0cnVlLC8vRElTQUJMRSBERUxFVElOR1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uZmlybWF0aW9uOiBzZXR0aW5ncy5lZGl0YWJsZS5jb25maXJtYXRpb25JbmZvICE9PSB1bmRlZmluZWQgPyBzZXR0aW5ncy5lZGl0YWJsZS5jb25maXJtYXRpb25JbmZvIDogZmFsc2UsIC8vRElTQUJMRSBERUxFVEUgQ09ORklSTUFUSU9OXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvL3RlbXBsYXRlOiBrZW5kby50ZW1wbGF0ZSgkKFwiI1wiICsgJChlbCkuYXR0cihcInR5cGVcIikgKyBcIi1lZGl0b3JcIikuaHRtbCgpKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy90ZW1wbGF0ZToga2VuZG8udGVtcGxhdGUoJChcIiNcIiArICQoZWwpLmF0dHIoXCJ0eXBlXCIpKS5jaGlsZHJlbigpLmh0bWwoKSlcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvL3RlbXBsYXRlOiBrZW5kby50ZW1wbGF0ZSgkKFwiI3BvcHVwLWVkaXRvclwiKS5odG1sKCkpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGFkZFJvdzogZnVuY3Rpb24gKGUpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiYWRkIHJvd1wiKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgZWRpdDogZnVuY3Rpb24gKGUpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgbW9kZWwgPSBlLm1vZGVsOyAvL3JlZmVyZW5jZSB0byB0aGUgbW9kZWwgdGhhdCBpcyBhYm91dCB0aGUgYmUgZWRpdGVkXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgY29udGFpbmVyID0gZS5jb250YWluZXI7IC8vcmVmZXJlbmNlIHRvIHRoZSBlZGl0b3IgY29udGFpbmVyXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgZGF0YVNvdXJjZSA9IHRoaXMuZGF0YVNvdXJjZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vdmFyIGV2ZW50ID0gZS5ldmVudDtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoZS5jb250YWluZXIuZGF0YShcImtlbmRvV2luZG93XCIpICE9PSB1bmRlZmluZWQpIGUuY29udGFpbmVyLmRhdGEoXCJrZW5kb1dpbmRvd1wiKS50aXRsZSgkKGVsKS5hdHRyKFwidHlwZVwiKSk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHNjb3BlID0gJChlLnNlbmRlci5lbGVtZW50KS5zY29wZSgpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgcm93SWQgPSBtb2RlbC51aWQ7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgc2VsZWN0ZWRSb3dJbmRleCA9IG5hdmNvbi5zYXZlLnNlbGVjdGVkUm93SW5kZXgoZGF0YVNvdXJjZS5vcHRpb25zLmRhdGEsIHsgXCJ1aWRcIjogcm93SWQgfSwgXCJ1aWRcIik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgc2VsZWN0ZWREYXRhID0gZGF0YVNvdXJjZS5vcHRpb25zLmRhdGFbc2VsZWN0ZWRSb3dJbmRleF07XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc2NvcGUuZmllbGRzLnNlbGVjdGVkUm93ID0gYW5ndWxhci5jb3B5KHNlbGVjdGVkUm93SW5kZXgpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc2NvcGUuZmllbGRzLmdldEJ5SWQgPSBhbmd1bGFyLmNvcHkoc2VsZWN0ZWREYXRhKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAobW9kZWwuaWQgIT09IHVuZGVmaW5lZCAmJiBtb2RlbC5pZCAhPT0gbnVsbCAmJiBtb2RlbC5pZCAhPT0gXCJcIilcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzY29wZS5maWVsZHMubW9kZSA9IFwiVXBkYXRlXCI7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzY29wZS5maWVsZHMubW9kZSA9IFwiU2F2ZVwiO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRhaW5lci5maW5kKFwiLmstYnV0dG9uLmstcHJpbWFyeVwiKS50ZXh0KFwiU2F2ZVwiKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBhcHByb3ZhbENvbHVtbiA9IG5hdmNvbi5rZW5kby50YWJsZS5hcHByb3ZhbENvbHVtbihzY29wZS50YWJsZVNldHRpbmdzLmNvbHVtbnMpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRhaW5lci5maW5kKFwiW2RhdGEtY29udGFpbmVyLWZvcj0nXCIgKyBhcHByb3ZhbENvbHVtbiArIFwiJ11cIikuZmluZChcIi5rLWRyb3Bkb3duXCIpLmhpZGUoKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRhaW5lci5maW5kKFwiW2RhdGEtY29udGFpbmVyLWZvcj0nXCIgKyBhcHByb3ZhbENvbHVtbiArIFwiJ11cIikuZmluZChcIltuYW1lPSdcIiArIGFwcHJvdmFsQ29sdW1uICsgXCInXVwiKS5yZW1vdmVBdHRyKFwicmVxdWlyZWRcIik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vbmF2Y29uLm9wZW5Nb2RhbCgkKGVsKS5hdHRyKFwidHlwZVwiKSk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coXCJFZGl0IC0gXCIgKyBzY29wZS5maWVsZHMubW9kZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHNhdmVDaGFuZ2VzOiBmdW5jdGlvbiAoZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIG1vZGVsID0gZS5tb2RlbDsgLy9yZWZlcmVuY2UgdG8gdGhlIG1vZGVsIHRoYXQgaXMgYWJvdXQgdGhlIGJlIGVkaXRlZFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGNvbnRhaW5lciA9IGUuY29udGFpbmVyOyAvL3JlZmVyZW5jZSB0byB0aGUgZWRpdG9yIGNvbnRhaW5lclxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHR5cGUgPSAkKGVsKS5hdHRyKFwidHlwZVwiKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKFwic2F2ZUNoYW5nZXNcIik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHNhdmU6IGZ1bmN0aW9uIChlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIG1vZGVsID0gZS5tb2RlbDsgLy9yZWZlcmVuY2UgdG8gdGhlIG1vZGVsIHRoYXQgaXMgYWJvdXQgdGhlIGJlIGVkaXRlZFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGNvbnRhaW5lciA9IGUuY29udGFpbmVyOyAvL3JlZmVyZW5jZSB0byB0aGUgZWRpdG9yIGNvbnRhaW5lclxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHR5cGUgPSAkKGVsKS5hdHRyKFwidHlwZVwiKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgc2NvcGUgPSAkKGUuc2VuZGVyLmVsZW1lbnQpLnNjb3BlKClcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciByb3dJZCA9IG1vZGVsLnVpZDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vdmFyIHNlbGVjdGVkUm93SW5kZXggPSBuYXZjb24uc2F2ZS5zZWxlY3RlZFJvd0luZGV4KGRhdGFTb3VyY2Uub3B0aW9ucy5kYXRhLCB7IFwidWlkXCI6IHJvd0lkIH0sIFwidWlkXCIpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy92YXIgc2VsZWN0ZWREYXRhID0gZGF0YVNvdXJjZS5vcHRpb25zLmRhdGFbc2VsZWN0ZWRSb3dJbmRleF07XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy9pZiAobW9kZWwuaWQgIT09IHVuZGVmaW5lZCAmJiBtb2RlbC5pZCAhPT0gbnVsbCAmJiBtb2RlbC5pZCAhPT0gXCJcIilcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vICAgIHNjb3BlLmZpZWxkcy5tb2RlID0gXCJVcGRhdGVcIjtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vZWxzZVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gICAgc2NvcGUuZmllbGRzLm1vZGUgPSBcIlNhdmVcIjtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBuYXZjb24udXBkYXRlRmllbGRzRGF0YShzY29wZS5maWVsZHMsIG1vZGVsLCBzY29wZSwgZmFsc2UpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBmaWVsZEtleUluZGV4ID0gbmF2Y29uLmdldEl0ZW1JbmRleEJ5UHJvcGVydHkoc2NvcGUuZmllbGRzLCBzY29wZS5maWVsZHMucHJpbWFyeUtleSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGZpZWxkS2V5SW5kZXggIT09IHVuZGVmaW5lZCAmJiBmaWVsZEtleUluZGV4ICE9PSAtMSAmJiAoc2NvcGUuZmllbGRzW2ZpZWxkS2V5SW5kZXhdLmRhdGEgPT09IG51bGwgfHwgc2NvcGUuZmllbGRzW2ZpZWxkS2V5SW5kZXhdLmRhdGEgPT09IFwiXCIpKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNjb3BlLmZpZWxkc1tmaWVsZEtleUluZGV4XS5kYXRhID0gXCIwXCI7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc2NvcGUubmF2Y29uRGF0YS5zYXZlKHR5cGUsIFwiXCIsIGZ1bmN0aW9uIChkYXRhKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGRhdGEpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIG1zZyA9IFwiRW50cmllcyBhcmUgc2F2ZWQgc3VjY2Vzc2Z1bGx5Li4uXCI7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChzY29wZS5uYXZjb25EYXRhICE9PSB1bmRlZmluZWQgJiYgc2NvcGUuaXRlbXMubW9kZSAhPT0gdW5kZWZpbmVkICYmIHNjb3BlLml0ZW1zLm1vZGUgPT09IFwiVXBkYXRlXCIpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtc2cgPSBcIkVudHJpZXMgYXJlIHVwZGF0ZWQgc3VjY2Vzc2Z1bGx5Li4uXCI7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChzY29wZS5uYXZjb25EYXRhICE9PSB1bmRlZmluZWQgJiYgc2NvcGUuaXRlbXMubW9kZSAhPT0gdW5kZWZpbmVkICYmIHNjb3BlLml0ZW1zLm1vZGUgIT09IFwiRGVsZXRlXCIpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2dnZXIuc3VjY2Vzcyhtc2csIFwiXCIsIFwiXCIpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb1RhYmxlLnNhdmVSb3coKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhcIlNhdmVcIik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlbW92ZTogZnVuY3Rpb24gKGUpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgbW9kZWwgPSBlLm1vZGVsOyAvL3JlZmVyZW5jZSB0byB0aGUgbW9kZWwgdGhhdCBpcyBhYm91dCB0aGUgYmUgZWRpdGVkXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgY29udGFpbmVyID0gZS5jb250YWluZXI7IC8vcmVmZXJlbmNlIHRvIHRoZSBlZGl0b3IgY29udGFpbmVyXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgZGF0YVNvdXJjZSA9IGUuc2VuZGVyLmRhdGFTb3VyY2U7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgdHlwZSA9ICQoZWwpLmF0dHIoXCJ0eXBlXCIpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBzY29wZSA9ICQoZS5zZW5kZXIuZWxlbWVudCkuc2NvcGUoKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHJvd0lkID0gbW9kZWwudWlkO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHNlbGVjdGVkUm93SW5kZXggPSBuYXZjb24uc2F2ZS5zZWxlY3RlZFJvd0luZGV4KGRhdGFTb3VyY2Uub3B0aW9ucy5kYXRhLCB7IFwidWlkXCI6IHJvd0lkIH0sIFwidWlkXCIpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHNlbGVjdGVkRGF0YSA9IGRhdGFTb3VyY2Uub3B0aW9ucy5kYXRhW3NlbGVjdGVkUm93SW5kZXhdO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNjb3BlLmZpZWxkcy5zZWxlY3RlZFJvdyA9IGFuZ3VsYXIuY29weShzZWxlY3RlZFJvd0luZGV4KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNjb3BlLmZpZWxkcy5nZXRCeUlkID0gYW5ndWxhci5jb3B5KHNlbGVjdGVkRGF0YSk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc2NvcGUubmF2Y29uRGF0YS50YWJsZVJvd0RlbGV0ZSh0eXBlLCB0eXBlICsgJ2RlbGV0ZScsIGZ1bmN0aW9uIChkYXRhKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGRhdGEpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9nZ2VyLnN1Y2Nlc3MoXCJFbnRyaWVzIGFyZSBkZWxldGVkIHN1Y2Nlc3NmdWxseS4uLlwiLCBcIlwiLCBcIlwiKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9UYWJsZS5kYXRhU291cmNlLnJlbW92ZShtb2RlbCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9UYWJsZS5kYXRhU291cmNlLnN5bmMoKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgY2FuY2VsOiBmdW5jdGlvbiAoZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgb1RhYmxlLmNhbmNlbENoYW5nZXMoKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiQ2FuY2VsXCIpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgLy9QREYgc2V0dGluZ3NcclxuICAgICAgICAgICAgICAgIGlmIChzZXR0aW5ncy5wZGYgIT09IHVuZGVmaW5lZCAmJiBzZXR0aW5ncy5wZGYuZW5hYmxlZCAhPT0gdW5kZWZpbmVkICYmIHNldHRpbmdzLnBkZi5lbmFibGVkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdG9vbGJhck9wdGlvbnMucHVzaCh7IG5hbWU6IFwicGRmXCIsIHRleHQ6IFwiRXhwb3J0IFBERlwiLCBpY29uQ2xhc3M6IFwiay1pY29uIGstaS1wcmludFwiIH0pO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICBvVGFibGUuc2V0T3B0aW9ucyh7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vdG9vbGJhcjogW3sgbmFtZTogXCJwZGZcIiwgdGV4dDogXCJFeHBvcnQgUERGXCIsIGljb25DbGFzczogXCJrLWljb24gay1pLWNvcHlcIiB9XSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgcGRmOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhbGxQYWdlczogdHJ1ZSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGF2b2lkTGlua3M6IHRydWUsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYXBlclNpemU6IFwiQTRcIixcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1hcmdpbjogeyB0b3A6IFwiMmNtXCIsIHJpZ2h0OiBcIjFjbVwiLCBib3R0b206IFwiMWNtXCIsIGxlZnQ6IFwiMWNtXCIgfSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxhbmRzY2FwZTogdHJ1ZSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlcGVhdEhlYWRlcnM6IHRydWUsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmaWxlTmFtZTogJChlbCkuYXR0cihcInR5cGVcIikgKyBcIi5wZGZcIixcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRlbXBsYXRlOiAkKFwiI3ByaW50LXRlbXBsYXRlXCIpLmh0bWwoKSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNjYWxlOiAwLjhcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8qc3ViamVjdDogXCJQcm9kdWN0c1wiLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGl0bGU6IFwiUHJvZHVjdHNcIixcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpbGVOYW1lOiBcIlByb2R1Y3RzLnBkZlwiLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAga2V5d29yZHM6IFwibm9ydGh3aW5kIHByb2R1Y3RzXCIsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhdXRob3I6IFwiTmF2Y29uXCIsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjcmVhdG9yOiBcIk5hdmNvblwiLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYXZvaWRMaW5rczogdHJ1ZSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRhdGU6IG5hdmNvbi5nZXRDdXJyZW50RGF0ZSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhcGVyU2l6ZTogW1wiMjBtbVwiLCBcIjIwbW1cIl0sXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsYW5kc2NhcGU6IHRydWUsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtYXJnaW46IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsZWZ0OiAxMCxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByaWdodDogXCIxMHB0XCIsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdG9wOiBcIjEwbW1cIixcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBib3R0b206IFwiMWluXCJcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3JjZVByb3h5OiB0cnVlLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJveHlVUkw6IFwiL3NhdmVcIixcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHByb3h5VGFyZ2V0OiBcIl9ibGFua1wiLCovXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHBkZkV4cG9ydDogZnVuY3Rpb24gKGUpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRpdGxlID0gJChlbCkuYXR0cihcInR5cGVcIik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkYXRlID0gbmF2Y29uLmdldEN1cnJlbnREYXRlKCk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgb1RhYmxlLmhpZGVDb2x1bW4oNCk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZS5wcm9taXNlLmRvbmUoZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9UYWJsZS5zaG93Q29sdW1uKDQpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAvL1Rvb2xiYXIgIG9wdGlvbnNcclxuICAgICAgICAgICAgICAgIGlmICh0b29sYmFyT3B0aW9ucyAhPT0gdW5kZWZpbmVkICYmIHRvb2xiYXJPcHRpb25zLmxlbmd0aCAhPT0gMCkge1xyXG4gICAgICAgICAgICAgICAgICAgIC8vdG9vbGJhck9wdGlvbnMucHVzaChcIjxwPk15IHN0cmluZyB0ZW1wbGF0ZSBpbiBhIHBhcmFncmFwaC48L3A+XCIpO1xyXG4gICAgICAgICAgICAgICAgICAgIC8vdG9vbGJhck9wdGlvbnMucHVzaChrZW5kby50ZW1wbGF0ZShcIjxwPk15IGZ1bmN0aW9uIHRlbXBsYXRlLjwvcD5cIikpO1xyXG4gICAgICAgICAgICAgICAgICAgIC8vdG9vbGJhck9wdGlvbnMucHVzaCh7IHRlbXBsYXRlOiAnPGEgY2xhc3M9XCJrLWJ1dHRvblwiIGhyZWY9XCJcXFxcI1wiIG9uY2xpY2s9XCJyZXR1cm4gdG9vbGJhcl9jbGljaygpXCI+Q29tbWFuZDwvYT4nIH0pO1xyXG4gICAgICAgICAgICAgICAgICAgIC8vdG9vbGJhck9wdGlvbnMucHVzaCh7IHRlbXBsYXRlOiBrZW5kby50ZW1wbGF0ZSgkKFwiI3Rvb2xiYXItdGVtcGxhdGVcIikuaHRtbCgpKSB9KTsgLy90b29sYmFyIHRlbXBsYXRlXHJcblxyXG4gICAgICAgICAgICAgICAgICAgIG9UYWJsZS5zZXRPcHRpb25zKHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdG9vbGJhcjogdG9vbGJhck9wdGlvbnNcclxuICAgICAgICAgICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHNldHRpbmdzLmVkaXRhYmxlICE9PSB1bmRlZmluZWQgJiYgc2V0dGluZ3MuZWRpdGFibGUuY3JlYXRlQXQgIT09IHVuZGVmaW5lZCAmJiBzZXR0aW5ncy5lZGl0YWJsZS5jcmVhdGVBdC50b0xvd2VyQ2FzZSgpID09PSBcImJvdHRvbVwiKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICQoXCIuay1ncmlkLXRvb2xiYXJcIikuaW5zZXJ0QWZ0ZXIoJChcIi5rLWdyaWQtcGFnZXJcIikubGVuZ3RoICE9PSAwID8gJChcIi5rLWdyaWQtcGFnZXJcIikgOiAkKFwiLmstZ3JpZC1jb250ZW50XCIpKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICQoXCIuay1ncmlkLXBkZlwiKS5jc3MoXCJmbG9hdFwiLCBcInJpZ2h0XCIpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgLy9jZWxsIGNsaWNrIFxyXG4gICAgICAgICAgICAkKHRhYmxlKS5maW5kKCd0Ym9keScpLm9uKCdjbGljaycsICd0ZCcsIGZ1bmN0aW9uIChlbCwgdHQpIHtcclxuICAgICAgICAgICAgICAgIHZhciB0YWJsZVNldHRpbmdzID0gc2NvcGUudGFibGVTZXR0aW5ncztcclxuICAgICAgICAgICAgICAgIHZhciB0ciA9ICQodGhpcykuY2xvc2VzdChcInRyXCIpO1xyXG5cclxuICAgICAgICAgICAgICAgIHZhciB0YWJsZURhdGEgPSBvVGFibGUuZGF0YVNvdXJjZS5kYXRhKCk7XHJcbiAgICAgICAgICAgICAgICB2YXIgcm93SWQgPSB0ci5hdHRyKFwiZGF0YS11aWRcIik7XHJcbiAgICAgICAgICAgICAgICB2YXIgc2VsZWN0ZWRSb3dJbmRleCA9IG5hdmNvbi5zYXZlLnNlbGVjdGVkUm93SW5kZXgodGFibGVEYXRhLCB7IFwidWlkXCI6IHJvd0lkIH0sIFwidWlkXCIpO1xyXG5cclxuICAgICAgICAgICAgICAgIHZhciByb3dEYXRhID0gdGFibGVEYXRhW3NlbGVjdGVkUm93SW5kZXhdO1xyXG4gICAgICAgICAgICAgICAgdmFyIHJvd0luZGV4ID0gc2VsZWN0ZWRSb3dJbmRleDtcclxuICAgICAgICAgICAgICAgIHZhciByb3dPYmogPSB0cjtcclxuXHJcbiAgICAgICAgICAgICAgICB2YXIgY2VsbERhdGEgPSAkKHRoaXMpLnRleHQoKTtcclxuICAgICAgICAgICAgICAgIHZhciBjb2x1bW5JbmRleCA9IHJvd09iai5maW5kKHRoaXMpLmluZGV4KCk7XHJcbiAgICAgICAgICAgICAgICB2YXIgY2VsbE9iaiA9IHRoaXM7XHJcbiAgICAgICAgICAgICAgICB2YXIgY29sdW1uVGl0bGUgPSB0YWJsZVNldHRpbmdzLmNvbHVtbnNbY29sdW1uSW5kZXhdLnRpdGxlO1xyXG5cclxuICAgICAgICAgICAgICAgIC8vaWYgKHNjb3BlLm5hdmNvbkRhdGEucmlnaHRzICE9PSB1bmRlZmluZWQgJiYgKCghc2NvcGUubmF2Y29uRGF0YS5yaWdodHMuQWRkICYmIGNvbHVtblRpdGxlID09PSBcImFkZFwiKSB8fCAoIXNjb3BlLm5hdmNvbkRhdGEucmlnaHRzLkVkaXQgJiYgY29sdW1uVGl0bGUgPT09IFwiZWRpdFwiKVxyXG4gICAgICAgICAgICAgICAgLy8gICAgfHwgKCghc2NvcGUubmF2Y29uRGF0YS5yaWdodHMuVmlldyAmJiAhc2NvcGUubmF2Y29uRGF0YS5yaWdodHMuQXBwcm92ZSkgJiYgY29sdW1uVGl0bGUgPT09IFwidmlld1wiKSB8fCAoIXNjb3BlLm5hdmNvbkRhdGEucmlnaHRzLkRlbGV0ZSAmJiBjb2x1bW5UaXRsZSA9PT0gXCJkZWxldGVcIikpKSByZXR1cm4gZmFsc2U7XHJcblxyXG4gICAgICAgICAgICAgICAgLy9pZiAoc2NvcGUudGFibGVTZXR0aW5ncy50YWJsZUNlbGxDbGljayAhPT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgYXBwcm92ZUFuY2hvciA9ICQodGhpcykuZmluZChcImEuZ3JpZEFwcHJvdmVcIik7XHJcbiAgICAgICAgICAgICAgICBpZiAoYXBwcm92ZUFuY2hvciAhPT0gdW5kZWZpbmVkICYmIGFwcHJvdmVBbmNob3IgIT09IG51bGwgJiYgYXBwcm92ZUFuY2hvci5sZW5ndGggIT09IDApIHtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgYWN0aW9uID0gXCJBcHByb3ZlXCI7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHNjb3BlLm5hdmNvbkRhdGEudGFibGVSb3dBcHByb3ZlQ2xpY2sgPT09IHVuZGVmaW5lZCkgcmV0dXJuO1xyXG4gICAgICAgICAgICAgICAgICAgIHNjb3BlLm5hdmNvbkRhdGEudGFibGVSb3dBcHByb3ZlQ2xpY2socm93SW5kZXgsIGNvbHVtbkluZGV4LCByb3dEYXRhLCBzY29wZS50eXBlLCB0aGlzLCBvVGFibGUsIGFjdGlvbik7XHJcbiAgICAgICAgICAgICAgICAgICAgLyp9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoc2NvcGUubmF2Y29uRGF0YS50YWJsZUNlbGxDbGljayA9PT0gdW5kZWZpbmVkKSByZXR1cm47XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHNjb3BlLm5hdmNvbkRhdGEudGFibGVDZWxsQ2xpY2socm93LCBjb2x1bW4sIGRhdGEsIHNjb3BlLnR5cGUsIHRoaXMsIG9UYWJsZSwgdW5kZWZpbmVkLCBhY3Rpb24pOyovXHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAvL31cclxuICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICAvL30pO1xyXG4gICAgICAgIH0sXHJcbiAgICAgICAgZGV0YWlsVGVtcGxhdGU6IGZ1bmN0aW9uIChhcmcpIHtcclxuICAgICAgICAgICAgLy9rZW5kby50ZW1wbGF0ZSgkKFwiI2RldGFpbC10ZW1wbGF0ZVwiKS5odG1sKCkpXHJcblxyXG4gICAgICAgICAgICBjb25zb2xlLmxvZyhcIkdyaWQgZGV0YWlsIFRlbXBsYXRlXCIpO1xyXG4gICAgICAgICAgICByZXR1cm4ge307XHJcbiAgICAgICAgfSxcclxuICAgICAgICByb3dUZW1wbGF0ZTogZnVuY3Rpb24gKGFyZykge1xyXG4gICAgICAgICAgICAvL2tlbmRvLnRlbXBsYXRlKCQoXCIjdGVtcGxhdGVcIikuaHRtbCgpKVxyXG4gICAgICAgICAgICBjb25zb2xlLmxvZyhcIkdyaWQgcm93IFRlbXBsYXRlXCIpO1xyXG4gICAgICAgICAgICByZXR1cm4ge307XHJcbiAgICAgICAgfSxcclxuICAgICAgICBjaGFuZ2U6IGZ1bmN0aW9uIChhcmcsIGUpIHtcclxuICAgICAgICAgICAgdmFyIHNlbGVjdGVkID0gJC5tYXAodGhpcy5zZWxlY3QoKSwgZnVuY3Rpb24gKGl0ZW0pIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiAkKGl0ZW0pLnRleHQoKTtcclxuICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICBjb25zb2xlLmxvZyhcIlNlbGVjdGVkOiBcIiArIHNlbGVjdGVkLmxlbmd0aCArIFwiIGl0ZW0ocyksIFtcIiArIHNlbGVjdGVkLmpvaW4oXCIsIFwiKSArIFwiXVwiKTtcclxuXHJcbiAgICAgICAgICAgIHZhciBvVGFibGUgPSBudWxsO1xyXG4gICAgICAgICAgICB2YXIgdGFibGUgPSAkKCQoYXJnLnNlbmRlci5lbGVtZW50KS5wYXJlbnRzKClbMF0pLmZpbmQoJy5rZW5kb0dyaWQnKVswXTtcclxuICAgICAgICAgICAgaWYgKHRhYmxlICE9PSB1bmRlZmluZWQgJiYgdGFibGUgIT09IG51bGwpIHZhciBvVGFibGUgPSAkKHRhYmxlKS5kYXRhKFwia2VuZG9HcmlkXCIpO1xyXG5cclxuICAgICAgICAgICAgdmFyIHNjb3BlID0gJChhcmcuc2VuZGVyLnNlbGVjdCgpKS5zY29wZSgpO1xyXG4gICAgICAgICAgICBpZiAoc2NvcGUubmF2Y29uRGF0YS5yaWdodHMgIT09IHVuZGVmaW5lZCAmJiAoKCFzY29wZS5uYXZjb25EYXRhLnJpZ2h0cy5BZGQgJiYgaGVhZGVyVGl0bGUgPT09IFwiYWRkXCIpIHx8ICghc2NvcGUubmF2Y29uRGF0YS5yaWdodHMuRWRpdCAmJiBoZWFkZXJUaXRsZSA9PT0gXCJlZGl0XCIpXHJcbiAgICAgICAgICAgICAgICB8fCAoKCFzY29wZS5uYXZjb25EYXRhLnJpZ2h0cy5WaWV3ICYmICFzY29wZS5uYXZjb25EYXRhLnJpZ2h0cy5BcHByb3ZlKSAmJiBoZWFkZXJUaXRsZSA9PT0gXCJ2aWV3XCIpIHx8ICghc2NvcGUubmF2Y29uRGF0YS5yaWdodHMuRGVsZXRlICYmIGhlYWRlclRpdGxlID09PSBcImRlbGV0ZVwiKSkpIHJldHVybiBmYWxzZTtcclxuXHJcbiAgICAgICAgICAgICQoZXZlbnQudGFyZ2V0KS5hZGRDbGFzcyhcIm5hdmNvbi1zZWxlY3RlZFwiKTtcclxuICAgICAgICAgICAgdmFyIHRyID0gZXZlbnQudGFyZ2V0LmNsb3Nlc3QoXCJ0clwiKTtcclxuICAgICAgICAgICAgdmFyIGRhdGEgPSB0aGlzLmRhdGFJdGVtKGV2ZW50LnRhcmdldC5jbG9zZXN0KFwidHJcIikpO1xyXG4gICAgICAgICAgICB2YXIgcm93ID0gJCh0cikuaW5kZXgoKTtcclxuICAgICAgICAgICAgdmFyIGNvbHVtbiA9ICQoZXZlbnQudGFyZ2V0LmNsb3Nlc3QoXCJ0clwiKSkuZmluZChcIi5uYXZjb24tc2VsZWN0ZWRcIikuaW5kZXgoKTtcclxuICAgICAgICAgICAgdmFyIHJvd0lkID0gJCh0aGlzLnNlbGVjdCgpKS5kYXRhKCkudWlkO1xyXG4gICAgICAgICAgICAkKGV2ZW50LnRhcmdldCkucmVtb3ZlQ2xhc3MoXCJuYXZjb24tc2VsZWN0ZWRcIik7XHJcblxyXG4gICAgICAgICAgICAvKnZhciBwcmltYXJ5S2V5ID0gc2NvcGUudGFibGVTZXR0aW5ncy5vcHRpb25zICE9PSB1bmRlZmluZWQgJiYgc2NvcGUudGFibGVTZXR0aW5ncy5vcHRpb25zLnByaW1hcnlLZXkgIT09IHVuZGVmaW5lZFxyXG4gICAgICAgICAgICAgICAgJiYgc2NvcGUudGFibGVTZXR0aW5ncy5vcHRpb25zLnByaW1hcnlLZXkgIT09IFwiXCIgPyBzY29wZS50YWJsZVNldHRpbmdzLm9wdGlvbnMucHJpbWFyeUtleSA6IFwiaWRcIjtcclxuICAgICAgICAgICAgdmFyIHRhYmxlRGF0YSA9IGFyZy5zZW5kZXIuZGF0YVNvdXJjZS5kYXRhKCk7XHJcbiAgICAgICAgICAgIHZhciBzZWxlY3RlZFJvd0luZGV4ID0gbmF2Y29uLnNhdmUuc2VsZWN0ZWRSb3dJbmRleCh0YWJsZURhdGEsIHsgXCJ1aWRcIjogcm93SWQgfSwgXCJ1aWRcIik7XHJcbiAgICAgICAgICAgIHZhciBzZWxlY3RlZERhdGEgPSB0YWJsZURhdGFbc2VsZWN0ZWRSb3dJbmRleF07Ki9cclxuXHJcbiAgICAgICAgICAgIGlmICgkKGFyZy5zZW5kZXIpWzBdLnR5cGUgIT09IFwiY2hlY2tib3hcIiAmJiAoc2NvcGUudGFibGVTZXR0aW5ncy5jb2x1bW5Ob25jbGljayA9PT0gdW5kZWZpbmVkIHx8IHNjb3BlLnRhYmxlU2V0dGluZ3MuY29sdW1uTm9uY2xpY2sgPT09IG51bGwgfHwgIXNjb3BlLnRhYmxlU2V0dGluZ3MuY29sdW1uTm9uY2xpY2spKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgYWN0aW9uID0gXCJWaWV3XCI7XHJcblxyXG4gICAgICAgICAgICAgICAgaWYgKHNjb3BlLnRhYmxlU2V0dGluZ3MudGFibGVDZWxsQ2xpY2sgIT09IHVuZGVmaW5lZCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBhcHByb3ZlQW5jaG9yID0gJCh0aGlzKS5maW5kKFwiYS5ncmlkQXBwcm92ZVwiKTtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoYXBwcm92ZUFuY2hvciAhPT0gdW5kZWZpbmVkICYmIGFwcHJvdmVBbmNob3IgIT09IG51bGwgJiYgYXBwcm92ZUFuY2hvci5sZW5ndGggIT09IDApIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgYWN0aW9uID0gXCJBcHByb3ZlXCI7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChzY29wZS50YWJsZVNldHRpbmdzLnRhYmxlUm93QXBwcm92ZUNsaWNrID09PSB1bmRlZmluZWQpIHJldHVybjtcclxuICAgICAgICAgICAgICAgICAgICAgICAgc2NvcGUudGFibGVTZXR0aW5ncy50YWJsZVJvd0FwcHJvdmVDbGljayhyb3csIGNvbHVtbiwgZGF0YSwgc2NvcGUudHlwZSwgdGhpcywgb1RhYmxlLCBhY3Rpb24sIHJvd0lkKTtcclxuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoc2NvcGUudGFibGVTZXR0aW5ncy50YWJsZUNlbGxDbGljayA9PT0gdW5kZWZpbmVkKSByZXR1cm47XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHNjb3BlLnRhYmxlU2V0dGluZ3MudGFibGVDZWxsQ2xpY2socm93LCBjb2x1bW4sIGRhdGEsIHNjb3BlLnR5cGUsIHRoaXMsIG9UYWJsZSwgcm93SWQsIGFjdGlvbik7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgYXBwcm92ZUFuY2hvciA9ICQodGhpcykuZmluZChcImEuZ3JpZEFwcHJvdmVcIik7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGFwcHJvdmVBbmNob3IgIT09IHVuZGVmaW5lZCAmJiBhcHByb3ZlQW5jaG9yICE9PSBudWxsICYmIGFwcHJvdmVBbmNob3IubGVuZ3RoICE9PSAwKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGFjdGlvbiA9IFwiQXBwcm92ZVwiO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoc2NvcGUubmF2Y29uRGF0YS50YWJsZVJvd0FwcHJvdmVDbGljayA9PT0gdW5kZWZpbmVkKSByZXR1cm47XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHNjb3BlLm5hdmNvbkRhdGEudGFibGVSb3dBcHByb3ZlQ2xpY2socm93LCBjb2x1bW4sIGRhdGEsIHNjb3BlLnR5cGUsIHRoaXMsIG9UYWJsZSwgYWN0aW9uLCByb3dJZCk7XHJcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHNjb3BlLm5hdmNvbkRhdGEudGFibGVDZWxsQ2xpY2sgPT09IHVuZGVmaW5lZCkgcmV0dXJuO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBzY29wZS5uYXZjb25EYXRhLnRhYmxlQ2VsbENsaWNrKHJvdywgY29sdW1uLCBkYXRhLCBzY29wZS50eXBlLCB0aGlzLCBvVGFibGUsIHJvd0lkLCBhY3Rpb24pO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgLy9jb25zb2xlLmxvZyhcIkdyaWQgY2hhbmdlXCIpO1xyXG4gICAgICAgIH0sXHJcbiAgICAgICAgZGV0YWlsSW5pdDogZnVuY3Rpb24gKGFyZykge1xyXG4gICAgICAgICAgICAvL2UuZGV0YWlsQ2VsbC50ZXh0KFwiQ2l0eTogXCIgKyBlLmRhdGEuY2l0eSk7XHJcblxyXG4gICAgICAgICAgICBlLmRldGFpbFJvdy5maW5kKFwiLmdyaWRcIikua2VuZG9HcmlkKHtcclxuICAgICAgICAgICAgICAgIC8vZGF0YVNvdXJjZTogZS5kYXRhLnByb2R1Y3RzXHJcbiAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgY29uc29sZS5sb2coXCJHcmlkIGRldGFpbCBJbml0XCIpO1xyXG4gICAgICAgIH0sXHJcbiAgICAgICAgZGF0YUJpbmRpbmc6IGZ1bmN0aW9uIChhcmcpIHtcclxuICAgICAgICAgICAgY29uc29sZS5sb2coXCJHcmlkIGRhdGEgYmluZGluZ1wiKTtcclxuICAgICAgICB9LCAgICAgICAgXHJcbiAgICAgICAgZGF0YUJvdW5kOiBmdW5jdGlvbiAoZSkge1xyXG4gICAgICAgICAgICB2YXIgc2NvcGUgPSAkKGUuc2VuZGVyLmVsZW1lbnQpLnNjb3BlKCk7XHJcbiAgICAgICAgICAgIHZhciB0YWJsZVNldHRpbmdzID0gc2NvcGUudGFibGVTZXR0aW5ncztcclxuICAgICAgICAgICAgdmFyIGNvbHVtbnMgPSBlLnNlbmRlci5jb2x1bW5zO1xyXG4gICAgICAgICAgICB2YXIgYXBwcm92YWxDb2x1bW4gPSBuYXZjb24ua2VuZG8udGFibGUuYXBwcm92YWxDb2x1bW4oY29sdW1ucyk7XHJcbiAgICAgICAgICAgIHZhciB0eXBlID0gc2NvcGUudHlwZTtcclxuXHJcbiAgICAgICAgICAgIC8qUmlnaHRzIGJhc2VkIGVkaXQgYW5kIGRlbGV0ZSBidXR0b24gZW5hYmxlZCovXHJcbiAgICAgICAgICAgICQoZS5zZW5kZXIuZWxlbWVudCkuZmluZChcIi5rLWJ1dHRvbi5rLWdyaWQtZWRpdFwiKS5zaG93KCk7XHJcbiAgICAgICAgICAgICQoZS5zZW5kZXIuZWxlbWVudCkuZmluZChcIi5rLWJ1dHRvbi5rLWdyaWQtZGVsZXRlXCIpLnNob3coKTtcclxuICAgICAgICAgICAgaWYgKHNjb3BlLm5hdmNvbkRhdGEgIT09IHVuZGVmaW5lZCAmJiBzY29wZS5uYXZjb25EYXRhLnJpZ2h0cyAhPT0gdW5kZWZpbmVkICYmIHNjb3BlLm5hdmNvbkRhdGEucmlnaHRzICE9PSBudWxsKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoc2NvcGUubmF2Y29uRGF0YS5yaWdodHMuRWRpdCAhPT0gdW5kZWZpbmVkICYmIHNjb3BlLm5hdmNvbkRhdGEucmlnaHRzLkVkaXQgIT09IG51bGwgJiYgc2NvcGUubmF2Y29uRGF0YS5yaWdodHMuRWRpdCAhPT0gbnVsbCAmJiAhc2NvcGUubmF2Y29uRGF0YS5yaWdodHMuRWRpdClcclxuICAgICAgICAgICAgICAgICAgICAkKGFyZy5zZW5kZXIuZWxlbWVudCkuZmluZChcIi5rLWJ1dHRvbi5rLWdyaWQtZWRpdFwiKS5oaWRlKCk7XHJcblxyXG4gICAgICAgICAgICAgICAgaWYgKHNjb3BlLm5hdmNvbkRhdGEucmlnaHRzLkRlbGV0ZSAhPT0gdW5kZWZpbmVkICYmIHNjb3BlLm5hdmNvbkRhdGEucmlnaHRzLkRlbGV0ZSAhPT0gbnVsbCAmJiBzY29wZS5uYXZjb25EYXRhLnJpZ2h0cy5EZWxldGUgIT09IG51bGwgJiYgIXNjb3BlLm5hdmNvbkRhdGEucmlnaHRzLkRlbGV0ZSlcclxuICAgICAgICAgICAgICAgICAgICAkKGFyZy5zZW5kZXIuZWxlbWVudCkuZmluZChcIi5rLWJ1dHRvbi5rLWdyaWQtZGVsZXRlXCIpLmhpZGUoKTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgLypHcmlkIHJvdyovXHJcbiAgICAgICAgICAgIHZhciBjb2x1bW5JbmRleCA9IHRoaXMud3JhcHBlci5maW5kKFwiLmstZ3JpZC1oZWFkZXIgW2RhdGEtZmllbGQ9XCIgKyBhcHByb3ZhbENvbHVtbiArIFwiXVwiKS5pbmRleCgpO1xyXG4gICAgICAgICAgICB2YXIgZGF0YUl0ZW1zID0gZS5zZW5kZXIuZGF0YVNvdXJjZS52aWV3KCk7XHJcbiAgICAgICAgICAgIGZvciAodmFyIGogPSAwOyBqIDwgZGF0YUl0ZW1zLmxlbmd0aDsgaisrKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgZGF0YSA9IGRhdGFJdGVtc1tqXTtcclxuXHJcbiAgICAgICAgICAgICAgICB2YXIgcm93ID0gZS5zZW5kZXIudGJvZHkuZmluZChcIltkYXRhLXVpZD0nXCIgKyBkYXRhSXRlbXNbal0udWlkICsgXCInXVwiKTtcclxuICAgICAgICAgICAgICAgIHZhciBjZWxsT2JqID0gcm93LmNoaWxkcmVuKCkuZXEoY29sdW1uSW5kZXgpO1xyXG5cclxuICAgICAgICAgICAgICAgIGlmIChzY29wZS5uYXZjb25EYXRhICE9PSB1bmRlZmluZWQgJiYgc2NvcGUubmF2Y29uRGF0YS50YWJsZVJvd1VwZGF0ZSAhPT0gdW5kZWZpbmVkKVxyXG4gICAgICAgICAgICAgICAgICAgIHNjb3BlLm5hdmNvbkRhdGEudGFibGVSb3dVcGRhdGUocm93LCBkYXRhLCBqLCB0eXBlLCBjZWxsT2JqLCBzY29wZSk7XHJcblxyXG4gICAgICAgICAgICAgICAgLy9BcHByb3ZhbENvbHVtblxyXG4gICAgICAgICAgICAgICAgaWYgKGNvbHVtbkluZGV4ICE9PSB1bmRlZmluZWQgJiYgY29sdW1uSW5kZXggIT09IFwiXCIgJiYgY29sdW1uSW5kZXggIT09IC0xKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHNjb3BlLm5hdmNvbkRhdGEgIT09IHVuZGVmaW5lZCAmJiBzY29wZS5uYXZjb25EYXRhLnJpZ2h0cyAhPT0gdW5kZWZpbmVkICYmIHNjb3BlLm5hdmNvbkRhdGEucmlnaHRzLkFwcHJvdmUgIT09IHVuZGVmaW5lZCAmJiBzY29wZS5uYXZjb25EYXRhLnJpZ2h0cy5BcHByb3ZlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBpdGVtID0gdGFibGVTZXR0aW5ncy5jb2x1bW5zW2NvbHVtbkluZGV4XTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGl0ZW0uYXBwcm92YWxDb2x1bW4gIT09IHVuZGVmaW5lZCAmJiBpdGVtLmFwcHJvdmFsQ29sdW1uICE9IG51bGwgJiYgaXRlbS5hcHByb3ZhbENvbHVtbikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy9pZiAoJChyb3cpLmNoaWxkcmVuKCkubGVuZ3RoIDw9IGNvbHVtbkluZGV4KVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gICAgY29sdW1uSW5kZXggPSAoJChyb3cpLmNoaWxkcmVuKCkubGVuZ3RoIC0gMSk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGRhdGFbXCJTZW5kQXBwcm92YWxcIl0gPT09IHVuZGVmaW5lZCB8fCAoZGF0YVtcIlNlbmRBcHByb3ZhbFwiXSAhPSBudWxsICYmIGRhdGFbXCJTZW5kQXBwcm92YWxcIl0pKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGNvbHVtblRleHQgPSAkKHJvdykuY2hpbGRyZW4oKS5lcShjb2x1bW5JbmRleCkudGV4dCgpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChjb2x1bW5UZXh0ICE9PSB1bmRlZmluZWQgJiYgY29sdW1uVGV4dCAhPT0gbnVsbCAmJiAoY29sdW1uVGV4dC50b0xvd2VyQ2FzZSgpID09PSBcImFjdGl2ZVwiIHx8IGNvbHVtblRleHQudG9Mb3dlckNhc2UoKSA9PT0gXCJkcmFmdFwiIHx8IGNvbHVtblRleHQudG9Mb3dlckNhc2UoKSA9PT0gXCJwZW5kaW5nXCIgfHwgY29sdW1uVGV4dC50b0xvd2VyQ2FzZSgpID09PSBcImNvbXBsZXRlZFwiIHx8IGNvbHVtblRleHQgPT09IFwiXCIpKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkKHJvdykuY2hpbGRyZW4oKS5lcShjb2x1bW5JbmRleCkuaHRtbCgnPGEgY2xhc3M9XCJidG4gZGVmYXVsdCBncmVlbiBidG4teHMgZ3JpZEFwcHJvdmVcIj48aSBjbGFzcz1cImZhIGZhLWNoZWNrXCI+PC9pPkFwcHJvdmU8L2E+Jyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGRhdGFbXCJTZW5kQXBwcm92YWxcIl0gPT09IHVuZGVmaW5lZCAmJiAoZGF0YVtpdGVtLmRhdGFdID09PSB1bmRlZmluZWQgfHwgKGRhdGFbaXRlbS5kYXRhXSAhPSBudWxsICYmIGRhdGFbaXRlbS5kYXRhXSkpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGNvbHVtblRleHQgPSAkKHJvdykuY2hpbGRyZW4oKS5lcShjb2x1bW5JbmRleCkudGV4dCgpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChjb2x1bW5UZXh0ICE9PSB1bmRlZmluZWQgJiYgY29sdW1uVGV4dCAhPT0gbnVsbCAmJiAoY29sdW1uVGV4dC50b0xvd2VyQ2FzZSgpID09PSBcImFjdGl2ZVwiIHx8IGNvbHVtblRleHQudG9Mb3dlckNhc2UoKSA9PT0gXCJkcmFmdFwiIHx8IGNvbHVtblRleHQudG9Mb3dlckNhc2UoKSA9PT0gXCJwZW5kaW5nXCIgfHwgY29sdW1uVGV4dC50b0xvd2VyQ2FzZSgpID09PSBcImNvbXBsZXRlZFwiIHx8IGNvbHVtblRleHQgPT09IFwiXCIpKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkKHJvdykuY2hpbGRyZW4oKS5lcShjb2x1bW5JbmRleCkuaHRtbCgnPGEgY2xhc3M9XCJidG4gZGVmYXVsdCBncmVlbiBidG4teHMgZ3JpZEFwcHJvdmVcIj48aSBjbGFzcz1cImZhIGZhLWNoZWNrXCI+PC9pPkFwcHJvdmU8L2E+Jyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAvL3Jvdy5hZGRDbGFzcyhcImRpc2NvbnRpbnVlZFwiKTtcclxuICAgICAgICAgICAgICAgIC8vY2VsbE9iai5hZGRDbGFzcyhnZXRVbml0c0luU3RvY2tDbGFzcyh1bml0cykpO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAvLyQoYXJnLnNlbmRlci5lbGVtZW50KS5maW5kKFwiW2RhdGEtY29udGFpbmVyLWZvcj0nU3RhdHVzTmFtZSddXCIpLmZpbmQoXCIuay1kcm9wZG93blwiKS5oaWRlKCk7XHJcbiAgICAgICAgICAgIC8vJChhcmcuc2VuZGVyLmVsZW1lbnQpLmZpbmQoXCJbZGF0YS1jb250YWluZXItZm9yPSdTdGF0dXNOYW1lJ11cIikuZmluZChcIltuYW1lPSdTdGF0dXNOYW1lJ11cIikucmVtb3ZlQXR0cihcInJlcXVpcmVkXCIpO1xyXG5cclxuICAgICAgICAgICAgLy90aGlzLmV4cGFuZFJvdyh0aGlzLnRib2R5LmZpbmQoXCJ0ci5rLW1hc3Rlci1yb3dcIikuZmlyc3QoKSk7XHJcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiR3JpZCBkYXRhIGJvdW5kXCIpO1xyXG4gICAgICAgIH0sXHJcbiAgICAgICAgZGF0YUl0ZW1zOiBmdW5jdGlvbiAoYXJnKSB7XHJcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiR3JpZCBkYXRhSXRlbXNcIik7XHJcbiAgICAgICAgfSxcclxuICAgICAgICBfZGlzcGxheVJvdzogZnVuY3Rpb24gKHQpIHtcclxuICAgICAgICAgICAgY29uc29sZS5sb2coXCJHcmlkIF9kaXNwbGF5Um93XCIpO1xyXG4gICAgICAgIH0sXHJcbiAgICAgICAgX3Jvd3NIdG1sOiBmdW5jdGlvbiAoZSwgdCkge1xyXG4gICAgICAgICAgICBjb25zb2xlLmxvZyhcIkdyaWQgX3Jvd3NIdG1sXCIpO1xyXG4gICAgICAgIH0sXHJcbiAgICAgICAgc29ydGluZzogZnVuY3Rpb24gKGFyZykge1xyXG4gICAgICAgICAgICBjb25zb2xlLmxvZyhcIlNvcnRpbmcgb24gZmllbGQ6IFwiICsgYXJnLnNvcnQuZmllbGQgKyBcIiwgZGlyZWN0aW9uOlwiICsgKGFyZy5zb3J0LmRpciB8fCBcIm5vbmVcIikpO1xyXG4gICAgICAgIH0sXHJcbiAgICAgICAgZmlsdGVyaW5nOiBmdW5jdGlvbiAoYXJnKSB7XHJcbiAgICAgICAgICAgIC8vaWYgKGFyZy5maWx0ZXIgPT0gbnVsbCkge1xyXG4gICAgICAgICAgICAvLyAgICBjb25zb2xlLmxvZyhcImZpbHRlciBoYXMgYmVlbiBjbGVhcmVkXCIpO1xyXG4gICAgICAgICAgICAvL30gZWxzZSB7XHJcbiAgICAgICAgICAgIC8vICAgIGNvbnNvbGUubG9nKGFyZy5maWx0ZXIubG9naWMpO1xyXG4gICAgICAgICAgICAvLyAgICBjb25zb2xlLmxvZyhhcmcuZmlsdGVyLmZpbHRlcnNbMF0uZmllbGQpO1xyXG4gICAgICAgICAgICAvLyAgICBjb25zb2xlLmxvZyhhcmcuZmlsdGVyLmZpbHRlcnNbMF0ub3BlcmF0b3IpO1xyXG4gICAgICAgICAgICAvLyAgICBjb25zb2xlLmxvZyhhcmcuZmlsdGVyLmZpbHRlcnNbMF0udmFsdWUpO1xyXG4gICAgICAgICAgICAvL31cclxuXHJcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiRmlsdGVyIG9uIFwiICsga2VuZG8uc3RyaW5naWZ5KGFyZy5maWx0ZXIpKTtcclxuICAgICAgICB9LFxyXG4gICAgICAgIGZpbHRlck1lbnVJbml0OiBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiZmlsdGVyIE1lbnUgSW5pdFwiKTtcclxuICAgICAgICAgICAgLyp2YXIgcG9wdXAgPSBlLmNvbnRhaW5lci5kYXRhKFwia2VuZG9Qb3B1cFwiKTtcclxuICAgICAgICAgICAgcG9wdXAuYmluZChcIm9wZW5cIiwgZnVuY3Rpb24oZSkge1xyXG4gICAgICAgICAgICAgICAgLy9maW5kIHRoZSBkcm9wZG93bmxpc3QgaW4gdGhpcy5lbGVtZW50IGNvbnRhaW5lclxyXG4gICAgICAgICAgICAgICAgLy91c2UgdGhlIHNldERhdGFTb3VyY2UgdG8gY2hhbmdlIGl0cyBEYXRhU291cmNlXHJcbiAgICAgICAgICAgICAgICAvL29yIGZpbHRlciBtZXRob2QgdG8gZmlsdGVyIHRoZSBjdXJyZW50IGRhdGFTb3VyY2VcclxuICAgICAgICAgICAgfSovXHJcblxyXG4gICAgICAgICAgICAvLyBJZiB0aGUgZmlsdGVyIGlzIGZvciB0aGUgXCJSb2xlXCIgY29sdW1uLi4uXHJcbiAgICAgICAgICAgIC8qaWYgKGUuZmllbGQgPT0gXCJyb2xlVGl0bGVcIikge1xyXG4gICAgICAgICAgICAgICAgZS5jb250YWluZXIuZmluZChcImRpdi5rLWZpbHRlci1oZWxwLXRleHRcIikudGV4dChcIlNlbGVjdCBhbiBpdGVtIGZyb20gdGhlIGxpc3Q6XCIpO1xyXG4gICAgICAgICAgICAgICAgZS5jb250YWluZXIuZmluZChcInNwYW4uay1kcm9wZG93bjpmaXJzdFwiKS5jc3MoXCJkaXNwbGF5XCIsIFwibm9uZVwiKTtcclxuICAgICAgICBcclxuICAgICAgICAgICAgICAgIC8vIENoYW5nZSB0aGUgdGV4dCBmaWVsZCB0byBhIGRyb3Bkb3dubGlzdCBpbiB0aGUgUm9sZSBmaWx0ZXIgbWVudS5cclxuICAgICAgICAgICAgICAgIHZhciBkcm9wRG93bkxpc3QgPSBlLmNvbnRhaW5lci5maW5kKFwiLmstdGV4dGJveDpmaXJzdFwiKVxyXG4gICAgICAgICAgICAgICAgICAgIC5yZW1vdmVDbGFzcyhcImstdGV4dGJveFwiKVxyXG4gICAgICAgICAgICAgICAgICAgIC5rZW5kb0Ryb3BEb3duTGlzdCh7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGRhdGFTb3VyY2U6IG5ldyBrZW5kby5kYXRhLkRhdGFTb3VyY2Uoe1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZGF0YTogW1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHsgdGl0bGU6IFwiU29mdHdhcmUgRW5naW5lZXJcIiB9LFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHsgdGl0bGU6IFwiUXVhbGl0eSBBc3N1cmFuY2UgRW5naW5lZXJcIiB9LFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHsgdGl0bGU6IFwiVGVhbSBMZWFkXCIgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgXVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9KSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgZGF0YVRleHRGaWVsZDogXCJ0aXRsZVwiLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBkYXRhVmFsdWVGaWVsZDogXCJ0aXRsZVwiXHJcbiAgICAgICAgICAgICAgICAgICAgfSkuZGF0YShcImtlbmRvRHJvcERvd25MaXN0XCIpO1xyXG4gICAgICAgIFxyXG4gICAgICAgICAgICAgICAgLy8gR2V0IHRoZSBGaWx0ZXJNZW51IG9iamVjdCBmb3IgdGhlIHJvbGVUaXRsZSBjb2x1bW4uXHJcbiAgICAgICAgICAgICAgICAvLyBTZXQgdGhlIEZpbHRlck1lbnUuZmlsdGVyTW9kZWwuZmlsdGVyc1swXSB0byB0aGVcclxuICAgICAgICAgICAgICAgIC8vIHRpdGxlIG9mIHRoZSBmaXJzdCBpdGVtIGluIHRoZSBkcm9wZG93bmxpc3QuXHJcbiAgICAgICAgICAgICAgICBfZ3JpZC50aGVhZC5maW5kKFwidGg6bGFzdFwiKSAgICAgLy9yb2xlVGl0bGUgaXMgdGhlIGxhc3QgY29sdW1uIFxyXG4gICAgICAgICAgICAgICAgICAgIC5kYXRhKFwia2VuZG9GaWx0ZXJNZW51XCIpICAgIC8vIEdldCB0aGUgRmlsdGVyTWVudSBmb3IgdGhlIGxhc3QgY29sdW1uIFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAuZmlsdGVyTW9kZWwuZmlsdGVyc1swXS52YWx1ZSA9IGRyb3BEb3duTGlzdC5kYXRhU291cmNlLmRhdGEoKVswXS50aXRsZTtcclxuICAgICAgICAgICAgfSovXHJcbiAgICAgICAgfSxcclxuICAgICAgICBwYWdpbmc6IGZ1bmN0aW9uIChhcmcpIHtcclxuICAgICAgICAgICAgY29uc29sZS5sb2coXCJQYWdpbmcgdG8gcGFnZSBpbmRleDpcIiArIGFyZy5wYWdlKTtcclxuICAgICAgICB9LFxyXG4gICAgICAgIGdyb3VwaW5nOiBmdW5jdGlvbiAoYXJnKSB7XHJcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiR3JvdXAgb24gXCIgKyBrZW5kby5zdHJpbmdpZnkoYXJnLmdyb3VwcykpO1xyXG4gICAgICAgIH0sXHJcbiAgICAgICAgZ3JvdXBFeHBhbmQ6IGZ1bmN0aW9uIChhcmcpIHtcclxuICAgICAgICAgICAgY29uc29sZS5sb2coXCJUaGUgZ3JvdXAgdG8gYmUgZXhwYW5kZWQ6IFwiICsga2VuZG8uc3RyaW5naWZ5KGFyZy5ncm91cCkpO1xyXG4gICAgICAgIH0sXHJcbiAgICAgICAgZ3JvdXBDb2xsYXBzZTogZnVuY3Rpb24gKGFyZykge1xyXG4gICAgICAgICAgICBjb25zb2xlLmxvZyhcIlRoZSBncm91cCB0byBiZSBjb2xsYXBzZWQ6IFwiICsga2VuZG8uc3RyaW5naWZ5KGFyZy5ncm91cCkpO1xyXG4gICAgICAgIH0sXHJcbiAgICAgICAgcmVmcmVzaDogZnVuY3Rpb24gKGVsLCBzZXR0aW5nLCBzY29wZSkge1xyXG4gICAgICAgICAgICBpZiAoc2V0dGluZy5kYXRhLmxlbmd0aCA9PT0gMCkgc2V0dGluZy5kYXRhID0gW107XHJcbiAgICAgICAgICAgIG5hdmNvbi5rZW5kby50YWJsZS5zZXR0aW5nKGVsLCBzZXR0aW5nLCBzY29wZSk7XHJcblxyXG4gICAgICAgICAgICAvL3ZhciB0YWJsZSA9ICQoJChlbCkuZmluZCgndGFibGUnKVswXSk7XHJcbiAgICAgICAgICAgIC8vdmFyIHRhYkluc3QgPSB0YWJsZS5EYXRhVGFibGUuZm5UYWJsZXMoKTtcclxuICAgICAgICAgICAgLy9pZiAoJCh0YWJJbnN0KS5wYXJlbnRzKFwibmF2Y29uLXRhYmxlW3R5cGU9J1wiICsgJChlbCkuYXR0cihcInR5cGVcIikgKyBcIiddXCIpLmxlbmd0aCA9PT0gMCB8fCB0YWJsZS5jaGlsZHJlbigpLmxlbmd0aCA9PT0gMCkge1xyXG4gICAgICAgICAgICAvLyAgICBuYXZjb24ua2VuZG8udGFibGUuc2V0dGluZyhlbCwgc2V0dGluZywgc2NvcGUpO1xyXG4gICAgICAgICAgICAvLyAgICByZXR1cm47XHJcbiAgICAgICAgICAgIC8vfVxyXG4gICAgICAgICAgICAvL3ZhciBvVGFibGUgPSB0YWJsZS5EYXRhVGFibGUoKTtcclxuICAgICAgICAgICAgLy9vVGFibGUuY2xlYXIoKTtcclxuXHJcbiAgICAgICAgICAgIC8vb1RhYmxlLnJvd3MuYWRkKHNldHRpbmcuZGF0YSkuZHJhdygpO1xyXG5cclxuICAgICAgICAgICAgLy92YXIgdGFibGUgPSAkKCQoZWwpLmZpbmQoJy5rZW5kb0dyaWQnKVswXSk7XHJcbiAgICAgICAgICAgIC8vdmFyIGdyaWQgPSB0YWJsZS5kYXRhKFwia2VuZG9HcmlkXCIpO1xyXG4gICAgICAgICAgICAvKnZhciBpdGVtcyA9IG5hdmNvbi5rZW5kby50YWJsZS5yb3dTZXR0aW5nKHNldHRpbmcuZGF0YSk7XHJcbiAgICAgICAgICAgIGdyaWQuZGF0YVNvdXJjZS5kYXRhKGl0ZW1zKTsqL1xyXG5cclxuICAgICAgICAgICAgLy90YWJsZS5maW5kKFwiLmstZ3JpZC1jb250ZW50XCIpLmNzcygnbWF4LWhlaWdodCcsICc1MDBweCcpO1xyXG4gICAgICAgICAgICAvL3RhYmxlLmZpbmQoXCIuay1maWx0ZXJjZWxsPnNwYW5bc3R5bGU9J3dpZHRoOiAxMDAlOyddXCIpLmNzcyhcImRpc3BsYXlcIiwgXCJcIik7XHJcbiAgICAgICAgICAgIC8vdGFibGUuZmluZChcIi5rLWZpbHRlcmNlbGwsIC5rLWZpbHRlcmNlbGwgLmstd2lkZ2V0LCAuay1maWx0ZXJjZWxsPnNwYW5bc3R5bGU9J3dpZHRoOiAxMDAlOyddXCIpLmNzcyhcImRpc3BsYXlcIiwgXCJcIik7XHJcbiAgICAgICAgfSxcclxuICAgICAgICBzZWxlY3RlZFJvd0luZGV4OiBmdW5jdGlvbiAodGFibGUsIHNlbGVjdGVkUm93LCBpZENvbHVtbikge1xyXG4gICAgICAgICAgICB2YXIgcmV0dXJuRGF0YSA9IC0xO1xyXG4gICAgICAgICAgICB2YXIgdGFibGVEYXRhID0gdGFibGUuZGF0YSAhPT0gdW5kZWZpbmVkID8gdGFibGUuZGF0YSA6IHRhYmxlO1xyXG5cclxuICAgICAgICAgICAgaWYgKHRhYmxlRGF0YSAhPT0gdW5kZWZpbmVkICYmIHRhYmxlRGF0YS5sZW5ndGggPiAwKVxyXG4gICAgICAgICAgICAgICAgcmV0dXJuRGF0YSA9IG5hdmNvbi5nZXRJdGVtSW5kZXhCeUtleVZhbHVlKHRhYmxlRGF0YSwgaWRDb2x1bW4sIHNlbGVjdGVkUm93W2lkQ29sdW1uXSk7XHJcblxyXG4gICAgICAgICAgICByZXR1cm4gcmV0dXJuRGF0YTtcclxuICAgICAgICB9LFxyXG4gICAgICAgIGFwcHJvdmFsQ29sdW1uOiBmdW5jdGlvbiAoY29sdW1ucykge1xyXG4gICAgICAgICAgICB2YXIgb2JqQ29sdW1uID0gJC5ncmVwKGNvbHVtbnMsIGZ1bmN0aW9uICh2KSB7IHJldHVybiB2LmFwcHJvdmFsQ29sdW1uID09PSB0cnVlOyB9KTtcclxuICAgICAgICAgICAgdmFyIHN0ckNvbHVtbiA9ICgob2JqQ29sdW1uLmxlbmd0aCAhPT0gMCAmJiBvYmpDb2x1bW5bMF0uZGF0YSAhPT0gdW5kZWZpbmVkKSA/IG9iakNvbHVtblswXS5kYXRhIDogXCJcIik7XHJcblxyXG4gICAgICAgICAgICByZXR1cm4gc3RyQ29sdW1uO1xyXG4gICAgICAgIH0sXHJcbiAgICAgICAgZGF0ZUNvbHVtbjogZnVuY3Rpb24gKHNldHRpbmdzKSB7XHJcbiAgICAgICAgICAgIHZhciBvYmpDb2x1bW4gPSAkLmdyZXAoc2V0dGluZ3MuZGF0ZUZpZWxkcywgZnVuY3Rpb24gKHYpIHsgcmV0dXJuIHYuYXBwcm92YWxDb2x1bW4gPT09IHRydWU7IH0pO1xyXG4gICAgICAgICAgICB2YXIgc3RyQ29sdW1uID0gKChvYmpDb2x1bW4ubGVuZ3RoICE9PSAwICYmIG9iakNvbHVtblswXS5kYXRhICE9PSB1bmRlZmluZWQpID8gb2JqQ29sdW1uWzBdLmRhdGEgOiBcIlwiKTtcclxuXHJcbiAgICAgICAgICAgIHJldHVybiBzdHJDb2x1bW47XHJcbiAgICAgICAgfSxcclxuICAgICAgICBjb2x1bW5Bc3NpZ246IGZ1bmN0aW9uICh0YWJsZSwgY29sdW1uRGF0YSwgc2VydmljZU5hbWUsIGNvbHVtblR5cGUpIHtcclxuICAgICAgICAgICAgdmFyIHJldHVybkRhdGEgPSBcIlwiO1xyXG4gICAgICAgICAgICBpZiAoc2VydmljZU5hbWUgIT0gdW5kZWZpbmVkICYmIHNlcnZpY2VOYW1lICE9IFwiXCIpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybkRhdGEgPSBkYXRhc2VydmljZS5nZXRTZXJ2ZXJEYXRhKHNlcnZpY2VOYW1lKS50aGVuKGZ1bmN0aW9uIChkYXRhKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGRhdGEgPT09IHVuZGVmaW5lZCB8fCBkYXRhLmxlbmd0aCA9PT0gMCkgcmV0dXJuO1xyXG4gICAgICAgICAgICAgICAgICAgIHRhYmxlQ29sdW1uQ3JlYXRlKGRhdGEsIGNvbHVtblR5cGUpO1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBkYXRhO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICB0YWJsZUNvbHVtbkNyZWF0ZShjb2x1bW5EYXRhLCBjb2x1bW5UeXBlKTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgZnVuY3Rpb24gdGFibGVDb2x1bW5DcmVhdGUoZGF0YSwgY29sdW1uVHlwZSkge1xyXG4gICAgICAgICAgICAgICAgaWYgKGRhdGEgIT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIGNvbHVtbmRldGFpbHMgPSBcIlwiLCBpID0gMDtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgZm9yIChpID0gMDsgaSA8IGRhdGEubGVuZ3RoOyBpKyspIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgLy92YXIgY29sdW1uSW5kZXggPSBuYXZjb24uZ2V0SXRlbUJ5S2V5VmFsdWUodGFibGUuY29sdW1uQ29udHJvbC5leGNlcHRDb2x1bW5zLCBcImluZGV4XCIsIGkpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgY29sdW1uSW5kZXggPSB0YWJsZS5jb2x1bW5Db250cm9sLmV4Y2VwdENvbHVtbnMuaW5kZXhPZihpKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGNvbHVtbkluZGV4ICE9PSAtMSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbHVtbmRldGFpbHMgKz0gXCJ7XFxcInRpdGxlXFxcIjogXFxcIlwiICsgZGF0YVtpXS50ZXh0LnRyaW0oKSArIFwiXFxcIiwgXFxcImRhdGFcXFwiOiBcXFwiXCIgKyBkYXRhW2ldLmlkICsgXCJcXFwiLCBcXFwid2lkdGhcXFwiOiBcXFwiMTAwcHhcXFwiIH0sXCI7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2VcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbHVtbmRldGFpbHMgKz0gXCJ7XFxcInRpdGxlXFxcIjogXFxcIlwiICsgZGF0YVtpXS50ZXh0LnRyaW0oKSArIFwiXFxcIiwgXFxcIm9wdGlvbnNcXFwiIDoge1xcXCJ0eXBlXFxcIiA6IFxcXCJcIiArIHRhYmxlLmNvbHVtbkNvbnRyb2wudHlwZSArIFwiXFxcIiwgXFxcImRhdGFUeXBlXFxcIjogXFxcIlwiICsgY29sdW1uVHlwZSArIFwiXFxcIn0sIFxcXCJkYXRhXFxcIjogXFxcIlwiICsgZGF0YVtpXS5pZCArIFwiXFxcIiwgXFxcIndpZHRoXFxcIjogXFxcIjEwMHB4XFxcIiB9LFwiO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAvL2NvbHVtbmRldGFpbHMgKz0gXCJ7XFxcInRpdGxlXFxcIjogXFxcIlwiICsgZGF0YVtpXS50ZXh0LnRyaW0oKSArIFwiXFxcIiwgXFxcImRhdGFcXFwiOiBcXFwiXCIgKyBkYXRhW2ldLmlkICsgXCJcXFwiLCBcXFwiZmllbGRcXFwiOiBcXFwiXCIgKyBkYXRhW2ldLmlkICsgXCJcXFwiLCBcXFwid2lkdGhcXFwiOiBcXFwiXCIgKyBjb2x1bW5JbmRleC53aWR0aCArIFwiXFxcIiwgXFxcImZpZWxkVHlwZVxcXCI6IFxcXCJ0ZXh0XFxcIiB9LFwiO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBpZiAoY29sdW1uZGV0YWlscyAhPT0gXCJcIikgY29sdW1uZGV0YWlscyA9IGNvbHVtbmRldGFpbHMuc3Vic3RyaW5nKDAsIGNvbHVtbmRldGFpbHMubGVuZ3RoIC0gMSk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIHRhYmxlLmNvbHVtbnMgPSAkLnBhcnNlSlNPTihcIltcIiArIGNvbHVtbmRldGFpbHMgKyBcIl1cIik7XHJcbiAgICAgICAgICAgICAgICAgICAgLy90YWJsZS5jb2x1bW5zID0gbmF2Y29uLmpzb25UcmFuc2Zvcm1lZCgkLnBhcnNlSlNPTihcIltcIiArIGNvbHVtbmRldGFpbHMgKyBcIl1cIikpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGRhdGE7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9LCAgICAgICAgXHJcbiAgICAgICAgbWFuYWdlRGF0YTogZnVuY3Rpb24gKGNvbHVtbnMsIGl0ZW1zKSB7XHJcbiAgICAgICAgICAgIGZvciAodmFyIGluZGV4IGluIGl0ZW1zKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgaXRlbSA9IGl0ZW1zW2luZGV4XTtcclxuICAgICAgICAgICAgICAgIGZvciAodmFyIHAgaW4gaXRlbSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChpdGVtLmhhc093blByb3BlcnR5KHApKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBwcm9wVmFsID0gaXRlbVtwXTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIG9wdGlvbnMgPSBnZXRDb2x1bW5PcHRpb25zKGNvbHVtbnMsIHApO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAob3B0aW9ucyAhPT0gLTEpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChvcHRpb25zLnR5cGUgIT09IHVuZGVmaW5lZCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciByZXRWYWwgPSBuYXZjb24uaW5zZXJ0Q29udHJvbChvcHRpb25zLnR5cGUsIHByb3BWYWwpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGl0ZW1bcF0gPSByZXRWYWw7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGZ1bmN0aW9uIGdldENvbHVtbk9wdGlvbnMoY29sdW1ucywgcHJvcCkge1xyXG4gICAgICAgICAgICAgICAgZm9yIChpbmRleCBpbiBjb2x1bW5zKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIGNvbCA9IGNvbHVtbnNbaW5kZXhdO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChjb2wuZGF0YSAhPT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChjb2wuZGF0YSA9PT0gcHJvcCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGNvbC5vcHRpb25zIHx8IC0xO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIC0xO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICByZXR1cm4gaXRlbXM7XHJcbiAgICAgICAgfSxcclxuICAgICAgICBwZGZFeHBvcnQ6IGZ1bmN0aW9uIChrZW5kb1RhYmxlLCBzZXR0aW5ncywgZSkge1xyXG4gICAgICAgICAgICB2YXIgcHJvZ3Jlc3MgPSAkLkRlZmVycmVkKCk7XHJcblxyXG4gICAgICAgICAgICAvKmtlbmRvLmRyYXdpbmcuZHJhd0RPTSgkKFwiI2hlYWRlclwiKSlcclxuICAgICAgICAgICAgICAuZG9uZShmdW5jdGlvbihoZWFkZXIpIHtcclxuICAgICAgICAgICAgICAgICAga2VuZG8uZHJhd2luZy5kcmF3RE9NKCQoXCIjZm9vdGVyXCIpKVxyXG4gICAgICAgICAgICAgICAgICAgIC5kb25lKGZ1bmN0aW9uKGZvb3RlcikgeyovXHJcbiAgICAgICAgICAgIGtlbmRvVGFibGUuX2RyYXdQREYocHJvZ3Jlc3MpXHJcbiAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24gKHJvb3QpIHtcclxuICAgICAgICAgICAgICAgICAgcm9vdC5jaGlsZHJlbi51bnNoaWZ0KGhlYWRlcik7XHJcbiAgICAgICAgICAgICAgICAgIHJvb3QuY2hpbGRyZW4ucHVzaChmb290ZXIpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgcmV0dXJuIGtlbmRvLmRyYXdpbmcuZXhwb3J0UERGKHJvb3QsIHtcclxuICAgICAgICAgICAgICAgICAgICAgIHBhcGVyU2l6ZTogXCJhdXRvXCIsXHJcbiAgICAgICAgICAgICAgICAgICAgICBtYXJnaW46IHsgbGVmdDogXCIxY21cIiwgdG9wOiBcIjFjbVwiLCByaWdodDogXCIxY21cIiwgYm90dG9tOiBcIjFjbVwiIH0sXHJcbiAgICAgICAgICAgICAgICAgICAgICBtdWx0aVBhZ2U6IHRydWVcclxuICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgICAuZG9uZShmdW5jdGlvbiAoZGF0YVVSSSkge1xyXG4gICAgICAgICAgICAgICAgICAvL2NvbnNvbGUubG9nKFwiT2theVwiKTtcclxuICAgICAgICAgICAgICAgICAga2VuZG8uc2F2ZUFzKHtcclxuICAgICAgICAgICAgICAgICAgICAgIGRhdGFVUkk6IGRhdGFVUkksXHJcbiAgICAgICAgICAgICAgICAgICAgICBmaWxlTmFtZTogXCJuYXZjb24ucGRmXCJcclxuICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICAgIHByb2dyZXNzLnJlc29sdmUoKTtcclxuICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAvKn0pO1xyXG4gICAgICAgIH0pKi9cclxuICAgICAgICB9LFxyXG4gICAgICAgIHZhbGlkYXRpb25TY2hlbWE6IGZ1bmN0aW9uIChzZXR0aW5ncywgc2NvcGUpIHtcclxuICAgICAgICAgICAgdmFyIG15RmllbGRzID0ge307XHJcbiAgICAgICAgICAgIHZhciBzdHJGaWVsZHMgPSBcIlwiO1xyXG5cclxuICAgICAgICAgICAgJC5lYWNoKHNldHRpbmdzLmNvbHVtbnMsIGZ1bmN0aW9uIChpLCBpdGVtKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgdHlwZSA9IGl0ZW0udHlwZTtcclxuICAgICAgICAgICAgICAgIHZhciBmaWVsZFRpdGxlID0gaXRlbS50aXRsZTtcbiAgICAgICAgICAgICAgICB2YXIgZmllbGROYW1lID0gaXRlbS5kYXRhO1xuXHJcbiAgICAgICAgICAgICAgICB2YXIgZmllbGRLZXkgPSBpdGVtLmZpZWxkS2V5O1xuICAgICAgICAgICAgICAgIHZhciBmaWVsZCA9IG51bGw7XG4gICAgICAgICAgICAgICAgdmFyIGZpZWxkS2V5SW5kZXggPSBuYXZjb24uZ2V0SXRlbUluZGV4QnlQcm9wZXJ0eShzY29wZS5maWVsZHMsIGZpZWxkS2V5KTtcbiAgICAgICAgICAgICAgICBpZiAoZmllbGRLZXlJbmRleCAhPT0gdW5kZWZpbmVkICYmIGZpZWxkS2V5SW5kZXggIT09IC0xKSBmaWVsZCA9IHNjb3BlLmZpZWxkc1tmaWVsZEtleUluZGV4XTtcclxuXHJcbiAgICAgICAgICAgICAgICBpZiAoZmllbGROYW1lICE9PSB1bmRlZmluZWQgJiYgZmllbGROYW1lICE9PSBudWxsICYmIGZpZWxkTmFtZSAhPT0gXCJcIikge1xyXG4gICAgICAgICAgICAgICAgICAgIG15RmllbGRzW2ZpZWxkTmFtZV0gPSB7IFwidmFsaWRhdGlvblwiOiB7fSB9O1xyXG5cclxuICAgICAgICAgICAgICAgICAgICBpZiAoZmllbGROYW1lICE9PSB1bmRlZmluZWQgJiYgZmllbGROYW1lICE9PSBudWxsICYmIGZpZWxkTmFtZSAhPT0gXCJcIiAmJiBmaWVsZE5hbWUubGVuZ3RoICE9PSAwKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0eXBlLnRvTG93ZXJDYXNlKCkgPT09IFwiYXV0b3NlbGVjdFwiKSB0eXBlID0gXCJzdHJpbmdcIjtcclxuICAgICAgICAgICAgICAgICAgICAgICAgbXlGaWVsZHNbZmllbGROYW1lXS52YWxpZGF0aW9uW1widHlwZVwiXSA9IHR5cGU7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoZmllbGQgIT09IHVuZGVmaW5lZCAmJiBmaWVsZCAhPT0gbnVsbCAmJiBmaWVsZC50ZW1wbGF0ZU9wdGlvbnMgIT09IHVuZGVmaW5lZCAmJiBmaWVsZC50ZW1wbGF0ZU9wdGlvbnMubGVuZ3RoICE9PSAwKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgdmFsaWRhdGlvbiA9IGZpZWxkLnRlbXBsYXRlT3B0aW9ucztcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vUmVxdWlyZWQgbWVzc2FnZVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbmF2Y29uLmtlbmRvLnJlcXVpcmVkVmFsaWRhdGlvbihteUZpZWxkc1tmaWVsZE5hbWVdLCBmaWVsZE5hbWUsIHZhbGlkYXRpb24pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLyppZiAodmFsaWRhdGlvbi5yZXF1aXJlZCAhPT0gdW5kZWZpbmVkICYmIHZhbGlkYXRpb24ucmVxdWlyZWQgIT09IG51bGwgJiYgKHZhbGlkYXRpb24ucmVxdWlyZWQgfHwgdmFsaWRhdGlvbi5yZXF1aXJlZC50b0xvd2VyQ2FzZSgpID09PSBcInllc1wiKSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh2YWxpZGF0aW9uLnJlcXVpcmVkTWVzc2FnZSAhPT0gdW5kZWZpbmVkICYmIHZhbGlkYXRpb24ucmVxdWlyZWRNZXNzYWdlICE9PSBudWxsICYmIHZhbGlkYXRpb24ucmVxdWlyZWRNZXNzYWdlICE9PSBcIlwiKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBteUZpZWxkc1tmaWVsZE5hbWVdLnZhbGlkYXRpb25bXCJyZXF1aXJlZFwiXSA9IHsgXCJtZXNzYWdlXCI6IHZhbGlkYXRpb24ucmVxdWlyZWRNZXNzYWdlIH07XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBteUZpZWxkc1tmaWVsZE5hbWVdLnZhbGlkYXRpb25bXCJyZXF1aXJlZFwiXSA9ICh2YWxpZGF0aW9uLnJlcXVpcmVkIHx8IHZhbGlkYXRpb24ucmVxdWlyZWQudG9Mb3dlckNhc2UoKSA9PT0gXCJ5ZXNcIiA/IHRydWUgOiBmYWxzZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9Ki9cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvL01pbml1bSBtZXNzYWdlXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBuYXZjb24ua2VuZG8ubWluaW11bVZhbGlkYXRpb24obXlGaWVsZHNbZmllbGROYW1lXSwgZmllbGROYW1lLCB2YWxpZGF0aW9uKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8qaWYgKHZhbGlkYXRpb24ubWlubGVuZ3RoICE9PSB1bmRlZmluZWQgJiYgdmFsaWRhdGlvbi5taW5sZW5ndGggIT09IG51bGwgJiYgdmFsaWRhdGlvbi5taW5sZW5ndGggIT09IFwiXCIpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgbWVzc2FnZU1pbiA9IHZhbGlkYXRpb24ubWlubGVuZ3RoTWVzc2FnZSAhPT0gdW5kZWZpbmVkICYmIHZhbGlkYXRpb24ubWlubGVuZ3RoTWVzc2FnZSAhPT0gXCJcIiA/IHZhbGlkYXRpb24ubWlubGVuZ3RoTWVzc2FnZSA6IFwiTWluaW11bSBcIiArIHZhbGlkYXRpb24ubWlubGVuZ3RoICsgXCIgY2hhcmFjdGVyIHJlcXVpcmVkLlwiO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG15RmllbGRzW2ZpZWxkTmFtZV0udmFsaWRhdGlvbltmaWVsZE5hbWUudG9Mb3dlckNhc2UoKSArIFwibWluXCJdID0gZnVuY3Rpb24gKGlucHV0KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChpbnB1dC5pcyhcIltuYW1lPSdcIiArIGZpZWxkTmFtZSArIFwiJ11cIikgJiYgaW5wdXQudmFsKCkubGVuZ3RoIDwgdmFsaWRhdGlvbi5taW5sZW5ndGgpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlucHV0LmF0dHIoXCJkYXRhLVwiICsgZmllbGROYW1lLnRvTG93ZXJDYXNlKCkgKyBcIm1pbi1tc2dcIiwgXCJcIiArIHZhbGlkYXRpb24ubWlubGVuZ3RoTWVzc2FnZSArIFwiXCIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSovXHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy9NYXhpbXVtIG1lc3NhZ2VcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5hdmNvbi5rZW5kby5tYXhpbXVtVmFsaWRhdGlvbihteUZpZWxkc1tmaWVsZE5hbWVdLCBmaWVsZE5hbWUsIHZhbGlkYXRpb24pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLyppZiAodmFsaWRhdGlvbi5tYXhsZW5ndGggIT09IHVuZGVmaW5lZCAmJiB2YWxpZGF0aW9uLm1heGxlbmd0aCAhPT0gbnVsbCAmJiB2YWxpZGF0aW9uLm1heGxlbmd0aCAhPT0gXCJcIikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBtZXNzYWdlTWluID0gdmFsaWRhdGlvbi5tYXhsZW5ndGhNZXNzYWdlICE9PSB1bmRlZmluZWQgJiYgdmFsaWRhdGlvbi5tYXhsZW5ndGhNZXNzYWdlICE9PSBcIlwiID8gdmFsaWRhdGlvbi5tYXhsZW5ndGhNZXNzYWdlIDogXCJNYXhpbXVtIFwiICsgdmFsaWRhdGlvbi5tYXhsZW5ndGggKyBcIiBvbmx5IGFsbG93ZWQuXCI7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbXlGaWVsZHNbZmllbGROYW1lXS52YWxpZGF0aW9uW2ZpZWxkTmFtZS50b0xvd2VyQ2FzZSgpICsgXCJtYXhcIl0gPSBmdW5jdGlvbiAoaW5wdXQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGlucHV0LmlzKFwiW25hbWU9J1wiICsgZmllbGROYW1lICsgXCInXVwiKSAmJiBpbnB1dC52YWwoKS5sZW5ndGggPiB2YWxpZGF0aW9uLm1heGxlbmd0aCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaW5wdXQuYXR0cihcImRhdGEtXCIgKyBmaWVsZE5hbWUudG9Mb3dlckNhc2UoKSArIFwibWF4LW1zZ1wiLCBcIlwiICsgdmFsaWRhdGlvbi5tYXhsZW5ndGhNZXNzYWdlICsgXCJcIik7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9Ki9cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvL1BhdHRlcm4gbWVzc2FnZVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbmF2Y29uLmtlbmRvLnBhdHRlcm5WYWxpZGF0aW9uKG15RmllbGRzW2ZpZWxkTmFtZV0sIGZpZWxkTmFtZSwgdmFsaWRhdGlvbik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvKmlmICh2YWxpZGF0aW9uLnBhdHRlcm4gIT09IHVuZGVmaW5lZCAmJiB2YWxpZGF0aW9uLnBhdHRlcm4gIT09IG51bGwgJiYgdmFsaWRhdGlvbi5wYXR0ZXJuICE9PSBcIlwiKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHBhdHRlcm5SZWdleCA9IG5ldyBSZWdFeHAodmFsaWRhdGlvbi5wYXR0ZXJuLnRvU3RyaW5nKCkpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBtZXNzYWdlTWluID0gdmFsaWRhdGlvbi5wYXR0ZXJuTWVzc2FnZSAhPT0gdW5kZWZpbmVkICYmIHZhbGlkYXRpb24ucGF0dGVybk1lc3NhZ2UgIT09IFwiXCIgPyB2YWxpZGF0aW9uLnBhdHRlcm5NZXNzYWdlIDogXCJBbHBoYSBudW1lcmljIG9ubHkgYWxsb3dlZC5cIjtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBteUZpZWxkc1tmaWVsZE5hbWVdLnZhbGlkYXRpb25bZmllbGROYW1lLnRvTG93ZXJDYXNlKCkgKyBcInBhdHRlcm5cIl0gPSBmdW5jdGlvbiAoaW5wdXQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGlucHV0LmlzKFwiW25hbWU9J1wiICsgZmllbGROYW1lICsgXCInXVwiKSAmJiBpbnB1dC52YWwoKSAhPSBcIlwiKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbnB1dC5hdHRyKFwiZGF0YS1cIiArIGZpZWxkTmFtZS50b0xvd2VyQ2FzZSgpICsgXCJwYXR0ZXJuLW1zZ1wiLCBcIlwiICsgdmFsaWRhdGlvbi5wYXR0ZXJuTWVzc2FnZSArIFwiXCIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBwYXR0ZXJuUmVnZXgudGVzdChpbnB1dC52YWwoKSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0qL1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vRXhpc3REYXRhIG1lc3NhZ2VcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5hdmNvbi5rZW5kby5leGlzdERhdGFWYWxpZGF0aW9uKG15RmllbGRzW2ZpZWxkTmFtZV0sIGZpZWxkTmFtZSwgdmFsaWRhdGlvbiwgc2NvcGUpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLyppZiAodmFsaWRhdGlvbi5pc0V4aXN0RGF0YSAhPT0gdW5kZWZpbmVkICYmIHZhbGlkYXRpb24uaXNFeGlzdERhdGEgIT09IG51bGwgJiYgdmFsaWRhdGlvbi5pc0V4aXN0RGF0YSAhPT0gXCJcIikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBzY29wZURhdGEgPSBzY29wZS5uYXZjb25EYXRhW3ZhbGlkYXRpb24uaXNFeGlzdERhdGFdO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBrZXlPbGREYXRhID0gXCJcIjtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIG1lc3NhZ2VNaW4gPSB2YWxpZGF0aW9uLmlzRXhpc3RNZXNzYWdlICE9PSB1bmRlZmluZWQgJiYgdmFsaWRhdGlvbi5pc0V4aXN0TWVzc2FnZSAhPT0gXCJcIiA/IHZhbGlkYXRpb24uaXNFeGlzdE1lc3NhZ2UgOiBcImFscmVhZHkgZXhpc3RzLi5cIjtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBteUZpZWxkc1tmaWVsZE5hbWVdLnZhbGlkYXRpb25bZmllbGROYW1lLnRvTG93ZXJDYXNlKCkgKyBcImV4aXN0c1wiXSA9IGZ1bmN0aW9uIChpbnB1dCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoaW5wdXQuaXMoXCJbbmFtZT0nXCIgKyBmaWVsZE5hbWUgKyBcIiddXCIpICYmIGlucHV0LnZhbCgpICE9IFwiXCIpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChzY29wZS5maWVsZHMuZ2V0QnlJZCAhPT0gdW5kZWZpbmVkICYmIHNjb3BlLmZpZWxkcy5nZXRCeUlkICE9PSBudWxsKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGtleU9sZERhdGEgPSBzY29wZS5maWVsZHMuZ2V0QnlJZFtmaWVsZEtleV07XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0VmFsID0gbmF2Y29uLmdldEl0ZW1CeUtleVZhbHVlKHNjb3BlRGF0YSwgZmllbGRLZXksIGlucHV0LnZhbCgpLnRvU3RyaW5nKCkudHJpbSgpKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChyZXRWYWwgIT09IC0xICYmIGlucHV0LnZhbCgpLnRvU3RyaW5nKCkudHJpbSgpICE9PSBrZXlPbGREYXRhLnRvU3RyaW5nKCkudHJpbSgpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaW5wdXQuYXR0cihcImRhdGEtXCIgKyBmaWVsZE5hbWUudG9Mb3dlckNhc2UoKSArIFwiZXhpc3RzLW1zZ1wiLCBcIlwiICsgdmFsaWRhdGlvbi5pc0V4aXN0TWVzc2FnZSArIFwiXCIpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldFZhbCA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldFZhbCA9IHRydWU7XHJcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiByZXRWYWw7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0qL1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgIHJldHVybiBteUZpZWxkcztcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgLy99LDEyMDApO1xyXG59KG5hdmNvbiB8fCB7fSkpOyIsIihmdW5jdGlvbiAobmF2Y29uKSB7XHJcbiAgICBuYXZjb24uTWVudXJvdXRlID0ge1xyXG4gICAgICAgIGdldFJvdXRlczogZnVuY3Rpb24gKG5nQXV0aFNldHRpbmdzKSB7XHJcbiAgICAgICAgICAgIHZhciByb3V0ZXMgPSBbe1xyXG4gICAgICAgICAgICAgICAgdXJsOiAnL2xvZ2luJyxcclxuICAgICAgICAgICAgICAgIGNvbmZpZzoge1xyXG4gICAgICAgICAgICAgICAgICAgIHRlbXBsYXRlVXJsOiBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBuYXZjb24uTWVudXJvdXRlLmdldFRlbXBsYXRlVXJsKFwibG9naW5cIik7XHJcbiAgICAgICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgICAgICBjYXNlSW5zZW5zaXRpdmVNYXRjaDogZmFsc2UsXHJcbiAgICAgICAgICAgICAgICAgICAgY29udHJvbGxlcjogJ2xvZ2luJyxcclxuICAgICAgICAgICAgICAgICAgICBjb250cm9sbGVyQXM6ICd2bScsXHJcbiAgICAgICAgICAgICAgICAgICAgdGl0bGU6ICdsb2dpbicsXHJcbiAgICAgICAgICAgICAgICAgICAgc2V0dGluZ3M6IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgbmF2OiA4OCxcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWNvbjogJ2ZhIGZhLWJvb2ttYXJrJyxcclxuICAgICAgICAgICAgICAgICAgICAgICAgY29udGVudDogJzwvaT4gRmF2b3VyaXRlJ1xyXG4gICAgICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZToge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBwYWdlQ29uZmlnOiBmdW5jdGlvbiAoZGF0YXNlcnZpY2UsICRxLCAkcm9vdFNjb3BlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHEuYWxsKFtcImxvZ2luQ29uZmlnXCIsIFwibmF2Y29uZmllbGRodG1sXCJdLm1hcChmdW5jdGlvbiAoZCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChkID09IFwibmF2Y29uZmllbGRodG1sXCIgJiYgJHJvb3RTY29wZS5maWVsZFRlbXBsYXRlID09IHVuZGVmaW5lZCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgZW52aXJvbm1lbnQgPSBuZ0F1dGhTZXR0aW5ncy5lbnZpcm9ubWVudDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHByb2RQYXRoID0gXCJzdGFydC9cIjtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy92YXIgYXBwUGF0aCA9IChlbnZpcm9ubWVudCA9PT0gXCJwcm9kdWN0aW9uXCIpID8gcHJvZFBhdGggKyBcIm5hdmNvbkZpZWxkVGVtcGxhdGUuaHRtbFwiIDogXCJleHQtbW9kdWxlcy9uYXZjb25GaWVsZC9uYXZjb25GaWVsZFRlbXBsYXRlLmh0bWxcIjtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGFwcFBhdGggPSAoZW52aXJvbm1lbnQgPT09IFwicHJvZHVjdGlvblwiKSA/IHByb2RQYXRoICsgXCJuYXZjb25GaWVsZFRlbXBsYXRlLmh0bWxcIiA6IFwic3RhcnQvbmF2Y29uRmllbGRUZW1wbGF0ZS5odG1sXCI7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBkYXRhc2VydmljZS5nZXRTZXJ2ZXJIdG1sRGF0YShhcHBQYXRoKS50aGVuKGZ1bmN0aW9uIChyZXMpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBodG1sT2JqID0gJCgnPGh0bWw+PC9odG1sPicpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaHRtbE9iai5odG1sKHJlcy5kYXRhKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRyb290U2NvcGUuZmllbGRUZW1wbGF0ZSA9IGh0bWxPYmo7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoZCA9PSBcIm5hdmNvbmZpZWxkaHRtbFwiICYmICRyb290U2NvcGUuZmllbGRUZW1wbGF0ZSAhPSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBkYXRhc2VydmljZS5nZXRTZXJ2ZXJEYXRhKGQpLnRoZW4oZnVuY3Rpb24gKGRhdGEpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBuYXZjb24uanNvblRyYW5zZm9ybWVkKGRhdGEpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSkpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIHVybDogJy80MDQnLFxyXG4gICAgICAgICAgICAgICAgICAgIGNvbmZpZzoge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAvL3RlbXBsYXRlVXJsOiAnYXBwLzQwNC80MDQuaHRtbCdcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGVtcGxhdGVVcmw6IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBuYXZjb24uTWVudXJvdXRlLmdldFRlbXBsYXRlVXJsKFwiNDA0XCIpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgdXJsOiAnL2Rhc2hib2FyZCcsXHJcbiAgICAgICAgICAgICAgICAgICAgY29uZmlnOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRlbXBsYXRlVXJsOiBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gbmF2Y29uLk1lbnVyb3V0ZS5nZXRUZW1wbGF0ZVVybChcImRhc2hib2FyZFwiKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGl0bGU6ICdNeSBzcGFjZScsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGRpc3BsYXk6IGZhbHNlLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBzZXR0aW5nczoge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbmF2OiAxMixcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRlbnQ6ICc8aSBjbGFzcz1cImZhIGZhLWVkaXRcIj48L2k+IE15IHNwYWNlJ1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBjb250cm9sbGVyOiBmdW5jdGlvbiAoJHNjb3BlLCBwYWdlQ29uZmlnKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkc2NvcGUucGFnZUNvbmZpZyA9IHBhZ2VDb25maWc7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRyb2xsZXJBczogJ3ZtJyxcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZToge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcGFnZUNvbmZpZzogZnVuY3Rpb24gKGRhdGFzZXJ2aWNlLCAkcSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBudWxsO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICB1cmw6ICcvdXNlcm1hbmFnZW1lbnQnLFxyXG4gICAgICAgICAgICAgICAgICAgIGNvbmZpZzoge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAvL3RlbXBsYXRlVXJsOiAnYXBwL3VzZXJtYW5hZ2VtZW50L3VzZXJtYW5hZ2VtZW50Lmh0bWwnLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICB0ZW1wbGF0ZVVybDogZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG5hdmNvbi5NZW51cm91dGUuZ2V0VGVtcGxhdGVVcmwoXCJ1c2VybWFuYWdlbWVudFwiKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgY29udHJvbGxlcjogJ3VzZXJtYW5hZ2VtZW50JyxcclxuICAgICAgICAgICAgICAgICAgICAgICAgY29udHJvbGxlckFzOiAndm0nLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aXRsZTogJ1VzZXIgTWFuYWdlbWVudCcsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGRpc3BsYXk6IGZhbHNlLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBzZXR0aW5nczoge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbmF2OiAxMixcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRlbnQ6ICc8aSBjbGFzcz1cImZhIGZhLWhhbmQtby11cFwiPjwvaT4gVXNlciBNYW5hZ2VtZW50J1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXNvbHZlOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYWdlQ29uZmlnOiBmdW5jdGlvbiAoZGF0YXNlcnZpY2UpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZGF0YXNlcnZpY2UuZ2V0U2VydmVyRGF0YShcInVzZXJNYW5hZ2VtZW50Q29uZmlnXCIpLnRoZW4oZnVuY3Rpb24gKGRhdGEpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG5hdmNvbi5qc29uVHJhbnNmb3JtZWQoZGF0YSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGF1dGhvcml6ZTogdHJ1ZVxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgdXJsOiAnL3JvbGVtYW5hZ2VtZW50JyxcclxuICAgICAgICAgICAgICAgICAgICBjb25maWc6IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgLy90ZW1wbGF0ZVVybDogJ2FwcC9yb2xlbWFuYWdlbWVudC9yb2xlbWFuYWdlbWVudC5odG1sJyxcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGVtcGxhdGVVcmw6IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBuYXZjb24uTWVudXJvdXRlLmdldFRlbXBsYXRlVXJsKFwicm9sZW1hbmFnZW1lbnRcIik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdyb2xlbWFuYWdlbWVudCcsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRyb2xsZXJBczogJ3ZtJyxcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGl0bGU6ICdSb2xlIE1hbmFnZW1lbnQnLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBkaXNwbGF5OiBmYWxzZSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgc2V0dGluZ3M6IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5hdjogMTIsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb250ZW50OiAnPGkgY2xhc3M9XCJmYSBmYS1ncm91cFwiPjwvaT4gUm9sZSBNYW5hZ2VtZW50J1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXNvbHZlOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYWdlQ29uZmlnOiBmdW5jdGlvbiAoZGF0YXNlcnZpY2UpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZGF0YXNlcnZpY2UuZ2V0U2VydmVyRGF0YShcInJvbGVNYW5hZ2VtZW50Q29uZmlnXCIpLnRoZW4oZnVuY3Rpb24gKGRhdGEpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG5hdmNvbi5qc29uVHJhbnNmb3JtZWQoZGF0YSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGF1dGhvcml6ZTogZmFsc2VcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIHVybDogJy91c2VyYWNjZXNzcmlnaHRzJyxcclxuICAgICAgICAgICAgICAgICAgICBjb25maWc6IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgLy90ZW1wbGF0ZVVybDogJ2FwcC91c2VyYWNjZXNzcmlnaHRzL3VzZXJhY2Nlc3NyaWdodHMuaHRtbCcsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRlbXBsYXRlVXJsOiBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gbmF2Y29uLk1lbnVyb3V0ZS5nZXRUZW1wbGF0ZVVybChcInVzZXJhY2Nlc3NyaWdodHNcIik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRyb2xsZXI6ICd1c2VyYWNjZXNzcmlnaHRzJyxcclxuICAgICAgICAgICAgICAgICAgICAgICAgY29udHJvbGxlckFzOiAndm0nLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aXRsZTogJ1NlY3VyaXR5JyxcclxuICAgICAgICAgICAgICAgICAgICAgICAgZGlzcGxheTogZmFsc2UsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHNldHRpbmdzOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBuYXY6IDEyLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29udGVudDogJzxpIGNsYXNzPVwiZmEgZmEtYm9va1wiPjwvaT4gU2VjdXJpdHknXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlc29sdmU6IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhZ2VDb25maWc6IGZ1bmN0aW9uIChkYXRhc2VydmljZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBkYXRhc2VydmljZS5nZXRTZXJ2ZXJEYXRhKFwidXNlcmFjY2Vzc3JpZ2h0c0NvbmZpZ1wiKS50aGVuKGZ1bmN0aW9uIChkYXRhKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBuYXZjb24uanNvblRyYW5zZm9ybWVkKGRhdGEpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBhdXRob3JpemU6IHRydWVcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIHVybDogJy9ub3RpZmljYXRpb25zZXR1cCcsXHJcbiAgICAgICAgICAgICAgICAgICAgY29uZmlnOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vdGVtcGxhdGVVcmw6ICdhcHAvbm90aWZpY2F0aW9uc2V0dXAvbm90aWZpY2F0aW9uc2V0dXAuaHRtbCcsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRlbXBsYXRlVXJsOiBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gbmF2Y29uLk1lbnVyb3V0ZS5nZXRUZW1wbGF0ZVVybChcIm5vdGlmaWNhdGlvbnNldHVwXCIpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBjb250cm9sbGVyOiAnbm90aWZpY2F0aW9uc2V0dXAnLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBjb250cm9sbGVyQXM6ICd2bScsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRpdGxlOiAnTm90aWZpY2F0aW9uIFNldHVwJyxcclxuICAgICAgICAgICAgICAgICAgICAgICAgZGlzcGxheTogZmFsc2UsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHNldHRpbmdzOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBuYXY6IDEyLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29udGVudDogJzxpIGNsYXNzPVwiZmEgZmEtaGFuZC1vLXVwXCI+PC9pPiBOb3RpZmljYXRpb24gU2V0dXAnXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlc29sdmU6IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhZ2VDb25maWc6IGZ1bmN0aW9uIChkYXRhc2VydmljZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBkYXRhc2VydmljZS5nZXRTZXJ2ZXJEYXRhKFwibm90aWZpY2F0aW9uU2V0dXBDb25maWdcIikudGhlbihmdW5jdGlvbiAoZGF0YSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gbmF2Y29uLmpzb25UcmFuc2Zvcm1lZChkYXRhKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgYXV0aG9yaXplOiB0cnVlXHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICB1cmw6ICcvbm90aWZpY2F0aW9ucycsXHJcbiAgICAgICAgICAgICAgICAgICAgY29uZmlnOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vdGVtcGxhdGVVcmw6ICdhcHAvbm90aWZpY2F0aW9ucy9ub3RpZmljYXRpb25zLmh0bWwnLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICB0ZW1wbGF0ZVVybDogZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG5hdmNvbi5NZW51cm91dGUuZ2V0VGVtcGxhdGVVcmwoXCJub3RpZmljYXRpb25zXCIpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBjb250cm9sbGVyOiAnbm90aWZpY2F0aW9ucycsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRyb2xsZXJBczogJ3ZtJyxcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGl0bGU6ICdOb3RpZmljYXRpb25zJyxcclxuICAgICAgICAgICAgICAgICAgICAgICAgZGlzcGxheTogZmFsc2UsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHNldHRpbmdzOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBuYXY6IDEyLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29udGVudDogJzxpIGNsYXNzPVwiZmEgZmEtaGFuZC1vLXVwXCI+PC9pPiBOb3RpZmljYXRpb25zJ1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXNvbHZlOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYWdlQ29uZmlnOiBmdW5jdGlvbiAoZGF0YXNlcnZpY2UpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZGF0YXNlcnZpY2UuZ2V0U2VydmVyRGF0YShcIm5vdGlmaWNhdGlvbnNDb25maWdcIikudGhlbihmdW5jdGlvbiAoZGF0YSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gbmF2Y29uLmpzb25UcmFuc2Zvcm1lZChkYXRhKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgYXV0aG9yaXplOiB0cnVlXHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICB1cmw6ICcvdXNlcmltcG9ydCcsXHJcbiAgICAgICAgICAgICAgICAgICAgY29uZmlnOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vdGVtcGxhdGVVcmw6ICdhcHAvdXNlcmltcG9ydC91c2VyaW1wb3J0Lmh0bWwnLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICB0ZW1wbGF0ZVVybDogZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG5hdmNvbi5NZW51cm91dGUuZ2V0VGVtcGxhdGVVcmwoXCJ1c2VyaW1wb3J0XCIpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBjb250cm9sbGVyOiAndXNlcmltcG9ydCcsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRyb2xsZXJBczogJ3ZtJyxcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGl0bGU6ICdVc2VyIEltcG9ydCcsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGRpc3BsYXk6IGZhbHNlLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBzZXR0aW5nczoge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbmF2OiAxMixcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRlbnQ6ICc8aSBjbGFzcz1cImZhIGZhLWhhbmQtby11cFwiPjwvaT4gVXNlciBJbXBvcnQnXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlc29sdmU6IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhZ2VDb25maWc6IGZ1bmN0aW9uIChkYXRhc2VydmljZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBkYXRhc2VydmljZS5nZXRTZXJ2ZXJEYXRhKFwidXNlckltcG9ydENvbmZpZ1wiKS50aGVuKGZ1bmN0aW9uIChkYXRhKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBuYXZjb24uanNvblRyYW5zZm9ybWVkKGRhdGEpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBhdXRob3JpemU6IHRydWVcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIHVybDogJy91c2VycHJvZmlsZScsXHJcbiAgICAgICAgICAgICAgICAgICAgY29uZmlnOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vdGVtcGxhdGVVcmw6ICdhcHAvdXNlcnByb2ZpbGUvdXNlcnByb2ZpbGUuaHRtbCcsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRlbXBsYXRlVXJsOiBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gbmF2Y29uLk1lbnVyb3V0ZS5nZXRUZW1wbGF0ZVVybChcInVzZXJwcm9maWxlXCIpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBjb250cm9sbGVyOiAndXNlcnByb2ZpbGUnLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBjb250cm9sbGVyQXM6ICd2bScsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRpdGxlOiAnVXNlciBQcm9maWxlJyxcclxuICAgICAgICAgICAgICAgICAgICAgICAgZGlzcGxheTogdHJ1ZSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgc2V0dGluZ3M6IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5hdjogMTIsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb250ZW50OiAnPGkgY2xhc3M9XCJmYSBmYS1oYW5kLW8tdXBcIj48L2k+IFVzZXIgUHJvZmlsZSdcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZToge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcGFnZUNvbmZpZzogZnVuY3Rpb24gKGRhdGFzZXJ2aWNlLCBhdXRoU2VydmljZSwgJHEpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZGF0YXNlcnZpY2UuZ2V0U2VydmVyRGF0YShcInVzZXJQcm9maWxlQ29uZmlnXCIpLnRoZW4oZnVuY3Rpb24gKGRhdGEpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG5hdmNvbi5qc29uVHJhbnNmb3JtZWQoZGF0YSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGF1dGhvcml6ZTogdHJ1ZVxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgdXJsOiAnL2NoYW5nZXBhc3N3b3JkJyxcclxuICAgICAgICAgICAgICAgICAgICBjb25maWc6IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgLy90ZW1wbGF0ZVVybDogJ2FwcC9jaGFuZ2VwYXNzd29yZC9jaGFuZ2VwYXNzd29yZC5odG1sJyxcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGVtcGxhdGVVcmw6IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBuYXZjb24uTWVudXJvdXRlLmdldFRlbXBsYXRlVXJsKFwiY2hhbmdlcGFzc3dvcmRcIik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdjaGFuZ2VwYXNzd29yZCcsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRyb2xsZXJBczogJ3ZtJyxcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGl0bGU6ICdDaGFuZ2UgUGFzc3dvcmQnLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBkaXNwbGF5OiB0cnVlLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBzZXR0aW5nczoge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbmF2OiAxMixcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRlbnQ6ICc8aSBjbGFzcz1cImZhIGZhLWhhbmQtby11cFwiPjwvaT4gQ2hhbmdlIFBhc3N3b3JkJ1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXNvbHZlOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYWdlQ29uZmlnOiBmdW5jdGlvbiAoZGF0YXNlcnZpY2UsIGF1dGhTZXJ2aWNlLCAkcSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAkcS5hbGwoW1wiY2hhbmdlUGFzc3dvcmRDb25maWdcIiwgXCJ1c2VyUmVnaXN0cmF0aW9uSWRcIl0ubWFwKGZ1bmN0aW9uIChkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChkID09PSBcInVzZXJSZWdpc3RyYXRpb25JZFwiKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZGF0YXNlcnZpY2UuZ2V0U2VydmVyRGF0YShkLCBhdXRoU2VydmljZS5hdXRoZW50aWNhdGlvbi51c2VySWQpLnRoZW4oZnVuY3Rpb24gKGRhdGEpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZGF0YTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGRhdGFzZXJ2aWNlLmdldFNlcnZlckRhdGEoZCkudGhlbihmdW5jdGlvbiAoZGF0YSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBuYXZjb24uanNvblRyYW5zZm9ybWVkKGRhdGEpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGF1dGhvcml6ZTogdHJ1ZVxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgdXJsOiAnL2RpcmVjdGl2ZXMnLFxyXG4gICAgICAgICAgICAgICAgICAgIGNvbmZpZzoge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAvL3RlbXBsYXRlVXJsOiAnYXBwL3RpbGVzL3RpbGVzLmh0bWwnLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICB0ZW1wbGF0ZVVybDogZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG5hdmNvbi5NZW51cm91dGUuZ2V0VGVtcGxhdGVVcmwoXCJ0aWxlc1wiKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGl0bGU6ICdEaXJlY3RpdmVzJyxcclxuICAgICAgICAgICAgICAgICAgICAgICAgY29udHJvbGxlcjogJ3RpbGVzJyxcclxuICAgICAgICAgICAgICAgICAgICAgICAgY29udHJvbGxlckFzOiAndm0nLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBkaXNwbGF5OiB0cnVlLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBzZXR0aW5nczoge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbmF2OiA0LFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWNvbjogJ2ZhIGZhLXBlbmNpbC1zcXVhcmUtbycsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb250ZW50OiAnPC9pPiBEaXJlY3RpdmVzJ1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICB1cmw6ICcvbmV3cycsXHJcbiAgICAgICAgICAgICAgICAgICAgY29uZmlnOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vdGVtcGxhdGVVcmw6ICdhcHAvbmV3cy9uZXdzLmh0bWwnLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICB0ZW1wbGF0ZVVybDogZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG5hdmNvbi5NZW51cm91dGUuZ2V0VGVtcGxhdGVVcmwoXCJuZXdzXCIpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBkaXNwbGF5OiB0cnVlLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBjb250cm9sbGVyOiAnbmV3cycsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRyb2xsZXJBczogJ3ZtJyxcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGl0bGU6ICduZXdzJyxcclxuICAgICAgICAgICAgICAgICAgICAgICAgc2V0dGluZ3M6IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5hdjogMSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGljb246ICdmYSBmYS1kYXNoYm9hcmQnLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29udGVudDogJzwvaT4gTmV3cyBBbm5vdW5jZW1lbnRzJ1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXNvbHZlOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYWdlQ29uZmlnOiBmdW5jdGlvbiAoZGF0YXNlcnZpY2UpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZGF0YXNlcnZpY2UuZ2V0U2VydmVyRGF0YShcIm5ld3NBbm5vdW5jZW1lbnRzQ29uZmlnXCIpLnRoZW4oZnVuY3Rpb24gKGRhdGEpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG5hdmNvbi5qc29uVHJhbnNmb3JtZWQoZGF0YSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGF1dGhvcml6ZTogdHJ1ZVxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgXTtcclxuICAgICAgICAgICAgcmV0dXJuIHJvdXRlcztcclxuXHJcbiAgICAgICAgfSxcclxuICAgICAgICBnZXRUZW1wbGF0ZVVybDogZnVuY3Rpb24gKHBhdGgpIHtcclxuICAgICAgICAgICAgdmFyIGVudmlyb25tZW50ID0gbmF2Y29uLmdldEFwcGxpY2F0aW9uRW52aXJvbm1lbnQoKTtcclxuICAgICAgICAgICAgdmFyIHZlcnNpb24gPSBuYXZjb24uZ2V0QXBwbGljYXRpb25WZXJzaW9uKCk7XHJcbiAgICAgICAgICAgIHZhciBjYWNoZUJ1c3QgPSAobmV3IERhdGUoKSkuZ2V0VGltZSgpO1xyXG4gICAgICAgICAgICBpZiAoZW52aXJvbm1lbnQgPT09IFwicHJvZHVjdGlvblwiKVxyXG4gICAgICAgICAgICAgICAgY2FjaGVCdXN0ID0gdmVyc2lvbi5zcGxpdCgnLicpLmpvaW4oJycpOyAvL3ZlcnNpb247XHJcbiAgICAgICAgICAgIHZhciByZXR1cm5VcmwgPSBcIlwiO1xyXG4gICAgICAgICAgICBwYXRoID0gcGF0aC50b0xvd2VyQ2FzZSgpO1xyXG5cclxuICAgICAgICAgICAgdmFyIHRlbXBsYXRlQXBwUGF0aCA9IChlbnZpcm9ubWVudCA9PT0gXCJwcm9kdWN0aW9uXCIpID8gXCIvdGVtcGxhdGVzL2FwcC9cIiA6IFwiYXBwL1wiO1xyXG4gICAgICAgICAgICB2YXIgdGVtcGxhdGVFeHRQYXRoID0gKGVudmlyb25tZW50ID09PSBcInByb2R1Y3Rpb25cIikgPyBcIi90ZW1wbGF0ZXMvZXh0LW1vZHVsZXMvXCIgOiBcImV4dC1tb2R1bGVzL1wiO1xyXG5cclxuICAgICAgICAgICAgaWYgKHBhdGggPT09IFwiZGFzaGJvYXJkXCIpIHtcclxuICAgICAgICAgICAgICAgIHJldHVyblVybCA9IHRlbXBsYXRlQXBwUGF0aCArICdkYXNoYm9hcmQvZGFzaGJvYXJkVGVtcGxhdGUuaHRtbCc7XHJcbiAgICAgICAgICAgIH0gZWxzZSBpZiAocGF0aCA9PT0gXCI0MDRcIikge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuVXJsID0gdGVtcGxhdGVBcHBQYXRoICsgJzQwNC80MDQuaHRtbCc7XHJcbiAgICAgICAgICAgIH0gZWxzZSBpZiAocGF0aCA9PT0gXCJ1c2VybWFuYWdlbWVudFwiKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm5VcmwgPSB0ZW1wbGF0ZUFwcFBhdGggKyAndXNlcm1hbmFnZW1lbnQvdXNlcm1hbmFnZW1lbnQuaHRtbCc7XHJcbiAgICAgICAgICAgIH0gZWxzZSBpZiAocGF0aCA9PT0gXCJyb2xlbWFuYWdlbWVudFwiKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm5VcmwgPSB0ZW1wbGF0ZUFwcFBhdGggKyAncm9sZW1hbmFnZW1lbnQvcm9sZW1hbmFnZW1lbnQuaHRtbCc7XHJcbiAgICAgICAgICAgIH0gZWxzZSBpZiAocGF0aCA9PT0gXCJ1c2VyYWNjZXNzcmlnaHRzXCIpIHtcclxuICAgICAgICAgICAgICAgIHJldHVyblVybCA9IHRlbXBsYXRlQXBwUGF0aCArICd1c2VyYWNjZXNzcmlnaHRzL3VzZXJhY2Nlc3NyaWdodHMuaHRtbCc7XHJcbiAgICAgICAgICAgIH0gZWxzZSBpZiAocGF0aCA9PT0gXCJ1c2VycHJvZmlsZVwiKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm5VcmwgPSB0ZW1wbGF0ZUFwcFBhdGggKyAndXNlcnByb2ZpbGUvdXNlcnByb2ZpbGUuaHRtbCc7XHJcbiAgICAgICAgICAgIH0gZWxzZSBpZiAocGF0aCA9PT0gXCJjaGFuZ2VwYXNzd29yZFwiKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm5VcmwgPSB0ZW1wbGF0ZUFwcFBhdGggKyAnY2hhbmdlcGFzc3dvcmQvY2hhbmdlcGFzc3dvcmQuaHRtbCc7XHJcbiAgICAgICAgICAgIH0gZWxzZSBpZiAocGF0aCA9PT0gXCJwaG90b3VwbG9hZGVyXCIpIHtcclxuICAgICAgICAgICAgICAgIHJldHVyblVybCA9IHRlbXBsYXRlQXBwUGF0aCArICdwaG90by9lZ1Bob3RvVXBsb2FkZXIuaHRtbCc7XHJcbiAgICAgICAgICAgIH0gZWxzZSBpZiAocGF0aCA9PT0gXCJuYXZjb25jaGFydFwiKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm5VcmwgPSB0ZW1wbGF0ZUFwcFBhdGggKyAnd2lkZ2V0cy9uYXZjb25DaGFydC9uYXZjb25DaGFydFRlbXBsYXRlLmh0bWwnO1xyXG4gICAgICAgICAgICAgICAgLy99IGVsc2UgaWYgKHBhdGggPT09IFwibmF2Y29uZGFzaGJvYXJkXCIpIHtcclxuICAgICAgICAgICAgICAgIC8vICAgIHJldHVyblVybCA9IHRlbXBsYXRlRXh0UGF0aCArICduYXZjb25EYXNoYm9hcmQvbmF2Y29uRGFzaGJvYXJkVGVtcGxhdGUuaHRtbCc7XHJcbiAgICAgICAgICAgICAgICAvL30gZWxzZSBpZiAocGF0aCA9PT0gXCJuYXZjb253aWRnZXRib2R5XCIpIHtcclxuICAgICAgICAgICAgICAgIC8vICAgIHJldHVyblVybCA9IHRlbXBsYXRlRXh0UGF0aCArICduYXZjb25EYXNoYm9hcmQvbmF2Y29uV2lkZ2V0Qm9keVRlbXBsYXRlLmh0bWwnO1xyXG4gICAgICAgICAgICAgICAgLy99IGVsc2UgaWYgKHBhdGggPT09IFwibmF2Y29uZGVsZXRlXCIpIHtcclxuICAgICAgICAgICAgICAgIC8vICAgIHJldHVyblVybCA9IHRlbXBsYXRlRXh0UGF0aCArICduYXZjb25EZWxldGUvbmF2Y29uRGVsZXRlVGVtcGxhdGUuaHRtbCc7XHJcbiAgICAgICAgICAgICAgICAvL30gZWxzZSBpZiAocGF0aCA9PT0gXCJuYXZjb25ldmFsdWF0aW9uXCIpIHtcclxuICAgICAgICAgICAgICAgIC8vICAgIHJldHVyblVybCA9IHRlbXBsYXRlRXh0UGF0aCArICduYXZjb25FdmFsdWF0aW9uL25hdmNvbkV2YWx1YXRpb25UZW1wbGF0ZS5odG1sJztcclxuICAgICAgICAgICAgfSBlbHNlIGlmIChwYXRoID09PSBcIm5hdmNvbmZvcm1cIikge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuVXJsID0gdGVtcGxhdGVFeHRQYXRoICsgJ25hdmNvbkZvcm0vbmF2Y29uRm9ybVRlbXBsYXRlLmh0bWwnO1xyXG4gICAgICAgICAgICB9IGVsc2UgaWYgKHBhdGggPT09IFwibmF2Y29uZnJhbWV3b3JrXCIpIHtcclxuICAgICAgICAgICAgICAgIHJldHVyblVybCA9IHRlbXBsYXRlRXh0UGF0aCArICduYXZjb25GcmFtZXdvcmsvbmF2Y29uRnJhbWV3b3JrVGVtcGxhdGUuaHRtbCc7XHJcbiAgICAgICAgICAgIH0gZWxzZSBpZiAocGF0aCA9PT0gXCJuYXZjb251c2VycHJvZmlsZVwiKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm5VcmwgPSB0ZW1wbGF0ZUV4dFBhdGggKyAnbmF2Y29uRnJhbWV3b3JrL25hdmNvblVzZXJQcm9maWxlL25hdmNvblVzZXJQcm9maWxlVGVtcGxhdGUuaHRtbCc7XHJcbiAgICAgICAgICAgIH0gZWxzZSBpZiAocGF0aCA9PT0gXCJuYXZjb251c2VycHJvZmlsZXNtYWxsXCIpIHtcclxuICAgICAgICAgICAgICAgIHJldHVyblVybCA9IHRlbXBsYXRlRXh0UGF0aCArICduYXZjb25GcmFtZXdvcmsvbmF2Y29uVXNlclByb2ZpbGUvbmF2Y29uVXNlclByb2ZpbGVTbWFsbFRlbXBsYXRlLmh0bWwnO1xyXG4gICAgICAgICAgICB9IGVsc2UgaWYgKHBhdGggPT09IFwibmF2Y29ubWVudVwiKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm5VcmwgPSB0ZW1wbGF0ZUV4dFBhdGggKyAnbmF2Y29uTWVudS9uYXZjb25NZW51VGVtcGxhdGUuaHRtbCc7XHJcbiAgICAgICAgICAgIH0gZWxzZSBpZiAocGF0aCA9PT0gXCJuYXZjb25tZW51Z3JvdXBcIikge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuVXJsID0gdGVtcGxhdGVFeHRQYXRoICsgJ25hdmNvbk1lbnUvbmF2Y29uTWVudUdyb3VwVGVtcGxhdGUuaHRtbCc7XHJcbiAgICAgICAgICAgIH0gZWxzZSBpZiAocGF0aCA9PT0gXCJuYXZjb25tZW51aXRlbVwiKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm5VcmwgPSB0ZW1wbGF0ZUV4dFBhdGggKyAnbmF2Y29uTWVudS9uYXZjb25NZW51SXRlbVRlbXBsYXRlLmh0bWwnO1xyXG4gICAgICAgICAgICB9IGVsc2UgaWYgKHBhdGggPT09IFwibmF2Y29ubW9kYWxcIikge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuVXJsID0gdGVtcGxhdGVFeHRQYXRoICsgJ25hdmNvbk1vZGFsL25hdmNvbk1vZGFsVGVtcGxhdGUuaHRtbCc7XHJcbiAgICAgICAgICAgIH0gZWxzZSBpZiAocGF0aCA9PT0gXCJuYXZjb25wYWdlYmFyXCIpIHtcclxuICAgICAgICAgICAgICAgIHJldHVyblVybCA9IHRlbXBsYXRlRXh0UGF0aCArICduYXZjb25QYWdlYmFyL25hdmNvblBhZ2ViYXJUZW1wbGF0ZS5odG1sJztcclxuICAgICAgICAgICAgfSBlbHNlIGlmIChwYXRoID09PSBcIm5hdmNvbnBvcnRsZXRcIikge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuVXJsID0gdGVtcGxhdGVFeHRQYXRoICsgJ25hdmNvblBvcnRsZXQvbmF2Y29uUG9ydGxldFRlbXBsYXRlLmh0bWwnO1xyXG4gICAgICAgICAgICB9IGVsc2UgaWYgKHBhdGggPT09IFwibmF2Y29ucmF0aW5nXCIpIHtcclxuICAgICAgICAgICAgICAgIHJldHVyblVybCA9IHRlbXBsYXRlRXh0UGF0aCArICduYXZjb25SYXRpbmcvbmF2Y29uUmF0aW5nVGVtcGxhdGUuaHRtbCc7XHJcbiAgICAgICAgICAgIH0gZWxzZSBpZiAocGF0aCA9PT0gXCJuYXZjb25yZXBvcnRcIikge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuVXJsID0gdGVtcGxhdGVFeHRQYXRoICsgJ25hdmNvblJlcG9ydC9uYXZjb25SZXBvcnRUZW1wbGF0ZS5odG1sJztcclxuICAgICAgICAgICAgfSBlbHNlIGlmIChwYXRoID09PSBcIm5hdmNvbnJlcG9ydHBhZ2VcIikge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuVXJsID0gdGVtcGxhdGVFeHRQYXRoICsgJ25hdmNvblJlcG9ydC9uYXZjb25SZXBvcnRQYWdlVGVtcGxhdGUuaHRtbCc7XHJcbiAgICAgICAgICAgIH0gZWxzZSBpZiAocGF0aCA9PT0gXCJuYXZjb250YWJsZVwiKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm5VcmwgPSB0ZW1wbGF0ZUV4dFBhdGggKyAnbmF2Y29uVGFibGUvbmF2Y29uVGFibGVUZW1wbGF0ZS5odG1sJztcclxuICAgICAgICAgICAgfSBlbHNlIGlmIChwYXRoID09PSBcIm5hdmNvbnRhYmxlZWRpdG9yXCIpIHtcclxuICAgICAgICAgICAgICAgIHJldHVyblVybCA9IHRlbXBsYXRlRXh0UGF0aCArICduYXZjb25UYWJsZUVkaXRvci9uYXZjb25UYWJsZUVkaXRvclRlbXBsYXRlLmh0bWwnO1xyXG4gICAgICAgICAgICB9IGVsc2UgaWYgKHBhdGggPT09IFwibmF2Y29udHJlZVwiKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm5VcmwgPSB0ZW1wbGF0ZUV4dFBhdGggKyAnbmF2Y29uVHJlZS9uYXZjb25UcmVlVGVtcGxhdGUuaHRtbCc7XHJcbiAgICAgICAgICAgIH0gZWxzZSBpZiAocGF0aCA9PT0gXCJuYXZjb25maWxldXBsb2FkXCIpIHtcclxuICAgICAgICAgICAgICAgIHJldHVyblVybCA9IHRlbXBsYXRlRXh0UGF0aCArICduYXZjb25VcGxvYWQvbmF2Y29uRmlsZVVwbG9hZFRlbXBsYXRlLmh0bWwnO1xyXG4gICAgICAgICAgICB9IGVsc2UgaWYgKHBhdGggPT09IFwibmF2Y29ucGhvdG91cGxvYWRcIikge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuVXJsID0gdGVtcGxhdGVFeHRQYXRoICsgJ25hdmNvblVwbG9hZC9uYXZjb25QaG90b1VwbG9hZFRlbXBsYXRlLmh0bWwnO1xyXG5cclxuICAgICAgICAgICAgfSBlbHNlIGlmIChwYXRoID09PSBcIm5hdmNvbmtlbmRvdGVtcGxhdGVcIikge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuVXJsID0gdGVtcGxhdGVFeHRQYXRoICsgJ25hdmNvbktlbmRvL25hdmNvbktlbmRvVGVtcGxhdGUuaHRtbCc7XHJcbiAgICAgICAgICAgIH0gZWxzZSBpZiAocGF0aCA9PT0gXCJuYXZjb25rZW5kb3RhYmxlXCIpIHtcclxuICAgICAgICAgICAgICAgIHJldHVyblVybCA9IHRlbXBsYXRlRXh0UGF0aCArICduYXZjb25LZW5kby9uYXZjb25LZW5kb1RhYmxlLmh0bWwnO1xyXG4gICAgICAgICAgICB9IGVsc2UgaWYgKHBhdGggPT09IFwibmF2Y29ua2VuZG9zY2hlZHVsZVwiKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm5VcmwgPSB0ZW1wbGF0ZUV4dFBhdGggKyAnbmF2Y29uS2VuZG8vbmF2Y29uS2VuZG9TY2hlZHVsZS5odG1sJztcclxuXHJcbiAgICAgICAgICAgIH0gZWxzZSBpZiAocGF0aCA9PT0gXCJsb2dpblwiKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm5VcmwgPSB0ZW1wbGF0ZUFwcFBhdGggKyAnbG9naW4vbG9naW4uaHRtbCc7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGlmIChlbnZpcm9ubWVudCAhPT0gXCJwcm9kdWN0aW9uXCIpIHJldHVyblVybCArIFwiP3Y9XCIgKyBjYWNoZUJ1c3Q7XHJcbiAgICAgICAgICAgIHJldHVybiByZXR1cm5Vcmw7XHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxufShuYXZjb24gfHwge30pKTsiLCIoZnVuY3Rpb24gKG5hdmNvbikge1xyXG4gICAgbmF2Y29uLnNhdmUgPSB7XHJcbiAgICAgICAgc2VsZWN0ZWRSb3dJbmRleDogZnVuY3Rpb24gKHRhYmxlLCBzZWxlY3RlZFJvdywgaWRDb2x1bW4pIHtcclxuICAgICAgICAgICAgdmFyIHJldHVybkRhdGEgPSAtMTtcclxuICAgICAgICAgICAgdmFyIHRhYmxlRGF0YSA9IHRhYmxlLmRhdGEgIT09IHVuZGVmaW5lZCA/IHRhYmxlLmRhdGEgOiB0YWJsZTtcclxuXHJcbiAgICAgICAgICAgIGlmICh0YWJsZURhdGEgIT09IHVuZGVmaW5lZCAmJiB0YWJsZURhdGEubGVuZ3RoID4gMClcclxuICAgICAgICAgICAgICAgIHJldHVybkRhdGEgPSBuYXZjb24uZ2V0SXRlbUluZGV4QnlLZXlWYWx1ZSh0YWJsZURhdGEsIGlkQ29sdW1uLCBzZWxlY3RlZFJvd1tpZENvbHVtbl0pO1xyXG5cclxuICAgICAgICAgICAgcmV0dXJuIHJldHVybkRhdGE7XHJcbiAgICAgICAgfSxcclxuICAgICAgICBsb2FkTGlzdERlZmF1bHREYXRhOiBmdW5jdGlvbiAoZGF0YSwgZmllbGRzKSB7XHJcbiAgICAgICAgICAgICQubWFwKGZpZWxkcywgZnVuY3Rpb24gKGl0ZW0sIGtleSkge1xyXG4gICAgICAgICAgICAgICAgaWYgKGl0ZW0udHlwZS50b0xvd2VyQ2FzZSgpID09PSBcInNlbGVjdFwiIHx8IGl0ZW0udHlwZS50b0xvd2VyQ2FzZSgpID09PSBcImF1dG9jb21wbGV0ZVwiIHx8IGl0ZW0udHlwZS50b0xvd2VyQ2FzZSgpID09PSBcIm11bHRpc2VsZWN0XCIgfHwgaXRlbS50eXBlLnRvTG93ZXJDYXNlKCkgPT09IFwibXVsdGlzZWxlY3RjaGVja2JveFwiXHJcbiAgICAgICAgICAgICAgICAgICAgfHwgaXRlbS50eXBlLnRvTG93ZXJDYXNlKCkgPT09IFwidGFiXCIgfHwgaXRlbS50eXBlLnRvTG93ZXJDYXNlKCkgPT09IFwibGlzdHZpZXdcIikge1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBkZWZhdWx0RmllbGQgPSBpdGVtLnNlbGVjdE9wdGlvbnMuaXRlbS5kZWZhdWx0RmllbGQ7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGRlZmF1bHRGaWVsZCAhPT0gdW5kZWZpbmVkICYmIGRlZmF1bHRGaWVsZCAhPT0gXCJcIikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoZGF0YVtkZWZhdWx0RmllbGRdICE9PSB1bmRlZmluZWQgJiYgZGF0YVtkZWZhdWx0RmllbGRdICE9PSBudWxsICYmIGRhdGFbZGVmYXVsdEZpZWxkXSAhPT0gXCJcIilcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGl0ZW0uc2VsZWN0T3B0aW9ucy5pdGVtcyA9IGFuZ3VsYXIuY29weShuYXZjb24uZ2V0RGlzdGluY3Rmcm9tSlNPTihkYXRhW2RlZmF1bHRGaWVsZF0sIGl0ZW0uc2VsZWN0T3B0aW9ucy5pdGVtLmRhdGFGaWVsZCkpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGVsc2UgaWYgKGl0ZW0udHlwZS50b0xvd2VyQ2FzZSgpID09PSBcInJhZGlvXCIpIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoaXRlbS50ZW1wbGF0ZU9wdGlvbnMuaXRlbSAhPT0gdW5kZWZpbmVkICYmIGl0ZW0udGVtcGxhdGVPcHRpb25zLml0ZW0gIT09IG51bGwpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGRlZmF1bHRGaWVsZCA9IGl0ZW0udGVtcGxhdGVPcHRpb25zLml0ZW0uZGVmYXVsdEZpZWxkO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoZGVmYXVsdEZpZWxkICE9PSB1bmRlZmluZWQgJiYgZGVmYXVsdEZpZWxkICE9PSBcIlwiKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoZGF0YVtkZWZhdWx0RmllbGRdICE9PSB1bmRlZmluZWQgJiYgZGF0YVtkZWZhdWx0RmllbGRdICE9PSBudWxsICYmIGRhdGFbZGVmYXVsdEZpZWxkXSAhPT0gXCJcIilcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpdGVtLnRlbXBsYXRlT3B0aW9ucy5pdGVtcyA9IGFuZ3VsYXIuY29weShkYXRhW2RlZmF1bHRGaWVsZF0pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGVsc2UgaWYgKGl0ZW0udHlwZS50b0xvd2VyQ2FzZSgpID09PSBcImNoZWNrYm94bGlzdFwiIHx8IGl0ZW0udHlwZS50b0xvd2VyQ2FzZSgpID09PSBcImdyb3VwY2hlY2tib3hsaXN0XCIpIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoaXRlbS50ZW1wbGF0ZU9wdGlvbnMuaXRlbSAhPT0gdW5kZWZpbmVkICYmIGl0ZW0udGVtcGxhdGVPcHRpb25zLml0ZW0gIT09IG51bGwpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGRlZmF1bHRGaWVsZCA9IGl0ZW0udGVtcGxhdGVPcHRpb25zLml0ZW0uZGVmYXVsdEZpZWxkO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoZGVmYXVsdEZpZWxkICE9PSB1bmRlZmluZWQgJiYgZGVmYXVsdEZpZWxkICE9PSBcIlwiKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoZGF0YVtkZWZhdWx0RmllbGRdICE9PSB1bmRlZmluZWQgJiYgZGF0YVtkZWZhdWx0RmllbGRdICE9PSBudWxsICYmIGRhdGFbZGVmYXVsdEZpZWxkXSAhPT0gXCJcIilcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpdGVtLmRhdGEgPSBhbmd1bGFyLmNvcHkoZGF0YVtkZWZhdWx0RmllbGRdKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH0sXHJcbiAgICAgICAgbG9hZExpc3RTaW5nbGVEYXRhOiBmdW5jdGlvbiAoZGF0YSwgZmllbGRzLCBrZXkpIHtcclxuICAgICAgICAgICAgdmFyIGtleUluZGV4ID0gbmF2Y29uLmdldEl0ZW1JbmRleEJ5UHJvcGVydHkoZmllbGRzLCBrZXkpO1xyXG4gICAgICAgICAgICB2YXIgaXRlbSA9IGZpZWxkc1trZXlJbmRleF07XHJcbiAgICAgICAgICAgIGlmIChrZXlJbmRleCAhPT0gLTEgJiYgaXRlbSAhPT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoaXRlbS50eXBlLnRvTG93ZXJDYXNlKCkgPT09IFwic2VsZWN0XCIgfHwgaXRlbS50eXBlLnRvTG93ZXJDYXNlKCkgPT09IFwiYXV0b2NvbXBsZXRlXCIgfHwgaXRlbS50eXBlLnRvTG93ZXJDYXNlKCkgPT09IFwibXVsdGlzZWxlY3RcIiB8fCBpdGVtLnR5cGUudG9Mb3dlckNhc2UoKSA9PT0gXCJtdWx0aXNlbGVjdGNoZWNrYm94XCJcclxuICAgICAgICAgICAgICAgICAgICB8fCBpdGVtLnR5cGUudG9Mb3dlckNhc2UoKSA9PT0gXCJ0YWJcIiB8fCBpdGVtLnR5cGUudG9Mb3dlckNhc2UoKSA9PT0gXCJsaXN0dmlld1wiKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIGRlZmF1bHRGaWVsZCA9IGl0ZW0uc2VsZWN0T3B0aW9ucy5pdGVtLmRlZmF1bHRGaWVsZDtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoZGVmYXVsdEZpZWxkICE9PSB1bmRlZmluZWQgJiYgZGVmYXVsdEZpZWxkICE9PSBcIlwiKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChkYXRhW2RlZmF1bHRGaWVsZF0gIT09IHVuZGVmaW5lZCAmJiBkYXRhW2RlZmF1bHRGaWVsZF0gIT09IG51bGwgJiYgZGF0YVtkZWZhdWx0RmllbGRdICE9PSBcIlwiKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaXRlbS5zZWxlY3RPcHRpb25zLml0ZW1zID0gYW5ndWxhci5jb3B5KGRhdGFbZGVmYXVsdEZpZWxkXSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSxcclxuICAgICAgICB0YWJsZUNvbHVtbkFzc2lnbjogZnVuY3Rpb24gKHRhYmxlLCBjb2x1bW5EYXRhLCBzZXJ2aWNlTmFtZSkge1xyXG4gICAgICAgICAgICB2YXIgcmV0dXJuRGF0YSA9IFwiXCI7XHJcbiAgICAgICAgICAgIGlmIChzZXJ2aWNlTmFtZSAhPSB1bmRlZmluZWQgJiYgc2VydmljZU5hbWUgIT0gXCJcIikge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuRGF0YSA9IGRhdGFzZXJ2aWNlLmdldFNlcnZlckRhdGEoc2VydmljZU5hbWUpLnRoZW4oZnVuY3Rpb24gKGRhdGEpIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoZGF0YSA9PT0gdW5kZWZpbmVkIHx8IGRhdGEubGVuZ3RoID09PSAwKSByZXR1cm47XHJcbiAgICAgICAgICAgICAgICAgICAgdGFibGVDb2x1bW5DcmVhdGUoZGF0YSk7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGRhdGE7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIHRhYmxlQ29sdW1uQ3JlYXRlKGNvbHVtbkRhdGEpO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBmdW5jdGlvbiB0YWJsZUNvbHVtbkNyZWF0ZShkYXRhKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoZGF0YSAhPSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgY29sdW1uZGV0YWlscyA9IFwiXCIsIGkgPSAwO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICBmb3IgKGkgPSAwOyBpIDwgZGF0YS5sZW5ndGg7IGkrKykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAvL3ZhciBjb2x1bW5JbmRleCA9IG5hdmNvbi5nZXRJdGVtQnlLZXlWYWx1ZSh0YWJsZS5jb2x1bW5Db250cm9sLmV4Y2VwdENvbHVtbnMsIFwiaW5kZXhcIiwgaSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBjb2x1bW5JbmRleCA9IHRhYmxlLmNvbHVtbkNvbnRyb2wuZXhjZXB0Q29sdW1ucy5pbmRleE9mKGkpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoY29sdW1uSW5kZXggIT09IC0xKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29sdW1uZGV0YWlscyArPSBcIntcXFwidGl0bGVcXFwiOiBcXFwiXCIgKyBkYXRhW2ldLnRleHQudHJpbSgpICsgXCJcXFwiLCBcXFwiZGF0YVxcXCI6IFxcXCJcIiArIGRhdGFbaV0uaWQgKyBcIlxcXCIsIFxcXCJ3aWR0aFxcXCI6IFxcXCIxMDBweFxcXCIgfSxcIjtcclxuICAgICAgICAgICAgICAgICAgICAgICAgZWxzZVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29sdW1uZGV0YWlscyArPSBcIntcXFwidGl0bGVcXFwiOiBcXFwiXCIgKyBkYXRhW2ldLnRleHQudHJpbSgpICsgXCJcXFwiLCBcXFwib3B0aW9uc1xcXCIgOiB7XFxcInR5cGVcXFwiIDogXFxcIlwiICsgdGFibGUuY29sdW1uQ29udHJvbC50eXBlICsgXCJcXFwifSwgXFxcImRhdGFcXFwiOiBcXFwiXCIgKyBkYXRhW2ldLmlkICsgXCJcXFwiLCBcXFwid2lkdGhcXFwiOiBcXFwiMTAwcHhcXFwiIH0sXCI7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vY29sdW1uZGV0YWlscyArPSBcIntcXFwidGl0bGVcXFwiOiBcXFwiXCIgKyBkYXRhW2ldLnRleHQudHJpbSgpICsgXCJcXFwiLCBcXFwiZGF0YVxcXCI6IFxcXCJcIiArIGRhdGFbaV0uaWQgKyBcIlxcXCIsIFxcXCJmaWVsZFxcXCI6IFxcXCJcIiArIGRhdGFbaV0uaWQgKyBcIlxcXCIsIFxcXCJ3aWR0aFxcXCI6IFxcXCJcIiArIGNvbHVtbkluZGV4LndpZHRoICsgXCJcXFwiLCBcXFwiZmllbGRUeXBlXFxcIjogXFxcInRleHRcXFwiIH0sXCI7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIGlmIChjb2x1bW5kZXRhaWxzICE9PSBcIlwiKSBjb2x1bW5kZXRhaWxzID0gY29sdW1uZGV0YWlscy5zdWJzdHJpbmcoMCwgY29sdW1uZGV0YWlscy5sZW5ndGggLSAxKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgdGFibGUuY29sdW1ucyA9ICQucGFyc2VKU09OKFwiW1wiICsgY29sdW1uZGV0YWlscyArIFwiXVwiKTtcclxuICAgICAgICAgICAgICAgICAgICAvL3RhYmxlLmNvbHVtbnMgPSBuYXZjb24uanNvblRyYW5zZm9ybWVkKCQucGFyc2VKU09OKFwiW1wiICsgY29sdW1uZGV0YWlscyArIFwiXVwiKSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gZGF0YTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0sXHJcbiAgICAgICAgYWRkTmV3T3B0aW9uOiBmdW5jdGlvbiAoc2NvcGUsIGNvbmZpZ0ZpZWxkcywgZmllbGRzLCBkaXNwbGF5VGl0bGUsIHRyZWVUYWJsZSwgY2FsbGJhY2ssIHR5cGUpIHtcclxuICAgICAgICAgICAgdmFyIHJldERhdGEgPSBjYW5jZWxkYXRhKCk7XHJcbiAgICAgICAgICAgIGlmIChjYWxsYmFjayAhPT0gdW5kZWZpbmVkICYmICQuaXNGdW5jdGlvbihjYWxsYmFjaykpXHJcbiAgICAgICAgICAgICAgICBjYWxsYmFjayhyZXREYXRhKTtcclxuXHJcbiAgICAgICAgICAgIHJldHVybiByZXREYXRhO1xyXG5cclxuICAgICAgICAgICAgZnVuY3Rpb24gY2FuY2VsZGF0YSgpIHtcclxuICAgICAgICAgICAgICAgIHZhciByZXR1cm5EYXRhID0gXCJcIjtcclxuICAgICAgICAgICAgICAgIG5hdmNvbi5jbGVhckZpZWxkc0RhdGEoZmllbGRzKTtcclxuICAgICAgICAgICAgICAgIG5hdmNvbi51cGRhdGVGaWVsZHNEYXRhKGZpZWxkcywgY29uZmlnRmllbGRzLCBzY29wZSwgZmFsc2UpO1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuRGF0YSA9ICdBZGQgKCAnICsgZGlzcGxheVRpdGxlICsgXCIgKVwiO1xyXG5cclxuICAgICAgICAgICAgICAgIGlmICh0cmVlVGFibGUgIT09IHVuZGVmaW5lZCAmJiB0cmVlVGFibGUgIT09IFwiXCIgJiYgdHJlZVRhYmxlLmxlbmd0aCA+IDApIHtcclxuICAgICAgICAgICAgICAgICAgICBuYXZjb24uY2xlYXJUcmVlRGF0YSh0cmVlVGFibGUpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIGlmICh0eXBlICE9PSB1bmRlZmluZWQgJiYgdHlwZSAhPT0gXCJcIikge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmICh0eXBlICE9PSBmYWxzZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoISQoXCIjXCIgKyB0eXBlKS5oYXNDbGFzcygnaW4nKSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbmF2Y29uLm9wZW5Nb2RhbCh0eXBlLCBmdW5jdGlvbiAodmFsKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbmF2Y29uLnNldEZpZWxkRm9jdXMoZmllbGRzKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgc2NvcGUuJGFwcGx5KCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG5hdmNvbi5zZXRGaWVsZEZvY3VzKGZpZWxkcyk7XHJcbiAgICAgICAgICAgICAgICAgICAgfSwgNTAwKTtcclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICByZXR1cm4gcmV0dXJuRGF0YTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0sXHJcbiAgICAgICAgb3B0aW9uVHlwZTogZnVuY3Rpb24gKG9wdGlvbmFsLCBjYWxsYmFjaykge1xyXG4gICAgICAgICAgICBpZiAob3B0aW9uYWwgPT09IHVuZGVmaW5lZCB8fCBvcHRpb25hbCA9PT0ge30pIHJldHVybiB0cnVlO1xyXG4gICAgICAgICAgICBuYXZjb24uc2F2ZS5zYXZlT3B0aW9uKG9wdGlvbmFsLnNjb3BlLCBvcHRpb25hbC5kYXRhc2VydmljZSwgb3B0aW9uYWwubW9kZSwgb3B0aW9uYWwudHlwZSxcclxuICAgICAgICAgICAgICAgIG9wdGlvbmFsLnRhYmxlLCBvcHRpb25hbC5maWVsZHMsIG9wdGlvbmFsLnJvd051bWJlcixcclxuICAgICAgICAgICAgICAgIG9wdGlvbmFsLmlkQ29sdW1uLCBvcHRpb25hbC5kaXNwbGF5Q29sdW1uLCBvcHRpb25hbC50cmVlVGFibGUsIG9wdGlvbmFsLnVwbG9hZCwgb3B0aW9uYWwucG9wdXAsIG9wdGlvbmFsLnR5cGUsXHJcbiAgICAgICAgICAgICAgICBmdW5jdGlvbiAoZGF0YSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGNhbGxiYWNrKGRhdGEpO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfSxcclxuICAgICAgICB0YWJsZUFjdGlvbjogZnVuY3Rpb24gKG9wdGlvbmFsLCBjYWxsYmFjaykge1xyXG4gICAgICAgICAgICBpZiAob3B0aW9uYWwgPT09IHVuZGVmaW5lZCB8fCBvcHRpb25hbCA9PT0ge30pIHJldHVybiB0cnVlO1xyXG5cclxuICAgICAgICAgICAgLy9vcHRpb25hbHtcInNjb3BlXCI6XCJcIiwgXCJ0eXBlXCI6XCJcIiwgZmllbGRzOlwiXCIsIHRhYmxlOlwiXCIsIHJvd051bWJlcjpcIlwiLCBwcmltYXJ5Q29sdW1uOlwiXCIsIGRpc3BsYXlDb2x1bW46XCJcIiwgcG9wdXA6XCJcIiwgdXBsb2FkOlwiXCJ9O1xyXG4gICAgICAgICAgICBpZiAob3B0aW9uYWwuZmllbGRzLm1vZGUgPT09IHVuZGVmaW5lZCB8fCBvcHRpb25hbC5maWVsZHMubW9kZSA9PT0gbnVsbCB8fCBvcHRpb25hbC5maWVsZHMubW9kZSA9PT0gXCJcIikgcmV0dXJuO1xyXG4gICAgICAgICAgICB2YXIgcmV0dXJuRGF0YSA9IFwiXCI7XHJcbiAgICAgICAgICAgIGlmIChvcHRpb25hbC5maWVsZHMubW9kZS50b1VwcGVyQ2FzZSgpID09PSBcIlNBVkVcIiB8fCBvcHRpb25hbC5maWVsZHMubW9kZS50b1VwcGVyQ2FzZSgpID09PSBcIlNBVkVBU1wiXHJcbiAgICAgICAgICAgICAgICB8fCBvcHRpb25hbC5maWVsZHMubW9kZS50b1VwcGVyQ2FzZSgpID09PSBcIlVQREFURVwiIHx8IG9wdGlvbmFsLmZpZWxkcy5tb2RlLnRvVXBwZXJDYXNlKCkgPT09IFwiREVMRVRFXCIpIHtcclxuXHJcbiAgICAgICAgICAgICAgICBpZiAob3B0aW9uYWwuZGF0YUFzc2lnbiAhPT0gdW5kZWZpbmVkICYmIG9wdGlvbmFsLmRhdGFBc3NpZ24gIT09IFwiXCIgJiYgb3B0aW9uYWwuZGF0YUFzc2lnbi5sZW5ndGggPiAwKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgJC5tYXAob3B0aW9uYWwuZGF0YUFzc2lnbiwgZnVuY3Rpb24gKGl0ZW0sIGtleSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgbWFpbkluZGV4ID0gbmF2Y29uLmdldEl0ZW1JbmRleEJ5UHJvcGVydHkoaXRlbVswXVswXSwgaXRlbVswXVsxXSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBjaGlsZEluZGV4ID0gbmF2Y29uLmdldEl0ZW1JbmRleEJ5UHJvcGVydHkob3B0aW9uYWwuZmllbGRzLCBpdGVtWzFdWzBdKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGl0ZW1bMF1bMl0gIT09IHVuZGVmaW5lZCAmJiBpdGVtWzBdWzJdICE9PSBudWxsKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBvcHRpb25hbC5maWVsZHNbY2hpbGRJbmRleF0uZGF0YSA9IChpdGVtWzBdWzBdW21haW5JbmRleF0uZGF0YVtpdGVtWzBdWzJdXSAhPT0gdW5kZWZpbmVkID8gaXRlbVswXVswXVttYWluSW5kZXhdLmRhdGFbaXRlbVswXVsyXV0gOiBpdGVtWzBdWzBdW21haW5JbmRleF0uZGF0YSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAobWFpbkluZGV4ICE9PSB1bmRlZmluZWQgJiYgbWFpbkluZGV4ICE9PSBudWxsICYmIG1haW5JbmRleCAhPT0gLTEgJiYgY2hpbGRJbmRleCAhPT0gLTEpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9wdGlvbmFsLmZpZWxkc1tjaGlsZEluZGV4XS5kYXRhID0gaXRlbVswXVswXVttYWluSW5kZXhdLmRhdGE7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoKG1haW5JbmRleCA9PT0gdW5kZWZpbmVkIHx8IG1haW5JbmRleCA9PT0gbnVsbCB8fCBtYWluSW5kZXggPT09IC0xKSAmJiBjaGlsZEluZGV4ICE9PSAtMSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgb3B0aW9uYWwuZmllbGRzW2NoaWxkSW5kZXhdLmRhdGEgPSBpdGVtWzBdWzBdO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgdmFyIGFkZGVkSXRlbSA9IG5hdmNvbi5nZXRGaWVsZHNEYXRhVG9TYXZlKG9wdGlvbmFsLmZpZWxkcywgb3B0aW9uYWwuZmllbGRzLm1vZGUsIG9wdGlvbmFsLmlkQ29sdW1uLCBvcHRpb25hbC51cGxvYWQpO1xyXG5cclxuICAgICAgICAgICAgICAgIGlmIChvcHRpb25hbC5maWVsZHMubW9kZS50b1VwcGVyQ2FzZSgpID09PSBcIlNBVkVcIiB8fCBvcHRpb25hbC5maWVsZHMubW9kZS50b1VwcGVyQ2FzZSgpID09PSBcIlNBVkVBU1wiKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgYWRkZWRJdGVtW29wdGlvbmFsLnByaW1hcnlDb2x1bW5dID0gKHBhcnNlSW50KG9wdGlvbmFsLnRhYmxlLmRhdGEubGVuZ3RoKSAtIDEwMCk7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGFkZGVkSXRlbS5PYmplY3RTdGF0ZSAhPT0gdW5kZWZpbmVkICYmIChhZGRlZEl0ZW0uT2JqZWN0U3RhdGUgPT09IFwiMFwiIHx8IGFkZGVkSXRlbS5PYmplY3RTdGF0ZSA9PT0gXCJcIikpIGFkZGVkSXRlbS5PYmplY3RTdGF0ZSA9IDE7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGFkZGVkSXRlbS5TdGF0dXMgIT09IHVuZGVmaW5lZCAmJiAoYWRkZWRJdGVtLlN0YXR1cyA9PT0gXCIwXCIgfHwgYWRkZWRJdGVtLlN0YXR1cyA9PT0gXCJcIikpIGFkZGVkSXRlbS5TdGF0dXMgPSAwO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICBpZiAoYWRkZWRJdGVtICE9PSB1bmRlZmluZWQgJiYgYWRkZWRJdGVtICE9PSBudWxsICYmIG9wdGlvbmFsLnRhYmxlICE9PSB1bmRlZmluZWQgJiYgb3B0aW9uYWwudGFibGUgIT09IG51bGwpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG9wdGlvbmFsLnRhYmxlLmRhdGEucHVzaChhZGRlZEl0ZW0pO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmIChvcHRpb25hbC5maWVsZHMubW9kZS50b1VwcGVyQ2FzZSgpID09PSBcIlVQREFURVwiKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGFkZGVkSXRlbS5PYmplY3RTdGF0ZSAhPT0gdW5kZWZpbmVkICYmIChhZGRlZEl0ZW0uT2JqZWN0U3RhdGUgPT09IDAgfHwgYWRkZWRJdGVtLk9iamVjdFN0YXRlID09PSBcIjBcIiB8fCBhZGRlZEl0ZW0uT2JqZWN0U3RhdGUgPT09IFwiXCIpKSBhZGRlZEl0ZW0uT2JqZWN0U3RhdGUgPSAyO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChhZGRlZEl0ZW0uU3RhdHVzICE9PSB1bmRlZmluZWQgJiYgKGFkZGVkSXRlbS5TdGF0dXMgPT09IFwiMFwiIHx8IGFkZGVkSXRlbS5TdGF0dXMgPT09IFwiXCIpKSBhZGRlZEl0ZW0uU3RhdHVzID0gMDtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIGluZGV4ID0gbmF2Y29uLmdldEl0ZW1JbmRleEJ5S2V5VmFsdWUob3B0aW9uYWwudGFibGUuZGF0YSwgb3B0aW9uYWwucHJpbWFyeUNvbHVtbiwgYWRkZWRJdGVtW29wdGlvbmFsLnByaW1hcnlDb2x1bW5dKTtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoaW5kZXggIT09IC0xICYmIG9wdGlvbmFsLnRhYmxlICE9PSB1bmRlZmluZWQgJiYgb3B0aW9uYWwudGFibGUgIT09IG51bGwpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgb3B0aW9uYWwudGFibGUuZGF0YS5zcGxpY2UoaW5kZXgsIDEsIGFkZGVkSXRlbSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmIChvcHRpb25hbC5maWVsZHMubW9kZS50b1VwcGVyQ2FzZSgpID09PSBcIkRFTEVURVwiKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgLy9uYXZjb24uZGVsZXRlRGF0YUxpc3Qob3B0aW9uYWwudGFibGUsIG9wdGlvbmFsLmZpZWxkcy5zZWxlY3RlZFJvdyk7XHJcbiAgICAgICAgICAgICAgICAgICAgbmF2Y29uLm9wZW5Nb2RhbChvcHRpb25hbC50eXBlICsgXCJkZWxldGVcIik7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGlmIChjYWxsYmFjayAhPT0gdW5kZWZpbmVkKSBjYWxsYmFjayhhZGRlZEl0ZW0pO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gYWRkZWRJdGVtO1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIGlmIChvcHRpb25hbC5maWVsZHMgIT09IHVuZGVmaW5lZCAmJiBvcHRpb25hbC5maWVsZHMgIT09IFwiXCIpIG5hdmNvbi5jbGVhckZpZWxkc0RhdGEob3B0aW9uYWwuZmllbGRzKTtcclxuICAgICAgICAgICAgICAgIGlmIChvcHRpb25hbC5wb3B1cCA9PT0gdW5kZWZpbmVkIHx8IG9wdGlvbmFsLnBvcHVwID09PSBcIlwiIHx8IG9wdGlvbmFsLnBvcHVwID09PSBmYWxzZSkgbmF2Y29uLmNsb3NlTW9kYWwob3B0aW9uYWwudHlwZSk7XHJcblxyXG4gICAgICAgICAgICAgICAgaWYgKGNhbGxiYWNrICE9PSB1bmRlZmluZWQpIGNhbGxiYWNrKGFkZGVkSXRlbSk7XHJcblxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGFkZGVkSXRlbTtcclxuICAgICAgICAgICAgfSBlbHNlIGlmIChvcHRpb25hbC5maWVsZHMubW9kZS50b1VwcGVyQ2FzZSgpID09PSBcIkRFTEVURURcIikge1xyXG4gICAgICAgICAgICAgICAgbmF2Y29uLmRlbGV0ZURhdGFMaXN0KG9wdGlvbmFsLnRhYmxlLCBvcHRpb25hbC5maWVsZHMuc2VsZWN0ZWRSb3cpO1xyXG4gICAgICAgICAgICAgICAgLy9vcHRpb25hbC50YWJsZS5kYXRhLnNwbGljZShvcHRpb25hbC5maWVsZHMuc2VsZWN0ZWRSb3csIDEpO1xyXG5cclxuICAgICAgICAgICAgICAgIG5hdmNvbi5jbG9zZU1vZGFsKG9wdGlvbmFsLnR5cGUgKyBcImRlbGV0ZVwiKTtcclxuICAgICAgICAgICAgICAgIG5hdmNvbi5jbG9zZU1vZGFsKG9wdGlvbmFsLnR5cGUpO1xyXG5cclxuICAgICAgICAgICAgICAgIGlmIChjYWxsYmFjayAhPT0gdW5kZWZpbmVkKSBjYWxsYmFjayhhZGRlZEl0ZW0pO1xyXG5cclxuICAgICAgICAgICAgICAgIHJldHVybiBhZGRlZEl0ZW07XHJcbiAgICAgICAgICAgIH0gZWxzZSBpZiAob3B0aW9uYWwuZmllbGRzLm1vZGUudG9VcHBlckNhc2UoKSA9PT0gXCJUQUJMRVNBVkVcIikge1xyXG4gICAgICAgICAgICAgICAgdmFyIHJldHVybkRhdGEgPSBbXTtcclxuICAgICAgICAgICAgICAgIHZhciB0YWJsZURhdGEgPSBvcHRpb25hbC50YWJsZS5kYXRhICE9PSB1bmRlZmluZWQgJiYgb3B0aW9uYWwudGFibGUuZGF0YSAhPT0gbnVsbCA/IG9wdGlvbmFsLnRhYmxlLmRhdGEgOiBbXTtcclxuICAgICAgICAgICAgICAgIHZhciB0YWJsZU9sZERhdGEgPSBvcHRpb25hbC50YWJsZS5vbGREYXRhICE9PSB1bmRlZmluZWQgJiYgb3B0aW9uYWwudGFibGUub2xkRGF0YSAhPT0gbnVsbCA/IG9wdGlvbmFsLnRhYmxlLm9sZERhdGEgOiBbXTtcclxuXHJcbiAgICAgICAgICAgICAgICBpZiAodGFibGVEYXRhICE9PSB1bmRlZmluZWQgJiYgdGFibGVEYXRhICE9PSBudWxsICYmIHRhYmxlRGF0YS5sZW5ndGggIT09IDApIHtcclxuICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHRhYmxlRGF0YS5sZW5ndGg7IGkrKykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAodGFibGVEYXRhW2ldW3RhYmxlRGF0YVtpXS5DaGVja19GaWVsZF0gIT09IHVuZGVmaW5lZCAmJiAodGFibGVEYXRhW2ldW3RhYmxlRGF0YVtpXS5DaGVja19GaWVsZF0gPT09IDEgfHwgdGFibGVEYXRhW2ldW3RhYmxlRGF0YVtpXS5DaGVja19GaWVsZF0gPT09IHRydWUpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodGFibGVEYXRhW2ldW29wdGlvbmFsLnByaW1hcnlDb2x1bW5dICE9PSB1bmRlZmluZWQgJiYgdGFibGVEYXRhW2ldW29wdGlvbmFsLnByaW1hcnlDb2x1bW5dICE9PSBudWxsICYmIHRhYmxlRGF0YVtpXVtvcHRpb25hbC5wcmltYXJ5Q29sdW1uXS50b1N0cmluZygpICE9PSBcIjBcIikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRhYmxlRGF0YVtpXVtcIk9iamVjdFN0YXRlXCJdID0gMjtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0YWJsZURhdGFbaV1bXCJTdGF0dXNcIl0gPSAwO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0YWJsZURhdGFbaV1bXCJPYmplY3RTdGF0ZVwiXSA9IDE7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGFibGVEYXRhW2ldW1wiU3RhdHVzXCJdID0gMDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAob3B0aW9uYWwuc2F2ZURhdGFJbmNsdWRlICE9PSB1bmRlZmluZWQgJiYgb3B0aW9uYWwuc2F2ZURhdGFJbmNsdWRlLmxlbmd0aCAhPT0gMCAmJiBvcHRpb25hbC5zYXZlRGF0YUluY2x1ZGUgIT09IFwiXCIpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJC5leHRlbmQodHJ1ZSwgdGFibGVEYXRhW2ldLCBvcHRpb25hbC5zYXZlRGF0YUluY2x1ZGUpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybkRhdGEucHVzaCh0YWJsZURhdGFbaV0pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKG9wdGlvbmFsLm5vQ2hlY2tlZERhdGEpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChvcHRpb25hbC5zYXZlRGF0YUluY2x1ZGUgIT09IHVuZGVmaW5lZCAmJiBvcHRpb25hbC5zYXZlRGF0YUluY2x1ZGUubGVuZ3RoICE9PSAwICYmIG9wdGlvbmFsLnNhdmVEYXRhSW5jbHVkZSAhPT0gXCJcIilcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkLmV4dGVuZCh0cnVlLCB0YWJsZURhdGFbaV0sIG9wdGlvbmFsLnNhdmVEYXRhSW5jbHVkZSk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuRGF0YS5wdXNoKHRhYmxlRGF0YVtpXSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGlmIChyZXR1cm5EYXRhLmxlbmd0aCA+IDAgJiYgb3B0aW9uYWwuZGF0YXNlcnZpY2UgIT09IHVuZGVmaW5lZCAmJiBvcHRpb25hbC5kYXRhc2VydmljZSAhPT0gbnVsbCAmJiBvcHRpb25hbC5kYXRhc2VydmljZSAhPT0gXCJcIikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm5EYXRhID0gb3B0aW9uYWwuZGF0YXNlcnZpY2UucG9zdFNlcnZlckRhdGEob3B0aW9uYWwudHlwZSArIG9wdGlvbmFsLnNhdmVUeXBlLCByZXR1cm5EYXRhKS50aGVuKGZ1bmN0aW9uIChkYXRhKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAob3B0aW9uYWwuYXNzaWduVGFibGUgIT09IHVuZGVmaW5lZCAmJiBvcHRpb25hbC5hc3NpZ25UYWJsZSAhPT0gbnVsbCAmJiBvcHRpb25hbC5hc3NpZ25UYWJsZSAhPT0gXCJcIikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9wdGlvbmFsLmFzc2lnblRhYmxlLmRhdGEgPSBbXTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvcHRpb25hbC5hc3NpZ25UYWJsZS5kYXRhID0gKHR5cGVvZiBkYXRhID09PSBcIm9iamVjdFwiICYmIGRhdGEubGVuZ3RoICE9PSAwID8gZGF0YSA6IFtdKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoY2FsbGJhY2sgIT09IHVuZGVmaW5lZCkgY2FsbGJhY2sodHlwZW9mIGRhdGEgPT09IFwib2JqZWN0XCIgJiYgZGF0YS5sZW5ndGggIT09IDAgPyBkYXRhIDogW10pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHJldHVybkRhdGEubGVuZ3RoID4gMCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoY2FsbGJhY2sgIT09IHVuZGVmaW5lZCkgY2FsbGJhY2socmV0dXJuRGF0YSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIGlmICgkKFwiI1wiICsgb3B0aW9uYWwudHlwZSkuZGF0YSgnbW9kYWwnKSAmJiAkKFwiI1wiICsgb3B0aW9uYWwudHlwZSkuZGF0YSgnbW9kYWwnKS5pc1Nob3duKSBuYXZjb24uY2xvc2VNb2RhbChvcHRpb25hbC50eXBlKTtcclxuICAgICAgICAgICAgfSBlbHNlIGlmIChvcHRpb25hbC5maWVsZHMubW9kZS50b1VwcGVyQ2FzZSgpID09PSBcIkZJTkFMXCIpIHtcclxuICAgICAgICAgICAgICAgIHZhciBqc29uZGF0YSA9IFtdO1xyXG5cclxuICAgICAgICAgICAgICAgIHZhciB0YWJsZURhdGEgPSBvcHRpb25hbC50YWJsZS5kYXRhICE9PSB1bmRlZmluZWQgJiYgb3B0aW9uYWwudGFibGUuZGF0YSAhPT0gbnVsbCA/IG9wdGlvbmFsLnRhYmxlLmRhdGEgOiBbXTtcclxuICAgICAgICAgICAgICAgIHZhciB0YWJsZU9sZERhdGEgPSBvcHRpb25hbC50YWJsZS5vbGREYXRhICE9PSB1bmRlZmluZWQgJiYgb3B0aW9uYWwudGFibGUub2xkRGF0YSAhPT0gbnVsbCA/IG9wdGlvbmFsLnRhYmxlLm9sZERhdGEgOiBbXTtcclxuXHJcbiAgICAgICAgICAgICAgICB2YXIgdGFibGVEYXRhID0gbmF2Y29uLmluc2VydERlbGV0ZWRpdGVtcyh0YWJsZURhdGEsIHRhYmxlT2xkRGF0YSwgb3B0aW9uYWwucHJpbWFyeUNvbHVtbiwgXCJ0YWJsZVwiKTtcclxuICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdGFibGVEYXRhLmxlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHRhYmxlRGF0YVtpXVtvcHRpb25hbC5wcmltYXJ5Q29sdW1uXSA+IDApIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRhYmxlRGF0YVtpXS5PYmplY3RTdGF0ZSA9PT0gdW5kZWZpbmVkIHx8IHRhYmxlRGF0YVtpXS5PYmplY3RTdGF0ZS50b1N0cmluZygpID09PSBcIjBcIikgdGFibGVEYXRhW2ldLk9iamVjdFN0YXRlID0gMjtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRhYmxlRGF0YVtpXS5TdGF0dXMgPT09IHVuZGVmaW5lZCB8fCB0YWJsZURhdGFbaV0uU3RhdHVzLnRvU3RyaW5nKCkgPT09IFwiMFwiKSB0YWJsZURhdGFbaV0uU3RhdHVzID0gMDtcclxuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAodGFibGVEYXRhW2ldLk9iamVjdFN0YXRlID09PSB1bmRlZmluZWQgfHwgdGFibGVEYXRhW2ldLk9iamVjdFN0YXRlLnRvU3RyaW5nKCkgPT09IFwiMFwiKSB0YWJsZURhdGFbaV0uT2JqZWN0U3RhdGUgPSAxO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAodGFibGVEYXRhW2ldLlN0YXR1cyA9PT0gdW5kZWZpbmVkIHx8IHRhYmxlRGF0YVtpXS5TdGF0dXMudG9TdHJpbmcoKSA9PT0gXCIwXCIpIHRhYmxlRGF0YVtpXS5TdGF0dXMgPSAwO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICBpZiAodGFibGVEYXRhLmxlbmd0aCA+IDAgJiYgb3B0aW9uYWwuZGF0YXNlcnZpY2UgIT09IHVuZGVmaW5lZCAmJiBvcHRpb25hbC5kYXRhc2VydmljZSAhPT0gbnVsbCAmJiBvcHRpb25hbC5kYXRhc2VydmljZSAhPT0gXCJcIikge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChvcHRpb25hbC5zYXZlVHlwZS50b0xvd2VyQ2FzZSgpID09PSBcInVwZGF0ZVwiIHx8IG9wdGlvbmFsLnNhdmVUeXBlLnRvTG93ZXJDYXNlKCkgPT09IFwidXBkYXRlYWxsXCIpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuRGF0YSA9IG9wdGlvbmFsLmRhdGFzZXJ2aWNlLnB1dFNlcnZlckRhdGEob3B0aW9uYWwudHlwZSArIG9wdGlvbmFsLnNhdmVUeXBlLCB0YWJsZURhdGEpLnRoZW4oZnVuY3Rpb24gKGRhdGEpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9wdGlvbmFsLnRhYmxlLmRhdGEgPSBbXTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9wdGlvbmFsLnRhYmxlLmRhdGEgPSBkYXRhO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChjYWxsYmFjayAhPT0gdW5kZWZpbmVkKSBjYWxsYmFjayhkYXRhKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuRGF0YSA9IG9wdGlvbmFsLmRhdGFzZXJ2aWNlLnBvc3RTZXJ2ZXJEYXRhKG9wdGlvbmFsLnR5cGUgKyBvcHRpb25hbC5zYXZlVHlwZSwgdGFibGVEYXRhKS50aGVuKGZ1bmN0aW9uIChkYXRhKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBvcHRpb25hbC50YWJsZS5kYXRhID0gW107XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBvcHRpb25hbC50YWJsZS5kYXRhID0gZGF0YTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoY2FsbGJhY2sgIT09IHVuZGVmaW5lZCkgY2FsbGJhY2soZGF0YSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAodGFibGVEYXRhICE9PSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoY2FsbGJhY2sgIT09IHVuZGVmaW5lZCkgY2FsbGJhY2sodGFibGVEYXRhKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0sXHJcbiAgICAgICAgc2F2ZU9wdGlvbjogZnVuY3Rpb24gKHNjb3BlLCBkYXRhc2VydmljZSwgbW9kZSwgdHlwZSwgdGFibGUsIGZpZWxkcywgcm93TnVtYmVyLCBpZENvbHVtbiwgZGlzcGxheUNvbHVtbiwgdHJlZVRhYmxlLCB1cGxvYWQsIHBvcHVwLCBzYXZlVHlwZSwgY2FsbGJhY2spIHtcclxuICAgICAgICAgICAgaWYgKG1vZGUgPT09IHVuZGVmaW5lZCB8fCBtb2RlID09PSBcIlwiKSByZXR1cm47XHJcbiAgICAgICAgICAgIHZhciByZXR1cm5EYXRhID0gXCJcIjtcclxuICAgICAgICAgICAgaWYgKG1vZGUudG9VcHBlckNhc2UoKSA9PT0gXCJTQVZFXCIgfHwgbW9kZS50b1VwcGVyQ2FzZSgpID09PSBcIlNBVkVBU1wiIHx8IG1vZGUudG9VcHBlckNhc2UoKSA9PT0gXCJVUERBVEVcIikgeyAvL0Zvcm0gRGF0YSB1cGRhdGVcclxuICAgICAgICAgICAgICAgIHZhciBhZGRlZEl0ZW0gPSBuYXZjb24uZ2V0RmllbGRzRGF0YVRvU2F2ZShmaWVsZHMsIG1vZGUsIGlkQ29sdW1uLCB1cGxvYWQpO1xyXG5cclxuICAgICAgICAgICAgICAgIGlmIChtb2RlLnRvVXBwZXJDYXNlKCkgPT09IFwiU0FWRVwiIHx8IG1vZGUudG9VcHBlckNhc2UoKSA9PT0gXCJTQVZFQVNcIikge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChhZGRlZEl0ZW0uT2JqZWN0U3RhdGUgIT09IHVuZGVmaW5lZCAmJiAoYWRkZWRJdGVtLk9iamVjdFN0YXRlID09PSBcIjBcIiB8fCBhZGRlZEl0ZW0uT2JqZWN0U3RhdGUgPT09IFwiXCIpKSBhZGRlZEl0ZW0uT2JqZWN0U3RhdGUgPSAxO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChhZGRlZEl0ZW0uU3RhdHVzICE9PSB1bmRlZmluZWQgJiYgKGFkZGVkSXRlbS5TdGF0dXMgPT09IFwiMFwiIHx8IGFkZGVkSXRlbS5TdGF0dXMgPT09IFwiXCIpKSBhZGRlZEl0ZW0uU3RhdHVzID0gMDtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHNhdmVUeXBlID09PSB1bmRlZmluZWQgfHwgc2F2ZVR5cGUgPT09IFwiXCIpIHNhdmVUeXBlID0gdHlwZTtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm5EYXRhID0gZGF0YXNlcnZpY2UucG9zdFNlcnZlckRhdGEoc2F2ZVR5cGUgKyBtb2RlICsgKGZpZWxkcy5wYWdlICE9PSB1bmRlZmluZWQgPyBcIi9cIiArIGZpZWxkcy5wYWdlIDogXCJcIiksIGFkZGVkSXRlbSkudGhlbihmdW5jdGlvbiAoZGF0YSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAodXBsb2FkICE9PSB1bmRlZmluZWQgJiYgdXBsb2FkICE9PSBcIlwiICYmIHVwbG9hZCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGRhdGEgIT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGNvbGxlY3REYXRhID0gZGF0YTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8qIHZhciBmaWxlRGF0YSA9IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZmlsZSAgOiBhZGRlZEl0ZW1bXCJmaWxlc1VwbG9hZFwiXVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0qL1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFxyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgZm9ybURhdGEgPSBhZGRlZEl0ZW1bXCJmaWxlc1VwbG9hZFwiXTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZWxldGUgYWRkZWRJdGVtW1wiZmlsZXNVcGxvYWRcIl07XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGRhdGFJbmZvID0ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb2xkZXI6IHR5cGUgfHwgc2F2ZVR5cGUsICAvLyBQYWdlIE5hbWVcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWQ6IGRhdGFbaWRDb2x1bW5dICAgLy8gUHJpbWFyeSBLZXlcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChmb3JtRGF0YSAhPSB1bmRlZmluZWQgJiYgZm9ybURhdGEgIT0gbnVsbCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3JtRGF0YS5hcHBlbmQoXCJkYXRhXCIsIEpTT04uc3RyaW5naWZ5KGRhdGFJbmZvKSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRhdGFzZXJ2aWNlLmZpbGVVcGxvYWQoZm9ybURhdGEpLnRoZW4oZnVuY3Rpb24gKHVwbG9hZERhdGEpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh1cGxvYWREYXRhICE9PSB1bmRlZmluZWQgJiYgdXBsb2FkRGF0YS5GaWxlcyAhPT0gdW5kZWZpbmVkICYmIHVwbG9hZERhdGEuRmlsZXMubGVuZ3RoICE9PSAwKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGNvbGxlY3REYXRhLkRvY3VtZW50TmFtZSAhPT0gdW5kZWZpbmVkKSBjb2xsZWN0RGF0YS5Eb2N1bWVudE5hbWUgPSB1cGxvYWREYXRhLkZpbGVzWzBdLm5hbWU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGNvbGxlY3REYXRhLkRvY3VtZW50cyAhPT0gdW5kZWZpbmVkKSBjb2xsZWN0RGF0YS5Eb2N1bWVudHMgPSB1cGxvYWREYXRhLkZpbGVzO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChjb2xsZWN0RGF0YVtcImZ1YXR0YWNobWVudHNcIl0gPT09IHVuZGVmaW5lZCB8fCBjb2xsZWN0RGF0YVtcImZ1YXR0YWNobWVudHNcIl0gPT09IG51bGwgfHwgY29sbGVjdERhdGFbXCJmdWF0dGFjaG1lbnRzXCJdID09PSBcIlwiKSBjb2xsZWN0RGF0YVtcImZ1YXR0YWNobWVudHNcIl0gPSBbXTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJC5lYWNoKHVwbG9hZERhdGEuRmlsZXMsIGZ1bmN0aW9uIChpbmRleCwgdmFsdWUpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29sbGVjdERhdGFbXCJmdWF0dGFjaG1lbnRzXCJdLnB1c2godmFsdWUpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHJldERhdGEgPSByZWZyZXNoU2F2ZWREYXRhKGNvbGxlY3REYXRhKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjbG9zZVBvcHVwKGNvbGxlY3REYXRhKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoY2FsbGJhY2sgIT09IHVuZGVmaW5lZClcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FsbGJhY2soY29sbGVjdERhdGEpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHJldERhdGEgPSByZWZyZXNoU2F2ZWREYXRhKGNvbGxlY3REYXRhKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjbG9zZVBvcHVwKGNvbGxlY3REYXRhKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoY2FsbGJhY2sgIT09IHVuZGVmaW5lZClcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FsbGJhY2soY29sbGVjdERhdGEpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGNhbGxiYWNrICE9PSB1bmRlZmluZWQpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYWxsYmFjayhjb2xsZWN0RGF0YSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHJldERhdGEgPSByZWZyZXNoU2F2ZWREYXRhKGRhdGEpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY2xvc2VQb3B1cChkYXRhKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChjYWxsYmFjayAhPT0gdW5kZWZpbmVkKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhbGxiYWNrKHJldERhdGEpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGZ1bmN0aW9uIHJlZnJlc2hTYXZlZERhdGEoZGF0YSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAvL2lmIChkYXRhLlRhYmxlRGF0YSAhPT0gdW5kZWZpbmVkICYmIGRhdGEuVGFibGVEYXRhICE9PSBudWxsKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vICAgIGlmIChkYXRhLlRhYmxlRGF0YS5sZW5ndGggPiAwKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vICAgICAgICBpZiAoZGF0YS5UYWJsZURhdGFbMF0uJHJlZiAhPSB1bmRlZmluZWQpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vICAgICAgICAgICAgdGFibGUuZGF0YS5wdXNoKGRhdGEpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyAgICAgICAgZWxzZVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyAgICAgICAgICAgIHRhYmxlLmRhdGEucHVzaChkYXRhLlRhYmxlRGF0YVswXSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gICAgZWxzZSBpZiAoZGF0YS5UYWJsZURhdGEuJHJlZiAhPSB1bmRlZmluZWQpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vICAgICAgICB0YWJsZS5kYXRhLnB1c2goZGF0YSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vICAgIGVsc2VcclxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gICAgICAgIHRhYmxlLmRhdGEucHVzaChkYXRhLlRhYmxlRGF0YSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoZGF0YSAhPT0gdW5kZWZpbmVkICYmIGRhdGEgIT09IG51bGwgJiYgdGFibGUgIT09IHVuZGVmaW5lZCAmJiB0YWJsZSAhPT0gbnVsbCAmJiB0YWJsZSAhPT0gXCJcIikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRhYmxlLmRhdGEgPT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGFibGUuZGF0YSA9IFtdO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGFibGUuZGF0YS5wdXNoKGRhdGEpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBkYXRhO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBlbHNlIGlmIChtb2RlLnRvVXBwZXJDYXNlKCkgPT09IFwiVVBEQVRFXCIpIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoYWRkZWRJdGVtLk9iamVjdFN0YXRlICE9PSB1bmRlZmluZWQgJiYgKGFkZGVkSXRlbS5PYmplY3RTdGF0ZSA9PT0gMCB8fCBhZGRlZEl0ZW0uT2JqZWN0U3RhdGUgPT09IFwiMFwiIHx8IGFkZGVkSXRlbS5PYmplY3RTdGF0ZSA9PT0gXCJcIikpIGFkZGVkSXRlbS5PYmplY3RTdGF0ZSA9IDI7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGFkZGVkSXRlbS5TdGF0dXMgIT09IHVuZGVmaW5lZCAmJiAoYWRkZWRJdGVtLlN0YXR1cyA9PT0gXCIwXCIgfHwgYWRkZWRJdGVtLlN0YXR1cyA9PT0gXCJcIikpIGFkZGVkSXRlbS5TdGF0dXMgPSAwO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICBpZiAoc2F2ZVR5cGUgPT09IHVuZGVmaW5lZCB8fCBzYXZlVHlwZSA9PT0gXCJcIikgc2F2ZVR5cGUgPSB0eXBlO1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybkRhdGEgPSBkYXRhc2VydmljZS5wdXRTZXJ2ZXJEYXRhKHNhdmVUeXBlICsgbW9kZSwgYWRkZWRJdGVtKS50aGVuKGZ1bmN0aW9uIChkYXRhKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vaWYgKHBvcHVwICE9PSB1bmRlZmluZWQgJiYgcG9wdXAgPT09IGZhbHNlKSByZXR1cm47XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh1cGxvYWQgIT09IHVuZGVmaW5lZCAmJiB1cGxvYWQgIT09IFwiXCIgJiYgdXBsb2FkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoZGF0YSAhPSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgY29sbGVjdERhdGEgPSBkYXRhO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBmb3JtRGF0YSA9IGFkZGVkSXRlbVtcImZpbGVzVXBsb2FkXCJdO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChmb3JtRGF0YSA9PSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9ybURhdGEgPSBuZXcgRm9ybURhdGEoKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGVsZXRlIGFkZGVkSXRlbVtcImZpbGVzVXBsb2FkXCJdO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBkYXRhSW5mbyA9IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9sZGVyOiB0eXBlIHx8IHNhdmVUeXBlLCAgLy8gUGFnZSBOYW1lXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlkOiBkYXRhW2lkQ29sdW1uXSAgIC8vIFByaW1hcnkgS2V5XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3JtRGF0YS5hcHBlbmQoXCJkYXRhXCIsIEpTT04uc3RyaW5naWZ5KGRhdGFJbmZvKSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGF0YXNlcnZpY2UuZmlsZVVwbG9hZChmb3JtRGF0YSkudGhlbihmdW5jdGlvbiAodXBsb2FkRGF0YSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodXBsb2FkRGF0YSAhPT0gdW5kZWZpbmVkICYmIHVwbG9hZERhdGEuRmlsZXMgIT09IHVuZGVmaW5lZCAmJiB1cGxvYWREYXRhLkZpbGVzLmxlbmd0aCAhPT0gMCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGNvbGxlY3REYXRhLkRvY3VtZW50TmFtZSAhPT0gdW5kZWZpbmVkKSBjb2xsZWN0RGF0YS5Eb2N1bWVudE5hbWUgPSB1cGxvYWREYXRhLkZpbGVzWzBdLm5hbWU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoY29sbGVjdERhdGEuRG9jdW1lbnRzICE9PSB1bmRlZmluZWQpIGNvbGxlY3REYXRhLkRvY3VtZW50cyA9IHVwbG9hZERhdGEuRmlsZXM7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoY29sbGVjdERhdGFbXCJmdWF0dGFjaG1lbnRzXCJdID09PSB1bmRlZmluZWQgfHwgY29sbGVjdERhdGFbXCJmdWF0dGFjaG1lbnRzXCJdID09PSBudWxsIHx8IGNvbGxlY3REYXRhW1wiZnVhdHRhY2htZW50c1wiXSA9PT0gXCJcIikgY29sbGVjdERhdGFbXCJmdWF0dGFjaG1lbnRzXCJdID0gW107XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkLmVhY2godXBsb2FkRGF0YS5GaWxlcywgZnVuY3Rpb24gKGluZGV4LCB2YWx1ZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbGxlY3REYXRhW1wiZnVhdHRhY2htZW50c1wiXS5wdXNoKHZhbHVlKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjbG9zZVBvcHVwKGNvbGxlY3REYXRhKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChjYWxsYmFjayAhPT0gdW5kZWZpbmVkKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhbGxiYWNrKGNvbGxlY3REYXRhKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNsb3NlUG9wdXAoY29sbGVjdERhdGEpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGNhbGxiYWNrICE9PSB1bmRlZmluZWQpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FsbGJhY2soY29sbGVjdERhdGEpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vdmFyIHJldERhdGEgPSByZWZyZXNoU2F2ZWREYXRhKGNvbGxlY3REYXRhKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSB7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gdmFyIHJldERhdGEgPSByZWZyZXNoU2F2ZWREYXRhKGRhdGEpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY2xvc2VQb3B1cChkYXRhKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoY2FsbGJhY2sgIT09IHVuZGVmaW5lZClcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYWxsYmFjayhkYXRhKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2VcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZGF0YTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICBmdW5jdGlvbiByZWZyZXNoU2F2ZWREYXRhKGRhdGEpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgLy9pZiAoZGF0YS5UYWJsZURhdGEgIT09IHVuZGVmaW5lZCAmJiBkYXRhLlRhYmxlRGF0YSAhPT0gbnVsbCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyAgICBpZiAoZGF0YS5UYWJsZURhdGEubGVuZ3RoID4gMCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyAgICAgICAgaWYgKGRhdGEuVGFibGVEYXRhWzBdLiRyZWYgIT0gdW5kZWZpbmVkKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyAgICAgICAgICAgIHRhYmxlLmRhdGEucHVzaChkYXRhKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gICAgICAgIGVsc2VcclxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gICAgICAgICAgICB0YWJsZS5kYXRhLnB1c2goZGF0YS5UYWJsZURhdGFbMF0pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vICAgIGVsc2UgaWYgKGRhdGEuVGFibGVEYXRhLiRyZWYgIT0gdW5kZWZpbmVkKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyAgICAgICAgdGFibGUuZGF0YS5wdXNoKGRhdGEpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyAgICBlbHNlXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vICAgICAgICB0YWJsZS5kYXRhLnB1c2goZGF0YS5UYWJsZURhdGEpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAvL31cclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGRhdGEgIT09IHVuZGVmaW5lZCAmJiBkYXRhICE9PSBudWxsICYmIHRhYmxlICE9PSB1bmRlZmluZWQgJiYgdGFibGUgIT09IG51bGwgJiYgdGFibGUgIT09IFwiXCIpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0YWJsZS5kYXRhID09IHVuZGVmaW5lZCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRhYmxlLmRhdGEgPSBbXTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRhYmxlLmRhdGEucHVzaChkYXRhKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZGF0YTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgZnVuY3Rpb24gY2xvc2VQb3B1cChkYXRhKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGRhdGEgPT09IHVuZGVmaW5lZCkgcmV0dXJuO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChwb3B1cCAhPT0gdW5kZWZpbmVkICYmIHBvcHVwICE9PSBcIlwiICYmIHBvcHVwID09PSBmYWxzZSkgcmV0dXJuO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICB2YXIgaWRDb2x1bW5JbmRleCA9IG5hdmNvbi5nZXRJdGVtSW5kZXhCeVByb3BlcnR5KGZpZWxkcywgaWRDb2x1bW4pO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChpZENvbHVtbkluZGV4ICE9PSB1bmRlZmluZWQgJiYgaWRDb2x1bW5JbmRleCAhPT0gLTEpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHByaW1hcnlLZXkgPSBpZENvbHVtbjtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGZpZWxkc1tpZENvbHVtbkluZGV4XS5hbHRlcm5hdGVrZXkgIT09IHVuZGVmaW5lZCAmJiBmaWVsZHNbaWRDb2x1bW5JbmRleF0uYWx0ZXJuYXRla2V5ICE9PSBcIlwiKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJpbWFyeUtleSA9IGZpZWxkc1tpZENvbHVtbkluZGV4XS5hbHRlcm5hdGVrZXk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGZpZWxkc1tpZENvbHVtbkluZGV4XS5pZCAhPT0gdW5kZWZpbmVkKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHByaW1hcnlLZXkgPSBmaWVsZHNbaWRDb2x1bW5JbmRleF0uaWQ7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJpbWFyeUtleSA9IGZpZWxkc1tpZENvbHVtbkluZGV4XS5rZXk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0YWJsZSAhPT0gdW5kZWZpbmVkICYmIHRhYmxlICE9PSBudWxsICYmIGRhdGEgIT09IHVuZGVmaW5lZCAmJiB0YWJsZSAhPT0gXCJcIiAmJiB0YWJsZS5kYXRhICE9IHVuZGVmaW5lZCAmJiBkYXRhICE9PSBudWxsKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgaW5kZXggPSAtMTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGluZGV4ID0gbmF2Y29uLmdldEl0ZW1JbmRleEJ5S2V5VmFsdWUodGFibGUuZGF0YSwgcHJpbWFyeUtleSwgZGF0YVtwcmltYXJ5S2V5XSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoaW5kZXggIT09IC0xKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy90YWJsZS5kYXRhLnNwbGljZShpbmRleCwgMSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy90YWJsZS5kYXRhLnB1c2goZGF0YSk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRhYmxlLmRhdGEuc3BsaWNlKGluZGV4LCAxLCBkYXRhKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHRyZWVUYWJsZSAhPT0gdW5kZWZpbmVkICYmIHRyZWVUYWJsZSAhPT0gXCJcIiAmJiB0cmVlVGFibGUubGVuZ3RoID4gMCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBuYXZjb24uY2xlYXJUcmVlRGF0YSh0cmVlVGFibGUpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBpZiAoaWRDb2x1bW5JbmRleCAhPSAtMSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgbmF2Y29uLmNsZWFyRmllbGRzRGF0YShmaWVsZHMpO1xyXG4gICAgICAgICAgICAgICAgICAgIG5hdmNvbi5jbG9zZU1vZGFsKHR5cGUpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZSBpZiAobW9kZS50b1VwcGVyQ2FzZSgpID09PSBcIk9LXCIpIHsgLy9PSyBCdXR0b24gdXBkYXRlXHJcbiAgICAgICAgICAgICAgICB2YXIgYWRkZWRJdGVtID0gbmF2Y29uLmdldEZpZWxkc0RhdGFUb1NhdmUoZmllbGRzLCBtb2RlLCBpZENvbHVtbik7XHJcblxyXG4gICAgICAgICAgICAgICAgdmFyIGluZGV4ID0gbmF2Y29uLmdldEl0ZW1JbmRleEJ5S2V5VmFsdWUodGFibGUuZGF0YSwgaWRDb2x1bW4sIGFkZGVkSXRlbVtpZENvbHVtbl0pO1xyXG4gICAgICAgICAgICAgICAgaWYgKGluZGV4ID4gLTEpIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoYWRkZWRJdGVtLk9iamVjdFN0YXRlICE9PSB1bmRlZmluZWQpIGFkZGVkSXRlbS5PYmplY3RTdGF0ZSA9IDI7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGFkZGVkSXRlbS5TdGF0dXMgIT09IHVuZGVmaW5lZCkgYWRkZWRJdGVtLlN0YXR1cyA9IDA7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIHRhYmxlLmRhdGEuc3BsaWNlKGluZGV4LCAxKTtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoYWRkZWRJdGVtICE9PSB1bmRlZmluZWQpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRhYmxlLmRhdGEucHVzaChhZGRlZEl0ZW0pO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGFkZGVkSXRlbS5PYmplY3RTdGF0ZSAhPT0gdW5kZWZpbmVkKSBhZGRlZEl0ZW0uT2JqZWN0U3RhdGUgPSAxO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChhZGRlZEl0ZW0uU3RhdHVzICE9PSB1bmRlZmluZWQpIGFkZGVkSXRlbS5TdGF0dXMgPSAwO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICBhZGRlZEl0ZW1baWRDb2x1bW5dID0gcGFyc2VGbG9hdChhZGRlZEl0ZW1baWRDb2x1bW5dKSArIDE7XHJcbiAgICAgICAgICAgICAgICAgICAgdGFibGUuZGF0YS5wdXNoKGFkZGVkSXRlbSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAvL25hdmNvbi5jbGVhclRhYmxlRGF0YSh0eXBlLCB1cGRhdGVGaWVsZHMpXHJcbiAgICAgICAgICAgICAgICAvL3VwZGF0ZUZpZWxkcy5kYXRhPXRhYmxlLmRhdGE7XHJcblxyXG4gICAgICAgICAgICAgICAgbmF2Y29uLmNsb3NlTW9kYWwodHlwZSk7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gdGFibGUuZGF0YTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBlbHNlIGlmIChtb2RlLnRvVXBwZXJDYXNlKCkgPT09IFwiREVMRVRFXCIpIHsgLy9EZWxldGUgTW9kYWwgT3BlblxyXG4gICAgICAgICAgICAgICAgdmFyIGN1cnJlbnRUYWJsZUl0ZW0gPSBuYXZjb24uZ2V0RmllbGRzRGF0YVRvU2F2ZShmaWVsZHMsIG1vZGUsIGlkQ29sdW1uKTtcclxuICAgICAgICAgICAgICAgIC8vdmFyIGN1cnJlbnRUYWJsZUl0ZW0gPSB0YWJsZS5kYXRhW3Jvd051bWJlcl07XHJcblxyXG4gICAgICAgICAgICAgICAgaWYgKGRpc3BsYXlDb2x1bW4uaW5kZXhPZihcIi5cIikgPiAwKVxyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybkRhdGEgPSBcIkRlbGV0ZSAoIFwiICsgY3VycmVudFRhYmxlSXRlbVtkaXNwbGF5Q29sdW1uLnNwbGl0KCcuJylbMF1dW2Rpc3BsYXlDb2x1bW4uc3BsaXQoJy4nKVsxXV0gKyBcIiApXCI7XHJcbiAgICAgICAgICAgICAgICBlbHNlXHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuRGF0YSA9IFwiRGVsZXRlICggXCIgKyBjdXJyZW50VGFibGVJdGVtW2Rpc3BsYXlDb2x1bW5dICsgXCIgKVwiO1xyXG5cclxuICAgICAgICAgICAgICAgIGZvciAodmFyIGtleSBpbiBmaWVsZHMpIHtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgZmllbGQgPSBmaWVsZHNba2V5XTtcclxuICAgICAgICAgICAgICAgICAgICBmaWVsZC5kaXNhYmxlZCA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgdHlwZSA9IHR5cGUgKyBcImRlbGV0ZVwiO1xyXG4gICAgICAgICAgICAgICAgbmF2Y29uLm9wZW5Nb2RhbCh0eXBlKTtcclxuXHJcbiAgICAgICAgICAgICAgICBpZiAoY2FsbGJhY2sgIT09IHVuZGVmaW5lZCkgY2FsbGJhY2socmV0dXJuRGF0YSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZSBpZiAobW9kZS50b1VwcGVyQ2FzZSgpID09PSBcIlBSSU5UXCIpIHsgLy9QUklOVCBNb2RhbCBPcGVuXHJcbiAgICAgICAgICAgICAgICByZXR1cm5EYXRhID0gXCJcIjtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgcmV0dXJuIHJldHVybkRhdGE7XHJcbiAgICAgICAgfSxcclxuICAgICAgICB2aWV3T3B0aW9uOiBmdW5jdGlvbiAoc2NvcGUsIGFjdGlvbiwgdHlwZSwgdGFibGUsIGZpZWxkcywgc2VsZWN0ZWRSb3csIGlkQ29sdW1uLCBkaXNwbGF5Q29sdW1uLCBkYXRhc2VydmljZSwgZGlyZWN0Q2FsbCwgY2FsbGJhY2ssIGFkZHRpb25hbElkLCBwb3B1cCwgZGlyZWN0VXJsKSB7IC8vVmlldyBmb3JtIFxyXG4gICAgICAgICAgICBpZiAoZGlyZWN0Q2FsbCAhPT0gdW5kZWZpbmVkICYmIGRpcmVjdENhbGwpIHtcclxuICAgICAgICAgICAgICAgIGlmIChkaXJlY3RVcmwgPT09IHVuZGVmaW5lZCB8fCBkaXJlY3RVcmwgPT09IFwiXCIpXHJcbiAgICAgICAgICAgICAgICAgICAgdXJsID0gdHlwZSArICcvR2V0QnlJZCc7XHJcbiAgICAgICAgICAgICAgICBlbHNlXHJcbiAgICAgICAgICAgICAgICAgICAgdXJsID0gZGlyZWN0VXJsO1xyXG5cclxuICAgICAgICAgICAgICAgIHZhciBkYXRhID0gZGF0YXNlcnZpY2UuZ2V0RGF0YSh1cmwgKyBcIi9cIiArIHNlbGVjdGVkUm93W2lkQ29sdW1uXSArIChhZGR0aW9uYWxJZCAhPSB1bmRlZmluZWQgJiYgYWRkdGlvbmFsSWQgIT0gXCJcIiA/IFwiL1wiICsgYWRkdGlvbmFsSWQgOiBcIlwiKSkudGhlbihmdW5jdGlvbiAoZGF0YSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciByZXREYXRhID0gdXBkYXRlZGF0YShkYXRhKTtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoY2FsbGJhY2sgIT09IHVuZGVmaW5lZClcclxuICAgICAgICAgICAgICAgICAgICAgICAgY2FsbGJhY2socmV0RGF0YSk7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgIHZhciBjdXJyZW50VGFibGVJdGVtID0gbmF2Y29uLmdldEl0ZW1CeUtleVZhbHVlKHRhYmxlLmRhdGEsIGlkQ29sdW1uLCBzZWxlY3RlZFJvd1tpZENvbHVtbl0pO1xyXG4gICAgICAgICAgICAgICAgdmFyIHJldERhdGEgPSB1cGRhdGVkYXRhKGN1cnJlbnRUYWJsZUl0ZW0pO1xyXG4gICAgICAgICAgICAgICAgaWYgKGNhbGxiYWNrICE9PSB1bmRlZmluZWQpXHJcbiAgICAgICAgICAgICAgICAgICAgY2FsbGJhY2socmV0RGF0YSk7XHJcbiAgICAgICAgICAgICAgICBlbHNlXHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJldERhdGE7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZnVuY3Rpb24gdXBkYXRlZGF0YShjdXJyZW50VGFibGVJdGVtKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgcmV0dXJuRGF0YSA9IFwiXCI7XHJcbiAgICAgICAgICAgICAgICBpZiAoY3VycmVudFRhYmxlSXRlbSAhPT0gLTEpIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoZGlzcGxheUNvbHVtbi5pbmRleE9mKFwiLlwiKSA+IDApXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybkRhdGEgPSBhY3Rpb24uc3Vic3RyKDAsIDEpLnRvVXBwZXJDYXNlKCkgKyBhY3Rpb24uc3Vic3RyKDEpICsgXCIgKCBcIiArIGN1cnJlbnRUYWJsZUl0ZW1bZGlzcGxheUNvbHVtbi5zcGxpdCgnLicpWzBdXVtkaXNwbGF5Q29sdW1uLnNwbGl0KCcuJylbMV1dICsgXCIgKVwiO1xyXG4gICAgICAgICAgICAgICAgICAgIGVsc2VcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuRGF0YSA9IGFjdGlvbi5zdWJzdHIoMCwgMSkudG9VcHBlckNhc2UoKSArIGFjdGlvbi5zdWJzdHIoMSkgKyBcIiAoIFwiICsgY3VycmVudFRhYmxlSXRlbVtkaXNwbGF5Q29sdW1uXSArIFwiIClcIjtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGVsc2UgaWYgKHNlbGVjdGVkUm93LmRhdGEgIT09IHVuZGVmaW5lZCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybkRhdGEgPSBhY3Rpb24uc3Vic3RyKDAsIDEpLnRvVXBwZXJDYXNlKCkgKyBhY3Rpb24uc3Vic3RyKDEpICsgXCIgKCBcIiArIHNlbGVjdGVkUm93LmRhdGFbZGlzcGxheUNvbHVtbl0gKyBcIilcIjtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgY3VycmVudFRhYmxlSXRlbSA9IHNlbGVjdGVkUm93LmRhdGE7XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgdmFyIGlzRGlzYWJsZWQgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgIGlmIChhY3Rpb24udG9VcHBlckNhc2UoKSAhPT0gXCJFRElUXCIgJiYgYWN0aW9uLnRvVXBwZXJDYXNlKCkgIT09IFwiTUFOQUdFXCIpIGlzRGlzYWJsZWQgPSB0cnVlO1xyXG5cclxuICAgICAgICAgICAgICAgIG5hdmNvbi51cGRhdGVGaWVsZHNEYXRhKGZpZWxkcywgY3VycmVudFRhYmxlSXRlbSwgc2NvcGUsIGlzRGlzYWJsZWQsIHNjb3BlLnZtKTtcclxuICAgICAgICAgICAgICAgIG5hdmNvbi5zZXRWaWV3Q29udGVudERpc2FibGVkKGFjdGlvbik7XHJcblxyXG4gICAgICAgICAgICAgICAgZmllbGRzLmdldEJ5SWQgPSBjdXJyZW50VGFibGVJdGVtO1xyXG5cclxuICAgICAgICAgICAgICAgIGlmICh0eXBlLnRvTG93ZXJDYXNlKCkgPT09IFwiYXBwcm92YWxcIikgcmV0dXJuIHJldHVybkRhdGE7XHJcblxyXG5cclxuICAgICAgICAgICAgICAgIGlmIChwb3B1cCAhPT0gdW5kZWZpbmVkICYmIHBvcHVwICE9PSBudWxsICYmIHBvcHVwICE9PSBcIlwiKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHBvcHVwICE9PSBmYWxzZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBuYXZjb24ub3Blbk1vZGFsKHBvcHVwLCBmdW5jdGlvbiAodmFsKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoYWN0aW9uLnRvVXBwZXJDYXNlKCkgPT09IFwiRURJVFwiKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5hdmNvbi5zZXRGaWVsZEZvY3VzKGZpZWxkcyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgbmF2Y29uLm9wZW5Nb2RhbCh0eXBlLCBmdW5jdGlvbiAodmFsKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChhY3Rpb24udG9VcHBlckNhc2UoKSA9PT0gXCJFRElUXCIpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBuYXZjb24uc2V0RmllbGRGb2N1cyhmaWVsZHMpO1xyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHJldHVybkRhdGE7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9LFxyXG4gICAgICAgIGRlbGV0ZU9wdGlvbjogZnVuY3Rpb24gKGRhdGFzZXJ2aWNlLCB0eXBlLCB0YWJsZSwgUm93TnVtYmVyLCBwcmltYXJ5S2V5LCBzYXZlVHlwZSwgY2FsbGJhY2ssIGlzVGFibGVSZW1vdmUpIHsgLy9EZWxldGUgZXZlbnQgdXBkYXRlXHJcbiAgICAgICAgICAgIHZhciByZXR1cm5EYXRhID0gXCJcIjtcclxuICAgICAgICAgICAgaWYgKHNhdmVUeXBlID09PSB1bmRlZmluZWQgfHwgc2F2ZVR5cGUgPT09IFwiXCIpIHNhdmVUeXBlID0gdHlwZTtcclxuXHJcbiAgICAgICAgICAgIHJldHVybkRhdGEgPSBkYXRhc2VydmljZS5kZWxldGVTZXJ2ZXJEYXRhKHNhdmVUeXBlICsgJ0RlbGV0ZScsIHRhYmxlLmRhdGFbUm93TnVtYmVyXVtwcmltYXJ5S2V5XSkudGhlbihmdW5jdGlvbiAoZGF0YSkge1xyXG4gICAgICAgICAgICAgICAgaWYgKGRhdGEgIT09IHVuZGVmaW5lZCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChpc1RhYmxlUmVtb3ZlICE9PSB1bmRlZmluZWQgJiYgaXNUYWJsZVJlbW92ZSAhPT0gbnVsbCAmJiBpc1RhYmxlUmVtb3ZlID09IGZhbHNlKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAvL25hdmNvbi5kZWxldGVEYXRhTGlzdCh0YWJsZSwgUm93TnVtYmVyKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coXCJubyB0YWJsZSBkZWxldGVcIik7XHJcbiAgICAgICAgICAgICAgICAgICAgZWxzZVxyXG4gICAgICAgICAgICAgICAgICAgICAgICBuYXZjb24uZGVsZXRlRGF0YUxpc3QodGFibGUsIFJvd051bWJlcik7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBjbG9zZU1vZGFsKGRhdGEpO1xyXG5cclxuICAgICAgICAgICAgICAgIGlmIChjYWxsYmFjayAhPT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgY2FsbGJhY2soZGF0YSk7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBkYXRhO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgIGZ1bmN0aW9uIGNsb3NlTW9kYWwoZGF0YSkge1xyXG4gICAgICAgICAgICAgICAgaWYgKCQoXCIjXCIgKyB0eXBlICsgXCJkZWxldGVcIikuZGF0YSgnbW9kYWwnKSAmJiAkKFwiI1wiICsgdHlwZSArIFwiZGVsZXRlXCIpLmRhdGEoJ21vZGFsJykuaXNTaG93bikgbmF2Y29uLmNsb3NlTW9kYWwodHlwZSArIFwiZGVsZXRlXCIpO1xyXG4gICAgICAgICAgICAgICAgaWYgKCQoXCIjXCIgKyB0eXBlKS5kYXRhKCdtb2RhbCcpICYmICQoXCIjXCIgKyB0eXBlKS5kYXRhKCdtb2RhbCcpLmlzU2hvd24pIG5hdmNvbi5jbG9zZU1vZGFsKHR5cGUpO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAvL3JldHVybiByZXR1cm5EYXRhO1xyXG4gICAgICAgIH0sXHJcbiAgICAgICAgdHJlZVZpZXc6IGZ1bmN0aW9uIChzY29wZSwgYWN0aW9uLCB0eXBlLCB0YWJsZSwgZmllbGRzLCBkaXNwbGF5Q29sdW1uLCBpZENvbHVtbiwgZGF0YXNlcnZpY2UsIGRpcmVjdENhbGwsIGNhbGxiYWNrKSB7XHJcbiAgICAgICAgICAgIGlmIChkaXJlY3RDYWxsICE9PSB1bmRlZmluZWQgJiYgZGlyZWN0Q2FsbCkge1xyXG4gICAgICAgICAgICAgICAgdmFyIGRhdGEgPSBkYXRhc2VydmljZS5nZXREYXRhKHR5cGUgKyAnL0dldEJ5SWQvJyArIHRhYmxlLmRhdGFbaWRDb2x1bW5dKS50aGVuKGZ1bmN0aW9uIChkYXRhKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIHJldERhdGEgPSB1cGRhdGVkYXRhKGRhdGEpO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChjYWxsYmFjayAhPT0gdW5kZWZpbmVkKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICBjYWxsYmFjayhyZXREYXRhKTtcclxuICAgICAgICAgICAgICAgICAgICBlbHNlXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiByZXREYXRhO1xyXG4gICAgICAgICAgICAgICAgICAgIC8vcmV0dXJuIGRhdGE7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIHZhciBjdXJyZW50VGFibGVJdGVtID0gdGFibGUuZGF0YTsvLyBuYXZjb24uZ2V0SXRlbUJ5S2V5VmFsdWUodGFibGUuZGF0YSwgaWRDb2x1bW4sIHRhYmxlLmRhdGFbaWRDb2x1bW5dKTtcclxuICAgICAgICAgICAgICAgIHJldHVybiB1cGRhdGVkYXRhKGN1cnJlbnRUYWJsZUl0ZW0pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGZ1bmN0aW9uIHVwZGF0ZWRhdGEoY3VycmVudFRhYmxlSXRlbSkge1xyXG4gICAgICAgICAgICAgICAgdmFyIHJldHVybkRhdGEgPSBcIlwiO1xyXG5cclxuICAgICAgICAgICAgICAgIGlmIChjdXJyZW50VGFibGVJdGVtLmRhdGEgIT09IHVuZGVmaW5lZCAmJiBjdXJyZW50VGFibGVJdGVtLmRhdGFbZGlzcGxheUNvbHVtbl0gIT09IHVuZGVmaW5lZClcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm5EYXRhID0gYWN0aW9uLnN1YnN0cigwLCAxKS50b1VwcGVyQ2FzZSgpICsgYWN0aW9uLnN1YnN0cigxKSArIFwiICggXCIgKyBjdXJyZW50VGFibGVJdGVtLmRhdGFbZGlzcGxheUNvbHVtbl0gKyBcIiApXCI7XHJcbiAgICAgICAgICAgICAgICBlbHNlXHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuRGF0YSA9IGFjdGlvbi5zdWJzdHIoMCwgMSkudG9VcHBlckNhc2UoKSArIGFjdGlvbi5zdWJzdHIoMSkgKyBcIiAoIFwiICsgY3VycmVudFRhYmxlSXRlbVtkaXNwbGF5Q29sdW1uXSArIFwiIClcIjtcclxuXHJcbiAgICAgICAgICAgICAgICB2YXIgaXNEaXNhYmxlZCA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgaWYgKGFjdGlvbi50b1VwcGVyQ2FzZSgpICE9PSBcIkVESVRcIiAmJiBhY3Rpb24udG9VcHBlckNhc2UoKSAhPT0gXCJNQU5BR0VcIikgaXNEaXNhYmxlZCA9IHRydWU7XHJcblxyXG4gICAgICAgICAgICAgICAgbmF2Y29uLmNsZWFyRmllbGRzRGF0YShmaWVsZHMsIHNjb3BlKTtcclxuICAgICAgICAgICAgICAgIG5hdmNvbi51cGRhdGVGaWVsZHNEYXRhKGZpZWxkcywgY3VycmVudFRhYmxlSXRlbSwgc2NvcGUsIGlzRGlzYWJsZWQsIHNjb3BlLnZtKTtcclxuICAgICAgICAgICAgICAgIG5hdmNvbi5zZXRWaWV3Q29udGVudERpc2FibGVkKGFjdGlvbik7XHJcblxyXG4gICAgICAgICAgICAgICAgZmllbGRzLmdldEJ5SWQgPSBjdXJyZW50VGFibGVJdGVtO1xyXG5cclxuICAgICAgICAgICAgICAgIG5hdmNvbi5vcGVuTW9kYWwodHlwZSwgZnVuY3Rpb24gKHZhbCkge1xyXG4gICAgICAgICAgICAgICAgICAgIG5hdmNvbi5zZXRGaWVsZEZvY3VzKGZpZWxkcyk7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgICAgICByZXR1cm4gcmV0dXJuRGF0YTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0sXHJcbiAgICAgICAgdHJlZURlbGV0ZUFjdGlvbjogZnVuY3Rpb24gKGRhdGFzZXJ2aWNlLCB0eXBlLCBjdXJyZW50Tm9kZSwgaWRDb2x1bW4sIGNhbGxiYWNrLCBoYXNQYXJlbnRSZW1vdmUpIHsgLy9UcmVlIGRlbGVlXHJcbiAgICAgICAgICAgIHZhciByZXR1cm5EYXRhID0gXCJcIjtcclxuICAgICAgICAgICAgdmFyIGN1cnJlbnRJZCA9IFwiMFwiO1xyXG4gICAgICAgICAgICBpZiAoY3VycmVudE5vZGUuZGF0YVtpZENvbHVtbl0gIT09IHVuZGVmaW5lZClcclxuICAgICAgICAgICAgICAgIGN1cnJlbnRJZCA9IGN1cnJlbnROb2RlLmRhdGFbaWRDb2x1bW5dO1xyXG4gICAgICAgICAgICBlbHNlXHJcbiAgICAgICAgICAgICAgICBjdXJyZW50SWQgPSBjdXJyZW50Tm9kZVtpZENvbHVtbl07XHJcblxyXG4gICAgICAgICAgICByZXR1cm5EYXRhID0gZGF0YXNlcnZpY2UuZGVsZXRlU2VydmVyRGF0YSh0eXBlICsgXCJEZWxldGVcIiwgY3VycmVudElkKS50aGVuKGZ1bmN0aW9uIChkYXRhKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoZGF0YSAhPT0gdW5kZWZpbmVkKVxyXG4gICAgICAgICAgICAgICAgICAgIG5hdmNvbi5yZW1vdmVUcmVlTm9kZSh0eXBlLCBjdXJyZW50Tm9kZSwgXCJcIiwgaGFzUGFyZW50UmVtb3ZlKTtcclxuICAgICAgICAgICAgICAgIGNsb3NlTW9kYWwoZGF0YSk7XHJcblxyXG4gICAgICAgICAgICAgICAgaWYgKGNhbGxiYWNrICE9PSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgICAgICAgICAgICBjYWxsYmFjayhkYXRhKTtcclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGRhdGE7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgZnVuY3Rpb24gY2xvc2VNb2RhbChkYXRhKSB7XHJcbiAgICAgICAgICAgICAgICBuYXZjb24uY2xvc2VNb2RhbCh0eXBlICsgXCJkZWxldGVcIik7XHJcbiAgICAgICAgICAgICAgICBpZiAoJChcIiNcIiArIHR5cGUpLmRhdGEoJ21vZGFsJykgJiYgJChcIiNcIiArIHR5cGUpLmRhdGEoJ21vZGFsJykuaXNTaG93bikgbmF2Y29uLmNsb3NlTW9kYWwodHlwZSk7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIC8vcmV0dXJuIHJldHVybkRhdGE7XHJcbiAgICAgICAgfSxcclxuICAgICAgICB0cmVlQWN0aW9uOiBmdW5jdGlvbiAoc2NvcGUsIGRhdGFzZXJ2aWNlLCBhY3Rpb24sIHR5cGUsIGZpZWxkcywgY3VycmVudE5vZGUsIGFzc2lnbk5vZGUsIGlkQ29sdW1uLCBkaXNwbGF5Q29sdW1uLCB0cmVlRGF0YSwgcG9wdXAsIGNhbGxiYWNrKSB7IC8vVHJlZSBkYXRhIHNhdmVcclxuICAgICAgICAgICAgaWYgKGZpZWxkcyA9PT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIHZhciBwb3NpdGlvbiA9IFwiXCI7XHJcbiAgICAgICAgICAgIGlmIChwb3NpdGlvbiA9PT0gdW5kZWZpbmVkIHx8IHBvc2l0aW9uID09PSAnJykgcG9zaXRpb24gPSAnbGFzdCc7XHJcblxyXG4gICAgICAgICAgICAvL3ZhciBpdGVtID0gbmF2Y29uLmdldEZpZWxkc0RhdGEoZmllbGRzKTtcclxuICAgICAgICAgICAgdmFyIGl0ZW0gPSBuYXZjb24uZ2V0RmllbGRzRGF0YVRvU2F2ZShmaWVsZHMsIGFjdGlvbiwgaWRDb2x1bW4pO1xyXG4gICAgICAgICAgICBpZiAoYXNzaWduTm9kZSAhPT0gbnVsbCkge1xyXG4gICAgICAgICAgICAgICAgZm9yICh2YXIga2V5IGluIGFzc2lnbk5vZGUuZGF0YSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChpdGVtLmhhc093blByb3BlcnR5KGtleSkpIGFzc2lnbk5vZGUuZGF0YVtrZXldID0gaXRlbVtrZXldO1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIGlmIChhc3NpZ25Ob2RlLnRleHQgIT09IHVuZGVmaW5lZCkgYXNzaWduTm9kZS50ZXh0ID0gaXRlbVtkaXNwbGF5Q29sdW1uXTtcclxuXHJcblxyXG4gICAgICAgICAgICAgICAgaWYgKGFjdGlvbi50b1VwcGVyQ2FzZSgpID09PSBcIlNBVkVcIiB8fCBhY3Rpb24udG9VcHBlckNhc2UoKSA9PT0gXCJTQVZFQVNcIikge1xyXG5cclxuICAgICAgICAgICAgICAgICAgICBpZiAoYXNzaWduTm9kZS5kYXRhLlBhcmVudElkICE9PSB1bmRlZmluZWQpIGFzc2lnbk5vZGUuZGF0YS5QYXJlbnRJZCA9IGN1cnJlbnROb2RlLmRhdGEuaWQ7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGFzc2lnbk5vZGUuZGF0YS5MZXZlbElkICE9PSB1bmRlZmluZWQpIGFzc2lnbk5vZGUuZGF0YS5MZXZlbElkID0gcGFyc2VGbG9hdChjdXJyZW50Tm9kZS5kYXRhLkxldmVsSWQpICsgMTtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoYXNzaWduTm9kZS5kYXRhLlNlcU5vICE9PSB1bmRlZmluZWQpIGFzc2lnbk5vZGUuZGF0YS5TZXFObyA9IChjdXJyZW50Tm9kZS5kYXRhLmlkICE9PSBcIlwiID8gY3VycmVudE5vZGUuY2hpbGRyZW4ubGVuZ3RoIDogY3VycmVudE5vZGUuZGF0YS5TZXFObykgKyAxO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChhc3NpZ25Ob2RlLmRhdGEuT2JqZWN0U3RhdGUgIT09IHVuZGVmaW5lZCAmJiAoYXNzaWduTm9kZS5kYXRhLk9iamVjdFN0YXRlID09PSBcIjBcIiB8fCBhc3NpZ25Ob2RlLmRhdGEuT2JqZWN0U3RhdGUgPT09IFwiXCIpKSBhc3NpZ25Ob2RlLmRhdGEuT2JqZWN0U3RhdGUgPSAxO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChhc3NpZ25Ob2RlLmRhdGEuU3RhdHVzICE9PSB1bmRlZmluZWQgJiYgKGFzc2lnbk5vZGUuZGF0YS5TdGF0dXMgPT09IFwiMFwiIHx8IGFzc2lnbk5vZGUuZGF0YS5TdGF0dXMgPT09IFwiXCIpKSBhc3NpZ25Ob2RlLmRhdGEuU3RhdHVzID0gMDtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuRGF0YSA9IGRhdGFzZXJ2aWNlLnBvc3RTZXJ2ZXJEYXRhKHR5cGUgKyBhY3Rpb24sIGFzc2lnbk5vZGUuZGF0YSkudGhlbihmdW5jdGlvbiAoZGF0YSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoYXNzaWduTm9kZS5TdGF0dXNOYW1lID09PSB1bmRlZmluZWQgJiYgZGF0YS5TdGF0dXNOYW1lICE9PSB1bmRlZmluZWQgJiYgZGF0YS5TdGF0dXNOYW1lICE9PSBudWxsKSBhc3NpZ25Ob2RlLlN0YXR1c05hbWUgPSBkYXRhLlN0YXR1c05hbWU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChhc3NpZ25Ob2RlLmRhdGEuU3RhdHVzTmFtZSA9PT0gdW5kZWZpbmVkICYmIGRhdGEuU3RhdHVzTmFtZSAhPT0gdW5kZWZpbmVkICYmIGRhdGEuU3RhdHVzTmFtZSAhPT0gbnVsbCkgYXNzaWduTm9kZS5kYXRhLlN0YXR1c05hbWUgPSBkYXRhLlN0YXR1c05hbWU7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAvL3JldHVybiBkYXRhO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBhc3NpZ25Ob2RlLmlkID0gZGF0YS5pZDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgYXNzaWduTm9kZS5kYXRhLmlkID0gZGF0YS5pZDtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChjdXJyZW50Tm9kZSA9PT0gdW5kZWZpbmVkIHx8IGN1cnJlbnROb2RlLmRhdGEgPT09IHVuZGVmaW5lZCB8fCBjdXJyZW50Tm9kZS5kYXRhLmlkID09PSBcIlwiIHx8IGN1cnJlbnROb2RlLmRhdGEuaWQgPT09IFwiLTFcIiB8fCBjdXJyZW50Tm9kZS5kYXRhLmlkID09PSBcIjBcIilcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGN1cnJlbnROb2RlID0geyBcImlkXCI6IFwiI1wiIH07XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgZGF0YSA9IGFzc2lnbk5vZGUuZGF0YTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgbmF2Y29uLmNyZWF0ZVRyZWVOb2RlKHR5cGUsIGN1cnJlbnROb2RlLCBhc3NpZ25Ob2RlLCBwb3NpdGlvbik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGFzc2lnbk5vZGUuZGF0YSA9IGRhdGE7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAvL25hdmNvbi5jbG9zZU1vZGFsKHR5cGUpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoY2FsbGJhY2sgIT09IHVuZGVmaW5lZClcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhbGxiYWNrKGFzc2lnbk5vZGUpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2VcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBhc3NpZ25Ob2RlO1xyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgZWxzZSBpZiAoYWN0aW9uLnRvVXBwZXJDYXNlKCkgPT09IFwiVVBEQVRFXCIpIHtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGFzc2lnbk5vZGUuZGF0YS5pZCAhPT0gdW5kZWZpbmVkKSBhc3NpZ25Ob2RlLmRhdGEuaWQgPSBjdXJyZW50Tm9kZS5kYXRhLmlkO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChhc3NpZ25Ob2RlLmRhdGEuUGFyZW50SWQgIT09IHVuZGVmaW5lZCkgYXNzaWduTm9kZS5kYXRhLlBhcmVudElkID0gY3VycmVudE5vZGUuZGF0YS5QYXJlbnRJZDtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoYXNzaWduTm9kZS5kYXRhLkxldmVsSWQgIT09IHVuZGVmaW5lZCkgYXNzaWduTm9kZS5kYXRhLkxldmVsSWQgPSBjdXJyZW50Tm9kZS5kYXRhLkxldmVsSWQ7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGFzc2lnbk5vZGUuZGF0YS5TZXFObyAhPT0gdW5kZWZpbmVkKSBhc3NpZ25Ob2RlLmRhdGEuU2VxTm8gPSBjdXJyZW50Tm9kZS5kYXRhLlNlcU5vO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChhc3NpZ25Ob2RlLmRhdGEuT2JqZWN0U3RhdGUgIT09IHVuZGVmaW5lZCAmJiAoYXNzaWduTm9kZS5kYXRhLk9iamVjdFN0YXRlID09PSBcIjBcIiB8fCBhc3NpZ25Ob2RlLmRhdGEuT2JqZWN0U3RhdGUgPT09IFwiXCIpKSBhc3NpZ25Ob2RlLmRhdGEuT2JqZWN0U3RhdGUgPSAyO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChhc3NpZ25Ob2RlLmRhdGEuU3RhdHVzICE9PSB1bmRlZmluZWQgJiYgKGFzc2lnbk5vZGUuZGF0YS5TdGF0dXMgPT09IFwiMFwiIHx8IGFzc2lnbk5vZGUuZGF0YS5TdGF0dXMgPT09IFwiXCIpKSBhc3NpZ25Ob2RlLmRhdGEuU3RhdHVzID0gMDtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuRGF0YSA9IGRhdGFzZXJ2aWNlLnB1dFNlcnZlckRhdGEodHlwZSArIGFjdGlvbiwgYXNzaWduTm9kZS5kYXRhKS50aGVuKGZ1bmN0aW9uIChkYXRhKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChhc3NpZ25Ob2RlLlN0YXR1c05hbWUgPT09IHVuZGVmaW5lZCAmJiBkYXRhLlN0YXR1c05hbWUgIT09IHVuZGVmaW5lZCAmJiBkYXRhLlN0YXR1c05hbWUgIT09IG51bGwpIGFzc2lnbk5vZGUuU3RhdHVzTmFtZSA9IGRhdGEuU3RhdHVzTmFtZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGFzc2lnbk5vZGUuZGF0YS5TdGF0dXNOYW1lID09PSB1bmRlZmluZWQgJiYgZGF0YS5TdGF0dXNOYW1lICE9PSB1bmRlZmluZWQgJiYgZGF0YS5TdGF0dXNOYW1lICE9PSBudWxsKSBhc3NpZ25Ob2RlLmRhdGEuU3RhdHVzTmFtZSA9IGRhdGEuU3RhdHVzTmFtZTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG5hdmNvbi5lZGl0VHJlZU5vZGUodHlwZSwgY3VycmVudE5vZGUsIGFzc2lnbk5vZGUudGV4dCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChhc3NpZ25Ob2RlICE9PSB1bmRlZmluZWQgJiYgZGF0YS5pZCAhPT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhc3NpZ25Ob2RlLmlkID0gZGF0YS5pZDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFzc2lnbk5vZGUuZGF0YS5pZCA9IGRhdGEuaWQ7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIG5vZGVDaGlsZHJlbiA9IG5hdmNvbi5nZXRJdGVtQnlLZXlWYWx1ZSh0cmVlRGF0YSwgXCJpZFwiLCBkYXRhLmlkKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChub2RlQ2hpbGRyZW4gIT09IC0xKSBhc3NpZ25Ob2RlLmNoaWxkcmVuID0gbm9kZUNoaWxkcmVuLmNoaWxkcmVuO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBqc29uRGF0YSA9IFthc3NpZ25Ob2RlXTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0cmVlRGF0YSAhPT0gdW5kZWZpbmVkKSBuYXZjb24udXBkYXRlVHJlZU5vZGUodHlwZSwgdHJlZURhdGEsIGpzb25EYXRhKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAvL25hdmNvbi5jbG9zZU1vZGFsKHR5cGUpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoY2FsbGJhY2sgIT09IHVuZGVmaW5lZClcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhbGxiYWNrKGN1cnJlbnROb2RlKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICBlbHNlXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gY3VycmVudE5vZGU7XHJcbiAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBlbHNlIGlmIChhY3Rpb24udG9VcHBlckNhc2UoKSA9PT0gXCJERUxFVEVcIikge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChjdXJyZW50Tm9kZS5kYXRhW2Rpc3BsYXlDb2x1bW5dICE9PSB1bmRlZmluZWQpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybkRhdGEgPSBhY3Rpb24gKyBcIiAoIFwiICsgY3VycmVudE5vZGUuZGF0YVtkaXNwbGF5Q29sdW1uXSArIFwiIClcIjtcclxuICAgICAgICAgICAgICAgICAgICBlbHNlXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybkRhdGEgPSBhY3Rpb24gKyBcIiAoIFwiICsgY3VycmVudE5vZGVbZGlzcGxheUNvbHVtbl0gKyBcIiApXCI7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGZvciAodmFyIGtleSBpbiBmaWVsZHMpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGZpZWxkID0gZmllbGRzW2tleV07XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGZpZWxkLmRpc2FibGVkID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIHR5cGUgPSB0eXBlICsgXCJkZWxldGVcIjtcclxuICAgICAgICAgICAgICAgICAgICBuYXZjb24ub3Blbk1vZGFsKHR5cGUpO1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB0cmVlRGF0YTtcclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICBpZiAoKHBvcHVwICE9PSB1bmRlZmluZWQgJiYgcG9wdXAgIT09IFwiXCIgJiYgcG9wdXAgPT09IGZhbHNlKSB8fCBhY3Rpb24udG9VcHBlckNhc2UoKSA9PT0gXCJERUxFVEVcIikgcmV0dXJuO1xyXG4gICAgICAgICAgICAgICAgbmF2Y29uLmNsb3NlTW9kYWwodHlwZSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoYWN0aW9uLnRvVXBwZXJDYXNlKCkgPT09IFwiU0FWRVwiIHx8IGFjdGlvbi50b1VwcGVyQ2FzZSgpID09PSBcIlNBVkVBU1wiKVxyXG4gICAgICAgICAgICAgICAgICAgIGRhdGFzZXJ2aWNlLnBvc3RTZXJ2ZXJEYXRhKHR5cGUgKyBhY3Rpb24sIGl0ZW0pLnRoZW4oZnVuY3Rpb24gKGRhdGEpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGNhbGxiYWNrICE9PSB1bmRlZmluZWQpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYWxsYmFjayhkYXRhKTtcclxuICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgIGVsc2UgaWYgKGFjdGlvbi50b1VwcGVyQ2FzZSgpID09PSBcIlVQREFURVwiKVxyXG4gICAgICAgICAgICAgICAgICAgIGRhdGFzZXJ2aWNlLnB1dFNlcnZlckRhdGEodHlwZSArIGFjdGlvbiwgaXRlbSkudGhlbihmdW5jdGlvbiAoZGF0YSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoY2FsbGJhY2sgIT09IHVuZGVmaW5lZClcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhbGxiYWNrKGRhdGEpO1xyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgZWxzZSBpZiAoYWN0aW9uLnRvVXBwZXJDYXNlKCkgPT09IFwiREVMRVRFXCIpXHJcbiAgICAgICAgICAgICAgICAgICAgZGF0YXNlcnZpY2UucHV0U2VydmVyRGF0YSh0eXBlICsgYWN0aW9uLCBpdGVtKS50aGVuKGZ1bmN0aW9uIChkYXRhKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChjYWxsYmFjayAhPT0gdW5kZWZpbmVkKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FsbGJhY2soZGF0YSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9O1xyXG59KG5hdmNvbiB8fCB7fSkpOyIsIihmdW5jdGlvbiAobmF2Y29uKSB7XHJcbiAgICBuYXZjb24ucm91dGUgPSB7XHJcbiAgICAgICAgQVBJOiB7XHJcbiAgICAgICAgICAgIGFib3V0VXNDb25maWc6ICdHZW5lcmljL0dldFBhZ2VDb25maWd1cmF0aW9uP1BhZ2U9YWRtaW5pc3RyYXRpb24mdHlwZT1hYm91dFVzQ29uZmlnJyxcclxuXHJcbiAgICAgICAgICAgIC8qTG9naW4qL1xyXG4gICAgICAgICAgICBsb2dpbkNvbmZpZzogJ0dlbmVyaWMvR2V0UGFnZUNvbmZpZ3VyYXRpb24/UGFnZT1sb2dpbiZ0eXBlPWxvZ2luQ29uZmlnJyxcclxuICAgICAgICAgICAgbG9naW5BbGw6ICdsb2dpbi9HZXRBTEwnLFxyXG4gICAgICAgICAgICBsb2dpbklkOiAnbG9naW4vR2V0JyxcclxuICAgICAgICAgICAgbG9naW5TYXZlOiAnbG9naW4vQ3JlYXRlJyxcclxuICAgICAgICAgICAgbG9naW5VcGRhdGU6ICdsb2dpbi9VcGRhdGUnLFxyXG4gICAgICAgICAgICAvKkxvZ2luKi9cclxuXHJcbiAgICAgICAgICAgIC8qdXNlciBQcm9maWxlKi9cclxuICAgICAgICAgICAgdXNlclByb2ZpbGVDb25maWc6ICdHZW5lcmljL0dldFBhZ2VDb25maWd1cmF0aW9uP1BhZ2U9YWRtaW5pc3RyYXRpb24mdHlwZT11c2VycHJvZmlsZUNvbmZpZycsXHJcbiAgICAgICAgICAgIHVzZXJQcm9maWxlSWQ6ICdteVByb2ZpbGUvR2V0QnlJZCcsXHJcbiAgICAgICAgICAgIHVzZXJQcm9maWxlVXBkYXRlOiAnbXlQcm9maWxlL1VwZGF0ZScsXHJcblxyXG4gICAgICAgICAgICAvKkNoYW5nZSBQYXNzd29yZCovXHJcbiAgICAgICAgICAgIGNoYW5nZVBhc3N3b3JkQ29uZmlnOiAnR2VuZXJpYy9HZXRQYWdlQ29uZmlndXJhdGlvbj9QYWdlPWFkbWluaXN0cmF0aW9uJnR5cGU9Y2hhbmdlUGFzc3dvcmRDb25maWcnLFxyXG4gICAgICAgICAgICBjaGFuZ2VQYXNzd29yZFVwZGF0ZTogJ215UHJvZmlsZS9DaGFuZ2VQYXNzd29yZCcsXHJcbiAgICAgICAgICAgIC8qQ2hhbmdlIFBhc3N3b3JkKi9cclxuXHJcbiAgICAgICAgICAgIC8qVXNlciBNYW5hZ2VtZW50Ki9cclxuICAgICAgICAgICAgdXNlck1hbmFnZW1lbnRDb25maWc6ICdHZW5lcmljL0dldFBhZ2VDb25maWd1cmF0aW9uP1BhZ2U9YWRtaW5pc3RyYXRpb24mdHlwZT11c2VyTWFuYWdlbWVudENvbmZpZycsXHJcbiAgICAgICAgICAgIHVzZXJNYW5hZ2VtZW50QWxsOiAndXNlck1hbmFnZW1lbnQvR2V0QUxMJyxcclxuICAgICAgICAgICAgdXNlck1hbmFnZW1lbnRJZDogJ3VzZXJNYW5hZ2VtZW50L0dldEJ5SWQnLFxyXG4gICAgICAgICAgICB1c2VyTWFuYWdlbWVudFNhdmU6ICd1c2VyTWFuYWdlbWVudC9DcmVhdGUnLFxyXG4gICAgICAgICAgICB1c2VyTWFuYWdlbWVudFVwZGF0ZTogJ3VzZXJNYW5hZ2VtZW50L1VwZGF0ZScsXHJcbiAgICAgICAgICAgIHVzZXJNYW5hZ2VtZW50RGVsZXRlOiAndXNlck1hbmFnZW1lbnQvRGVsZXRlQnlJZCcsXHJcbiAgICAgICAgICAgIHVzZXJNYW5hZ2VtZW50R2V0RGVwdEJ5TG9jYXRpb25JZDogJ215UHJvZmlsZS9HZXREZXBhcnRtZW50QnlMb2NhdGlvbklkJyxcclxuICAgICAgICAgICAgdXNlck1hbmFnZW1lbnRHZXRTZWNRbjogJ3VzZXJNYW5hZ2VtZW50L0dldFNlY1F1ZXN0aW9uJyxcclxuICAgICAgICAgICAgZm9yZ290UGFzc3dvcmRTYXZlOiAndXNlck1hbmFnZW1lbnQvRm9yZ290UGFzc3dvcmQnLFxyXG4gICAgICAgICAgICAvKlVzZXIgTWFuYWdlbWVudCovXHJcblxyXG4gICAgICAgICAgICAvKm1hc3RlciBDb25maWd1cmF0aW9uKi9cclxuICAgICAgICAgICAgbWFzdGVyQ29uZmlndXJhdGlvbkNvbmZpZzogJ0dlbmVyaWMvR2V0UGFnZUNvbmZpZ3VyYXRpb24/UGFnZT1tYXN0ZXJkYXRhJnR5cGU9bWFzdGVyZGF0YUNvbmZpZycsXHJcbiAgICAgICAgICAgIG1hc3RlckNvbmZpZ3VyYXRpb25BbGw6ICdDb25maWd1cmF0aW9uL0dldEFMTCcsXHJcbiAgICAgICAgICAgIG1hc3RlckNvbmZpZ3VyYXRpb25JZDogJ0NvbmZpZ3VyYXRpb24vR2V0QnlJZC8nLFxyXG4gICAgICAgICAgICBDb25maWd1cmF0aW9uU2F2ZTogJ0NvbmZpZ3VyYXRpb24vQ3JlYXRlJyxcclxuICAgICAgICAgICAgQ29uZmlndXJhdGlvblVwZGF0ZTogJ0NvbmZpZ3VyYXRpb24vVXBkYXRlJyxcclxuICAgICAgICAgICAgQ29uZmlndXJhdGlvbkRlbGV0ZTogJ0NvbmZpZ3VyYXRpb24vRGVsZXRlQnlJZCcsXHJcbiAgICAgICAgICAgIC8qbWFzdGVyIENvbmZpZ3VyYXRpb24qL1xyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgLypOb3RpZmljYXRpb25zKi9cclxuICAgICAgICAgICAgbm90aWZpY2F0aW9uc0NvbmZpZzogJ0dlbmVyaWMvR2V0UGFnZUNvbmZpZ3VyYXRpb24/UGFnZT1hZG1pbmlzdHJhdGlvbiZ0eXBlPW5vdGlmaWNhdGlvbnNDb25maWcnLFxyXG4gICAgICAgICAgICBub3RpZmljYXRpb25zQWxsOiAnU2VjdXJpdHkvR2V0QWxsTm90aWZpY2F0aW9ucycsXHJcbiAgICAgICAgICAgIG5vdGlmaWNhdGlvbnNVcGRhdGU6ICdNeVNwYWNlL0FsbE5vdGlmaWNhdGlvbi9VcGRhdGUnLFxyXG4gICAgICAgICAgICBub3RpZmljYXRpb25zVXBkYXRlQWxsOiAnTXlTcGFjZS9BbGxOb3RpZmljYXRpb24vVXBkYXRlQWxsJyxcclxuXHJcbiAgICAgICAgICAgIC8qTm90aWZpY2F0aW9uIFNldHVwKi9cclxuICAgICAgICAgICAgbm90aWZpY2F0aW9uU2V0dXBDb25maWc6ICdHZW5lcmljL0dldFBhZ2VDb25maWd1cmF0aW9uP1BhZ2U9YWRtaW5pc3RyYXRpb24mdHlwZT1ub3RpZmljYXRpb25TZXR1cENvbmZpZycsXHJcbiAgICAgICAgICAgIG5vdGlmaWNhdGlvblNldHVwQWxsOiAnbm90aWZpY2F0aW9uU2V0dXAvR2V0QUxMJyxcclxuICAgICAgICAgICAgbm90aWZpY2F0aW9uU2V0dXBVcGRhdGU6ICdub3RpZmljYXRpb25TZXR1cC9VcGRhdGUnLFxyXG4gICAgICAgICAgICBub3RpZmljYXRpb25TZXR1cFRlc3RNYWlsOiAnbm90aWZpY2F0aW9uU2V0dXAvVGVzdE1haWwnLFxyXG4gICAgICAgICAgICBub3RpZmljYXRpb25TZXR1cFRlc3RTTVM6ICdub3RpZmljYXRpb25TZXR1cC9UZXN0U01TJyxcclxuXHJcbiAgICAgICAgICAgIC8qUm9sZSBNYW5hZ2VtZW50Ki9cclxuICAgICAgICAgICAgcm9sZU1hbmFnZW1lbnRDb25maWc6ICdHZW5lcmljL0dldFBhZ2VDb25maWd1cmF0aW9uP1BhZ2U9YWRtaW5pc3RyYXRpb24mdHlwZT1yb2xlTWFuYWdlbWVudENvbmZpZycsXHJcbiAgICAgICAgICAgIHJvbGVNYW5hZ2VtZW50QWxsOiAncm9sZU1hbmFnZW1lbnQvR2V0QUxMJyxcclxuICAgICAgICAgICAgcm9sZU1hbmFnZW1lbnRJZDogJ3JvbGVNYW5hZ2VtZW50L0dldEJ5SWQnLFxyXG4gICAgICAgICAgICByb2xlTWFuYWdlbWVudFNhdmU6ICdyb2xlTWFuYWdlbWVudC9DcmVhdGUnLFxyXG4gICAgICAgICAgICByb2xlTWFuYWdlbWVudFVwZGF0ZTogJ3JvbGVNYW5hZ2VtZW50L1VwZGF0ZScsXHJcbiAgICAgICAgICAgIHJvbGVNYW5hZ2VtZW50RGVsZXRlOiAncm9sZU1hbmFnZW1lbnQvRGVsZXRlQnlJZCcsXHJcbiAgICAgICAgICAgIC8qUm9sZSBNYW5hZ2VtZW50Ki9cclxuXHJcbiAgICAgICAgICAgIG5vQ29uZmlnOiAnLydcclxuICAgICAgICB9LFxyXG4gICAgICAgIFVJOiBmdW5jdGlvbiAoc2VydmljZUJhc2UsIHR5cGUsIHJvd0lkKSB7XHJcbiAgICAgICAgICAgIHZhciBhcGlFbmRVcmwgPSBuYXZjb24ucm91dGUuQVBJO1xyXG4gICAgICAgICAgICB2YXIgcmV0dXJuRGF0YSA9IHNlcnZpY2VCYXNlO1xyXG5cclxuICAgICAgICAgICAgLypMb2dpbiovXHJcbiAgICAgICAgICAgIGlmICh0eXBlLnRvVXBwZXJDYXNlKCkgPT09IFwiTE9HSU5DT05GSUdcIikgcmV0dXJuRGF0YSArPSBhcGlFbmRVcmwubG9naW5Db25maWc7XHJcbiAgICAgICAgICAgIGVsc2UgaWYgKHR5cGUudG9VcHBlckNhc2UoKSA9PT0gXCJMT0dJTkFMTFwiKSByZXR1cm5EYXRhICs9IGFwaUVuZFVybC5sb2dpbkFsbDtcclxuICAgICAgICAgICAgZWxzZSBpZiAodHlwZS50b1VwcGVyQ2FzZSgpID09PSBcIkxPR0lOSURcIikgcmV0dXJuRGF0YSArPSBhcGlFbmRVcmwubG9naW5JZDtcclxuICAgICAgICAgICAgZWxzZSBpZiAodHlwZS50b1VwcGVyQ2FzZSgpID09PSBcIkxPR0lOU0FWRVwiKSByZXR1cm5EYXRhICs9IGFwaUVuZFVybC5sb2dpblNhdmU7XHJcbiAgICAgICAgICAgIGVsc2UgaWYgKHR5cGUudG9VcHBlckNhc2UoKSA9PT0gXCJMT0dJTlVQREFURVwiKSByZXR1cm5EYXRhICs9IGFwaUVuZFVybC5sb2dpblVwZGF0ZTtcclxuXHJcbiAgICAgICAgICAgICAgICAvKlVzZXIgTWFuYWdlbWVudCovXHJcbiAgICAgICAgICAgIGVsc2UgaWYgKHR5cGUudG9VcHBlckNhc2UoKSA9PT0gXCJVU0VSTUFOQUdFTUVOVENPTkZJR1wiKSByZXR1cm5EYXRhICs9IGFwaUVuZFVybC51c2VyTWFuYWdlbWVudENvbmZpZztcclxuICAgICAgICAgICAgZWxzZSBpZiAodHlwZS50b1VwcGVyQ2FzZSgpID09PSBcIlVTRVJNQU5BR0VNRU5UQUxMXCIpIHJldHVybkRhdGEgKz0gYXBpRW5kVXJsLnVzZXJNYW5hZ2VtZW50QWxsO1xyXG4gICAgICAgICAgICBlbHNlIGlmICh0eXBlLnRvVXBwZXJDYXNlKCkgPT09IFwiVVNFUk1BTkFHRU1FTlRJRFwiKSByZXR1cm5EYXRhICs9IGFwaUVuZFVybC51c2VyTWFuYWdlbWVudElkO1xyXG4gICAgICAgICAgICBlbHNlIGlmICh0eXBlLnRvVXBwZXJDYXNlKCkgPT09IFwiVVNFUk1BTkFHRU1FTlRTQVZFXCIpIHJldHVybkRhdGEgKz0gYXBpRW5kVXJsLnVzZXJNYW5hZ2VtZW50U2F2ZTtcclxuICAgICAgICAgICAgZWxzZSBpZiAodHlwZS50b1VwcGVyQ2FzZSgpID09PSBcIlVTRVJNQU5BR0VNRU5UVVBEQVRFXCIpIHJldHVybkRhdGEgKz0gYXBpRW5kVXJsLnVzZXJNYW5hZ2VtZW50VXBkYXRlO1xyXG4gICAgICAgICAgICBlbHNlIGlmICh0eXBlLnRvVXBwZXJDYXNlKCkgPT09IFwiVVNFUk1BTkFHRU1FTlRERUxFVEVcIikgcmV0dXJuRGF0YSArPSBhcGlFbmRVcmwudXNlck1hbmFnZW1lbnREZWxldGU7XHJcbiAgICAgICAgICAgIGVsc2UgaWYgKHR5cGUudG9VcHBlckNhc2UoKSA9PT0gXCJVU0VSTUFOQUdFTUVOVEdFVERFUFRCWUxPQ0FUSU9OSURcIikgcmV0dXJuRGF0YSArPSBhcGlFbmRVcmwudXNlck1hbmFnZW1lbnRHZXREZXB0QnlMb2NhdGlvbklkO1xyXG4gICAgICAgICAgICBlbHNlIGlmICh0eXBlLnRvVXBwZXJDYXNlKCkgPT09IFwiVVNFUk1BTkFHRU1FTlRHRVRTRUNRTlwiKSByZXR1cm5EYXRhICs9IGFwaUVuZFVybC51c2VyTWFuYWdlbWVudEdldFNlY1FuO1xyXG4gICAgICAgICAgICBlbHNlIGlmICh0eXBlLnRvVXBwZXJDYXNlKCkgPT09IFwiRk9SR09UUEFTU1dPUkRTQVZFXCIpIHJldHVybkRhdGEgKz0gYXBpRW5kVXJsLmZvcmdvdFBhc3N3b3JkU2F2ZTtcclxuXHJcblxyXG4gICAgICAgICAgICAgICAgLypNYXN0ZXIgQ29uZmlndXJhdGlvbiovXHJcbiAgICAgICAgICAgIGVsc2UgaWYgKHR5cGUudG9VcHBlckNhc2UoKSA9PT0gXCJNQVNURVJDT05GSUdVUkFUSU9OQ09ORklHXCIpIHJldHVybkRhdGEgKz0gYXBpRW5kVXJsLm1hc3RlckNvbmZpZ3VyYXRpb25Db25maWc7XHJcbiAgICAgICAgICAgIGVsc2UgaWYgKHR5cGUudG9VcHBlckNhc2UoKSA9PT0gXCJNQVNURVJDT05GSUdVUkFUSU9OQUxMXCIpIHJldHVybkRhdGEgKz0gYXBpRW5kVXJsLm1hc3RlckNvbmZpZ3VyYXRpb25BbGw7XHJcbiAgICAgICAgICAgIGVsc2UgaWYgKHR5cGUudG9VcHBlckNhc2UoKSA9PT0gXCJNQVNURVJDT05GSUdVUkFUSU9OSURcIikgcmV0dXJuRGF0YSArPSBhcGlFbmRVcmwubWFzdGVyQ29uZmlndXJhdGlvbklkO1xyXG4gICAgICAgICAgICBlbHNlIGlmICh0eXBlLnRvVXBwZXJDYXNlKCkgPT09IFwiQ09ORklHVVJBVElPTlNBVkVcIikgcmV0dXJuRGF0YSArPSBhcGlFbmRVcmwuQ29uZmlndXJhdGlvblNhdmU7XHJcbiAgICAgICAgICAgIGVsc2UgaWYgKHR5cGUudG9VcHBlckNhc2UoKSA9PT0gXCJDT05GSUdVUkFUSU9OVVBEQVRFXCIpIHJldHVybkRhdGEgKz0gYXBpRW5kVXJsLkNvbmZpZ3VyYXRpb25VcGRhdGU7XHJcbiAgICAgICAgICAgIGVsc2UgaWYgKHR5cGUudG9VcHBlckNhc2UoKSA9PT0gXCJDT05GSUdVUkFUSU9OREVMRVRFXCIpIHJldHVybkRhdGEgKz0gYXBpRW5kVXJsLkNvbmZpZ3VyYXRpb25EZWxldGU7XHJcbiAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgICAgIC8qTm90aWZpY2F0aW9ucyovXHJcbiAgICAgICAgICAgIGVsc2UgaWYgKHR5cGUudG9VcHBlckNhc2UoKSA9PT0gXCJOT1RJRklDQVRJT05TQ09ORklHXCIpIHJldHVybkRhdGEgKz0gYXBpRW5kVXJsLm5vdGlmaWNhdGlvbnNDb25maWc7XHJcbiAgICAgICAgICAgIGVsc2UgaWYgKHR5cGUudG9VcHBlckNhc2UoKSA9PT0gXCJOT1RJRklDQVRJT05TQUxMXCIpIHJldHVybkRhdGEgKz0gYXBpRW5kVXJsLm5vdGlmaWNhdGlvbnNBbGw7XHJcbiAgICAgICAgICAgIGVsc2UgaWYgKHR5cGUudG9VcHBlckNhc2UoKSA9PT0gXCJOT1RJRklDQVRJT05TVVBEQVRFXCIpIHJldHVybkRhdGEgKz0gYXBpRW5kVXJsLm5vdGlmaWNhdGlvbnNVcGRhdGU7XHJcbiAgICAgICAgICAgIGVsc2UgaWYgKHR5cGUudG9VcHBlckNhc2UoKSA9PT0gXCJOT1RJRklDQVRJT05TVVBEQVRFQUxMXCIpIHJldHVybkRhdGEgKz0gYXBpRW5kVXJsLm5vdGlmaWNhdGlvbnNVcGRhdGVBbGw7XHJcblxyXG4gICAgICAgICAgICAgICAgLypOb3RpZmljYXRpb24gU2V0dXAqL1xyXG4gICAgICAgICAgICBlbHNlIGlmICh0eXBlLnRvVXBwZXJDYXNlKCkgPT09IFwiTk9USUZJQ0FUSU9OU0VUVVBDT05GSUdcIikgcmV0dXJuRGF0YSArPSBhcGlFbmRVcmwubm90aWZpY2F0aW9uU2V0dXBDb25maWc7XHJcbiAgICAgICAgICAgIGVsc2UgaWYgKHR5cGUudG9VcHBlckNhc2UoKSA9PT0gXCJOT1RJRklDQVRJT05TRVRVUEFMTFwiKSByZXR1cm5EYXRhICs9IGFwaUVuZFVybC5ub3RpZmljYXRpb25TZXR1cEFsbDtcclxuICAgICAgICAgICAgZWxzZSBpZiAodHlwZS50b1VwcGVyQ2FzZSgpID09PSBcIk5PVElGSUNBVElPTlNFVFVQVVBEQVRFXCIpIHJldHVybkRhdGEgKz0gYXBpRW5kVXJsLm5vdGlmaWNhdGlvblNldHVwVXBkYXRlO1xyXG4gICAgICAgICAgICBlbHNlIGlmICh0eXBlLnRvVXBwZXJDYXNlKCkgPT09IFwiTk9USUZJQ0FUSU9OU0VUVVBURVNUTUFJTFwiKSByZXR1cm5EYXRhICs9IGFwaUVuZFVybC5ub3RpZmljYXRpb25TZXR1cFRlc3RNYWlsO1xyXG4gICAgICAgICAgICBlbHNlIGlmICh0eXBlLnRvVXBwZXJDYXNlKCkgPT09IFwiTk9USUZJQ0FUSU9OU0VUVVBURVNUU01TXCIpIHJldHVybkRhdGEgKz0gYXBpRW5kVXJsLm5vdGlmaWNhdGlvblNldHVwVGVzdFNNUztcclxuICAgICAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAgICAgLypVc2VyIFByb2ZpbGUqL1xyXG4gICAgICAgICAgICBlbHNlIGlmICh0eXBlLnRvVXBwZXJDYXNlKCkgPT09IFwiVVNFUlBST0ZJTEVDT05GSUdcIikgcmV0dXJuRGF0YSArPSBhcGlFbmRVcmwudXNlclByb2ZpbGVDb25maWc7XHJcbiAgICAgICAgICAgIGVsc2UgaWYgKHR5cGUudG9VcHBlckNhc2UoKSA9PT0gXCJVU0VSUFJPRklMRUlEXCIpIHJldHVybkRhdGEgKz0gYXBpRW5kVXJsLnVzZXJQcm9maWxlSWQ7XHJcbiAgICAgICAgICAgIGVsc2UgaWYgKHR5cGUudG9VcHBlckNhc2UoKSA9PT0gXCJVU0VSUFJPRklMRVVQREFURVwiKSByZXR1cm5EYXRhICs9IGFwaUVuZFVybC51c2VyUHJvZmlsZVVwZGF0ZTtcclxuXHJcbiAgICAgICAgICAgICAgICAvKkNoYW5nZSBQYXNzd29yZCovXHJcbiAgICAgICAgICAgIGVsc2UgaWYgKHR5cGUudG9VcHBlckNhc2UoKSA9PT0gXCJDSEFOR0VQQVNTV09SRENPTkZJR1wiKSByZXR1cm5EYXRhICs9IGFwaUVuZFVybC5jaGFuZ2VQYXNzd29yZENvbmZpZztcclxuICAgICAgICAgICAgZWxzZSBpZiAodHlwZS50b1VwcGVyQ2FzZSgpID09PSBcIkNIQU5HRVBBU1NXT1JEVVBEQVRFXCIpIHJldHVybkRhdGEgKz0gYXBpRW5kVXJsLmNoYW5nZVBhc3N3b3JkVXBkYXRlO1xyXG5cclxuXHJcbiAgICAgICAgICAgIC8qTm90aWZpY2F0aW9uIE1hbmFnZW1lbnQqL1xyXG4gICAgICAgICAgICBpZiAodHlwZS50b1VwcGVyQ2FzZSgpID09PSBcIk5PVElGSUNBVElPTk1BU1RFUkNPTkZJR1wiKSByZXR1cm5EYXRhICs9IGFwaUVuZFVybC5ub3RpZmljYXRpb25tYXN0ZXJDb25maWc7XHJcbiAgICAgICAgICAgIGlmICh0eXBlLnRvVXBwZXJDYXNlKCkgPT09IFwiTk9USUZJQ0FUSU9OTUFOQUdFTUVOVEFMTFwiKSByZXR1cm5EYXRhICs9IGFwaUVuZFVybC5Ob3RpZmljYXRpb25NYW5hZ2VtZW50QWxsO1xyXG4gICAgICAgICAgICBpZiAodHlwZS50b1VwcGVyQ2FzZSgpID09PSBcIk5PVElGSUNBVElPTk1BU1RFUklEXCIpIHJldHVybkRhdGEgKz0gYXBpRW5kVXJsLm5vdGlmaWNhdGlvbm1hc3RlcklkO1xyXG4gICAgICAgICAgICAvLyBpZiAodHlwZS50b1VwcGVyQ2FzZSgpID09PSBcIk5PVElGSUNBVElPTk1BU1RFUlNBVkVcIikgcmV0dXJuRGF0YSArPSBhcGlFbmRVcmwuTkVXU0FOTk9VTkNFTUVOVFNTQVZFO1xyXG4gICAgICAgICAgICBpZiAodHlwZS50b1VwcGVyQ2FzZSgpID09PSBcIk5PVElGSUNBVElPTk1BU1RFUlVQREFURVwiKSByZXR1cm5EYXRhICs9IGFwaUVuZFVybC5ub3RpZmljYXRpb25tYXN0ZXJVcGRhdGU7XHJcbiAgICAgICAgICAgIGlmICh0eXBlLnRvVXBwZXJDYXNlKCkgPT09IFwiTk9USUZJQ0FUSU9OTUFTVEVSREVMRVRFXCIpIHJldHVybkRhdGEgKz0gYXBpRW5kVXJsLm5vdGlmaWNhdGlvbm1hc3RlckRlbGV0ZTtcclxuICAgICAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAgICAgLypSb2xlIE1hbmFnZW1lbnQqL1xyXG4gICAgICAgICAgICBlbHNlIGlmICh0eXBlLnRvVXBwZXJDYXNlKCkgPT09IFwiUk9MRU1BTkFHRU1FTlRDT05GSUdcIikgcmV0dXJuRGF0YSArPSBhcGlFbmRVcmwucm9sZU1hbmFnZW1lbnRDb25maWc7XHJcbiAgICAgICAgICAgIGVsc2UgaWYgKHR5cGUudG9VcHBlckNhc2UoKSA9PT0gXCJST0xFTUFOQUdFTUVOVEFMTFwiKSByZXR1cm5EYXRhICs9IGFwaUVuZFVybC5yb2xlTWFuYWdlbWVudEFsbDtcclxuICAgICAgICAgICAgZWxzZSBpZiAodHlwZS50b1VwcGVyQ2FzZSgpID09PSBcIlJPTEVNQU5BR0VNRU5USURcIikgcmV0dXJuRGF0YSArPSBhcGlFbmRVcmwucm9sZU1hbmFnZW1lbnRJZDtcclxuICAgICAgICAgICAgZWxzZSBpZiAodHlwZS50b1VwcGVyQ2FzZSgpID09PSBcIlJPTEVNQU5BR0VNRU5UU0FWRVwiKSByZXR1cm5EYXRhICs9IGFwaUVuZFVybC5yb2xlTWFuYWdlbWVudFNhdmU7XHJcbiAgICAgICAgICAgIGVsc2UgaWYgKHR5cGUudG9VcHBlckNhc2UoKSA9PT0gXCJST0xFTUFOQUdFTUVOVFVQREFURVwiKSByZXR1cm5EYXRhICs9IGFwaUVuZFVybC5yb2xlTWFuYWdlbWVudFVwZGF0ZTtcclxuICAgICAgICAgICAgZWxzZSBpZiAodHlwZS50b1VwcGVyQ2FzZSgpID09PSBcIlJPTEVNQU5BR0VNRU5UREVMRVRFXCIpIHJldHVybkRhdGEgKz0gYXBpRW5kVXJsLnJvbGVNYW5hZ2VtZW50RGVsZXRlO1xyXG5cclxuICAgICAgICAgICAgaWYgKHR5cGUudG9VcHBlckNhc2UoKSA9PT0gXCJDT05UUklCVVRJTkdGQUNUT1JTQ0hFQ0tMSVNUQ09ORklHXCIpXHJcbiAgICAgICAgICAgICAgICByZXR1cm5EYXRhICs9ICgocm93SWQgIT09IHVuZGVmaW5lZCAmJiByb3dJZCAhPT0gXCJcIikgPyArcm93SWQgOiBcIlwiKTtcclxuICAgICAgICAgICAgZWxzZSByZXR1cm5EYXRhICs9ICgocm93SWQgIT09IHVuZGVmaW5lZCAmJiByb3dJZCAhPT0gXCJcIikgPyBcIi9cIiArIHJvd0lkIDogXCJcIik7XHJcblxyXG4gICAgICAgICAgICByZXR1cm4gcmV0dXJuRGF0YTtcclxuICAgICAgICB9XHJcbiAgICB9O1xyXG59KG5hdmNvbiB8fCB7fSkpOyIsIihmdW5jdGlvbiAoKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuICAgIHZhciBjb3JlID0gYW5ndWxhci5tb2R1bGUoJ2FwcC5jb3JlJykucnVuKGZ1bmN0aW9uICgkcm9vdFNjb3BlLCAkaHR0cCwgbmdBdXRoU2V0dGluZ3MpIHtcbiAgICAgICAgLy8kcm9vdFNjb3BlLnRlc3QgPSBuZXcgRGF0ZSgpO1xuXG4gICAgICAgIHZhciBlbnZpcm9ubWVudCA9IG5nQXV0aFNldHRpbmdzLmVudmlyb25tZW50O1xuICAgICAgICB2YXIgcHJvZFBhdGggPSBcInN0YXJ0L1wiO1xuICAgICAgICAvL3ZhciBhcHBQYXRoID0gKGVudmlyb25tZW50ID09PSBcInByb2R1Y3Rpb25cIikgPyBwcm9kUGF0aCArIFwibmF2Y29uRmllbGRUZW1wbGF0ZS5odG1sXCIgOiBcImV4dC1tb2R1bGVzL25hdmNvbkZpZWxkL25hdmNvbkZpZWxkVGVtcGxhdGUuaHRtbFwiO1xuICAgICAgICB2YXIgYXBwUGF0aCA9IChlbnZpcm9ubWVudCA9PT0gXCJwcm9kdWN0aW9uXCIpID8gcHJvZFBhdGggKyBcIm5hdmNvbkZpZWxkVGVtcGxhdGUuaHRtbFwiIDogXCJzdGFydC9uYXZjb25GaWVsZFRlbXBsYXRlLmh0bWxcIjtcblxuICAgICAgICAkaHR0cC5nZXQoYXBwUGF0aCkudGhlbihmdW5jdGlvbiAocmVzKSB7XG4gICAgICAgICAgICB2YXIgaHRtbE9iaiA9ICQoJzxodG1sPjwvaHRtbD4nKTtcbiAgICAgICAgICAgIGh0bWxPYmouaHRtbChyZXMuZGF0YSk7XG4gICAgICAgICAgICAkcm9vdFNjb3BlLmZpZWxkVGVtcGxhdGUgPSBodG1sT2JqO1xuICAgICAgICB9KTtcbiAgICAgICAgXG4gICAgfSk7XG4gICAvLyBjb3JlLmNvbmZpZyh0b2FzdHJDb25maWcpO1xuXG4gICAgLyogQG5nSW5qZWN0ICovXG4gICAgZnVuY3Rpb24gdG9hc3RyQ29uZmlnKHRvYXN0cikge1xuICAgICAgICB0b2FzdHIub3B0aW9ucy50aW1lT3V0ID0gNDAwMDtcbiAgICAgICAgdG9hc3RyLm9wdGlvbnMucG9zaXRpb25DbGFzcyA9ICd0b2FzdC1ib3R0b20tcmlnaHQnO1xuICAgIH1cblxuICAgIHZhciBjb25maWcgPSB7XG4gICAgICAgIGFwcEVycm9yUHJlZml4OiAnW1NhZmVUYWwtTW9kdWxhciBFcnJvcl0gJywgLy9Db25maWd1cmUgdGhlIGV4Y2VwdGlvbkhhbmRsZXIgZGVjb3JhdG9yXG4gICAgICAgIGFwcFRpdGxlOiAnUk1TJyxcbiAgICAgICAgdmVyc2lvbjogJzEuMC4wJ1xuICAgIH07XG5cbiAgICBjb3JlLnZhbHVlKCdjb25maWcnLCBjb25maWcpO1xuXG4gICAgY29yZS5jb25maWcoY29uZmlndXJlKTtcbiAgICBcbiAgICAvKiBAbmdJbmplY3QgKi9cbiAgICBmdW5jdGlvbiBjb25maWd1cmUoJGxvZ1Byb3ZpZGVyLCAkcm91dGVQcm92aWRlciwgcm91dGVoZWxwZXJDb25maWdQcm92aWRlciwgZXhjZXB0aW9uSGFuZGxlclByb3ZpZGVyKSB7XG5cbiAgICAgICBcbiAgICAgICAgXG4gICAgICAgIC8vIHR1cm4gZGVidWdnaW5nIG9mZi9vbiAobm8gaW5mbyBvciB3YXJuKVxuICAgICAgICBpZiAoJGxvZ1Byb3ZpZGVyLmRlYnVnRW5hYmxlZCkge1xuICAgICAgICAgICAgJGxvZ1Byb3ZpZGVyLmRlYnVnRW5hYmxlZCh0cnVlKTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIENvbmZpZ3VyZSB0aGUgY29tbW9uIHJvdXRlIHByb3ZpZGVyXG4gICAgICAgIHJvdXRlaGVscGVyQ29uZmlnUHJvdmlkZXIuY29uZmlnLiRyb3V0ZVByb3ZpZGVyID0gJHJvdXRlUHJvdmlkZXI7XG4gICAgICAgIHJvdXRlaGVscGVyQ29uZmlnUHJvdmlkZXIuY29uZmlnLmRvY1RpdGxlID0gJ05HLU1vZHVsYXI6ICc7XG4gICAgICAgIHZhciByZXNvbHZlQWx3YXlzID0geyAvKiBAbmdJbmplY3QgKi9cbiAgICAgICAgICAgIHJlYWR5OiBmdW5jdGlvbiAoZGF0YXNlcnZpY2UpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gZGF0YXNlcnZpY2UucmVhZHkoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICAgICAgcm91dGVoZWxwZXJDb25maWdQcm92aWRlci5jb25maWcucmVzb2x2ZUFsd2F5cyA9IHJlc29sdmVBbHdheXM7XG5cbiAgICAgICAgLy8gQ29uZmlndXJlIHRoZSBjb21tb24gZXhjZXB0aW9uIGhhbmRsZXJcbiAgICAgICAgZXhjZXB0aW9uSGFuZGxlclByb3ZpZGVyLmNvbmZpZ3VyZShjb25maWcuYXBwRXJyb3JQcmVmaXgpO1xuICAgIH1cbn0pKCk7IiwidmFyIGNoYXJ0RGF0YSA9IChmdW5jdGlvbiAoKSB7XHJcblxyXG4gICAgdmFyIGNoYXJ0RGF0YSA9IFtdO1xyXG5cclxuICAgIGZ1bmN0aW9uIHdyYXAodGV4dCwgd2lkdGgpIHtcclxuICAgICAgICB0ZXh0LmVhY2goZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICB2YXIgdGV4dCA9IGQzLnNlbGVjdCh0aGlzKSxcclxuICAgICAgICAgICAgICAgIHdvcmRzID0gdGV4dC50ZXh0KCkuc3BsaXQoL1xccysvKS5yZXZlcnNlKCksXHJcbiAgICAgICAgICAgICAgICB3b3JkLFxyXG4gICAgICAgICAgICAgICAgbGluZSA9IFtdLFxyXG4gICAgICAgICAgICAgICAgbGluZU51bWJlciA9IDAsXHJcbiAgICAgICAgICAgICAgICBsaW5lSGVpZ2h0ID0gMS4xLCAvLyBlbXNcclxuICAgICAgICAgICAgICAgIHkgPSB0ZXh0LmF0dHIoXCJ5XCIpLFxyXG4gICAgICAgICAgICAgICAgZHkgPSBwYXJzZUZsb2F0KHRleHQuYXR0cihcImR5XCIpKSxcclxuICAgICAgICAgICAgICAgIHRzcGFuID0gdGV4dC50ZXh0KG51bGwpLmFwcGVuZChcInRzcGFuXCIpLmF0dHIoXCJ4XCIsIDApLmF0dHIoXCJ5XCIsIHkpLmF0dHIoXCJkeVwiLCBkeSArIFwiZW1cIik7XHJcbiAgICAgICAgICAgIHdoaWxlICh3b3JkID0gd29yZHMucG9wKCkpIHtcclxuICAgICAgICAgICAgICAgIGxpbmUucHVzaCh3b3JkKTtcclxuICAgICAgICAgICAgICAgIHRzcGFuLnRleHQobGluZS5qb2luKFwiIFwiKSk7XHJcbiAgICAgICAgICAgICAgICBpZiAodHNwYW4ubm9kZSgpLmdldENvbXB1dGVkVGV4dExlbmd0aCgpID4gd2lkdGgpIHtcclxuICAgICAgICAgICAgICAgICAgICBsaW5lLnBvcCgpO1xyXG4gICAgICAgICAgICAgICAgICAgIHRzcGFuLnRleHQobGluZS5qb2luKFwiIFwiKSk7XHJcbiAgICAgICAgICAgICAgICAgICAgbGluZSA9IFt3b3JkXTtcclxuICAgICAgICAgICAgICAgICAgICB0c3BhbiA9IHRleHQuYXBwZW5kKFwidHNwYW5cIikuYXR0cihcInhcIiwgMCkuYXR0cihcInlcIiwgeSkuYXR0cihcImR5XCIsICsrbGluZU51bWJlciAqIGxpbmVIZWlnaHQgKyBkeSArIFwiZW1cIikudGV4dCh3b3JkKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG5cclxuICAgIGZ1bmN0aW9uIHR5cGUoZCkge1xyXG4gICAgICAgIGQudmFsdWUgPSArZC52YWx1ZTtcclxuICAgICAgICByZXR1cm4gZDtcclxuICAgIH1cclxuXHJcbiAgICB2YXIgY2hhcnREYXRhID0gW107XHJcbiAgICB2YXIgY2hhcnQgPSB7fTtcclxuXHJcbiAgICBjaGFydCA9IHtcclxuICAgICAgICBcImNoYXJ0XCI6IHtcclxuICAgICAgICAgICAgXCJwYWxldHRlQ29sb3JzXCI6IFwiIzdlNmY2YSwjMzZhZmIyLCM5YzZkYjJcIixcclxuICAgICAgICAgICAgXCJiZ0NvbG9yXCI6IFwiI2ZmZmZmZlwiLFxyXG4gICAgICAgICAgICBcInNob3dCb3JkZXJcIjogXCIwXCIsXHJcbiAgICAgICAgICAgIFwic2hvd0NhbnZhc0JvcmRlclwiOiBcIjBcIixcclxuICAgICAgICAgICAgXCJ1c2VQbG90R3JhZGllbnRDb2xvclwiOiBcIjBcIixcclxuICAgICAgICAgICAgXCJwbG90Qm9yZGVyQWxwaGFcIjogXCIxMFwiLFxyXG4gICAgICAgICAgICBcImxlZ2VuZEJvcmRlckFscGhhXCI6IFwiMFwiLFxyXG4gICAgICAgICAgICBcImxlZ2VuZEJnQWxwaGFcIjogXCIwXCIsXHJcbiAgICAgICAgICAgIFwibGVnZW5kU2hhZG93XCI6IFwiMFwiLFxyXG4gICAgICAgICAgICBcInNob3dIb3ZlckVmZmVjdFwiOiBcIjFcIixcclxuICAgICAgICAgICAgXCJ2YWx1ZUZvbnRDb2xvclwiOiBcIiMwMDBcIixcclxuICAgICAgICAgICAgXCJyb3RhdGVWYWx1ZXNcIjogXCIxXCIsXHJcbiAgICAgICAgICAgIFwicGxhY2VWYWx1ZXNJbnNpZGVcIjogXCIxXCIsXHJcbiAgICAgICAgICAgIFwiZGl2bGluZUNvbG9yXCI6IFwiIzk5OTk5OVwiLFxyXG4gICAgICAgICAgICBcImRpdkxpbmVJc0Rhc2hlZFwiOiBcIjFcIixcclxuICAgICAgICAgICAgXCJkaXZMaW5lRGFzaExlblwiOiBcIjFcIixcclxuICAgICAgICAgICAgXCJkaXZMaW5lR2FwTGVuXCI6IFwiMVwiLFxyXG4gICAgICAgICAgICBcImNhbnZhc0JnQ29sb3JcIjogXCIjZmZmZmZmXCIsXHJcbiAgICAgICAgICAgIFwiY2FudmFzQmdBbHBoYVwiOiBcIjMwXCIsXHJcbiAgICAgICAgICAgIFwiY2FwdGlvbkZvbnRTaXplXCI6IFwiMTRcIixcclxuICAgICAgICAgICAgXCJzdWJjYXB0aW9uRm9udFNpemVcIjogXCIxNFwiLFxyXG4gICAgICAgICAgICBcInN1YmNhcHRpb25Gb250Qm9sZFwiOiBcIjBcIixcclxuICAgICAgICAgICAgXCJsZWdlbmRJdGVtRm9udFNpemVcIjpcIjEyXCJcclxuICAgICAgICB9LFxyXG4gICAgICAgIFwiZXZlbnRzXCI6IHtcclxuICAgICAgICAgICAgXCJjaGFydE1vdXNlbW92ZVwiOiBmdW5jdGlvbiAoZXZlbnRPYmosIGRhdGFPYmopIHtcclxuICAgICAgICAgICAgICAgIGFsZXJ0KCQoXCIuY2hhcnRUb29sVGlwXCIpLmh0bWwoKSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9LFxyXG4gICAgICAgIFwiY2F0ZWdvcmllc1wiOiBbXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIFwiY2F0ZWdvcnlcIjogW1xyXG4gICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgXCJsYWJlbFwiOiBcIkphbnVhcnlcIlxyXG4gICAgICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBcImxhYmVsXCI6IFwiRmVicnVhcnlcIlxyXG4gICAgICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBcImxhYmVsXCI6IFwiTWFyY2hcIlxyXG4gICAgICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBcImxhYmVsXCI6IFwiQXByaWxcIlxyXG4gICAgICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBcImxhYmVsXCI6IFwiTWF5XCJcclxuICAgICAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgXCJsYWJlbFwiOiBcIkp1bmVcIlxyXG4gICAgICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBcImxhYmVsXCI6IFwiSnVseVwiXHJcbiAgICAgICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIFwibGFiZWxcIjogXCJBdWd1c3RcIlxyXG4gICAgICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBcImxhYmVsXCI6IFwiU2VwdGVtYmVyXCJcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBdXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICBdLFxyXG4gICAgICAgIFwiZGF0YXNldFwiOiBbXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIFwic2VyaWVzbmFtZVwiOiBcIk1hbmFnZWRcIixcclxuICAgICAgICAgICAgICAgIFwiZGF0YVwiOiBbXHJcbiAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgXCJ2YWx1ZVwiOiAyXHJcbiAgICAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgIFwidmFsdWVcIjogNFxyXG4gICAgICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICBcInZhbHVlXCI6IDEzXHJcbiAgICAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgIFwidmFsdWVcIjogNFxyXG4gICAgICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICBcInZhbHVlXCI6IDhcclxuICAgICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgXCJ2YWx1ZVwiOiA2XHJcbiAgICAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgIFwidmFsdWVcIjogNVxyXG4gICAgICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICBcInZhbHVlXCI6IDlcclxuICAgICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgXCJ2YWx1ZVwiOiA5XHJcbiAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBdXHJcbiAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIFwic2VyaWVzbmFtZVwiOiBcIkNsb3NlZFwiLFxyXG4gICAgICAgICAgICAgICAgXCJkYXRhXCI6IFtcclxuICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICBcInZhbHVlXCI6IDZcclxuICAgICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgXCJ2YWx1ZVwiOiA3XHJcbiAgICAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgIFwidmFsdWVcIjogNlxyXG4gICAgICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICBcInZhbHVlXCI6IDFcclxuICAgICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgXCJ2YWx1ZVwiOiA5XHJcbiAgICAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgIFwidmFsdWVcIjogN1xyXG4gICAgICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICBcInZhbHVlXCI6IDVcclxuICAgICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgXCJ2YWx1ZVwiOiAzXHJcbiAgICAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgIFwidmFsdWVcIjogMlxyXG4gICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgXVxyXG4gICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBcInNlcmllc25hbWVcIjogXCJPcGVuXCIsXHJcbiAgICAgICAgICAgICAgICBcImRhdGFcIjogW1xyXG4gICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgXCJ2YWx1ZVwiOiBudWxsXHJcbiAgICAgICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIFwidmFsdWVcIjogbnVsbFxyXG4gICAgICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBcInZhbHVlXCI6IG51bGxcclxuICAgICAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgXCJ2YWx1ZVwiOiBudWxsXHJcbiAgICAgICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIFwidmFsdWVcIjogbnVsbFxyXG4gICAgICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBcInZhbHVlXCI6IG51bGxcclxuICAgICAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgXCJ2YWx1ZVwiOiBudWxsXHJcbiAgICAgICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIFwidmFsdWVcIjogbnVsbFxyXG4gICAgICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBcInZhbHVlXCI6IDNcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBdXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICBdLFxyXG4gICAgICAgIFwiaWRcIjogXCIxXCIsXHJcbiAgICAgICAgXCJ0eXBlXCI6IFwic3RhY2tlZGNvbHVtbjNkXCJcclxuICAgIH1cclxuICAgIGNoYXJ0RGF0YS5wdXNoKGNoYXJ0KTtcclxuXHJcbiAgICBjaGFydCA9IHt9O1xyXG4gICAgY2hhcnQgPSB7XHJcbiAgICAgICAgXCJjaGFydFwiOiB7XHJcbiAgICAgICAgICAgIFwicGFsZXR0ZUNvbG9yc1wiOiBcIiMwMDc1YzIsIzFhYWY1ZCwjZjJjNTAwLCNmNDViMDAsIzhlMDAwMFwiLFxyXG4gICAgICAgICAgICBcImJnQ29sb3JcIjogXCIjZmZmZmZmXCIsXHJcbiAgICAgICAgICAgIFwic2hvd0JvcmRlclwiOiBcIjBcIixcclxuICAgICAgICAgICAgXCJ1c2UzRExpZ2h0aW5nXCI6IFwiMFwiLFxyXG4gICAgICAgICAgICBcInNob3dTaGFkb3dcIjogXCIwXCIsXHJcbiAgICAgICAgICAgIFwiZW5hYmxlU21hcnRMYWJlbHNcIjogXCIwXCIsXHJcbiAgICAgICAgICAgIFwic3RhcnRpbmdBbmdsZVwiOiBcIjBcIixcclxuICAgICAgICAgICAgXCJkZWNpbWFsc1wiOiBcIjBcIixcclxuICAgICAgICAgICAgXCJjYXB0aW9uRm9udFNpemVcIjogXCIxNFwiLFxyXG4gICAgICAgICAgICBcInN1YmNhcHRpb25Gb250U2l6ZVwiOiBcIjE0XCIsXHJcbiAgICAgICAgICAgIFwic3ViY2FwdGlvbkZvbnRCb2xkXCI6IFwiMFwiLFxyXG4gICAgICAgICAgICBcInNob3dQZXJjZW50SW5Ub29sdGlwXCI6IFwiMFwiLFxyXG4gICAgICAgICAgICBcInRvb2xUaXBDb2xvclwiOiBcIiNmZmZmZmZcIixcclxuICAgICAgICAgICAgXCJ0b29sVGlwQm9yZGVyVGhpY2tuZXNzXCI6IFwiMFwiLFxyXG4gICAgICAgICAgICBcInRvb2xUaXBCZ0NvbG9yXCI6IFwiIzAwMDAwMFwiLFxyXG4gICAgICAgICAgICBcInRvb2xUaXBCZ0FscGhhXCI6IFwiODBcIixcclxuICAgICAgICAgICAgXCJ0b29sVGlwQm9yZGVyUmFkaXVzXCI6IFwiMlwiLFxyXG4gICAgICAgICAgICBcInRvb2xUaXBQYWRkaW5nXCI6IFwiNVwiLFxyXG4gICAgICAgICAgICBcInNob3dIb3ZlckVmZmVjdFwiOiBcIjFcIixcclxuICAgICAgICAgICAgXCJzaG93TGVnZW5kXCI6IFwiMVwiLFxyXG4gICAgICAgICAgICBcImxlZ2VuZEJnQ29sb3JcIjogXCIjZmZmZmZmXCIsXHJcbiAgICAgICAgICAgIFwibGVnZW5kQm9yZGVyQWxwaGFcIjogJzAnLFxyXG4gICAgICAgICAgICBcImxlZ2VuZFNoYWRvd1wiOiAnMCcsXHJcbiAgICAgICAgICAgIFwibGVnZW5kSXRlbUZvbnRTaXplXCI6ICcxMCcsXHJcbiAgICAgICAgICAgIFwibGVnZW5kSXRlbUZvbnRDb2xvclwiOiAnIzY2NjY2NicsXHJcbiAgICAgICAgICAgIFwiZW5hYmxlUm90YXRpb25cIjogXCIwXCIsXHJcbiAgICAgICAgICAgIFwiZW5hYmxlU2xpY2luZyBcIjogJzEnLFxyXG4gICAgICAgICAgICBcImVuYWJsZU11bHRpU2xpY2luZ1wiOiAnMCcsXHJcbiAgICAgICAgICAgIFwic2hvd0xhYmVsc1wiOiAnMScsXHJcbiAgICAgICAgICAgIFwic2hvd1BlcmNlbnRWYWx1ZXNcIjogXCIwXCIsXHJcbiAgICAgICAgICAgIFwiZGVmYXVsdENlbnRlckxhYmVsXCI6IFwiXCIsXHJcbiAgICAgICAgICAgIFwiY2VudGVyTGFiZWxcIjogXCIkbGFiZWwgPGJyIC8+ICR2YWx1ZVwiLFxyXG4gICAgICAgICAgICBcImNlbnRlckxhYmVsQm9sZFwiOiBcIjFcIixcclxuICAgICAgICAgICAgXCJ1c2VEYXRhUGxvdENvbG9yRm9yTGFiZWxzXCI6IFwiMVwiLFxyXG4gICAgICAgICAgICBcImxlZ2VuZEl0ZW1Gb250U2l6ZVwiOiBcIjEyXCJcclxuICAgICAgICB9LFxyXG4gICAgICAgIFwiZGF0YVwiOiBbXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIFwibGFiZWxcIjogXCJSaXNrIENsYXNzIEFcIixcclxuICAgICAgICAgICAgICAgIFwidmFsdWVcIjogXCIxMFwiXHJcbiAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIFwibGFiZWxcIjogXCJSaXNrIENsYXNzIEJcIixcclxuICAgICAgICAgICAgICAgIFwidmFsdWVcIjogXCIxNVwiXHJcbiAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIFwibGFiZWxcIjogXCJSaXNrIENsYXNzIENcIixcclxuICAgICAgICAgICAgICAgIFwidmFsdWVcIjogXCIzMFwiXHJcbiAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIFwibGFiZWxcIjogXCJSaXNrIENsYXNzIERcIixcclxuICAgICAgICAgICAgICAgIFwidmFsdWVcIjogXCI0MFwiXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICBdLFxyXG4gICAgICAgIFwiaWRcIjogXCIyXCIsXHJcbiAgICAgICAgXCJ0eXBlXCI6IFwiZG91Z2hudXQyZFwiXHJcbiAgICB9XHJcbiAgICBjaGFydERhdGEucHVzaChjaGFydCk7XHJcblxyXG4gICAgY2hhcnQgPSB7fTtcclxuICAgIGNoYXJ0ID0ge1xyXG4gICAgICAgIFwiY2hhcnRcIjoge1xyXG4gICAgICAgICAgICBcImNhcHRpb25cIjogXCJUb3AgU21hcnRwaG9uZSBSYXRpbmdzXCIsXHJcbiAgICAgICAgICAgIFwic3ViY2FwdGlvblwiOiBcIkJ5IEZlYXR1cmVzXCIsXHJcbiAgICAgICAgICAgIFwieEF4aXNOYW1lXCI6IFwiRmVhdHVyZXNcIixcclxuICAgICAgICAgICAgXCJ5QXhpc05hbWVcIjogXCJNb2RlbFwiLFxyXG4gICAgICAgICAgICBcInNob3dwbG90Ym9yZGVyXCI6IFwiMVwiLFxyXG4gICAgICAgICAgICBcInhBeGlzTGFiZWxzT25Ub3BcIjogXCIxXCIsXHJcbiAgICAgICAgICAgIFwicGxvdHRvb2x0ZXh0XCI6IFwiPGRpdiBpZD0nbmFtZURpdicgc3R5bGU9J2ZvbnQtc2l6ZTogMTJweDsgYm9yZGVyLWJvdHRvbTogMXB4IGRhc2hlZCAjNjY2NjY2OyBmb250LXdlaWdodDpib2xkOyBwYWRkaW5nLWJvdHRvbTogM3B4OyBtYXJnaW4tYm90dG9tOiA1cHg7IGRpc3BsYXk6IGlubGluZS1ibG9jazsgY29sb3I6ICM4ODg4ODg7JyA+JHJvd0xhYmVsIDo8L2Rpdj57YnJ9UmF0aW5nIDogPGI+JGRhdGFWYWx1ZTwvYj57YnJ9JGNvbHVtbkxhYmVsIDogPGI+JHRsTGFiZWw8L2I+e2JyfTxiPiR0ckxhYmVsPC9iPlwiLFxyXG4gICAgICAgICAgICBcImJhc2VGb250Q29sb3JcIjogXCIjMzMzMzMzXCIsXHJcbiAgICAgICAgICAgIFwiYmFzZUZvbnRcIjogXCJIZWx2ZXRpY2EgTmV1ZSxBcmlhbFwiLFxyXG4gICAgICAgICAgICBcImNhcHRpb25Gb250U2l6ZVwiOiBcIjE0XCIsXHJcbiAgICAgICAgICAgIFwic3ViY2FwdGlvbkZvbnRTaXplXCI6IFwiMTRcIixcclxuICAgICAgICAgICAgXCJzdWJjYXB0aW9uRm9udEJvbGRcIjogXCIwXCIsXHJcbiAgICAgICAgICAgIFwic2hvd0JvcmRlclwiOiBcIjBcIixcclxuICAgICAgICAgICAgXCJiZ0NvbG9yXCI6IFwiI2ZmZmZmZlwiLFxyXG4gICAgICAgICAgICBcInNob3dTaGFkb3dcIjogXCIwXCIsXHJcbiAgICAgICAgICAgIFwidXNlUGxvdEdyYWRpZW50Q29sb3JcIjogXCIwXCIsXHJcbiAgICAgICAgICAgIFwiY2FudmFzQmdDb2xvclwiOiBcIiNmZmZmZmZcIixcclxuICAgICAgICAgICAgXCJjYW52YXNCb3JkZXJBbHBoYVwiOiBcIjBcIixcclxuICAgICAgICAgICAgXCJsZWdlbmRCZ0FscGhhXCI6IFwiMFwiLFxyXG4gICAgICAgICAgICBcImxlZ2VuZEJvcmRlckFscGhhXCI6IFwiMFwiLFxyXG4gICAgICAgICAgICBcImxlZ2VuZFNoYWRvd1wiOiBcIjBcIixcclxuICAgICAgICAgICAgXCJsZWdlbmRJdGVtRm9udFNpemVcIjogXCIxMFwiLFxyXG4gICAgICAgICAgICBcImxlZ2VuZEl0ZW1Gb250Q29sb3JcIjogXCIjNjY2NjY2XCIsXHJcbiAgICAgICAgICAgIFwidG9vbFRpcENvbG9yXCI6IFwiI2ZmZmZmZlwiLFxyXG4gICAgICAgICAgICBcInRvb2xUaXBCb3JkZXJUaGlja25lc3NcIjogXCIwXCIsXHJcbiAgICAgICAgICAgIFwidG9vbFRpcEJnQ29sb3JcIjogXCIjMDAwMDAwXCIsXHJcbiAgICAgICAgICAgIFwidG9vbFRpcEJnQWxwaGFcIjogXCI4MFwiLFxyXG4gICAgICAgICAgICBcInRvb2xUaXBCb3JkZXJSYWRpdXNcIjogXCIyXCIsXHJcbiAgICAgICAgICAgIFwidG9vbFRpcFBhZGRpbmdcIjogXCI1XCJcclxuICAgICAgICB9LFxyXG4gICAgICAgIFwicm93c1wiOiB7XHJcbiAgICAgICAgICAgIFwicm93XCI6IFtcclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICBcImlkXCI6IFwiU0dTNVwiLFxyXG4gICAgICAgICAgICAgICAgICAgIFwibGFiZWxcIjogXCJTYW1zdW5nIEdhbGF4eSBTNVwiXHJcbiAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIFwiaWRcIjogXCJIVEMxTThcIixcclxuICAgICAgICAgICAgICAgICAgICBcImxhYmVsXCI6IFwiSFRDIE9uZSAoTTgpXCJcclxuICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgXCJpZFwiOiBcIklQSE9ORVM1XCIsXHJcbiAgICAgICAgICAgICAgICAgICAgXCJsYWJlbFwiOiBcIkFwcGxlIGlQaG9uZSA1U1wiXHJcbiAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIFwiaWRcIjogXCJMVU1JQVwiLFxyXG4gICAgICAgICAgICAgICAgICAgIFwibGFiZWxcIjogXCJOb2tpYSBMdW1pYSAxNTIwXCJcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgXVxyXG4gICAgICAgIH0sXHJcbiAgICAgICAgXCJjb2x1bW5zXCI6IHtcclxuICAgICAgICAgICAgXCJjb2x1bW5cIjogW1xyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIFwiaWRcIjogXCJwcm9jZXNzb3JcIixcclxuICAgICAgICAgICAgICAgICAgICBcImxhYmVsXCI6IFwiUHJvY2Vzc29yXCJcclxuICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgXCJpZFwiOiBcInNjcmVlblwiLFxyXG4gICAgICAgICAgICAgICAgICAgIFwibGFiZWxcIjogXCJTY3JlZW4gU2l6ZVwiXHJcbiAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIFwiaWRcIjogXCJwcmljZVwiLFxyXG4gICAgICAgICAgICAgICAgICAgIFwibGFiZWxcIjogXCJQcmljZVwiXHJcbiAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIFwiaWRcIjogXCJiYWNrdXBcIixcclxuICAgICAgICAgICAgICAgICAgICBcImxhYmVsXCI6IFwiQmF0dGVyeSBCYWNrdXBcIlxyXG4gICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICBcImlkXCI6IFwiY2FtXCIsXHJcbiAgICAgICAgICAgICAgICAgICAgXCJsYWJlbFwiOiBcIkNhbWVyYVwiXHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIF1cclxuICAgICAgICB9LFxyXG4gICAgICAgIFwiZGF0YXNldFwiOiBbXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIFwiZGF0YVwiOiBbXHJcbiAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBcInJvd2lkXCI6IFwiU0dTNVwiLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBcImNvbHVtbmlkXCI6IFwicHJvY2Vzc29yXCIsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIFwidmFsdWVcIjogXCI4LjdcIixcclxuICAgICAgICAgICAgICAgICAgICAgICAgXCJ0bGxhYmVsXCI6IFwiUXVhZCBDb3JlIDIuNSBHSHpcIixcclxuICAgICAgICAgICAgICAgICAgICAgICAgXCJ0cmxhYmVsXCI6IFwiT1MgOiBBbmRyb2lkIDQuNCBLaXRrYXRcIlxyXG4gICAgICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBcInJvd2lkXCI6IFwiU0dTNVwiLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBcImNvbHVtbmlkXCI6IFwic2NyZWVuXCIsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIFwidmFsdWVcIjogXCI4LjVcIixcclxuICAgICAgICAgICAgICAgICAgICAgICAgXCJ0bGxhYmVsXCI6IFwiNS4xIGluY2hcIixcclxuICAgICAgICAgICAgICAgICAgICAgICAgXCJ0cmxhYmVsXCI6IFwiQU1PTEVEIHNjcmVlblwiXHJcbiAgICAgICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIFwicm93aWRcIjogXCJTR1M1XCIsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIFwiY29sdW1uaWRcIjogXCJwcmljZVwiLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBcInZhbHVlXCI6IFwiOS4zXCIsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIFwidGxsYWJlbFwiOiBcIiQ2MDBcIlxyXG4gICAgICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBcInJvd2lkXCI6IFwiU0dTNVwiLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBcImNvbHVtbmlkXCI6IFwiYmFja3VwXCIsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIFwidmFsdWVcIjogXCI5LjdcIixcclxuICAgICAgICAgICAgICAgICAgICAgICAgXCJ0bGxhYmVsXCI6IFwiMjkgSHJzXCIsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIFwidHJsYWJlbFwiOiBcIkJhdHRlcnkgOiAyODAwIE1BSFwiXHJcbiAgICAgICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIFwicm93aWRcIjogXCJTR1M1XCIsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIFwiY29sdW1uaWRcIjogXCJjYW1cIixcclxuICAgICAgICAgICAgICAgICAgICAgICAgXCJ2YWx1ZVwiOiBcIjhcIixcclxuICAgICAgICAgICAgICAgICAgICAgICAgXCJ0bGxhYmVsXCI6IFwiMTYgTVBcIixcclxuICAgICAgICAgICAgICAgICAgICAgICAgXCJ0cmxhYmVsXCI6IFwiRnJvbnQgQ2FtZXJhIDogMi4xIE1QXCJcclxuICAgICAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgXCJyb3dpZFwiOiBcIkhUQzFNOFwiLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBcImNvbHVtbmlkXCI6IFwicHJvY2Vzc29yXCIsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIFwidmFsdWVcIjogXCI5LjJcIixcclxuICAgICAgICAgICAgICAgICAgICAgICAgXCJ0bGxhYmVsXCI6IFwiUXVhZCBDb3JlIDIuMyBHSHpcIixcclxuICAgICAgICAgICAgICAgICAgICAgICAgXCJ0cmxhYmVsXCI6IFwiT1MgOiBBbmRyb2lkIDQuNCBLaXRrYXRcIlxyXG4gICAgICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBcInJvd2lkXCI6IFwiSFRDMU04XCIsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIFwiY29sdW1uaWRcIjogXCJzY3JlZW5cIixcclxuICAgICAgICAgICAgICAgICAgICAgICAgXCJ2YWx1ZVwiOiBcIjguM1wiLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBcInRsbGFiZWxcIjogXCI1IGluY2hcIixcclxuICAgICAgICAgICAgICAgICAgICAgICAgXCJ0cmxhYmVsXCI6IFwiTENEIHNjcmVlblwiXHJcbiAgICAgICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIFwicm93aWRcIjogXCJIVEMxTThcIixcclxuICAgICAgICAgICAgICAgICAgICAgICAgXCJjb2x1bW5pZFwiOiBcInByaWNlXCIsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIFwidmFsdWVcIjogXCI3LjNcIixcclxuICAgICAgICAgICAgICAgICAgICAgICAgXCJ0bGxhYmVsXCI6IFwiJDYwMFwiXHJcbiAgICAgICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIFwicm93aWRcIjogXCJIVEMxTThcIixcclxuICAgICAgICAgICAgICAgICAgICAgICAgXCJjb2x1bW5pZFwiOiBcImJhY2t1cFwiLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBcInZhbHVlXCI6IFwiOC44XCIsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIFwidGxsYWJlbFwiOiBcIjIwIEhyc1wiLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBcInRybGFiZWxcIjogXCJCYXR0ZXJ5IDogMjYwMCBNQUhcIlxyXG4gICAgICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBcInJvd2lkXCI6IFwiSFRDMU04XCIsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIFwiY29sdW1uaWRcIjogXCJjYW1cIixcclxuICAgICAgICAgICAgICAgICAgICAgICAgXCJ2YWx1ZVwiOiBcIjguN1wiLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBcInRsbGFiZWxcIjogXCI0IE1QXCIsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIFwidHJsYWJlbFwiOiBcIkZyb250IENhbWVyYSA6IDUgTVBcIlxyXG4gICAgICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBcInJvd2lkXCI6IFwiSVBIT05FUzVcIixcclxuICAgICAgICAgICAgICAgICAgICAgICAgXCJjb2x1bW5pZFwiOiBcInByb2Nlc3NvclwiLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBcInZhbHVlXCI6IFwiOS4xXCIsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIFwidGxsYWJlbFwiOiBcIkR1YWwgQ29yZVwiLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBcInRybGFiZWxcIjogXCJPUyA6IGlPUyA3XCJcclxuICAgICAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgXCJyb3dpZFwiOiBcIklQSE9ORVM1XCIsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIFwiY29sdW1uaWRcIjogXCJzY3JlZW5cIixcclxuICAgICAgICAgICAgICAgICAgICAgICAgXCJ2YWx1ZVwiOiBcIjguNlwiLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBcInRsbGFiZWxcIjogXCI0IGluY2hcIixcclxuICAgICAgICAgICAgICAgICAgICAgICAgXCJ0cmxhYmVsXCI6IFwiUmV0aW5hIExDRCBzY3JlZW5cIlxyXG4gICAgICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBcInJvd2lkXCI6IFwiSVBIT05FUzVcIixcclxuICAgICAgICAgICAgICAgICAgICAgICAgXCJjb2x1bW5pZFwiOiBcInByaWNlXCIsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIFwidmFsdWVcIjogXCI3LjJcIixcclxuICAgICAgICAgICAgICAgICAgICAgICAgXCJ0bGxhYmVsXCI6IFwiJDY0OVwiXHJcbiAgICAgICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIFwicm93aWRcIjogXCJJUEhPTkVTNVwiLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBcImNvbHVtbmlkXCI6IFwiYmFja3VwXCIsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIFwidmFsdWVcIjogXCI4LjRcIixcclxuICAgICAgICAgICAgICAgICAgICAgICAgXCJ0bGxhYmVsXCI6IFwiMTAgSHJzXCIsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIFwidHJsYWJlbFwiOiBcIkJhdHRlcnkgOiAxNTYwIE1BSFwiXHJcbiAgICAgICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIFwicm93aWRcIjogXCJJUEhPTkVTNVwiLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBcImNvbHVtbmlkXCI6IFwiY2FtXCIsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIFwidmFsdWVcIjogXCI5LjVcIixcclxuICAgICAgICAgICAgICAgICAgICAgICAgXCJ0bGxhYmVsXCI6IFwiOCBNUFwiLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBcInRybGFiZWxcIjogXCJGcm9udCBDYW1lcmEgOiAxLjIgTVBcIlxyXG4gICAgICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBcInJvd2lkXCI6IFwiTFVNSUFcIixcclxuICAgICAgICAgICAgICAgICAgICAgICAgXCJjb2x1bW5pZFwiOiBcInByb2Nlc3NvclwiLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBcInZhbHVlXCI6IFwiOC44XCIsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIFwidGxsYWJlbFwiOiBcIlF1YWQgQ29yZSAyLjIgR0h6XCIsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIFwidHJsYWJlbFwiOiBcIk9TOiBXaW5kb3dzIFBob25lIDhcIlxyXG4gICAgICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBcInJvd2lkXCI6IFwiTFVNSUFcIixcclxuICAgICAgICAgICAgICAgICAgICAgICAgXCJjb2x1bW5pZFwiOiBcInNjcmVlblwiLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBcInZhbHVlXCI6IFwiOS4xXCIsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIFwidGxsYWJlbFwiOiBcIjYgaW5jaFwiLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBcInRybGFiZWxcIjogXCJMQ0Qgc2NyZWVuXCJcclxuICAgICAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgXCJyb3dpZFwiOiBcIkxVTUlBXCIsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIFwiY29sdW1uaWRcIjogXCJwcmljZVwiLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBcInZhbHVlXCI6IFwiOS43XCIsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIFwidGxsYWJlbFwiOiBcIiQ0NzBcIlxyXG4gICAgICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBcInJvd2lkXCI6IFwiTFVNSUFcIixcclxuICAgICAgICAgICAgICAgICAgICAgICAgXCJjb2x1bW5pZFwiOiBcImJhY2t1cFwiLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBcInZhbHVlXCI6IFwiOS4yXCIsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIFwidGxsYWJlbFwiOiBcIjI3IEhyc1wiLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBcInRybGFiZWxcIjogXCJCYXR0ZXJ5IDogMzQwMCBNQUhcIlxyXG4gICAgICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBcInJvd2lkXCI6IFwiTFVNSUFcIixcclxuICAgICAgICAgICAgICAgICAgICAgICAgXCJjb2x1bW5pZFwiOiBcImNhbVwiLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBcInZhbHVlXCI6IFwiOC4xXCIsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIFwidGxsYWJlbFwiOiBcIjIwTVBcIixcclxuICAgICAgICAgICAgICAgICAgICAgICAgXCJ0cmxhYmVsXCI6IFwiRnJvbnQgQ2FtZXJhIDogMS4yIE1QXCJcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBdXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICBdLFxyXG4gICAgICAgIFwiY29sb3JyYW5nZVwiOiB7XHJcbiAgICAgICAgICAgIFwiZ3JhZGllbnRcIjogXCIwXCIsXHJcbiAgICAgICAgICAgIFwibWludmFsdWVcIjogXCIwXCIsXHJcbiAgICAgICAgICAgIFwiY29kZVwiOiBcIkUyNEIxQVwiLFxyXG4gICAgICAgICAgICBcInN0YXJ0bGFiZWxcIjogXCJQb29yXCIsXHJcbiAgICAgICAgICAgIFwiZW5kbGFiZWxcIjogXCJHb29kXCIsXHJcbiAgICAgICAgICAgIFwiY29sb3JcIjogW1xyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIFwiY29kZVwiOiBcIkUyNEIxQVwiLFxyXG4gICAgICAgICAgICAgICAgICAgIFwibWludmFsdWVcIjogXCIxXCIsXHJcbiAgICAgICAgICAgICAgICAgICAgXCJtYXh2YWx1ZVwiOiBcIjVcIixcclxuICAgICAgICAgICAgICAgICAgICBcImxhYmVsXCI6IFwiQmFkXCJcclxuICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgXCJjb2RlXCI6IFwiRjZCQzMzXCIsXHJcbiAgICAgICAgICAgICAgICAgICAgXCJtaW52YWx1ZVwiOiBcIjVcIixcclxuICAgICAgICAgICAgICAgICAgICBcIm1heHZhbHVlXCI6IFwiOC41XCIsXHJcbiAgICAgICAgICAgICAgICAgICAgXCJsYWJlbFwiOiBcIkF2ZXJhZ2VcIlxyXG4gICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICBcImNvZGVcIjogXCI2REE4MUVcIixcclxuICAgICAgICAgICAgICAgICAgICBcIm1pbnZhbHVlXCI6IFwiOC41XCIsXHJcbiAgICAgICAgICAgICAgICAgICAgXCJtYXh2YWx1ZVwiOiBcIjEwXCIsXHJcbiAgICAgICAgICAgICAgICAgICAgXCJsYWJlbFwiOiBcIkdvb2RcIlxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBdXHJcbiAgICAgICAgfSxcclxuICAgICAgICBcImlkXCI6IFwiM1wiLFxyXG4gICAgICAgIFwidHlwZVwiOiBcImhlYXRtYXBcIlxyXG4gICAgfVxyXG4gICAgY2hhcnREYXRhLnB1c2goY2hhcnQpO1xyXG5cclxuICAgIGNoYXJ0ID0ge307XHJcbiAgICBjaGFydCA9IHtcclxuICAgICAgICBcImNoYXJ0XCI6IHtcclxuICAgICAgICAgICAgXCJjYXB0aW9uXCI6IFwiU09SVCBSZXBvcnRzXCIsXHJcbiAgICAgICAgICAgIFwic3ViQ2FwdGlvblwiOiBcIkphbiAyMDE2IC0gU2VwIDIwMTZcIixcclxuICAgICAgICAgICAgLy9cInhBeGlzbmFtZVwiOiBcIlF1YXJ0ZXJcIixcclxuICAgICAgICAgICAgLy9cInlBeGlzTmFtZVwiOiBcIlJldmVudWUgKEluIFVTRClcIixcclxuICAgICAgICAgICAgXCJudW1iZXJTdWZmaXhcIjogXCIlXCIsXHJcbiAgICAgICAgICAgIC8vXCJwYWxldHRlQ29sb3JzXCI6IFwiIzAwNzVjMiwjMWFhZjVkXCIsXHJcbiAgICAgICAgICAgIFwiYmdDb2xvclwiOiBcIiNmZmZmZmZcIixcclxuICAgICAgICAgICAgXCJib3JkZXJBbHBoYVwiOiBcIjIwXCIsXHJcbiAgICAgICAgICAgIFwic2hvd0NhbnZhc0JvcmRlclwiOiBcIjBcIixcclxuICAgICAgICAgICAgXCJ1c2VQbG90R3JhZGllbnRDb2xvclwiOiBcIjBcIixcclxuICAgICAgICAgICAgXCJwbG90Qm9yZGVyQWxwaGFcIjogXCIxMFwiLFxyXG4gICAgICAgICAgICBcImxlZ2VuZEJvcmRlckFscGhhXCI6IFwiMFwiLFxyXG4gICAgICAgICAgICBcImxlZ2VuZFNoYWRvd1wiOiBcIjBcIixcclxuICAgICAgICAgICAgXCJ2YWx1ZUZvbnRDb2xvclwiOiBcIiMwMDBcIixcclxuICAgICAgICAgICAgXCJzaG93WEF4aXNMaW5lXCI6IFwiMVwiLFxyXG4gICAgICAgICAgICBcInhBeGlzTGluZUNvbG9yXCI6IFwiIzk5OTk5OVwiLFxyXG4gICAgICAgICAgICBcImRpdmxpbmVDb2xvclwiOiBcIiM5OTk5OTlcIixcclxuICAgICAgICAgICAgXCJkaXZMaW5lRGFzaGVkXCI6IFwiMVwiLFxyXG4gICAgICAgICAgICBcInNob3dBbHRlcm5hdGVIR3JpZENvbG9yXCI6IFwiMFwiLFxyXG4gICAgICAgICAgICBcInN1YmNhcHRpb25Gb250Qm9sZFwiOiBcIjBcIixcclxuICAgICAgICAgICAgXCJzdWJjYXB0aW9uRm9udFNpemVcIjogXCIxNFwiLFxyXG4gICAgICAgICAgICBcInNob3dIb3ZlckVmZmVjdFwiOiBcIjFcIlxyXG4gICAgICAgIH0sXHJcbiAgICAgICAgXCJjYXRlZ29yaWVzXCI6IFtcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgXCJjYXRlZ29yeVwiOiBbXHJcbiAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBcImxhYmVsXCI6IFwiQWlyY3JhZnQgR2VuZXJhbFwiXHJcbiAgICAgICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIFwibGFiZWxcIjogXCJBdXRvIEZsaWdodFwiXHJcbiAgICAgICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIFwibGFiZWxcIjogXCJFbGVjdHJpY2FsXCJcclxuICAgICAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgXCJsYWJlbFwiOiBcIkluZGljYXRpbmcvUmVjb3JkaW5nXCJcclxuICAgICAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgXCJsYWJlbFwiOiBcIk5hdmlnYXRpb25cIlxyXG4gICAgICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBcImxhYmVsXCI6IFwiV2F0ZXIvV2FzdGVcIlxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIF1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIF0sXHJcbiAgICAgICAgXCJkYXRhc2V0XCI6IFtcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgXCJzZXJpZXNuYW1lXCI6IFwiU3VjY2VzcyAlXCIsXHJcbiAgICAgICAgICAgICAgICBcImRhdGFcIjogW1xyXG4gICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgXCJ2YWx1ZVwiOiBcIjg2XCJcclxuICAgICAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgXCJ2YWx1ZVwiOiBcIjkyXCJcclxuICAgICAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgXCJ2YWx1ZVwiOiBcIjg4XCJcclxuICAgICAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgXCJ2YWx1ZVwiOiBcIjg1XCJcclxuICAgICAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgXCJ2YWx1ZVwiOiBcIjkwXCJcclxuICAgICAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgXCJ2YWx1ZVwiOiBcIjk5XCJcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBdXHJcbiAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIFwic2VyaWVzbmFtZVwiOiBcIkZhaWx1cmVzICVcIixcclxuICAgICAgICAgICAgICAgIFwiZGF0YVwiOiBbXHJcbiAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBcInZhbHVlXCI6IFwiMTRcIlxyXG4gICAgICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBcInZhbHVlXCI6IFwiOFwiXHJcbiAgICAgICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIFwidmFsdWVcIjogXCIxMlwiXHJcbiAgICAgICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIFwidmFsdWVcIjogXCIxNVwiXHJcbiAgICAgICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIFwidmFsdWVcIjogXCIxMFwiXHJcbiAgICAgICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIFwidmFsdWVcIjogXCIxXCJcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBdXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICBdLFxyXG4gICAgICAgIFwiaWRcIjogXCI0XCIsXHJcbiAgICAgICAgXCJ0eXBlXCI6IFwic3RhY2tlZGNvbHVtbjNkXCJcclxuICAgIH1cclxuICAgIGNoYXJ0RGF0YS5wdXNoKGNoYXJ0KTtcclxuXHJcbiAgICBjaGFydCA9IHt9O1xyXG4gICAgY2hhcnQgPSB7XHJcbiAgICAgICAgXCJjaGFydFwiOiB7XHJcbiAgICAgICAgICAgIFwiY2FwdGlvblwiOiBcIk9jY3VycmVuY2UgQ2F1c2VzXCIsXHJcbiAgICAgICAgICAgIFwic3ViQ2FwdGlvblwiOiBcIkphbiAyMDE2IC0gU2VwIDIwMTZcIixcclxuICAgICAgICAgICAgXCJwYWxldHRlQ29sb3JzXCI6IFwiIzAwNzVjMiwjMWFhZjVkLCNmMmM1MDAsI2Y0NWIwMCwjOGUwMDAwXCIsXHJcbiAgICAgICAgICAgIFwiYmdDb2xvclwiOiBcIiNmZmZmZmZcIixcclxuICAgICAgICAgICAgXCJzaG93Qm9yZGVyXCI6IFwiMFwiLFxyXG4gICAgICAgICAgICBcInVzZTNETGlnaHRpbmdcIjogXCIwXCIsXHJcbiAgICAgICAgICAgIFwic2hvd1NoYWRvd1wiOiBcIjBcIixcclxuICAgICAgICAgICAgXCJlbmFibGVTbWFydExhYmVsc1wiOiBcIjBcIixcclxuICAgICAgICAgICAgXCJzdGFydGluZ0FuZ2xlXCI6IFwiMFwiLFxyXG4gICAgICAgICAgICBcInNob3dQZXJjZW50VmFsdWVzXCI6IFwiMVwiLFxyXG4gICAgICAgICAgICBcInNob3dQZXJjZW50SW5Ub29sdGlwXCI6IFwiMFwiLFxyXG4gICAgICAgICAgICBcImRlY2ltYWxzXCI6IFwiMVwiLFxyXG4gICAgICAgICAgICBcImNhcHRpb25Gb250U2l6ZVwiOiBcIjE0XCIsXHJcbiAgICAgICAgICAgIFwic3ViY2FwdGlvbkZvbnRTaXplXCI6IFwiMTRcIixcclxuICAgICAgICAgICAgXCJzdWJjYXB0aW9uRm9udEJvbGRcIjogXCIwXCIsXHJcbiAgICAgICAgICAgIFwidG9vbFRpcENvbG9yXCI6IFwiI2ZmZmZmZlwiLFxyXG4gICAgICAgICAgICBcInRvb2xUaXBCb3JkZXJUaGlja25lc3NcIjogXCIwXCIsXHJcbiAgICAgICAgICAgIFwidG9vbFRpcEJnQ29sb3JcIjogXCIjMDAwMDAwXCIsXHJcbiAgICAgICAgICAgIFwidG9vbFRpcEJnQWxwaGFcIjogXCI4MFwiLFxyXG4gICAgICAgICAgICBcInRvb2xUaXBCb3JkZXJSYWRpdXNcIjogXCIyXCIsXHJcbiAgICAgICAgICAgIFwidG9vbFRpcFBhZGRpbmdcIjogXCI1XCIsXHJcbiAgICAgICAgICAgIFwic2hvd0hvdmVyRWZmZWN0XCI6IFwiMVwiLFxyXG4gICAgICAgICAgICBcInNob3dMZWdlbmRcIjogXCIxXCIsXHJcbiAgICAgICAgICAgIFwibGVnZW5kQmdDb2xvclwiOiBcIiNmZmZmZmZcIixcclxuICAgICAgICAgICAgXCJsZWdlbmRCb3JkZXJBbHBoYVwiOiAnMCcsXHJcbiAgICAgICAgICAgIFwibGVnZW5kU2hhZG93XCI6ICcwJyxcclxuICAgICAgICAgICAgXCJsZWdlbmRJdGVtRm9udFNpemVcIjogJzEwJyxcclxuICAgICAgICAgICAgXCJsZWdlbmRJdGVtRm9udENvbG9yXCI6ICcjNjY2NjY2J1xyXG4gICAgICAgIH0sXHJcbiAgICAgICAgXCJkYXRhXCI6IFtcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgXCJsYWJlbFwiOiBcIkVsZWN0cmljYWxcIixcclxuICAgICAgICAgICAgICAgIFwidmFsdWVcIjogXCIxMlwiXHJcbiAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIFwibGFiZWxcIjogXCJBdXRvIEZsaWdodFwiLFxyXG4gICAgICAgICAgICAgICAgXCJ2YWx1ZVwiOiBcIjhcIlxyXG4gICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBcImxhYmVsXCI6IFwiQWlyY3JhZnQgZ2VuZXJhbFwiLFxyXG4gICAgICAgICAgICAgICAgXCJ2YWx1ZVwiOiBcIjhcIlxyXG4gICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBcImxhYmVsXCI6IFwiSW5kaWNhdGluZy9SZWNvcmRpbmdcIixcclxuICAgICAgICAgICAgICAgIFwidmFsdWVcIjogXCI3XCJcclxuICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgXCJsYWJlbFwiOiBcIk5hdmlnYXRpb25cIixcclxuICAgICAgICAgICAgICAgIFwidmFsdWVcIjogXCI1XCJcclxuICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgXCJsYWJlbFwiOiBcIldhdGVyL1dhc3RlXCIsXHJcbiAgICAgICAgICAgICAgICBcInZhbHVlXCI6IFwiMlwiXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICBdLFxyXG4gICAgICAgIFwiaWRcIjogXCI1XCIsXHJcbiAgICAgICAgXCJ0eXBlXCI6IFwiZG91Z2hudXQyZFwiXHJcbiAgICB9XHJcbiAgICBjaGFydERhdGEucHVzaChjaGFydCk7XHJcblxyXG4gICAgY2hhcnQgPSB7fTtcclxuICAgIGNoYXJ0ID0ge1xyXG4gICAgICAgIFwiY2hhcnRcIjoge1xyXG4gICAgICAgICAgICBcImNhcHRpb25cIjogXCJTT1JUIFJlcG9ydHNcIixcclxuICAgICAgICAgICAgLy9cInhBeGlzTmFtZVwiOiBcIlF1YXJ0ZXJcIixcclxuICAgICAgICAgICAgLy9cInlBeGlzTmFtZVwiOiBcIlNhbGVzIChJbiBVU0QpXCIsXHJcbiAgICAgICAgICAgIC8vXCJudW1iZXJQcmVmaXhcIjogXCIkXCIsXHJcbiAgICAgICAgICAgIFwicGFsZXR0ZUNvbG9yc1wiOiBcIiMwMDc1YzIsIzFhYWY1ZCwjZjJjNTAwXCIsXHJcbiAgICAgICAgICAgIFwiYmdDb2xvclwiOiBcIiNmZmZmZmZcIixcclxuICAgICAgICAgICAgXCJzaG93Qm9yZGVyXCI6IFwiMFwiLFxyXG4gICAgICAgICAgICBcInNob3dDYW52YXNCb3JkZXJcIjogXCIwXCIsXHJcbiAgICAgICAgICAgIFwidXNlUGxvdEdyYWRpZW50Q29sb3JcIjogXCIwXCIsXHJcbiAgICAgICAgICAgIFwicGxvdEJvcmRlckFscGhhXCI6IFwiMTBcIixcclxuICAgICAgICAgICAgXCJsZWdlbmRCb3JkZXJBbHBoYVwiOiBcIjBcIixcclxuICAgICAgICAgICAgXCJsZWdlbmRCZ0FscGhhXCI6IFwiMFwiLFxyXG4gICAgICAgICAgICBcImxlZ2VuZFNoYWRvd1wiOiBcIjBcIixcclxuICAgICAgICAgICAgXCJzaG93SG92ZXJFZmZlY3RcIjogXCIxXCIsXHJcbiAgICAgICAgICAgIFwidmFsdWVGb250Q29sb3JcIjogXCIjMDAwXCIsXHJcbiAgICAgICAgICAgIFwicm90YXRlVmFsdWVzXCI6IFwiMVwiLFxyXG4gICAgICAgICAgICBcInBsYWNlVmFsdWVzSW5zaWRlXCI6IFwiMVwiLFxyXG4gICAgICAgICAgICBcImRpdmxpbmVDb2xvclwiOiBcIiM5OTk5OTlcIixcclxuICAgICAgICAgICAgXCJkaXZMaW5lSXNEYXNoZWRcIjogXCIxXCIsXHJcbiAgICAgICAgICAgIFwiZGl2TGluZURhc2hMZW5cIjogXCIxXCIsXHJcbiAgICAgICAgICAgIFwiZGl2TGluZUdhcExlblwiOiBcIjFcIixcclxuICAgICAgICAgICAgXCJjYW52YXNCZ0NvbG9yXCI6IFwiI2ZmZmZmZlwiLFxyXG4gICAgICAgICAgICBcImNhcHRpb25Gb250U2l6ZVwiOiBcIjE0XCIsXHJcbiAgICAgICAgICAgIFwic3ViY2FwdGlvbkZvbnRTaXplXCI6IFwiMTRcIixcclxuICAgICAgICAgICAgXCJzdWJjYXB0aW9uRm9udEJvbGRcIjogXCIwXCJcclxuICAgICAgICB9LFxyXG4gICAgICAgIFwiY2F0ZWdvcmllc1wiOiBbXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIFwiY2F0ZWdvcnlcIjogW1xyXG4gICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgXCJsYWJlbFwiOiBcIkFpcmNyYWZ0IEdlbmVyYWxcIlxyXG4gICAgICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBcImxhYmVsXCI6IFwiQXV0byBGbGlnaHRcIlxyXG4gICAgICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBcImxhYmVsXCI6IFwiRWxlY3RyaWNhbFwiXHJcbiAgICAgICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIFwibGFiZWxcIjogXCJJbmRpY2F0aW5nL1JlY29yZGluZ1wiXHJcbiAgICAgICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIFwibGFiZWxcIjogXCJOYXZpZ2F0aW9uXCJcclxuICAgICAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgXCJsYWJlbFwiOiBcIldhdGVyL1dhc3RlXCJcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBdXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICBdLFxyXG4gICAgICAgIFwiZGF0YXNldFwiOiBbXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIFwic2VyaWVzbmFtZVwiOiBcIlN1Y2Nlc3NcIixcclxuICAgICAgICAgICAgICAgIFwiZGF0YVwiOiBbXHJcbiAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBcInZhbHVlXCI6IDUwXHJcbiAgICAgICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIFwidmFsdWVcIjogNjBcclxuICAgICAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgXCJ2YWx1ZVwiOiA0MFxyXG4gICAgICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBcInZhbHVlXCI6IDg2XHJcbiAgICAgICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIFwidmFsdWVcIjogOTJcclxuICAgICAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgXCJ2YWx1ZVwiOiA5NlxyXG4gICAgICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBcInZhbHVlXCI6IDU3XHJcbiAgICAgICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIFwidmFsdWVcIjogODRcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBdXHJcbiAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIFwic2VyaWVzbmFtZVwiOiBcIkZhaWx1cmVcIixcclxuICAgICAgICAgICAgICAgIFwiZGF0YVwiOiBbXHJcbiAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBcInZhbHVlXCI6IDUwXHJcbiAgICAgICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIFwidmFsdWVcIjogNDBcclxuICAgICAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgXCJ2YWx1ZVwiOiA2MFxyXG4gICAgICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBcInZhbHVlXCI6IDE0XHJcbiAgICAgICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIFwidmFsdWVcIjogOFxyXG4gICAgICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBcInZhbHVlXCI6IDRcclxuICAgICAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgXCJ2YWx1ZVwiOiA0M1xyXG4gICAgICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBcInZhbHVlXCI6IDI2XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgXVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgXSxcclxuICAgICAgICBcImlkXCI6IFwiMjUwOFwiLFxyXG4gICAgICAgIFwidHlwZVwiOiBcInN0YWNrZWRjb2x1bW4zZFwiXHJcbiAgICB9XHJcbiAgICBjaGFydERhdGEucHVzaChjaGFydCk7XHJcblxyXG4gICAgY2hhcnQgPSB7XHJcbiAgICAgICAgXCJjaGFydFwiOiB7XHJcbiAgICAgICAgICAgIFwiY2FwdGlvblwiOiBcIk92ZXIgQWxsIEJ5IFN1YmplY3QsIFllYXJcIixcclxuICAgICAgICAgICAgLy9cInhBeGlzTmFtZVwiOiBcIlF1YXJ0ZXJcIixcclxuICAgICAgICAgICAgLy9cInlBeGlzTmFtZVwiOiBcIlNhbGVzIChJbiBVU0QpXCIsXHJcbiAgICAgICAgICAgIC8vXCJudW1iZXJQcmVmaXhcIjogXCIkXCIsXHJcbiAgICAgICAgICAgIFwicGFsZXR0ZUNvbG9yc1wiOiBcIiMwMDc1YzIsIzFhYWY1ZCwjZjJjNTAwXCIsXHJcbiAgICAgICAgICAgIFwiYmdDb2xvclwiOiBcIiNmZmZmZmZcIixcclxuICAgICAgICAgICAgXCJzaG93Qm9yZGVyXCI6IFwiMFwiLFxyXG4gICAgICAgICAgICBcInNob3dDYW52YXNCb3JkZXJcIjogXCIwXCIsXHJcbiAgICAgICAgICAgIFwidXNlUGxvdEdyYWRpZW50Q29sb3JcIjogXCIwXCIsXHJcbiAgICAgICAgICAgIFwicGxvdEJvcmRlckFscGhhXCI6IFwiMTBcIixcclxuICAgICAgICAgICAgXCJsZWdlbmRCb3JkZXJBbHBoYVwiOiBcIjBcIixcclxuICAgICAgICAgICAgXCJsZWdlbmRCZ0FscGhhXCI6IFwiMFwiLFxyXG4gICAgICAgICAgICBcImxlZ2VuZFNoYWRvd1wiOiBcIjBcIixcclxuICAgICAgICAgICAgXCJzaG93SG92ZXJFZmZlY3RcIjogXCIxXCIsXHJcbiAgICAgICAgICAgIFwidmFsdWVGb250Q29sb3JcIjogXCIjMDAwXCIsXHJcbiAgICAgICAgICAgIFwicm90YXRlVmFsdWVzXCI6IFwiMVwiLFxyXG4gICAgICAgICAgICBcInBsYWNlVmFsdWVzSW5zaWRlXCI6IFwiMVwiLFxyXG4gICAgICAgICAgICBcImRpdmxpbmVDb2xvclwiOiBcIiM5OTk5OTlcIixcclxuICAgICAgICAgICAgXCJkaXZMaW5lSXNEYXNoZWRcIjogXCIxXCIsXHJcbiAgICAgICAgICAgIFwiZGl2TGluZURhc2hMZW5cIjogXCIxXCIsXHJcbiAgICAgICAgICAgIFwiZGl2TGluZUdhcExlblwiOiBcIjFcIixcclxuICAgICAgICAgICAgXCJjYW52YXNCZ0NvbG9yXCI6IFwiI2ZmZmZmZlwiLFxyXG4gICAgICAgICAgICBcImNhcHRpb25Gb250U2l6ZVwiOiBcIjE0XCIsXHJcbiAgICAgICAgICAgIFwic3ViY2FwdGlvbkZvbnRTaXplXCI6IFwiMTRcIixcclxuICAgICAgICAgICAgXCJzdWJjYXB0aW9uRm9udEJvbGRcIjogXCIwXCJcclxuICAgICAgICB9LFxyXG4gICAgICAgIFwiY2F0ZWdvcmllc1wiOiBbXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIFwiY2F0ZWdvcnlcIjogW1xyXG4gICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgXCJsYWJlbFwiOiBcIkFpcmNyYWZ0IEdlbmVyYWxcIlxyXG4gICAgICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBcImxhYmVsXCI6IFwiQXV0byBGbGlnaHRcIlxyXG4gICAgICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBcImxhYmVsXCI6IFwiRWxlY3RyaWNhbFwiXHJcbiAgICAgICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIFwibGFiZWxcIjogXCJJbmRpY2F0aW5nL1JlY29yZGluZ1wiXHJcbiAgICAgICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIFwibGFiZWxcIjogXCJOYXZpZ2F0aW9uXCJcclxuICAgICAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgXCJsYWJlbFwiOiBcIldhdGVyL1dhc3RlXCJcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBdXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICBdLFxyXG4gICAgICAgIFwiZGF0YXNldFwiOiBbXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIFwic2VyaWVzbmFtZVwiOiBcIjIwMTFcIixcclxuICAgICAgICAgICAgICAgIFwiZGF0YVwiOiBbXHJcbiAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBcInZhbHVlXCI6IDUwXHJcbiAgICAgICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIFwidmFsdWVcIjogNjBcclxuICAgICAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgXCJ2YWx1ZVwiOiA0MFxyXG4gICAgICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBcInZhbHVlXCI6IDg2XHJcbiAgICAgICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIFwidmFsdWVcIjogOTJcclxuICAgICAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgXCJ2YWx1ZVwiOiA5NlxyXG4gICAgICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBcInZhbHVlXCI6IDU3XHJcbiAgICAgICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIFwidmFsdWVcIjogODRcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBdXHJcbiAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIFwic2VyaWVzbmFtZVwiOiBcIjIwMTJcIixcclxuICAgICAgICAgICAgICAgIFwiZGF0YVwiOiBbXHJcbiAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBcInZhbHVlXCI6IDUwXHJcbiAgICAgICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIFwidmFsdWVcIjogODBcclxuICAgICAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgXCJ2YWx1ZVwiOiA0MFxyXG4gICAgICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBcInZhbHVlXCI6IDkwXHJcbiAgICAgICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIFwidmFsdWVcIjogMjBcclxuICAgICAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgXCJ2YWx1ZVwiOiA2MFxyXG4gICAgICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBcInZhbHVlXCI6IDYzXHJcbiAgICAgICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIFwidmFsdWVcIjogNzBcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBdXHJcbiAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIFwic2VyaWVzbmFtZVwiOiBcIjIwMTNcIixcclxuICAgICAgICAgICAgICAgIFwiZGF0YVwiOiBbXHJcbiAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBcInZhbHVlXCI6IDUwXHJcbiAgICAgICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIFwidmFsdWVcIjogODZcclxuICAgICAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgXCJ2YWx1ZVwiOiA5MlxyXG4gICAgICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBcInZhbHVlXCI6IDg2XHJcbiAgICAgICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIFwidmFsdWVcIjogOTJcclxuICAgICAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgXCJ2YWx1ZVwiOiA5NlxyXG4gICAgICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBcInZhbHVlXCI6IDU3XHJcbiAgICAgICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIFwidmFsdWVcIjogODRcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBdXHJcbiAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIFwic2VyaWVzbmFtZVwiOiBcIjIwMTRcIixcclxuICAgICAgICAgICAgICAgIFwiZGF0YVwiOiBbXHJcbiAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBcInZhbHVlXCI6IDQwXHJcbiAgICAgICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIFwidmFsdWVcIjogNjBcclxuICAgICAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgXCJ2YWx1ZVwiOiA4MFxyXG4gICAgICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBcInZhbHVlXCI6IDkwXHJcbiAgICAgICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIFwidmFsdWVcIjogNzBcclxuICAgICAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgXCJ2YWx1ZVwiOiA1MFxyXG4gICAgICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBcInZhbHVlXCI6IDMwXHJcbiAgICAgICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIFwidmFsdWVcIjogMTBcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBdXHJcbiAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIFwic2VyaWVzbmFtZVwiOiBcIjIwMTVcIixcclxuICAgICAgICAgICAgICAgIFwiZGF0YVwiOiBbXHJcbiAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBcInZhbHVlXCI6IDgwXHJcbiAgICAgICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIFwidmFsdWVcIjogODZcclxuICAgICAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgXCJ2YWx1ZVwiOiA5MlxyXG4gICAgICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBcInZhbHVlXCI6IDg2XHJcbiAgICAgICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIFwidmFsdWVcIjogOTJcclxuICAgICAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgXCJ2YWx1ZVwiOiA5NlxyXG4gICAgICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBcInZhbHVlXCI6IDU3XHJcbiAgICAgICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIFwidmFsdWVcIjogODRcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBdXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICBdLFxyXG4gICAgICAgIFwiaWRcIjogXCIyNTA5XCIsXHJcbiAgICAgICAgXCJ0eXBlXCI6IFwibXNjb2x1bW4zZFwiXHJcbiAgICB9XHJcbiAgICBjaGFydERhdGEucHVzaChjaGFydCk7XHJcblxyXG4gICAgY2hhcnQgPSB7fTtcclxuICAgIGNoYXJ0ID0ge1xyXG4gICAgICAgIFwiY2hhcnRcIjoge1xyXG4gICAgICAgICAgICBcImNhcHRpb25cIjogXCJQcmUgRXZhbHVhdGlvblwiLFxyXG4gICAgICAgICAgICBcInN1YkNhcHRpb25cIjogXCJcIixcclxuICAgICAgICAgICAgLy9cInhBeGlzbmFtZVwiOiBcIlF1YXJ0ZXJcIixcclxuICAgICAgICAgICAgLy9cInlBeGlzTmFtZVwiOiBcIlJldmVudWUgKEluIFVTRClcIixcclxuICAgICAgICAgICAgXCJudW1iZXJTdWZmaXhcIjogXCIlXCIsXHJcbiAgICAgICAgICAgIC8vXCJwYWxldHRlQ29sb3JzXCI6IFwiIzAwNzVjMiwjMWFhZjVkXCIsXHJcbiAgICAgICAgICAgIFwiYmdDb2xvclwiOiBcIiNmZmZmZmZcIixcclxuICAgICAgICAgICAgXCJib3JkZXJBbHBoYVwiOiBcIjIwXCIsXHJcbiAgICAgICAgICAgIFwic2hvd0NhbnZhc0JvcmRlclwiOiBcIjBcIixcclxuICAgICAgICAgICAgXCJ1c2VQbG90R3JhZGllbnRDb2xvclwiOiBcIjBcIixcclxuICAgICAgICAgICAgXCJwbG90Qm9yZGVyQWxwaGFcIjogXCIxMFwiLFxyXG4gICAgICAgICAgICBcImxlZ2VuZEJvcmRlckFscGhhXCI6IFwiMFwiLFxyXG4gICAgICAgICAgICBcImxlZ2VuZFNoYWRvd1wiOiBcIjBcIixcclxuICAgICAgICAgICAgXCJ2YWx1ZUZvbnRDb2xvclwiOiBcIiMwMDBcIixcclxuICAgICAgICAgICAgXCJzaG93WEF4aXNMaW5lXCI6IFwiMVwiLFxyXG4gICAgICAgICAgICBcInhBeGlzTGluZUNvbG9yXCI6IFwiIzk5OTk5OVwiLFxyXG4gICAgICAgICAgICBcImRpdmxpbmVDb2xvclwiOiBcIiM5OTk5OTlcIixcclxuICAgICAgICAgICAgXCJkaXZMaW5lRGFzaGVkXCI6IFwiMVwiLFxyXG4gICAgICAgICAgICBcInNob3dBbHRlcm5hdGVIR3JpZENvbG9yXCI6IFwiMFwiLFxyXG4gICAgICAgICAgICBcInN1YmNhcHRpb25Gb250Qm9sZFwiOiBcIjBcIixcclxuICAgICAgICAgICAgXCJzdWJjYXB0aW9uRm9udFNpemVcIjogXCIxNFwiLFxyXG4gICAgICAgICAgICBcInNob3dIb3ZlckVmZmVjdFwiOiBcIjFcIlxyXG4gICAgICAgIH0sXHJcbiAgICAgICAgXCJjYXRlZ29yaWVzXCI6IFtcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgXCJjYXRlZ29yeVwiOiBbXHJcbiAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBcImxhYmVsXCI6IFwiQWlyY3JhZnQgR2VuZXJhbFwiXHJcbiAgICAgICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIFwibGFiZWxcIjogXCJBdXRvIEZsaWdodFwiXHJcbiAgICAgICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIFwibGFiZWxcIjogXCJFbGVjdHJpY2FsXCJcclxuICAgICAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgXCJsYWJlbFwiOiBcIkluZGljYXRpbmcvUmVjb3JkaW5nXCJcclxuICAgICAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgXCJsYWJlbFwiOiBcIk5hdmlnYXRpb25cIlxyXG4gICAgICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBcImxhYmVsXCI6IFwiV2F0ZXIvV2FzdGVcIlxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIF1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIF0sXHJcbiAgICAgICAgXCJkYXRhc2V0XCI6IFtcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgXCJzZXJpZXNuYW1lXCI6IFwiU3VjY2VzcyAlXCIsXHJcbiAgICAgICAgICAgICAgICBcImRhdGFcIjogW1xyXG4gICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgXCJ2YWx1ZVwiOiBcIjg2XCJcclxuICAgICAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgXCJ2YWx1ZVwiOiBcIjkyXCJcclxuICAgICAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgXCJ2YWx1ZVwiOiBcIjg4XCJcclxuICAgICAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgXCJ2YWx1ZVwiOiBcIjg1XCJcclxuICAgICAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgXCJ2YWx1ZVwiOiBcIjkwXCJcclxuICAgICAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgXCJ2YWx1ZVwiOiBcIjk5XCJcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBdXHJcbiAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIFwic2VyaWVzbmFtZVwiOiBcIkZhaWx1cmVzICVcIixcclxuICAgICAgICAgICAgICAgIFwiZGF0YVwiOiBbXHJcbiAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBcInZhbHVlXCI6IFwiMTRcIlxyXG4gICAgICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBcInZhbHVlXCI6IFwiOFwiXHJcbiAgICAgICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIFwidmFsdWVcIjogXCIxMlwiXHJcbiAgICAgICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIFwidmFsdWVcIjogXCIxNVwiXHJcbiAgICAgICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIFwidmFsdWVcIjogXCIxMFwiXHJcbiAgICAgICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIFwidmFsdWVcIjogXCIxXCJcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBdXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICBdLFxyXG4gICAgICAgIFwiaWRcIjogXCIyNTExXCIsXHJcbiAgICAgICAgXCJ0eXBlXCI6IFwic3RhY2tlZGNvbHVtbjNkXCJcclxuICAgIH1cclxuICAgIGNoYXJ0RGF0YS5wdXNoKGNoYXJ0KTtcclxuXHJcbiAgICBjaGFydCA9IHt9O1xyXG4gICAgY2hhcnQgPSB7XHJcbiAgICAgICAgXCJjaGFydFwiOiB7XHJcbiAgICAgICAgICAgIFwiY2FwdGlvblwiOiBcIlByZXZpb3VzIExldmVsIGJ5IFN1YmplY3RcIixcclxuICAgICAgICAgICAgXCJzdWJDYXB0aW9uXCI6IFwiXCIsXHJcbiAgICAgICAgICAgIC8vXCJ4QXhpc25hbWVcIjogXCJRdWFydGVyXCIsXHJcbiAgICAgICAgICAgIC8vXCJ5QXhpc05hbWVcIjogXCJSZXZlbnVlIChJbiBVU0QpXCIsXHJcbiAgICAgICAgICAgIFwibnVtYmVyU3VmZml4XCI6IFwiJVwiLFxyXG4gICAgICAgICAgICAvL1wicGFsZXR0ZUNvbG9yc1wiOiBcIiMwMDc1YzIsIzFhYWY1ZFwiLFxyXG4gICAgICAgICAgICBcImJnQ29sb3JcIjogXCIjZmZmZmZmXCIsXHJcbiAgICAgICAgICAgIFwiYm9yZGVyQWxwaGFcIjogXCIyMFwiLFxyXG4gICAgICAgICAgICBcInNob3dDYW52YXNCb3JkZXJcIjogXCIwXCIsXHJcbiAgICAgICAgICAgIFwidXNlUGxvdEdyYWRpZW50Q29sb3JcIjogXCIwXCIsXHJcbiAgICAgICAgICAgIFwicGxvdEJvcmRlckFscGhhXCI6IFwiMTBcIixcclxuICAgICAgICAgICAgXCJsZWdlbmRCb3JkZXJBbHBoYVwiOiBcIjBcIixcclxuICAgICAgICAgICAgXCJsZWdlbmRTaGFkb3dcIjogXCIwXCIsXHJcbiAgICAgICAgICAgIFwidmFsdWVGb250Q29sb3JcIjogXCIjMDAwXCIsXHJcbiAgICAgICAgICAgIFwic2hvd1hBeGlzTGluZVwiOiBcIjFcIixcclxuICAgICAgICAgICAgXCJ4QXhpc0xpbmVDb2xvclwiOiBcIiM5OTk5OTlcIixcclxuICAgICAgICAgICAgXCJkaXZsaW5lQ29sb3JcIjogXCIjOTk5OTk5XCIsXHJcbiAgICAgICAgICAgIFwiZGl2TGluZURhc2hlZFwiOiBcIjFcIixcclxuICAgICAgICAgICAgXCJzaG93QWx0ZXJuYXRlSEdyaWRDb2xvclwiOiBcIjBcIixcclxuICAgICAgICAgICAgXCJzdWJjYXB0aW9uRm9udEJvbGRcIjogXCIwXCIsXHJcbiAgICAgICAgICAgIFwic3ViY2FwdGlvbkZvbnRTaXplXCI6IFwiMTRcIixcclxuICAgICAgICAgICAgXCJzaG93SG92ZXJFZmZlY3RcIjogXCIxXCJcclxuICAgICAgICB9LFxyXG4gICAgICAgIFwiY2F0ZWdvcmllc1wiOiBbXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIFwiY2F0ZWdvcnlcIjogW1xyXG4gICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgXCJsYWJlbFwiOiBcIkFpcmNyYWZ0IEdlbmVyYWxcIlxyXG4gICAgICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBcImxhYmVsXCI6IFwiQXV0byBGbGlnaHRcIlxyXG4gICAgICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBcImxhYmVsXCI6IFwiRWxlY3RyaWNhbFwiXHJcbiAgICAgICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIFwibGFiZWxcIjogXCJJbmRpY2F0aW5nL1JlY29yZGluZ1wiXHJcbiAgICAgICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIFwibGFiZWxcIjogXCJOYXZpZ2F0aW9uXCJcclxuICAgICAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgXCJsYWJlbFwiOiBcIldhdGVyL1dhc3RlXCJcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBdXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICBdLFxyXG4gICAgICAgIFwiZGF0YXNldFwiOiBbXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIFwic2VyaWVzbmFtZVwiOiBcIlN1Y2Nlc3MgJVwiLFxyXG4gICAgICAgICAgICAgICAgXCJkYXRhXCI6IFtcclxuICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIFwidmFsdWVcIjogXCI4NlwiXHJcbiAgICAgICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIFwidmFsdWVcIjogXCI5MlwiXHJcbiAgICAgICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIFwidmFsdWVcIjogXCI4OFwiXHJcbiAgICAgICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIFwidmFsdWVcIjogXCI4NVwiXHJcbiAgICAgICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIFwidmFsdWVcIjogXCI5MFwiXHJcbiAgICAgICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIFwidmFsdWVcIjogXCI5OVwiXHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgXVxyXG4gICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBcInNlcmllc25hbWVcIjogXCJGYWlsdXJlcyAlXCIsXHJcbiAgICAgICAgICAgICAgICBcImRhdGFcIjogW1xyXG4gICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgXCJ2YWx1ZVwiOiBcIjE0XCJcclxuICAgICAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgXCJ2YWx1ZVwiOiBcIjhcIlxyXG4gICAgICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBcInZhbHVlXCI6IFwiMTJcIlxyXG4gICAgICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBcInZhbHVlXCI6IFwiMTVcIlxyXG4gICAgICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBcInZhbHVlXCI6IFwiMTBcIlxyXG4gICAgICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBcInZhbHVlXCI6IFwiMVwiXHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgXVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgXSwgICAgICAgIFxyXG4gICAgICAgIFwiaWRcIjogXCIyNTEyXCIsXHJcbiAgICAgICAgXCJ0eXBlXCI6IFwic3RhY2tlZGNvbHVtbjNkXCJcclxuICAgIH1cclxuICAgIGNoYXJ0RGF0YS5wdXNoKGNoYXJ0KTtcclxuXHJcbiAgICAvLyBvciB3ZSBjb3VsZCBjcmVhdGUgYSBmdW5jdGlvbiBvbiB0aGUgQXJyYXkgcHJvdG90eXBlIGRpcmVjdGx5XHJcblxyXG4gICAgQXJyYXkucHJvdG90eXBlLmluQXJyYXkgPSBmdW5jdGlvbiAocHJvcGVydHksIHNlYXJjaEZvcikge1xyXG4gICAgICAgIHZhciByZXRWYWwgPSAtMTtcclxuICAgICAgICAkLmVhY2godGhpcywgZnVuY3Rpb24gKGluZGV4LCBpdGVtKSB7XHJcbiAgICAgICAgICAgIGlmIChpdGVtLmhhc093blByb3BlcnR5KHByb3BlcnR5KSkge1xyXG4gICAgICAgICAgICAgICAgaWYgKGl0ZW1bcHJvcGVydHldID09PSBzZWFyY2hGb3IpIHtcclxuICAgICAgICAgICAgICAgICAgICByZXRWYWwgPSBpdGVtO1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIHJldHVybiByZXRWYWw7XHJcbiAgICB9O1xyXG5cclxuICAgIHJldHVybiB7XHJcbiAgICAgICAgZ2V0Q2hhcnREYXRhOiBmdW5jdGlvbiAodmFsdWUpIHtcclxuICAgICAgICAgICAgdmFyIHJldHVybkRhdGEgPSBjaGFydERhdGEuaW5BcnJheShcImlkXCIsIHZhbHVlLnRvU3RyaW5nKCkpO1xyXG4gICAgICAgICAgICByZXR1cm4gcmV0dXJuRGF0YTtcclxuICAgICAgICB9LFxyXG4gICAgfTtcclxuXHJcbn0pKCk7IiwiKGZ1bmN0aW9uICgpIHtcbiAgICAndXNlIHN0cmljdCc7XG4gICAgYW5ndWxhci5tb2R1bGUoJ2FwcC5jb3JlJywgW1xuICAgICAgICAvKlxuICAgICAgICAgKiBBbmd1bGFyIG1vZHVsZXNcbiAgICAgICAgICovXG4gICAgICAgICduZ0FuaW1hdGUnLCAnbmdSb3V0ZScsICduZ1Nhbml0aXplJyxcbiAgICAgICAgLypcbiAgICAgICAgICogT3VyIHJldXNhYmxlIGNyb3NzIGFwcCBjb2RlIG1vZHVsZXNcbiAgICAgICAgICovXG4gICAgICAgICdibG9ja3MuZXhjZXB0aW9uJywgJ2Jsb2Nrcy5sb2dnZXInLCAnYmxvY2tzLnJvdXRlcicsXG4gICAgICAgIC8qXG4gICAgICAgICAqIDNyZCBQYXJ0eSBtb2R1bGVzXG4gICAgICAgICAqL1xuICAgICAgICAnbmdwbHVzJ1xuICAgIF0pO1xufSkoKTsiLCIoZnVuY3Rpb24gKCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIGFuZ3VsYXJcbiAgICAgICAgLm1vZHVsZSgnYmxvY2tzLmxvZ2dlcicpXG4gICAgICAgIC5mYWN0b3J5KCdsb2dnZXInLCBsb2dnZXIpO1xuXG4gICAgbG9nZ2VyLiRpbmplY3QgPSBbJyRsb2cnLCAndG9hc3RyJywgJyRpbmplY3RvciddO1xuXG4gICAgZnVuY3Rpb24gbG9nZ2VyKCRsb2csIHRvYXN0ciwgJGluamVjdG9yKSB7XG5cbiAgICAgICAgdmFyIHNlcnZpY2UgPSB7XG4gICAgICAgICAgICBzaG93VG9hc3RzOiB0cnVlLFxuXG4gICAgICAgICAgICBlcnJvcjogZXJyb3IsXG4gICAgICAgICAgICBpbmZvOiBpbmZvLFxuICAgICAgICAgICAgc3VjY2Vzczogc3VjY2VzcyxcbiAgICAgICAgICAgIHdhcm5pbmc6IHdhcm5pbmcsXG5cbiAgICAgICAgICAgIC8vIHN0cmFpZ2h0IHRvIGNvbnNvbGU7IGJ5cGFzcyB0b2FzdHJcbiAgICAgICAgICAgIGxvZzogJGxvZy5sb2dcbiAgICAgICAgfTtcblxuICAgICAgICByZXR1cm4gc2VydmljZTtcbiAgICAgICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vXG5cbiAgICAgICAgZnVuY3Rpb24gZXJyb3IobWVzc2FnZSwgZGF0YSwgdGl0bGUpIHtcbiAgICAgICAgICAgIHZhciBkYXRhc2VydmljZSA9ICRpbmplY3Rvci5nZXQoJ2RhdGFzZXJ2aWNlJyk7XG4gICAgICAgICAgICB2YXIgJGxvY2F0aW9uID0gJGluamVjdG9yLmdldCgnJGxvY2F0aW9uJyk7XG5cbiAgICAgICAgICAgIHZhciBzYXZlT2JqID0ge01lc3NhZ2U6bWVzc2FnZX07XG4gICAgICAgICAgICBkYXRhc2VydmljZS5wb3N0U2VydmVyRGF0YShcIlwiLCBzYXZlT2JqLCBmYWxzZSwgJycsIFwiL0dlbmVyaWMvTG9nL0NyZWF0ZVwiKS50aGVuKGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICAgICAgdmFyIGVyck5vID0gXCIwMDBcIjtcbiAgICAgICAgICAgICAgICBpZihkYXRhICE9PSB1bmRlZmluZWQgJiYgZGF0YSAhPT0gXCJcIilcbiAgICAgICAgICAgICAgICAgICAgZXJyTm8gPSBkYXRhO1xuICAgICAgICAgICAgICAgIHZhciBlcnJNZXNzYWdlID0gZXJyTm8gKyBcIiAtIFVuZXhwZWN0ZWQgZXJyb3IuIFBsZWFzZSBjb250YWN0IEFkbWluaXN0cmF0b3IuXCI7XG4gICAgICAgICAgICAgICAgLy90b2FzdHIuZXJyb3IoZXJyTWVzc2FnZSwgdGl0bGUsIHsgYWxsb3dIdG1sOiB0cnVlIH0pO1xuXG4gICAgICAgICAgICB9KVxuICAgICAgICAgICAvLyBjb25zb2xlLmxvZygnRXJyb3I6ICcgKyBtZXNzYWdlKTtcbiAgICAgICAgICAgICRsb2cuZXJyb3IoJ0Vycm9yOiAnICsgbWVzc2FnZSwgZGF0YSk7XG4gICAgICAgICAgICAvLyRsb2NhdGlvbi5wYXRoKCcvZGFzaGJvYXJkJyk7XG4gICAgICAgIH1cblxuICAgICAgICBmdW5jdGlvbiBpbmZvKG1lc3NhZ2UsIGRhdGEsIHRpdGxlKSB7XG4gICAgICAgICAgICB0b2FzdHIuaW5mbyhtZXNzYWdlLCB0aXRsZSwge2FsbG93SHRtbDogdHJ1ZX0pO1xuICAgICAgICAgICAgJGxvZy5pbmZvKCdJbmZvOiAnICsgbWVzc2FnZSwgZGF0YSk7XG4gICAgICAgIH1cblxuICAgICAgICBmdW5jdGlvbiBzdWNjZXNzKG1lc3NhZ2UsIGRhdGEsIHRpdGxlKSB7XG4gICAgICAgICAgICB0b2FzdHIuc3VjY2VzcyhtZXNzYWdlLCB0aXRsZSwgeyBhbGxvd0h0bWw6IHRydWUgfSk7XG4gICAgICAgICAgICAkbG9nLmluZm8oJ1N1Y2Nlc3M6ICcgKyBtZXNzYWdlLCBkYXRhKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGZ1bmN0aW9uIHdhcm5pbmcobWVzc2FnZSwgZGF0YSwgdGl0bGUpIHtcbiAgICAgICAgICAgIHRvYXN0ci53YXJuaW5nKG1lc3NhZ2UsIHRpdGxlLCB7IGFsbG93SHRtbDogdHJ1ZSB9KTtcbiAgICAgICAgICAgIC8qJGxvZy53YXJuKCdXYXJuaW5nOiAnICsgbWVzc2FnZSwgZGF0YSk7Ki9cbiAgICAgICAgfVxuICAgIH1cbn0oKSk7IiwiKGZ1bmN0aW9uICgpIHtcclxuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIGFuZ3VsYXJcbiAgICAgICAgLm1vZHVsZSgnYmxvY2tzLnJvdXRlcicpXG4gICAgICAgIC5wcm92aWRlcigncm91dGVoZWxwZXJDb25maWcnLCByb3V0ZWhlbHBlckNvbmZpZylcbiAgICAgICAgLmZhY3RvcnkoJ3JvdXRlaGVscGVyJywgcm91dGVoZWxwZXIpO1xuXG4gICAgcm91dGVoZWxwZXIuJGluamVjdCA9IFsnJGxvY2F0aW9uJywgJyRyb290U2NvcGUnLCAnJHJvdXRlJywgJ2xvZ2dlcicsICdyb3V0ZWhlbHBlckNvbmZpZycsICdhdXRoU2VydmljZScsICdic0xvYWRpbmdPdmVybGF5U2VydmljZScsICdsb2NhbFN0b3JhZ2VTZXJ2aWNlJ107XG5cbiAgICAvLyBNdXN0IGNvbmZpZ3VyZSB2aWEgdGhlIHJvdXRlaGVscGVyQ29uZmlnUHJvdmlkZXJcbiAgICBmdW5jdGlvbiByb3V0ZWhlbHBlckNvbmZpZygpIHtcbiAgICAgICAgLyoganNoaW50IHZhbGlkdGhpczp0cnVlICovXG4gICAgICAgIHRoaXMuY29uZmlnID0ge1xuICAgICAgICAgICAgLy8gVGhlc2UgYXJlIHRoZSBwcm9wZXJ0aWVzIHdlIG5lZWQgdG8gc2V0XG4gICAgICAgICAgICAvLyAkcm91dGVQcm92aWRlcjogdW5kZWZpbmVkXG4gICAgICAgICAgICAvLyBkb2NUaXRsZTogJydcbiAgICAgICAgICAgIC8vIHJlc29sdmVBbHdheXM6IHtyZWFkeTogZnVuY3Rpb24oKXsgfSB9XG4gICAgICAgIH07XG5cbiAgICAgICAgdGhpcy4kZ2V0ID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICAgICAgY29uZmlnOiB0aGlzLmNvbmZpZ1xyXG4gICAgICAgICAgICB9O1xyXG4gICAgICAgIH07XHJcbiAgICB9XG5cbiAgICBmdW5jdGlvbiByb3V0ZWhlbHBlcigkbG9jYXRpb24sICRyb290U2NvcGUsICRyb3V0ZSwgbG9nZ2VyLCByb3V0ZWhlbHBlckNvbmZpZywgYXV0aFNlcnZpY2UsIGJzTG9hZGluZ092ZXJsYXlTZXJ2aWNlLCBsb2NhbFN0b3JhZ2VTZXJ2aWNlKSB7XHJcbiAgICAgICAgdmFyIGhhbmRsaW5nUm91dGVDaGFuZ2VFcnJvciA9IGZhbHNlO1xuICAgICAgICB2YXIgcm91dGVDb3VudHMgPSB7XHJcbiAgICAgICAgICAgIGVycm9yczogMCxcbiAgICAgICAgICAgIGNoYW5nZXM6IDBcclxuICAgICAgICB9O1xuICAgICAgICB2YXIgcm91dGVzID0gW107XG4gICAgICAgIHZhciAkcm91dGVQcm92aWRlciA9IHJvdXRlaGVscGVyQ29uZmlnLmNvbmZpZy4kcm91dGVQcm92aWRlcjtcblxuICAgICAgICB2YXIgc2VydmljZSA9IHtcclxuICAgICAgICAgICAgY29uZmlndXJlUm91dGVzOiBjb25maWd1cmVSb3V0ZXMsXG4gICAgICAgICAgICBnZXRSb3V0ZXM6IGdldFJvdXRlcyxcbiAgICAgICAgICAgIHJvdXRlQ291bnRzOiByb3V0ZUNvdW50c1xyXG4gICAgICAgIH07XG5cbiAgICAgICAgaW5pdCgpO1xuXG4gICAgICAgIHJldHVybiBzZXJ2aWNlO1xuICAgICAgICAvLy8vLy8vLy8vLy8vLy9cblxuICAgICAgICBmdW5jdGlvbiBjb25maWd1cmVSb3V0ZXMocm91dGVzKSB7XHJcbiAgICAgICAgICAgIHJvdXRlcy5mb3JFYWNoKGZ1bmN0aW9uIChyb3V0ZSkge1xyXG4gICAgICAgICAgICAgICAgcm91dGUuY29uZmlnLnJlc29sdmUgPVxuICAgICAgICAgICAgICAgICAgICBhbmd1bGFyLmV4dGVuZChyb3V0ZS5jb25maWcucmVzb2x2ZSB8fCB7fSwgcm91dGVoZWxwZXJDb25maWcuY29uZmlnLnJlc29sdmVBbHdheXMpO1xuICAgICAgICAgICAgICAgICRyb3V0ZVByb3ZpZGVyLndoZW4ocm91dGUudXJsLCByb3V0ZS5jb25maWcpO1xyXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICRyb3V0ZVByb3ZpZGVyLm90aGVyd2lzZSh7XHJcbiAgICAgICAgICAgICAgICByZWRpcmVjdFRvOiAnLydcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxuXG4gICAgICAgIGZ1bmN0aW9uIGhhbmRsZVJvdXRpbmdFcnJvcnMoKSB7XG4gICAgICAgICAgICAvLyBSb3V0ZSBjYW5jZWxsYXRpb246XG4gICAgICAgICAgICAvLyBPbiByb3V0aW5nIGVycm9yLCBnbyB0byB0aGUgZGFzaGJvYXJkLlxuICAgICAgICAgICAgLy8gUHJvdmlkZSBhbiBleGl0IGNsYXVzZSBpZiBpdCB0cmllcyB0byBkbyBpdCB0d2ljZS5cbiAgICAgICAgICAgICRyb290U2NvcGUuJG9uKCckcm91dGVDaGFuZ2VFcnJvcicsXG4gICAgICAgICAgICAgICAgZnVuY3Rpb24gKGV2ZW50LCBjdXJyZW50LCBwcmV2aW91cywgcmVqZWN0aW9uKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGhhbmRsaW5nUm91dGVDaGFuZ2VFcnJvcikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICByb3V0ZUNvdW50cy5lcnJvcnMrKztcbiAgICAgICAgICAgICAgICAgICAgaGFuZGxpbmdSb3V0ZUNoYW5nZUVycm9yID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGRlc3RpbmF0aW9uID0gKGN1cnJlbnQgJiYgKGN1cnJlbnQudGl0bGUgfHwgY3VycmVudC5uYW1lIHx8IGN1cnJlbnQubG9hZGVkVGVtcGxhdGVVcmwpKSB8fFxuICAgICAgICAgICAgICAgICAgICAgICAgJ3Vua25vd24gdGFyZ2V0JztcbiAgICAgICAgICAgICAgICAgICAgdmFyIG1zZyA9ICdFcnJvciByb3V0aW5nIHRvICcgKyBkZXN0aW5hdGlvbiArICcuICcgKyAocmVqZWN0aW9uLm1zZyB8fCAnJyk7XG4gICAgICAgICAgICAgICAgICAgIGxvZ2dlci53YXJuaW5nKG1zZywgW2N1cnJlbnRdKTtcbiAgICAgICAgICAgICAgICAgICAgJGxvY2F0aW9uLnBhdGgoJy8nKTtcclxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICk7XHJcbiAgICAgICAgfVxuXG4gICAgICAgIGZ1bmN0aW9uIGluaXQoKSB7XHJcbiAgICAgICAgICAgIGhhbmRsZVJvdXRpbmdFcnJvcnMoKTtcbiAgICAgICAgICAgIGhlbmRsZUV2ZW50cygpO1xuICAgICAgICAgICAgJHJvdXRlLnJlbG9hZCgpO1xyXG4gICAgICAgIH1cblxuICAgICAgICBmdW5jdGlvbiBsb2dpblBhZ2VTZXR0aW5nKCkge1xyXG4gICAgICAgICAgICAkKFwiLnBhZ2UtY29udGVudFwiKS5jc3MoXCJtYXJnaW4tbGVmdFwiLCBcIjBweFwiKS5jc3MoXCJiYWNrZ3JvdW5kLWNvbG9yXCIsIFwidHJhbnNwYXJlbnRcIik7XG4gICAgICAgICAgICAkKFwiLnBhZ2Utc2lkZWJhci13cmFwcGVyXCIpLmNzcyhcImRpc3BsYXlcIiwgXCJub25lXCIpO1xuICAgICAgICAgICAgJChcIi50b3AtbWVudVwiKS5jc3MoXCJkaXNwbGF5XCIsIFwibm9uZVwiKTtcbiAgICAgICAgICAgICQoXCIucGFnZS1jb250YWluZXJcIikuY3NzKFwibWFyZ2luXCIsIFwiMHB4XCIpO1xuICAgICAgICAgICAgJChcIi5wYWdlLWhlYWRlclwiKS5jc3MoXCJkaXNwbGF5XCIsIFwibm9uZVwiKTtcbiAgICAgICAgICAgICQoXCIucGFnZS1mb290ZXJcIikuY3NzKFwiZGlzcGxheVwiLCBcIm5vbmVcIik7XG4gICAgICAgICAgICAkKFwiI3BhZ2V3cmFwcGVyXCIpLnJlbW92ZUF0dHIoJ3N0eWxlJyk7XG4gICAgICAgICAgICAkKFwiI3BhZ2V3cmFwcGVyXCIpLmNzcyhcIm1hcmdpbi10b3BcIiwgXCIwcHhcIik7XG4gICAgICAgICAgICAvLyQoXCIucGFnZS1jb250YWluZXJcIikuY3NzKFwibWFyZ2luLXRvcFwiLCBcIjBweFwiKTtcbiAgICAgICAgICAgIC8vJChcImh0bWxcIikuY3NzKFwiYmFja2dyb3VuZFwiLCBcInVybCgnaW1hZ2VzL2ZseW5hc19sZ29pbl9CZy5wbmcnKSBuby1yZXBlYXQgY2VudGVyIGNlbnRlciBmaXhlZFwiKTtcbiAgICAgICAgICAgICQoXCIudG9wLW1lbnVcIikuY3NzKFwiZGlzcGxheVwiLCBcIm5vbmVcIik7XG4gICAgICAgICAgICAvLyQoXCIubG9hZGluZy1vdmVybGF5XCIpLmNzcyhcImJhY2tncm91bmRcIiwgXCJ1cmwoJ2ltYWdlcy9mbHluYXNfbGdvaW5fQmcucG5nJykgbm8tcmVwZWF0IGNlbnRlciBjZW50ZXIgZml4ZWRcIik7XG4gICAgICAgICAgICAkKFwiLnBhZ2UtY29udGVudC13cmFwcGVyXCIpLnJlbW92ZUNsYXNzKFwid2VsbC1sZ1wiKTtcbiAgICAgICAgICAgIC8vJChcIi5zaHVmZmxlLWFuaW1hdGlvblwiKS5jc3MoXCJoZWlnaHRcIiwgXCJjYWxjKDEwMCUgLSAzMHB4KVwiKTtcbiAgICAgICAgICAgIC8vICQoXCIucGFnZS1jb250ZW50LXdyYXBwZXJcIikuY3NzKFwibWFyZ2luLXRvcFwiLCBcIi02MHB4XCIpO1xuICAgICAgICAgICAgJChcIi5wYWdlLWNvbnRlbnRcIikuYWRkQ2xhc3MoXCJsb2dpbi1jb250ZW50XCIpO1xuICAgICAgICAgICAgJChcIi5wYWdlLWNvbnRlbnQtd3JhcHBlclwiKS5oZWlnaHQoJCh3aW5kb3cpLmhlaWdodCgpICsgXCJweFwiKTtcclxuICAgICAgICB9XG5cbiAgICAgICAgZnVuY3Rpb24gYWxsUGFnZVNldHRpbmcoKSB7XHJcbiAgICAgICAgICAgIGlmICgkbG9jYXRpb24gIT09IHVuZGVmaW5lZCAmJiAkbG9jYXRpb24uJCRwYXRoICE9PSB1bmRlZmluZWQpXG4gICAgICAgICAgICAgICAgJHJvb3RTY29wZS5jb25maWdIZWFkZXJNZW51ID0gJGxvY2F0aW9uLiQkcGF0aC5yZXBsYWNlKFwiL1wiLCBcIlwiKTtcbiAgICAgICAgICAgIGVsc2VcbiAgICAgICAgICAgICAgICAkcm9vdFNjb3BlLmNvbmZpZ0hlYWRlck1lbnUgPSBcIlwiO1xuICAgICAgICAgICAgJChcIi5wYWdlLWNvbnRlbnRcIikuY3NzKFwibWFyZ2luLWxlZnRcIiwgXCIyMzBweFwiKS5jc3MoXCJiYWNrZ3JvdW5kLWNvbG9yXCIsIFwiI0U2RjBGMVwiKTtcbiAgICAgICAgICAgICQoXCIucGFnZS1zaWRlYmFyLXdyYXBwZXJcIikuY3NzKFwiZGlzcGxheVwiLCBcIm5vbmVcIik7XG4gICAgICAgICAgICAkKFwiLnBhZ2Utc2lkZWJhci13cmFwcGVyXCIpLmNzcyhcImRpc3BsYXlcIiwgXCJpbmxpbmVcIik7XG4gICAgICAgICAgICAkKFwiLnRvcC1tZW51XCIpLmNzcyhcImRpc3BsYXlcIiwgXCJibG9ja1wiKTtcbiAgICAgICAgICAgICQoXCIucGFnZS1mb290ZXJcIikuY3NzKFwiZGlzcGxheVwiLCBcImJsb2NrXCIpO1xuICAgICAgICAgICAgJChcIi5wYWdlLWhlYWRlclwiKS5jc3MoXCJkaXNwbGF5XCIsIFwiYmxvY2tcIik7XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIC8vJChcIi5wYWdlLWNvbnRhaW5lclwiKS5jc3MoXCJtYXJnaW4tdG9wXCIsIFwiNDZweFwiKTtcbiAgICAgICAgICAgIC8vICQoXCJodG1sXCIpLmNzcyhcImJhY2tncm91bmQtY29sb3JcIiwgXCIjNmViZWJkXCIpLmNzcyhcImJhY2tncm91bmQtaW1hZ2VcIiwgXCJub25lXCIpO1xuICAgICAgICAgICAgJChcIi5sb2FkaW5nLW92ZXJsYXlcIikuY3NzKFwiYmFja2dyb3VuZC1pbWFnZVwiLCBcIm5vbmVcIik7XG4gICAgICAgICAgICAkKFwiLnBhZ2UtY29udGVudFwiKS5yZW1vdmVDbGFzcyhcImxvZ2luLWNvbnRlbnRcIik7XG4gICAgICAgICAgICAkKFwiI3BhZ2V3cmFwcGVyXCIpLnJlbW92ZUF0dHIoJ3N0eWxlJyk7XG4gICAgICAgICAgICAkKFwiI3BhZ2V3cmFwcGVyXCIpLmNzcyhcIm1hcmdpbi10b3BcIiwgXCI1OHB4XCIpO1xuICAgICAgICAgICAgLy8kKFwiLnBhZ2UtY29udGVudFwiKS5jc3MoXCJtYXJnaW4tdG9wXCIsIFwiMHB4XCIpO1xuICAgICAgICAgICAgLy8kKFwiLnBhZ2UtY29udGVudC13cmFwcGVyXCIpLmNzcyhcIm1hcmdpbi10b3BcIiwgXCIwcHhcIik7XG4gICAgICAgICAgICAkKFwiLnBhZ2UtY29udGVudC13cmFwcGVyXCIpLmhlaWdodCgoJCh3aW5kb3cpLmhlaWdodCgpIC0gJChcIi5wYWdlLWhlYWRlclwiKS5oZWlnaHQoKSkgKyBcInB4XCIpO1xyXG4gICAgICAgIH1cblxuXG4gICAgICAgIGZ1bmN0aW9uIGdldFJvdXRlcygpIHtcclxuICAgICAgICAgICAgZm9yICh2YXIgcHJvcCBpbiAkcm91dGUucm91dGVzKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoJHJvdXRlLnJvdXRlcy5oYXNPd25Qcm9wZXJ0eShwcm9wKSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciByb3V0ZSA9ICRyb3V0ZS5yb3V0ZXNbcHJvcF07XG4gICAgICAgICAgICAgICAgICAgIHZhciBpc1JvdXRlID0gISFyb3V0ZS50aXRsZTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGlzUm91dGUgJiYgKHJvdXRlLmRpc3BsYXkgIT09IHVuZGVmaW5lZCAmJiByb3V0ZS5kaXNwbGF5ICE9PSBmYWxzZSkpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcm91dGVzLnB1c2gocm91dGUpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIHJvdXRlcztcclxuICAgICAgICB9XG5cblxuICAgICAgICBmdW5jdGlvbiBoZW5kbGVFdmVudHMoKSB7XHJcbiAgICAgICAgICAgICRyb290U2NvcGUuJG9uKCckcm91dGVDaGFuZ2VTdWNjZXNzJyxcbiAgICAgICAgICAgICAgICBmdW5jdGlvbiAoZXZlbnQsIGN1cnJlbnQsIHByZXZpb3VzKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcm91dGVDb3VudHMuY2hhbmdlcysrO1xuICAgICAgICAgICAgICAgICAgICBoYW5kbGluZ1JvdXRlQ2hhbmdlRXJyb3IgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgdmFyIHRpdGxlID0gcm91dGVoZWxwZXJDb25maWcuY29uZmlnLmRvY1RpdGxlICsgJyAnICsgKGN1cnJlbnQudGl0bGUgfHwgJycpO1xuICAgICAgICAgICAgICAgICAgICAkcm9vdFNjb3BlLnRpdGxlID0gdGl0bGU7IC8vIGRhdGEgYmluZCB0byA8dGl0bGU+XG4gICAgICAgICAgICAgICAgICAgIC8vYnNMb2FkaW5nT3ZlcmxheVNlcnZpY2Uuc3RvcCgpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICk7XG5cbiAgICAgICAgICAgIGZ1bmN0aW9uIHJvdXRlQ2hhbmdlU3RhcnQoZXZlbnQsIG5leHQsIGN1cnJlbnQpIHtcbiAgICAgICAgICAgICAgICAvL2JzTG9hZGluZ092ZXJsYXlTZXJ2aWNlLnN0YXJ0KCk7XG4gICAgICAgICAgICAgICAgLy9hbGxQYWdlU2V0dGluZygpO1xuXG4gICAgICAgICAgICAgICAgLy9Mb29rIGF0IHRoZSBuZXh0IHBhcmFtZXRlciB2YWx1ZSB0byBkZXRlcm1pbmUgaWYgYSByZWRpcmVjdCBpcyBuZWVkZWRcblxuICAgICAgICAgICAgICAgIHZhciBhdXRoRGF0YSA9IGxvY2FsU3RvcmFnZVNlcnZpY2UuZ2V0KCdhdXRob3JpemF0aW9uRGF0YScpO1xuICAgICAgICAgICAgICAgIGlmIChhdXRoRGF0YSA9PT0gdW5kZWZpbmVkIHx8IGF1dGhEYXRhID09PSBudWxsIHx8IGF1dGhEYXRhLmF1dGhlbnRpY2F0aW9uID09PSB1bmRlZmluZWQgfHwgYXV0aERhdGEuYXV0aGVudGljYXRpb24uaXNBdXRoID09PSB1bmRlZmluZWQgfHwgYXV0aERhdGEuYXV0aGVudGljYXRpb24uaXNBdXRoID09PSBudWxsIHx8IGF1dGhEYXRhLmF1dGhlbnRpY2F0aW9uLmlzQXV0aCA9PT0gXCJcIikge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChhdXRoU2VydmljZSA9PSB1bmRlZmluZWQgfHwgKGF1dGhTZXJ2aWNlICE9PSB1bmRlZmluZWQgJiYgYXV0aFNlcnZpY2UuYXV0aGVudGljYXRpb24gIT0gdW5kZWZpbmVkICYmIGF1dGhTZXJ2aWNlLmF1dGhlbnRpY2F0aW9uICE9IG51bGwgJiYgYXV0aFNlcnZpY2UuYXV0aGVudGljYXRpb24uaXNBdXRoICE9PSB1bmRlZmluZWQgJiYgIWF1dGhTZXJ2aWNlLmF1dGhlbnRpY2F0aW9uLmlzQXV0aCkpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgbG9naW5QYWdlU2V0dGluZygpO1xuICAgICAgICAgICAgICAgICAgICAgICAgJGxvY2F0aW9uLnBhdGgoJy9sb2dpbicpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgYWxsUGFnZVNldHRpbmcoKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBpZiAobmV4dCAmJiBuZXh0LiQkcm91dGUgJiYgbmV4dC4kJHJvdXRlLm9yaWdpbmFsUGF0aCA9PSBcIi9sb2dpblwiKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGF1dGhEYXRhID09PSB1bmRlZmluZWQgfHwgYXV0aERhdGEgPT09IG51bGwgfHwgYXV0aERhdGEuYXV0aGVudGljYXRpb24gPT09IHVuZGVmaW5lZCB8fCBhdXRoRGF0YS5hdXRoZW50aWNhdGlvbi5pc0F1dGggPT09IHVuZGVmaW5lZCB8fCBhdXRoRGF0YS5hdXRoZW50aWNhdGlvbi5pc0F1dGggPT09IG51bGwgfHwgYXV0aERhdGEuYXV0aGVudGljYXRpb24uaXNBdXRoID09PSBcIlwiKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGxvZ2luUGFnZVNldHRpbmcoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICRsb2NhdGlvbi5wYXRoKCcvbG9naW4nKTtcclxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKGF1dGhTZXJ2aWNlLmF1dGhlbnRpY2F0aW9uLmlzQXV0aCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAkcm9vdFNjb3BlLiRldmFsQXN5bmMoZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJGxvY2F0aW9uLnBhdGgoJy9kYXNoYm9hcmQnKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgbG9naW5QYWdlU2V0dGluZygpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIGlmIChuZXh0ICYmIG5leHQuJCRyb3V0ZSAmJiBuZXh0LiQkcm91dGUuYXV0aG9yaXplKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgYWxsUGFnZVNldHRpbmcoKTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKCFhdXRoU2VydmljZS5hdXRoZW50aWNhdGlvbi5pc0F1dGgpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgJHJvb3RTY29wZS4kZXZhbEFzeW5jKGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvZ2luUGFnZVNldHRpbmcoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkbG9jYXRpb24ucGF0aCgnL2xvZ2luJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIGlmIChuZXh0ICYmIG5leHQuJCRyb3V0ZSAmJiAhYXV0aFNlcnZpY2UuYXV0aGVudGljYXRpb24uaXNBdXRoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgJHJvb3RTY29wZS4kZXZhbEFzeW5jKGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgbG9naW5QYWdlU2V0dGluZygpO1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCRsb2NhdGlvbi4kJHVybCAhPT0gdW5kZWZpbmVkICYmICRsb2NhdGlvbi4kJHVybCAhPT0gJycgJiYgJGxvY2F0aW9uLiQkdXJsLnRvTG93ZXJDYXNlKCkgPT09ICcvbG9naW4jbG9naW4nKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICRsb2NhdGlvbi51cmwoXCIvbG9naW5cIik7XG4gICAgICAgICAgICAgICAgICAgICAgICAkbG9jYXRpb24ucGF0aCgnL2xvZ2luJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgJHJvb3RTY29wZS4kb24oJyRyb3V0ZUNoYW5nZVN0YXJ0JywgZnVuY3Rpb24gKGV2ZW50LCBuZXh0LCBjdXJyZW50KSB7XHJcbiAgICAgICAgICAgICAgICAkcm9vdFNjb3BlLmNvbmZpZ1NlY3Rpb24gPSBcIlwiO1xuICAgICAgICAgICAgICAgIGlmICgoJHJvb3RTY29wZS5wYWdlQ2hhbmdlID09PSB1bmRlZmluZWQgfHwgJHJvb3RTY29wZS5wYWdlQ2hhbmdlID09PSBmYWxzZSkgJiYgY3VycmVudCAhPT0gdW5kZWZpbmVkICYmIGN1cnJlbnQuc2NvcGUgIT09IHVuZGVmaW5lZCAmJiBjdXJyZW50LnNjb3BlLnZtICE9PSB1bmRlZmluZWQgJiYgY3VycmVudC5zY29wZS52bS5wYWdlQ2hhbmdlICE9PSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgcmVkaXJlY3RQYXRoID0gXCIvZGFzaGJvYXJkXCI7XG4gICAgICAgICAgICAgICAgICAgIGlmIChuZXh0ICYmIG5leHQuJCRyb3V0ZSAmJiBuZXh0LiQkcm91dGUub3JpZ2luYWxQYXRoKVxuICAgICAgICAgICAgICAgICAgICAgICAgcmVkaXJlY3RQYXRoID0gbmV4dC4kJHJvdXRlLm9yaWdpbmFsUGF0aDtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGNoYW5nZXMgPSBuYXZjb24ucGFnZUNoYW5nZXMoY3VycmVudC5zY29wZS52bS5wYWdlQ2hhbmdlLCBjdXJyZW50LnNjb3BlLnZtLnBhZ2VTYXZlLCBmdW5jdGlvbiAoY29uZmlybSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoIWNvbmZpcm0pIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICRyb290U2NvcGUuJGV2YWxBc3luYyhmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJHJvb3RTY29wZS5wYWdlQ2hhbmdlID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJGxvY2F0aW9uLnBhdGgocmVkaXJlY3RQYXRoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICAvL2JzTG9hZGluZ092ZXJsYXlTZXJ2aWNlLnN0b3AoKTtcbiAgICAgICAgICAgICAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xyXG5cbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIHJvdXRlQ2hhbmdlU3RhcnQoZXZlbnQsIG5leHQsIGN1cnJlbnQpO1xyXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICRyb290U2NvcGUucGFnZUNoYW5nZSA9IGZhbHNlO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbn0pKCk7IiwiLy8gSW5jbHVkZSBpbiBpbmRleC5odG1sIHNvIHRoYXQgYXBwIGxldmVsIGV4Y2VwdGlvbnMgYXJlIGhhbmRsZWQuXG4oZnVuY3Rpb24gKCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIGFuZ3VsYXJcbiAgICAgICAgLm1vZHVsZSgnYmxvY2tzLmV4Y2VwdGlvbicpXG4gICAgICAgIC5wcm92aWRlcignZXhjZXB0aW9uSGFuZGxlcicsIGV4Y2VwdGlvbkhhbmRsZXJQcm92aWRlcilcbiAgICAgICAgLmNvbmZpZyhjb25maWcpO1xuXG4gICAgLyoqXG4gICAgICogTXVzdCBjb25maWd1cmUgdGhlIGV4Y2VwdGlvbiBoYW5kbGluZ1xuICAgICAqIEByZXR1cm4ge1t0eXBlXX1cbiAgICAgKi9cbiAgICBmdW5jdGlvbiBleGNlcHRpb25IYW5kbGVyUHJvdmlkZXIoKSB7XG5cbiAgICAgICAgdGhpcy5jb25maWcgPSB7XG4gICAgICAgICAgICBhcHBFcnJvclByZWZpeDogdW5kZWZpbmVkXG4gICAgICAgIH07XG5cbiAgICAgICAgdGhpcy5jb25maWd1cmUgPSBmdW5jdGlvbiAoYXBwRXJyb3JQcmVmaXgpIHtcbiAgICAgICAgICAgIHRoaXMuY29uZmlnLmFwcEVycm9yUHJlZml4ID0gYXBwRXJyb3JQcmVmaXg7XG4gICAgICAgIH07XG5cbiAgICAgICAgdGhpcy4kZ2V0ID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICBjb25maWc6IHRoaXMuY29uZmlnXG4gICAgICAgICAgICB9O1xuICAgICAgICB9O1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIENvbmZpZ3VyZSBieSBzZXR0aW5nIGFuIG9wdGlvbmFsIHN0cmluZyB2YWx1ZSBmb3IgYXBwRXJyb3JQcmVmaXguXG4gICAgICogQWNjZXNzaWJsZSB2aWEgY29uZmlnLmFwcEVycm9yUHJlZml4ICh2aWEgY29uZmlnIHZhbHVlKS5cbiAgICAgKiBAcGFyYW0gIHtbdHlwZV19ICRwcm92aWRlXG4gICAgICogQHJldHVybiB7W3R5cGVdfVxuICAgICAqIEBuZ0luamVjdFxuICAgICAqL1xuICAgIGZ1bmN0aW9uIGNvbmZpZygkcHJvdmlkZSkge1xuICAgICAgICAkcHJvdmlkZS5kZWNvcmF0b3IoJyRleGNlcHRpb25IYW5kbGVyJywgZXh0ZW5kRXhjZXB0aW9uSGFuZGxlcik7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogRXh0ZW5kIHRoZSAkZXhjZXB0aW9uSGFuZGxlciBzZXJ2aWNlIHRvIGFsc28gZGlzcGxheSBhIHRvYXN0LlxuICAgICAqIEBwYXJhbSAge09iamVjdH0gJGRlbGVnYXRlXG4gICAgICogQHBhcmFtICB7T2JqZWN0fSBleGNlcHRpb25IYW5kbGVyXG4gICAgICogQHBhcmFtICB7T2JqZWN0fSBsb2dnZXJcbiAgICAgKiBAcmV0dXJuIHtGdW5jdGlvbn0gdGhlIGRlY29yYXRlZCAkZXhjZXB0aW9uSGFuZGxlciBzZXJ2aWNlXG4gICAgICovXG4gICAgZnVuY3Rpb24gZXh0ZW5kRXhjZXB0aW9uSGFuZGxlcigkZGVsZWdhdGUsIGV4Y2VwdGlvbkhhbmRsZXIsIGxvZ2dlciwgJGluamVjdG9yKSB7XG4gICAgICAgIHJldHVybiBmdW5jdGlvbiAoZXhjZXB0aW9uLCBjYXVzZSkge1xuICAgICAgICAgICAgdmFyIGFwcEVycm9yUHJlZml4ID0gZXhjZXB0aW9uSGFuZGxlci5jb25maWcuYXBwRXJyb3JQcmVmaXggfHwgJyc7XG4gICAgICAgICAgICB2YXIgZXJyb3JEYXRhID0ge1xuICAgICAgICAgICAgICAgIGV4Y2VwdGlvbjogZXhjZXB0aW9uLFxuICAgICAgICAgICAgICAgIGNhdXNlOiBjYXVzZVxuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIGV4Y2VwdGlvbi5tZXNzYWdlID0gYXBwRXJyb3JQcmVmaXggKyBleGNlcHRpb24ubWVzc2FnZTtcbiAgICAgICAgICAgICRkZWxlZ2F0ZShleGNlcHRpb24sIGNhdXNlKTtcbiAgICAgICAgICAgIC8qKlxuICAgICAgICAgICAgICogQ291bGQgYWRkIHRoZSBlcnJvciB0byBhIHNlcnZpY2UncyBjb2xsZWN0aW9uLFxuICAgICAgICAgICAgICogYWRkIGVycm9ycyB0byAkcm9vdFNjb3BlLCBsb2cgZXJyb3JzIHRvIHJlbW90ZSB3ZWIgc2VydmVyLFxuICAgICAgICAgICAgICogb3IgbG9nIGxvY2FsbHkuIE9yIHRocm93IGhhcmQuIEl0IGlzIGVudGlyZWx5IHVwIHRvIHlvdS5cbiAgICAgICAgICAgICAqIHRocm93IGV4Y2VwdGlvbjtcbiAgICAgICAgICAgICAqXG4gICAgICAgICAgICAgKiBAZXhhbXBsZVxuICAgICAgICAgICAgICogICAgIHRocm93IHsgbWVzc2FnZTogJ2Vycm9yIG1lc3NhZ2Ugd2UgYWRkZWQnIH07XG4gICAgICAgICAgICAgKi9cbiAgICAgICAgICAgIHZhciBsb2NhbFN0b3JhZ2VTZXJ2aWNlID0gJGluamVjdG9yLmdldCgnbG9jYWxTdG9yYWdlU2VydmljZScpO1xuICAgICAgICAgICAgdmFyIGF1dGhEYXRhID0gbG9jYWxTdG9yYWdlU2VydmljZS5nZXQoJ2F1dGhvcml6YXRpb25EYXRhJyk7XG5cbiAgICAgICAgICAgIGlmKGF1dGhEYXRhICE9PSBudWxsKSB7XG4gICAgICAgICAgICAgICAgbG9nZ2VyLmVycm9yKGV4Y2VwdGlvbi5tZXNzYWdlLCBlcnJvckRhdGEpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAvLyBjb25zb2xlLmxvZyhcIkV4Y2VwdGlvbjogXCIgKyBleGNlcHRpb24ubWVzc2FnZSk7XG4gICAgICAgIH07XG4gICAgfVxufSkoKTsiLCIoZnVuY3Rpb24gKCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIGFuZ3VsYXJcbiAgICAgICAgLm1vZHVsZSgnYmxvY2tzLmV4Y2VwdGlvbicpXG4gICAgICAgIC5mYWN0b3J5KCdleGNlcHRpb24nLCBleGNlcHRpb24pO1xuXG4gICAgZnVuY3Rpb24gZXhjZXB0aW9uKGxvZ2dlcikge1xuICAgICAgICB2YXIgc2VydmljZSA9IHtcbiAgICAgICAgICAgIGNhdGNoZXI6IGNhdGNoZXJcbiAgICAgICAgfTtcbiAgICAgICAgcmV0dXJuIHNlcnZpY2U7XG5cbiAgICAgICAgZnVuY3Rpb24gY2F0Y2hlcihtZXNzYWdlKSB7XG4gICAgICAgICAgICByZXR1cm4gZnVuY3Rpb24gKHJlYXNvbikge1xuICAgICAgICAgICAgICAgIGlmKHJlYXNvbi5zdGF0dXMgPT09IDUwMCB8fCByZWFzb24uc3RhdHVzID09PSA0MTUgfHwgcmVhc29uLnN0YXR1cyA9PT0gNDA1ICkgLy9JbnRlcm5hbFNlcnZlckVycm9yIG9yIFVuc3VwcG9ydGVkTWVkaWFUeXBlIG9yIE1ldGhvZE5vdEFsbG93ZWRcbiAgICAgICAgICAgICAgICAgICAgbG9nZ2VyLmVycm9yKG1lc3NhZ2UsIHJlYXNvbik7XG4gICAgICAgICAgICAgICAgZWxzZVxuICAgICAgICAgICAgICAgICAgICBsb2dnZXIud2FybmluZyhtZXNzYWdlLCByZWFzb24pO1xuICAgICAgICAgICAgfTtcbiAgICAgICAgfVxuICAgIH1cbn0pKCk7XG5cbiIsIid1c2Ugc3RyaWN0JztcclxuYW5ndWxhci5tb2R1bGUoJ2FwcCcpLmZhY3RvcnkoJ2F1dGhTZXJ2aWNlJywgWyckaHR0cCcsICckcScsICdsb2NhbFN0b3JhZ2VTZXJ2aWNlJywgJ25nQXV0aFNldHRpbmdzJywgJ2xvZ2dlcicsICckbG9jYXRpb24nLCAnJHJvb3RTY29wZScsIGZ1bmN0aW9uICgkaHR0cCwgJHEsIGxvY2FsU3RvcmFnZVNlcnZpY2UsIG5nQXV0aFNldHRpbmdzLCBsb2dnZXIsICRsb2NhdGlvbiwgJHJvb3RTY29wZSkge1xyXG5cclxuICAgIHZhciBsb2dpblNlcnZpY2VVcmkgPSBuZ0F1dGhTZXR0aW5ncy5sb2dpblNlcnZpY2VVcmk7XHJcbiAgICB2YXIgc2VydmljZUJhc2UgPSBuZ0F1dGhTZXR0aW5ncy5hcGlTZXJ2aWNlQmFzZVVyaTtcclxuICAgIHZhciBhdXRoU2VydmljZUZhY3RvcnkgPSB7fTtcclxuXHJcbiAgICB2YXIgX2F1dGhlbnRpY2F0aW9uID0ge1xyXG4gICAgICAgIGlzQXV0aDogZmFsc2UsXHJcbiAgICAgICAgdXNlck5hbWU6IFwiXCIsXHJcbiAgICAgICAgdXNlcklkOiAtMSxcclxuICAgICAgICB1c2VSZWZyZXNoVG9rZW5zOiBmYWxzZSxcclxuICAgICAgICB1c2VyUmlnaHRzOiB7fSxcclxuICAgICAgICBub3RpZmljYXRpb246IHt9LFxyXG4gICAgICAgIERlc2lnbmF0aW9uOiBcIlwiLFxyXG4gICAgICAgIFJvbGVzOiB7fSxcclxuICAgICAgICB2ZXJzaW9uOlwiXCJcclxuICAgIH07XHJcblxyXG4gICAgdmFyIF9leHRlcm5hbEF1dGhEYXRhID0ge1xyXG4gICAgICAgIHByb3ZpZGVyOiBcIlwiLFxyXG4gICAgICAgIHVzZXJOYW1lOiBcIlwiLFxyXG4gICAgICAgIGV4dGVybmFsQWNjZXNzVG9rZW46IFwiXCJcclxuICAgIH07XHJcblxyXG4gICAgdmFyIF9zYXZlUmVnaXN0cmF0aW9uID0gZnVuY3Rpb24gKHJlZ2lzdHJhdGlvbikge1xyXG5cclxuICAgICAgICBfbG9nT3V0KCk7XHJcblxyXG4gICAgICAgIHJldHVybiAkaHR0cC5wb3N0KHNlcnZpY2VCYXNlICsgJ2FwaS9hY2NvdW50L3JlZ2lzdGVyJywgcmVnaXN0cmF0aW9uKS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkge1xyXG4gICAgICAgICAgICByZXR1cm4gcmVzcG9uc2U7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgfTtcclxuXHJcbiAgICB2YXIgX2xvZ2luID0gZnVuY3Rpb24gKGxvZ2luRGF0YSkge1xyXG5cclxuICAgICAgICB2YXIgZGF0YSA9IFwiZ3JhbnRfdHlwZT1wYXNzd29yZCZ1c2VybmFtZT1cIiArIGxvZ2luRGF0YS51c2VyTmFtZSArIFwiJnBhc3N3b3JkPVwiICsgbG9naW5EYXRhLnBhc3N3b3JkICsgXCImdGltZXpvbmU9XCIgKyBuYXZjb24uZGVmYXVsdEZvcm1hdCgpLnRpbWVab25lO1xyXG4gICAgICAgIC8vIHZhciBkYXRhID0gXCJncmFudF90eXBlPXBhc3N3b3JkJnVzZXJuYW1lPVwiICsgXCJVU1IwMDFcIiArIFwiJnBhc3N3b3JkPVwiICsgXCJTYWZldGFsMSFcIjtcclxuICAgICAgICAvKiBpZiAobG9naW5EYXRhLnVzZVJlZnJlc2hUb2tlbnMpIHtcclxuICAgICAgICAgICAgIGRhdGEgPSBkYXRhICsgXCImY2xpZW50X2lkPVwiICsgbmdBdXRoU2V0dGluZ3MuY2xpZW50SWQ7XHJcbiAgICAgICAgIH0qL1xyXG5cclxuICAgICAgICB2YXIgZGVmZXJyZWQgPSAkcS5kZWZlcigpO1xyXG5cclxuXHJcblxyXG4gICAgICAgICRodHRwLnBvc3QobG9naW5TZXJ2aWNlVXJpICsgJ29hdXRoL3Rva2VuJywgZGF0YSwgeyBoZWFkZXJzOiB7ICdDb250ZW50LVR5cGUnOiAnYXBwbGljYXRpb24veC13d3ctZm9ybS11cmxlbmNvZGVkJyB9IH0pLnN1Y2Nlc3MoZnVuY3Rpb24gKHJlc3BvbnNlKSB7XHJcblxyXG4gICAgICAgICAgICB2YXIgYWNjZXNzVG9rZW4gPSByZXNwb25zZS5hY2Nlc3NfdG9rZW47XHJcbiAgICAgICAgICAgIF9hdXRoZW50aWNhdGlvbi5pc0F1dGggPSB0cnVlO1xyXG5cclxuICAgICAgICAgICAgaWYocmVzcG9uc2UudXNlck5hbWUgIT09IHVuZGVmaW5lZCAmJiByZXNwb25zZS51c2VyTmFtZSAhPT0gXCJcIilcclxuICAgICAgICAgICAgICAgIF9hdXRoZW50aWNhdGlvbi51c2VyTmFtZSA9IHJlc3BvbnNlLnVzZXJOYW1lO1xyXG4gICAgICAgICAgICBlbHNlXHJcbiAgICAgICAgICAgICAgICBfYXV0aGVudGljYXRpb24udXNlck5hbWUgPSBsb2dpbkRhdGEudXNlck5hbWU7XHJcblxyXG5cclxuICAgICAgICAgICAgX2F1dGhlbnRpY2F0aW9uLnVzZVJlZnJlc2hUb2tlbnMgPSBsb2dpbkRhdGEudXNlUmVmcmVzaFRva2VucztcclxuICAgICAgICAgICAgX2F1dGhlbnRpY2F0aW9uLnVzZXJJZCA9IHJlc3BvbnNlLlVzZXJJZDtcclxuXHJcbiAgICAgICAgICAgIGlmIChsb2dpbkRhdGEudXNlUmVmcmVzaFRva2Vucykge1xyXG4gICAgICAgICAgICAgICAgbG9jYWxTdG9yYWdlU2VydmljZS5zZXQoJ2F1dGhvcml6YXRpb25EYXRhJywgeyB0b2tlbjogYWNjZXNzVG9rZW4sIHVzZXJOYW1lOiBfYXV0aGVudGljYXRpb24udXNlck5hbWUsIHVzZXJJZDogX2F1dGhlbnRpY2F0aW9uLnVzZXJJZCwgcmVmcmVzaFRva2VuOiBfYXV0aGVudGljYXRpb24udXNlUmVmcmVzaFRva2VucywgdXNlUmVmcmVzaFRva2VuczogdHJ1ZSB9KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgIGxvY2FsU3RvcmFnZVNlcnZpY2Uuc2V0KCdhdXRob3JpemF0aW9uRGF0YScsIHsgdG9rZW46IGFjY2Vzc1Rva2VuLCB1c2VyTmFtZTogX2F1dGhlbnRpY2F0aW9uLnVzZXJOYW1lLCB1c2VySWQ6IF9hdXRoZW50aWNhdGlvbi51c2VySWQsIHJlZnJlc2hUb2tlbjogX2F1dGhlbnRpY2F0aW9uLnVzZVJlZnJlc2hUb2tlbnMsIHVzZVJlZnJlc2hUb2tlbnM6IGZhbHNlIH0pO1xyXG4gICAgICAgICAgICB9XHJcblxyXG5cclxuICAgICAgICAgICAgICAgICRyb290U2NvcGUuJGJyb2FkY2FzdCgnU1RBUlQtQUxFUlQnKTtcclxuICAgICAgICAgICAgICAgIC8vIEdldCBVc2VyUmlnaHRzIGJ5IElkIC8vc2hvdWxkIGJlIHJldm9rZWRcclxuICAgICAgICAgICAgICAgICRodHRwLmdldChzZXJ2aWNlQmFzZSArICdTZWN1cml0eS9HZXRVc2VyQWNjZXNzJywgeyBoZWFkZXJzOiB7ICdDb250ZW50LVR5cGUnOiAnYXBwbGljYXRpb24vanNvbicsICdBdXRob3JpemF0aW9uJzogJ0JlYXJlciAnICsgYWNjZXNzVG9rZW4gfSB9KS5zdWNjZXNzKGZ1bmN0aW9uIChkYXRhKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgLy8gJGh0dHAuZ2V0KCdyZWZlcmVuY2UvZGF0YVNlY3VyaXR5Lmpzb24nKS5zdWNjZXNzKGZ1bmN0aW9uIChkYXRhKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgX2F1dGhlbnRpY2F0aW9uLnVzZXJSaWdodHMgPSBkYXRhLlNlY3VyaXR5QWNjZXNzO1xyXG4gICAgICAgICAgICAgICAgICAgIF9hdXRoZW50aWNhdGlvbi5ub3RpZmljYXRpb24gPSBkYXRhLk5vdGlmaWNhdGlvbnM7ICAgICAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgICAgICAgICBfYXV0aGVudGljYXRpb24uRmlyc3ROYW1lID0gZGF0YS5GaXJzdE5hbWU7XHJcbiAgICAgICAgICAgICAgICAgICAgX2F1dGhlbnRpY2F0aW9uLkxhc3ROYW1lID0gZGF0YS5MYXN0TmFtZTtcclxuICAgICAgICAgICAgICAgICAgICBfYXV0aGVudGljYXRpb24uRGVzaWduYXRpb24gPSBkYXRhLkRlc2lnbmF0aW9uO1xyXG4gICAgICAgICAgICAgICAgICAgIF9hdXRoZW50aWNhdGlvbi5Sb2xlcyA9IGRhdGEuUm9sZXM7XHJcbiAgICAgICAgICAgICAgICAgICAgX2F1dGhlbnRpY2F0aW9uLnZlcnNpb24gPSBkYXRhLlNhZmV0YWxWZXJzaW9uO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChsb2dpbkRhdGEudXNlUmVmcmVzaFRva2Vucykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBsb2NhbFN0b3JhZ2VTZXJ2aWNlLnNldCgnYXV0aG9yaXphdGlvbkRhdGEnLCB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b2tlbjogYWNjZXNzVG9rZW4sIHVzZXJOYW1lOiBfYXV0aGVudGljYXRpb24udXNlck5hbWUsIHVzZXJJZDogX2F1dGhlbnRpY2F0aW9uLnVzZXJJZCxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVzZXJSaWdodHM6IGRhdGEuU2VjdXJpdHlBY2Nlc3MsIHJlZnJlc2hUb2tlbjogX2F1dGhlbnRpY2F0aW9uLnVzZVJlZnJlc2hUb2tlbnMsIHVzZVJlZnJlc2hUb2tlbnM6IHRydWUsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBub3RpZmljYXRpb246IGRhdGEuTm90aWZpY2F0aW9ucywgICAgICAgICAgICAgICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBGaXJzdE5hbWU6IGRhdGEuRmlyc3ROYW1lLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgTGFzdE5hbWU6IGRhdGEuTGFzdE5hbWUsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBEZXNpZ25hdGlvbjogZGF0YS5EZXNpZ25hdGlvbixcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFJvbGVzOiBkYXRhLlJvbGVzLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmVyc2lvbjogZGF0YS5TYWZldGFsVmVyc2lvblxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsU3RvcmFnZVNlcnZpY2Uuc2V0KCdhdXRob3JpemF0aW9uRGF0YScsIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRva2VuOiBhY2Nlc3NUb2tlbiwgdXNlck5hbWU6IF9hdXRoZW50aWNhdGlvbi51c2VyTmFtZSwgdXNlcklkOiBfYXV0aGVudGljYXRpb24udXNlcklkLCB1c2VyUmlnaHRzOiBkYXRhLlNlY3VyaXR5QWNjZXNzLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVmcmVzaFRva2VuOiBfYXV0aGVudGljYXRpb24udXNlUmVmcmVzaFRva2VucywgdXNlUmVmcmVzaFRva2VuczogZmFsc2UsIG5vdGlmaWNhdGlvbjogZGF0YS5Ob3RpZmljYXRpb25zLCAgICAgICAgICAgICAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIEZpcnN0TmFtZTogZGF0YS5GaXJzdE5hbWUsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBMYXN0TmFtZTogZGF0YS5MYXN0TmFtZSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIERlc2lnbmF0aW9uOiBkYXRhLkRlc2lnbmF0aW9uLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgUm9sZXM6IGRhdGEuUm9sZXMsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2ZXJzaW9uOiBkYXRhLlNhZmV0YWxWZXJzaW9uXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgZGVmZXJyZWQucmVzb2x2ZShkYXRhLlNlY3VyaXR5QWNjZXNzKTtcclxuXHJcbiAgICAgICAgICAgICAgICB9KS5lcnJvcihmdW5jdGlvbiAoZXJyLCBzdGF0dXMpIHtcclxuICAgICAgICAgICAgICAgICAgICBfbG9nT3V0KCk7XHJcbiAgICAgICAgICAgICAgICAgICAgZGVmZXJyZWQucmVqZWN0KGVycik7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgIH0pLmVycm9yKGZ1bmN0aW9uIChlcnIsIHN0YXR1cykge1xyXG4gICAgICAgICAgICBfbG9nT3V0KCk7XHJcbiAgICAgICAgICAgIGRlZmVycmVkLnJlamVjdChlcnIpO1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICByZXR1cm4gZGVmZXJyZWQucHJvbWlzZTtcclxuXHJcbiAgICB9O1xyXG5cclxuXHJcbiAgICB2YXIgX2xvZ091dCA9IGZ1bmN0aW9uIChjYWxsYmFjaykge1xyXG4gICAgICAgIGlmICghX2F1dGhlbnRpY2F0aW9uLmlzQXV0aCkgcmV0dXJuO1xyXG4gICAgICAgICRodHRwLmdldChzZXJ2aWNlQmFzZSArICdNeVByb2ZpbGUvTG9nb3V0JywgeyBoZWFkZXJzOiB7ICdDb250ZW50LVR5cGUnOiAnYXBwbGljYXRpb24vanNvbicgfSB9KS5zdWNjZXNzKGZ1bmN0aW9uIChkYXRhKSB7XHJcbiAgICAgICAgICAgIF9jbGVhclNlc3Npb24oKTtcclxuICAgICAgICAgICAgLy8kbG9jYXRpb24ucGF0aCgnL2xvZ2luJyk7XHJcbiAgICAgICAgICAgIGlmIChjYWxsYmFjayAhPT0gdW5kZWZpbmVkKSBjYWxsYmFjaygnbG9nb3V0Jyk7XHJcbiAgICAgICAgfSlcclxuICAgIH07XHJcblxyXG5cclxuICAgIHZhciBfY2xlYXJTZXNzaW9uID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIGxvY2FsU3RvcmFnZVNlcnZpY2UucmVtb3ZlKCdhdXRob3JpemF0aW9uRGF0YScpO1xyXG5cclxuICAgICAgICBfYXV0aGVudGljYXRpb24uaXNBdXRoID0gZmFsc2U7XHJcbiAgICAgICAgX2F1dGhlbnRpY2F0aW9uLnVzZXJOYW1lID0gXCJcIjtcclxuICAgICAgICBfYXV0aGVudGljYXRpb24udXNlcklkID0gLTE7XHJcbiAgICAgICAgX2F1dGhlbnRpY2F0aW9uLnVzZVJlZnJlc2hUb2tlbnMgPSBmYWxzZTtcclxuICAgICAgICBfYXV0aGVudGljYXRpb24udXNlclJpZ2h0cyA9IHt9O1xyXG4gICAgICAgIF9hdXRoZW50aWNhdGlvbi5ub3RpZmljYXRpb24gPSB7fTtcclxuICAgICAgICBfYXV0aGVudGljYXRpb24uRGVzaWduYXRpb24gPSBcIlwiO1xyXG4gICAgICAgIF9hdXRoZW50aWNhdGlvbi5Sb2xlcyA9IHt9O1xyXG4gICAgICAgIF9hdXRoZW50aWNhdGlvbi52ZXJzaW9uID0gXCJcIjtcclxuICAgICAgICBcclxuICAgIH1cclxuXHJcblxyXG4gICAgdmFyIF93aW5kb3dzQ2xvc2VMb2dPdXQgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgdmFyIGF1dGhEYXRhID0gbG9jYWxTdG9yYWdlU2VydmljZS5nZXQoJ2F1dGhvcml6YXRpb25EYXRhJyk7XHJcbiAgICAgICAgaWYgKCFfYXV0aGVudGljYXRpb24uaXNBdXRoKSByZXR1cm47XHJcbiAgICAgICAgX2NsZWFyU2Vzc2lvbigpO1xyXG4gICAgICAgIGpRdWVyeS5hamF4KHtcclxuICAgICAgICAgICAgdXJsOiBzZXJ2aWNlQmFzZSArICdNeVByb2ZpbGUvTG9nb3V0JyxcclxuICAgICAgICAgICAgYXN5bmM6IGZhbHNlLFxyXG4gICAgICAgICAgICBiZWZvcmVTZW5kOiBmdW5jdGlvbiAoeGhyKSB7XHJcbiAgICAgICAgICAgICAgICB4aHIuc2V0UmVxdWVzdEhlYWRlcihcIkF1dGhvcml6YXRpb25cIiwgXCJCZWFyZXIgXCIgKyBhdXRoRGF0YS50b2tlbik7XHJcbiAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgIHN1Y2Nlc3M6IGZ1bmN0aW9uIChyZXNwb25zZSkge1xyXG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2cocmVzcG9uc2UpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICB9O1xyXG5cclxuXHJcblxyXG4gICAgdmFyIF9maWxsQXV0aERhdGEgPSBmdW5jdGlvbiAoKSB7XHJcblxyXG4gICAgICAgIHZhciBhdXRoRGF0YSA9IGxvY2FsU3RvcmFnZVNlcnZpY2UuZ2V0KCdhdXRob3JpemF0aW9uRGF0YScpO1xyXG4gICAgICAgIGlmIChhdXRoRGF0YSkge1xyXG4gICAgICAgICAgICBfYXV0aGVudGljYXRpb24uaXNBdXRoID0gdHJ1ZTtcclxuICAgICAgICAgICAgX2F1dGhlbnRpY2F0aW9uLnVzZXJOYW1lID0gYXV0aERhdGEudXNlck5hbWU7XHJcbiAgICAgICAgICAgIF9hdXRoZW50aWNhdGlvbi51c2VySWQgPSBhdXRoRGF0YS51c2VySWQ7XHJcbiAgICAgICAgICAgIF9hdXRoZW50aWNhdGlvbi51c2VSZWZyZXNoVG9rZW5zID0gYXV0aERhdGEudXNlUmVmcmVzaFRva2VucztcclxuICAgICAgICAgICAgX2F1dGhlbnRpY2F0aW9uLnVzZXJSaWdodHMgPSBhdXRoRGF0YS51c2VyUmlnaHRzO1xyXG4gICAgICAgICAgICBfYXV0aGVudGljYXRpb24ubm90aWZpY2F0aW9uID0gYXV0aERhdGEubm90aWZpY2F0aW9uO1xyXG4gICAgICAgICAgICBfYXV0aGVudGljYXRpb24uRGVzaWduYXRpb24gPSBhdXRoRGF0YS5EZXNpZ25hdGlvbjtcclxuICAgICAgICAgICAgX2F1dGhlbnRpY2F0aW9uLlJvbGVzID0gYXV0aERhdGEuUm9sZXM7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgIH1cclxuXHJcbiAgICB9O1xyXG5cclxuICAgIHZhciBfcmVmcmVzaFRva2VuID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHZhciBkZWZlcnJlZCA9ICRxLmRlZmVyKCk7XHJcblxyXG4gICAgICAgIHZhciBhdXRoRGF0YSA9IGxvY2FsU3RvcmFnZVNlcnZpY2UuZ2V0KCdhdXRob3JpemF0aW9uRGF0YScpO1xyXG5cclxuICAgICAgICBpZiAoYXV0aERhdGEpIHtcclxuXHJcbiAgICAgICAgICAgIGlmIChhdXRoRGF0YS51c2VSZWZyZXNoVG9rZW5zKSB7XHJcblxyXG4gICAgICAgICAgICAgICAgdmFyIGRhdGEgPSBcImdyYW50X3R5cGU9cmVmcmVzaF90b2tlbiZyZWZyZXNoX3Rva2VuPVwiICsgYXV0aERhdGEucmVmcmVzaFRva2VuICsgXCImY2xpZW50X2lkPVwiICsgbmdBdXRoU2V0dGluZ3MuY2xpZW50SWQ7XHJcblxyXG4gICAgICAgICAgICAgICAgbG9jYWxTdG9yYWdlU2VydmljZS5yZW1vdmUoJ2F1dGhvcml6YXRpb25EYXRhJyk7XHJcblxyXG4gICAgICAgICAgICAgICAgJGh0dHAucG9zdChzZXJ2aWNlQmFzZSArICd0b2tlbicsIGRhdGEsIHsgaGVhZGVyczogeyAnQ29udGVudC1UeXBlJzogJ2FwcGxpY2F0aW9uL3gtd3d3LWZvcm0tdXJsZW5jb2RlZCcgfSB9KS5zdWNjZXNzKGZ1bmN0aW9uIChyZXNwb25zZSkge1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAkaHR0cC5nZXQoc2VydmljZUJhc2UgKyAnVXNlci9HZXRCeU5hbWUvJyArIHJlc3BvbnNlLnVzZXJOYW1lLCB7IGhlYWRlcnM6IHsgJ0NvbnRlbnQtVHlwZSc6ICdhcHBsaWNhdGlvbi9qc29uJyB9IH0pLnN1Y2Nlc3MoZnVuY3Rpb24gKHVzZXJJZCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBsb2NhbFN0b3JhZ2VTZXJ2aWNlLnNldCgnYXV0aG9yaXphdGlvbkRhdGEnLCB7IHRva2VuOiByZXNwb25zZS5hY2Nlc3NfdG9rZW4sIHVzZXJOYW1lOiByZXNwb25zZS51c2VyTmFtZSwgdXNlcklkOiB1c2VySWQsIHJlZnJlc2hUb2tlbjogcmVzcG9uc2UucmVmcmVzaF90b2tlbiwgdXNlUmVmcmVzaFRva2VuczogdHJ1ZSB9KTtcclxuICAgICAgICAgICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgLy9sb2NhbFN0b3JhZ2VTZXJ2aWNlLnNldCgnYXV0aG9yaXphdGlvbkRhdGEnLCB7IHRva2VuOiByZXNwb25zZS5hY2Nlc3NfdG9rZW4sIHVzZXJOYW1lOiByZXNwb25zZS51c2VyTmFtZSwgcmVmcmVzaFRva2VuOiByZXNwb25zZS5yZWZyZXNoX3Rva2VuLCB1c2VSZWZyZXNoVG9rZW5zOiB0cnVlIH0pO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICBkZWZlcnJlZC5yZXNvbHZlKHJlc3BvbnNlKTtcclxuXHJcbiAgICAgICAgICAgICAgICB9KS5lcnJvcihmdW5jdGlvbiAoZXJyLCBzdGF0dXMpIHtcclxuICAgICAgICAgICAgICAgICAgICBfbG9nT3V0KCk7XHJcbiAgICAgICAgICAgICAgICAgICAgZGVmZXJyZWQucmVqZWN0KGVycik7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcmV0dXJuIGRlZmVycmVkLnByb21pc2U7XHJcbiAgICB9O1xyXG5cclxuICAgIHZhciBfb2J0YWluQWNjZXNzVG9rZW4gPSBmdW5jdGlvbiAoZXh0ZXJuYWxEYXRhKSB7XHJcblxyXG4gICAgICAgIHZhciBkZWZlcnJlZCA9ICRxLmRlZmVyKCk7XHJcblxyXG4gICAgICAgICRodHRwLmdldChzZXJ2aWNlQmFzZSArICdhcGkvYWNjb3VudC9PYnRhaW5Mb2NhbEFjY2Vzc1Rva2VuJywgeyBwYXJhbXM6IHsgcHJvdmlkZXI6IGV4dGVybmFsRGF0YS5wcm92aWRlciwgZXh0ZXJuYWxBY2Nlc3NUb2tlbjogZXh0ZXJuYWxEYXRhLmV4dGVybmFsQWNjZXNzVG9rZW4gfSB9KS5zdWNjZXNzKGZ1bmN0aW9uIChyZXNwb25zZSkge1xyXG5cclxuICAgICAgICAgICAgJGh0dHAuZ2V0KHNlcnZpY2VCYXNlICsgJ1VzZXIvR2V0QnlOYW1lLycgKyByZXNwb25zZS51c2VyTmFtZSwgeyBoZWFkZXJzOiB7ICdDb250ZW50LVR5cGUnOiAnYXBwbGljYXRpb24vanNvbicgfSB9KS5zdWNjZXNzKGZ1bmN0aW9uICh1c2VySWQpIHtcclxuICAgICAgICAgICAgICAgIGxvY2FsU3RvcmFnZVNlcnZpY2Uuc2V0KCdhdXRob3JpemF0aW9uRGF0YScsIHsgdG9rZW46IHJlc3BvbnNlLmFjY2Vzc190b2tlbiwgdXNlck5hbWU6IHJlc3BvbnNlLnVzZXJOYW1lLCB1c2VySWQ6IHVzZXJJZCwgcmVmcmVzaFRva2VuOiBcIlwiLCB1c2VSZWZyZXNoVG9rZW5zOiBmYWxzZSB9KTtcclxuICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICAvL2xvY2FsU3RvcmFnZVNlcnZpY2Uuc2V0KCdhdXRob3JpemF0aW9uRGF0YScsIHsgdG9rZW46IHJlc3BvbnNlLmFjY2Vzc190b2tlbiwgdXNlck5hbWU6IHJlc3BvbnNlLnVzZXJOYW1lLCByZWZyZXNoVG9rZW46IFwiXCIsIHVzZVJlZnJlc2hUb2tlbnM6IGZhbHNlIH0pO1xyXG5cclxuICAgICAgICAgICAgX2F1dGhlbnRpY2F0aW9uLmlzQXV0aCA9IHRydWU7XHJcbiAgICAgICAgICAgIF9hdXRoZW50aWNhdGlvbi51c2VyTmFtZSA9IHJlc3BvbnNlLnVzZXJOYW1lO1xyXG4gICAgICAgICAgICBfYXV0aGVudGljYXRpb24udXNlUmVmcmVzaFRva2VucyA9IGZhbHNlO1xyXG5cclxuICAgICAgICAgICAgZGVmZXJyZWQucmVzb2x2ZShyZXNwb25zZSk7XHJcblxyXG4gICAgICAgIH0pLmVycm9yKGZ1bmN0aW9uIChlcnIsIHN0YXR1cykge1xyXG4gICAgICAgICAgICBfbG9nT3V0KCk7XHJcbiAgICAgICAgICAgIGRlZmVycmVkLnJlamVjdChlcnIpO1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICByZXR1cm4gZGVmZXJyZWQucHJvbWlzZTtcclxuXHJcbiAgICB9O1xyXG5cclxuICAgIHZhciBfcmVnaXN0ZXJFeHRlcm5hbCA9IGZ1bmN0aW9uIChyZWdpc3RlckV4dGVybmFsRGF0YSkge1xyXG5cclxuICAgICAgICB2YXIgZGVmZXJyZWQgPSAkcS5kZWZlcigpO1xyXG5cclxuICAgICAgICAkaHR0cC5wb3N0KHNlcnZpY2VCYXNlICsgJ2FwaS9hY2NvdW50L3JlZ2lzdGVyZXh0ZXJuYWwnLCByZWdpc3RlckV4dGVybmFsRGF0YSkuc3VjY2VzcyhmdW5jdGlvbiAocmVzcG9uc2UpIHtcclxuXHJcbiAgICAgICAgICAgICRodHRwLmdldChzZXJ2aWNlQmFzZSArICdVc2VyL0dldEJ5TmFtZS8nICsgcmVzcG9uc2UudXNlck5hbWUsIHsgaGVhZGVyczogeyAnQ29udGVudC1UeXBlJzogJ2FwcGxpY2F0aW9uL2pzb24nIH0gfSkuc3VjY2VzcyhmdW5jdGlvbiAodXNlcklkKSB7XHJcbiAgICAgICAgICAgICAgICBsb2NhbFN0b3JhZ2VTZXJ2aWNlLnNldCgnYXV0aG9yaXphdGlvbkRhdGEnLCB7IHRva2VuOiByZXNwb25zZS5hY2Nlc3NfdG9rZW4sIHVzZXJOYW1lOiByZXNwb25zZS51c2VyTmFtZSwgdXNlcklkOiB1c2VySWQsIHJlZnJlc2hUb2tlbjogXCJcIiwgdXNlUmVmcmVzaFRva2VuczogZmFsc2UgfSk7XHJcbiAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgLy9sb2NhbFN0b3JhZ2VTZXJ2aWNlLnNldCgnYXV0aG9yaXphdGlvbkRhdGEnLCB7IHRva2VuOiByZXNwb25zZS5hY2Nlc3NfdG9rZW4sIHVzZXJOYW1lOiByZXNwb25zZS51c2VyTmFtZSwgcmVmcmVzaFRva2VuOiBcIlwiLCB1c2VSZWZyZXNoVG9rZW5zOiBmYWxzZSB9KTtcclxuXHJcbiAgICAgICAgICAgIF9hdXRoZW50aWNhdGlvbi5pc0F1dGggPSB0cnVlO1xyXG4gICAgICAgICAgICBfYXV0aGVudGljYXRpb24udXNlck5hbWUgPSByZXNwb25zZS51c2VyTmFtZTtcclxuICAgICAgICAgICAgX2F1dGhlbnRpY2F0aW9uLnVzZVJlZnJlc2hUb2tlbnMgPSBmYWxzZTtcclxuXHJcbiAgICAgICAgICAgIGRlZmVycmVkLnJlc29sdmUocmVzcG9uc2UpO1xyXG5cclxuICAgICAgICB9KS5lcnJvcihmdW5jdGlvbiAoZXJyLCBzdGF0dXMpIHtcclxuICAgICAgICAgICAgX2xvZ091dCgpO1xyXG4gICAgICAgICAgICBkZWZlcnJlZC5yZWplY3QoZXJyKTtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgcmV0dXJuIGRlZmVycmVkLnByb21pc2U7XHJcblxyXG4gICAgfTtcclxuXHJcbiAgICBhdXRoU2VydmljZUZhY3Rvcnkuc2F2ZVJlZ2lzdHJhdGlvbiA9IF9zYXZlUmVnaXN0cmF0aW9uO1xyXG4gICAgYXV0aFNlcnZpY2VGYWN0b3J5LmxvZ2luID0gX2xvZ2luO1xyXG4gICAgYXV0aFNlcnZpY2VGYWN0b3J5LmxvZ091dCA9IF9sb2dPdXQ7XHJcbiAgICBhdXRoU2VydmljZUZhY3RvcnkuY2xlYXJTZXNzaW9uID0gX2NsZWFyU2Vzc2lvbjtcclxuICAgIGF1dGhTZXJ2aWNlRmFjdG9yeS53aW5kb3dzQ2xvc2VMb2dPdXQgPSBfd2luZG93c0Nsb3NlTG9nT3V0O1xyXG4gICAgYXV0aFNlcnZpY2VGYWN0b3J5LmZpbGxBdXRoRGF0YSA9IF9maWxsQXV0aERhdGE7XHJcbiAgICBhdXRoU2VydmljZUZhY3RvcnkuYXV0aGVudGljYXRpb24gPSBfYXV0aGVudGljYXRpb247XHJcbiAgICBhdXRoU2VydmljZUZhY3RvcnkucmVmcmVzaFRva2VuID0gX3JlZnJlc2hUb2tlbjtcclxuXHJcbiAgICBhdXRoU2VydmljZUZhY3Rvcnkub2J0YWluQWNjZXNzVG9rZW4gPSBfb2J0YWluQWNjZXNzVG9rZW47XHJcbiAgICBhdXRoU2VydmljZUZhY3RvcnkuZXh0ZXJuYWxBdXRoRGF0YSA9IF9leHRlcm5hbEF1dGhEYXRhO1xyXG4gICAgYXV0aFNlcnZpY2VGYWN0b3J5LnJlZ2lzdGVyRXh0ZXJuYWwgPSBfcmVnaXN0ZXJFeHRlcm5hbDtcclxuXHJcbiAgICByZXR1cm4gYXV0aFNlcnZpY2VGYWN0b3J5O1xyXG59XSk7IiwiJ3VzZSBzdHJpY3QnO1xuYW5ndWxhci5tb2R1bGUoJ2FwcCcpLmZhY3RvcnkoJ2F1dGhJbnRlcmNlcHRvclNlcnZpY2UnLCBbJyRyb290U2NvcGUnLCAnJHEnLCAnJGluamVjdG9yJywgJyRsb2NhdGlvbicsICdsb2NhbFN0b3JhZ2VTZXJ2aWNlJywgJ2xvZ2dlcicsICduZ0F1dGhTZXR0aW5ncycsIGZ1bmN0aW9uICgkcm9vdFNjb3BlLCAkcSwgJGluamVjdG9yLCAkbG9jYXRpb24sIGxvY2FsU3RvcmFnZVNlcnZpY2UsIGxvZ2dlciwgbmdBdXRoU2V0dGluZ3MpIHtcclxuXG4gICAgdmFyIGF1dGhJbnRlcmNlcHRvclNlcnZpY2VGYWN0b3J5ID0ge307XG5cbiAgICB2YXIgX3JlcXVlc3QgPSBmdW5jdGlvbiAoY29uZmlnKSB7XHJcbiAgICAgICAgdmFyIGF1dGhEYXRhID0gbG9jYWxTdG9yYWdlU2VydmljZS5nZXQoJ2F1dGhvcml6YXRpb25EYXRhJyk7XG4gICAgICAgIGlmIChuZ0F1dGhTZXR0aW5ncy5TU08gIT09IHVuZGVmaW5lZCAmJiBuZ0F1dGhTZXR0aW5ncy5TU08gJiYgIWF1dGhEYXRhICYmICRsb2NhdGlvbi4kJHVybC50b0xvd2VyQ2FzZSgpICE9PSAnL2xvZ2luJykge1xyXG4gICAgICAgICAgICB3aW5kb3cuYXBwUmVsb2FkID0gdHJ1ZTtcclxuICAgICAgICAgICAgaWYgKG5nQXV0aFNldHRpbmdzLlNTTyAhPT0gdW5kZWZpbmVkICYmICFuZ0F1dGhTZXR0aW5ncy5TU08pIHtcclxuICAgICAgICAgICAgICAgIHZhciBhdXRoU2VydmljZSA9ICRpbmplY3Rvci5nZXQoJ2F1dGhTZXJ2aWNlJyk7XHJcbiAgICAgICAgICAgICAgICBhdXRoU2VydmljZS5jbGVhclNlc3Npb24oKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB3aW5kb3cuc2Vzc2lvbkFsZXJ0ID0gZmFsc2U7XHJcbiAgICAgICAgICAgICRsb2NhdGlvbi5wYXRoKCdsb2dpbicpO1xuICAgICAgICAgICBcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XG5cbiAgICAgICAgY29uZmlnLmhlYWRlcnMgPSBjb25maWcuaGVhZGVycyB8fCB7fTtcblxuXG4gICAgICAgIGlmIChhdXRoRGF0YSkge1xyXG4gICAgICAgICAgICBjb25maWcuaGVhZGVycy5BdXRob3JpemF0aW9uID0gJ0JlYXJlciAnICsgYXV0aERhdGEudG9rZW47XG4gICAgICAgICAgICBpZiAoJHJvb3RTY29wZS5jb25maWdIZWFkZXJNZW51ICE9PSB1bmRlZmluZWQgJiYgJHJvb3RTY29wZS5jb25maWdIZWFkZXJNZW51ICE9PSBudWxsKVxuICAgICAgICAgICAgICAgIGNvbmZpZy5oZWFkZXJzLk1lbnUgPSAkcm9vdFNjb3BlLmNvbmZpZ0hlYWRlck1lbnU7XG4gICAgICAgICAgICBlbHNlXG4gICAgICAgICAgICAgICAgY29uZmlnLmhlYWRlcnMuTWVudSA9IFwiXCI7XG4gICAgICAgICAgICBpZiAoJHJvb3RTY29wZS5jb25maWdTZWN0aW9uICE9PSB1bmRlZmluZWQgJiYgJHJvb3RTY29wZS5jb25maWdTZWN0aW9uICE9PSBudWxsKVxuICAgICAgICAgICAgICAgIGNvbmZpZy5oZWFkZXJzLlNlY3Rpb24gPSAkcm9vdFNjb3BlLmNvbmZpZ1NlY3Rpb247XG4gICAgICAgICAgICBlbHNlXG4gICAgICAgICAgICAgICAgY29uZmlnLmhlYWRlcnMuU2VjdGlvbiA9IFwiXCI7XHJcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gY29uZmlnO1xyXG4gICAgfVxuXG5cbiAgICB2YXIgX3Jlc3BvbnNlRXJyb3IgPSBmdW5jdGlvbiAocmVqZWN0aW9uKSB7XHJcbiAgICAgICAgdmFyIGF1dGhEYXRhID0gbG9jYWxTdG9yYWdlU2VydmljZS5nZXQoJ2F1dGhvcml6YXRpb25EYXRhJyk7XG4gICAgICAgIGlmIChyZWplY3Rpb24uc3RhdHVzID09PSAwKSB7XHJcbiAgICAgICAgICAgIHdpbmRvdy5hcHBSZWxvYWQgPSB0cnVlO1xyXG4gICAgICAgICAgICBpZiAobmdBdXRoU2V0dGluZ3MuU1NPICE9PSB1bmRlZmluZWQgJiYgIW5nQXV0aFNldHRpbmdzLlNTTykge1xyXG4gICAgICAgICAgICAgICAgdmFyIGF1dGhTZXJ2aWNlID0gJGluamVjdG9yLmdldCgnYXV0aFNlcnZpY2UnKTtcclxuICAgICAgICAgICAgICAgIGF1dGhTZXJ2aWNlLmNsZWFyU2Vzc2lvbigpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmICghd2luZG93LnNlc3Npb25BbGVydCkge1xyXG4gICAgICAgICAgICAgICAgd2luZG93LnNlc3Npb25BbGVydCA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICBhbGVydChcIllvdXIgc2Vzc2lvbiBoYXMgZXhwaXJlZC4gUGxlYXNlIGNsaWNrIE9LIHRvIHN0YXJ0IGEgbmV3IHNlc3Npb24uXCIpO1xyXG4gICAgICAgICAgICAgICAgJGxvY2F0aW9uLnBhdGgoJ2xvZ2luJyk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICBcclxuICAgICAgICAgICBcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cblxuICAgICAgICBpZiAocmVqZWN0aW9uLnN0YXR1cyA9PT0gNTAwIHx8IHJlamVjdGlvbi5zdGF0dXMgPT09IDQxNSB8fCByZWplY3Rpb24uc3RhdHVzID09PSA0MDUpIHsvL0ludGVybmFsU2VydmVyRXJyb3Igb3IgVW5zdXBwb3J0ZWRNZWRpYVR5cGUgb3IgTWV0aG9kTm90QWxsb3dlZFxuICAgICAgICAgICAgbG9nZ2VyLmVycm9yKHJlamVjdGlvbi5kYXRhLk1lc3NhZ2UsIHJlamVjdGlvbik7XG4gICAgICAgICAgICAvL3JldHVybiAkcS5yZWplY3QocmVqZWN0aW9uKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAocmVqZWN0aW9uLnN0YXR1cyA9PT0gNDAxKSB7XHJcbiAgICAgICAgICAgIHZhciBhdXRoU2VydmljZSA9ICRpbmplY3Rvci5nZXQoJ2F1dGhTZXJ2aWNlJyk7XG4gICAgICAgICAgICBhdXRoU2VydmljZS5jbGVhclNlc3Npb24oKTtcbiAgICAgICAgICAgICRsb2NhdGlvbi5wYXRoKCcvbG9naW4nKTtcbiAgICAgICAgICAgIHJldHVybiB7IFwiZGF0YVwiOiBbXSB9O1xyXG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuICRxLnJlamVjdChyZWplY3Rpb24pO1xyXG4gICAgfVxuXG4gICAgYXV0aEludGVyY2VwdG9yU2VydmljZUZhY3RvcnkucmVxdWVzdCA9IF9yZXF1ZXN0O1xuICAgIGF1dGhJbnRlcmNlcHRvclNlcnZpY2VGYWN0b3J5LnJlc3BvbnNlRXJyb3IgPSBfcmVzcG9uc2VFcnJvcjtcblxuICAgIHJldHVybiBhdXRoSW50ZXJjZXB0b3JTZXJ2aWNlRmFjdG9yeTtcclxufV0pO1xuXG5hbmd1bGFyLm1vZHVsZSgnYXBwJykuY29uZmlnKGZ1bmN0aW9uICgkaHR0cFByb3ZpZGVyKSB7XHJcbiAgICAkaHR0cFByb3ZpZGVyLmludGVyY2VwdG9ycy5wdXNoKCdhdXRoSW50ZXJjZXB0b3JTZXJ2aWNlJyk7XHJcbn0pOyIsIihmdW5jdGlvbiAoKSB7XHJcbiAgICAndXNlIHN0cmljdCc7XHJcbiAgICBhbmd1bGFyXHJcbiAgICAgICAgLm1vZHVsZSgnYXBwLmNvcmUnKVxyXG4gICAgICAgIC5mYWN0b3J5KCdkYXRhc2VydmljZScsIGRhdGFzZXJ2aWNlKTtcclxuXHJcbiAgICAvKiBAbmdJbmplY3QgKi9cclxuICAgIGZ1bmN0aW9uIGRhdGFzZXJ2aWNlKCRodHRwLCAkbG9jYXRpb24sICRxLCBleGNlcHRpb24sIGxvZ2dlciwgJHRlbXBsYXRlQ2FjaGUsIG5nQXV0aFNldHRpbmdzLCBhcGlFbmRVcmwpIHtcclxuICAgICAgICB2YXIgc2VydmljZUJhc2UgPSBuZ0F1dGhTZXR0aW5ncy5hcGlTZXJ2aWNlQmFzZVVyaTtcclxuXHJcbiAgICAgICAgdmFyIHNlcnZpY2UgPSB7XHJcbiAgICAgICAgICAgIGdldERhdGE6IGdldERhdGEsXHJcbiAgICAgICAgICAgIHB1dERhdGE6IHB1dERhdGEsXHJcbiAgICAgICAgICAgIGdldFNlcnZlckRhdGE6IGdldFNlcnZlckRhdGEsXHJcbiAgICAgICAgICAgIHBvc3RTZXJ2ZXJEYXRhOiBwb3N0U2VydmVyRGF0YSxcclxuICAgICAgICAgICAgcHV0U2VydmVyRGF0YTogcHV0U2VydmVyRGF0YSxcclxuICAgICAgICAgICAgZGVsZXRlU2VydmVyRGF0YTogZGVsZXRlU2VydmVyRGF0YSxcclxuICAgICAgICAgICAgZ2V0VGVtcGxhdGVVUkw6IGdldFRlbXBsYXRlVVJMLFxyXG4gICAgICAgICAgICBnZXRGaWVsZHM6IGdldEZpZWxkcyxcclxuICAgICAgICAgICAgZmlsZVVwbG9hZDogZmlsZVVwbG9hZCxcclxuICAgICAgICAgICAgZXhjZWxGaWxlVXBsb2FkOiBleGNlbEZpbGVVcGxvYWQsXHJcbiAgICAgICAgICAgIGZpbGVEZWxldGU6IGZpbGVEZWxldGUsXHJcbiAgICAgICAgICAgIEpTT05Vcmw6IEpTT05VcmwsXHJcbiAgICAgICAgICAgIGdldFNlcnZlclBhdGg6IGdldFNlcnZlclBhdGgsXHJcbiAgICAgICAgICAgIGdldEZpbGVzOiBnZXRGaWxlcyxcclxuICAgICAgICAgICAgZ2V0U2VydmVySHRtbERhdGE6IGdldFNlcnZlckh0bWxEYXRhXHJcbiAgICAgICAgfTtcclxuICAgICAgICB2YXIgQmFzZTY0ID0geyBfa2V5U3RyOiBcIkFCQ0RFRkdISUpLTE1OT1BRUlNUVVZXWFlaYWJjZGVmZ2hpamtsbW5vcHFyc3R1dnd4eXowMTIzNDU2Nzg5Ky89XCIsIGVuY29kZTogZnVuY3Rpb24gKGUpIHsgdmFyIHQgPSBcIlwiOyB2YXIgbiwgciwgaSwgcywgbywgdSwgYTsgdmFyIGYgPSAwOyBlID0gQmFzZTY0Ll91dGY4X2VuY29kZShlKTsgd2hpbGUgKGYgPCBlLmxlbmd0aCkgeyBuID0gZS5jaGFyQ29kZUF0KGYrKyk7IHIgPSBlLmNoYXJDb2RlQXQoZisrKTsgaSA9IGUuY2hhckNvZGVBdChmKyspOyBzID0gbiA+PiAyOyBvID0gKG4gJiAzKSA8PCA0IHwgciA+PiA0OyB1ID0gKHIgJiAxNSkgPDwgMiB8IGkgPj4gNjsgYSA9IGkgJiA2MzsgaWYgKGlzTmFOKHIpKSB7IHUgPSBhID0gNjQgfSBlbHNlIGlmIChpc05hTihpKSkgeyBhID0gNjQgfSB0ID0gdCArIHRoaXMuX2tleVN0ci5jaGFyQXQocykgKyB0aGlzLl9rZXlTdHIuY2hhckF0KG8pICsgdGhpcy5fa2V5U3RyLmNoYXJBdCh1KSArIHRoaXMuX2tleVN0ci5jaGFyQXQoYSkgfSByZXR1cm4gdCB9LCBkZWNvZGU6IGZ1bmN0aW9uIChlKSB7IHZhciB0ID0gXCJcIjsgdmFyIG4sIHIsIGk7IHZhciBzLCBvLCB1LCBhOyB2YXIgZiA9IDA7IGUgPSBlLnJlcGxhY2UoL1teQS1aYS16MC05XFwrXFwvXFw9XS9nLCBcIlwiKTsgd2hpbGUgKGYgPCBlLmxlbmd0aCkgeyBzID0gdGhpcy5fa2V5U3RyLmluZGV4T2YoZS5jaGFyQXQoZisrKSk7IG8gPSB0aGlzLl9rZXlTdHIuaW5kZXhPZihlLmNoYXJBdChmKyspKTsgdSA9IHRoaXMuX2tleVN0ci5pbmRleE9mKGUuY2hhckF0KGYrKykpOyBhID0gdGhpcy5fa2V5U3RyLmluZGV4T2YoZS5jaGFyQXQoZisrKSk7IG4gPSBzIDw8IDIgfCBvID4+IDQ7IHIgPSAobyAmIDE1KSA8PCA0IHwgdSA+PiAyOyBpID0gKHUgJiAzKSA8PCA2IHwgYTsgdCA9IHQgKyBTdHJpbmcuZnJvbUNoYXJDb2RlKG4pOyBpZiAodSAhPSA2NCkgeyB0ID0gdCArIFN0cmluZy5mcm9tQ2hhckNvZGUocikgfSBpZiAoYSAhPSA2NCkgeyB0ID0gdCArIFN0cmluZy5mcm9tQ2hhckNvZGUoaSkgfSB9IHQgPSBCYXNlNjQuX3V0ZjhfZGVjb2RlKHQpOyByZXR1cm4gdCB9LCBfdXRmOF9lbmNvZGU6IGZ1bmN0aW9uIChlKSB7IGUgPSBlLnJlcGxhY2UoL1xcclxcbi9nLCBcIlxcblwiKTsgdmFyIHQgPSBcIlwiOyBmb3IgKHZhciBuID0gMDsgbiA8IGUubGVuZ3RoOyBuKyspIHsgdmFyIHIgPSBlLmNoYXJDb2RlQXQobik7IGlmIChyIDwgMTI4KSB7IHQgKz0gU3RyaW5nLmZyb21DaGFyQ29kZShyKSB9IGVsc2UgaWYgKHIgPiAxMjcgJiYgciA8IDIwNDgpIHsgdCArPSBTdHJpbmcuZnJvbUNoYXJDb2RlKHIgPj4gNiB8IDE5Mik7IHQgKz0gU3RyaW5nLmZyb21DaGFyQ29kZShyICYgNjMgfCAxMjgpIH0gZWxzZSB7IHQgKz0gU3RyaW5nLmZyb21DaGFyQ29kZShyID4+IDEyIHwgMjI0KTsgdCArPSBTdHJpbmcuZnJvbUNoYXJDb2RlKHIgPj4gNiAmIDYzIHwgMTI4KTsgdCArPSBTdHJpbmcuZnJvbUNoYXJDb2RlKHIgJiA2MyB8IDEyOCkgfSB9IHJldHVybiB0IH0sIF91dGY4X2RlY29kZTogZnVuY3Rpb24gKGUpIHsgdmFyIHQgPSBcIlwiOyB2YXIgbiA9IDA7IHZhciByID0gYzEgPSBjMiA9IDA7IHdoaWxlIChuIDwgZS5sZW5ndGgpIHsgciA9IGUuY2hhckNvZGVBdChuKTsgaWYgKHIgPCAxMjgpIHsgdCArPSBTdHJpbmcuZnJvbUNoYXJDb2RlKHIpOyBuKysgfSBlbHNlIGlmIChyID4gMTkxICYmIHIgPCAyMjQpIHsgYzIgPSBlLmNoYXJDb2RlQXQobiArIDEpOyB0ICs9IFN0cmluZy5mcm9tQ2hhckNvZGUoKHIgJiAzMSkgPDwgNiB8IGMyICYgNjMpOyBuICs9IDIgfSBlbHNlIHsgYzIgPSBlLmNoYXJDb2RlQXQobiArIDEpOyBjMyA9IGUuY2hhckNvZGVBdChuICsgMik7IHQgKz0gU3RyaW5nLmZyb21DaGFyQ29kZSgociAmIDE1KSA8PCAxMiB8IChjMiAmIDYzKSA8PCA2IHwgYzMgJiA2Myk7IG4gKz0gMyB9IH0gcmV0dXJuIHQgfSB9XHJcblxyXG4gICAgICAgIC8vIERlZmluZSB0aGUgc3RyaW5nXHJcbiAgICAgICAgZnVuY3Rpb24gSlNPTlVybCh1cmwpIHtcclxuXHJcbiAgICAgICAgICAgIHJldHVybiAkaHR0cC5nZXQodXJsKVxyXG4gICAgICAgICAgICAgICAgLnRoZW4oZ2V0RGF0YUNvbXBsZXRlKVxyXG4gICAgICAgICAgICAgICAgLmNhdGNoKGZ1bmN0aW9uIChtZXNzYWdlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgLy9leGNlcHRpb24uY2F0Y2hlcignWEhSIEZhaWxlZCcpKG1lc3NhZ2UpO1xyXG4gICAgICAgICAgICAgICAgICAgIC8vJGxvY2F0aW9uLnVybCgnLycpO1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBzZXJ2ZXJWYWxpZGF0aW9uKG1lc3NhZ2UpO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICBmdW5jdGlvbiBnZXREYXRhQ29tcGxldGUocmV0dXJuRGF0YSwgc3RhdHVzLCBoZWFkZXJzLCBjb25maWcpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiByZXR1cm5EYXRhLmRhdGE7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIGdldEZpbGVzKHR5cGUsIHBhZ2UsIGVuZFBvaW50KSB7XHJcbiAgICAgICAgICAgIHZhciB1cmwgPSBzZXJ2aWNlQmFzZSArIHR5cGUgKyAocGFnZSAhPSB1bmRlZmluZWQgPyBcIi9cIiArIHBhZ2UgOiBcIlwiKTtcclxuXHJcbiAgICAgICAgICAgIGlmIChlbmRQb2ludCAhPT0gdW5kZWZpbmVkICYmIGVuZFBvaW50ICE9PSBcIlwiKVxyXG4gICAgICAgICAgICAgICAgdXJsID0gc2VydmljZUJhc2UgKyBlbmRQb2ludDtcclxuXHJcbiAgICAgICAgICAgIHJldHVybiAkaHR0cC5nZXQodXJsLCB7IHJlc3BvbnNlVHlwZTogXCJhcnJheWJ1ZmZlclwiIH0pXHJcbiAgICAgICAgICAgICAgICAudGhlbihnZXREYXRhQ29tcGxldGUpXHJcbiAgICAgICAgICAgICAgICAuY2F0Y2goZnVuY3Rpb24gKG1lc3NhZ2UpIHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gc2VydmVyVmFsaWRhdGlvbihtZXNzYWdlKTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgZnVuY3Rpb24gZ2V0RGF0YUNvbXBsZXRlKHJldHVybkRhdGEsIHN0YXR1cywgaGVhZGVycywgY29uZmlnKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gcmV0dXJuRGF0YS5kYXRhO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmdW5jdGlvbiBnZXRTZXJ2ZXJQYXRoKHR5cGUsIHJvd0lkKSB7XHJcbiAgICAgICAgICAgIHZhciByZXR1cm5EYXRhID0gbmF2Y29uLnJvdXRlLlVJKHNlcnZpY2VCYXNlLCB0eXBlLCByb3dJZCk7XHJcbiAgICAgICAgICAgIHJldHVybiByZXR1cm5EYXRhLnRvU3RyaW5nKCkucmVwbGFjZShzZXJ2aWNlQmFzZSwgXCJcIik7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmdW5jdGlvbiBnZXREYXRhKHR5cGUsIHBhZ2UsIGVuZFBvaW50KSB7XHJcbiAgICAgICAgICAgIHZhciB1cmwgPSBzZXJ2aWNlQmFzZSArIHR5cGUgKyAocGFnZSAhPSB1bmRlZmluZWQgPyBcIi9cIiArIHBhZ2UgOiBcIlwiKTtcclxuXHJcbiAgICAgICAgICAgIGlmIChlbmRQb2ludCAhPT0gdW5kZWZpbmVkICYmIGVuZFBvaW50ICE9PSBcIlwiKVxyXG4gICAgICAgICAgICAgICAgdXJsID0gc2VydmljZUJhc2UgKyBlbmRQb2ludDtcclxuXHJcbiAgICAgICAgICAgIHJldHVybiAkaHR0cC5nZXQodXJsKVxyXG4gICAgICAgICAgICAgICAgLnRoZW4oZ2V0RGF0YUNvbXBsZXRlKVxyXG4gICAgICAgICAgICAgICAgLmNhdGNoKGZ1bmN0aW9uIChtZXNzYWdlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHNlcnZlclZhbGlkYXRpb24obWVzc2FnZSk7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgIGZ1bmN0aW9uIGdldERhdGFDb21wbGV0ZShyZXR1cm5EYXRhLCBzdGF0dXMsIGhlYWRlcnMsIGNvbmZpZykge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHJldHVybkRhdGEuZGF0YTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gcHV0RGF0YSh0eXBlLCBkYXRhLCBlbmRQb2ludCkge1xyXG4gICAgICAgICAgICB2YXIgdXJsID0gc2VydmljZUJhc2UgKyB0eXBlO1xyXG5cclxuICAgICAgICAgICAgaWYgKGVuZFBvaW50ICE9PSB1bmRlZmluZWQgJiYgZW5kUG9pbnQgIT09IFwiXCIpXHJcbiAgICAgICAgICAgICAgICB1cmwgPSBzZXJ2aWNlQmFzZSArIGVuZFBvaW50O1xyXG4gICAgICAgICAgICBpZiAoZGF0YS5oYXNPd25Qcm9wZXJ0eSgnSGlzdG9yeScpKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgSGlzdG9yeWRhdGEgPSBkYXRhW1wiSGlzdG9yeVwiXSAhPSB1bmRlZmluZWQgPyBkYXRhW1wiSGlzdG9yeVwiXSA6IFwiXCI7XHJcbiAgICAgICAgICAgICAgICBkYXRhW1wiSGlzdG9yeVwiXSA9IEJhc2U2NC5lbmNvZGUoSlNPTi5zdHJpbmdpZnkoSGlzdG9yeWRhdGEpKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICByZXR1cm4gJGh0dHAucHV0KHVybCwgZGF0YSwge1xyXG4gICAgICAgICAgICAgICAgaGVhZGVyczogeyAnQ29udGVudC1UeXBlJzogJ2FwcGxpY2F0aW9uL2pzb24nIH1cclxuICAgICAgICAgICAgfSkudGhlbihnZXREYXRhQ29tcGxldGUpXHJcbiAgICAgICAgICAgIC5jYXRjaChmdW5jdGlvbiAobWVzc2FnZSkge1xyXG4gICAgICAgICAgICAgICAgLy9leGNlcHRpb24uY2F0Y2hlcignWEhSIEZhaWxlZCcpKG1lc3NhZ2UpO1xyXG4gICAgICAgICAgICAgICAgLy8kbG9jYXRpb24udXJsKCcvJyk7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gc2VydmVyVmFsaWRhdGlvbihtZXNzYWdlKTtcclxuICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICBmdW5jdGlvbiBnZXREYXRhQ29tcGxldGUocmV0dXJuRGF0YSwgc3RhdHVzLCBoZWFkZXJzLCBjb25maWcpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiByZXR1cm5EYXRhLmRhdGE7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIGdldFNlcnZlclVSTCh0eXBlLCByb3dJZCkge1xyXG4gICAgICAgICAgICB2YXIgcmV0dXJuRGF0YSA9ICcnO1xyXG4gICAgICAgICAgICByZXR1cm5EYXRhID0gbmF2Y29uLnJvdXRlLlVJKHNlcnZpY2VCYXNlLCB0eXBlLCByb3dJZCk7XHJcbiAgICAgICAgICAgIHJldHVybiByZXR1cm5EYXRhO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gZ2V0U2VydmVyRGF0YSh0eXBlLCByb3dJZCwgZW5kUG9pbnQpIHtcclxuICAgICAgICAgICAgdmFyIHVybCA9IGdldFNlcnZlclVSTCh0eXBlLCByb3dJZCk7XHJcbiAgICAgICAgICAgIGlmIChlbmRQb2ludCAhPT0gdW5kZWZpbmVkICYmIGVuZFBvaW50ICE9PSBcIlwiKVxyXG4gICAgICAgICAgICAgICAgdXJsID0gc2VydmljZUJhc2UgKyBlbmRQb2ludDtcclxuICAgICAgICAgICAgaWYgKHVybCAhPT0gXCJcIiAmJiB1cmwgIT0gc2VydmljZUJhc2UpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiAkaHR0cC5nZXQodXJsKVxyXG4gICAgICAgICAgICAgICAgICAgIC50aGVuKGdldERhdGFDb21wbGV0ZSlcclxuICAgICAgICAgICAgICAgICAgICAuY2F0Y2goZnVuY3Rpb24gKG1lc3NhZ2UpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKG1lc3NhZ2Uuc3RhdHVzID09PSA0MDEpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICRsb2NhdGlvbi5wYXRoKCcvcmVmcmVzaCcpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJGxvY2F0aW9uLnBhdGgoJy9sb2dpbicpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy9leGNlcHRpb24uY2F0Y2hlcignWEhSIEZhaWxlZCcpKG1lc3NhZ2UpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8kbG9jYXRpb24udXJsKCcvJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gc2VydmVyVmFsaWRhdGlvbihtZXNzYWdlKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBmdW5jdGlvbiBnZXREYXRhQ29tcGxldGUocmV0dXJuRGF0YSwgc3RhdHVzLCBoZWFkZXJzLCBjb25maWcpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiByZXR1cm5EYXRhLmRhdGE7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICBmdW5jdGlvbiBnZXRTZXJ2ZXJIdG1sRGF0YShlbmRQb2ludCkge1xyXG4gICAgICAgICAgICB2YXIgdXJsO1xyXG4gICAgICAgICAgICBpZiAoZW5kUG9pbnQgIT09IHVuZGVmaW5lZCAmJiBlbmRQb2ludCAhPT0gXCJcIilcclxuICAgICAgICAgICAgICAgIHVybCA9IGVuZFBvaW50O1xyXG4gICAgICAgICAgICBpZiAodXJsICE9PSBcIlwiICkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuICRodHRwLmdldCh1cmwpXHJcbiAgICAgICAgICAgICAgICAgICAgLnRoZW4oZ2V0RGF0YUNvbXBsZXRlKVxyXG4gICAgICAgICAgICAgICAgICAgIC5jYXRjaChmdW5jdGlvbiAobWVzc2FnZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAobWVzc2FnZS5zdGF0dXMgPT09IDQwMSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJGxvY2F0aW9uLnBhdGgoJy9yZWZyZXNoJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkbG9jYXRpb24ucGF0aCgnL2xvZ2luJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvL2V4Y2VwdGlvbi5jYXRjaGVyKCdYSFIgRmFpbGVkJykobWVzc2FnZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyRsb2NhdGlvbi51cmwoJy8nKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBzZXJ2ZXJWYWxpZGF0aW9uKG1lc3NhZ2UpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGZ1bmN0aW9uIGdldERhdGFDb21wbGV0ZShyZXR1cm5EYXRhLCBzdGF0dXMsIGhlYWRlcnMsIGNvbmZpZykge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHJldHVybkRhdGE7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9O1xyXG5cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gcG9zdFNlcnZlckRhdGEodHlwZSwgZGF0YSwgdXBsb2FkLCBmb3JtRGF0YSwgZW5kUG9pbnQpIHtcclxuICAgICAgICAgICAgdmFyIHVybCA9IGdldFNlcnZlclVSTCh0eXBlKTtcclxuXHJcbiAgICAgICAgICAgIGlmIChlbmRQb2ludCAhPT0gdW5kZWZpbmVkICYmIGVuZFBvaW50ICE9PSBcIlwiKVxyXG4gICAgICAgICAgICAgICAgdXJsID0gc2VydmljZUJhc2UgKyBlbmRQb2ludDtcclxuICAgICAgICAgICAgaWYgKGRhdGEuaGFzT3duUHJvcGVydHkoJ0hpc3RvcnknKSkge1xyXG4gICAgICAgICAgICAgICAgdmFyIEhpc3RvcnlkYXRhID0gZGF0YVtcIkhpc3RvcnlcIl0gIT0gdW5kZWZpbmVkID8gZGF0YVtcIkhpc3RvcnlcIl0gOiBcIlwiO1xyXG4gICAgICAgICAgICAgICAgZGF0YVtcIkhpc3RvcnlcIl0gPSBCYXNlNjQuZW5jb2RlKEpTT04uc3RyaW5naWZ5KEhpc3RvcnlkYXRhKSk7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIC8vdmFyIGpzb25TdHJpbmcgPSBKU09OLnN0cmluZ2lmeShkYXRhKTtcclxuICAgICAgICAgICAgLy92YXIgZW5jb2RlUmVxdWVzdCA9IEJhc2U2NC5lbmNvZGUoanNvblN0cmluZyk7XHJcblxyXG4gICAgICAgICAgICByZXR1cm4gJGh0dHAucG9zdCh1cmwsIGRhdGEsIHtcclxuICAgICAgICAgICAgICAgIGhlYWRlcnM6IHtcclxuICAgICAgICAgICAgICAgICAgICAnQ29udGVudC1UeXBlJzogJ2FwcGxpY2F0aW9uL2pzb24nXHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pLnRoZW4oZ2V0RGF0YUNvbXBsZXRlKVxyXG4gICAgICAgICAgICAuY2F0Y2goZnVuY3Rpb24gKG1lc3NhZ2UpIHtcclxuICAgICAgICAgICAgICAgIC8vZXhjZXB0aW9uLmNhdGNoZXIoJ1hIUiBGYWlsZWQnKShtZXNzYWdlKTtcclxuICAgICAgICAgICAgICAgIHJldHVybiBzZXJ2ZXJWYWxpZGF0aW9uKG1lc3NhZ2UpO1xyXG4gICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgIGZ1bmN0aW9uIGdldERhdGFDb21wbGV0ZShyZXR1cm5EYXRhLCBzdGF0dXMsIGhlYWRlcnMsIGNvbmZpZykge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHJldHVybkRhdGEuZGF0YTtcclxuICAgICAgICAgICAgfTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICBmdW5jdGlvbiBmaWxlVXBsb2FkKGZvcm1EYXRhKSB7XHJcbiAgICAgICAgICAgIHZhciB1cmwgPSBzZXJ2aWNlQmFzZSArIFwiL3VwbG9hZFwiO1xyXG4gICAgICAgICAgICByZXR1cm4gJGh0dHAucG9zdCh1cmwsIGZvcm1EYXRhLCB7XHJcbiAgICAgICAgICAgICAgICB0cmFuc2Zvcm1SZXF1ZXN0OiBhbmd1bGFyLmlkZW50aXR5LFxyXG4gICAgICAgICAgICAgICAgaGVhZGVyczogeyAnQ29udGVudC1UeXBlJzogdW5kZWZpbmVkIH1cclxuICAgICAgICAgICAgfSkudGhlbihnZXREYXRhQ29tcGxldGUpXHJcbiAgICAgICAgICAgIC5jYXRjaChmdW5jdGlvbiAobWVzc2FnZSkge1xyXG4gICAgICAgICAgICAgICAgLy9leGNlcHRpb24uY2F0Y2hlcignWEhSIEZhaWxlZCcpKG1lc3NhZ2UpO1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHNlcnZlclZhbGlkYXRpb24obWVzc2FnZSk7XHJcbiAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgZnVuY3Rpb24gZ2V0RGF0YUNvbXBsZXRlKHJldHVybkRhdGEsIHN0YXR1cywgaGVhZGVycywgY29uZmlnKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gcmV0dXJuRGF0YS5kYXRhO1xyXG4gICAgICAgICAgICB9O1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIGV4Y2VsRmlsZVVwbG9hZChmb3JtRGF0YSkge1xyXG4gICAgICAgICAgICB2YXIgdXJsID0gc2VydmljZUJhc2UgKyBcIi9yZWFkRXhjZWwvdXBsb2FkXCI7XHJcbiAgICAgICAgICAgIHJldHVybiAkaHR0cC5wb3N0KHVybCwgZm9ybURhdGEsIHtcclxuICAgICAgICAgICAgICAgIHRyYW5zZm9ybVJlcXVlc3Q6IGFuZ3VsYXIuaWRlbnRpdHksXHJcbiAgICAgICAgICAgICAgICBoZWFkZXJzOiB7ICdDb250ZW50LVR5cGUnOiB1bmRlZmluZWQgfVxyXG4gICAgICAgICAgICB9KS50aGVuKGdldERhdGFDb21wbGV0ZSlcclxuICAgICAgICAgICAgLmNhdGNoKGZ1bmN0aW9uIChtZXNzYWdlKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gc2VydmVyVmFsaWRhdGlvbihtZXNzYWdlKTtcclxuICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICBmdW5jdGlvbiBnZXREYXRhQ29tcGxldGUocmV0dXJuRGF0YSwgc3RhdHVzLCBoZWFkZXJzLCBjb25maWcpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiByZXR1cm5EYXRhLmRhdGE7XHJcbiAgICAgICAgICAgIH07XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgZnVuY3Rpb24gZmlsZURlbGV0ZSh0eXBlLCBpZCkge1xyXG4gICAgICAgICAgICB2YXIgdXJsID0gc2VydmljZUJhc2UgKyBcIi9cIiArIHR5cGUgKyBcIi9cIiArIGlkO1xyXG4gICAgICAgICAgICByZXR1cm4gJGh0dHAuZGVsZXRlKHVybCkudGhlbihnZXREYXRhQ29tcGxldGUpXHJcbiAgICAgICAgICAgIC5jYXRjaChmdW5jdGlvbiAobWVzc2FnZSkge1xyXG4gICAgICAgICAgICAgICAgLy9leGNlcHRpb24uY2F0Y2hlcignWEhSIEZhaWxlZCcpKG1lc3NhZ2UpO1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHNlcnZlclZhbGlkYXRpb24obWVzc2FnZSk7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICBmdW5jdGlvbiBnZXREYXRhQ29tcGxldGUocmV0dXJuRGF0YSwgc3RhdHVzLCBoZWFkZXJzLCBjb25maWcpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiByZXR1cm5EYXRhLmRhdGE7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICBmdW5jdGlvbiBwdXRTZXJ2ZXJEYXRhKHR5cGUsIGRhdGEpIHtcclxuICAgICAgICAgICAgdmFyIHVybCA9IGdldFNlcnZlclVSTCh0eXBlKTtcclxuICAgICAgICAgICAgLy92YXIganNvblN0cmluZyA9IEpTT04uc3RyaW5naWZ5KGRhdGEpO1xyXG4gICAgICAgICAgICAvL3ZhciBlbmNvZGVSZXF1ZXN0ID0gQmFzZTY0LmVuY29kZShqc29uU3RyaW5nKTtcclxuXHJcbiAgICAgICAgICAgIGlmIChkYXRhLmhhc093blByb3BlcnR5KCdIaXN0b3J5JykpIHtcclxuICAgICAgICAgICAgICAgIHZhciBIaXN0b3J5ZGF0YSA9IGRhdGFbXCJIaXN0b3J5XCJdICE9IHVuZGVmaW5lZCA/IGRhdGFbXCJIaXN0b3J5XCJdIDogXCJcIjtcclxuICAgICAgICAgICAgICAgIGRhdGFbXCJIaXN0b3J5XCJdID0gQmFzZTY0LmVuY29kZShKU09OLnN0cmluZ2lmeShIaXN0b3J5ZGF0YSkpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHJldHVybiAkaHR0cC5wdXQodXJsLCBkYXRhLCB7XHJcbiAgICAgICAgICAgICAgICBoZWFkZXJzOiB7ICdDb250ZW50LVR5cGUnOiAnYXBwbGljYXRpb24vanNvbicgfVxyXG4gICAgICAgICAgICB9KS50aGVuKGdldERhdGFDb21wbGV0ZSlcclxuICAgICAgICAgICAgLmNhdGNoKGZ1bmN0aW9uIChtZXNzYWdlKSB7XHJcbiAgICAgICAgICAgICAgICAvL2V4Y2VwdGlvbi5jYXRjaGVyKCdYSFIgRmFpbGVkJykobWVzc2FnZSk7XHJcbiAgICAgICAgICAgICAgICAvLyRsb2NhdGlvbi51cmwoJy8nKTtcclxuICAgICAgICAgICAgICAgIHJldHVybiBzZXJ2ZXJWYWxpZGF0aW9uKG1lc3NhZ2UpO1xyXG4gICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgIGZ1bmN0aW9uIGdldERhdGFDb21wbGV0ZShyZXR1cm5EYXRhLCBzdGF0dXMsIGhlYWRlcnMsIGNvbmZpZykge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHJldHVybkRhdGEuZGF0YTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIGRlbGV0ZVNlcnZlckRhdGEodHlwZSwgZGF0YSkge1xyXG4gICAgICAgICAgICB2YXIgdXJsID0gZ2V0U2VydmVyVVJMKHR5cGUpO1xyXG4gICAgICAgICAgICBpZiAoZGF0YSAhPT0gdW5kZWZpbmVkIHx8IGRhdGEgIT09IFwiXCIpIHVybCArPSBcIi9cIiArIGRhdGE7XHJcblxyXG4gICAgICAgICAgICByZXR1cm4gJGh0dHAuZGVsZXRlKHVybCkudGhlbihnZXREYXRhQ29tcGxldGUpXHJcbiAgICAgICAgICAgIC5jYXRjaChmdW5jdGlvbiAobWVzc2FnZSkge1xyXG4gICAgICAgICAgICAgICAgLy9leGNlcHRpb24uY2F0Y2hlcignWEhSIEZhaWxlZCcpKG1lc3NhZ2UpO1xyXG4gICAgICAgICAgICAgICAgLy8kbG9jYXRpb24udXJsKCcvJyk7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gc2VydmVyVmFsaWRhdGlvbihtZXNzYWdlKTtcclxuICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICBmdW5jdGlvbiBnZXREYXRhQ29tcGxldGUocmV0dXJuRGF0YSwgc3RhdHVzLCBoZWFkZXJzLCBjb25maWcpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiByZXR1cm5EYXRhLmRhdGE7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICBmdW5jdGlvbiBzZXJ2ZXJWYWxpZGF0aW9uKG1lc3NhZ2UpIHtcclxuICAgICAgICAgICAgdmFyIGFyckRhdGEgPSBudWxsO1xyXG4gICAgICAgICAgICBpZiAobWVzc2FnZS5kYXRhICE9PSB1bmRlZmluZWQgJiYgbWVzc2FnZS5kYXRhICE9PSBudWxsKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAobWVzc2FnZS5kYXRhLk1vZGVsU3RhdGUgIT09IHVuZGVmaW5lZCAmJiBtZXNzYWdlLmRhdGEuTW9kZWxTdGF0ZSAhPT0gbnVsbCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGFyckRhdGEgPSBtZXNzYWdlLmRhdGEuTW9kZWxTdGF0ZVtcIlwiXTtcclxuICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAobWVzc2FnZS5kYXRhICE9PSB1bmRlZmluZWQgJiYgdHlwZW9mIG1lc3NhZ2UuZGF0YSA9PT0gXCJvYmplY3RcIikge1xyXG4gICAgICAgICAgICAgICAgICAgIGFyckRhdGEgPSBtZXNzYWdlLmRhdGE7XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgaWYgKGFyckRhdGEgIT09IHVuZGVmaW5lZCAmJiBhcnJEYXRhICE9PSBudWxsICYmIGFyckRhdGEubGVuZ3RoICE9PSB1bmRlZmluZWQgJiYgYXJyRGF0YS5sZW5ndGggPiAwKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgJC5tYXAoYXJyRGF0YSwgZnVuY3Rpb24gKGl0ZW0sIGtleSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoaXRlbSAhPT0gdW5kZWZpbmVkKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZXhjZXB0aW9uLmNhdGNoZXIoaXRlbSkobWVzc2FnZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGFyckRhdGEgIT09IHVuZGVmaW5lZCAmJiBhcnJEYXRhICE9PSBudWxsKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGFyckRhdGEuRXhjZXB0aW9uTWVzc2FnZSAhPT0gdW5kZWZpbmVkKSBleGNlcHRpb24uY2F0Y2hlcihhcnJEYXRhLkV4Y2VwdGlvbk1lc3NhZ2UpKG1lc3NhZ2UpO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmIChtZXNzYWdlLmRhdGEgIT09IHVuZGVmaW5lZCAmJiBtZXNzYWdlLmRhdGEgIT09IFwiXCIpIHtcclxuICAgICAgICAgICAgICAgICAgICBleGNlcHRpb24uY2F0Y2hlcihtZXNzYWdlLmRhdGEpKG1lc3NhZ2UpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmdW5jdGlvbiBnZXRGaWVsZHModHlwZSkge1xyXG4gICAgICAgICAgICB2YXIgZGVmZXIgPSAkcS5kZWZlcigpO1xyXG5cclxuICAgICAgICAgICAgJGh0dHAuZ2V0KCcvYXBpL2dldERhdGEvJyArIHR5cGUpLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7XHJcbiAgICAgICAgICAgICAgICBkZWZlci5yZXNvbHZlKHJlc3BvbnNlLmRhdGFbMF0uZGF0YS5yZXN1bHRzKTtcclxuICAgICAgICAgICAgfSwgZnVuY3Rpb24gKHJlc3BvbnNlKSB7XHJcbiAgICAgICAgICAgICAgICBleGNlcHRpb24uY2F0Y2hlcignWEhSIEZhaWxlZCcpKG1lc3NhZ2UpO1xyXG4gICAgICAgICAgICAgICAgJGxvY2F0aW9uLnVybCgnLycpO1xyXG4gICAgICAgICAgICAgICAgZGVmZXIucmVqZWN0KHJlc3BvbnNlKTtcclxuICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICByZXR1cm4gZGVmZXIucHJvbWlzZTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICBmdW5jdGlvbiBnZXRUZW1wbGF0ZVVSTChrZXlPclVybCkge1xyXG4gICAgICAgICAgICB2YXIgZGF0YSA9ICR0ZW1wbGF0ZUNhY2hlLmdldChrZXlPclVybCk7XHJcblxyXG4gICAgICAgICAgICBpZiAoZGF0YSkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGRhdGE7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gJGh0dHAuZ2V0KGtleU9yVXJsLCB7IGNhY2hlOiB0cnVlIH0pXHJcbiAgICAgICAgICAgICAgICAudGhlbihnZXREYXRhQ29tcGxldGUpXHJcbiAgICAgICAgICAgICAgICAuY2F0Y2goZnVuY3Rpb24gKG1lc3NhZ2UpIHtcclxuICAgICAgICAgICAgICAgICAgICBleGNlcHRpb24uY2F0Y2hlcignWEhSIEZhaWxlZCcpKG1lc3NhZ2UpO1xyXG4gICAgICAgICAgICAgICAgICAgICRsb2NhdGlvbi51cmwoJy8nKTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBmdW5jdGlvbiBnZXREYXRhQ29tcGxldGUoZGF0YSwgc3RhdHVzLCBoZWFkZXJzLCBjb25maWcpIHtcclxuICAgICAgICAgICAgICAgICR0ZW1wbGF0ZUNhY2hlLnB1dCgnbmF2Y29uZmllbGQuaHRtbCcsIGRhdGEuZGF0YSk7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gZGF0YS5kYXRhO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgcmV0dXJuIHNlcnZpY2U7XHJcbiAgICB9XHJcbn0pKCk7IiwidmFyIGFwcCA9IGFuZ3VsYXIubW9kdWxlKCdhcHAubG9hZGluZycsIFtcclxuXHQnYnNMb2FkaW5nT3ZlcmxheScsXHJcblx0J2JzTG9hZGluZ092ZXJsYXlTcGluSnMnLFxyXG5cdCd1aS5ib290c3RyYXAnXHJcbl0pLnJ1bihmdW5jdGlvbihic0xvYWRpbmdPdmVybGF5U2VydmljZSkge1xyXG5cdGJzTG9hZGluZ092ZXJsYXlTZXJ2aWNlLnNldEdsb2JhbENvbmZpZyh7XHJcblx0XHR0ZW1wbGF0ZVVybDogJ2JzTG9hZGluZ092ZXJsYXlTcGluSnMnXHJcblx0fSk7XHJcbn0pOyIsIid1c2Ugc3RyaWN0JztcclxuXHJcbmFuZ3VsYXIubW9kdWxlKCdhcHAuY29yZScpLmZhY3RvcnkoJ3NpZ25hbFJIdWJQcm94eScsIFsnJHJvb3RTY29wZScsIGZ1bmN0aW9uICgkcm9vdFNjb3BlKSB7XHJcbiAgICBmdW5jdGlvbiBzaWduYWxSSHViUHJveHlGYWN0b3J5KHNlcnZlclVybCwgaHViTmFtZSwgc3RhcnRPcHRpb25zKSB7XHJcbiAgICAgICAgdmFyIGNvbm5lY3Rpb24gPSAkLmh1YkNvbm5lY3Rpb24oc2VydmVyVXJsKTtcclxuICAgICAgICB2YXIgcHJveHkgPSBjb25uZWN0aW9uLmNyZWF0ZUh1YlByb3h5KGh1Yk5hbWUpO1xyXG4gICAgICAgIGNvbm5lY3Rpb24uc3RhcnQoc3RhcnRPcHRpb25zKS5kb25lKGZ1bmN0aW9uICgpIHsgfSk7XHJcbiAgICAgICAgXHJcbiAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgb246IGZ1bmN0aW9uIChldmVudE5hbWUsIGNhbGxiYWNrKSB7XHJcbiAgICAgICAgICAgICAgICBwcm94eS5vbihldmVudE5hbWUsIGZ1bmN0aW9uIChyZXN1bHQpIHtcclxuICAgICAgICAgICAgICAgICAgICAkcm9vdFNjb3BlLiRhcHBseShmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChjYWxsYmFjaykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FsbGJhY2socmVzdWx0KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgIG9mZjogZnVuY3Rpb24gKGV2ZW50TmFtZSwgY2FsbGJhY2spIHtcclxuICAgICAgICAgICAgICAgIHByb3h5Lm9mZihldmVudE5hbWUsIGZ1bmN0aW9uIChyZXN1bHQpIHtcclxuICAgICAgICAgICAgICAgICAgICAkcm9vdFNjb3BlLiRhcHBseShmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChjYWxsYmFjaykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FsbGJhY2socmVzdWx0KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgIGludm9rZTogZnVuY3Rpb24gKG1ldGhvZE5hbWUsIGNhbGxiYWNrKSB7XHJcbiAgICAgICAgICAgICAgICBwcm94eS5pbnZva2UobWV0aG9kTmFtZSlcclxuICAgICAgICAgICAgICAgICAgICAuZG9uZShmdW5jdGlvbiAocmVzdWx0KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICRyb290U2NvcGUuJGFwcGx5KGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChjYWxsYmFjaykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhbGxiYWNrKHJlc3VsdCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICBjb25uZWN0aW9uOiBjb25uZWN0aW9uXHJcbiAgICAgICAgfTtcclxuICAgIH07XHJcblxyXG4gICAgcmV0dXJuIHNpZ25hbFJIdWJQcm94eUZhY3Rvcnk7ICAgIFxyXG59XSk7XHJcblxyXG4iLCIoZnVuY3Rpb24gKCkge1xyXG4gICAgJ3VzZSBzdHJpY3QnO1xyXG5cclxuICAgIGFuZ3VsYXJcclxuICAgICAgICAubW9kdWxlKCdhcHAuY2hhbmdlcGFzc3dvcmQnKVxyXG4gICAgICAgIC5jb250cm9sbGVyKCdjaGFuZ2VwYXNzd29yZCcsIGNoYW5nZXBhc3N3b3JkKTtcclxuXHJcbiAgICAvKiBAbmdJbmplY3QgKi9cclxuICAgIGZ1bmN0aW9uIGNoYW5nZXBhc3N3b3JkKCRzY29wZSwgZGF0YXNlcnZpY2UsIGxvZ2dlciwgJGNvbXBpbGUsICR0aW1lb3V0LCAkbG9jYXRpb24sIGF1dGhTZXJ2aWNlLCBwYWdlQ29uZmlnLCBtZW51U2V0dGluZ3MpIHtcclxuICAgICAgICB2YXIgdm0gPSB0aGlzO1xyXG5cclxuICAgICAgICB2bS5yaWdodHMgPSBuYXZjb24uZ2V0VXNlclJpZ2h0cyhtZW51U2V0dGluZ3MsIFwiXCIsIFwiQ2hhbmdlIFBhc3N3b3JkXCIpO1xyXG5cclxuICAgICAgICAvKlNldHRpbmdzKi9cclxuICAgICAgICB2bS5wYWdlQ29uZmlnID0gcGFnZUNvbmZpZ1swXTtcclxuICAgICAgICB2bS5nZXRVc2VyRGF0YSA9IHBhZ2VDb25maWdbMV07XHJcblxyXG4gICAgICAgIC8qRmllbGRzKi9cclxuICAgICAgICB2bS5jaGFuZ2VQYXNzd29yZEZpZWxkcyA9IGFuZ3VsYXIuY29weSh2bS5wYWdlQ29uZmlnLmZpZWxkcy5jaGFuZ2VQYXNzd29yZEZpZWxkcyk7XHJcbiAgICAgICAgbmF2Y29uLnVwZGF0ZUZpZWxkc0RhdGEodm0uY2hhbmdlUGFzc3dvcmRGaWVsZHMsIHZtLmdldFVzZXJEYXRhLCAkc2NvcGUsIGZhbHNlLCB2bSk7XHJcbiAgICAgICAgICAgICAgICBcclxuICAgICAgICAvKmJyZWFkY3J1bWJzKi9cclxuICAgICAgICBpZiAodm0ucGFnZUNvbmZpZy5icmVhZGNydW1icyAhPT0gdW5kZWZpbmVkKSB2bS5icmVhZGNydW1icyA9IHZtLnBhZ2VDb25maWcuYnJlYWRjcnVtYnM7XHJcbiAgICAgICAgXHJcbiAgICAgICAgLypWYXJpYWJsZSBEZWNsYXJhdGlvbiovXHJcbiAgICAgICAgdm0udGl0bGUgPSAnQ2hhbmdlIFBhc3N3b3JkJztcclxuICAgICAgICB2bS5wcmltYXJ5S2V5ID0gXCJJZFwiO1xyXG4gICAgICAgIHZtLmRpc3BsYXlLZXkgPSBcIlBhc3N3b3JkXCI7XHJcbiAgICAgICAgdm0uY2hhbmdlUGFzc3dvcmRGaWVsZHMuc2VsZWN0ZWRSb3cgPSAtMTtcclxuICAgICAgICB2bS50cmVlTm9kZSA9IHt9O1xyXG5cclxuICAgICAgICB2bS5kZWxldGVNb2RhbFRpdGxlID0gXCJcIjtcclxuICAgICAgICB2bS5tYWluRm9ybVRpdGxlID0gXCJcIjtcclxuICAgICAgICB2bS5zdWJGb3JtVGl0bGUgPSBcIlwiO1xyXG4gICAgICAgIC8qVmFyaWFibGUgRGVjbGFyYXRpb24qL1xyXG5cclxuICAgICAgICB2bS5jaGFuZ2VQYXNzd29yZEZpZWxkcy5tb2RlID0gXCJVcGRhdGVcIjtcclxuICAgICAgICB2bS5jaGFuZ2VQYXNzd29yZEZpZWxkcy50eXBlID0gXCJjaGFuZ2VQYXNzd29yZFwiO1xyXG5cclxuICAgICAgICBuYXZjb24uc2V0RGlzYWJsZWRFbmFibGVkQnlSaWdodHModm0ucmlnaHRzKTtcclxuXHJcbiAgICAgICAgLypTYXZlKi9cclxuICAgICAgICB2bS5zYXZlID0gZnVuY3Rpb24gKHR5cGUsIG1vZGUsIGNhbGxiYWNrKSB7XHJcbiAgICAgICAgICAgIGlmICh0eXBlID09PSBcImNoYW5nZVBhc3N3b3JkXCIpIHtcclxuICAgICAgICAgICAgICAgIHZtLmRlbGV0ZU1vZGFsVGl0bGUgPSBuYXZjb24uc2F2ZS5zYXZlT3B0aW9uKHZtLCBkYXRhc2VydmljZSwgdm0uY2hhbmdlUGFzc3dvcmRGaWVsZHMubW9kZSwgdm0uY2hhbmdlUGFzc3dvcmRGaWVsZHMudHlwZSwgdm0uY2hhbmdlUGFzc3dvcmRUYWJsZSwgdm0uY2hhbmdlUGFzc3dvcmRGaWVsZHMsXHJcbiAgICAgICAgICAgICAgICAgICAgdm0uY2hhbmdlUGFzc3dvcmRGaWVsZHMuc2VsZWN0ZWRSb3csIHZtLnByaW1hcnlLZXksIHZtLmRpc3BsYXlLZXksIDAsIGZhbHNlLCBmYWxzZSwgXCJcIixcclxuICAgICAgICAgICAgICAgICAgICBmdW5jdGlvbiAoZGF0YSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoY2FsbGJhY2sgIT09IHVuZGVmaW5lZClcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhbGxiYWNrKGRhdGEgPT09IHVuZGVmaW5lZCA/IGZhbHNlIDogdHJ1ZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICRsb2NhdGlvbi5wYXRoKCcvJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9O1xyXG4gICAgfVxyXG59KSgpOyIsIihmdW5jdGlvbiAoKSB7XHJcbiAgICAndXNlIHN0cmljdCc7XHJcblxyXG4gICAgYW5ndWxhclxyXG4gICAgICAgIC5tb2R1bGUoJ2FwcC5sb2dpbicpXHJcbiAgICAgICAgLmNvbnRyb2xsZXIoJ2xvZ2luJywgbG9naW4pO1xyXG5cclxuICAgIC8qQG5nSW5qZWN0Ki9cclxuICAgIGZ1bmN0aW9uIGxvZ2luKCRzY29wZSwgZGF0YXNlcnZpY2UsIGxvZ2dlciwgJGNvbXBpbGUsICR0aW1lb3V0LCAkbG9jYXRpb24sIGF1dGhTZXJ2aWNlLCBuZ0F1dGhTZXR0aW5ncywgcGFnZUNvbmZpZywgbWVudVNldHRpbmdzLCAkcm9vdFNjb3BlLCBsb2NhbFN0b3JhZ2VTZXJ2aWNlLCAkY29va2llU3RvcmUpIHtcclxuICAgICAgICAvKlBhZ2UgRGVjbGFyYXRpb24qL1xyXG4gICAgICAgIHZhciB2bSA9IHRoaXM7XHJcbiAgICAgICAgLyogYWRkZWQgZm9yIGFwcHJvdXRlY29uZmlnIGNoYW5nZSAqL1xyXG4gICAgICAgIHBhZ2VDb25maWcgPSBwYWdlQ29uZmlnWzBdO1xyXG4gICAgICAgIGlmIChwYWdlQ29uZmlnID09PSB1bmRlZmluZWQgfHwgcGFnZUNvbmZpZy5maWVsZHMgPT09IHVuZGVmaW5lZCkge1xyXG4gICAgICAgICAgICB3aW5kb3cuYXBwUmVsb2FkID0gdHJ1ZTtcclxuICAgICAgICAgICAgaWYgKG5nQXV0aFNldHRpbmdzLlNTTyAhPT0gdW5kZWZpbmVkICYmICFuZ0F1dGhTZXR0aW5ncy5TU08pIHtcclxuICAgICAgICAgICAgICAgIHZhciBhdXRoU2VydmljZSA9ICRpbmplY3Rvci5nZXQoJ2F1dGhTZXJ2aWNlJyk7XHJcbiAgICAgICAgICAgICAgICBhdXRoU2VydmljZS5jbGVhclNlc3Npb24oKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB3aW5kb3cubG9jYXRpb24uaHJlZiA9IG5nQXV0aFNldHRpbmdzLmFwcFVSTDtcbiAgICAgICAgICAgIC8vJGxvY2F0aW9uLnVybCgnLzQwNCcpO1xuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgICAgIC8vICRsb2NhdGlvbi51cmwoJy80MDQnKTtcclxuICAgICAgICAgICAvLyByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICB2bS5TU08gPSBmYWxzZTtcclxuICAgICAgICB2bS5TU09Qcm9ncmVzcyA9IGZhbHNlO1xyXG4gICAgICAgIGlmIChuZ0F1dGhTZXR0aW5ncy5TU08gIT09IHVuZGVmaW5lZCAmJiBuZ0F1dGhTZXR0aW5ncy5TU08pXHJcbiAgICAgICAgICAgIHZtLlNTTyA9IHRydWU7XHJcblxyXG4gICAgICAgIC8qU2V0dGluZ3MqL1xyXG4gICAgICAgIHZtLnBhZ2VDb25maWcgPSBwYWdlQ29uZmlnO1xyXG5cclxuICAgICAgICAvKkZpZWxkcyovXHJcbiAgICAgICAgdm0ubG9naW5GaWVsZHMgPSBhbmd1bGFyLmNvcHkodm0ucGFnZUNvbmZpZy5maWVsZHMubG9naW5GaWVsZHMpO1xyXG5cclxuICAgICAgICBkZWZhdWx0RGF0YSh2bS5wYWdlQ29uZmlnLmRhdGEpO1xyXG4gICAgICAgIC8vbG9naW5QYWdlU3Vic2NyaWJlKHZtLCAkc2NvcGUpO1xyXG5cclxuICAgICAgICAvKlNldHRpbmdzKi9cclxuXHJcbiAgICAgICAgLypWYXJpYWJsZSBEZWNsYXJhdGlvbiovXHJcbiAgICAgICAgdm0udGl0bGUgPSAnbG9naW5QYWdlJztcclxuXHJcbiAgICAgICAgdm0uc2hvd0ZvcmdvclBhc3N3b3JkID0gZmFsc2U7XHJcbiAgICAgICAgdm0uc2hvd0xvZ2luID0gdHJ1ZTtcclxuICAgICAgICB2bS5tZXNzYWdlID0gXCJcIjtcclxuXHJcbiAgICAgICAgdm0ucHJpbWFyeUtleSA9IFwiSWRcIjtcclxuICAgICAgICB2bS5kaXNwbGF5S2V5ID0gXCJVc2VyTmFtZVwiO1xyXG4gICAgICAgIHZtLmxvZ2luRmllbGRzLnNlbGVjdGVkUm93ID0gLTE7XHJcbiAgICAgICAgdm0udHJlZU5vZGUgPSB7fTtcclxuXHJcbiAgICAgICAgdm0uZGVsZXRlTW9kYWxUaXRsZSA9IFwiXCI7XHJcbiAgICAgICAgdm0ubWFpbkZvcm1UaXRsZSA9IFwiXCI7XHJcbiAgICAgICAgdm0uc3ViRm9ybVRpdGxlID0gXCJcIjtcclxuICAgICAgICAvKlZhcmlhYmxlIERlY2xhcmF0aW9uKi9cclxuXHJcbiAgICAgICAgdm0ubG9naW5GaWVsZHMubW9kZSA9IFwiU2F2ZVwiO1xyXG4gICAgICAgIHZtLmxvZ2luRmllbGRzLnR5cGUgPSBcImZvcmdvdFBhc3N3b3JkXCI7XHJcblxyXG4gICAgICAgIHZtLmxvZ2luRGF0YSA9IHtcclxuICAgICAgICAgICAgdXNlck5hbWU6IFwiXCIsXHJcbiAgICAgICAgICAgIHBhc3N3b3JkOiBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgcGFzc0luZGV4ID0gbmF2Y29uLmdldEl0ZW1JbmRleEJ5UHJvcGVydHkodm0ubG9naW5GaWVsZHMsIFwidXNlcnBhc3N3b3JkXCIpO1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHZtLmxvZ2luRmllbGRzW3Bhc3NJbmRleF0uZGF0YTtcclxuICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgdXNlUmVmcmVzaFRva2VuczogZmFsc2VcclxuICAgICAgICB9O1xyXG4gICAgICAgIHZtLndhcm5pbmdNb2RhbCA9IGZ1bmN0aW9uICh0eXBlKSB7XHJcblxyXG4gICAgICAgICAgICB2YXIgdXNlckluZGV4ID0gbmF2Y29uLmdldEl0ZW1JbmRleEJ5UHJvcGVydHkodm0ubG9naW5GaWVsZHMsIFwidXNlcm5hbWVcIik7XHJcbiAgICAgICAgICAgIGlmICh2bS5sb2dpbkZpZWxkc1t1c2VySW5kZXhdLmRhdGEgPT09IFwiXCIpIHtcclxuICAgICAgICAgICAgICAgIGxvZ2dlci53YXJuaW5nKFwiVXNlciBOYW1lIHNob3VsZG4ndCBiZSBlbXB0eS4uLi5cIik7XHJcbiAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIHZhciBwYXNzSW5kZXggPSBuYXZjb24uZ2V0SXRlbUluZGV4QnlQcm9wZXJ0eSh2bS5sb2dpbkZpZWxkcywgXCJ1c2VycGFzc3dvcmRcIik7XHJcbiAgICAgICAgICAgIGlmICh2bS5sb2dpbkZpZWxkc1twYXNzSW5kZXhdLmRhdGEgPT09IFwiXCIpIHtcclxuICAgICAgICAgICAgICAgIGxvZ2dlci53YXJuaW5nKFwiUGFzc3dvcmQgc2hvdWxkbid0IGJlIGVtcHR5Li4uLlwiKTtcclxuICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgbmF2Y29uLm9wZW5Nb2RhbCh0eXBlKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgdm0uY2xvc2VNb2RhbCA9IGZ1bmN0aW9uICh0eXBlKSB7XHJcbiAgICAgICAgICAgIG5hdmNvbi5jbG9zZU1vZGFsKHR5cGUpO1xyXG4gICAgICAgIH1cclxuICAgICAgICB2bS5sb2dpbiA9IGZ1bmN0aW9uICgpIHtcclxuXHJcbiAgICAgICAgICAgIGlmICh2bS5TU08pIHtcclxuICAgICAgICAgICAgICAgIHZhciBhdXRoRGF0YSA9IGxvY2FsU3RvcmFnZVNlcnZpY2UuZ2V0KCdhdXRob3JpemF0aW9uRGF0YScpO1xyXG4gICAgICAgICAgICAgICAgaWYoYXV0aERhdGEgPT09IG51bGwgfHwgYXV0aERhdGEgPT09IHVuZGVmaW5lZClcclxuICAgICAgICAgICAgICAgICAgICBzc29TaWduaW4oKTtcclxuICAgICAgICAgICAgICAgIGVsc2Uge1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAkbG9jYXRpb24ucGF0aCgnL2Rhc2hib2FyZCcpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgdmFyIHVzZXJJbmRleCA9IG5hdmNvbi5nZXRJdGVtSW5kZXhCeVByb3BlcnR5KHZtLmxvZ2luRmllbGRzLCBcInVzZXJuYW1lXCIpO1xyXG4gICAgICAgICAgICAgICAgdm0ubG9naW5EYXRhLnVzZXJOYW1lID0gdm0ubG9naW5GaWVsZHNbdXNlckluZGV4XS5kYXRhO1xyXG5cclxuICAgICAgICAgICAgICAgIHZhciBwYXNzSW5kZXggPSBuYXZjb24uZ2V0SXRlbUluZGV4QnlQcm9wZXJ0eSh2bS5sb2dpbkZpZWxkcywgXCJ1c2VycGFzc3dvcmRcIik7XHJcbiAgICAgICAgICAgICAgICB2bS5sb2dpbkRhdGEucGFzc3dvcmQgPSB2bS5sb2dpbkZpZWxkc1twYXNzSW5kZXhdLmRhdGE7XHJcbiAgICAgICAgICAgICAgICBhdXRoZW50aWNhdGlvbigpO1xyXG4gICAgICAgICAgICAgICAgbmF2Y29uLmNsb3NlTW9kYWwoJ3dhcm5pbmcnKTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2bS5sb2dvdXQgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIGlmIChuZ0F1dGhTZXR0aW5ncy5TU08gIT09IHVuZGVmaW5lZCAmJiBuZ0F1dGhTZXR0aW5ncy5TU08pIHtcclxuICAgICAgICAgICAgICAgIGlmIChuZ0F1dGhTZXR0aW5ncy5hcHBVUkwgIT09IHVuZGVmaW5lZCAmJiBuZ0F1dGhTZXR0aW5ncy5hcHBVUkwgIT09IFwiXCIpIHtcclxuICAgICAgICAgICAgICAgICAgICB3aW5kb3cubG9jYXRpb24uaHJlZiA9IG5nQXV0aFNldHRpbmdzLmFwcFVSTCArIFwibG9nb3V0LmFzcHhcIjtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIGF1dGhlbnRpY2F0aW9uKGNhbGxiYWNrKSB7XHJcbiAgICAgICAgICAgIGF1dGhTZXJ2aWNlLmxvZ2luKHZtLmxvZ2luRGF0YSkudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHtcclxuICAgICAgICAgICAgICAgIG1lbnVTZXR0aW5ncy5kYXRhID0gYXV0aFNlcnZpY2UuYXV0aGVudGljYXRpb24udXNlclJpZ2h0cztcclxuICAgICAgICAgICAgICAgICRyb290U2NvcGUuJGJyb2FkY2FzdCgnTUVOVS1TRVRUSU5HLURBVEEtUkVGUkVTSCcpO1xyXG4gICAgICAgICAgICAgICAgJHJvb3RTY29wZS4kYnJvYWRjYXN0KCdBTEVSVC1EQVRBLVJFRlJFU0gnLCBhdXRoU2VydmljZS5hdXRoZW50aWNhdGlvbi5ub3RpZmljYXRpb24sIHRydWUpO1xyXG4gICAgICAgICAgICAgICAgdmFyIGF1dGhEYXRhID0gbG9jYWxTdG9yYWdlU2VydmljZS5nZXQoJ2F1dGhvcml6YXRpb25EYXRhJyk7XHJcbiAgICAgICAgICAgICAgICBpZiAoYXV0aFNlcnZpY2UuYXV0aGVudGljYXRpb24ubm90aWZpY2F0aW9uICE9IHVuZGVmaW5lZCAmJiBhdXRoU2VydmljZS5hdXRoZW50aWNhdGlvbi5ub3RpZmljYXRpb24ubGVuZ3RoID4gMClcclxuICAgICAgICAgICAgICAgICAgICBhdXRoRGF0YS5ub3RpZmljYXRpb24ucHVzaChhdXRoU2VydmljZS5hdXRoZW50aWNhdGlvbi5ub3RpZmljYXRpb24pO1xyXG4gICAgICAgICAgICAgICAgbG9jYWxTdG9yYWdlU2VydmljZS5zZXQoJ2F1dGhvcml6YXRpb25EYXRhJywgYXV0aERhdGEpO1xyXG5cclxuICAgICAgICAgICAgICAgICRsb2NhdGlvbi5wYXRoKCcvZGFzaGJvYXJkJyk7XHJcblxyXG4gICAgICAgICAgICAgICAgaWYgKGNhbGxiYWNrICE9PSB1bmRlZmluZWQpXHJcbiAgICAgICAgICAgICAgICAgICAgY2FsbGJhY2soJ3N1Y2Nlc3MnKTtcclxuICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgZnVuY3Rpb24gKGVycikge1xyXG4gICAgICAgICAgICAgICAgdm0ubWVzc2FnZSA9IFwiXCI7XHJcbiAgICAgICAgICAgICAgICBuYXZjb24uY2xvc2VNb2RhbCgnd2FybmluZycpO1xyXG4gICAgICAgICAgICAgICAgaWYoZXJyICE9PSB1bmRlZmluZWQgJiYgIGVyciAhPT0gbnVsbCAmJiBlcnIuZXJyb3JfZGVzY3JpcHRpb24gIT09IHVuZGVmaW5lZCAmJiBlcnIuZXJyb3JfZGVzY3JpcHRpb24gIT09IFwiXCIpXHJcbiAgICAgICAgICAgICAgICAgICAgbG9nZ2VyLndhcm5pbmcoZXJyLmVycm9yX2Rlc2NyaXB0aW9uLCBcIlwiLCBcIlwiKTtcclxuICAgICAgICAgICAgICAgIGlmIChjYWxsYmFjayAhPT0gdW5kZWZpbmVkKVxyXG4gICAgICAgICAgICAgICAgICAgIGNhbGxiYWNrKGVycik7XHJcblxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcblxyXG5cclxuXHJcbiAgICAgICAgdm0uYXV0aEV4dGVybmFsUHJvdmlkZXIgPSBmdW5jdGlvbiAocHJvdmlkZXIpIHtcclxuICAgICAgICAgICAgdmFyIHJlZGlyZWN0VXJpID0gbG9jYXRpb24ucHJvdG9jb2wgKyAnLy8nICsgbG9jYXRpb24uaG9zdCArICcvYXV0aGNvbXBsZXRlLmh0bWwnO1xyXG5cclxuICAgICAgICAgICAgdmFyIGV4dGVybmFsUHJvdmlkZXJVcmwgPSBuZ0F1dGhTZXR0aW5ncy5hcGlTZXJ2aWNlQmFzZVVyaSArIFwiYXBpL0FjY291bnQvRXh0ZXJuYWxMb2dpbj9wcm92aWRlcj1cIiArIHByb3ZpZGVyXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICsgXCImcmVzcG9uc2VfdHlwZT10b2tlbiZjbGllbnRfaWQ9XCIgKyBuZ0F1dGhTZXR0aW5ncy5jbGllbnRJZFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICArIFwiJnJlZGlyZWN0X3VyaT1cIiArIHJlZGlyZWN0VXJpO1xyXG4gICAgICAgICAgICB3aW5kb3cuJHdpbmRvd1Njb3BlID0gdm07XHJcblxyXG4gICAgICAgICAgICB2YXIgb2F1dGhXaW5kb3cgPSB3aW5kb3cub3BlbihleHRlcm5hbFByb3ZpZGVyVXJsLCBcIkF1dGhlbnRpY2F0ZSBBY2NvdW50XCIsIFwibG9jYXRpb249MCxzdGF0dXM9MCx3aWR0aD02MDAsaGVpZ2h0PTc1MFwiKTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2bS5hdXRoQ29tcGxldGVkQ0IgPSBmdW5jdGlvbiAoZnJhZ21lbnQpIHtcclxuXHJcbiAgICAgICAgICAgICRzY29wZS4kYXBwbHkoZnVuY3Rpb24gKCkge1xyXG5cclxuICAgICAgICAgICAgICAgIGlmIChmcmFnbWVudC5oYXNsb2NhbGFjY291bnQgPT0gJ0ZhbHNlJykge1xyXG5cclxuICAgICAgICAgICAgICAgICAgICBhdXRoU2VydmljZS5sb2dPdXQoKTtcclxuICAgICAgICAgICAgICAgICAgICBsb2dnZXIuc3VjY2VzcyhcIllvdSBoYXZlIHN1Y2Nlc3NmdWxseSBsb2cgb3V0Li4uXCIsIFwiXCIsIFwiXCIpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICBhdXRoU2VydmljZS5leHRlcm5hbEF1dGhEYXRhID0ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBwcm92aWRlcjogZnJhZ21lbnQucHJvdmlkZXIsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHVzZXJOYW1lOiBmcmFnbWVudC5leHRlcm5hbF91c2VyX25hbWUsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGV4dGVybmFsQWNjZXNzVG9rZW46IGZyYWdtZW50LmV4dGVybmFsX2FjY2Vzc190b2tlblxyXG4gICAgICAgICAgICAgICAgICAgIH07XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICRsb2NhdGlvbi5wYXRoKCcvYXNzb2NpYXRlJyk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAvL09idGFpbiBhY2Nlc3MgdG9rZW4gYW5kIHJlZGlyZWN0IHRvIG9yZGVyc1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBleHRlcm5hbERhdGEgPSB7IHByb3ZpZGVyOiBmcmFnbWVudC5wcm92aWRlciwgZXh0ZXJuYWxBY2Nlc3NUb2tlbjogZnJhZ21lbnQuZXh0ZXJuYWxfYWNjZXNzX3Rva2VuIH07XHJcbiAgICAgICAgICAgICAgICAgICAgYXV0aFNlcnZpY2Uub2J0YWluQWNjZXNzVG9rZW4oZXh0ZXJuYWxEYXRhKS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAkbG9jYXRpb24ucGF0aCgnL29yZGVycycpO1xyXG4gICAgICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICAgZnVuY3Rpb24gKGVycikge1xyXG4gICAgICAgICAgICAgICAgICAgICB2bS5tZXNzYWdlID0gXCJcIjtcclxuICAgICAgICAgICAgICAgICAgICAgLy92bS5tZXNzYWdlID0gZXJyLmVycm9yX2Rlc2NyaXB0aW9uO1xyXG4gICAgICAgICAgICAgICAgICAgICBsb2dnZXIud2FybmluZyhlcnIuZXJyb3JfZGVzY3JpcHRpb24sIFwiXCIsIFwiXCIpO1xyXG4gICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICB2bS5lbnRlcktleSA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgLy8kKFwibmF2Y29uLWJ1dHRvblt0ZXh0PSdsb2dpbiddXCIpLmNsaWNrKCk7XHJcbiAgICAgICAgICAgICR0aW1lb3V0KGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgIGlmIChhbmd1bGFyLmVsZW1lbnQoXCJuYXZjb24tYnV0dG9uW2NsYXNzfj0nd2FybmluZ0xvZ2luJ11cIikubGVuZ3RoICE9PSAwKVxyXG4gICAgICAgICAgICAgICAgICAgIGFuZ3VsYXIuZWxlbWVudChcIm5hdmNvbi1idXR0b25bY2xhc3N+PSd3YXJuaW5nTG9naW4nXVwiKS50cmlnZ2VySGFuZGxlcignY2xpY2snKTtcclxuICAgICAgICAgICAgICAgIGVsc2VcclxuICAgICAgICAgICAgICAgICAgICBhbmd1bGFyLmVsZW1lbnQoXCJuYXZjb24tYnV0dG9uW3RleHQ9J2xvZ2luJ11cIikudHJpZ2dlckhhbmRsZXIoJ2NsaWNrJyk7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAvKnZhciB1c2VySW5kZXggPSBuYXZjb24uZ2V0SXRlbUluZGV4QnlQcm9wZXJ0eSh2bS5sb2dpbkZpZWxkcywgXCJ1c2VybmFtZVwiKTtcclxuICAgICAgICAgICAgdmFyIHVzZXJEYXRhID0gdm0ubG9naW5GaWVsZHNbdXNlckluZGV4XS5kYXRhO1xyXG5cclxuICAgICAgICAgICAgdmFyIHBhc3NJbmRleCA9IG5hdmNvbi5nZXRJdGVtSW5kZXhCeVByb3BlcnR5KHZtLmxvZ2luRmllbGRzLCBcInVzZXJwYXNzd29yZFwiKTtcclxuICAgICAgICAgICAgdmFyIHBhc3NEYXRhID0gdm0ubG9naW5GaWVsZHNbcGFzc0luZGV4XS5kYXRhO1xyXG5cclxuICAgICAgICAgICAgaWYgKHVzZXJEYXRhID09PSBcIlwiICYmIHBhc3NEYXRhID09PSBcIlwiKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgdXNlciA9ICQoJ1t0eXBlPXRleHRdW25hbWU9XCJ1c2VybmFtZVwiXScpO1xyXG4gICAgICAgICAgICAgICAgJCh1c2VyKS5mb2N1cygpO1xyXG4gICAgICAgICAgICB9IGVsc2UgaWYgKHVzZXJEYXRhICE9PSBcIlwiICYmIHBhc3NEYXRhID09PSBcIlwiKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgcGFzcyA9ICQoJ1t0eXBlPXBhc3N3b3JkXVtuYW1lPVwidXNlcnBhc3N3b3JkXCJdJyk7XHJcbiAgICAgICAgICAgICAgICAkKHBhc3MpLmZvY3VzKCk7XHJcbiAgICAgICAgICAgIH0gZWxzZSBpZiAodXNlckRhdGEgIT09IFwiXCIgJiYgcGFzc0RhdGEgIT09IFwiXCIpIHtcclxuICAgICAgICAgICAgICAgIGlmIChldmVudC53aGljaCA9PT0gMTMpIHtcclxuICAgICAgICAgICAgICAgICAgICAkKFwibmF2Y29uLWJ1dHRvblt0ZXh0PSdsb2dpbiddXCIpLmNsaWNrKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgdm0ubG9naW4oKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSovXHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBhY3RpdmF0ZSgpO1xyXG5cclxuICAgICAgICAvKlByaXZhdCBmdW5jdGlvbnMqL1xyXG5cclxuICAgICAgICAvKlNhdmUqL1xyXG4gICAgICAgIHZtLnNhdmUgPSBmdW5jdGlvbiAodHlwZSwgbW9kZSwgY2FsbGJhY2spIHtcclxuICAgICAgICAgICAgdmFyIFNlY3VyaXR5UXVlc3Rpb25JbmRleCA9IG5hdmNvbi5nZXRJdGVtSW5kZXhCeVByb3BlcnR5KHZtLmxvZ2luRmllbGRzLCBcIlNlY3VyaXR5UXVlc3Rpb25cIik7XHJcblxyXG4gICAgICAgICAgICBpZiAodm0ubG9naW5GaWVsZHNbU2VjdXJpdHlRdWVzdGlvbkluZGV4XS5kYXRhICE9PSBcIlwiKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAodHlwZSA9PT0gXCJmb3Jnb3RQYXNzd29yZFwiKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdm0uZGVsZXRlTW9kYWxUaXRsZSA9IG5hdmNvbi5zYXZlLnNhdmVPcHRpb24odm0sIGRhdGFzZXJ2aWNlLCB2bS5sb2dpbkZpZWxkcy5tb2RlLCB2bS5sb2dpbkZpZWxkcy50eXBlLCB2bS5sb2dpblRhYmxlLCB2bS5sb2dpbkZpZWxkcywgdm0ubG9naW5GaWVsZHMuc2VsZWN0ZWRSb3csXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZtLnByaW1hcnlLZXksIHZtLmRpc3BsYXlLZXksIDAsIGZhbHNlLCBmYWxzZSwgXCJcIiwgZnVuY3Rpb24gKGRhdGEpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChkYXRhID09PSB1bmRlZmluZWQgfHwgZGF0YSA9PT0gbnVsbCkgcmV0dXJuO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9nZ2VyLndhcm5pbmcoZGF0YS5NZXNzYWdlKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGRhdGEuU3VjY2Vzcykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgVXNlck5hbWVJbmRleCA9IG5hdmNvbi5nZXRJdGVtSW5kZXhCeVByb3BlcnR5KHZtLmxvZ2luRmllbGRzLCBcIlVzZXJOYW1lXCIpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2bS5sb2dpbkZpZWxkc1tVc2VyTmFtZUluZGV4XS5kYXRhID0gXCJcIjtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbWFuYWdlQWxsQ29udHJvbHModHJ1ZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5hdmNvbi5jbG9zZU1vZGFsKHR5cGUpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vaWYgKGNhbGxiYWNrICE9PSB1bmRlZmluZWQpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyAgICBjYWxsYmFjayhkYXRhID09PSB1bmRlZmluZWQgPyBmYWxzZSA6IHRydWUpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIC8qQ2FuY2VsKi9cclxuICAgICAgICB2bS5jYW5jZWwgPSBmdW5jdGlvbiAodHlwZSkge1xyXG4gICAgICAgICAgICB2YXIgVXNlck5hbWVJbmRleCA9IG5hdmNvbi5nZXRJdGVtSW5kZXhCeVByb3BlcnR5KHZtLmxvZ2luRmllbGRzLCBcIlVzZXJOYW1lXCIpO1xyXG4gICAgICAgICAgICB2bS5sb2dpbkZpZWxkc1tVc2VyTmFtZUluZGV4XS5kYXRhID0gXCJcIjtcclxuICAgICAgICAgICAgbWFuYWdlQWxsQ29udHJvbHModHJ1ZSk7XHJcbiAgICAgICAgICAgIG5hdmNvbi5jbG9zZU1vZGFsKHR5cGUpO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIGdldFNlcnZlckRhdGEodHlwZSwgcm93SWQpIHtcclxuICAgICAgICAgICAgcmV0dXJuIGRhdGFzZXJ2aWNlLmdldFNlcnZlckRhdGEodHlwZSwgcm93SWQpLnRoZW4oZnVuY3Rpb24gKGRhdGEpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBkYXRhO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICBmdW5jdGlvbiBhY3RpdmF0ZSgpIHtcclxuICAgICAgICAgICAgdmFyIGF1dGhEYXRhID0gbG9jYWxTdG9yYWdlU2VydmljZS5nZXQoJ2F1dGhvcml6YXRpb25EYXRhJyk7XHJcbiAgICAgICAgICAgIG1hbmFnZUFsbENvbnRyb2xzKHRydWUpO1xyXG4gICAgICAgICAgICBMYXlvdXQuaW5pdFNpZGViYXIoKTtcclxuICAgICAgICAgICAgaWYoYXV0aERhdGEgPT09IG51bGwgfHwgYXV0aERhdGEgPT09IHVuZGVmaW5lZCkge1xyXG4gICAgICAgICAgICAgICAgaWYgKHZtLlNTTykge1xyXG4gICAgICAgICAgICAgICAgICAgICR0aW1lb3V0KGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgbmF2Y29uLm9wZW5Nb2RhbCgnd2FybmluZycpO1xyXG4gICAgICAgICAgICAgICAgICAgIH0pXHJcblxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgJGxvY2F0aW9uLnBhdGgoJy9kYXNoYm9hcmQnKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH07XHJcblxyXG5cclxuICAgICAgICBmdW5jdGlvbiBzc29TaWduaW4oKSB7XHJcbiAgICAgICAgICAgIHZtLlNTT1Byb2dyZXNzID0gdHJ1ZTtcclxuICAgICAgICAgICAgdm0ubG9naW5EYXRhLnVzZXJOYW1lID0gXCIqKioqKipcIjtcclxuICAgICAgICAgICAgdm0ubG9naW5EYXRhLnBhc3N3b3JkID0gXCIqKioqKipcIjtcclxuICAgICAgICAgICAgYXV0aGVudGljYXRpb24oZnVuY3Rpb24gKHJlcykge1xyXG5cclxuICAgICAgICAgICAgICAgIGlmIChyZXMgPT09ICdzdWNjZXNzJykge1xyXG4gICAgICAgICAgICAgICAgICAgIG5hdmNvbi5jbG9zZU1vZGFsKCd3YXJuaW5nJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIHZtLlNTT1Byb2dyZXNzID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICB2bS5zc29FcnJvciA9IFwiXCI7XHJcbiAgICAgICAgICAgICAgICBpZiAobmdBdXRoU2V0dGluZ3MuU1NPRXJyb3IgIT09IHVuZGVmaW5lZCAmJiBuZ0F1dGhTZXR0aW5ncy5TU09FcnJvciAhPT0gXCJcIilcclxuICAgICAgICAgICAgICAgICAgICB2bS5zc29FcnJvciA9IG5nQXV0aFNldHRpbmdzLlNTT0Vycm9yO1xyXG5cclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmdW5jdGlvbiBkZWZhdWx0RGF0YShkYXRhKSB7XHJcbiAgICAgICAgICAgIG5hdmNvbi5zYXZlLmxvYWRMaXN0RGVmYXVsdERhdGEoZGF0YSwgdm0ubG9naW5GaWVsZHMpO1xyXG4gICAgICAgICAgICBtYW5hZ2VBbGxDb250cm9scyh0cnVlKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIGxvZ2luUGFnZVN1YnNjcmliZSh2bSwgJHNjb3BlKSB7XHJcbiAgICAgICAgICAgIC8vdGVtcGxhdGVcclxuXHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdm0uT2sgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIHZhciB1c2VyTmFtZUluZGV4ID0gbmF2Y29uLmdldEl0ZW1JbmRleEJ5UHJvcGVydHkodm0ubG9naW5GaWVsZHMsIFwiVXNlck5hbWVcIik7XHJcbiAgICAgICAgICAgIHZhciBTZWN1cml0eVF1ZXN0aW9uSW5kZXggPSBuYXZjb24uZ2V0SXRlbUluZGV4QnlQcm9wZXJ0eSh2bS5sb2dpbkZpZWxkcywgXCJTZWN1cml0eVF1ZXN0aW9uXCIpO1xyXG5cclxuICAgICAgICAgICAgdm0ubG9naW5GaWVsZHNbU2VjdXJpdHlRdWVzdGlvbkluZGV4XS5kaXNhYmxlZCA9IHRydWU7XHJcbiAgICAgICAgICAgIHZhciB1c2VyTmFtZURhdGEgPSB2bS5sb2dpbkZpZWxkc1t1c2VyTmFtZUluZGV4XS5kYXRhO1xyXG5cclxuICAgICAgICAgICAgaWYgKHVzZXJOYW1lRGF0YSA9PT0gdW5kZWZpbmVkIHx8IHVzZXJOYW1lRGF0YSA9PT0gXCJcIikge1xyXG4gICAgICAgICAgICAgICAgbG9nZ2VyLndhcm5pbmcoXCJVc2VyIG5hbWUgcmVxdWlyZWQuXCIpO1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgZ2V0U2VydmVyRGF0YShcInVzZXJSZWdpc3RyYXRpb25HZXRTZWNRblwiLCB1c2VyTmFtZURhdGEpLnRoZW4oZnVuY3Rpb24gKGRhdGEpIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoZGF0YSA9PT0gdW5kZWZpbmVkIHx8IGRhdGEgPT09IG51bGwgfHwgZGF0YS5sZW5ndGggPT09IDApIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdm0ubG9naW5GaWVsZHNbU2VjdXJpdHlRdWVzdGlvbkluZGV4XS5kYXRhID0gXCJcIjtcclxuICAgICAgICAgICAgICAgICAgICAgICAgbG9nZ2VyLndhcm5pbmcoXCJJbnZhbGlkIHVzZXJuYW1lLlwiKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgbWFuYWdlQWxsQ29udHJvbHModHJ1ZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGlmIChkYXRhLlF1ZXN0aW9uLnRvVXBwZXJDYXNlKCkgPT09IFwiTk9ORVwiKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vdm0ubG9naW5GaWVsZHNbU2VjdXJpdHlRdWVzdGlvbkluZGV4XS5kYXRhID0gXCJcIjtcclxuICAgICAgICAgICAgICAgICAgICAgICAgbG9nZ2VyLndhcm5pbmcoXCJObyBzZWN1cml0eSBxdWVzdGlvbiByZWdpc3RlcmVkIGZvciB0aGUgdXNlci5cIik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG1hbmFnZUFsbENvbnRyb2xzKHRydWUpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdm0ubG9naW5GaWVsZHNbU2VjdXJpdHlRdWVzdGlvbkluZGV4XS5kYXRhID0gZGF0YS5RdWVzdGlvbjtcclxuICAgICAgICAgICAgICAgICAgICAgICAgbWFuYWdlQWxsQ29udHJvbHMoZmFsc2UpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgZnVuY3Rpb24gbWFuYWdlQWxsQ29udHJvbHMoc3RhdHVzKSB7XHJcbiAgICAgICAgICAgIHZhciBzZWN1cml0eVF1ZXNJbmRleCA9IG5hdmNvbi5nZXRJdGVtSW5kZXhCeVByb3BlcnR5KHZtLmxvZ2luRmllbGRzLCBcIlNlY3VyaXR5UXVlc3Rpb25cIik7XHJcbiAgICAgICAgICAgIHZhciBzZWN1cml0eUFuc0luZGV4ID0gbmF2Y29uLmdldEl0ZW1JbmRleEJ5UHJvcGVydHkodm0ubG9naW5GaWVsZHMsIFwiU2VjdXJpdHlBbnN3ZXJcIik7XHJcbiAgICAgICAgICAgIHZhciBwYXNzd29yZEluZGV4ID0gbmF2Y29uLmdldEl0ZW1JbmRleEJ5UHJvcGVydHkodm0ubG9naW5GaWVsZHMsIFwiTmV3UGFzc3dvcmRcIik7XHJcbiAgICAgICAgICAgIHZhciBjb25maXJtUGFzc3dvcmRJbmRleCA9IG5hdmNvbi5nZXRJdGVtSW5kZXhCeVByb3BlcnR5KHZtLmxvZ2luRmllbGRzLCBcIkNvbmZpcm1QYXNzd29yZFwiKTtcclxuXHJcbiAgICAgICAgICAgIHZtLmxvZ2luRmllbGRzW3NlY3VyaXR5QW5zSW5kZXhdLmRhdGEgPSBcIlwiO1xyXG4gICAgICAgICAgICB2bS5sb2dpbkZpZWxkc1twYXNzd29yZEluZGV4XS5kYXRhID0gXCJcIjtcclxuICAgICAgICAgICAgdm0ubG9naW5GaWVsZHNbY29uZmlybVBhc3N3b3JkSW5kZXhdLmRhdGEgPSBcIlwiO1xyXG5cclxuICAgICAgICAgICAgdm0ubG9naW5GaWVsZHNbc2VjdXJpdHlRdWVzSW5kZXhdLmRpc2FibGVkID0gdHJ1ZTtcclxuICAgICAgICAgICAgdm0ubG9naW5GaWVsZHNbc2VjdXJpdHlBbnNJbmRleF0uZGlzYWJsZWQgPSBzdGF0dXM7XHJcbiAgICAgICAgICAgIHZtLmxvZ2luRmllbGRzW3Bhc3N3b3JkSW5kZXhdLmRpc2FibGVkID0gc3RhdHVzO1xyXG4gICAgICAgICAgICB2bS5sb2dpbkZpZWxkc1tjb25maXJtUGFzc3dvcmRJbmRleF0uZGlzYWJsZWQgPSBzdGF0dXM7XHJcblxyXG4gICAgICAgICAgICAkcm9vdFNjb3BlLiRicm9hZGNhc3QoJ0ZJRUxELVZBTElEJywgc3RhdHVzLCBzZWN1cml0eUFuc0luZGV4KTtcclxuICAgICAgICAgICAgJHJvb3RTY29wZS4kYnJvYWRjYXN0KCdGSUVMRC1WQUxJRCcsIHN0YXR1cywgcGFzc3dvcmRJbmRleCk7XHJcbiAgICAgICAgICAgICRyb290U2NvcGUuJGJyb2FkY2FzdCgnRklFTEQtVkFMSUQnLCBzdGF0dXMsIGNvbmZpcm1QYXNzd29yZEluZGV4KTtcclxuXHJcbiAgICAgICAgICAgIGlmIChzdGF0dXMgPT09IHRydWUpIHtcclxuICAgICAgICAgICAgICAgIHZtLmxvZ2luRmllbGRzW3NlY3VyaXR5UXVlc0luZGV4XS5kYXRhID0gXCJcIjtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIC8qUHJpdmF0ZSBmdW5jdGlvbnMqL1xyXG4gICAgfVxyXG59KSgpOyIsIihmdW5jdGlvbiAoKSB7XHJcbiAgICAndXNlIHN0cmljdCc7XHJcblxyXG4gICAgYW5ndWxhclxyXG4gICAgICAgIC5tb2R1bGUoJ2FwcCcpXHJcbiAgICAgICAgLmZhY3RvcnkoJ2FwcEluZm8nLCBhcHBJbmZvKTsgICAgXHJcblxyXG4gICAgZnVuY3Rpb24gYXBwSW5mbygpIHtcclxuICAgICAgICB2YXIgc2VydmljZSA9IHtcclxuICAgICAgICAgICAgc3RhdHVzOiB7XHJcbiAgICAgICAgICAgICAgICBidXN5OiBmYWxzZSxcclxuICAgICAgICAgICAgICAgIG1lc3NhZ2U6ICcnXHJcbiAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgIHNldEluZm86IHNldEluZm9cclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICByZXR1cm4gc2VydmljZTtcclxuXHJcbiAgICAgICAgZnVuY3Rpb24gc2V0SW5mbyhhcmdzKSB7XHJcbiAgICAgICAgICAgIGlmIChhcmdzKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoYXJncy5oYXNPd25Qcm9wZXJ0eSgnYnVzeScpKSB7ICAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAgICAgICAgIHNlcnZpY2Uuc3RhdHVzLmJ1c3kgPSBhcmdzLmJ1c3k7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBpZiAoYXJncy5oYXNPd25Qcm9wZXJ0eSgnbWVzc2FnZScpKSB7ICAgICAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgICAgICAgICBzZXJ2aWNlLnN0YXR1cy5tZXNzYWdlID0gYXJncy5tZXNzYWdlO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgc2VydmljZS5zdGF0dXMuYnVzeSA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgc2VydmljZS5zdGF0dXMubWVzc2FnZSA9ICcnO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG59KSgpOyIsIihmdW5jdGlvbigpIHtcclxuICAgICd1c2Ugc3RyaWN0JztcclxuXHJcbiAgICBhbmd1bGFyXHJcbiAgICAgICAgLm1vZHVsZSgnYXBwLnBob3RvJylcclxuICAgICAgICAuZGlyZWN0aXZlKCdlZ0ZpbGVzJywgZWdGaWxlcyk7XHJcblxyXG4gICAgZnVuY3Rpb24gZWdGaWxlcyAoKSB7XHJcblxyXG4gICAgICAgIHZhciBkaXJlY3RpdmUgPSB7XHJcbiAgICAgICAgICAgIGxpbms6IGxpbmssXHJcbiAgICAgICAgICAgIHJlc3RyaWN0OiAnQScsXHJcbiAgICAgICAgICAgIHNjb3BlOiB7XHJcbiAgICAgICAgICAgICAgICBmaWxlczogJz1lZ0ZpbGVzJyxcclxuICAgICAgICAgICAgICAgIGhhc0ZpbGVzOiAnPSdcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH07XHJcbiAgICAgICAgcmV0dXJuIGRpcmVjdGl2ZTtcclxuXHJcbiAgICAgICAgZnVuY3Rpb24gbGluayhzY29wZSwgZWxlbWVudCwgYXR0cnMpIHsgICAgICAgICAgICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIC8vc2NvcGUuZmlsZXMubGVuZ3RoID0gMDtcclxuICAgICAgICAgICAgc2NvcGUuZmlsZUxpc3QgPSBbXTtcclxuICAgICAgICAgICAgZWxlbWVudC5iaW5kKCdjaGFuZ2UnLCBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICBzY29wZS5maWxlcy5sZW5ndGggPSAwO1xyXG4gICAgICAgICAgICAgICAgc2NvcGUuJGFwcGx5KGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoZWxlbWVudFswXS5maWxlcykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBhbmd1bGFyLmZvckVhY2goZWxlbWVudFswXS5maWxlcywgZnVuY3Rpb24gKGYpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNjb3BlLmZpbGVzLnB1c2goZik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzY29wZS5maWxlTGlzdC5wdXNoKGYpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgc2NvcGUuaGFzRmlsZXMgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgICAgIH0gICAgICAgICAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgaWYgKGVsZW1lbnRbMF0uZm9ybSkge1xyXG4gICAgICAgICAgICAgICAgYW5ndWxhci5lbGVtZW50KGVsZW1lbnRbMF0uZm9ybSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgLmJpbmQoJ3Jlc2V0JywgZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc2NvcGUuJGFwcGx5KGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzY29wZS5maWxlcy5sZW5ndGggPSAwO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNjb3BlLmhhc0ZpbGVzID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG59KSgpOyIsIihmdW5jdGlvbigpIHtcclxuICAgICd1c2Ugc3RyaWN0JztcclxuXHJcbiAgICBhbmd1bGFyXHJcbiAgICAgICAgLm1vZHVsZSgnYXBwLnBob3RvJylcclxuICAgICAgICAuZGlyZWN0aXZlKCdlZ1Bob3RvVXBsb2FkZXInLCBlZ1Bob3RvVXBsb2FkZXIpO1xyXG5cclxuICAgIGVnUGhvdG9VcGxvYWRlci4kaW5qZWN0ID0gWydhcHBJbmZvJywgJ3Bob3RvTWFuYWdlciddO1xyXG5cclxuICAgIGZ1bmN0aW9uIGVnUGhvdG9VcGxvYWRlcihhcHBJbmZvLCBwaG90b01hbmFnZXIpIHtcclxuXHJcbiAgICAgICAgdmFyIGRpcmVjdGl2ZSA9IHtcclxuICAgICAgICAgICAgbGluazogbGluayxcclxuICAgICAgICAgICAgcmVzdHJpY3Q6ICdFJyxcclxuICAgICAgICAgICAgLy90ZW1wbGF0ZVVybDogJ2FwcC9waG90by9lZ1Bob3RvVXBsb2FkZXIuaHRtbCcsXHJcbiAgICAgICAgICAgIHRlbXBsYXRlVXJsOiBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBuYXZjb24uTWVudXJvdXRlLmdldFRlbXBsYXRlVXJsKFwiUGhvdG9VcGxvYWRlclwiKTtcclxuICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgc2NvcGU6IHRydWVcclxuICAgICAgICB9O1xyXG4gICAgICAgIHJldHVybiBkaXJlY3RpdmU7XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIGxpbmsoc2NvcGUsIGVsZW1lbnQsIGF0dHJzKSB7XHJcbiAgICAgICAgICAgIHNjb3BlLmhhc0ZpbGVzID0gZmFsc2U7XHJcbiAgICAgICAgICAgIHNjb3BlLnBob3RvcyA9IFtdO1xyXG4gICAgICAgICAgICBzY29wZS51cGxvYWQgPSBwaG90b01hbmFnZXIudXBsb2FkO1xyXG4gICAgICAgICAgICBzY29wZS5hcHBTdGF0dXMgPSBhcHBJbmZvLnN0YXR1cztcclxuICAgICAgICAgICAgc2NvcGUucGhvdG9NYW5hZ2VyU3RhdHVzID0gcGhvdG9NYW5hZ2VyLnN0YXR1cztcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG59KSgpOyIsIihmdW5jdGlvbigpIHtcclxuICAgICd1c2Ugc3RyaWN0JztcclxuXHJcbiAgICBhbmd1bGFyXHJcbiAgICAgICAgLm1vZHVsZSgnYXBwLnBob3RvJylcclxuICAgICAgICAuZGlyZWN0aXZlKCdlZ1VwbG9hZCcsIGVnVXBsb2FkKTtcclxuXHJcbiAgICBlZ1VwbG9hZC4kaW5qZWN0ID0gWyckdGltZW91dCddO1xyXG4gICAgXHJcbiAgICBmdW5jdGlvbiBlZ1VwbG9hZCgkdGltZW91dCkge1xyXG5cclxuICAgICAgICB2YXIgZGlyZWN0aXZlID0ge1xyXG4gICAgICAgICAgICBsaW5rOiBsaW5rLFxyXG4gICAgICAgICAgICByZXN0cmljdDogJ0EnLFxyXG4gICAgICAgICAgICBzY29wZToge1xyXG4gICAgICAgICAgICAgICAgdXBsb2FkOicmZWdVcGxvYWQnXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9O1xyXG4gICAgICAgIHJldHVybiBkaXJlY3RpdmU7XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIGxpbmsoc2NvcGUsIGVsZW1lbnQsIGF0dHJzKSB7XHJcbiAgICAgICAgICAgIHZhciBwYXJlbnRGb3JtID0gZWxlbWVudFswXS5mb3JtO1xyXG4gICAgICAgICAgICBpZiAocGFyZW50Rm9ybSkge1xyXG4gICAgICAgICAgICAgICAgZWxlbWVudC5vbignY2xpY2snLCBmdW5jdGlvbiAoZXZlbnQpIHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gc2NvcGUudXBsb2FkKCkudGhlbihmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICR0aW1lb3V0KGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhcmVudEZvcm0ucmVzZXQoKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH1cclxufSkoKTsiLCIoZnVuY3Rpb24gKCkge1xyXG4gICAgJ3VzZSBzdHJpY3QnO1xyXG5cclxuICAgIGFuZ3VsYXJcclxuICAgICAgICAubW9kdWxlKCdhcHAucGhvdG8nKVxyXG4gICAgICAgIC5mYWN0b3J5KCdwaG90b01hbmFnZXInLCBwaG90b01hbmFnZXIpO1xyXG5cclxuICAgIHBob3RvTWFuYWdlci4kaW5qZWN0ID0gWyckcScsICdwaG90b01hbmFnZXJDbGllbnQnLCAnYXBwSW5mbyddO1xyXG5cclxuICAgIGZ1bmN0aW9uIHBob3RvTWFuYWdlcigkcSwgcGhvdG9NYW5hZ2VyQ2xpZW50LCBhcHBJbmZvKSB7XHJcbiAgICAgICAgdmFyIHNlcnZpY2UgPSB7XHJcbiAgICAgICAgICAgIHBob3RvczogW10sXHJcbiAgICAgICAgICAgIGxvYWQ6IGxvYWQsXHJcbiAgICAgICAgICAgIHVwbG9hZDogdXBsb2FkLFxyXG4gICAgICAgICAgICByZW1vdmU6IHJlbW92ZSxcclxuICAgICAgICAgICAgcGhvdG9FeGlzdHM6IHBob3RvRXhpc3RzLFxyXG4gICAgICAgICAgICBzdGF0dXM6IHtcclxuICAgICAgICAgICAgICAgIHVwbG9hZGluZzogZmFsc2VcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHJldHVybiBzZXJ2aWNlO1xyXG5cclxuICAgICAgICBmdW5jdGlvbiBsb2FkKCkge1xyXG4gICAgICAgICAgICBhcHBJbmZvLnNldEluZm8oe2J1c3k6dHJ1ZSwgbWVzc2FnZTpcImxvYWRpbmcgcGhvdG9zXCJ9KVxyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgc2VydmljZS5waG90b3MubGVuZ3RoID0gMDtcclxuXHJcbiAgICAgICAgICAgIHJldHVybiBwaG90b01hbmFnZXJDbGllbnQucXVlcnkoKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC4kcHJvbWlzZVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uIChyZXN1bHQpIHsgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0LnBob3Rvc1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5mb3JFYWNoKGZ1bmN0aW9uIChwaG90bykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VydmljZS5waG90b3MucHVzaChwaG90byk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYXBwSW5mby5zZXRJbmZvKHttZXNzYWdlOiBcInBob3RvcyBsb2FkZWQgc3VjY2Vzc2Z1bGx5XCJ9KTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiByZXN1bHQuJHByb21pc2U7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmdW5jdGlvbiAocmVzdWx0KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFwcEluZm8uc2V0SW5mbyh7bWVzc2FnZTogXCJzb21ldGhpbmcgd2VudCB3cm9uZzogXCIgKyByZXN1bHQuZGF0YS5tZXNzYWdlfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAkcS5yZWplY3QocmVzdWx0KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KSAgICAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBbJ2ZpbmFsbHknXShcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFwcEluZm8uc2V0SW5mbyh7YnVzeTogZmFsc2V9KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIHVwbG9hZChwaG90b3MpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBzZXJ2aWNlLnN0YXR1cy51cGxvYWRpbmcgPSB0cnVlO1xyXG4gICAgICAgICAgICBhcHBJbmZvLnNldEluZm8oeyBidXN5OiB0cnVlLCBtZXNzYWdlOiBcInVwbG9hZGluZyBwaG90b3NcIiB9KTsgICAgICAgICAgICBcclxuXHJcbiAgICAgICAgICAgIHZhciBmb3JtRGF0YSA9IG5ldyBGb3JtRGF0YSgpO1xyXG5cclxuICAgICAgICAgICAgYW5ndWxhci5mb3JFYWNoKHBob3RvcywgZnVuY3Rpb24gKHBob3RvKSB7XHJcbiAgICAgICAgICAgICAgICBmb3JtRGF0YS5hcHBlbmQocGhvdG8ubmFtZSwgcGhvdG8pO1xyXG4gICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgIHJldHVybiBwaG90b01hbmFnZXJDbGllbnQuc2F2ZShmb3JtRGF0YSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC4kcHJvbWlzZVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24gKHJlc3VsdCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChyZXN1bHQgJiYgcmVzdWx0LnBob3Rvcykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXN1bHQucGhvdG9zLmZvckVhY2goZnVuY3Rpb24gKHBob3RvKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoIXBob3RvRXhpc3RzKHBob3RvLm5hbWUpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VydmljZS5waG90b3MucHVzaChwaG90byk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYXBwSW5mby5zZXRJbmZvKHttZXNzYWdlOiBcInBob3RvcyB1cGxvYWRlZCBzdWNjZXNzZnVsbHlcIn0pO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmVzdWx0LiRwcm9taXNlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZ1bmN0aW9uIChyZXN1bHQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhcHBJbmZvLnNldEluZm8oe21lc3NhZ2U6IFwic29tZXRoaW5nIHdlbnQgd3Jvbmc6IFwiICsgcmVzdWx0LmRhdGEubWVzc2FnZX0pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAkcS5yZWplY3QocmVzdWx0KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBbJ2ZpbmFsbHknXShcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhcHBJbmZvLnNldEluZm8oeyBidXN5OiBmYWxzZSB9KTsgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlcnZpY2Uuc3RhdHVzLnVwbG9hZGluZyA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmdW5jdGlvbiByZW1vdmUocGhvdG8pIHtcclxuICAgICAgICAgICAgYXBwSW5mby5zZXRJbmZvKHsgYnVzeTogdHJ1ZSwgbWVzc2FnZTogXCJkZWxldGluZyBwaG90byBcIiArIHBob3RvLm5hbWUgfSk7ICAgICAgICAgICAgXHJcblxyXG4gICAgICAgICAgICByZXR1cm4gcGhvdG9NYW5hZ2VyQ2xpZW50LnJlbW92ZSh7ZmlsZU5hbWU6IHBob3RvLm5hbWV9KVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLiRwcm9taXNlXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbiAocmVzdWx0KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy9pZiB0aGUgcGhvdG8gd2FzIGRlbGV0ZWQgc3VjY2Vzc2Z1bGx5IHJlbW92ZSBpdCBmcm9tIHRoZSBwaG90b3MgYXJyYXlcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgaSA9IHNlcnZpY2UucGhvdG9zLmluZGV4T2YocGhvdG8pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlcnZpY2UucGhvdG9zLnNwbGljZShpLCAxKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYXBwSW5mby5zZXRJbmZvKHttZXNzYWdlOiBcInBob3RvcyBkZWxldGVkXCJ9KTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJlc3VsdC4kcHJvbWlzZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmdW5jdGlvbiAocmVzdWx0KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYXBwSW5mby5zZXRJbmZvKHttZXNzYWdlOiBcInNvbWV0aGluZyB3ZW50IHdyb25nOiBcIiArIHJlc3VsdC5kYXRhLm1lc3NhZ2V9KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHEucmVqZWN0KHJlc3VsdCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgWydmaW5hbGx5J10oXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYXBwSW5mby5zZXRJbmZvKHtidXN5OiBmYWxzZX0pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmdW5jdGlvbiBwaG90b0V4aXN0cyhwaG90b05hbWUpIHtcclxuICAgICAgICAgICAgdmFyIHJlcyA9IGZhbHNlXHJcbiAgICAgICAgICAgIHNlcnZpY2UucGhvdG9zLmZvckVhY2goZnVuY3Rpb24gKHBob3RvKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAocGhvdG8ubmFtZSA9PT0gcGhvdG9OYW1lKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmVzID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICByZXR1cm4gcmVzO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxufSkoKTsiLCIoZnVuY3Rpb24gKCkge1xyXG4gICAgJ3VzZSBzdHJpY3QnO1xyXG5cclxuICAgIGFuZ3VsYXJcclxuICAgICAgICAubW9kdWxlKCdhcHAucGhvdG8nKVxyXG4gICAgICAgIC5mYWN0b3J5KCdwaG90b01hbmFnZXJDbGllbnQnLCBwaG90b01hbmFnZXJDbGllbnQpO1xyXG5cclxuICAgIHBob3RvTWFuYWdlckNsaWVudC4kaW5qZWN0ID0gWyckcmVzb3VyY2UnLCAnbmdBdXRoU2V0dGluZ3MnXTtcclxuXHJcbiAgICBmdW5jdGlvbiBwaG90b01hbmFnZXJDbGllbnQoJHJlc291cmNlLCBuZ0F1dGhTZXR0aW5ncykge1xyXG4gICAgICAgIHZhciBzZXJ2aWNlQmFzZSA9IG5nQXV0aFNldHRpbmdzLmFwaVNlcnZpY2VCYXNlVXJpO1xyXG4gICAgICAgIHJldHVybiAkcmVzb3VyY2Uoc2VydmljZUJhc2UgKyBcInBob3RvLzpmaWxlTmFtZVwiLFxyXG4gICAgICAgICAgICAgICAgeyBpZDogXCJAZmlsZU5hbWVcIiB9LFxyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICdxdWVyeSc6IHttZXRob2Q6J0dFVCd9LFxyXG4gICAgICAgICAgICAgICAgICAgICdzYXZlJzogeyBtZXRob2Q6ICdQT1NUJywgdHJhbnNmb3JtUmVxdWVzdDogYW5ndWxhci5pZGVudGl0eSwgaGVhZGVyczogeyAnQ29udGVudC1UeXBlJzogdW5kZWZpbmVkIH0gfSxcclxuICAgICAgICAgICAgICAgICAgICAncmVtb3ZlJzp7bWV0aG9kOiAnREVMRVRFJywgdXJsOiAnYXBpL3Bob3RvLzpmaWxlTmFtZScsIHBhcmFtczp7bmFtZTonQGZpbGVOYW1lJ319XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgIH1cclxufSkoKTsiLCIoZnVuY3Rpb24gKCkge1xyXG4gICAgJ3VzZSBzdHJpY3QnO1xyXG5cclxuICAgIGFuZ3VsYXJcclxuICAgICAgICAubW9kdWxlKCdhcHAucGhvdG8nKVxyXG4gICAgICAgIC5jb250cm9sbGVyKCdwaG90b3MnLCBwaG90b3MpOyBcclxuXHJcbiAgICBwaG90b3MuJGluamVjdCA9IFsncGhvdG9NYW5hZ2VyJ107XHJcblxyXG4gICAgZnVuY3Rpb24gcGhvdG9zKHBob3RvTWFuYWdlcikge1xyXG4gICAgICAgIC8qIGpzaGludCB2YWxpZHRoaXM6dHJ1ZSAqL1xyXG4gICAgICAgIHZhciB2bSA9IHRoaXM7XHJcbiAgICAgICAgdm0udGl0bGUgPSAncGhvdG8gbWFuYWdlcic7XHJcbiAgICAgICAgdm0ucGhvdG9zID0gcGhvdG9NYW5hZ2VyLnBob3RvcztcclxuICAgICAgICB2bS51cGxvYWRpbmcgPSBmYWxzZTtcclxuICAgICAgICB2bS5wcmV2aWV3UGhvdG87ICAgICAgICBcclxuICAgICAgICB2bS5yZW1vdmUgPSBwaG90b01hbmFnZXIucmVtb3ZlO1xyXG4gICAgICAgIHZtLnNldFByZXZpZXdQaG90byA9IHNldFByZXZpZXdQaG90bzsgICAgICAgIFxyXG5cclxuICAgICAgICBhY3RpdmF0ZSgpO1xyXG5cclxuICAgICAgICBmdW5jdGlvbiBhY3RpdmF0ZSgpIHtcclxuICAgICAgICAgICAgcGhvdG9NYW5hZ2VyLmxvYWQoKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIHNldFByZXZpZXdQaG90byhwaG90bykgeyAgICAgICAgIFxyXG4gICAgICAgICAgICB2bS5wcmV2aWV3UGhvdG8gPSBwaG90byAgICAgICAgIFxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gcmVtb3ZlKHBob3RvKSB7XHJcbiAgICAgICAgICAgIHBob3RvTWFuYWdlci5yZW1vdmUocGhvdG8pLnRoZW4oZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgc2V0UHJldmlld1Bob3RvKCk7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxufSkoKTtcclxuIiwiKGZ1bmN0aW9uICgpIHtcclxuICAgICd1c2Ugc3RyaWN0JztcclxuXHJcbiAgICBhbmd1bGFyXHJcbiAgICAgICAgLm1vZHVsZSgnYXBwLnJvbGVtYW5hZ2VtZW50JylcclxuICAgICAgICAuY29udHJvbGxlcigncm9sZW1hbmFnZW1lbnQnLCByb2xlbWFuYWdlbWVudCk7XHJcblxyXG4gICAgLyogQG5nSW5qZWN0ICovXHJcbiAgICBmdW5jdGlvbiByb2xlbWFuYWdlbWVudCgkc2NvcGUsIGRhdGFzZXJ2aWNlLCBsb2dnZXIsICRjb21waWxlLCAkdGltZW91dCwgJGxvY2F0aW9uLCBwYWdlQ29uZmlnLCAkcm9vdFNjb3BlLCBtZW51U2V0dGluZ3MpIHtcclxuICAgICAgICB2YXIgdm0gPSB0aGlzO1xyXG4gICAgICAgIFxyXG4gICAgICAgIGlmIChwYWdlQ29uZmlnID09PSB1bmRlZmluZWQgfHwgcGFnZUNvbmZpZy5maWVsZHMgPT09IHVuZGVmaW5lZCkge1xyXG4gICAgICAgICAgICAkbG9jYXRpb24udXJsKCcvJyk7XHJcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8qIEhpc3RvcnkgRmllbGRzICovXHJcbiAgICAgICAgJHNjb3BlLmlzSGlzdG9yeSA9IGZhbHNlO1xyXG4gICAgICAgICRzY29wZS5oaXN0b3J5U3RhdGUgPSBcIlNhdmVcIjtcclxuICAgICAgICAkc2NvcGUuSGlzdG9yeVRpdGxlID0gXCJSZXZpZXcgQ2hhbmdlc1wiO1xyXG4gICAgICAgICRzY29wZS5oaWRlSGlzdG9yeSA9IGZhbHNlO1xyXG5cclxuICAgICAgICB2bS5yaWdodHMgPSBuYXZjb24uZ2V0VXNlclJpZ2h0cyhtZW51U2V0dGluZ3MsIFwicGFkbWluaXN0cmF0aW9uXCIsIFwicm9sZW1hbmFnZW1lbnRcIik7XHJcblxyXG4gICAgICAgIC8qU2V0dGluZ3MqL1xyXG4gICAgICAgIHZtLnBhZ2VDb25maWcgPSBwYWdlQ29uZmlnO1xyXG4gICAgICAgIC8vdm0ucm9sZU1hbmFnZW1lbnRGaWVsZHMgPSBhbmd1bGFyLmNvcHkodm0ucGFnZUNvbmZpZy5maWVsZHMucm9sZU1hbmFnZW1lbnRGaWVsZHMpO1xyXG4gICAgICAgIC8vdm0ucm9sZU1hbmFnZW1lbnRIaXN0b3J5RmllbGRzID0gYW5ndWxhci5jb3B5KHZtLnBhZ2VDb25maWcuZmllbGRzLnJvbGVNYW5hZ2VtZW50SGlzdG9yeUZpZWxkcyk7XHJcbiAgICAgICAgLy92bS5yb2xlTWFuYWdlbWVudFRhYmxlID0gYW5ndWxhci5jb3B5KHZtLnBhZ2VDb25maWcudGFibGVzLnJvbGVNYW5hZ2VtZW50VGFibGUpO1xyXG5cclxuICAgICAgICAvKlBhZ2UgQ29uZmlnIENvbW1vbiBWYXJyaWFibGUgQXNzaWduICovXHJcbiAgICAgICAgbmF2Y29uLmdldFBhZ2VDb25maWcodm0sIHZtLnBhZ2VDb25maWcpO1xyXG5cclxuICAgICAgICBkZWZhdWx0RGF0YSh2bS5wYWdlQ29uZmlnLmRhdGEpO1xyXG5cclxuICAgICAgICBhY3RpdmF0ZSgpO1xyXG5cclxuICAgICAgICAvKlZhcmlhYmxlIERlY2xhcmF0aW9uKi9cclxuICAgICAgICB2bS5wcmltYXJ5S2V5ID0gXCJSb2xlSWRcIjtcclxuICAgICAgICB2YXIgdHlwZSA9IFwicm9sZU1hbmFnZW1lbnRcIjtcclxuICAgICAgICB2YXIgcm9sZVN0YXR1c0luZGV4O1xyXG4gICAgICAgIHZhciBhZGRFeGlzdGluZ1N5c3RlbVJvbGVJbmRleDtcclxuICAgICAgICB2YXIgZXhpc3RpbmdTeXN0ZW1Sb2xlSWRJbmRleDtcclxuICAgICAgICAvL3ZhciBJVEFSV2FybmluZ0luZGV4O1xyXG4gICAgICAgIHZtLnJlYWRPbmx5ID0gZmFsc2U7XHJcbiAgICAgICAgdm0uZm9ybU1hbmFnZSA9IHt9O1xyXG4gICAgICAgIHZtLnNob3dIaXN0b3J5ID0gZmFsc2U7XHJcblxyXG4gICAgICAgIC8qQ2FuY2VsKi9cclxuICAgICAgICB2bS5jYW5jZWwgPSBmdW5jdGlvbiAodHlwZSkge1xyXG4gICAgICAgICAgICBpZiAodHlwZSA9PT0gJ1JvbGVEZWxldGVNb2RhbCcpIHtcclxuICAgICAgICAgICAgICAgIG5hdmNvbi5jbG9zZU1vZGFsKHR5cGUpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgY2xlYXJGaWVsZHMoKTtcclxuICAgICAgICAgICAgICAgIGdldFJvbGVCeUlkKHZtLlJvbGVJZCk7XHJcblxyXG4gICAgICAgICAgICAgICAgdm0uZW5hYmxlRmllbGRzKGZhbHNlKTtcclxuICAgICAgICAgICAgICAgIHZtLmlzU2F2ZSA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICB2bS5pc0VkaXQgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgdm0uaXNVcGRhdGUgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgdm0ucmVhZE9ubHkgPSB0cnVlO1xyXG5cclxuICAgICAgICAgICAgICAgIGlmICh2bS5Sb2xlSWQgPT09IDApXHJcbiAgICAgICAgICAgICAgICAgICAgdm0uc2hvd0hpc3RvcnkgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgIGVsc2VcclxuICAgICAgICAgICAgICAgICAgICB2bS5zaG93SGlzdG9yeSA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgICAgIGlmICh2bS5Sb2xlSWQgPT09IDApXHJcbiAgICAgICAgICAgICAgICAgICAgJCgnI1JvbGUnKS5yZW1vdmVDbGFzcygnaW4nKTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgJHNjb3BlLmlzSGlzdG9yeSA9IGZhbHNlO1xyXG4gICAgICAgICAgICBuYXZjb24uY2xvc2VNb2RhbCh0eXBlKTtcclxuICAgICAgICAgICAgbmF2Y29uLmNsZWFyRmllbGRzRGF0YSh2bS5yb2xlTWFuYWdlbWVudEhpc3RvcnlGaWVsZHMpO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgICRzY29wZS5jYW5jZWwgPSBmdW5jdGlvbiAodHlwZSkge1xyXG4gICAgICAgICAgICAkc2NvcGUuaXNIaXN0b3J5ID0gZmFsc2U7XHJcbiAgICAgICAgICAgIG5hdmNvbi5jbG9zZU1vZGFsKHR5cGUpO1xyXG4gICAgICAgICAgICBuYXZjb24uY2xlYXJGaWVsZHNEYXRhKHZtLnJvbGVNYW5hZ2VtZW50SGlzdG9yeUZpZWxkcyk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvKkVkaXQqL1xyXG4gICAgICAgIHZtLmVkaXQgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIHZtLmVuYWJsZUZpZWxkcyh0cnVlKTtcclxuICAgICAgICAgICAgdm0uaXNTYXZlID0gdHJ1ZTtcclxuICAgICAgICAgICAgdm0uaXNVcGRhdGUgPSBmYWxzZTtcclxuICAgICAgICAgICAgdm0uaXNEZWxldGUgPSBmYWxzZTtcclxuICAgICAgICAgICAgdm0uaXNDYW5jZWwgPSBmYWxzZTtcclxuICAgICAgICAgICAgdm0uaXNJVEFSID0gZmFsc2U7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgLypTYXZlKi9cclxuICAgICAgICB2bS5zYXZlID0gZnVuY3Rpb24gKG1vZGUsIGNhbGxiYWNrKSB7XHJcbiAgICAgICAgICAgICRzY29wZS5oaWRlSGlzdG9yeSA9IGZhbHNlO1xyXG5cclxuICAgICAgICAgICAgaWYgKHZtLlJvbGVJZCA9PT0gMClcclxuICAgICAgICAgICAgICAgIHZtLm1vZGUgPSBcIlNhdmVcIjtcclxuICAgICAgICAgICAgZWxzZVxyXG4gICAgICAgICAgICAgICAgdm0ubW9kZSA9IFwiVXBkYXRlXCI7XHJcblxyXG4gICAgICAgICAgICB2YXIgaWROYW1lID0gXCJSb2xlSWRcIjtcclxuICAgICAgICAgICAgdmFyIGlkTmFtZUluZGV4ID0gbmF2Y29uLmdldEl0ZW1JbmRleEJ5UHJvcGVydHkodm0ucm9sZU1hbmFnZW1lbnRGaWVsZHMsIGlkTmFtZSk7XHJcblxyXG4gICAgICAgICAgICBpZiAodm0ucm9sZU1hbmFnZW1lbnRGaWVsZHNbaWROYW1lSW5kZXhdLmRhdGEgIT0gMCkge1xyXG5cclxuICAgICAgICAgICAgICAgICRzY29wZS5IaXN0b3J5ZGF0YSA9IG5hdmNvbi5jb21wYXJlZGF0YSh2bS5yb2xlTWFuYWdlbWVudEZpZWxkcywgJ0FkbWluaXN0cmF0aW9uIFJvbGUgTWFuYWdlbWVudCcsIFwiXCIsIGlkTmFtZSwgdm0ucm9sZU1hbmFnZW1lbnRGaWVsZHNbaWROYW1lSW5kZXhdLmRhdGEpO1xyXG4gICAgICAgICAgICAgICAgdmFyIEhpc3RvcnlJbmRleCA9IG5hdmNvbi5nZXRJdGVtSW5kZXhCeVByb3BlcnR5KHZtLnJvbGVNYW5hZ2VtZW50RmllbGRzLCAnSGlzdG9yeScpO1xyXG4gICAgICAgICAgICAgICAgdm0ucm9sZU1hbmFnZW1lbnRGaWVsZHNbSGlzdG9yeUluZGV4XS5kYXRhID0gJHNjb3BlLkhpc3RvcnlkYXRhO1xyXG5cclxuICAgICAgICAgICAgICAgICRzY29wZS5IaXN0b3J5VGl0bGUgPSAnUmV2aWV3IENoYW5nZXMnO1xyXG5cclxuICAgICAgICAgICAgICAgIGlmICgkc2NvcGUuSGlzdG9yeWRhdGEubGVuZ3RoID4gMCkge1xyXG4gICAgICAgICAgICAgICAgICAgICRzY29wZS5pc0hpc3RvcnkgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgICAgICRzY29wZS5oaXN0b3J5U3RhdGUgPSBcIlNhdmVcIjtcclxuICAgICAgICAgICAgICAgICAgICBuYXZjb24ub3Blbk1vZGFsKCdyZXZpZXcnKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICRzY29wZS5pc0hpc3RvcnkgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgICAgICBuYXZjb24ub3Blbk1vZGFsKCdub3RGb3VuZCcpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgJHNjb3BlLlByb2NlZWRUb1NhdmUoKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgICRzY29wZS5zYXZlQ2hhbmdlcyA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgaWYgKHZtLmZvcm1NYW5hZ2UuZm9ybVZhbGlkKHZtLnJvbGVNYW5hZ2VtZW50SGlzdG9yeUZpZWxkcykpIHtcclxuICAgICAgICAgICAgICAgIHZhciBIaXN0b3J5UmVtYXJrc0luZGV4ID0gbmF2Y29uLmdldEl0ZW1JbmRleEJ5UHJvcGVydHkodm0ucm9sZU1hbmFnZW1lbnRGaWVsZHMsIFwiSGlzdG9yeVJlbWFya3NcIik7XHJcbiAgICAgICAgICAgICAgICB2YXIgUmVtYXJrc0luZGV4ID0gbmF2Y29uLmdldEl0ZW1JbmRleEJ5UHJvcGVydHkodm0ucm9sZU1hbmFnZW1lbnRIaXN0b3J5RmllbGRzLCBcIkhpc3RvcnlSZW1hcmtzXCIpO1xyXG4gICAgICAgICAgICAgICAgdmFyIG9iakhpc3RvcnkgPSB7IFJlbWFya3M6IHZtLnJvbGVNYW5hZ2VtZW50SGlzdG9yeUZpZWxkc1tSZW1hcmtzSW5kZXhdLmRhdGEgfTtcclxuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKG9iakhpc3RvcnkpO1xyXG4gICAgICAgICAgICAgICAgdm0ucm9sZU1hbmFnZW1lbnRGaWVsZHNbSGlzdG9yeVJlbWFya3NJbmRleF0uZGF0YSA9IG9iakhpc3Rvcnk7XHJcbiAgICAgICAgICAgICAgICAkc2NvcGUuUHJvY2VlZFRvU2F2ZSgpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgJHNjb3BlLlByb2NlZWRUb1NhdmUgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIG5hdmNvbi5zYXZlLnNhdmVPcHRpb24odm0sIGRhdGFzZXJ2aWNlLCB2bS5tb2RlLCB0eXBlLCB2bS5yb2xlTWFuYWdlbWVudFRhYmxlLCB2bS5yb2xlTWFuYWdlbWVudEZpZWxkcywgdm0uc2VsZWN0ZWRSb3csIHZtLnByaW1hcnlLZXksIFwiXCIsIFwiXCIsIFwiXCIsIHRydWUsIFwiXCIsIGZ1bmN0aW9uIChkYXRhKSB7XHJcbiAgICAgICAgICAgICAgICBjbGVhckZpZWxkcygpO1xyXG4gICAgICAgICAgICAgICAgJCgnI1JvbGUnKS5yZW1vdmVDbGFzcygnaW4nKTtcclxuICAgICAgICAgICAgICAgICRzY29wZS5jYW5jZWwoJ3JldmlldycpO1xyXG4gICAgICAgICAgICAgICAgbmF2Y29uLmNsZWFyRmllbGRzRGF0YSh2bS5yb2xlTWFuYWdlbWVudEhpc3RvcnlGaWVsZHMpO1xyXG5cclxuICAgICAgICAgICAgICAgIGlmIChkYXRhICE9PSB1bmRlZmluZWQgJiYgdm0ubW9kZSA9PSBcIlVwZGF0ZVwiKVxyXG4gICAgICAgICAgICAgICAgICAgIGxvZ2dlci5zdWNjZXNzKFwiRW50cmllcyBhcmUgdXBkYXRlZCBzdWNjZXNzZnVsbHkuLi5cIik7XHJcbiAgICAgICAgICAgICAgICBpZiAoZGF0YSAhPT0gdW5kZWZpbmVkICYmIHZtLm1vZGUgPT0gXCJTYXZlXCIpXHJcbiAgICAgICAgICAgICAgICAgICAgbG9nZ2VyLnN1Y2Nlc3MoXCJFbnRyaWVzIGFyZSBzYXZlZCBzdWNjZXNzZnVsbHkuLi5cIik7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgICRzY29wZS5IaXN0b3J5Q2hhbmdlcyA9IGZ1bmN0aW9uICh0eXBlKSB7XHJcbiAgICAgICAgICAgICRzY29wZS5oaWRlSGlzdG9yeSA9IGZhbHNlO1xyXG4gICAgICAgICAgICB2YXIgaWROYW1lSW5kZXggPSBuYXZjb24uZ2V0SXRlbUluZGV4QnlQcm9wZXJ0eSh2bS5yb2xlTWFuYWdlbWVudEZpZWxkcywgXCJSb2xlSWRcIik7XHJcblxyXG4gICAgICAgICAgICBkYXRhc2VydmljZS5nZXREYXRhKFwiSGlzdG9yeS9HZXRIaXN0b3J5L1JvbGVJZC9cIiArIHZtLnJvbGVNYW5hZ2VtZW50RmllbGRzW2lkTmFtZUluZGV4XS5kYXRhKS50aGVuKGZ1bmN0aW9uIChkYXRhKSB7XHJcbiAgICAgICAgICAgICAgICAkc2NvcGUuSGlzdG9yeVRpdGxlID0gXCJIaXN0b3J5XCI7XHJcblxyXG4gICAgICAgICAgICAgICAgaWYgKGRhdGEgIT0gdW5kZWZpbmVkICYmIGRhdGEgIT0gbnVsbCAmJiBkYXRhLmxlbmd0aCA+IDApIHtcclxuICAgICAgICAgICAgICAgICAgICAkc2NvcGUuSGlzdG9yeWRhdGEgPSBkYXRhO1xyXG4gICAgICAgICAgICAgICAgICAgICRzY29wZS5oaWRlSGlzdG9yeSA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAkc2NvcGUuSGlzdG9yeWRhdGEgPSBkYXRhO1xyXG4gICAgICAgICAgICAgICAgICAgICRzY29wZS5oaWRlSGlzdG9yeSA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgJHNjb3BlLmlzSGlzdG9yeSA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICAkc2NvcGUuaGlzdG9yeVN0YXRlID0gXCJWaWV3XCI7XHJcbiAgICAgICAgICAgICAgICBuYXZjb24ub3Blbk1vZGFsKCdyZXZpZXcnKTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgLypEZWxldGUqL1xyXG4gICAgICAgIHZtLmRlbGV0ZSA9IGZ1bmN0aW9uIChjYWxsYmFjaykge1xyXG4gICAgICAgICAgICBuYXZjb24ub3Blbk1vZGFsKCdSb2xlRGVsZXRlTW9kYWwnKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHZtLnNob3dIaWRlID0gZnVuY3Rpb24gKGlkLCBtb2RlKSB7XHJcbiAgICAgICAgICAgIGlmICghJCgnIycgKyBpZCkuaGFzQ2xhc3MoJ2luJykpIHtcclxuICAgICAgICAgICAgICAgICQoJyMnICsgaWQpLnRvZ2dsZUNsYXNzKCdpbicpO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBpZiAobW9kZSA9PT0gJ2FkZCcpIHtcclxuICAgICAgICAgICAgICAgIGNsZWFyRmllbGRzKCk7XHJcbiAgICAgICAgICAgICAgICB2bS5Sb2xlSWQgPSAwO1xyXG4gICAgICAgICAgICAgICAgdm0uaXNTYXZlID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICB2bS5pc0NhbmNlbCA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgdm0uaXNVcGRhdGUgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgdm0uaXNEZWxldGUgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgdm0uZW5hYmxlRmllbGRzKHRydWUpO1xyXG4gICAgICAgICAgICAgICAgdm0uaXNJVEFSID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICB2bS5zaG93SGlzdG9yeSA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgdm0ucm9sZU1hbmFnZW1lbnRGaWVsZHMubW9kZSA9ICdzYXZlJztcclxuICAgICAgICAgICAgICAgICQoJ3RhYmxlLmRhdGFUYWJsZSB0Ym9keSB0cicpLnJlbW92ZUNsYXNzKCdzZWxlY3RlZCcpO1xyXG4gICAgICAgICAgICAgICAgJCgndGFibGUuZGF0YVRhYmxlIHRib2R5IHRyJykuY3NzKFwiYmFja2dyb3VuZC1jb2xvclwiLCBcIlwiKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgdm0uY2xvc2VQb3B1cCA9IGZ1bmN0aW9uIChtb2RhbFR5cGUsIGFjdGlvbikge1xyXG4gICAgICAgICAgICBpZiAoYWN0aW9uID09PSBcIk5vXCIpIHtcclxuICAgICAgICAgICAgICAgIG5hdmNvbi5jbG9zZU1vZGFsKG1vZGFsVHlwZSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZVxyXG4gICAgICAgICAgICAgICAgaWYgKGFjdGlvbiA9PT0gXCJZZXNcIikge1xyXG4gICAgICAgICAgICAgICAgICAgIG5hdmNvbi5zYXZlLmRlbGV0ZU9wdGlvbihkYXRhc2VydmljZSwgdHlwZSwgdm0ucm9sZU1hbmFnZW1lbnRUYWJsZSwgdm0uc2VsZWN0ZWRSb3csIHZtLnByaW1hcnlLZXksIFwiXCIsIGZ1bmN0aW9uIChkYXRhKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vaWYgKGNhbGxiYWNrICE9PSB1bmRlZmluZWQpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vICAgIGNhbGxiYWNrKGRhdGEgPT09IHVuZGVmaW5lZCA/IGZhbHNlIDogdHJ1ZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNsb3NlTW9kYWwoJ2RlbGV0ZScpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBuYXZjb24uY2xvc2VNb2RhbChtb2RhbFR5cGUpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2bS5pc0VkaXQgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoZGF0YSAhPT0gdW5kZWZpbmVkKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9nZ2VyLnN1Y2Nlc3MoXCJFbnRyaWVzIGFyZSBkZWxldGVkIHN1Y2Nlc3NmdWxseS4uLlwiKTtcclxuICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIGNsb3NlTW9kYWwobW9kZSkge1xyXG4gICAgICAgICAgICBpZiAobW9kZSA9PT0gJ2RlbGV0ZScpIHtcclxuICAgICAgICAgICAgICAgIGNsZWFyRmllbGRzKCk7XHJcbiAgICAgICAgICAgICAgICAkKCcjUm9sZScpLnJlbW92ZUNsYXNzKCdpbicpO1xyXG4gICAgICAgICAgICAgICAgdm0uc2hvd0hpc3RvcnkgPSBmYWxzZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgIHZtLnJlYWRPbmx5ID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgIHZtLnNob3dIaWRlKCdSb2xlJyk7XHJcbiAgICAgICAgICAgICAgICB2bS5zaG93SGlzdG9yeSA9IHRydWU7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIGNsZWFyRmllbGRzKCkge1xyXG4gICAgICAgICAgICBuYXZjb24uY2xlYXJGaWVsZHNEYXRhKHZtLnJvbGVNYW5hZ2VtZW50RmllbGRzKTtcclxuICAgICAgICAgICAgcm9sZVN0YXR1c0luZGV4ID0gbmF2Y29uLmdldEl0ZW1JbmRleEJ5UHJvcGVydHkodm0ucm9sZU1hbmFnZW1lbnRGaWVsZHMsIFwiUm9sZVN0YXR1c1wiKTtcclxuICAgICAgICAgICAgdm0ucm9sZU1hbmFnZW1lbnRGaWVsZHNbcm9sZVN0YXR1c0luZGV4XS5kYXRhID0gdHJ1ZTtcclxuICAgICAgICAgICAgbmF2Y29uLmNsZWFyRmllbGRzRGF0YSh2bS5yb2xlTWFuYWdlbWVudEhpc3RvcnlGaWVsZHMpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgdm0uZW5hYmxlRmllbGRzID0gZnVuY3Rpb24gKGlzRW5hYmxlZCkge1xyXG4gICAgICAgICAgICB2bS5yZWFkT25seSA9ICFpc0VuYWJsZWQ7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICB2bS50YWJsZUNlbGxDbGljayA9IGZ1bmN0aW9uIChyb3csIGNvbHVtbiwgZGF0YSwgdHlwZSwgY2VsbE9iaiwgb1RhYmxlKSB7XHJcbiAgICAgICAgICAgIHZtLnNob3dIaWRlKCdSb2xlJyk7XHJcbiAgICAgICAgICAgIHZtLlJvbGVJZCA9IGRhdGEuUm9sZUlkO1xyXG4gICAgICAgICAgICB2bS5zZWxlY3RlZFJvdyA9IG5hdmNvbi5zYXZlLnNlbGVjdGVkUm93SW5kZXgodm0ucm9sZU1hbmFnZW1lbnRUYWJsZSwgZGF0YSwgdm0ucHJpbWFyeUtleSk7XHJcblxyXG4gICAgICAgICAgICBnZXRSb2xlQnlJZCh2bS5Sb2xlSWQpO1xyXG5cclxuICAgICAgICAgICAgdm0uZW5hYmxlRmllbGRzKGZhbHNlKTtcclxuICAgICAgICAgICAgdm0uaXNTYXZlID0gdHJ1ZTtcclxuICAgICAgICAgICAgdm0uaXNVcGRhdGUgPSB0cnVlO1xyXG4gICAgICAgICAgICB2bS5zaG93SGlzdG9yeSA9IHRydWU7XHJcbiAgICAgICAgICAgIHZtLnJvbGVNYW5hZ2VtZW50RmllbGRzLm1vZGUgPSAndmlldyc7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmdW5jdGlvbiBnZXRSb2xlQnlJZChyb2xlSWQpIHtcclxuICAgICAgICAgICAgdmFyIGRhdGFSb2xlID0gZ2V0U2VydmVyRGF0YSgncm9sZU1hbmFnZW1lbnRJZCcsIHJvbGVJZCkudGhlbihmdW5jdGlvbiAoZGF0YVJvbGUpIHtcclxuICAgICAgICAgICAgICAgIGlmIChkYXRhUm9sZSAhPT0gdW5kZWZpbmVkICYmIGRhdGFSb2xlICE9PSBudWxsKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHJvbGVJZCAhPT0gMCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjbGVhckZpZWxkcygpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBuYXZjb24udXBkYXRlRmllbGRzRGF0YSh2bS5yb2xlTWFuYWdlbWVudEZpZWxkcywgZGF0YVJvbGVbMF0sIHZtLCBmYWxzZSwgdm0ubmF2Y29uRGF0YSk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoZGF0YVJvbGVbMF0uSXNTeXN0ZW1Sb2xlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2bS5pc0VkaXQgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdm0uaXNEZWxldGUgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdm0uaXNDYW5jZWwgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdm0uaXNJVEFSID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2bS5pc0VkaXQgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZtLmlzRGVsZXRlID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2bS5pc0NhbmNlbCA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdm0uaXNJVEFSID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmdW5jdGlvbiBnZXRTZXJ2ZXJEYXRhKHR5cGUsIHJvd0lkKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBkYXRhc2VydmljZS5nZXRTZXJ2ZXJEYXRhKHR5cGUsIHJvd0lkKS50aGVuKGZ1bmN0aW9uIChkYXRhKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gZGF0YTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgZnVuY3Rpb24gYWN0aXZhdGUoKSB7XHJcbiAgICAgICAgICAgIGdldFNlcnZlckRhdGEoJ3JvbGVNYW5hZ2VtZW50QWxsJykudGhlbihmdW5jdGlvbiAoZGF0YSkge1xyXG4gICAgICAgICAgICAgICAgLy9uYXZjb24uc2V0RGlzYWJsZWRFbmFibGVkQnlSaWdodHModm0ucmlnaHRzKTtcclxuICAgICAgICAgICAgICAgIGlmIChkYXRhID09PSB1bmRlZmluZWQgfHwgZGF0YS5sZW5ndGggPT09IDApIHJldHVybjtcclxuXHJcbiAgICAgICAgICAgICAgICB2bS5yb2xlTWFuYWdlbWVudFRhYmxlLmRhdGEgPSBkYXRhO1xyXG4gICAgICAgICAgICAgICAgdm0ucm9sZU1hbmFnZW1lbnRUYWJsZURhdGEgPSBkYXRhO1xyXG5cclxuICAgICAgICAgICAgICAgIC8vSVRBUldhcm5pbmdJbmRleCA9IG5hdmNvbi5nZXRJdGVtSW5kZXhCeVByb3BlcnR5KHZtLnJvbGVNYW5hZ2VtZW50RmllbGRzLCBcIklUQVJXYXJuaW5nXCIpO1xyXG4gICAgICAgICAgICAgICAgYWRkRXhpc3RpbmdTeXN0ZW1Sb2xlSW5kZXggPSBuYXZjb24uZ2V0SXRlbUluZGV4QnlQcm9wZXJ0eSh2bS5yb2xlTWFuYWdlbWVudEZpZWxkcywgXCJBZGRFeGlzdGluZ1N5c3RlbVJvbGVcIik7XHJcbiAgICAgICAgICAgICAgICBleGlzdGluZ1N5c3RlbVJvbGVJZEluZGV4ID0gbmF2Y29uLmdldEl0ZW1JbmRleEJ5UHJvcGVydHkodm0ucm9sZU1hbmFnZW1lbnRGaWVsZHMsIFwiRXhpc3RpbmdTeXN0ZW1Sb2xlSWRcIik7XHJcbiAgICAgICAgICAgICAgICAkc2NvcGUuaXRhcndhcm5pbmcgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgdm0uc2hvd0V4aXN0aW5nUm9sZXMgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgIHdhdGNoQXR0cmlidXRlcygpO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICBmdW5jdGlvbiBkZWZhdWx0RGF0YShkYXRhKSB7XHJcbiAgICAgICAgICAgIG5hdmNvbi5zYXZlLmxvYWRMaXN0RGVmYXVsdERhdGEoZGF0YSwgdm0ucm9sZU1hbmFnZW1lbnRGaWVsZHMpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gd2F0Y2hBdHRyaWJ1dGVzKCkge1xyXG4gICAgICAgICAgICAkc2NvcGUuJHdhdGNoKFwidm0ucm9sZU1hbmFnZW1lbnRGaWVsZHNbXCIgKyBhZGRFeGlzdGluZ1N5c3RlbVJvbGVJbmRleCArIFwiXS5kYXRhXCIsIGZ1bmN0aW9uIChuZXdWYWx1ZSwgb2xkVmFsdWUpIHtcclxuICAgICAgICAgICAgICAgIGlmIChuZXdWYWx1ZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHZtLnNob3dFeGlzdGluZ1JvbGVzID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIHZtLnNob3dFeGlzdGluZ1JvbGVzID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICAgICAgdm0ucm9sZU1hbmFnZW1lbnRGaWVsZHNbZXhpc3RpbmdTeXN0ZW1Sb2xlSWRJbmRleF0uZGF0YSA9IFwiXCI7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgLy8gSGlzdG9yeSBJVEFSICBXYXRjaFxyXG4gICAgICAgICAgICB2YXIgSGlzdG9yeUlUQVJXYXJuaW5nSW5kZXggPSBuYXZjb24uZ2V0SXRlbUluZGV4QnlQcm9wZXJ0eSh2bS5yb2xlTWFuYWdlbWVudEhpc3RvcnlGaWVsZHMsIFwiSVRBUldhcm5pbmdcIik7XHJcbiAgICAgICAgICAgICRzY29wZS4kd2F0Y2goXCJ2bS5yb2xlTWFuYWdlbWVudEhpc3RvcnlGaWVsZHNbXCIgKyBIaXN0b3J5SVRBUldhcm5pbmdJbmRleCArIFwiXS5kYXRhXCIsIGZ1bmN0aW9uIChuZXdWYWx1ZSwgb2xkVmFsdWUpIHtcclxuICAgICAgICAgICAgICAgIGlmIChuZXdWYWx1ZSAhPSB1bmRlZmluZWQgJiYgbmV3VmFsdWUgIT0gXCJcIikge1xyXG4gICAgICAgICAgICAgICAgICAgICRzY29wZS5oaXN0b3J5SXRhcldhcm5pbmcgPSBuZXdWYWx1ZTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICRzY29wZS5oaXN0b3J5SXRhcldhcm5pbmcgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSwgdHJ1ZSk7XHJcblxyXG4gICAgICAgICAgICAvLyRzY29wZS4kd2F0Y2goXCJ2bS5yb2xlTWFuYWdlbWVudEZpZWxkc1tcIiArIElUQVJXYXJuaW5nSW5kZXggKyBcIl0uZGF0YVwiLCBmdW5jdGlvbiAobmV3VmFsdWUsIG9sZFZhbHVlKSB7XHJcbiAgICAgICAgICAgIC8vICAgIGlmIChuZXdWYWx1ZSkge1xyXG4gICAgICAgICAgICAvLyAgICAgICAgJHNjb3BlLml0YXJ3YXJuaW5nID0gbmV3VmFsdWU7XHJcbiAgICAgICAgICAgIC8vICAgIH1cclxuICAgICAgICAgICAgLy8gICAgZWxzZSB7XHJcbiAgICAgICAgICAgIC8vICAgICAgICAkc2NvcGUuaXRhcndhcm5pbmcgPSBmYWxzZTtcclxuICAgICAgICAgICAgLy8gICAgfVxyXG4gICAgICAgICAgICAvL30sIHRydWUpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxufSkoKTsiLCIoZnVuY3Rpb24gKCkge1xyXG4gICAgJ3VzZSBzdHJpY3QnO1xyXG5cclxuICAgIGFuZ3VsYXJcclxuICAgICAgICAubW9kdWxlKCdhcHAudGlsZXMnKVxyXG4gICAgICAgIC5jb250cm9sbGVyKCd0aWxlcycsIHRpbGVzKTtcclxuXHJcbiAgICAvKiBAbmdJbmplY3QgKi9cclxuICAgIGZ1bmN0aW9uIHRpbGVzKCRzY29wZSwgZGF0YXNlcnZpY2UsIGxvZ2dlciwgbWVudVNldHRpbmdzLCAkcm9vdFNjb3BlLCAkbG9jYXRpb24pIHtcclxuICAgICAgICB2YXIgdm0gPSB0aGlzO1xyXG4gICAgICAgIHZtLnRpdGxlID0gJyc7XHJcbiAgICAgICAgdm0ubWVudSA9ICcnO1xyXG4gICAgICAgIFxyXG4gICAgICAgIHZtLm1lbnVDaGVjayA9IGZ1bmN0aW9uIChzdWJNZW51KSB7XHJcbiAgICAgICAgICAgIHJldHVybiBuYXZjb24ubWVudVJpZ2h0c0NoZWNrKG1lbnVTZXR0aW5ncywgdm0ubWVudSwgc3ViTWVudS50b0xvd2VyQ2FzZSgpKSA/IGZhbHNlIDogdHJ1ZTtcclxuICAgICAgICB9XHJcbiAgICAgICAgXHJcbiAgICAgICAgdm0uc3ViTWVudXMgPSBbXTtcclxuICAgICAgICBcclxuICAgICAgICAkc2NvcGUuJG9uKCdTVUJNRU5VLUxPQURJTkcnLCBmdW5jdGlvbihldmVudCwgbWVudSkge1xyXG4gICAgICAgICAgICB2bS5tZW51ID0gbWVudS50b0xvd2VyQ2FzZSgpO1xyXG4gICAgICAgICAgICB2bS5zdWJNZW51cyA9IG5hdmNvbi5nZXRTdWJNZW51cyhtZW51U2V0dGluZ3MsIHZtLm1lbnUpO1xyXG4gICAgICAgICAgICB2bS50aXRsZSA9IG5hdmNvbi5nZXRNZW51VGl0bGUobWVudVNldHRpbmdzLCB2bS5tZW51KTtcclxuXHJcbiAgICAgICAgfSk7IFxyXG4gICAgICAgIFxyXG4gICAgICAgIHZtLm1lbnUgPSAkbG9jYXRpb24uJCRwYXRoLnN1YnN0cmluZygxLCRsb2NhdGlvbi4kJHBhdGgubGVuZ3RoKS50b0xvd2VyQ2FzZSgpO1xyXG4gICAgICAgIHZtLnN1Yk1lbnVzID0gbmF2Y29uLmdldFN1Yk1lbnVzKG1lbnVTZXR0aW5ncywgdm0ubWVudSk7XHJcbiAgICAgICAgdm0udGl0bGUgPSBuYXZjb24uZ2V0TWVudVRpdGxlKG1lbnVTZXR0aW5ncywgdm0ubWVudSk7XHJcbiAgICAgICAgXHJcbiAgICB9XHJcbn0pKCk7IiwiKGZ1bmN0aW9uICgpIHtcclxuICAgICd1c2Ugc3RyaWN0JztcclxuICAgIGFuZ3VsYXJcclxuICAgICAgICAubW9kdWxlKCdhcHAudXNlcmFjY2Vzc3JpZ2h0cycpXHJcbiAgICAgICAgLmNvbnRyb2xsZXIoJ3VzZXJhY2Nlc3NyaWdodHMnLCB1c2VyYWNjZXNzcmlnaHRzKTtcclxuXHJcbiAgICAvKkBuZ0luamVjdCovXHJcbiAgICBmdW5jdGlvbiB1c2VyYWNjZXNzcmlnaHRzKCRzY29wZSwgZGF0YXNlcnZpY2UsIGxvZ2dlciwgJGNvbXBpbGUsICR0aW1lb3V0LCAkbG9jYXRpb24sIHBhZ2VDb25maWcsICRyb290U2NvcGUsIGxvY2FsU3RvcmFnZVNlcnZpY2UsICRodHRwLCBhdXRoU2VydmljZSwgbmdBdXRoU2V0dGluZ3MsIG1lbnVTZXR0aW5ncykge1xyXG4gICAgICAgIC8qUGFnZSBEZWNsYXJhdGlvbiovXHJcbiAgICAgICAgdmFyIHZtID0gdGhpcztcclxuICAgICAgICBhY3RpdmF0ZSgpO1xyXG5cclxuICAgICAgICBpZiAocGFnZUNvbmZpZyA9PT0gdW5kZWZpbmVkIHx8IHBhZ2VDb25maWcuZmllbGRzID09PSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgICAgJGxvY2F0aW9uLnVybCgnLycpO1xyXG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvKiBIaXN0b3J5IEZpZWxkcyAqL1xyXG4gICAgICAgICRzY29wZS5pc0hpc3RvcnkgPSBmYWxzZTtcclxuICAgICAgICAkc2NvcGUuaGlzdG9yeVN0YXRlID0gXCJTYXZlXCI7XHJcbiAgICAgICAgJHNjb3BlLkhpc3RvcnlUaXRsZSA9IFwiUmV2aWV3IENoYW5nZXNcIjtcclxuICAgICAgICAkc2NvcGUuaGlkZUhpc3RvcnkgPSBmYWxzZTtcclxuXHJcbiAgICAgICAgJHNjb3BlLklzU3Vic2VjdGlvbiA9ICd5ZXMnO1xyXG4gICAgICAgICRzY29wZS5TdWJzZWN0aW9uSGVhZGluZyA9IFwiTWVudVwiO1xyXG5cclxuICAgICAgICB2bS5yaWdodHMgPSBuYXZjb24uZ2V0VXNlclJpZ2h0cyhtZW51U2V0dGluZ3MsIFwicGFkbWluaXN0cmF0aW9uXCIsIFwidXNlcmFjY2Vzc3JpZ2h0c1wiKTtcclxuXHJcbiAgICAgICAgLypTZXR0aW5ncyovXHJcbiAgICAgICAgdm0ucGFnZUNvbmZpZyA9IHBhZ2VDb25maWc7XHJcbiAgICAgICAgdm0udXNlckFjY2Vzc1JpZ2h0c0ZpZWxkcyA9IGFuZ3VsYXIuY29weSh2bS5wYWdlQ29uZmlnLmZpZWxkcy51c2VyQWNjZXNzUmlnaHRzRmllbGRzKTtcclxuICAgICAgICB2bS51c2VyQWNjZXNzUmlnaHRzSGlzdG9yeUZpZWxkcyA9IGFuZ3VsYXIuY29weSh2bS5wYWdlQ29uZmlnLmZpZWxkcy51c2VyQWNjZXNzUmlnaHRzSGlzdG9yeUZpZWxkcyk7XHJcbiAgICAgICAgdm0udXNlckFjY2Vzc1JpZ2h0c1RyZWUgPSBhbmd1bGFyLmNvcHkodm0ucGFnZUNvbmZpZy50cmVlcy51c2VyQWNjZXNzUmlnaHRzVHJlZSk7XHJcbiAgICAgICAgZGVmYXVsdERhdGEodm0ucGFnZUNvbmZpZy5kYXRhKTtcclxuICAgICAgICB3YXRjaEF0dHJpYnV0ZXMoKTtcclxuXHJcbiAgICAgICAgLypWYXJpYWJsZSBEZWNsYXJhdGlvbiovXHJcbiAgICAgICAgdm0ucHJpbWFyeUtleSA9IFwiUmlnaHRzSWRcIjtcclxuICAgICAgICB2bS5pc1NhdmUgPSB0cnVlO1xyXG4gICAgICAgIHZtLmlzVXBkYXRlID0gdHJ1ZTtcclxuICAgICAgICB2bS5zYXZlVGl0bGUgPSBcIlwiO1xyXG4gICAgICAgIHZtLnNlbGVjdGVkRHJvcERvd24gPSBcIlwiO1xyXG4gICAgICAgIHZtLm5ld0lkID0gLTE7XHJcbiAgICAgICAgdm0ubW9kZSA9IFwiU2F2ZVwiO1xyXG4gICAgICAgIHZtLmZvcm1NYW5hZ2UgPSB7fTtcclxuICAgICAgICB2bS5zaG93SGlzdG9yeSA9IGZhbHNlO1xyXG4gICAgICAgIHZhciBkZW55Q29sdW1uSWQgPSBcImNvbDZcIjtcclxuICAgICAgICB2bS5zaG93UmVzZXQgPSBmYWxzZTtcclxuXHJcbiAgICAgICAgLypTYXZlKi9cclxuICAgICAgICB2bS5zYXZlID0gZnVuY3Rpb24gKG1vZGUsIGNhbGxiYWNrKSB7XHJcbiAgICAgICAgICAgIHZhciBSaWdodHNJZEluZGV4ID0gbmF2Y29uLmdldEl0ZW1JbmRleEJ5UHJvcGVydHkodm0udXNlckFjY2Vzc1JpZ2h0c0ZpZWxkcywgXCJSaWdodHNJZFwiKTtcclxuICAgICAgICAgICAgaWYgKHZtLnVzZXJBY2Nlc3NSaWdodHNUcmVlLmNvcmUuZGF0YSA9PT0gdW5kZWZpbmVkIHx8IHZtLnVzZXJBY2Nlc3NSaWdodHNUcmVlLmNvcmUuZGF0YS5sZW5ndGggPT09IDApIHtcclxuICAgICAgICAgICAgICAgIGxvZ2dlci53YXJuaW5nKFwiTWVudSAtIHN1YiBtZW51IGl0ZW1zIHNob3VsZCBiZSBsaXN0ZWQuLlwiKTtcclxuICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgIC8vdm0uUHJvY2VlZFRvU2F2ZSgpO1xyXG4gICAgICAgICAgICAgICAgdmFyIFJpZ2h0c0RldGFpbHNJbmRleCA9IG5hdmNvbi5nZXRJdGVtSW5kZXhCeVByb3BlcnR5KHZtLnVzZXJBY2Nlc3NSaWdodHNGaWVsZHMsIFwiUmlnaHRzRGV0YWlsc1wiKTtcclxuICAgICAgICAgICAgICAgIHZtLnVzZXJBY2Nlc3NSaWdodHNUcmVlLm9sZERhdGEgPSBhbmd1bGFyLmNvcHkodm0udXNlckFjY2Vzc1JpZ2h0c1RyZWUuY29yZS5vbGREYXRhKTtcclxuXHJcbiAgICAgICAgICAgICAgICB2YXIgdHJlZSA9ICQoXCJuYXZjb24tdHJlZVt0eXBlPSd1c2VyQWNjZXNzUmlnaHRzJ11cIikuZmluZCgnLmpzdHJlZScpLmZpbmQoXCJkaXZbcm9sZT0ndHJlZSddXCIpLmpzdHJlZShmYWxzZSk7XHJcbiAgICAgICAgICAgICAgICB2bS51c2VyQWNjZXNzUmlnaHRzVHJlZS5jb3JlLmRhdGEgPSB0cmVlLnNldHRpbmdzLmNvcmUuZGF0YTtcclxuICAgICAgICAgICAgICAgIHZhciB0cmVlTmV3RGF0YSA9IG5hdmNvbi5nZXREYXRhRnJvbVRyZWUodm0udXNlckFjY2Vzc1JpZ2h0c1RyZWUuY29yZS5kYXRhLCAnJywgMCk7XHJcbiAgICAgICAgICAgICAgICB2bS51c2VyQWNjZXNzUmlnaHRzVHJlZS5kYXRhID0gdHJlZU5ld0RhdGE7IC8vbmF2Y29uLmdldEZpZWxkc0RhdGFUb1NhdmUodm0udXNlckFjY2Vzc1JpZ2h0c0ZpZWxkcywgbW9kZSwgXCJSaWdodHNJZFwiKVxyXG5cclxuICAgICAgICAgICAgICAgICRzY29wZS5IaXN0b3J5ZGF0YSA9IG5hdmNvbi5jb21wYXJlZGF0YSh2bS51c2VyQWNjZXNzUmlnaHRzRmllbGRzLCAnU2VjdXJpdHknLCBcIlwiLCBcIlJpZ2h0c0lkXCIsIHZtLnVzZXJBY2Nlc3NSaWdodHNGaWVsZHNbUmlnaHRzSWRJbmRleF0uZGF0YSk7XHJcbiAgICAgICAgICAgICAgICB2YXIgSGlzdG9yeUluZGV4ID0gbmF2Y29uLmdldEl0ZW1JbmRleEJ5UHJvcGVydHkodm0udXNlckFjY2Vzc1JpZ2h0c0ZpZWxkcywgJ0hpc3RvcnknKTtcclxuICAgICAgICAgICAgICAgIHZtLnVzZXJBY2Nlc3NSaWdodHNGaWVsZHNbSGlzdG9yeUluZGV4XS5kYXRhID0gJHNjb3BlLkhpc3RvcnlkYXRhO1xyXG4gICAgICAgICAgICAgICAgdm0uSGlzdG9yeVRpdGxlID0gJ1JldmlldyBDaGFuZ2VzJztcclxuXHJcbiAgICAgICAgICAgICAgICBpZiAoJHNjb3BlLkhpc3RvcnlkYXRhICE9PSB1bmRlZmluZWQgJiYgJHNjb3BlLkhpc3RvcnlkYXRhLmxlbmd0aCA+IDApIHtcclxuICAgICAgICAgICAgICAgICAgICAkc2NvcGUuSGlzdG9yeWRhdGEuc3BsaWNlKDAsIDEpOyAvL2V4Y2x1ZGluZyBSb2xlIERyb3Bkb3dubGlzdFxyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIGlmICgkc2NvcGUuSGlzdG9yeWRhdGEgIT09IHVuZGVmaW5lZCAmJiAkc2NvcGUuSGlzdG9yeWRhdGEubGVuZ3RoID4gMCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgJHNjb3BlLkhpc3RvcnlkYXRhLmxlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICgkc2NvcGUuSGlzdG9yeWRhdGFbaV0ub2xkRGF0YSA9PT0gMCB8fCAkc2NvcGUuSGlzdG9yeWRhdGFbaV0ub2xkRGF0YSA9PT0gZmFsc2UpICRzY29wZS5IaXN0b3J5ZGF0YVtpXS5vbGREYXRhID0gXCJOb1wiO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoJHNjb3BlLkhpc3RvcnlkYXRhW2ldLm9sZERhdGEgPT09IDEgfHwgJHNjb3BlLkhpc3RvcnlkYXRhW2ldLm9sZERhdGEgPT09IHRydWUpICRzY29wZS5IaXN0b3J5ZGF0YVtpXS5vbGREYXRhID0gXCJZZXNcIjtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICgkc2NvcGUuSGlzdG9yeWRhdGFbaV0uTmV3RGF0YSA9PT0gMCB8fCAkc2NvcGUuSGlzdG9yeWRhdGFbaV0uTmV3RGF0YSA9PT0gZmFsc2UpICRzY29wZS5IaXN0b3J5ZGF0YVtpXS5OZXdEYXRhID0gXCJOb1wiO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoJHNjb3BlLkhpc3RvcnlkYXRhW2ldLk5ld0RhdGEgPT09IDEgfHwgJHNjb3BlLkhpc3RvcnlkYXRhW2ldLk5ld0RhdGEgPT09IHRydWUpICRzY29wZS5IaXN0b3J5ZGF0YVtpXS5OZXdEYXRhID0gXCJZZXNcIjtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICRzY29wZS5oaWRlSGlzdG9yeSA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgICAgICRzY29wZS5pc0hpc3RvcnkgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgICAgICRzY29wZS5oaXN0b3J5U3RhdGUgPSBcIlNhdmVcIjtcclxuICAgICAgICAgICAgICAgICAgICBuYXZjb24ub3Blbk1vZGFsKCdyZXZpZXcnKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICRzY29wZS5oaWRlSGlzdG9yeSA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICAgJHNjb3BlLmlzSGlzdG9yeSA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgICAgIG5hdmNvbi5vcGVuTW9kYWwoJ25vdEZvdW5kJyk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICAkc2NvcGUuc2F2ZUNoYW5nZXMgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIGlmICh2bS5mb3JtTWFuYWdlLmZvcm1WYWxpZCh2bS51c2VyQWNjZXNzUmlnaHRzSGlzdG9yeUZpZWxkcykpIHtcclxuICAgICAgICAgICAgICAgIHZhciBIaXN0b3J5UmVtYXJrc0luZGV4ID0gbmF2Y29uLmdldEl0ZW1JbmRleEJ5UHJvcGVydHkodm0udXNlckFjY2Vzc1JpZ2h0c0ZpZWxkcywgXCJIaXN0b3J5UmVtYXJrc1wiKTtcclxuICAgICAgICAgICAgICAgIHZhciBSZW1hcmtzSW5kZXggPSBuYXZjb24uZ2V0SXRlbUluZGV4QnlQcm9wZXJ0eSh2bS51c2VyQWNjZXNzUmlnaHRzSGlzdG9yeUZpZWxkcywgXCJIaXN0b3J5UmVtYXJrc1wiKTtcclxuICAgICAgICAgICAgICAgIHZhciBvYmpIaXN0b3J5ID0geyBSZW1hcmtzOiB2bS51c2VyQWNjZXNzUmlnaHRzSGlzdG9yeUZpZWxkc1tSZW1hcmtzSW5kZXhdLmRhdGEgfTtcclxuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKG9iakhpc3RvcnkpO1xyXG4gICAgICAgICAgICAgICAgdm0udXNlckFjY2Vzc1JpZ2h0c0ZpZWxkc1tIaXN0b3J5UmVtYXJrc0luZGV4XS5kYXRhID0gb2JqSGlzdG9yeTtcclxuICAgICAgICAgICAgICAgIHZtLlByb2NlZWRUb1NhdmUoKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZtLlByb2NlZWRUb1NhdmUgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIHZhciB0eXBlID0gXCJ1c2VyQWNjZXNzUmlnaHRzXCI7XHJcbiAgICAgICAgICAgIHZtLnNhdmVUaXRsZSA9IG5hdmNvbi5zYXZlLnRyZWVBY3Rpb24odm0sIGRhdGFzZXJ2aWNlLCB2bS5tb2RlLCB0eXBlLCB2bS51c2VyQWNjZXNzUmlnaHRzRmllbGRzLFxyXG4gICAgICAgICAgICAgICAgbnVsbCwgbnVsbCwgdm0ucHJpbWFyeUtleSwgXCJcIiwgdm0udXNlckFjY2Vzc1JpZ2h0c1RyZWUuY29yZS5kYXRhLCBcIlwiLCBmdW5jdGlvbiAoZGF0YSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHZtLnNhdmVUaXRsZSA9IGRhdGE7XHJcbiAgICAgICAgICAgICAgICAgICAgLy9nZXRSaWdodHNCeUlkKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgJCgnI1VzZXInKS5yZW1vdmVDbGFzcygnaW4nKTtcclxuICAgICAgICAgICAgICAgICAgICB2bS5zaG93SGlzdG9yeSA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgICAgIHZtLnNob3dSZXNldCA9IGZhbHNlO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICBpZiAoZGF0YSAhPT0gdW5kZWZpbmVkICYmIHZtLm1vZGUgPT0gXCJVcGRhdGVcIilcclxuICAgICAgICAgICAgICAgICAgICAgICAgbG9nZ2VyLnN1Y2Nlc3MoXCJFbnRyaWVzIGFyZSB1cGRhdGVkIHN1Y2Nlc3NmdWxseS4uLlwiKTtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoZGF0YSAhPT0gdW5kZWZpbmVkICYmIHZtLm1vZGUgPT0gXCJTYXZlXCIpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGxvZ2dlci5zdWNjZXNzKFwiRW50cmllcyBhcmUgc2F2ZWQgc3VjY2Vzc2Z1bGx5Li4uXCIpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAkc2NvcGUuY2FuY2VsKCdyZXZpZXcnKTtcclxuICAgICAgICAgICAgICAgICAgICBuYXZjb24uY2xlYXJGaWVsZHNEYXRhKHZtLnVzZXJBY2Nlc3NSaWdodHNIaXN0b3J5RmllbGRzKTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgZGVmYXVsdERhdGEodm0ucGFnZUNvbmZpZy5kYXRhKTtcclxuICAgICAgICAgICAgdm0udXNlckFjY2Vzc1JpZ2h0c1RyZWUuY29yZS5kYXRhID0gW107XHJcbiAgICAgICAgICAgIHZtLm1vZGUgPSBcIlNhdmVcIjtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgICRzY29wZS5IaXN0b3J5Q2hhbmdlcyA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgJHNjb3BlLmhpZGVIaXN0b3J5ID0gZmFsc2U7XHJcbiAgICAgICAgICAgIHZhciBpZE5hbWVJbmRleCA9IG5hdmNvbi5nZXRJdGVtSW5kZXhCeVByb3BlcnR5KHZtLnVzZXJBY2Nlc3NSaWdodHNGaWVsZHMsIFwiUmlnaHRzSWRcIik7XHJcblxyXG4gICAgICAgICAgICBkYXRhc2VydmljZS5nZXREYXRhKFwiSGlzdG9yeS9HZXRIaXN0b3J5L1JpZ2h0c0lkL1wiICsgdm0udXNlckFjY2Vzc1JpZ2h0c0ZpZWxkc1tpZE5hbWVJbmRleF0uZGF0YSkudGhlbihmdW5jdGlvbiAoZGF0YSkge1xyXG4gICAgICAgICAgICAgICAgJHNjb3BlLkhpc3RvcnlUaXRsZSA9IFwiSGlzdG9yeVwiO1xyXG5cclxuICAgICAgICAgICAgICAgIGlmIChkYXRhICE9IHVuZGVmaW5lZCAmJiBkYXRhICE9IG51bGwgJiYgZGF0YS5sZW5ndGggPiAwKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgJHNjb3BlLkhpc3RvcnlkYXRhID0gZGF0YTtcclxuICAgICAgICAgICAgICAgICAgICAkc2NvcGUuaGlkZUhpc3RvcnkgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgJHNjb3BlLkhpc3RvcnlkYXRhID0gZGF0YTtcclxuICAgICAgICAgICAgICAgICAgICAkc2NvcGUuaGlkZUhpc3RvcnkgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICRzY29wZS5pc0hpc3RvcnkgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgJHNjb3BlLmhpc3RvcnlTdGF0ZSA9IFwiVmlld1wiO1xyXG4gICAgICAgICAgICAgICAgbmF2Y29uLm9wZW5Nb2RhbCgncmV2aWV3Jyk7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgICRzY29wZS5jYW5jZWwgPSBmdW5jdGlvbiAodHlwZSkge1xyXG4gICAgICAgICAgICAkc2NvcGUuaXNIaXN0b3J5ID0gZmFsc2U7XHJcbiAgICAgICAgICAgIG5hdmNvbi5jbG9zZU1vZGFsKHR5cGUpO1xyXG4gICAgICAgICAgICBuYXZjb24uY2xlYXJGaWVsZHNEYXRhKHZtLnVzZXJBY2Nlc3NSaWdodHNIaXN0b3J5RmllbGRzKTtcclxuICAgICAgICAgICAgJHNjb3BlLkhpc3RvcnlkYXRhID0gW107XHJcbiAgICAgICAgICAgICRzY29wZS5oaXN0b3J5U3RhdGUgPSBcIlNhdmVcIjtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHZtLmNhbmNlbCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgZGVmYXVsdERhdGEodm0ucGFnZUNvbmZpZy5kYXRhKTtcclxuICAgICAgICAgICAgdm0udXNlckFjY2Vzc1JpZ2h0c1RyZWUuY29yZS5kYXRhID0gW107XHJcbiAgICAgICAgICAgIHZtLm1vZGUgPSBcIlNhdmVcIjtcclxuICAgICAgICAgICAgJCgnI1VzZXInKS5yZW1vdmVDbGFzcygnaW4nKTtcclxuICAgICAgICAgICAgdm0uc2hvd0hpc3RvcnkgPSBmYWxzZTtcclxuXHJcbiAgICAgICAgICAgICRzY29wZS5pc0hpc3RvcnkgPSBmYWxzZTtcclxuICAgICAgICAgICAgbmF2Y29uLmNsb3NlTW9kYWwodHlwZSk7XHJcbiAgICAgICAgICAgIG5hdmNvbi5jbGVhckZpZWxkc0RhdGEodm0udXNlckFjY2Vzc1JpZ2h0c0hpc3RvcnlGaWVsZHMpO1xyXG4gICAgICAgICAgICAkc2NvcGUuSGlzdG9yeWRhdGEgPSBbXTtcclxuICAgICAgICAgICAgJHNjb3BlLmhpc3RvcnlTdGF0ZSA9IFwiU2F2ZVwiO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZtLnNob3dIaWRlID0gZnVuY3Rpb24gKGlkLCBtb2RlKSB7XHJcbiAgICAgICAgICAgIGlmICghJCgnIycgKyBpZCkuaGFzQ2xhc3MoJ2luJykpIHtcclxuICAgICAgICAgICAgICAgICQoJyMnICsgaWQpLnRvZ2dsZUNsYXNzKCdpbicpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICB2bS5zaG93UmlnaHRzID0gZnVuY3Rpb24gKCkge1xyXG5cclxuICAgICAgICAgICAgdm0uc2hvd1Jlc2V0ID0gZmFsc2U7XHJcblxyXG4gICAgICAgICAgICBpZiAodm0uZm9ybU1hbmFnZS5mb3JtVmFsaWQodm0udXNlckFjY2Vzc1JpZ2h0c0ZpZWxkcykpIHtcclxuICAgICAgICAgICAgICAgIHZhciBjaGVja05vZGVzID0gMDtcclxuICAgICAgICAgICAgICAgIHZhciByb2xlSW5kZXggPSBuYXZjb24uZ2V0SXRlbUluZGV4QnlQcm9wZXJ0eSh2bS51c2VyQWNjZXNzUmlnaHRzRmllbGRzLCBcIlJvbGVJZFwiKTtcclxuICAgICAgICAgICAgICAgIGlmICh2bS51c2VyQWNjZXNzUmlnaHRzRmllbGRzW3JvbGVJbmRleF0uZGF0YSA9PT0gdW5kZWZpbmVkIHx8IHZtLnVzZXJBY2Nlc3NSaWdodHNGaWVsZHNbcm9sZUluZGV4XS5kYXRhID09PSBcIlwiIHx8IHZtLnVzZXJBY2Nlc3NSaWdodHNGaWVsZHNbcm9sZUluZGV4XS5kYXRhLmxlbmd0aCA9PT0gMCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGxvZ2dlci53YXJuaW5nKHZtLnVzZXJBY2Nlc3NSaWdodHNGaWVsZHNbcm9sZUluZGV4XS50ZW1wbGF0ZU9wdGlvbnMucmVxdWlyZWRNZXNzYWdlKTtcclxuICAgICAgICAgICAgICAgICAgICAkKCcjVXNlcicpLnJlbW92ZUNsYXNzKCdpbicpO1xyXG4gICAgICAgICAgICAgICAgICAgIHZtLnNob3dIaXN0b3J5ID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgaWYgKHZtLm5ld0lkICE9PSAtMSkge1xyXG5cclxuICAgICAgICAgICAgICAgICAgICB2bS5zaG93SGlkZSgnVXNlcicpO1xyXG4gICAgICAgICAgICAgICAgICAgIHZtLnNob3dSZXNldCA9IHRydWU7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGlmICh2bS5uZXdJZCAhPT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGdldFNlcnZlckRhdGEodm0uc2VsZWN0ZWREcm9wRG93biwgdm0ubmV3SWQpLnRoZW4oZnVuY3Rpb24gKGRhdGEpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChkYXRhID09PSB1bmRlZmluZWQgfHwgZGF0YSA9PT0gbnVsbCB8fCBkYXRhLmxlbmd0aCA9PT0gMCkgcmV0dXJuO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdm0udXNlckFjY2Vzc1JpZ2h0c1RyZWUuY29yZS5kYXRhID0gZGF0YS5NZW51O1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZtLmZvcm1NYW5hZ2UudXNlckFjY2Vzc1JpZ2h0c1RyZWUgPSB2bS51c2VyQWNjZXNzUmlnaHRzVHJlZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBSaWdodHNJZEluZGV4ID0gbmF2Y29uLmdldEl0ZW1JbmRleEJ5UHJvcGVydHkodm0udXNlckFjY2Vzc1JpZ2h0c0ZpZWxkcywgXCJSaWdodHNJZFwiKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZtLnVzZXJBY2Nlc3NSaWdodHNGaWVsZHNbUmlnaHRzSWRJbmRleF0uZGF0YSA9IGRhdGEuUmlnaHRzSWQ7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGRhdGEuUmlnaHRzSWQgPT09IDApIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2bS5tb2RlID0gXCJTYXZlXCI7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdm0uaXNTYXZlID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdm0uaXNVcGRhdGUgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdm0ubW9kZSA9IFwiVXBkYXRlXCI7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdm0uaXNTYXZlID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2bS5pc1VwZGF0ZSA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICQoJy5qc3RyZWUtZ3JpZC1taWR3cmFwcGVyJykuZmluZCgnaW5wdXQnKS5yZW1vdmVBdHRyKFwiZGlzYWJsZWRcIik7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGRhdGEuSXNTeXN0ZW1Sb2xlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdm0uaXNTYXZlID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2bS5pc1VwZGF0ZSA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdm0uc2hvd0hpc3RvcnkgPSBmYWxzZTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJHRpbWVvdXQoZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkKCcuanN0cmVlLWdyaWQtbWlkd3JhcHBlcicpLmZpbmQoJ2lucHV0JykuYXR0cihcImRpc2FibGVkXCIsIFwiZGlzYWJsZWRcIik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vJCgnLmpzdHJlZS1vY2wnKS5yZW1vdmVDbGFzcygnanN0cmVlLWljb24nKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LCA4MDApO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdm0uc2hvd0hpc3RvcnkgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZtLnVzZXJBY2Nlc3NSaWdodHNUcmVlLmNvcmUub2xkRGF0YSA9IGFuZ3VsYXIuY29weShuYXZjb24uZ2V0RGF0YUZyb21UcmVlKHZtLnVzZXJBY2Nlc3NSaWdodHNUcmVlLmNvcmUuZGF0YSwgJycsIDApKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgbG9nZ2VyLndhcm5pbmcoXCJJbnZhbGlkIGVudHJpZXMuLi5cIiwgXCJcIiwgXCJcIik7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2bS5yZXNldCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgdmFyIFJvbGVJZEluZGV4ID0gbmF2Y29uLmdldEl0ZW1JbmRleEJ5UHJvcGVydHkodm0udXNlckFjY2Vzc1JpZ2h0c0ZpZWxkcywgXCJSb2xlSWRcIik7XHJcbiAgICAgICAgICAgIHZtLnVzZXJBY2Nlc3NSaWdodHNGaWVsZHNbUm9sZUlkSW5kZXhdLmRhdGEgPSBbXTtcclxuICAgICAgICAgICAgJCgnI1VzZXInKS5yZW1vdmVDbGFzcygnaW4nKTtcclxuICAgICAgICAgICAgdm0uc2hvd1Jlc2V0ID0gZmFsc2U7XHJcblxyXG4gICAgICAgICAgICAvLyRsb2NhdGlvbi5wYXRoKCd1c2VyYWNjZXNzcmlnaHRzLycpO1xyXG4gICAgICAgICAgICAvLyQoJyNVc2VyJykucmVtb3ZlQ2xhc3MoJ2luJyk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICB2bS50cmVlQWN0aW9uQ2xpY2sgPSBmdW5jdGlvbiAoYWN0aW9uLCB0eXBlLCB0ZXh0LCBkYXRhLCBvVHJlZSwgdGFyZ2V0KSB7XHJcblxyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZtLnRyZWVDZWxsQ2xpY2sgPSBmdW5jdGlvbiAoaWQsIGZpZWxkLCB2YWx1ZSwgbm9kZSwgb1RyZWUpIHtcclxuXHJcbiAgICAgICAgICAgIC8vdmFyIHR5cGUgPSBcInVzZXJBY2Nlc3NSaWdodHNcIjtcclxuICAgICAgICAgICAgLy92YXIgZGF0YSA9IHZtLnVzZXJBY2Nlc3NSaWdodHNUcmVlLmNvcmUuZGF0YTtcclxuICAgICAgICAgICAgLy92YXIgdHJlZSA9ICQoXCJuYXZjb24tdHJlZVt0eXBlPSdcIiArIHR5cGUgKyBcIiddXCIpLmZpbmQoJy5qc3RyZWUnKS5maW5kKFwiZGl2W3JvbGU9J3RyZWUnXVwiKS5qc3RyZWUodHJ1ZSk7XHJcbiAgICAgICAgICAgIC8vaWYgKHRyZWUuc2V0dGluZ3MgIT09IHVuZGVmaW5lZCAmJiB0cmVlLnNldHRpbmdzLmNvcmUuZGF0YS5sZW5ndGggIT09IDApIGRhdGEgPSB0cmVlLnNldHRpbmdzLmNvcmUuZGF0YTsgICAgICAgICAgICBcclxuXHJcbiAgICAgICAgICAgIC8vaWYgKGZpZWxkID09PSAnRGVueScgJiYgdmFsdWUgPT09IHRydWUpIHtcclxuICAgICAgICAgICAgLy8gICAgJChcIltkYXRhLWpzdHJlZWdyaWQ9XCIgKyBpZCArIFwiXVwiKS5maW5kKFwiSU5QVVRcIikuYXR0cihcImNoZWNrZWRcIiwgZmFsc2UpO1xyXG4gICAgICAgICAgICAvLyAgICAkKFwiW2lkPWpzZ3JpZF9cIiArIGlkICsgXCJfXCIgKyBkZW55Q29sdW1uSWQgKyBcIl1cIikuZmluZChcIklOUFVUXCIpLmF0dHIoXCJjaGVja2VkXCIsIHRydWUpOyAgICAgICAgICAgICAgICBcclxuXHJcbiAgICAgICAgICAgIC8vICAgIGlmIChkYXRhICE9PSB1bmRlZmluZWQgJiYgZGF0YS5sZW5ndGggIT09IDApIHtcclxuICAgICAgICAgICAgLy8gICAgICAgIHZhciB0cmVlRGF0YSA9IG5hdmNvbi5nZXREYXRhRnJvbVRyZWUoZGF0YSwgJycsIDApO1xyXG4gICAgICAgICAgICAvLyAgICAgICAgdmFyIGN1cnJlbnRJbmRleCA9IG5hdmNvbi5nZXRJdGVtSW5kZXhCeUtleVZhbHVlKHRyZWVEYXRhLCBcImlkXCIsIHBhcnNlRmxvYXQobm9kZS5kYXRhLmlkKSk7XHJcbiAgICAgICAgICAgIC8vICAgICAgICB0cmVlRGF0YVtjdXJyZW50SW5kZXhdLmRhdGEuQWRkID0gMDtcclxuICAgICAgICAgICAgLy8gICAgICAgIHRyZWVEYXRhW2N1cnJlbnRJbmRleF0uZGF0YS5FZGl0ID0gMDtcclxuICAgICAgICAgICAgLy8gICAgICAgIHRyZWVEYXRhW2N1cnJlbnRJbmRleF0uZGF0YS5EZWxldGUgPSAwO1xyXG4gICAgICAgICAgICAvLyAgICAgICAgdHJlZURhdGFbY3VycmVudEluZGV4XS5kYXRhLlZpZXcgPSAwO1xyXG4gICAgICAgICAgICAvLyAgICAgICAgdHJlZURhdGFbY3VycmVudEluZGV4XS5kYXRhLlBSSU5UID0gMDtcclxuICAgICAgICAgICAgLy8gICAgfVxyXG4gICAgICAgICAgICAvLyAgICBub2RlLmRhdGEuQWRkID0gZmFsc2U7XHJcbiAgICAgICAgICAgIC8vICAgIG5vZGUuZGF0YS5FZGl0ID0gZmFsc2U7XHJcbiAgICAgICAgICAgIC8vICAgIG5vZGUuZGF0YS5EZWxldGUgPSBmYWxzZTtcclxuICAgICAgICAgICAgLy8gICAgbm9kZS5kYXRhLlZpZXcgPSBmYWxzZTtcclxuICAgICAgICAgICAgLy8gICAgbm9kZS5kYXRhLlBSSU5UID0gZmFsc2U7XHJcbiAgICAgICAgICAgIC8vfVxyXG4gICAgICAgICAgICAvL2Vsc2Uge1xyXG4gICAgICAgICAgICAvLyAgICAkKFwiW2lkPWpzZ3JpZF9cIiArIGlkICsgXCJfXCIgKyBkZW55Q29sdW1uSWQgKyBcIl1cIikuZmluZChcIklOUFVUXCIpLmF0dHIoXCJjaGVja2VkXCIsIGZhbHNlKTtcclxuXHJcbiAgICAgICAgICAgIC8vICAgIGlmIChkYXRhICE9PSB1bmRlZmluZWQgJiYgZGF0YS5sZW5ndGggIT09IDApIHtcclxuICAgICAgICAgICAgLy8gICAgICAgIHZhciB0cmVlRGF0YSA9IG5hdmNvbi5nZXREYXRhRnJvbVRyZWUoZGF0YSwgJycsIDApO1xyXG4gICAgICAgICAgICAvLyAgICAgICAgdmFyIGN1cnJlbnRJbmRleCA9IG5hdmNvbi5nZXRJdGVtSW5kZXhCeUtleVZhbHVlKHRyZWVEYXRhLCBcImlkXCIsIHBhcnNlRmxvYXQobm9kZS5kYXRhLmlkKSk7XHJcbiAgICAgICAgICAgIC8vICAgICAgICB0cmVlRGF0YVtjdXJyZW50SW5kZXhdLmRhdGEuRGVueSA9IDA7XHJcbiAgICAgICAgICAgIC8vICAgIH1cclxuICAgICAgICAgICAgLy8gICAgbm9kZS5kYXRhLkRlbnkgPSBmYWxzZTtcclxuICAgICAgICAgICAgLy99XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgLypQcml2YXRlIGZ1bmN0aW9ucyovXHJcbiAgICAgICAgZnVuY3Rpb24gZ2V0U2VydmVyRGF0YSh0eXBlLCByb3dJZCkge1xyXG4gICAgICAgICAgICByZXR1cm4gZGF0YXNlcnZpY2UuZ2V0U2VydmVyRGF0YSh0eXBlLCByb3dJZCkudGhlbihmdW5jdGlvbiAoZGF0YSkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGRhdGE7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIGFjdGl2YXRlKCkge1xyXG5cclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICBmdW5jdGlvbiBnZXRSaWdodHNCeUlkKCkge1xyXG4gICAgICAgICAgICB2YXIgc2VydmljZUJhc2UgPSBuZ0F1dGhTZXR0aW5ncy5hcGlTZXJ2aWNlQmFzZVVyaTtcclxuICAgICAgICAgICAgJGh0dHAuZ2V0KHNlcnZpY2VCYXNlICsgJ2hvbWUvU2VjdXJpdHkvJyArIGF1dGhTZXJ2aWNlLmF1dGhlbnRpY2F0aW9uLnVzZXJJZCwgeyBoZWFkZXJzOiB7ICdDb250ZW50LVR5cGUnOiAnYXBwbGljYXRpb24vanNvbicgfSB9KS5zdWNjZXNzKGZ1bmN0aW9uIChyaWdodHMpIHtcclxuICAgICAgICAgICAgICAgIHZhciBhdXRoRGF0YSA9IGxvY2FsU3RvcmFnZVNlcnZpY2UuZ2V0KCdhdXRob3JpemF0aW9uRGF0YScpO1xyXG4gICAgICAgICAgICAgICAgYXV0aERhdGEudXNlclJpZ2h0cyA9IHJpZ2h0cztcclxuICAgICAgICAgICAgICAgIGxvY2FsU3RvcmFnZVNlcnZpY2Uuc2V0KCdhdXRob3JpemF0aW9uRGF0YScsIGF1dGhEYXRhKTtcclxuICAgICAgICAgICAgICAgIGF1dGhTZXJ2aWNlLmZpbGxBdXRoRGF0YSgpO1xyXG4gICAgICAgICAgICAgICAgbWVudVNldHRpbmdzLmRhdGEgPSByaWdodHM7XHJcbiAgICAgICAgICAgICAgICAkcm9vdFNjb3BlLiRicm9hZGNhc3QoJ01FTlUtU0VUVElORy1EQVRBLVJFRlJFU0gnKTtcclxuICAgICAgICAgICAgfSkuZXJyb3IoZnVuY3Rpb24gKGVyciwgc3RhdHVzKSB7XHJcblxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICBmdW5jdGlvbiBkZWZhdWx0RGF0YShkYXRhKSB7XHJcbiAgICAgICAgICAgIG5hdmNvbi5zYXZlLmxvYWRMaXN0RGVmYXVsdERhdGEoZGF0YSwgdm0udXNlckFjY2Vzc1JpZ2h0c0ZpZWxkcyk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmdW5jdGlvbiB3YXRjaEF0dHJpYnV0ZXMoKSB7XHJcbiAgICAgICAgICAgIHZhciByb2xlSXRlbUluZGV4ID0gbmF2Y29uLmdldEl0ZW1JbmRleEJ5UHJvcGVydHkodm0udXNlckFjY2Vzc1JpZ2h0c0ZpZWxkcywgXCJSb2xlSWRcIik7XHJcblxyXG4gICAgICAgICAgICAkc2NvcGUuJHdhdGNoKFwidm0udXNlckFjY2Vzc1JpZ2h0c0ZpZWxkc1tcIiArIHJvbGVJdGVtSW5kZXggKyBcIl0uZGF0YVwiLCBmdW5jdGlvbiAobmV3VmFsdWUsIG9sZFZhbHVlKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAobmV3VmFsdWUgIT0gdW5kZWZpbmVkICYmIG5ld1ZhbHVlICE9PSBvbGRWYWx1ZSkge1xyXG5cclxuICAgICAgICAgICAgICAgICAgICB2bS5zZWxlY3RlZERyb3BEb3duID0gJ3VzZXJBY2Nlc3NSaWdodHNSb2xlSWQnO1xyXG4gICAgICAgICAgICAgICAgICAgIHZtLm5ld0lkID0gbmV3VmFsdWUuUm9sZUlkO1xyXG4gICAgICAgICAgICAgICAgICAgIHZtLnVzZXJBY2Nlc3NSaWdodHNUcmVlLmNvcmUuZGF0YSA9IFtdO1xyXG4gICAgICAgICAgICAgICAgICAgIHZtLm1vZGUgPSBcIlNhdmVcIjtcclxuICAgICAgICAgICAgICAgICAgICB2bS5pc1NhdmUgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgICAgIHZtLmlzVXBkYXRlID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgICAgICAkKCcjVXNlcicpLnJlbW92ZUNsYXNzKCdpbicpO1xyXG4gICAgICAgICAgICAgICAgICAgIHZtLnNob3dIaXN0b3J5ID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICAgICAgdm0uc2hvd1Jlc2V0ID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0sIHRydWUpO1xyXG5cclxuICAgICAgICAgICAgJHNjb3BlLiR3YXRjaChcInZtLnVzZXJBY2Nlc3NSaWdodHNUcmVlLmNvcmUuZGF0YVwiLCBmdW5jdGlvbiAobmV3VmFsdWUsIG9sZFZhbHVlKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAobmV3VmFsdWUgPT09IHVuZGVmaW5lZCB8fCBuZXdWYWx1ZSA9PT0gXCJcIiB8fCBuZXdWYWx1ZS5sZW5ndGggPT09IDApIHtcclxuICAgICAgICAgICAgICAgICAgICAkcm9vdFNjb3BlLiRicm9hZGNhc3QoJ0ZPT1RFUi1DSEFOR0UnLCAnJyk7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICRyb290U2NvcGUuJGJyb2FkY2FzdCgnRk9PVEVSLUNIQU5HRScsICdTJyk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgLy8gSGlzdG9yeSBJVEFSICBXYXRjaFxyXG4gICAgICAgICAgICB2YXIgSGlzdG9yeUlUQVJXYXJuaW5nSW5kZXggPSBuYXZjb24uZ2V0SXRlbUluZGV4QnlQcm9wZXJ0eSh2bS51c2VyQWNjZXNzUmlnaHRzSGlzdG9yeUZpZWxkcywgXCJJVEFSV2FybmluZ1wiKTtcclxuICAgICAgICAgICAgJHNjb3BlLiR3YXRjaChcInZtLnVzZXJBY2Nlc3NSaWdodHNIaXN0b3J5RmllbGRzW1wiICsgSGlzdG9yeUlUQVJXYXJuaW5nSW5kZXggKyBcIl0uZGF0YVwiLCBmdW5jdGlvbiAobmV3VmFsdWUsIG9sZFZhbHVlKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAobmV3VmFsdWUgIT0gdW5kZWZpbmVkICYmIG5ld1ZhbHVlICE9IFwiXCIpIHtcclxuICAgICAgICAgICAgICAgICAgICAkc2NvcGUuaGlzdG9yeUl0YXJXYXJuaW5nID0gbmV3VmFsdWU7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAkc2NvcGUuaGlzdG9yeUl0YXJXYXJuaW5nID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0sIHRydWUpO1xyXG4gICAgICAgIH07XHJcbiAgICB9XHJcbn0pKCk7XHJcblxyXG5cclxuIiwiKGZ1bmN0aW9uICgpIHtcclxuICAgICd1c2Ugc3RyaWN0JztcclxuXHJcbiAgICBhbmd1bGFyXHJcbiAgICAgICAgLm1vZHVsZSgnYXBwLnVzZXJpbXBvcnQnKVxyXG4gICAgICAgIC5jb250cm9sbGVyKCd1c2VyaW1wb3J0JywgdXNlcmltcG9ydCk7XHJcblxyXG4gICAgLyogQG5nSW5qZWN0ICovXHJcbiAgICBmdW5jdGlvbiB1c2VyaW1wb3J0KCRzY29wZSwgZGF0YXNlcnZpY2UsIGxvZ2dlciwgJGNvbXBpbGUsICR0aW1lb3V0LCAkbG9jYXRpb24sIHBhZ2VDb25maWcsICRyb290U2NvcGUsIG1lbnVTZXR0aW5ncywgbmdBdXRoU2V0dGluZ3MpIHtcclxuICAgICAgICB2YXIgdm0gPSB0aGlzO1xyXG5cclxuICAgICAgICBpZiAocGFnZUNvbmZpZyA9PT0gdW5kZWZpbmVkIHx8IHBhZ2VDb25maWcuZmllbGRzID09PSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgICAgJGxvY2F0aW9uLnVybCgnLycpO1xyXG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICB2bS5yaWdodHMgPSBuYXZjb24uZ2V0VXNlclJpZ2h0cyhtZW51U2V0dGluZ3MsIFwicGFkbWluaXN0cmF0aW9uXCIsIFwidXNlcmltcG9ydFwiKTtcclxuXHJcbiAgICAgICAgLypTZXR0aW5ncyovXHJcbiAgICAgICAgdm0ucGFnZUNvbmZpZyA9IHBhZ2VDb25maWc7XHJcbiAgICAgICAgdm0udXNlckltcG9ydEZpZWxkcyA9IGFuZ3VsYXIuY29weSh2bS5wYWdlQ29uZmlnLmZpZWxkcy51c2VySW1wb3J0RmllbGRzKTtcclxuICAgICAgICB2bS51c2VySW1wb3J0VGFibGUgPSBhbmd1bGFyLmNvcHkodm0ucGFnZUNvbmZpZy50YWJsZXMudXNlckltcG9ydFRhYmxlKTtcclxuICAgICAgICBkZWZhdWx0RGF0YSh2bS5wYWdlQ29uZmlnLmRhdGEpO1xyXG5cclxuICAgICAgICAvKlZhcmlhYmxlIERlY2xhcmF0aW9uKi9cclxuICAgICAgICB2bS5wcmltYXJ5S2V5ID0gXCJJZFwiO1xyXG4gICAgICAgIHZhciB0eXBlID0gXCJ1c2VySW1wb3J0XCI7XHJcbiAgICAgICAgdm0uZm9ybU1hbmFnZSA9IHt9O1xyXG5cclxuICAgICAgICAvKkNsb3NlKi9cclxuICAgICAgICB2bS5jbG9zZSA9IGZ1bmN0aW9uICh0eXBlKSB7XHJcbiAgICAgICAgICAgICQoJyNSZXN1bHRzVGFibGUnKS5yZW1vdmVDbGFzcygnaW4nKTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2bS5wcm9jZXNzID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAvL2lmICh2bS5mb3JtTWFuYWdlLmZvcm1WYWxpZCh2bS51c2VySW1wb3J0RmllbGRzKSkge1xyXG4gICAgICAgICAgICB2YXIgaW1wb3J0RmllbGRzID0gbmF2Y29uLmdldEZpZWxkc0RhdGFUb1NhdmUodm0udXNlckltcG9ydEZpZWxkcywgJ1NhdmUnLCAnJywgdHJ1ZSk7XHJcbiAgICAgICAgICAgIHZtLnVzZXJJbXBvcnRUYWJsZS5kYXRhID0gW107XHJcbiAgICAgICAgICAgICQoJyNSZXN1bHRzVGFibGUnKS5yZW1vdmVDbGFzcygnaW4nKTtcclxuXHJcbiAgICAgICAgICAgIGlmIChpbXBvcnRGaWVsZHMuZnVhdHRhY2htZW50cyA9PT0gXCJcIiB8fCBpbXBvcnRGaWVsZHMuZnVhdHRhY2htZW50cy5sZW5ndGggPT09IDApXHJcbiAgICAgICAgICAgICAgICBsb2dnZXIud2FybmluZyhcIlBsZWFzZSBjaG9vc2UgYSBGaWxlLlwiKTtcclxuICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgZm9ybURhdGEgPSBpbXBvcnRGaWVsZHNbXCJmaWxlc1VwbG9hZFwiXTtcclxuICAgICAgICAgICAgICAgIGlmIChmb3JtRGF0YSAhPSB1bmRlZmluZWQgJiYgZm9ybURhdGEgIT0gbnVsbCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBkYXRhSW5mbyA9IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgZm9sZGVyOiBcIkV4Y2VsXCIsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlkOiAxXHJcbiAgICAgICAgICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgICAgICAgICBmb3JtRGF0YS5hcHBlbmQoXCJkYXRhXCIsIEpTT04uc3RyaW5naWZ5KGRhdGFJbmZvKSk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGRhdGFzZXJ2aWNlLmV4Y2VsRmlsZVVwbG9hZChmb3JtRGF0YSkudGhlbihmdW5jdGlvbiAodXBsb2FkRGF0YSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAodXBsb2FkRGF0YSAhPT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2bS51c2VySW1wb3J0VGFibGUuZGF0YSA9IHVwbG9hZERhdGE7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2bS5zaG93SGlkZSgnUmVzdWx0c1RhYmxlJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAvL31cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHZtLmRvd25sb2FkID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICB2YXIgbGluayA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJhXCIpO1xyXG4gICAgICAgICAgICBsaW5rLmRvd25sb2FkID0gbmFtZTtcclxuICAgICAgICAgICAgbGluay5ocmVmID0gZ2V0U2VydmVyVVJMKFwidXNlckltcG9ydEZpbGVcIik7XHJcblxyXG4gICAgICAgICAgICBpZiAod2luZG93Lm5hdmlnYXRvciAmJiB3aW5kb3cubmF2aWdhdG9yLm1zU2F2ZU9yT3BlbkJsb2IpIHtcclxuICAgICAgICAgICAgICAgIHdpbmRvdy5vcGVuKGxpbmsuaHJlZiwgJ2Rvd25sb2FkX3dpbmRvdycsICd0b29sYmFyPTAsbG9jYXRpb249bm8sZGlyZWN0b3JpZXM9MCxzdGF0dXM9MCxzY3JvbGxiYXJzPTAscmVzaXplYWJsZT0wLHdpZHRoPTEsaGVpZ2h0PTEsdG9wPTAsbGVmdD0wJyk7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBsaW5rLmNsaWNrKCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIGdldFNlcnZlclVSTCh0eXBlLCByb3dJZCkge1xyXG4gICAgICAgICAgICB2YXIgcmV0dXJuRGF0YSA9ICcnO1xyXG4gICAgICAgICAgICByZXR1cm5EYXRhID0gbmF2Y29uLnJvdXRlLlVJKG5nQXV0aFNldHRpbmdzLmxvZ2luU2VydmljZVVyaSwgdHlwZSwgcm93SWQpO1xyXG4gICAgICAgICAgICByZXR1cm4gcmV0dXJuRGF0YTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHZtLnNob3dIaWRlID0gZnVuY3Rpb24gKGlkLCBtb2RlKSB7XHJcbiAgICAgICAgICAgIGlmICghJCgnIycgKyBpZCkuaGFzQ2xhc3MoJ2luJykpIHtcclxuICAgICAgICAgICAgICAgICQoJyMnICsgaWQpLnRvZ2dsZUNsYXNzKCdpbicpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmdW5jdGlvbiBjbGVhckZpZWxkcygpIHtcclxuICAgICAgICAgICAgbmF2Y29uLmNsZWFyRmllbGRzRGF0YSh2bS51c2VySW1wb3J0RmllbGRzKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIGdldFNlcnZlckRhdGEodHlwZSwgcm93SWQpIHtcclxuICAgICAgICAgICAgcmV0dXJuIGRhdGFzZXJ2aWNlLmdldFNlcnZlckRhdGEodHlwZSwgcm93SWQpLnRoZW4oZnVuY3Rpb24gKGRhdGEpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBkYXRhO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICBmdW5jdGlvbiBkZWZhdWx0RGF0YShkYXRhKSB7XHJcbiAgICAgICAgICAgIG5hdmNvbi5zYXZlLmxvYWRMaXN0RGVmYXVsdERhdGEoZGF0YSwgdm0udXNlckltcG9ydEZpZWxkcyk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG59KSgpOyIsIihmdW5jdGlvbiAoKSB7XHJcbiAgICAndXNlIHN0cmljdCc7XHJcblxyXG4gICAgYW5ndWxhclxyXG4gICAgICAgIC5tb2R1bGUoJ2FwcC51c2VybWFuYWdlbWVudCcpXHJcbiAgICAgICAgLmNvbnRyb2xsZXIoJ3VzZXJtYW5hZ2VtZW50JywgdXNlcm1hbmFnZW1lbnQpO1xyXG5cclxuICAgIGZ1bmN0aW9uIHVzZXJtYW5hZ2VtZW50KCRzY29wZSwgZGF0YXNlcnZpY2UsIGxvZ2dlciwgJGNvbXBpbGUsICR0aW1lb3V0LCAkbG9jYXRpb24sIHBhZ2VDb25maWcsICRyb290U2NvcGUsIG1lbnVTZXR0aW5ncykge1xyXG4gICAgICAgIHZhciB2bSA9IHRoaXM7XHJcbiAgICAgIC8vICBhY3RpdmF0ZSgpO1xyXG4gICAgICAgIHZtLnJlYWRPbmx5ID0gZmFsc2U7XHJcblxyXG4gICAgICAgIGlmIChwYWdlQ29uZmlnID09PSB1bmRlZmluZWQgfHwgcGFnZUNvbmZpZy5maWVsZHMgPT09IHVuZGVmaW5lZCkge1xyXG4gICAgICAgICAgICAkbG9jYXRpb24udXJsKCcvJyk7XHJcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgICB9XHJcbiAgICAgICAgdm0ucmlnaHRzID0gbmF2Y29uLmdldFVzZXJSaWdodHMobWVudVNldHRpbmdzLCBcInBhZG1pbmlzdHJhdGlvblwiLCBcInVzZXJtYW5hZ2VtZW50XCIpO1xyXG4gICAgICAgIHZtLmZvcm1NYW5hZ2UgPSB7fTtcclxuICAgICAgICAvLyAgdm0ucmlnaHRzID0gbmF2Y29uLmdldFVzZXJSaWdodHMobWVudVNldHRpbmdzLCBcInBhZG1pbmlzdHJhdGlvblwiLCBcImtlbmRvZmllbGRzXCIpO1xyXG4gICAgICAgIC8qU2V0dGluZ3MqL1xyXG4gICAgICAgIHZtLnBhZ2VDb25maWcgPSBwYWdlQ29uZmlnO1xyXG4gICAgICAgIHZtLmtlbmRvZmllbGRzRmllbGRzID0gYW5ndWxhci5jb3B5KHZtLnBhZ2VDb25maWcuZmllbGRzLmtlbmRvZmllbGRzRmllbGRzKTtcclxuICAgICAgICAvL3ZtLmtlbmRvZmllbGRzVGFibGUgPSBhbmd1bGFyLmNvcHkodm0ucGFnZUNvbmZpZy50YWJsZXMua2VuZG9maWVsZHNUYWJsZSk7XHJcbiAgICAgICAgZGVmYXVsdERhdGEodm0ucGFnZUNvbmZpZy5kYXRhKTtcclxuICAgICAgICBmdW5jdGlvbiBkZWZhdWx0RGF0YShkYXRhKSB7XHJcbiAgICAgICAgICAgIG5hdmNvbi5zYXZlLmxvYWRMaXN0RGVmYXVsdERhdGEoZGF0YSwgdm0ua2VuZG9maWVsZHNGaWVsZHMpO1xyXG4gICAgICAgICAgICBuYXZjb24ua2VuZG8ubG9hZExpc3REZWZhdWx0RGF0YShkYXRhLCB2bS5rZW5kb2ZpZWxkc0ZpZWxkcyk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIFxyXG4gICAgfVxyXG59KSgpOyIsIihmdW5jdGlvbiAoKSB7XHJcbiAgICAndXNlIHN0cmljdCc7XHJcblxyXG4gICAgYW5ndWxhclxyXG4gICAgICAgIC5tb2R1bGUoJ2FwcC51c2VycHJvZmlsZScpXHJcbiAgICAgICAgLmNvbnRyb2xsZXIoJ3VzZXJwcm9maWxlJywgdXNlcnByb2ZpbGUpO1xyXG5cclxuICAgIC8qIEBuZ0luamVjdCAqL1xyXG4gICAgZnVuY3Rpb24gdXNlcnByb2ZpbGUoJHNjb3BlLCBkYXRhc2VydmljZSwgbG9nZ2VyLCAkY29tcGlsZSwgJHRpbWVvdXQsICRsb2NhdGlvbiwgYXV0aFNlcnZpY2UsIHBhZ2VDb25maWcsICRyb290U2NvcGUsIG1lbnVTZXR0aW5ncywgbmdBdXRoU2V0dGluZ3MpIHtcclxuICAgICAgICB2YXIgdm0gPSB0aGlzO1xyXG4gICAgICAgIHZtLnVzZXJJZCA9IGF1dGhTZXJ2aWNlLmF1dGhlbnRpY2F0aW9uLnVzZXJJZDtcclxuICAgICAgICB2bS51c2VyTmFtZSA9IGF1dGhTZXJ2aWNlLmF1dGhlbnRpY2F0aW9uLnVzZXJOYW1lO1xyXG4gICAgICAgIHZtLlNTT1N0YXR1cyA9IG5nQXV0aFNldHRpbmdzLlNTTztcclxuXHJcbiAgICAgICAgaWYgKHBhZ2VDb25maWcgPT09IHVuZGVmaW5lZCB8fCBwYWdlQ29uZmlnLmZpZWxkcyA9PT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgICAgICRsb2NhdGlvbi51cmwoJy8nKTtcclxuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgdm0ucmlnaHRzID0gbmF2Y29uLmdldFVzZXJSaWdodHMobWVudVNldHRpbmdzLCBcInBhZG1pbmlzdHJhdGlvblwiLCBcInVzZXJwcm9maWxlXCIpO1xyXG5cclxuICAgICAgICAvKlNldHRpbmdzKi9cclxuICAgICAgICB2bS5wYWdlQ29uZmlnID0gcGFnZUNvbmZpZztcclxuICAgICAgICB2bS51c2VyUHJvZmlsZUZpZWxkcyA9IGFuZ3VsYXIuY29weSh2bS5wYWdlQ29uZmlnLmZpZWxkcy51c2VyUHJvZmlsZUZpZWxkcyk7XHJcbiAgICAgICAgdm0uY2hhbmdlUGFzc3dvcmRGaWVsZHMgPSBhbmd1bGFyLmNvcHkodm0ucGFnZUNvbmZpZy5maWVsZHMuY2hhbmdlUGFzc3dvcmRGaWVsZHMpO1xyXG4gICAgICAgIGRlZmF1bHREYXRhKHZtLnBhZ2VDb25maWcuZGF0YSk7XHJcbiAgICAgICAgYWN0aXZhdGUoKTtcclxuXHJcbiAgICAgICAgLypWYXJpYWJsZSBEZWNsYXJhdGlvbiovXHJcbiAgICAgICAgdm0ucHJpbWFyeUtleSA9IFwiSWRcIjtcclxuICAgICAgICB2YXIgdHlwZSA9IFwidXNlclByb2ZpbGVcIjtcclxuICAgICAgICB2YXIgdXNlck5hbWVJbmRleDtcclxuICAgICAgICB2YXIgdXNlcklkSW5kZXg7XHJcbiAgICAgICAgdmFyIHVzZXJOYW1lSW5kZXg7XHJcbiAgICAgICAgdm0ucmVhZE9ubHkgPSB0cnVlO1xyXG4gICAgICAgIHZtLmZvcm1NYW5hZ2UgPSB7fTtcclxuXHJcbiAgICAgICAgdm0uY2FuY2VsID0gZnVuY3Rpb24gKHR5cGUpIHtcclxuICAgICAgICAgICAgaWYgKHR5cGUgPT09ICd1c2VycHJvZmlsZScpIHtcclxuICAgICAgICAgICAgICAgIGNsZWFyRmllbGRzKCk7XHJcbiAgICAgICAgICAgICAgICBnZXRVc2VyQnlJZCgpO1xyXG5cclxuICAgICAgICAgICAgICAgIHZtLmVuYWJsZUZpZWxkcyhmYWxzZSk7XHJcbiAgICAgICAgICAgICAgICB2bS5pc1VwZGF0ZSA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICB2bS5yZWFkT25seSA9IHRydWU7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZSBpZiAodHlwZSA9PT0gJ2NoYW5nZVBhc3N3b3JkJykgeyAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgICAgICQoJyMnICsgJ0NoYW5nZVBhc3N3b3JkJykudG9nZ2xlQ2xhc3MoJ2luJyk7XHJcbiAgICAgICAgICAgICAgICAkKCcjJyArICdDaGFuZ2VQYXNzd29yZCcpLnBhcmVudCgnLnBhbmVsJykuZmluZCgnLnBhbmVsLWhlYWRpbmcgLnBhbmVsLXRpdGxlOmZpcnN0JykuYWRkQ2xhc3MoJ2NvbGxhcHNlZCcpO1xyXG4gICAgICAgICAgICAgICAgJCgnI0NoYW5nZVBhc3N3b3JkJykucmVtb3ZlQ2xhc3MoJ2luJyk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICAvKkVkaXQqL1xyXG4gICAgICAgIHZtLmVkaXQgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIHZtLmVuYWJsZUZpZWxkcyh0cnVlKTtcclxuICAgICAgICAgICAgdm0uaXNFZGl0ID0gdHJ1ZTtcclxuICAgICAgICAgICAgdm0uaXNVcGRhdGUgPSBmYWxzZTtcclxuICAgICAgICAgICAgdm0uaXNDYW5jZWwgPSBmYWxzZTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2bS5zYXZlID0gZnVuY3Rpb24gKHR5cGUsIGNhbGxiYWNrKSB7XHJcbiAgICAgICAgICAgIHZtLm1vZGUgPSBcIlVwZGF0ZVwiO1xyXG4gICAgICAgICAgICBpZiAodHlwZSA9PT0gJ3VzZXJwcm9maWxlJykge1xyXG4gICAgICAgICAgICAgICAgaWYgKHZtLmZvcm1NYW5hZ2UuZm9ybVZhbGlkKHZtLnVzZXJQcm9maWxlRmllbGRzKSkge1xyXG4gICAgICAgICAgICAgICAgICAgIG5hdmNvbi5zYXZlLnNhdmVPcHRpb24odm0sIGRhdGFzZXJ2aWNlLCB2bS5tb2RlLCB0eXBlLCB2bS51c2VyUHJvZmlsZVRhYmxlLCB2bS51c2VyUHJvZmlsZUZpZWxkcywgdm0uc2VsZWN0ZWRSb3csIHZtLnByaW1hcnlLZXksIFwiXCIsIFwiXCIsIFwiXCIsIHRydWUsIFwiXCIsIGZ1bmN0aW9uIChkYXRhKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vaWYgKGNhbGxiYWNrICE9PSB1bmRlZmluZWQpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vICAgIGNhbGxiYWNrKGRhdGEgPT09IHVuZGVmaW5lZCA/IGZhbHNlIDogdHJ1ZSk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoZGF0YSAhPT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjbGVhckZpZWxkcygpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZ2V0VXNlckJ5SWQoKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvZ2dlci5zdWNjZXNzKFwiRW50cmllcyBhcmUgdXBkYXRlZCBzdWNjZXNzZnVsbHkuLi5cIik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgdm0ucmVhZE9ubHkgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2bS5pc0VkaXQgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdm0uaXNVcGRhdGUgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2bS5pc0NhbmNlbCA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGVsc2UgaWYgKHR5cGUgPT09ICdjaGFuZ2VQYXNzd29yZCcpIHtcclxuICAgICAgICAgICAgICAgIGlmICh2bS5mb3JtTWFuYWdlLmZvcm1WYWxpZCh2bS5jaGFuZ2VQYXNzd29yZEZpZWxkcykpIHtcclxuICAgICAgICAgICAgICAgICAgICB1c2VySWRJbmRleCA9IG5hdmNvbi5nZXRJdGVtSW5kZXhCeVByb3BlcnR5KHZtLmNoYW5nZVBhc3N3b3JkRmllbGRzLCBcIklkXCIpO1xyXG4gICAgICAgICAgICAgICAgICAgIHVzZXJOYW1lSW5kZXggPSBuYXZjb24uZ2V0SXRlbUluZGV4QnlQcm9wZXJ0eSh2bS5jaGFuZ2VQYXNzd29yZEZpZWxkcywgXCJVc2VyTmFtZVwiKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgdm0uY2hhbmdlUGFzc3dvcmRGaWVsZHNbdXNlcklkSW5kZXhdLmRhdGEgPSBwYXJzZUludCh2bS51c2VySWQpO1xyXG4gICAgICAgICAgICAgICAgICAgIHZtLmNoYW5nZVBhc3N3b3JkRmllbGRzW3VzZXJOYW1lSW5kZXhdLmRhdGEgPSB2bS51c2VyTmFtZTtcclxuICAgICAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgICAgICAgICBuYXZjb24uc2F2ZS5zYXZlT3B0aW9uKHZtLCBkYXRhc2VydmljZSwgdm0ubW9kZSwgdHlwZSwgXCJcIiwgdm0uY2hhbmdlUGFzc3dvcmRGaWVsZHMsIHZtLmNoYW5nZVBhc3N3b3JkRmllbGRzLnNlbGVjdGVkUm93LCB2bS5wcmltYXJ5S2V5LCB2bS5kaXNwbGF5S2V5LCAwLCBmYWxzZSwgZmFsc2UsIFwiXCIsIGZ1bmN0aW9uIChkYXRhKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChkYXRhICE9PSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNsZWFyUGFzc3dvcmRGaWVsZHMoKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvZ2dlci5zdWNjZXNzKFwiUGFzc3dvcmQgY2hhbmdlZCBzdWNjZXNzZnVsbHkuLi5cIik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkKCcjJyArICdDaGFuZ2VQYXNzd29yZCcpLnRvZ2dsZUNsYXNzKCdpbicpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJCgnIycgKyAnQ2hhbmdlUGFzc3dvcmQnKS5wYXJlbnQoJy5wYW5lbCcpLmZpbmQoJy5wYW5lbC1oZWFkaW5nIC5wYW5lbC10aXRsZTpmaXJzdCcpLmFkZENsYXNzKCdjb2xsYXBzZWQnKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICQoJyNDaGFuZ2VQYXNzd29yZCcpLnJlbW92ZUNsYXNzKCdpbicpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vICAgIGxvZ2dlci53YXJuaW5nKFwiT2xkIFBhc3N3b3JkIGlzIGluY29ycmVjdC5cIilcclxuICAgICAgICAgICAgICAgICAgICAgICAgLy99XHJcbiAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2bS5zaG93UGFzc3dvcmQgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIGNsZWFyUGFzc3dvcmRGaWVsZHMoKTtcclxuICAgICAgICAgICAgdm0uc2hvd0hpZGUoJ0NoYW5nZVBhc3N3b3JkJyk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICB2bS5zaG93SGlkZSA9IGZ1bmN0aW9uIChpZCwgbW9kZSkge1xyXG4gICAgICAgICAgICBpZiAoISQoJyMnICsgaWQpLmhhc0NsYXNzKCdpbicpKSB7XHJcbiAgICAgICAgICAgICAgICAkKCcjJyArIGlkKS50b2dnbGVDbGFzcygnaW4nKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gY2xlYXJGaWVsZHMoKSB7XHJcbiAgICAgICAgICAgIG5hdmNvbi5jbGVhckZpZWxkc0RhdGEodm0udXNlclByb2ZpbGVGaWVsZHMpO1xyXG4gICAgICAgICAgICAvL3VzZXJJbWFnZUluZGV4ID0gbmF2Y29uLmdldEl0ZW1JbmRleEJ5UHJvcGVydHkodm0udXNlclByb2ZpbGVGaWVsZHMsIFwiVXNlckltYWdlXCIpO1xyXG4gICAgICAgICAgICAvL3ZtLnVzZXJQcm9maWxlRmllbGRzW3VzZXJJbWFnZUluZGV4XS5kYXRhID0gXCJcIjtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIGNsZWFyUGFzc3dvcmRGaWVsZHMoKSB7XHJcbiAgICAgICAgICAgIG5hdmNvbi5jbGVhckZpZWxkc0RhdGEodm0uY2hhbmdlUGFzc3dvcmRGaWVsZHMpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgdm0uZW5hYmxlRmllbGRzID0gZnVuY3Rpb24gKGlzRW5hYmxlZCkge1xyXG4gICAgICAgICAgICB2bS5yZWFkT25seSA9ICFpc0VuYWJsZWQ7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICB2bS50b2dnbGVQYW5lbCA9IGZ1bmN0aW9uIChpZCkge1xyXG4gICAgICAgICAgICAkKCcjJyArIGlkKS50b2dnbGVDbGFzcygnaW4nKTtcclxuXHJcbiAgICAgICAgICAgIGlmICgkKCcjJyArIGlkKS5oYXNDbGFzcygnaW4nKSkge1xyXG5cclxuICAgICAgICAgICAgICAgICQoJyMnICsgaWQpLnBhcmVudCgnLnBhbmVsJykuZmluZCgnLnBhbmVsLWhlYWRpbmcgLnBhbmVsLXRpdGxlOmZpcnN0JykucmVtb3ZlQ2xhc3MoJ2NvbGxhcHNlZCcpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgJCgnIycgKyBpZCkucGFyZW50KCcucGFuZWwnKS5maW5kKCcucGFuZWwtaGVhZGluZyAucGFuZWwtdGl0bGU6Zmlyc3QnKS5hZGRDbGFzcygnY29sbGFwc2VkJyk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIGdldFVzZXJCeUlkKCkge1xyXG4gICAgICAgICAgICBjbGVhckZpZWxkcygpO1xyXG5cclxuICAgICAgICAgICAgdmFyIGRhdGFVc2VyID0gZ2V0U2VydmVyRGF0YSgndXNlclByb2ZpbGVJZCcpLnRoZW4oZnVuY3Rpb24gKGRhdGFVc2VyKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoZGF0YVVzZXIgIT09IHVuZGVmaW5lZCAmJiBkYXRhVXNlciAhPT0gbnVsbCkge1xyXG4gICAgICAgICAgICAgICAgICAgIG5hdmNvbi51cGRhdGVGaWVsZHNEYXRhKHZtLnVzZXJQcm9maWxlRmllbGRzLCBkYXRhVXNlciwgdm0sIGZhbHNlLCB2bS5uYXZjb25EYXRhKTtcclxuICAgICAgICAgICAgICAgICAgICB2bS5pc0VkaXQgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgICAgICB2bS5pc1VwZGF0ZSA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICAgdm0uaXNDYW5jZWwgPSBmYWxzZTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIElkSW5kZXggPSBuYXZjb24uZ2V0SXRlbUluZGV4QnlQcm9wZXJ0eSh2bS51c2VyUHJvZmlsZUZpZWxkcywgXCJJZFwiKTtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgZG9jdW1lbnRJZEluZGV4ID0gbmF2Y29uLmdldEl0ZW1JbmRleEJ5UHJvcGVydHkodm0udXNlclByb2ZpbGVGaWVsZHMsIFwiZG9jdW1lbnRJZFwiKTtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoZGF0YVVzZXIuZG9jdW1lbnRJZCA9PT0gdW5kZWZpbmVkIHx8IGRhdGFVc2VyLmRvY3VtZW50SWQgPT09IG51bGwgfHwgZGF0YVVzZXIuZG9jdW1lbnRJZCA9PT0gXCJcIilcclxuICAgICAgICAgICAgICAgICAgICAgICAgdm0udXNlclByb2ZpbGVGaWVsZHNbZG9jdW1lbnRJZEluZGV4XS5kYXRhID0gdm0udXNlclByb2ZpbGVGaWVsZHNbSWRJbmRleF0uZGF0YTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGRhdGFVc2VyLmRvY3VtZW50cyAhPT0gdW5kZWZpbmVkICYmIGRhdGFVc2VyLmRvY3VtZW50cyAhPT0gbnVsbCAmJiBkYXRhVXNlci5kb2N1bWVudHMuRG9jdW1lbnROYW1lICE9PSB1bmRlZmluZWQgJiYgZGF0YVVzZXIuZG9jdW1lbnRzLkRvY3VtZW50TmFtZSAhPT0gbnVsbCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgZG9jdW1lbnROYW1lSW5kZXggPSBuYXZjb24uZ2V0SXRlbUluZGV4QnlQcm9wZXJ0eSh2bS51c2VyUHJvZmlsZUZpZWxkcywgXCJEb2N1bWVudE5hbWVcIik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZtLnVzZXJQcm9maWxlRmllbGRzW2RvY3VtZW50TmFtZUluZGV4XS5kYXRhID0gZGF0YVVzZXIuZG9jdW1lbnRzLkRvY3VtZW50TmFtZTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGlmIChkYXRhVXNlci5pbWcgIT09IHVuZGVmaW5lZCAmJiBkYXRhVXNlci5pbWcgIT09IG51bGwgJiYgZGF0YVVzZXIuaW1nICE9PSBcIlwiKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vdmFyIHVzZXJJbWFnZUluZGV4ID0gbmF2Y29uLmdldEl0ZW1JbmRleEJ5UHJvcGVydHkodm0udXNlclByb2ZpbGVGaWVsZHMsIFwiaW1nXCIpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAvL3ZtLnVzZXJQcm9maWxlRmllbGRzW3VzZXJJbWFnZUluZGV4XS5kYXRhID0gZGF0YVVzZXIuaW1nO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAkcm9vdFNjb3BlLnVzZXJQcm9maWxlSW1hZ2UgPSBkYXRhVXNlci5pbWc7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIGdldFNlcnZlckRhdGEodHlwZSwgcm93SWQpIHtcclxuICAgICAgICAgICAgcmV0dXJuIGRhdGFzZXJ2aWNlLmdldFNlcnZlckRhdGEodHlwZSwgcm93SWQpLnRoZW4oZnVuY3Rpb24gKGRhdGEpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBkYXRhO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICBmdW5jdGlvbiBhY3RpdmF0ZSgpIHtcclxuICAgICAgICAgICAgZ2V0VXNlckJ5SWQoKTsgICAgICAgICAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgd2F0Y2hBdHRyaWJ1dGVzKCk7ICAgICAgICAgICAgXHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgZnVuY3Rpb24gZGVmYXVsdERhdGEoZGF0YSkge1xyXG4gICAgICAgICAgICBuYXZjb24uc2F2ZS5sb2FkTGlzdERlZmF1bHREYXRhKGRhdGEsIHZtLnVzZXJQcm9maWxlRmllbGRzKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIHdhdGNoQXR0cmlidXRlcygpIHtcclxuICAgICAgICAgICAgdmFyIHVzZXJJbWFnZUluZGV4ID0gbmF2Y29uLmdldEl0ZW1JbmRleEJ5UHJvcGVydHkodm0udXNlclByb2ZpbGVGaWVsZHMsIFwiaW1nXCIpO1xyXG4gICAgICAgICAgICAkc2NvcGUuJHdhdGNoKFwidm0udXNlclByb2ZpbGVGaWVsZHNbXCIgKyB1c2VySW1hZ2VJbmRleCArIFwiXS50ZW1wbGF0ZU9wdGlvbnMua2V5UmV0dXJuXCIsIGZ1bmN0aW9uIChuZXdWYWx1ZSwgb2xkVmFsdWUpIHtcclxuICAgICAgICAgICAgICAgIGlmIChuZXdWYWx1ZSAhPT0gdW5kZWZpbmVkICYmIG5ld1ZhbHVlICE9PSBvbGRWYWx1ZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChuZXdWYWx1ZS5lcnJvciAhPT0gdW5kZWZpbmVkICYmIG5ld1ZhbHVlLmVycm9yLmxlbmd0aCA+IDApIHtcclxuICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKG5ld1ZhbHVlLnJlbW92ZWQgIT09IHVuZGVmaW5lZCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgSWRJbmRleCA9IG5hdmNvbi5nZXRJdGVtSW5kZXhCeVByb3BlcnR5KHZtLnVzZXJQcm9maWxlRmllbGRzLCBcIklkXCIpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgZG9jdW1lbnRJZEluZGV4ID0gbmF2Y29uLmdldEl0ZW1JbmRleEJ5UHJvcGVydHkodm0udXNlclByb2ZpbGVGaWVsZHMsIFwiZG9jdW1lbnRJZFwiKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdm0udXNlclByb2ZpbGVGaWVsZHNbZG9jdW1lbnRJZEluZGV4XS5kYXRhID0gdm0udXNlclByb2ZpbGVGaWVsZHNbSWRJbmRleF0uZGF0YTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgJHJvb3RTY29wZS51c2VyUHJvZmlsZUltYWdlID0gXCIvOWovNEFBUVNrWkpSZ0FCQVFBQUFRQUJBQUQvMndDRUFBa0dCaEFRRVJVUUVCQVZGUkFVRWhvWUVCRVNEeFFTRWhVU0ZSZ1ZJQllVRWhjWUhDY2ZGeHN2R3hJWEh5OGdJeWNxTERndEZSNHlOVEFxTlNZckxDb0JDUW9LQlFVRkRRVUZEU2tZRWhncEtTa3BLU2twS1NrcEtTa3BLU2twS1NrcEtTa3BLU2twS1NrcEtTa3BLU2twS1NrcEtTa3BLU2twS1NrcEtTa3BLZi9BQUJFSUFMd0FrQU1CSWdBQ0VRRURFUUgveEFBYkFBRUFBZ01CQVFBQUFBQUFBQUFBQUFBQUFnVUJCQVlEQi8vRUFFTVFBQUlDQVFFRENBY0RDZ1FIQUFBQUFBRUNBQU1SQkJJaE1RVUdNa0ZSWVhHQkV5SWpRbEtSb1ROaWdoUkRjbk9pc2JMQjBmQTBkSkxTSkZOam83UEN3Ly9FQUJRQkFRQUFBQUFBQUFBQUFBQUFBQUFBQUFEL3hBQVVFUUVBQUFBQUFBQUFBQUFBQUFBQUFBQUEvOW9BREFNQkFBSVJBeEVBUHdEN2htTXpFUU01ak14RURPWXpNUkF6bU16UTVVNWJwMHdIcFc5WnVoV3FsN0h4eDJVRzgrUENWcDUyUDFhSzRyMmw2RmJ5VTJmdmdkRG1NeWdITzRlOXBOUVBCSzMvQUlYTW12UEhTKzk2VlAwOU5jQjVrS1JBdk14bVZtbTV5Nk93NFRVMUZ2aDlLb2IvQUVrZ3l5Z1p6R1ppSUdjeG1ZaUJuTVptSWdZekdaSE1aZ1N6R1pITVpnU3pLamx2bDhVK3lxQXMxVEQxYTgrcWdQNXk0am9wOVR3SGFOWGx6bHB5NTAybWJGZyszdXhrVXFSdUNqZzFwSEFjQU41NmdkSFNhTktnUWc0bkxzU1dkMjYyZGp2WTk1Z1IwdWoyUzFqc1h1ZjdTMXVrM1lvSHVvT3BSdUhqdm14RWpkY3FLWFlnS295ekU0QUE0a3dKVE0xdEJybHVUYlVNUFdJS3VObDFJUEJsTzlUakJ3ZTBUWWdRdTA2T01PcXNPeGxERDVHZWVpMTdhRWpKTGFJN21Va3MybisraE84MWRxKzd4RzdJbnJaYXE5SWdlSkEvZlBDdmxLaDI5R3QxYk1SMEZ0UmlSMTdnWUhZaGdkNDRkUm1jem1lYldzOUMvd0NSc2ZVd1cwaEp6N01kS244T1FSOTBqNFowbVlFc3htUnpHWUVzeG1SekdZR014bVJ6R1lFc3lwNXdjcnRTcTEwNE9wdHlLZ1JrSW82VnJqNFZ5TjNXU0IxeTB6T1ZiMXRWcVhQRU90YTl5SWluQTdCdE94OFRBYVBTTFV1eUNUdkpabU9XZHp2WjNQV1NkODlvaUFrZVJ1VC9BTXNjWFA4QTRXdHZZcjFYV0tmdFc3YXdSNm82eU5yZ0JQRGxQVHRaVFpXcHd6VnNxbnZJT1A3NzUxSEkyclMyaXF5c0JVYXRTcWdZQ2pBOVRIVmpoanVnYSt1NXM2ZTV6WVZaYkc2VDFXUFdXeHcydGs0WTk1bmdPWnVsOTcwcjl6Nm00anpBYmZMeUlGWFZ6VzBTOE5KVG50TktNM3pJSm5ycitSS2JxalNVQ3J4VW9Bckk0NkxvUU56RHQvck4rSUh6N1ZYV1ZnbXdmOFRvN0ZzYlpHTnRCeGRCMk5WdGpIYmtkVTdsTEF3REtjcVJrRWNDRHdJbEh6czB3VnFkU0J2RGltM3NhcTNobnR3K3lSNHQyejI1cU9meVNvSDNBMWZsVTdJUG9nZ1hHWXpJNWpNQ1dZekk1ak1DT1l6STVqTUNXWnkrTWFuVkQvckszazlWWkg4L2xPbXpPVjVVMUMwNnE1bXo2MWRMS3FqTE94TDFoVkhXZHBRUE1RTnFKNVdVNnhWMjIwbnE5YXBlcjJnZm9Zd1QzQmozWm1kTnFWc1VPaHlwNEg5NElPOEhJeGd3UFFucm03ekxZblRzUUQ2STMyR2drRWJWVEhPMHVmZDJtYkhkaVZPcG9GMWxPbVBRdGMrbEE2NnExTE12Z1RzcWU1ak8wVlFCZ0RBSEFEaGlCbUlpQWlJZ1UzUERUV1dhSzVhaG0wS0hyQUdUdDFzR0dCMTcxNFNYSXRWYWFlcGFXMjZoV05oeDc0Tzh2NGtrazk1bG5xYnhXak8zUlZTemVDakorZ2xOemZxWmROWHRERE1EWXdIQU5jek9WSGg2VEhsQXM4eG1SekdZRXN4bVJ6R1lFY3htUXpHWUU4eWw1VDBRZlhhS3c4Rk53STZpMndHVFBnYTJJbHZtVW5PNWJQUXBaVTJ6WlZxS21SaU1nWmJZTzBQaDlwZzl4TURySnlITEdrZlMyV1g3QWJTMk9yT1ZPR3Fkc0t6TXA2U2s0WWtieGx0M1hPaDVHNVRHcHBXMERaSnlIVE9TbGlraDBKN21CRTF1ZDMrQzFINmx2M1FLcmtyZnIwejFhVzBqeE5tbkIrazZ5Y2pvWDJkYlNmaXJ1VDUraWIvNXpyb0NJaUFpSWdlT3Qwd3NyZXM4SFJsSjdtQkg4NVU4aDZndnBxV1BTOUVvY2Rqb05seC9xVXk4blA4QUlmMlRmNWkvL3dBMWtDeXpHWkRNWmdUekdaRE1aZ1J6R1pITVpnU3pQRFg2UVhWUFN4d0xFS2s5WXlOekR2QndmS2V1WXpBNWZrZmxTelRrMzdKS0U3T3ZwWGVVdVRjOTFZNitHOWV0ZGtqZU4vYXVsV29xd2NQVFluaXJJdytvSU01YmxxajBML2xhOURBR3FVZkFPamVPOWVEZHEvb3pkNW8zN0J0MHZ1VjdObEg2cTB2Nm83ZzZPQjNGWUZqbytiV2xwY1dWMHFycm5aWVpKR1JnNHlleVdjUkFSRVFFUkVEeTFXb1d0R3NZNFZGTE1mdXFDVDlCS1BrT3NycDZnMjV5bTI0Ky9hUzdENXVSNVRhNTFrblNXSVB6bXpWNVhPcUg2T1pKanY4QU9CTE1aa2N4bUJMTVprY3htQkhNWmtNeG1CUE1aa014bUJQKzkvRHpsTnlUeWNkTHJhOWxzMFdWV1Yxb1I2MVpHeTZwdGU4b0N2czUzZ0VqZnVsdG1WdktldVZMOUdoNmI2cjFjRGdvcmRXWTlnellxK0xRT3NpSWdJaUlDSWlCVDg1VGtVcDhlcXIrU1pjL1N1WnpLWGx2bkxweHIwcWQ5bGFVYkxuN01haTBLRlZ6d1Vpc3R2TzcyZzRTM3ovZmRBbm1NeUdZekFubU15R1l6QWptTXlPWXpBbG1NeUkzOEpTOG9jN05QVmxVSnVzSHUxRUZRZnYyZEVlV1QzUUxtNjlVVXU3QlVVWloyT0ZVZHBNNUtqVUxyV3R2WU1xN1lybzNsWFZLamtPQ042c1hKYjVEcWxYeWx5bmJxV0J1SUNLY3BTbWZScWZpT2Q3dDNueUFsbnphSHNQR3l3L3RuK2tDKzVPNTBXVVlUVjVlcnExU3I2eS81aEIvR3U3dEE0enJLcmxkUXlNR1VqS3NwQkJCNEVFY1JPSm5scEd0MHpGOUtRRkp5K25Za1V1ZXNyajdKdThidTBHQjMwU2swWFBEU3V2dExGb3NIVHF2ZEsyQjdzbkRqN3lraWFQTFhPbmI5am9yRlp5UGFhaEdWMHFVL0NSa05ZZW9kWEU5UUllL0xmT1prZjBHbUN0YVB0WGZKcXFIVXJCU0N6bjRRUmdieVJ1elQzNm5WMmZhYXR3dld0S0xTUG52ZjlxZWVuMDYxcUZYaDJrNUpKNHN4TzhrbmVTZTJlc0RsZVZkRWxWK3lpZ0s5UUpIYXlzUXhPZUpJWmNrNzVMazdsTy9UYnFiTUoveVhHM1Y1RE9VL0NSTmpuSDlyVCtydC9mVEsrQjAybTU4RDg5cDNYNzFUcmF2eWJaWWZXV2VtNTBhT3pjTlFxbjRiYzBuL3VBRDZ6aG9JenhnZlRRY2pJM2c4Q040UGdlQmpNK1lVMStqT2F5MVo3YW5hbytleVJuemxqUnpoMWljTDlzZGwxYXY5UnN0OVlIY3U0QUxFZ0tCbG1ZaFZBN1dKM0FlTW9OZHp5cVhkUXB1YjRzbEtSK01qTGZoQjhST1kxZDlsNTJyN0RZUWNnTmdWcWZ1VmoxUjQ0ejN5TUQzMS9LVitvM1hXWlEvbWtHeFY0RVp5LzRpWnJxb0c0REE2Z053bVlnSmQ4MlQ3REhaYllQMmovV1VrdGViRDdyVTdMZHJ5ZFYvbUQ4b0YzRVJBaXlBOFFENGpNeXFnY0Jqd21ZZ0lpSUhQYzRUN2VzZGxUL1Y2LzhBYk5DYmZMcHpxZkNoZm16MmY3WnFRRVJFQkVSQVJFUUVSRUJOcmtPM1oxR09xeXNqOFZaeVAyV2Y1VFZrTGJDbXphT05iQndPMERwRHpVa1FPemlScnNEQU1weUNBUWUwSGdmbEpRRVJFQkVSQTVibFZzNm16dVd0ZjJjLys4OEpocmR0N0xPcHJXeDRMNm8vaG1ZQ0lpQWlJZ0lpSUNJaUFpSWdXM05yVmVxMUI0MUgxTytwczdQeU9WOGhMcWNjbW9OTHJjUGMzT0IxMU4waDVZRGZobllJNElCQnlDTWdqZ1FlQkVETVJFQk5UbFhXZWhwZXdkSUw2bmU1M0tQbVJOdWMvd0E0OVR0T2xJNEw3U3p4M2lzSHoybS9DSUZaUlZzcUY3QUI4dXVUaUlDSWlBaUlnSWlJQ0lpQWlJZ0paYzI5WnM1MHplNkMxUGZYMXArRW41RWRrclo0NnUwb3ZwVjNQWDZ5SHZIVWU0Z2tIeGdkdEV3RE13UFBVYWhhMFozT0ZVRXNlNFRrRWRuTFdQMDdHMm1Id2ozVjhsQUh6bHR6b3RQc3EvY2R5WEhic0RLZzkyY0h5RXJJQ0lpQWlJZ0lpSUgvMlE9PVwiO1xyXG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAobmV3VmFsdWUudXBsb2FkZWQgIT09IHVuZGVmaW5lZCAmJiBuZXdWYWx1ZS51cGxvYWRlZC5sZW5ndGggPiAwKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICR0aW1lb3V0KGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBkYXRhVXNlciA9IGdldFNlcnZlckRhdGEoJ3VzZXJQcm9maWxlSWQnKS50aGVuKGZ1bmN0aW9uIChkYXRhVXNlcikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChkYXRhVXNlciAhPT0gdW5kZWZpbmVkICYmIGRhdGFVc2VyICE9PSBudWxsKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5hdmNvbi51cGRhdGVGaWVsZHNEYXRhKHZtLnVzZXJQcm9maWxlRmllbGRzLCBkYXRhVXNlciwgdm0sIGZhbHNlLCB2bS5uYXZjb25EYXRhKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBJZEluZGV4ID0gbmF2Y29uLmdldEl0ZW1JbmRleEJ5UHJvcGVydHkodm0udXNlclByb2ZpbGVGaWVsZHMsIFwiSWRcIik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBkb2N1bWVudElkSW5kZXggPSBuYXZjb24uZ2V0SXRlbUluZGV4QnlQcm9wZXJ0eSh2bS51c2VyUHJvZmlsZUZpZWxkcywgXCJkb2N1bWVudElkXCIpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoZGF0YVVzZXIuZG9jdW1lbnRJZCA9PT0gdW5kZWZpbmVkIHx8IGRhdGFVc2VyLmRvY3VtZW50SWQgPT09IG51bGwgfHwgZGF0YVVzZXIuZG9jdW1lbnRJZCA9PT0gXCJcIilcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZtLnVzZXJQcm9maWxlRmllbGRzW2RvY3VtZW50SWRJbmRleF0uZGF0YSA9IHZtLnVzZXJQcm9maWxlRmllbGRzW0lkSW5kZXhdLmRhdGE7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoZGF0YVVzZXIuZG9jdW1lbnRzICE9PSB1bmRlZmluZWQgJiYgZGF0YVVzZXIuZG9jdW1lbnRzICE9PSBudWxsICYmIGRhdGFVc2VyLmRvY3VtZW50cy5Eb2N1bWVudE5hbWUgIT09IHVuZGVmaW5lZCAmJiBkYXRhVXNlci5kb2N1bWVudHMuRG9jdW1lbnROYW1lICE9PSBudWxsKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgZG9jdW1lbnROYW1lSW5kZXggPSBuYXZjb24uZ2V0SXRlbUluZGV4QnlQcm9wZXJ0eSh2bS51c2VyUHJvZmlsZUZpZWxkcywgXCJEb2N1bWVudE5hbWVcIik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2bS51c2VyUHJvZmlsZUZpZWxkc1tkb2N1bWVudE5hbWVJbmRleF0uZGF0YSA9IGRhdGFVc2VyLmRvY3VtZW50cy5Eb2N1bWVudE5hbWU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChkYXRhVXNlci5pbWcgIT09IHVuZGVmaW5lZCAmJiBkYXRhVXNlci5pbWcgIT09IG51bGwgJiYgZGF0YVVzZXIuaW1nICE9PSBcIlwiKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvL3ZhciB1c2VySW1hZ2VJbmRleCA9IG5hdmNvbi5nZXRJdGVtSW5kZXhCeVByb3BlcnR5KHZtLnVzZXJQcm9maWxlRmllbGRzLCBcImltZ1wiKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vdm0udXNlclByb2ZpbGVGaWVsZHNbdXNlckltYWdlSW5kZXhdLmRhdGEgPSBkYXRhVXNlci5pbWc7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkcm9vdFNjb3BlLnVzZXJQcm9maWxlSW1hZ2UgPSBkYXRhVXNlci5pbWc7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgIHZhciBJVEFSV2FybmluZ0luZGV4ID0gbmF2Y29uLmdldEl0ZW1JbmRleEJ5UHJvcGVydHkodm0udXNlclByb2ZpbGVGaWVsZHMsIFwiSVRBUldhcm5pbmdcIik7XHJcbiAgICAgICAgICAgICRzY29wZS4kd2F0Y2goXCJ2bS51c2VyUHJvZmlsZUZpZWxkc1tcIiArIElUQVJXYXJuaW5nSW5kZXggKyBcIl0uZGF0YVwiLCBmdW5jdGlvbiAobmV3VmFsdWUsIG9sZFZhbHVlKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAobmV3VmFsdWUpIHtcclxuICAgICAgICAgICAgICAgICAgICB2bS5pdGFyd2FybmluZyA9IG5ld1ZhbHVlO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdm0uaXRhcndhcm5pbmcgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSwgdHJ1ZSk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG59KSgpOyIsIihmdW5jdGlvbigpIHtcclxuICAgICd1c2Ugc3RyaWN0JztcclxuICAgIGFuZ3VsYXJcclxuICAgICAgICAubW9kdWxlKCdhcHAubmV3cycpXHJcbiAgICAgICAgLmNvbnRyb2xsZXIoJ25ld3MnLCBuZXdzKTtcclxuXHJcbiAgICAvKiBAbmdJbmplY3QgKi9cclxuICAgIGZ1bmN0aW9uIG5ld3MoJHNjb3BlLCBkYXRhc2VydmljZSwgbG9nZ2VyLCAkY29tcGlsZSwgJHRpbWVvdXQsICRsb2NhdGlvbiwgcGFnZUNvbmZpZywgJHJvb3RTY29wZSwgbWVudVNldHRpbmdzKSB7XHJcbiAgICAgICAgdmFyIHZtID0gdGhpcztcclxuXHJcblxyXG4gICAgICAgIGlmIChwYWdlQ29uZmlnID09PSB1bmRlZmluZWQgfHwgcGFnZUNvbmZpZy5maWVsZHMgPT09IHVuZGVmaW5lZCkge1xyXG4gICAgICAgICAgICAkbG9jYXRpb24udXJsKCcvJyk7XHJcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8vdm0ucmlnaHRzID0gbmF2Y29uLmdldFJvbGVSaWdodHMobWVudVNldHRpbmdzLCBcIkFkbWluaXN0cmF0aW9uXCIsIFwiQnVsbGV0aW4gTWFuYWdlbWVudFwiKTtcclxuXHJcbiAgICAgICAgLypTZXR0aW5ncyovXHJcbiAgICAgICAgdm0ucGFnZUNvbmZpZyA9IHBhZ2VDb25maWc7XHJcblxyXG4gICAgICAgIC8qUGFnZSBDb25maWcgQ29tbW9uIFZhcnJpYWJsZSBBc3NpZ24gKi9cclxuICAgICAgICBuYXZjb24uZ2V0UGFnZUNvbmZpZyh2bSwgdm0ucGFnZUNvbmZpZyk7XHJcbiAgICAgICAgLy92bS5uZXdzRmllbGRzID0gYW5ndWxhci5jb3B5KHZtLnBhZ2VDb25maWcuZmllbGRzLm5ld3NGaWVsZHMpO1xyXG4gICAgICAgIGFjdGl2YXRlKCk7XHJcbiAgICAgICAgZGVmYXVsdERhdGEodm0ucGFnZUNvbmZpZy5kYXRhKTtcclxuXHJcbiAgICAgICAgLypWYXJpYWJsZSBEZWNsYXJhdGlvbiovXHJcbiAgICAgICAgdm0ucmVhZE9ubHkgPSB0cnVlO1xyXG4gICAgICAgIHZtLmlzVmlld01vZGUgPSB0cnVlO1xyXG4gICAgICAgIHZtLmlzRWRpdCA9IGZhbHNlO1xyXG4gICAgICAgIHZtLmlzU2F2ZUhpZGUgPSB0cnVlO1xyXG4gICAgICAgIHZtLmlzRGVsZXRlSGlkZSA9IHRydWU7XHJcblxyXG4gICAgICAgIHZtLmZvcm1NYW5hZ2UgPSB7fTtcclxuXHJcbiAgICAgICAgLypQYWdlIEFjdGlvbnMqL1xyXG4gICAgICAgIHZtLnNob3dIaWRlID0gZnVuY3Rpb24odHlwZSwgaXNTaG93KSB7XHJcbiAgICAgICAgICAgIGlmIChpc1Nob3cgIT09IHVuZGVmaW5lZCAmJiBpc1Nob3cpXHJcbiAgICAgICAgICAgICAgICAkKCcjJyArIHR5cGUpLmFkZENsYXNzKCdpbicpO1xyXG4gICAgICAgICAgICBlbHNlIGlmIChpc1Nob3cgIT09IHVuZGVmaW5lZCAmJiAhaXNTaG93KVxyXG4gICAgICAgICAgICAgICAgJCgnIycgKyB0eXBlKS5yZW1vdmVDbGFzcygnaW4nKTtcclxuICAgICAgICAgICAgZWxzZSBpZiAoISQoJyMnICsgdHlwZSkuaGFzQ2xhc3MoJ2luJykpIHtcclxuICAgICAgICAgICAgICAgICQoJyMnICsgdHlwZSkudG9nZ2xlQ2xhc3MoJ2luJyk7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAkKCcjJyArIHR5cGUpLnJlbW92ZUNsYXNzKCdpbicpO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZtLmVuYWJsZUZpZWxkcyA9IGZ1bmN0aW9uKGlzRW5hYmxlZCkge1xyXG4gICAgICAgICAgICB2bS5yZWFkT25seSA9ICFpc0VuYWJsZWQ7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvKkFkZCBOZXcqL1xyXG4gICAgICAgIHZtLmFkZE5ldyA9IGZ1bmN0aW9uKHR5cGUpIHtcclxuICAgICAgICAgICAgaWYgKHR5cGUgPT09IFwiTmV3c0Fubm91bmNlbWVudHNcIikge1xyXG4gICAgICAgICAgICAgICAgdm0ubmV3c0ZpZWxkcy5zZWxlY3RlZFJvdyA9IC0xO1xyXG4gICAgICAgICAgICAgICAgdm0ubmV3c0ZpZWxkcy5tb2RlID0gXCJTYXZlXCI7XHJcblxyXG4gICAgICAgICAgICAgICAgbmF2Y29uLnNhdmUuYWRkTmV3T3B0aW9uKCRzY29wZSwgdm0ucGFnZUNvbmZpZy5maWVsZHMubmV3c0ZpZWxkcywgdm0ubmV3c0ZpZWxkcywgXCJOZXdzIEFubm91bmNlbWVudFwiLCBcIlwiLCBmdW5jdGlvbihkYXRhKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdm0uc2hvd0hpZGUodHlwZSwgdHJ1ZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgdm0uaXNTYXZlSGlkZSA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgICAgIHZtLmlzRWRpdCA9IGZhbHNlO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICB2bS5lbmFibGVGaWVsZHModHJ1ZSk7XHJcbiAgICAgICAgICAgICAgICB9LCBmYWxzZSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICAvKkNhbmNlbCovXHJcbiAgICAgICAgdm0uY2FuY2VsID0gZnVuY3Rpb24odHlwZSkge1xyXG4gICAgICAgICAgICBpZiAodHlwZSA9PT0gJ25ld3NEZWxldGVNb2RhbCcpIHtcclxuICAgICAgICAgICAgICAgIG5hdmNvbi5jbG9zZU1vZGFsKHR5cGUpO1xyXG4gICAgICAgICAgICB9IGVsc2UgaWYgKHR5cGUgPT09ICdOZXdzQW5ub3VuY2VtZW50cycpIHtcclxuXHJcbiAgICAgICAgICAgICAgICB2bS5pc1NhdmVIaWRlID0gdHJ1ZTtcclxuXHJcbiAgICAgICAgICAgICAgICB2bS5lbmFibGVGaWVsZHMoZmFsc2UpO1xyXG5cclxuICAgICAgICAgICAgICAgIGlmICh2bS5pc0VkaXQpIHtcclxuICAgICAgICAgICAgICAgICAgICBnZXRCeUlkKCk7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIHZtLnNob3dIaWRlKHR5cGUsIGZhbHNlKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIC8qRWRpdCovXHJcbiAgICAgICAgdm0uZWRpdCA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICB2bS5lbmFibGVGaWVsZHModHJ1ZSk7XHJcblxyXG4gICAgICAgICAgICB2bS5pc1NhdmVIaWRlID0gZmFsc2U7XHJcbiAgICAgICAgICAgIHZtLmlzRGVsZXRlSGlkZSA9IGZhbHNlO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIC8qU2F2ZSovXHJcbiAgICAgICAgdm0uc2F2ZSA9IGZ1bmN0aW9uKHR5cGUsIG1vZGUsIGNhbGxiYWNrKSB7XHJcbiAgICAgICAgICAgIGlmICh0eXBlID09PSBcIk5ld3NBbm5vdW5jZW1lbnRzXCIpIHtcclxuICAgICAgICAgICAgICAgIGlmICh2bS5mb3JtTWFuYWdlLmZvcm1WYWxpZCh2bS5uZXdzRmllbGRzKSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHZtLmRlbGV0ZU1vZGFsVGl0bGUgPSBuYXZjb24uc2F2ZS5zYXZlT3B0aW9uKHZtLCBkYXRhc2VydmljZSwgdm0ubmV3c0ZpZWxkcy5tb2RlLCB0eXBlLCB2bS5uZXdzVGFibGUsIHZtLm5ld3NGaWVsZHMsIHZtLm5ld3NGaWVsZHMuc2VsZWN0ZWRSb3csIHZtLm5ld3NGaWVsZHMucHJpbWFyeUtleSwgdm0ubmV3c0ZpZWxkcy5kaXNwbGF5S2V5LCBcIlwiLCB0cnVlLCBcIlwiLCBcIlwiLCBmdW5jdGlvbihkYXRhKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG5hdmNvbi5jbGVhckZpZWxkc0RhdGEodm0ubmV3c0ZpZWxkcywgJHNjb3BlLCBmYWxzZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICQoJyMnICsgdHlwZSkucmVtb3ZlQ2xhc3MoJ2luJyk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoY2FsbGJhY2sgIT09IHVuZGVmaW5lZClcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhbGxiYWNrKGRhdGEgPT09IHVuZGVmaW5lZCB8fCBkYXRhID09PSBudWxsID8gZmFsc2UgOiB0cnVlKTtcclxuICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIC8qRGVsZXRlKi9cclxuICAgICAgICB2bS5kZWxldGUgPSBmdW5jdGlvbih0eXBlLCBjYWxsYmFjaykge1xyXG4gICAgICAgICAgICAvL25hdmNvbi5vcGVuTW9kYWwodHlwZSArICdEZWxldGVNb2RhbCcpO1xyXG5cclxuICAgICAgICAgICAgdmFyIGFjdGlvbiA9IFwiZGVsZXRlXCI7XHJcbiAgICAgICAgICAgIHZtLm5ld3NGaWVsZHMubW9kZSA9IFwiRGVsZXRlXCI7XHJcbiAgICAgICAgICAgIHZhciBkYXRhID0gdm0ubmV3c0ZpZWxkcy5nZXRCeUlkO1xyXG5cclxuICAgICAgICAgICAgdm0ubmV3c0ZpZWxkcy5zZWxlY3RlZFJvdyA9IG5hdmNvbi5zYXZlLnNlbGVjdGVkUm93SW5kZXgodm0ubmV3c1RhYmxlLCBkYXRhLCB2bS5uZXdzRmllbGRzLnByaW1hcnlLZXkpO1xyXG5cclxuICAgICAgICAgICAgbmF2Y29uLnNhdmUuc2F2ZU9wdGlvbih2bSwgZGF0YXNlcnZpY2UsIHZtLm5ld3NGaWVsZHMubW9kZSwgdHlwZSwgdm0ubmV3c1RhYmxlLCB2bS5uZXdzRmllbGRzLCB2bS5uZXdzRmllbGRzLnNlbGVjdGVkUm93LCB2bS5uZXdzRmllbGRzLnByaW1hcnlLZXksIHZtLm5ld3NGaWVsZHMuZGlzcGxheUtleSwgXCJcIiwgZmFsc2UsIFwiXCIsIFwiXCIsIGZ1bmN0aW9uKGRhdGEpIHtcclxuICAgICAgICAgICAgICAgIHZtLm5ld3NGaWVsZHMubW9kZSA9IFwiVXBkYXRlXCI7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuXHJcblxyXG4gICAgICAgIC8qRGVsZXRlKi9cclxuICAgICAgICB2bS50YWJsZVJvd0RlbGV0ZSA9IGZ1bmN0aW9uKHR5cGUsIG1vZGFsLCBjYWxsYmFjaykge1xyXG4gICAgICAgICAgICBpZiAodHlwZSA9PT0gXCJOZXdzQW5ub3VuY2VtZW50c1wiKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAobW9kYWwgPT09IFwiTm9cIikge1xyXG4gICAgICAgICAgICAgICAgICAgIG5hdmNvbi5jbG9zZU1vZGFsKHR5cGUgKyAnZGVsZXRlJyk7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIG5hdmNvbi5zYXZlLmRlbGV0ZU9wdGlvbihkYXRhc2VydmljZSwgdHlwZSwgdm0ubmV3c1RhYmxlLCB2bS5uZXdzRmllbGRzLnNlbGVjdGVkUm93LCB2bS5uZXdzRmllbGRzLnByaW1hcnlLZXksIFwiXCIsIGZ1bmN0aW9uKGRhdGEpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdm0uaXNFZGl0ID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZtLmlzU2F2ZUhpZGUgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2bS5lbmFibGVGaWVsZHMoZmFsc2UpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2bS5zaG93SGlkZSh0eXBlLCBmYWxzZSk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoY2FsbGJhY2sgIT09IHVuZGVmaW5lZClcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhbGxiYWNrKGRhdGEgPT09IHVuZGVmaW5lZCB8fCBkYXRhID09PSBudWxsID8gZmFsc2UgOiB0cnVlKTtcclxuICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZtLnRhYmxlQ2VsbENsaWNrID0gZnVuY3Rpb24ocm93LCBjb2x1bW4sIGRhdGEsIHR5cGUsIGNlbGxPYmosIG9UYWJsZSkge1xyXG4gICAgICAgICAgICBpZiAodHlwZSA9PT0gXCJOZXdzQW5ub3VuY2VtZW50c1wiKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgYWN0aW9uID0gXCJlZGl0XCI7XHJcbiAgICAgICAgICAgICAgICB2bS5uZXdzRmllbGRzLm1vZGUgPSBcIlVwZGF0ZVwiO1xyXG4gICAgICAgICAgICAgICAgdm0ubmV3c0ZpZWxkcy5zZWxlY3RlZFJvdyA9IG5hdmNvbi5zYXZlLnNlbGVjdGVkUm93SW5kZXgodm0ubmV3c1RhYmxlLCBkYXRhLCB2bS5uZXdzRmllbGRzLnByaW1hcnlLZXkpO1xyXG5cclxuICAgICAgICAgICAgICAgIHZtLm1haW5Gb3JtVGl0bGUgPSBuYXZjb24uc2F2ZS52aWV3T3B0aW9uKCRzY29wZSwgYWN0aW9uLCB0eXBlLCB2bS5uZXdzVGFibGUsIHZtLm5ld3NGaWVsZHMsIGRhdGEsIHZtLm5ld3NGaWVsZHMucHJpbWFyeUtleSwgdm0ubmV3c0ZpZWxkcy5kaXNwbGF5S2V5LCBkYXRhc2VydmljZSwgdHJ1ZSwgZnVuY3Rpb24oZGF0YSkge1xyXG4gICAgICAgICAgICAgICAgICAgIC8vdm0ubWFpbkZvcm1UaXRsZSA9IGRhdGE7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIHZtLnNob3dIaWRlKHR5cGUsIHRydWUpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICB2bS5lbmFibGVGaWVsZHMoZmFsc2UpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICB2bS5pc0VkaXQgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgICAgIHZtLmlzU2F2ZUhpZGUgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgfSwgXCJcIiwgZmFsc2UsIFwiXCIpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvKlJvdyBEYXRhIGNoYW5nZSovXHJcbiAgICAgICAgdm0udGFibGVSb3dVcGRhdGUgPSBmdW5jdGlvbihyb3csIGRhdGEsIGluZGV4LCB0eXBlLCBjZWxsT2JqLCBvVGFibGUpIHtcclxuICAgICAgICAgICAgaWYgKHR5cGUgPT09IFwiTmV3c0Fubm91bmNlbWVudHNcIikge1xyXG4gICAgICAgICAgICAgICAgaWYgKGRhdGEuSXNQdWJsaXNoICE9IG51bGwgJiYgZGF0YS5Jc1B1Ymxpc2ggIT09IHVuZGVmaW5lZCAmJiBkYXRhLklzUHVibGlzaCkge1xyXG4gICAgICAgICAgICAgICAgICAgICQocm93KS5jaGlsZHJlbigpLmVxKDMpLmh0bWwoXCI8YSBocmVmPSdqYXZhc2NyaXB0OjsnPlllczwvYT5cIik7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICQocm93KS5jaGlsZHJlbigpLmVxKDMpLmh0bWwoXCI8YSBocmVmPSdqYXZhc2NyaXB0OjsnPk5vPC9hPlwiKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIC8vaWYgKGRhdGEuRG9jdW1lbnRQYXRoICE9PSBudWxsICYmIGRhdGEuRG9jdW1lbnRQYXRoICE9PSBcIlwiICYmIGRhdGEuRG9jdW1lbnRQYXRoLmxlbmd0aCAhPT0gMCkge1xyXG4gICAgICAgICAgICAgICAgLy8gICAgdmFyIGFwcGx5RGF0YSA9IFwiXCI7XHJcbiAgICAgICAgICAgICAgICAvLyAgICAkLm1hcChkYXRhLkRvY3VtZW50UGF0aCwgZnVuY3Rpb24gKGl0ZW0sIGluZGV4KSB7XHJcbiAgICAgICAgICAgICAgICAvLyAgICAgICAgaWYgKGl0ZW0uRG9jdW1lbnRQYXRoICE9PSBudWxsICYmIGl0ZW0uRG9jdW1lbnRQYXRoICE9PSBcIlwiICYmIGl0ZW0uRG9jdW1lbnRQYXRoLmxlbmd0aCAhPT0gMCkge1xyXG4gICAgICAgICAgICAgICAgLy8gICAgICAgICAgICB2YXIgdXJsID0gdXBsb2FkQmFzZSArIGl0ZW1bXCJEb2N1bWVudFBhdGhcIl0udG9TdHJpbmcoKTtcclxuICAgICAgICAgICAgICAgIC8vICAgICAgICAgICAgYXBwbHlEYXRhICs9IFwiPGEgaHJlZj0namF2YXNjcmlwdDo7JyBvbmNsaWNrPVxcXCJ3aW5kb3cub3BlbignXCIgKyB1cmwgKyBcIicpXFxcIj5cIiArIGl0ZW1bXCJEb2N1bWVudE5hbWVcIl0udG9TdHJpbmcoKSArIFwiOzwvYT4mbmJzcDsmbmJzcDtcIjtcclxuICAgICAgICAgICAgICAgIC8vICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAvLyAgICB9KTtcclxuICAgICAgICAgICAgICAgIC8vICAgICQocm93KS5jaGlsZHJlbigpLmVxKDApLmh0bWwoYXBwbHlEYXRhKTtcclxuICAgICAgICAgICAgICAgIC8vfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIC8vICAgIHZhciBjb2x1bW5UZXh0ID0gJChyb3cpLmNoaWxkcmVuKCkuZXEoMCkudGV4dCgpO1xyXG4gICAgICAgICAgICAgICAgLy8gICAgJChyb3cpLmNoaWxkcmVuKCkuZXEoMCkuaHRtbChcIjxhIGhyZWY9J2phdmFzY3JpcHQ6Oyc+XCIgKyBjb2x1bW5UZXh0ICsgXCI8L2E+XCIpO1xyXG4gICAgICAgICAgICAgICAgLy99XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICAvL3ZtLmNsb3NlUG9wdXAgPSBmdW5jdGlvbiAobW9kYWxUeXBlLCBhY3Rpb24pIHtcclxuICAgICAgICAvLyAgICBpZiAoYWN0aW9uID09PSBcIk5vXCIpIHtcclxuICAgICAgICAvLyAgICAgICAgbmF2Y29uLmNsb3NlTW9kYWwobW9kYWxUeXBlKTtcclxuICAgICAgICAvLyAgICB9XHJcbiAgICAgICAgLy8gICAgZWxzZVxyXG4gICAgICAgIC8vICAgICAgICBpZiAoYWN0aW9uID09PSBcIlllc1wiKSB7XHJcbiAgICAgICAgLy8gICAgICAgICAgICBuYXZjb24uc2F2ZS5kZWxldGVPcHRpb24oZGF0YXNlcnZpY2UsIHR5cGUsIHZtLm5ld3NUYWJsZSwgdm0uc2VsZWN0ZWRSb3csIHZtLnByaW1hcnlLZXksIFwiXCIsIGZ1bmN0aW9uIChkYXRhKSB7XHJcbiAgICAgICAgLy8gICAgICAgICAgICAgICAgLy9pZiAoY2FsbGJhY2sgIT09IHVuZGVmaW5lZClcclxuICAgICAgICAvLyAgICAgICAgICAgICAgICAvLyAgICBjYWxsYmFjayhkYXRhID09PSB1bmRlZmluZWQgPyBmYWxzZSA6IHRydWUpO1xyXG4gICAgICAgIC8vICAgICAgICAgICAgICAgIGNsb3NlTW9kYWwoJ2RlbGV0ZScpO1xyXG4gICAgICAgIC8vICAgICAgICAgICAgICAgIG5hdmNvbi5jbG9zZU1vZGFsKG1vZGFsVHlwZSk7XHJcbiAgICAgICAgLy8gICAgICAgICAgICAgICAgaWYgKGRhdGEgIT09IHVuZGVmaW5lZClcclxuICAgICAgICAvLyAgICAgICAgICAgICAgICAgICAgbG9nZ2VyLnN1Y2Nlc3MoXCJFbnRyaWVzIGFyZSBkZWxldGVkIHN1Y2Nlc3NmdWxseS4uLlwiKTtcclxuICAgICAgICAvLyAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIC8vICAgICAgICB9XHJcbiAgICAgICAgLy99XHJcblxyXG4gICAgICAgIC8vZnVuY3Rpb24gY2xvc2VNb2RhbChtb2RlKSB7XHJcbiAgICAgICAgLy8gICAgaWYgKG1vZGUgPT09ICdkZWxldGUnKSB7XHJcbiAgICAgICAgLy8gICAgICAgIGNsZWFyRmllbGRzKCk7XHJcbiAgICAgICAgLy8gICAgICAgICQoJyNSb2xlJykucmVtb3ZlQ2xhc3MoJ2luJyk7XHJcbiAgICAgICAgLy8gICAgfVxyXG4gICAgICAgIC8vICAgIGVsc2Uge1xyXG4gICAgICAgIC8vICAgICAgICB2bS5yZWFkT25seSA9IHRydWU7XHJcbiAgICAgICAgLy8gICAgICAgIHZtLnNob3dIaWRlKCdSb2xlJyk7XHJcbiAgICAgICAgLy8gICAgfVxyXG4gICAgICAgIC8vfVxyXG5cclxuICAgICAgICAvL2Z1bmN0aW9uIGNsZWFyRmllbGRzKCkge1xyXG4gICAgICAgIC8vICAgIHJvbGVJZEluZGV4ID0gbmF2Y29uLmdldEl0ZW1JbmRleEJ5UHJvcGVydHkodm0ubmV3c0ZpZWxkcywgXCJSb2xlSWRcIik7XHJcbiAgICAgICAgLy8gICAgcm9sZU5hbWVJbmRleCA9IG5hdmNvbi5nZXRJdGVtSW5kZXhCeVByb3BlcnR5KHZtLm5ld3NGaWVsZHMsIFwiUm9sZU5hbWVcIik7XHJcbiAgICAgICAgLy8gICAgYWxsUmlnaHRzSW5kZXggPSBuYXZjb24uZ2V0SXRlbUluZGV4QnlQcm9wZXJ0eSh2bS5uZXdzRmllbGRzLCBcIkFsbFJpZ2h0c1wiKTtcclxuICAgICAgICAvLyAgICBwcm9qZWN0Um9sZUluZGV4ID0gbmF2Y29uLmdldEl0ZW1JbmRleEJ5UHJvcGVydHkodm0ubmV3c0ZpZWxkcywgXCJQcm9qZWN0Um9sZVwiKTtcclxuICAgICAgICAvLyAgICByb2xlU3RhdHVzSW5kZXggPSBuYXZjb24uZ2V0SXRlbUluZGV4QnlQcm9wZXJ0eSh2bS5uZXdzRmllbGRzLCBcIlJvbGVTdGF0dXNcIik7XHJcbiAgICAgICAgLy8gICAgcmVtYXJrc0luZGV4ID0gbmF2Y29uLmdldEl0ZW1JbmRleEJ5UHJvcGVydHkodm0ubmV3c0ZpZWxkcywgXCJSZW1hcmtzXCIpO1xyXG4gICAgICAgIC8vICAgIHJvbGVTdGF0dXNOYW1lSW5kZXggPSBuYXZjb24uZ2V0SXRlbUluZGV4QnlQcm9wZXJ0eSh2bS5uZXdzRmllbGRzLCBcIlJvbGVTdGF0dXNOYW1lXCIpO1xyXG5cclxuICAgICAgICAvLyAgICB2bS5uZXdzRmllbGRzW3JvbGVJZEluZGV4XS5kYXRhID0gMDtcclxuICAgICAgICAvLyAgICB2bS5uZXdzRmllbGRzW3JvbGVOYW1lSW5kZXhdLmRhdGEgPSBcIlwiO1xyXG4gICAgICAgIC8vICAgIHZtLm5ld3NGaWVsZHNbYWxsUmlnaHRzSW5kZXhdLmRhdGEgPSBmYWxzZTtcclxuICAgICAgICAvLyAgICB2bS5uZXdzRmllbGRzW3Byb2plY3RSb2xlSW5kZXhdLmRhdGEgPSBcIlwiO1xyXG4gICAgICAgIC8vICAgIHZtLm5ld3NGaWVsZHNbcm9sZVN0YXR1c0luZGV4XS5kYXRhID0gdHJ1ZTtcclxuICAgICAgICAvLyAgICB2bS5uZXdzRmllbGRzW3JlbWFya3NJbmRleF0uZGF0YSA9IFwiXCI7XHJcbiAgICAgICAgLy8gICAgdm0ubmV3c0ZpZWxkc1tyb2xlU3RhdHVzTmFtZUluZGV4XS5kYXRhID0gXCJcIjtcclxuICAgICAgICAvL31cclxuXHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIGdldEJ5SWQoKSB7XHJcbiAgICAgICAgICAgIGlmICh2bS5uZXdzRmllbGRzLmdldEJ5SWQgIT09IHVuZGVmaW5lZCAmJiB2bS5uZXdzRmllbGRzLmdldEJ5SWQgIT09IG51bGwgJiYgdm0ubmV3c0ZpZWxkcy5nZXRCeUlkLmxlbmd0aCAhPT0gMCkge1xyXG4gICAgICAgICAgICAgICAgbmF2Y29uLmNsZWFyRmllbGRzRGF0YSh2bS5uZXdzRmllbGRzKTtcclxuXHJcbiAgICAgICAgICAgICAgICBuYXZjb24udXBkYXRlRmllbGRzRGF0YSh2bS5uZXdzRmllbGRzLCB2bS5uZXdzRmllbGRzLmdldEJ5SWQsIHZtLCBmYWxzZSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIGdldFNlcnZlckRhdGEodHlwZSwgcm93SWQpIHtcclxuICAgICAgICAgICAgcmV0dXJuIGRhdGFzZXJ2aWNlLmdldFNlcnZlckRhdGEodHlwZSwgcm93SWQpLnRoZW4oZnVuY3Rpb24oZGF0YSkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGRhdGE7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIGFjdGl2YXRlKCkge1xyXG4gICAgICAgICAgICBnZXRTZXJ2ZXJEYXRhKCduZXdzQW5ub3VuY2VtZW50c0FsbCcpLnRoZW4oZnVuY3Rpb24oZGF0YSkge1xyXG4gICAgICAgICAgICAgICAgLy9uYXZjb24uc2V0RGlzYWJsZWRFbmFibGVkQnlSaWdodHModm0ucmlnaHRzKTtcclxuICAgICAgICAgICAgICAgIGlmIChkYXRhID09PSB1bmRlZmluZWQgfHwgZGF0YSA9PT0gbnVsbCB8fCBkYXRhLmxlbmd0aCA9PT0gMCkgcmV0dXJuO1xyXG5cclxuICAgICAgICAgICAgICAgIHZtLm5ld3NUYWJsZS5kYXRhID0gZGF0YTtcclxuICAgICAgICAgICAgICAgIHZtLm5ld3NUYWJsZURhdGEgPSBkYXRhO1xyXG4gICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgIHdhdGNoQXR0cmlidXRlcygpO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIGRlZmF1bHREYXRhKGRhdGEpIHtcclxuICAgICAgICAgICAgbmF2Y29uLnNhdmUubG9hZExpc3REZWZhdWx0RGF0YShkYXRhLCB2bS5uZXdzRmllbGRzKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIHdhdGNoQXR0cmlidXRlcygpIHtcclxuICAgICAgICAgICAgdmFyIElUQVJXYXJuaW5nSW5kZXggPSBuYXZjb24uZ2V0SXRlbUluZGV4QnlQcm9wZXJ0eSh2bS5uZXdzRmllbGRzLCBcIklUQVJXYXJuaW5nXCIpO1xyXG4gICAgICAgICAgICAkc2NvcGUuJHdhdGNoKFwidm0ubmV3c0ZpZWxkc1tcIiArIElUQVJXYXJuaW5nSW5kZXggKyBcIl0uZGF0YVwiLCBmdW5jdGlvbihuZXdWYWx1ZSwgb2xkVmFsdWUpIHtcclxuICAgICAgICAgICAgICAgIGlmIChuZXdWYWx1ZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHZtLml0YXJ3YXJuaW5nID0gbmV3VmFsdWU7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIHZtLml0YXJ3YXJuaW5nID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0sIHRydWUpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxufSkoKTsiLCJcInVzZSBzdHJpY3RcIjtcclxuXHJcbmFuZ3VsYXIubW9kdWxlKFwibmF2Y29uRnJhbWV3b3JrXCIpLmNvbnRyb2xsZXIoXCJuYXZjb25GcmFtZXdvcmtDb250cm9sbGVyXCIsXHJcbiAgICBbJyRzY29wZScsICckd2luZG93JywgJyR0aW1lb3V0JywgJyRyb290U2NvcGUnLCAnJGxvY2F0aW9uJywgJ3JvdXRlaGVscGVyJywgJ2F1dGhTZXJ2aWNlJywgJ2RhdGFzZXJ2aWNlJywgJ21lbnVTZXR0aW5ncycsICdzaWduYWxSSHViUHJveHknLCAnbG9nZ2VyJywgJ25nQXV0aFNldHRpbmdzJywgJ2xvY2FsU3RvcmFnZVNlcnZpY2UnLCAnSWRsZScsXHJcbiAgICAgICAgZnVuY3Rpb24gKCRzY29wZSwgJHdpbmRvdywgJHRpbWVvdXQsICRyb290U2NvcGUsICRsb2NhdGlvbiwgcm91dGVoZWxwZXIsIGF1dGhTZXJ2aWNlLCBkYXRhc2VydmljZSwgbWVudVNldHRpbmdzLCBzaWduYWxSSHViUHJveHksIGxvZ2dlciwgbmdBdXRoU2V0dGluZ3MsIGxvY2FsU3RvcmFnZVNlcnZpY2UsIElkbGUpIHtcclxuXHJcbiAgICAgICAgICAgIHZhciByb3V0ZXMgPSByb3V0ZWhlbHBlci5nZXRSb3V0ZXMoKTtcclxuICAgICAgICAgICAgJHNjb3BlLnVzZXJOYW1lID0gXCJcIjtcclxuICAgICAgICAgICAgJHNjb3BlLlVzZXJGdWxsTmFtZSA9IFwiXCI7XHJcbiAgICAgICAgICAgICRzY29wZS5EZXNpZ25hdGlvbiA9IFwiXCI7XHJcbiAgICAgICAgICAgICRzY29wZS5jb21tUGFnZUNvbmZpZyA9IFwiXCIsXHJcbiAgICAgICAgICAgICRzY29wZS5jb21tSXRlbUlkID0gXCJcIixcclxuICAgICAgICAgICAgJHNjb3BlLmNvbW1JdGVtUGFnZSA9IFwiXCIsXHJcbiAgICAgICAgICAgICRzY29wZS5jdXJyZW50TWFpbm1lbnUgPSBcIkhvbWVcIjtcclxuICAgICAgICAgICAgJHNjb3BlLmN1cnJlbnRTdWJtZW51ID0gXCJNeSBTcGFjZVwiO1xyXG4gICAgICAgICAgICAkc2NvcGUuY3VycmVudFN1Ym1lbnVVUkwgPSBcIi9teXNwYWNlXCIucmVwbGFjZSgnLycsICcnKTtcclxuICAgICAgICAgICAgJHNjb3BlLmN1cnJlbnRNYWlubWVudWljb24gPSBcImZhIGZhLWhvbWVcIjtcclxuICAgICAgICAgICAgJHNjb3BlLmlkbGVUaW1lT3V0ID0gMTgwMDtcclxuICAgICAgICAgICAgJHNjb3BlLmlkbGVDb25maXJtVGltZU91dCA9IDU7XHJcbiAgICAgICAgICAgICRzY29wZS51c2VyUHJvZmlsZUltYWdlID0gXCJcIjtcclxuICAgICAgICAgICAgJHNjb3BlLmFib3V0VXNEYXRhID0ge307XHJcbiAgICAgICAgICAgIGlmIChuZ0F1dGhTZXR0aW5ncy5zZXNzaW9uVGltZU91dCAhPT0gdW5kZWZpbmVkICYmIG5nQXV0aFNldHRpbmdzLnNlc3Npb25UaW1lT3V0ID4gMCkge1xyXG4gICAgICAgICAgICAgICAgJHNjb3BlLmlkbGVUaW1lT3V0ID0gbmdBdXRoU2V0dGluZ3Muc2Vzc2lvblRpbWVPdXQ7XHJcbiAgICAgICAgICAgICAgICBpZiAobmdBdXRoU2V0dGluZ3Muc2Vzc2lvblRpbWVPdXQgPCA2MClcclxuICAgICAgICAgICAgICAgICAgICAkc2NvcGUuaWRsZVRpbWVPdXQgPSA2MDtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgaWYgKG5nQXV0aFNldHRpbmdzLnNlc3Npb25Db25maXJtVGltZU91dCAhPT0gdW5kZWZpbmVkICYmIG5nQXV0aFNldHRpbmdzLnNlc3Npb25Db25maXJtVGltZU91dCA+IDApXHJcbiAgICAgICAgICAgICAgICAkc2NvcGUuaWRsZUNvbmZpcm1UaW1lT3V0ID0gbmdBdXRoU2V0dGluZ3Muc2Vzc2lvbkNvbmZpcm1UaW1lT3V0O1xyXG5cclxuICAgICAgICAgICAgJHNjb3BlLmZlZWRiYWNrID0gXCJtYWlsdG86XCI7XHJcbiAgICAgICAgICAgIGlmIChuZ0F1dGhTZXR0aW5ncy5mZWVkYmFjayAhPT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgICAgICAgICAvLyRzY29wZS5mZWVkYmFjayA9ICRzY29wZS5mZWVkYmFjayArIG5nQXV0aFNldHRpbmdzLmZlZWRiYWNrLm1haWx0byArIFwiP2NjPVwiICsgbmdBdXRoU2V0dGluZ3MuZmVlZGJhY2suY2MgKyBcIiZiY2M9XCIgKyBuZ0F1dGhTZXR0aW5ncy5mZWVkYmFjay5iY2MgKyBcIiZzdWJqZWN0PVwiICsgbmdBdXRoU2V0dGluZ3MuZmVlZGJhY2suc3ViamVjdDtcclxuICAgICAgICAgICAgICAgICRzY29wZS5mZWVkYmFjayA9ICRzY29wZS5mZWVkYmFjay5jb25jYXQobmdBdXRoU2V0dGluZ3MuZmVlZGJhY2subWFpbHRvKTtcclxuICAgICAgICAgICAgICAgIGlmIChuZ0F1dGhTZXR0aW5ncy5mZWVkYmFjay5jYyAhPSAnJylcclxuICAgICAgICAgICAgICAgICAgICAkc2NvcGUuZmVlZGJhY2sgPSAkc2NvcGUuZmVlZGJhY2suY29uY2F0KFwiP2NjPVwiICsgbmdBdXRoU2V0dGluZ3MuZmVlZGJhY2suY2MpXHJcbiAgICAgICAgICAgICAgICBpZiAobmdBdXRoU2V0dGluZ3MuZmVlZGJhY2suYmNjICE9ICcnKVxyXG4gICAgICAgICAgICAgICAgICAgICRzY29wZS5mZWVkYmFjayA9ICRzY29wZS5mZWVkYmFjay5jb25jYXQoXCI/YmNjPVwiICsgbmdBdXRoU2V0dGluZ3MuZmVlZGJhY2suYmNjKVxyXG4gICAgICAgICAgICAgICAgaWYgKG5nQXV0aFNldHRpbmdzLmZlZWRiYWNrLnN1YmplY3QgIT0gJycpXHJcbiAgICAgICAgICAgICAgICAgICAgJHNjb3BlLmZlZWRiYWNrID0gJHNjb3BlLmZlZWRiYWNrLmNvbmNhdChcIj9zdWJqZWN0PVwiICsgbmdBdXRoU2V0dGluZ3MuZmVlZGJhY2suc3ViamVjdClcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgJHNjb3BlLnVzZXJQcm9maWxlQ2xpY2sgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICAkc2NvcGUuY3VycmVudE1haW5tZW51ID0gXCJIb21lXCI7XHJcbiAgICAgICAgICAgICAgICAkc2NvcGUuY3VycmVudE1haW5tZW51aWNvbiA9IFwiZmEgZmEtaG9tZVwiO1xyXG4gICAgICAgICAgICAgICAgJHNjb3BlLmN1cnJlbnRTdWJtZW51ID0gXCJNeSBQcm9maWxlXCI7XHJcblxyXG4gICAgICAgICAgICAgICAgJGxvY2F0aW9uLnBhdGgoJy91c2VycHJvZmlsZScpO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAkc2NvcGUubm90aWZpY2F0aW9uVmlld0NsaWNrID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgJHNjb3BlLmN1cnJlbnRNYWlubWVudSA9IFwiSG9tZVwiO1xyXG4gICAgICAgICAgICAgICAgJHNjb3BlLmN1cnJlbnRNYWlubWVudWljb24gPSBcImZhIGZhLWhvbWVcIjtcclxuICAgICAgICAgICAgICAgICRzY29wZS5jdXJyZW50U3VibWVudSA9IFwiTm90aWZpY2F0aW9uc1wiO1xyXG5cclxuICAgICAgICAgICAgICAgICRsb2NhdGlvbi5wYXRoKCcvbm90aWZpY2F0aW9ucycpO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAkcm9vdFNjb3BlLmlzRmVlZGJhY2sgPSBmYWxzZTtcclxuICAgICAgICAgICAgJHNjb3BlLmZlZWRiYWNrQ2xpY2sgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICAkcm9vdFNjb3BlLmlzRmVlZGJhY2sgPSB0cnVlO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAkc2NvcGUuaGVscE9wZW4gPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAobmdBdXRoU2V0dGluZ3MuaGVscFVSTCAhPT0gdW5kZWZpbmVkICYmIG5nQXV0aFNldHRpbmdzLmhlbHBVUkwgIT09IFwiXCIpXHJcbiAgICAgICAgICAgICAgICAgICAgd2luZG93Lm9wZW4obmdBdXRoU2V0dGluZ3MuaGVscFVSTCwgJ19ibGFuaycsICdsb2NhdGlvbj15ZXMsaGVpZ2h0PTgwMCx3aWR0aD0nICsgKHdpbmRvdy5vdXRlcldpZHRoIC8gMikqMS4yNSArICcscmVzaXphYmxlPXllcyxzY3JvbGxiYXJzPXllcyxzdGF0dXM9eWVzJyk7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICRzY29wZS5hYm91dFVzQ2xpY2sgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICBnZXRTZXJ2ZXJEYXRhKFwiYWJvdXRVc0NvbmZpZ1wiKS50aGVuKGZ1bmN0aW9uIChkYXRhKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGRhdGEgPT09IHVuZGVmaW5lZCB8fCBkYXRhID09PSBudWxsIHx8IGRhdGEubGVuZ3RoID09PSAwKSByZXR1cm47XHJcbiAgICAgICAgICAgICAgICAgICAgJHNjb3BlLmFib3V0VXNEYXRhID0gZGF0YS5hYm91dFVzO1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBhdXRoRGF0YSA9IGxvY2FsU3RvcmFnZVNlcnZpY2UuZ2V0KCdhdXRob3JpemF0aW9uRGF0YScpO1xyXG4gICAgICAgICAgICAgICAgICAgICRzY29wZS5hYm91dFVzRGF0YS52ZXJzaW9uID0gYXV0aERhdGEudmVyc2lvbjtcclxuICAgICAgICAgICAgICAgICAgICBuYXZjb24ub3Blbk1vZGFsKFwiYWJvdXRVc1wiKTtcclxuICAgICAgICAgICAgICAgICAgICAvLyQoJyNhYm91dFVzJykubW9kYWwoe1xyXG4gICAgICAgICAgICAgICAgICAgIC8vICAgIHNob3c6IHRydWVcclxuICAgICAgICAgICAgICAgICAgICAvL30pO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICRzY29wZS5hYm91dFVzU2l0ZUNsaWNrID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgd2luZG93Lm9wZW4oJHNjb3BlLmFib3V0VXNEYXRhLndlYnNpdGUudG9TdHJpbmcoKSwgJ19ibGFuaycpO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAkc2NvcGUuc3RhcnRUaW1lciA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgICRzY29wZS4kYnJvYWRjYXN0KCd0aW1lci1zdGFydCcpO1xyXG4gICAgICAgICAgICB9O1xyXG5cclxuICAgICAgICAgICAgJHNjb3BlLnN0b3BUaW1lciA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgICRzY29wZS4kYnJvYWRjYXN0KCd0aW1lci1zdG9wJyk7XHJcbiAgICAgICAgICAgIH07XHJcblxyXG4gICAgICAgICAgICAkc2NvcGUucmVzZXRUaW1lciA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgICRzY29wZS4kYnJvYWRjYXN0KCd0aW1lci1yZXNldCcpO1xyXG4gICAgICAgICAgICB9O1xyXG5cclxuICAgICAgICAgICAgZ2V0TmF2Um91dGVzKCk7XHJcblxyXG4gICAgICAgICAgICBmdW5jdGlvbiBnZXROYXZSb3V0ZXMoKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgYXV0aERhdGEgPSBsb2NhbFN0b3JhZ2VTZXJ2aWNlLmdldCgnYXV0aG9yaXphdGlvbkRhdGEnKTtcclxuXHJcbiAgICAgICAgICAgICAgICAkc2NvcGUubm90aWZpY2F0aW9uID0gW107XHJcbiAgICAgICAgICAgICAgICBpZiAoYXV0aERhdGEgIT09IHVuZGVmaW5lZCAmJiBhdXRoRGF0YSAhPT0gbnVsbCkge1xyXG4gICAgICAgICAgICAgICAgICAgICRzY29wZS51c2VyTmFtZSA9IGF1dGhEYXRhLnVzZXJOYW1lO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChhdXRoRGF0YS5GaXJzdE5hbWUgPT09IHVuZGVmaW5lZCB8fCBhdXRoRGF0YS5GaXJzdE5hbWUgPT09IG51bGwpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGF1dGhEYXRhLkZpcnN0TmFtZSA9IFwiXCI7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGF1dGhEYXRhLkxhc3ROYW1lID09PSB1bmRlZmluZWQgfHwgYXV0aERhdGEuTGFzdE5hbWUgPT09IG51bGwpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGF1dGhEYXRhLkxhc3ROYW1lID0gXCJcIjtcclxuICAgICAgICAgICAgICAgICAgICAkc2NvcGUuVXNlckZ1bGxOYW1lID0gYXV0aERhdGEuRmlyc3ROYW1lICsgXCIgXCIgKyBhdXRoRGF0YS5MYXN0TmFtZTtcclxuICAgICAgICAgICAgICAgICAgICAkc2NvcGUuRGVzaWduYXRpb24gPSBhdXRoRGF0YS5EZXNpZ25hdGlvbjtcclxuICAgICAgICAgICAgICAgICAgICBsb2FkTm90aWZpY2F0aW9uKGF1dGhEYXRhLm5vdGlmaWNhdGlvbik7XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgJHNjb3BlLiRvbignQUxFUlQtREFUQS1SRUZSRVNIJywgZnVuY3Rpb24gKGV2ZW50LCBkYXRhLCBzdGF0dXMpIHtcclxuICAgICAgICAgICAgICAgICAgICAvL2lmKGF1dGhEYXRhID09PSBudWxsKXtcclxuICAgICAgICAgICAgICAgICAgICBhdXRoRGF0YSA9IGxvY2FsU3RvcmFnZVNlcnZpY2UuZ2V0KCdhdXRob3JpemF0aW9uRGF0YScpO1xyXG4gICAgICAgICAgICAgICAgICAgICRzY29wZS51c2VyTmFtZSA9IGF1dGhEYXRhLnVzZXJOYW1lO1xyXG4gICAgICAgICAgICAgICAgICAgICRzY29wZS5Vc2VyRnVsbE5hbWUgPSBhdXRoRGF0YS5GaXJzdE5hbWUgKyBcIiBcIiArIGF1dGhEYXRhLkxhc3ROYW1lO1xyXG4gICAgICAgICAgICAgICAgICAgICRzY29wZS5EZXNpZ25hdGlvbiA9IGF1dGhEYXRhLkRlc2lnbmF0aW9uO1xyXG4gICAgICAgICAgICAgICAgICAgIC8vfVxyXG4gICAgICAgICAgICAgICAgICAgIGlmIChzdGF0dXMpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgbG9hZE5vdGlmaWNhdGlvbihkYXRhLCB0cnVlKTtcclxuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBsb2FkTm90aWZpY2F0aW9uKGRhdGEsIGZhbHNlKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgYXV0aERhdGEubm90aWZpY2F0aW9uLnB1c2goZGF0YVswXSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsU3RvcmFnZVNlcnZpY2Uuc2V0KCdhdXRob3JpemF0aW9uRGF0YScsIGF1dGhEYXRhKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgICAgICAkc2NvcGUuJG9uKCdBTEVSVC1EQVRBLURFTEVURScsIGZ1bmN0aW9uIChldmVudCwgZGF0YSwgdHlwZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGF1dGhEYXRhID0gbG9jYWxTdG9yYWdlU2VydmljZS5nZXQoJ2F1dGhvcml6YXRpb25EYXRhJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGF1dGhEYXRhLm5vdGlmaWNhdGlvbi5sZW5ndGggPiAwKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBub3RpZmljYXRpb24gPSBkZWxldGVOb3RpZmljYXRpb24oYXV0aERhdGEubm90aWZpY2F0aW9uLCBkYXRhLCB0eXBlKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgbG9hZE5vdGlmaWNhdGlvbihub3RpZmljYXRpb24sIHRydWUpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBhdXRoRGF0YS5ub3RpZmljYXRpb24gPSBub3RpZmljYXRpb247XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsU3RvcmFnZVNlcnZpY2Uuc2V0KCdhdXRob3JpemF0aW9uRGF0YScsIGF1dGhEYXRhKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgICAgICAkc2NvcGUuJG9uKCdBTEVSVC1EQVRBLURFTEVURS1BTEwnLCBmdW5jdGlvbiAoZXZlbnQsIGRhdGEsIHR5cGUpIHtcclxuICAgICAgICAgICAgICAgICAgICBhdXRoRGF0YSA9IGxvY2FsU3RvcmFnZVNlcnZpY2UuZ2V0KCdhdXRob3JpemF0aW9uRGF0YScpO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChhdXRoRGF0YS5ub3RpZmljYXRpb24ubGVuZ3RoID4gMCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgbm90aWZpY2F0aW9uID0gW107XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGxvYWROb3RpZmljYXRpb24obm90aWZpY2F0aW9uLCB0cnVlKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgYXV0aERhdGEubm90aWZpY2F0aW9uID0gbm90aWZpY2F0aW9uO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBsb2NhbFN0b3JhZ2VTZXJ2aWNlLnNldCgnYXV0aG9yaXphdGlvbkRhdGEnLCBhdXRoRGF0YSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICAgICAgJHNjb3BlLiRvbignU0NSRUVOLUlETEUnLCBmdW5jdGlvbiAoZXZlbnQsIG1ldGhvZCwgaWRsZVRpbWVPdXQsIGlkbGVDb25maXJtVGltZU91dCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGlkbGVUaW1lb3V0U2V0dGluZ3MobWV0aG9kLCBpZGxlVGltZU91dCwgaWRsZUNvbmZpcm1UaW1lT3V0KTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgICAgICRzY29wZS50aW1lT3V0Q2xvc2UgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgbmF2Y29uLmNsb3NlTW9kYWwoJ2lkbGV0aW1lb3V0Jyk7XHJcbiAgICAgICAgICAgICAgICAgICAgJHNjb3BlLnN0b3BUaW1lcigpO1xyXG4gICAgICAgICAgICAgICAgICAgICR0aW1lb3V0KGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgJHNjb3BlLnJlc2V0VGltZXIoKTtcclxuICAgICAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAgICAgfTtcclxuXHJcbiAgICAgICAgICAgICAgICBmdW5jdGlvbiBpZGxlVGltZW91dFNldHRpbmdzKG1ldGhvZCwgaWRsZVRpbWVPdXQsIGlkbGVDb25maXJtVGltZU91dCkge1xyXG4gICAgICAgICAgICAgICAgICAgICRzY29wZS5pZGxlQ29uZmlybVRpbWVPdXQgPSBpZGxlQ29uZmlybVRpbWVPdXQ7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKG1ldGhvZCA9PT0gJ0lkbGVUaW1lb3V0Jykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBuYXZjb24uY2xvc2VNb2RhbCgnaWRsZXRpbWVvdXQnKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgJHNjb3BlLnN0b3BUaW1lcigpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAkdGltZW91dChmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkc2NvcGUucmVzZXRUaW1lcigpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAkKCcubW9kYWwnKS5tb2RhbCgnaGlkZScpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAkc2NvcGUubG9nT3V0KCk7XHJcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChtZXRob2QgPT09ICdJZGxlU3RhcnQnKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG5hdmNvbi5vcGVuTW9kYWwoJ2lkbGV0aW1lb3V0JywgZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJHNjb3BlLnN0YXJ0VGltZXIoKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChtZXRob2QgPT09ICdJZGxlRW5kJykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAkKCcubW9kYWwnKS5tb2RhbCgnaGlkZScpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyRzY29wZS5sb2dPdXQoKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgJHNjb3BlLm5vdGlmaWNhdGlvbkNsaWNrID0gZnVuY3Rpb24gKGl0ZW0pIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoYXV0aERhdGEgPT09IG51bGwpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGF1dGhEYXRhID0gbG9jYWxTdG9yYWdlU2VydmljZS5nZXQoJ2F1dGhvcml6YXRpb25EYXRhJyk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGlmIChpdGVtLnR5cGUudG9TdHJpbmcoKSA9PT0gXCIxXCIpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGl0ZW0gIT09IHVuZGVmaW5lZCAmJiBpdGVtICE9PSBudWxsKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoaXRlbS5ORkRldGFpbHNJZCAhPT0gdW5kZWZpbmVkICYmIGl0ZW0uTkZEZXRhaWxzSWQgIT09IG51bGwpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgZGF0YSA9IHsgTkZEZXRhaWxzSWQ6IGl0ZW0uTkZEZXRhaWxzSWQgfTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkYXRhc2VydmljZS5wdXREYXRhKFwiTXlTcGFjZS9Ob3RpZmljYXRpb24vVXBkYXRlXCIsIGRhdGEpLnRoZW4oZnVuY3Rpb24gKGRhdGEpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaXRlbS5zdGF0dXMgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBpID0gMCwgbGVuID0gYXV0aERhdGEubm90aWZpY2F0aW9uLmxlbmd0aDsgaSA8IGxlbjsgaSsrKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoYXV0aERhdGEubm90aWZpY2F0aW9uW2ldLk5GRGV0YWlsc0lkID09PSBpdGVtLk5GRGV0YWlsc0lkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYXV0aERhdGEubm90aWZpY2F0aW9uW2ldLlN0YXR1cyA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9jYWxTdG9yYWdlU2VydmljZS5zZXQoJ2F1dGhvcml6YXRpb25EYXRhJywgYXV0aERhdGEpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICgkbG9jYXRpb24uJCR1cmwgPT09ICcvbm90aWZpY2F0aW9ucycpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRyb290U2NvcGUuJGJyb2FkY2FzdCgnTk9USUZJQ0FUSU9OLUFMRVJULURBVEEtUkVGUkVTSCcsIGRhdGEsIGZ1bmN0aW9uICgpIHsgfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LCA1MDApXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgLy9pZiAoaXRlbS50eXBlID09PSAwKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgLy8gICAgJGxvY2F0aW9uLnBhdGgoJy9yZWZyZXNoJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgLy8gICAgJGxvY2F0aW9uLnBhdGgoJy8nICsgaXRlbS5wYWdlLnRvTG93ZXJDYXNlKCkpO1xyXG4gICAgICAgICAgICAgICAgICAgIC8vICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgICAgIC8vICAgICAgICAkcm9vdFNjb3BlLiRicm9hZGNhc3QoaXRlbS5wYWdlLnRvVXBwZXJDYXNlKCkgKyAnLUFMRVJULURBVEEtUkVGUkVTSCcsIGl0ZW0uY29kZSwgZmFsc2UpO1xyXG4gICAgICAgICAgICAgICAgICAgIC8vICAgIH0sIDUwMClcclxuICAgICAgICAgICAgICAgICAgICAvL30gZWxzZSBpZiAoaXRlbS50eXBlID09PSAyKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgLy8gICAgJHNjb3BlLmNvbW1JdGVtSWQgPSBpdGVtLmNvZGU7XHJcbiAgICAgICAgICAgICAgICAgICAgLy8gICAgJHNjb3BlLmNvbW1JdGVtUGFnZSA9IGl0ZW0ucGFnZS50b0xvd2VyQ2FzZSgpO1xyXG4gICAgICAgICAgICAgICAgICAgIC8vICAgIC8vICAkc2NvcGUubW9kYWxJZCA9IFwibWVzc2FnZWNvbW1cIjtcclxuICAgICAgICAgICAgICAgICAgICAvLyAgICBuYXZjb24ub3Blbk1vZGFsKFwibWVzc2FnZWNvbW1cIik7XHJcbiAgICAgICAgICAgICAgICAgICAgLy99XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgJHNjb3BlLm5hdlJvdXRlcyA9IFtdXHJcbiAgICAgICAgICAgICAgICBsb2FkTWVudXMobWVudVNldHRpbmdzLmRhdGEpO1xyXG5cclxuICAgICAgICAgICAgICAgICRzY29wZS4kb24oJ01FTlUtU0VUVElORy1EQVRBLVJFRlJFU0gnLCBmdW5jdGlvbiAoZXZlbnQsIGFyZ3MpIHtcclxuICAgICAgICAgICAgICAgICAgICBsb2FkTWVudXMobWVudVNldHRpbmdzLmRhdGEpO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICAgICAgJHNjb3BlLm1lbnVDbGljayA9IGZ1bmN0aW9uIChlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKCQoJy5wYWdlLXNpZGViYXInKS5oYXNDbGFzcygnaGlkZU1lbnUnKSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAkKCcucHJvZmlsZScpLnRvZ2dsZUNsYXNzKCdoaWRlTWVudWRldGFpbCcpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAkKCcucGFnZS1sb2dvJykudG9nZ2xlQ2xhc3MoJ2hpZGVNZW51ZGV0YWlsJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICQoJy5wYWdlLXNpZGViYXInKS50b2dnbGVDbGFzcygnaGlkZU1lbnUnKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgJCgnI3BhZ2Vjb250ZW50JykudG9nZ2xlQ2xhc3MoJ21hcmdpbkxlZnQwJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICQoJyNNYWlubWVudSBsaSBhIGRpdicpLnRvZ2dsZUNsYXNzKCdoaWRlTWVudWRldGFpbCcpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAkKCcjTWFpbm1lbnUgbGkgYSBzcGFuJykudG9nZ2xlQ2xhc3MoJ2hpZGVNZW51ZGV0YWlsJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICQoJyNNYWlubWVudSBsaS5hY3RpdmUgdWwnKS50b2dnbGVDbGFzcygnaGlkZU1lbnVkZXRhaWwnKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKCQoZS50YXJnZXQpLnBhcmVudHMoJ2xpJykuaGFzQ2xhc3MoJ2FjdGl2ZScpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICQoJyNNYWlubWVudSBsaScpLnJlbW92ZUNsYXNzKCdhY3RpdmUnKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgJCgnI01haW5tZW51IGxpIGEgc3BhbicpLnJlbW92ZUNsYXNzKCdmYSBmYS1jaGV2cm9uLWRvd24nKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgJCgnI01haW5tZW51IGxpIGEgc3BhbicpLmFkZENsYXNzKCdmYSBmYS1jaGV2cm9uLXJpZ2h0Jyk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoZS50YXJnZXQubG9jYWxOYW1lID09ICdzcGFuJyB8fCBlLnRhcmdldC5sb2NhbE5hbWUgPT0gJ2knIHx8IGUudGFyZ2V0LmxvY2FsTmFtZSA9PSAnZGl2Jykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY2hlY2tFbGVtZW50ID0gJChlLnRhcmdldCkucGFyZW50KCkubmV4dCgpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY2hlY2tFbGVtZW50ID0gJChlLnRhcmdldCkubmV4dCgpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoY2hlY2tFbGVtZW50LmlzKCd1bCcpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyQoY2hlY2tFbGVtZW50KS5jc3MoXCJkaXNwbGF5XCIsIFwibm9uZVwiKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICQoJyNNYWlubWVudSB1bDp2aXNpYmxlJykuc2xpZGVVcCgnbm9ybWFsJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgJCgnI01haW5tZW51IGxpJykucmVtb3ZlQ2xhc3MoJ2FjdGl2ZScpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAkKCcjTWFpbm1lbnUgbGkgYSBzcGFuJykucmVtb3ZlQ2xhc3MoJ2ZhIGZhLWNoZXZyb24tZG93bicpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAkKCcjTWFpbm1lbnUgbGkgYSBzcGFuJykuYWRkQ2xhc3MoJ2ZhIGZhLWNoZXZyb24tcmlnaHQnKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBjaGVja0VsZW1lbnQ7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChlLnRhcmdldC5sb2NhbE5hbWUgPT0gJ3NwYW4nIHx8IGUudGFyZ2V0LmxvY2FsTmFtZSA9PSAnaScgfHwgZS50YXJnZXQubG9jYWxOYW1lID09ICdkaXYnKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjaGVja0VsZW1lbnQgPSAkKGUudGFyZ2V0KS5wYXJlbnQoKS5uZXh0KCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjaGVja0VsZW1lbnQgPSAkKGUudGFyZ2V0KS5uZXh0KCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgJChlLnRhcmdldCkucGFyZW50cygnbGknKS5hZGRDbGFzcygnYWN0aXZlJylcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGUudGFyZ2V0LmxvY2FsTmFtZSA9PSAnYScpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkKGUudGFyZ2V0KS5maW5kKCdzcGFuJykuYWRkQ2xhc3MoJ2ZhIGZhLWNoZXZyb24tZG93bicpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoZS50YXJnZXQubG9jYWxOYW1lID09ICdzcGFuJylcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICQoZS50YXJnZXQpLmFkZENsYXNzKCdmYSBmYS1jaGV2cm9uLWRvd24nKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGUudGFyZ2V0LmxvY2FsTmFtZSA9PSAnaScpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkKGUudGFyZ2V0KS5uZXh0KCkubmV4dCgpLmFkZENsYXNzKCdmYSBmYS1jaGV2cm9uLWRvd24nKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGUudGFyZ2V0LmxvY2FsTmFtZSA9PSAnZGl2JylcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICQoZS50YXJnZXQpLm5leHQoKS5hZGRDbGFzcygnZmEgZmEtY2hldnJvbi1kb3duJyk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoKGNoZWNrRWxlbWVudC5pcygndWwnKSkgJiYgKGNoZWNrRWxlbWVudC5pcygnOnZpc2libGUnKSkpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoKGNoZWNrRWxlbWVudC5pcygndWwnKSkgJiYgKCFjaGVja0VsZW1lbnQuaXMoJzp2aXNpYmxlJykpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkKCcjTWFpbm1lbnUgdWw6dmlzaWJsZScpLnNsaWRlVXAoJ25vcm1hbCcpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY2hlY2tFbGVtZW50LnNsaWRlRG93bignbm9ybWFsJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG5cclxuICAgICAgICAgICAgICAgICAgICAvLyQoJyNNYWlubWVudSBsaScpLnJlbW92ZUNsYXNzKCdjdXJyZW50LXBhZ2UnKTtcclxuICAgICAgICAgICAgICAgICAgICAvLyQoZS50YXJnZXQpLnBhcmVudCgpLmFkZENsYXNzKCdjdXJyZW50LXBhZ2UnKTtcclxuXHJcbiAgICAgICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICAgICAgJHNjb3BlLnN1Ym1lbnVDbGljayA9IGZ1bmN0aW9uIChlLCBtYWlubWVudSwgc3VibWVudSkgey8vcGFnZW5hbWVcclxuICAgICAgICAgICAgICAgICAgICAkc2NvcGUuY3VycmVudE1haW5tZW51ID0gbWFpbm1lbnUudGV4dDtcclxuICAgICAgICAgICAgICAgICAgICAkc2NvcGUuY3VycmVudE1haW5tZW51aWNvbiA9IG1haW5tZW51Lkljb25DbGFzcztcclxuICAgICAgICAgICAgICAgICAgICAkc2NvcGUuY3VycmVudFN1Ym1lbnUgPSBzdWJtZW51LnRleHQ7XHJcbiAgICAgICAgICAgICAgICAgICAgJHNjb3BlLmN1cnJlbnRTdWJtZW51VVJMID0gc3VibWVudS5Db25maWdOYW1lO1xyXG4gICAgICAgICAgICAgICAgICAgICQoJyNNYWlubWVudSBsaScpLnJlbW92ZUNsYXNzKCdjdXJyZW50LXBhZ2UnKTtcclxuICAgICAgICAgICAgICAgICAgICAkKGUudGFyZ2V0KS5wYXJlbnQoKS5hZGRDbGFzcygnY3VycmVudC1wYWdlJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgLy8kc3RhdGUuZ28ocGFnZW5hbWUpO1xyXG4gICAgICAgICAgICAgICAgfTtcclxuXHJcblxyXG4gICAgICAgICAgICAgICAgLy8kc2NvcGUubWVudUNsaWNrID0gZnVuY3Rpb24oaXRlbSl7XHJcbiAgICAgICAgICAgICAgICAvLyAgICAkdGltZW91dChmdW5jdGlvbigpe1xyXG4gICAgICAgICAgICAgICAgLy8gICAgICAgICRyb290U2NvcGUuJGJyb2FkY2FzdCgnU1VCTUVOVS1MT0FESU5HJywgaXRlbS5Db25maWdOYW1lLnRvTG93ZXJDYXNlKCkpOyBcclxuICAgICAgICAgICAgICAgIC8vICAgIH0pXHJcbiAgICAgICAgICAgICAgICAvL31cclxuXHJcblxyXG4gICAgICAgICAgICAgICAgJHNjb3BlLm1haW5NZW51RmlsdGVyID0gZnVuY3Rpb24gKGl0ZW0pIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoaXRlbS5NZW51VHlwZSA9PT0gMCB8fCBpdGVtLk1lbnVUeXBlID09PSAxIHx8IGl0ZW0uTWVudVR5cGUgPT09IDIpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgICAgICAgICAgIH07XHJcblxyXG4gICAgICAgICAgICAgICAgZnVuY3Rpb24gbG9hZE1lbnVzKGRhdGEpIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoZGF0YSA9PT0gdW5kZWZpbmVkKSByZXR1cm47XHJcbiAgICAgICAgICAgICAgICAgICAgJHNjb3BlLm5hdlJvdXRlcyA9IFtdXHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGRhdGEubGVuZ3RoID09PSB1bmRlZmluZWQpIHJldHVybjtcclxuICAgICAgICAgICAgICAgICAgICAkc2NvcGUubWVudXMgPSBkYXRhO1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIGZ1bmN0aW9uIGRlbGV0ZU5vdGlmaWNhdGlvbihkYXRhLCBpZCwgdHlwZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBub3RpZmljYXRpb24gPSBbXTtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgZmllbGQgPSBcIk5vdGlmaWNhdGlvbklkXCI7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHR5cGUgPT09ICd1c2VyJylcclxuICAgICAgICAgICAgICAgICAgICAgICAgZmllbGQgPSBcIk5GRGV0YWlsc0lkXCI7XHJcbiAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDAsIGxlbiA9IGRhdGEubGVuZ3RoOyBpIDwgbGVuOyBpKyspIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGl0ZW0gPSBkYXRhW2ldO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoaXRlbVtmaWVsZF0gPT09IGlkKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29udGludWU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG5vdGlmaWNhdGlvbi5wdXNoKGl0ZW0pO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gbm90aWZpY2F0aW9uO1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIGZ1bmN0aW9uIGxvYWROb3RpZmljYXRpb24oZGF0YSwgc3RhdHVzKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGRhdGEgPT09IHVuZGVmaW5lZCB8fCBkYXRhLmxlbmd0aCA9PT0gMCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAkc2NvcGUubm90aWZpY2F0aW9uID0gW107XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHN0YXR1cylcclxuICAgICAgICAgICAgICAgICAgICAgICAgJHNjb3BlLm5vdGlmaWNhdGlvbiA9IFtdO1xyXG4gICAgICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSAwLCBsZW4gPSBkYXRhLmxlbmd0aDsgaSA8IGxlbiA7IGkrKykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgaXRlbSA9IGRhdGFbaV07XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChpdGVtLk1lc3NhZ2UgPT09IHVuZGVmaW5lZCB8fCBpdGVtLk1lc3NhZ2UgPT09IFwiXCIpIGNvbnRpbnVlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgb2JqID0ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaXRlbTogaXRlbS5NZXNzYWdlLCBwYWdlOiBpdGVtLlBhZ2VLZXksIGNvZGU6IGl0ZW0uSWQsIHN0YXR1czogaXRlbS5TdGF0dXMgfHwgZmFsc2UsIE5vdGlmaWNhdGlvbkRldGFpbElkOiBpdGVtLk5vdGlmaWNhdGlvbkRldGFpbElkLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgTkZEZXRhaWxzSWQ6IGl0ZW0uTm90aWZpY2F0aW9uRGV0YWlsSWQsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkYXRlOiBuYXZjb24uZGF0ZUZyb21VVENUb0xvY2FsKGl0ZW0uTGFzdFVwZGF0ZURhdGUsIFwiREQvTU0vWVlZWSBISDpNTVwiKSwgdHlwZTogaXRlbS5UeXBlXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICRzY29wZS5ub3RpZmljYXRpb24ucHVzaChvYmopO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfTtcclxuXHJcbiAgICAgICAgICAgICRzY29wZS5sb2dPdXQgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoJCgnLnBhZ2Utc2lkZWJhcicpLmhhc0NsYXNzKCdoaWRlTWVudScpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgJCgnLnByb2ZpbGUnKS50b2dnbGVDbGFzcygnaGlkZU1lbnVkZXRhaWwnKTtcclxuICAgICAgICAgICAgICAgICAgICAkKCcucGFnZS1sb2dvJykudG9nZ2xlQ2xhc3MoJ2hpZGVNZW51ZGV0YWlsJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgJCgnLnBhZ2Utc2lkZWJhcicpLnRvZ2dsZUNsYXNzKCdoaWRlTWVudScpO1xyXG4gICAgICAgICAgICAgICAgICAgICQoJyNwYWdlY29udGVudCcpLnRvZ2dsZUNsYXNzKCdtYXJnaW5MZWZ0MCcpO1xyXG4gICAgICAgICAgICAgICAgICAgICQoJyNNYWlubWVudSBsaSBhIGRpdicpLnRvZ2dsZUNsYXNzKCdoaWRlTWVudWRldGFpbCcpO1xyXG4gICAgICAgICAgICAgICAgICAgICQoJyNNYWlubWVudSBsaSBhIHNwYW4nKS50b2dnbGVDbGFzcygnaGlkZU1lbnVkZXRhaWwnKTtcclxuICAgICAgICAgICAgICAgICAgICAkKCcjTWFpbm1lbnUgbGkuYWN0aXZlIHVsJykudG9nZ2xlQ2xhc3MoJ2hpZGVNZW51ZGV0YWlsJyk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBhdXRoU2VydmljZS5sb2dPdXQoZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgICAgICQoJy5tb2RhbCcpLm1vZGFsKCdoaWRlJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgJHNjb3BlLmN1cnJlbnRNYWlubWVudSA9IFwiSG9tZVwiO1xyXG4gICAgICAgICAgICAgICAgICAgICRzY29wZS5jdXJyZW50TWFpbm1lbnVpY29uID0gXCJmYSBmYS1ob21lXCI7XHJcbiAgICAgICAgICAgICAgICAgICAgJHNjb3BlLmN1cnJlbnRTdWJtZW51ID0gXCJNeSBTcGFjZVwiO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICBpZiAobmdBdXRoU2V0dGluZ3MuU1NPICE9PSB1bmRlZmluZWQgJiYgbmdBdXRoU2V0dGluZ3MuU1NPKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChuZ0F1dGhTZXR0aW5ncy5hcHBVUkwgIT09IHVuZGVmaW5lZCAmJiBuZ0F1dGhTZXR0aW5ncy5hcHBVUkwgIT09IFwiXCIpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdpbmRvdy5sb2NhdGlvbi5ocmVmID0gbmdBdXRoU2V0dGluZ3MuYXBwVVJMICsgXCJsb2dvdXQuYXNweFwiO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJGxvY2F0aW9uLnBhdGgoJy9sb2dpbicpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgJGxvY2F0aW9uLnBhdGgoJy9sb2dpbicpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9O1xyXG5cclxuICAgICAgICAgICAgLypDYW5jZWwqL1xyXG4gICAgICAgICAgICAkc2NvcGUuY2FuY2VsID0gZnVuY3Rpb24gKHR5cGUpIHtcclxuICAgICAgICAgICAgICAgIG5hdmNvbi5jbG9zZU1vZGFsKHR5cGUpO1xyXG4gICAgICAgICAgICB9O1xyXG5cclxuICAgICAgICAgICAgdmFyIGN1cnJlbnRVcmwgPSBcIlwiO1xyXG5cclxuICAgICAgICAgICAgaWYgKCRsb2NhdGlvbi4kJHBhdGggIT09IHVuZGVmaW5lZClcclxuICAgICAgICAgICAgICAgIGN1cnJlbnRVcmwgPSAkbG9jYXRpb24uJCRwYXRoLnN1YnN0cmluZygxLCAkbG9jYXRpb24uJCRwYXRoLmxlbmd0aCkudG9Mb3dlckNhc2UoKTtcclxuXHJcbiAgICAgICAgICAgIGZ1bmN0aW9uIGdldFVzZXJQcm9maWxlKCkge1xyXG4gICAgICAgICAgICAgICAgaWYgKCRyb290U2NvcGUudXNlclByb2ZpbGVJbWFnZSA9PT0gdW5kZWZpbmVkIHx8ICRyb290U2NvcGUudXNlclByb2ZpbGVJbWFnZSA9PT0gb2xkVmFsdWUgfHwgJHJvb3RTY29wZS51c2VyUHJvZmlsZUltYWdlID09PSBcIlwiKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIGRhdGFVc2VyID0gZ2V0U2VydmVyRGF0YSgndXNlclByb2ZpbGVJZCcpLnRoZW4oZnVuY3Rpb24gKGRhdGFVc2VyKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChkYXRhVXNlciAhPT0gdW5kZWZpbmVkICYmIGRhdGFVc2VyICE9PSBudWxsKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgdXNlckltYWdlID0gZGF0YVVzZXIuaW1nO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChkYXRhVXNlci5pbWcgPT09IHVuZGVmaW5lZCB8fCBkYXRhVXNlci5pbWcgPT09IG51bGwgfHwgZGF0YVVzZXIuaW1nID09PSBcIlwiKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVzZXJJbWFnZSA9IFwiLzlqLzRBQVFTa1pKUmdBQkFRQUFBUUFCQUFELzJ3Q0VBQWtHQmhBUUVSVVFFQkFWRlJBVUVob1lFQkVTRHhRU0VoVVNGUmdWSUJZVUVoY1lIQ2NmRnhzdkd4SVhIeThnSXljcUxEZ3RGUjR5TlRBcU5TWXJMQ29CQ1FvS0JRVUZEUVVGRFNrWUVoZ3BLU2twS1NrcEtTa3BLU2twS1NrcEtTa3BLU2twS1NrcEtTa3BLU2twS1NrcEtTa3BLU2twS1NrcEtTa3BLU2twS2YvQUFCRUlBTHdBa0FNQklnQUNFUUVERVFIL3hBQWJBQUVBQWdNQkFRQUFBQUFBQUFBQUFBQUFBZ1VCQkFZREIvL0VBRU1RQUFJQ0FRRURDQWNEQ2dRSEFBQUFBQUVDQUFNUkJCSWhNUVVHTWtGUllYR0JFeUlqUWxLUm9UTmlnaFJEY25PaXNiTEIwZkEwZEpMU0pGTmpvN1BDdy8vRUFCUUJBUUFBQUFBQUFBQUFBQUFBQUFBQUFBRC94QUFVRVFFQUFBQUFBQUFBQUFBQUFBQUFBQUFBLzlvQURBTUJBQUlSQXhFQVB3RDdobU16RVFNNWpNeEVET1l6TVJBem1NelE1VTVicDB3SHBXOVp1aFdxbDdIeHgyVUc4K1BDVnA1MlAxYUs0cjJsNkZieVUyZnZnZERtTXlnSE80ZTlwTlFQQkszL0FJWE1tdlBIUys5NlZQMDlOY0I1a0tSQXZNeG1WbW01eTZPdzRUVTFGdmg5S29iL0FFa2d5eWdaekdaaUlHY3htWWlCbk1abUlnWXpHWkhNWmdTekdaSE1aZ1N6S2psdmw4VSt5cUFzMVREMWE4K3FnUDV5NGpvcDlUd0hhTlhsemxweTUwMm1iRmcrM3V4a1VxUnVDamcxcEhBY0FONTZnZEhTYU5LZ1FnNG5Mc1NXZDI2MmRqdlk5NWdSMHVqMlMxanNYdWY3UzF1azNZb0h1b09wUnVIanZteEVqZGNxS1hZZ0tveXpFNEFBNGt3SlRNMXRCcmx1VGJVTVBXSUt1TmwxSVBCbE85VGpCd2UwVFlnUXUwNk9NT3FzT3hsREQ1R2VlaTE3YUVqSkxhSTdtVWtzMm4rK2hPODFkcSs3eEc3SW5yWmFxOUlnZUpBL2ZQQ3ZsS2gyOUd0MWJNUjBGdFJpUjE3Z1lIWWhnZDQ0ZFJtY3ptZWJXczlDL3dDUnNmVXdXMGhKejdNZEtuOE9RUjkwajRaMG1ZRXN4bVJ6R1lFc3htUnpHWUdNeG1SekdZRXN5cDV3Y3J0U3ExMDRPcHR5S2dSa0lvNlZyajRWeU4zV1NCMXkwek9WYjF0VnFYUEVPdGE5eUlpbkE3QnRPeDhUQWFQU0xVdXlDVHZKWm1PV2R6dlozUFdTZDg5b2lBa2VSdVQvQU1zY1hQOEE0V3R2WXIxWFdLZnRXN2F3UjZvNnlOcmdCUERsUFR0WlRaV3B3elZzcW52SU9QNzc1MUhJMnJTMmlxeXNCVWF0U3FnWUNqQTlUSFZqaGp1Z2ErdTVzNmU1ellWWmJHNlQxV1BXV3h3MnRrNFk5NW5nT1p1bDk3MHI5ejZtNGp6QWJmTHlJRlhWelcwUzhOSlRudE5LTTN6SUpucnIrUkticWpTVUNyeFVvQXJJNDZMb1FOekR0L3JOK0lIejdWWFdWZ213ZjhUbzdGc2JaR050QnhkQjJOVnRqSGJrZFU3bExBd0RLY3FSa0VjQ0R3SWxIenMwd1ZxZFNCdkRpbTNzYXEzaG50dyt5UjR0MnoyNXFPZnlTb0gzQTFmbFU3SVBvZ2dYR1l6STVqTUNXWXpJNWpNQ09Zekk1ak1DV1p5K01hblZEL3JLM2s5VlpIOC9sT216T1Y1VTFDMDZxNW16NjFkTEtxakxPeEwxaFZIV2RwUVBNUU5xSjVXVTZ4VjIyMG5xOWFwZXIyZ2ZvWXdUM0JqM1ptZE5xVnNVT2h5cDRIOTRJTzhISXhnd1BRbnJtN3pMWW5Uc1FENkkzMkdna0ViVlRITzB1ZmQybWJIZGlWT3BvRjFsT21QUXRjK2xBNjZxMUxNdmdUc3FlNWpPMFZRQmdEQUhBRGhpQm1JaUFpSWdVM1BEVFdXYUs1YWhtMEtIckFHVHQxc0dHQjE3MTRTWEl0VmFhZXBhVzI2aFdOaHg3NE84djRra2s5NWxucWJ4V2pPM1JWU3plQ2pKK2dsTnpmcVpkTlh0RERNRFl3SEFOY3pPVkhoNlRIbEFzOHhtUnpHWUVzeG1SekdZRWN4bVF6R1lFOHlsNVQwUWZYYUt3OEZOd0k2aTJ3R1RQZ2EySWx2bVVuTzViUFFwWlUyelpWcUttUmlNZ1piWU8wUGg5cGc5eE1Eckp5SExHa2ZTMldYN0FiUzJPck9WT0dxZHNLek1wNlNrNFlrYnhsdDNYT2g1RzVUR3BwVzBEWkp5SFRPU2xpa2gwSjdtQkUxdWQzK0MxSDZsdjNRS3JrcmZyMHoxYVcwanhObW5CK2s2eWNqb1gyZGJTZmlydVQ1K2liLzV6cm9DSWlBaUlnZU90MHdzcmVzOEhSbEo3bUJIODVVOGg2Z3ZwcVdQUzlFb2Nkam9ObHgvcVV5OG5QOEFJZjJUZjVpLy93QTFrQ3l6R1pETVpnVHpHWkRNWmdSekdaSE1aZ1N6UERYNlFYVlBTeHdMRUtrOVl5TnpEdkJ3ZktldVl6QTVma2ZsU3pUazM3SktFN092cFhlVXVUYzkxWTYrRzlldGRramVOL2F1bFdvcXdjUFRZbmlySXcrb0lNNWJscWowTC9sYTlEQUdxVWZBT2plTzllRGRxL296ZDVvMzdCdDB2dVY3TmxINnEwdjZvN2c2T0IzRllGam8rYldscGNXVjBxcnJuWllaSkdSZzR5ZXlXY1JBUkVRRVJFRHkxV29XdEdzWTRWRkxNZnVxQ1Q5QktQa09zcnA2ZzI1eW0yNCsvYVM3RDV1UjVUYTUxa25TV0lQem16VjVYT3FINk9aSmp2OEFPQkxNWmtjeG1CTE1aa2N4bUJITVprTXhtQlBNWmtNeG1CUCs5L0R6bE55VHljZExyYTlsczBXVldWMW9SNjFaR3k2cHRlOG9DdnM1M2dFamZ1bHRtVnZLZXVWTDlHaDZiNnIxY0Rnb3JkV1k5Z3pZcStMUU9zaUlnSWlJQ0lpQlQ4NVRrVXA4ZXFyK1NaYy9TdVp6S1hsdm5McHhyMHFkOWxhVWJMbjdNYWkwS0ZWendVaXN0dk83Mmc0UzN6L2ZkQW5tTXlHWXpBbm1NeUdZekFqbU15T1l6QWxtTXlJMzhKUzhvYzdOUFZsVUp1c0h1MUVGUWZ2MmRFZVdUM1FMbTY5VVV1N0JVVVpaMk9GVWRwTTVLalVMcld0dllNcTdZcm8zbFhWS2prT0NONnNYSmI1RHFsWHlseW5icVdCdUlDS2NwU21mUnFmaU9kN3QzbnlBbG56YUhzUEd5dy90bitrQys1TzUwV1VZVFY1ZXJxMVNyNnkvNWhCL0d1N3RBNHpyS3JsZFF5TUdVaktzcEJCQjRFRWNST0pubHBHdDB6RjlLUUZKeStuWWtVdWVzcmo3SnU4YnUwR0IzMFNrMFhQRFN1dnRMRm9zSFRxdmRLMkI3c25Eajd5a2lhUExYT25iOWpvckZaeVBhYWhHVjBxVS9DUmtOWWVvZFhFOVFJZS9MZk9aa2YwR21DdGFQdFhmSnFxSFVyQlNDem40UVJnYnlSdXpUMzZuVjJmYWF0d3ZXdEtMU1BudmY5cWVlbjA2MXFGWGgyazVKSjRzeE84a25lU2UyZXNEbGVWZEVsVit5aWdLOVFKSGF5c1F4T2VKSVpjazc1TGs3bE8vVGJxYk1KL3lYRzNWNURPVS9DUk5qbkg5clQrcnQvZlRLK0IwMm01OEQ4OXAzWDcxVHJhdnliWllmV1dlbTUwYU96Y05RcW40YmMwbi91QUQ2emhvSXp4Z2ZUUWNqSTNnOENONFBnZUJqTStZVTErak9heTFaN2FuYW8rZXlSbnpsalJ6aDFpY0w5c2RsMWF2OVJzdDlZSGN1NEFMRWdLQmxtWWhWQTdXSjNBZU1vTmR6eXFYZFFwdWI0c2xLUitNakxmaEI4Uk9ZMWQ5bDUycjdEWVFjZ05nVnFmdVZqMVI0NHozeU1EMzEvS1YrbzNYV1pRL21rR3hWNEVaeS80aVpycW9HNERBNmdOd21ZZ0pkODJUN0RIWmJZUDJqL1dVa3RlYkQ3clU3TGRyeWRWL21EOG9GM0VSQWl5QThRRDRqTXlxZ2NCandtWWdJaUlIUGM0VDdlc2RsVC9WNi84QWJOQ2JmTHB6cWZDaGZtejJmN1pxUUVSRUJFUkFSRVFFUkVCTnJrTzNaMUdPcXlzajhWWnlQMldmNVRWa0xiQ216YU9OYkJ3TzBEcER6VWtRT3ppUnJzREFNcHlDQVFlMEhnZmxKUUVSRUJFUkE1YmxWczZtenVXdGYyYy8rODhKaHJkdDdMT3ByV3g0TDZvL2htWUNJaUFpSWdJaUlDSWlBaUlnVzNOclZlcTFCNDFIMU8rcHM3UHlPVjhoTHFjY21vTkxyY1BjM09CMTFOMGg1WURmaG5ZSTRJQkJ5Q01namdRZUJFRE1SRUJOVGxYV2VocGV3ZElMNm5lNTNLUG1STnVjL3dBNDlUdE9sSTRMN1N6eDNpc0h6Mm0vQ0lGWlJWc3FGN0FCOHV1VGlJQ0lpQWlJZ0lpSUNJaUFpSWdKWmMyOVpzNTB6ZTZDMVBmWDFwK0VuNUVka3JaNDZ1MG92cFYzUFg2eUh2SFVlNGdrSHhnZHRFd0RNd1BQVWFoYTBaM09GVUVzZTRUa0VkbkxXUDA3RzJtSHdqM1Y4bEFIemx0em90UHNxL2NkeVhIYnNES2c5MmNIeUVySUNJaUFpSWdJaUlILzJRPT1cIjtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkcm9vdFNjb3BlLnVzZXJQcm9maWxlSW1hZ2UgPSB1c2VySW1hZ2U7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgJHNjb3BlLmZpcnN0SW5kZXggPSBmdW5jdGlvbiAoaW5kZXhObywgdHlwZSkge1xyXG4gICAgICAgICAgICAgICAgaWYgKHR5cGUgPT0gXCJtYWluXCIpIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoaW5kZXhObyA9PT0gMCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhZENydW1iQ29uZmlnKFwiXCIpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gXCJhY3RpdmVcIjtcclxuICAgICAgICAgICAgICAgICAgICB9IGVsc2VcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFwiXCI7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHR5cGUgPT0gXCJzdWJcIikge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChpbmRleE5vID09PSAwKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gXCJibG9ja1wiO1xyXG4gICAgICAgICAgICAgICAgICAgIGVsc2VcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFwibm9uZVwiO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9O1xyXG5cclxuICAgICAgICAgICAgZnVuY3Rpb24gYnJlYWRDcnVtYkNvbmZpZyh1cmwpIHtcclxuICAgICAgICAgICAgICAgIHZhciBldGFyZ2V0LCBjaGVja0VsZW1lbnQ7XHJcbiAgICAgICAgICAgICAgICBpZiAoJHNjb3BlLm1lbnVzICE9PSB1bmRlZmluZWQgJiYgJHNjb3BlLm1lbnVzICE9PSBudWxsICYmICRzY29wZS5tZW51cy5sZW5ndGggIT09IDApIHtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgYWxsTWVudXMgPSBuYXZjb24uZ2V0RGF0YUZyb21UcmVlKCRzY29wZS5tZW51cywgJycsIDApO1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBmaWx0ZXJNZW51cyA9ICQuZ3JlcChhbGxNZW51cywgZnVuY3Rpb24gKGUpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGUuQ29uZmlnTmFtZSAhPT0gdW5kZWZpbmVkICYmIGUuQ29uZmlnTmFtZSAhPT0gbnVsbCAmJiBlLkNvbmZpZ05hbWUgIT09IFwiXCI7XHJcbiAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGZpbHRlck1lbnVzLmxlbmd0aCA+IDApIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHVybCA9PT0gXCJcIikgdXJsID0gZmlsdGVyTWVudXNbMF0udGV4dDtcclxuXHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgc3ViTWVudSA9IG5hdmNvbi5nZXRJdGVtQnlLZXlWYWx1ZShmaWx0ZXJNZW51cywgJ0NvbmZpZ05hbWUnLCB1cmwsIHRydWUpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoc3ViTWVudSAhPT0gLTEpIHtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgbWFpbk1lbnUgPSBuYXZjb24uZ2V0SXRlbUJ5S2V5VmFsdWUoYWxsTWVudXMsICdpZCcsIHN1Yk1lbnUuUGFyZW50SWQsIHRydWUpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKG1haW5NZW51ICE9PSAtMSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRzY29wZS5jdXJyZW50TWFpbm1lbnUgPSBtYWluTWVudS50ZXh0O1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRzY29wZS5jdXJyZW50TWFpbm1lbnVpY29uID0gbWFpbk1lbnUuSWNvbkNsYXNzO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkKCcjTWFpbm1lbnUgbGknKS5yZW1vdmVDbGFzcygnYWN0aXZlJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJCgnI01haW5tZW51IGxpIGEgc3BhbicpLnJlbW92ZUNsYXNzKCdmYSBmYS1jaGV2cm9uLWRvd24nKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkKCcjTWFpbm1lbnUgbGkgYSBzcGFuJykuYWRkQ2xhc3MoJ2ZhIGZhLWNoZXZyb24tcmlnaHQnKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZXRhcmdldCA9ICQoJCgnI21haW5NZW51SWRfJyArIG1haW5NZW51LmlkKS5jaGlsZHJlbigpWzBdKS5jaGlsZHJlbigpWzFdXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJCgnI21haW5NZW51SWRfJyArIG1haW5NZW51LmlkKS5hZGRDbGFzcygnYWN0aXZlJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8kKCcjJyArIG1haW5NZW51LmlkKS5jaGlsZHJlbigpLmZpcnN0KCkuY2xpY2soKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkc2NvcGUuY3VycmVudFN1Ym1lbnUgPSBzdWJNZW51LnRleHQ7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkc2NvcGUuY3VycmVudFN1Ym1lbnVVUkwgPSB1cmw7XHJcblxyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICQoJyNNYWlubWVudSBsaScpLnJlbW92ZUNsYXNzKCdjdXJyZW50LXBhZ2UnKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICQoJyNtYWluTWVudVN1YklkXycgKyBzdWJNZW51LmlkKS5hZGRDbGFzcygnY3VycmVudC1wYWdlJyk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGV0YXJnZXQgIT09IHVuZGVmaW5lZCAmJiBldGFyZ2V0ICE9PSBudWxsKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGV0YXJnZXQubG9jYWxOYW1lID09ICdzcGFuJyB8fCBldGFyZ2V0LmxvY2FsTmFtZSA9PSAnaScgfHwgZXRhcmdldC5sb2NhbE5hbWUgPT0gJ2RpdicpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2hlY2tFbGVtZW50ID0gJChldGFyZ2V0KS5wYXJlbnQoKS5uZXh0KCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjaGVja0VsZW1lbnQgPSAkKGV0YXJnZXQpLm5leHQoKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChjaGVja0VsZW1lbnQuaXMoJ3VsJykpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8kKGNoZWNrRWxlbWVudCkuY3NzKFwiZGlzcGxheVwiLCBcIm5vbmVcIik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICQoJyNNYWlubWVudSB1bDp2aXNpYmxlJykuc2xpZGVVcCgnbm9ybWFsJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNoZWNrRWxlbWVudC5zbGlkZURvd24oJ25vcm1hbCcpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgJHRpbWVvdXQoZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgaWYgKCRyb290U2NvcGUuY29uZmlnSGVhZGVyTWVudSAhPT0gdW5kZWZpbmVkICYmICRyb290U2NvcGUuY29uZmlnSGVhZGVyTWVudSAhPT0gbnVsbCAmJiAkcm9vdFNjb3BlLmNvbmZpZ0hlYWRlck1lbnUgIT09IFwibG9naW5cIilcclxuICAgICAgICAgICAgICAgICAgICBnZXRVc2VyUHJvZmlsZSgpO1xyXG5cclxuICAgICAgICAgICAgICAgIGJyZWFkQ3J1bWJDb25maWcoY3VycmVudFVybCk7XHJcblxyXG4gICAgICAgICAgICAgICAgJHJvb3RTY29wZS4kYnJvYWRjYXN0KCdTVUJNRU5VLUxPQURJTkcnLCBjdXJyZW50VXJsKTtcclxuXHJcbiAgICAgICAgICAgICAgICAvKmlmICgkKFwiLm1haW5fbWVudV9zaWRlIC5tZW51U2Nyb2xsYmFyXCIpLm1DdXN0b21TY3JvbGxiYXIubGVuZ3RoICE9PSAwKVxyXG4gICAgICAgICAgICAgICAgICAgICQoXCIubWFpbl9tZW51X3NpZGUgLm1lbnVTY3JvbGxiYXJcIikubUN1c3RvbVNjcm9sbGJhcignZGVzdHJveScpOyovXHJcbiAgICAgICAgICAgICAgICBpZighJChcIi5wYWdlLXNpZGViYXJcIikuaGFzQ2xhc3MoJ21DdXN0b21TY3JvbGxiYXInKSl7XHJcbiAgICAgICAgICAgICAgICAgICAgJChcIi5wYWdlLXNpZGViYXJcIikubUN1c3RvbVNjcm9sbGJhcih7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGF1dG9IaWRlU2Nyb2xsYmFyOiB0cnVlLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBzY3JvbGxJbmVydGlhOiAwLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBzY3JvbGxiYXJQb3NpdGlvbjogXCJvdXRzaWRlXCJcclxuICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAvLyQoXCIjcGFnZWNvbnRlbnRcIikubUN1c3RvbVNjcm9sbGJhcih7XHJcbiAgICAgICAgICAgICAgICAvLyAgICBhdXRvSGlkZVNjcm9sbGJhcjogdHJ1ZSxcclxuICAgICAgICAgICAgICAgIC8vICAgIHRoZW1lOiBcIjNkLWRhcmtcIixcclxuICAgICAgICAgICAgICAgIC8vICAgIHNjcm9sbEluZXJ0aWE6IDAsXHJcbiAgICAgICAgICAgICAgICAvLyAgICBzY3JvbGxiYXJQb3NpdGlvbjogXCJvdXRzaWRlXCJcclxuICAgICAgICAgICAgICAgIC8vfSk7XHJcbiAgICAgICAgICAgIH0pXHJcblxyXG4gICAgICAgICAgICAkc2NvcGUuZ2V0VGltZW91dE1pbnV0ZXMgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gJHNjb3BlLmlkbGVUaW1lT3V0IC8gNjA7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGZ1bmN0aW9uIGdldFNlcnZlckRhdGEodHlwZSwgcm93SWQpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBkYXRhc2VydmljZS5nZXRTZXJ2ZXJEYXRhKHR5cGUsIHJvd0lkKS50aGVuKGZ1bmN0aW9uIChkYXRhKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGRhdGE7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfTtcclxuXHJcbiAgICAgICAgICAgIGZ1bmN0aW9uIGFjdGl2YXRlKCkge1xyXG5cclxuICAgICAgICAgICAgICAgIGlmIChhdXRoU2VydmljZS5hdXRoZW50aWNhdGlvbi5pc0F1dGgpXHJcbiAgICAgICAgICAgICAgICAgICAgJHJvb3RTY29wZS4kYnJvYWRjYXN0KCdTVEFSVC1TRVNTSU9OJyk7XHJcbiAgICAgICAgICAgIH07XHJcblxyXG4gICAgICAgICAgICBhY3RpdmF0ZSgpO1xyXG4gICAgICAgICAgICBMYXlvdXQuaW5pdFNpZGViYXIoKTtcclxuXHJcbiAgICAgICAgICAgICRyb290U2NvcGUuJHdhdGNoKFwidXNlclByb2ZpbGVJbWFnZVwiLCBmdW5jdGlvbiAobmV3VmFsdWUsIG9sZFZhbHVlKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAobmV3VmFsdWUgIT09IHVuZGVmaW5lZCAmJiBuZXdWYWx1ZSAhPT0gb2xkVmFsdWUgJiYgbmV3VmFsdWUgIT09IFwiXCIpIHtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgaW1nU3JjID0gXCJkYXRhOmltYWdlL2pwZWc7YmFzZTY0LFwiICsgbmV3VmFsdWU7XHJcbiAgICAgICAgICAgICAgICAgICAgJHNjb3BlLnVzZXJQcm9maWxlSW1hZ2UgPSBpbWdTcmM7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0sIHRydWUpO1xyXG4gICAgICAgIH1cclxuICAgIF0pOyIsIlwidXNlIHN0cmljdFwiO1xyXG5cclxuYW5ndWxhci5tb2R1bGUoJ25hdmNvbk1lbnUnKS5jb250cm9sbGVyKCduYXZjb25NZW51Q29udHJvbGxlcicsXHJcbiAgICBbJyRzY29wZScsICckcm9vdFNjb3BlJyxcclxuICAgICAgICBmdW5jdGlvbiAoJHNjb3BlLCAkcm9vdFNjb3BlKSB7XHJcblxyXG4gICAgICAgICAgICAkc2NvcGUuaXNWZXJ0aWNhbCA9IHRydWU7XHJcbiAgICAgICAgICAgICRzY29wZS5vcGVuTWVudVNjb3BlID0gbnVsbDtcclxuICAgICAgICAgICAgJHNjb3BlLnNob3dNZW51ID0gdHJ1ZTtcclxuICAgICAgICAgICAgJHNjb3BlLmFsbG93SG9yaXpvbnRhbFRvZ2dsZSA9IHRydWU7XHJcblxyXG4gICAgICAgICAgICB0aGlzLmdldEFjdGl2ZUVsZW1lbnQgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gJHNjb3BlLmFjdGl2ZUVsZW1lbnQ7XHJcbiAgICAgICAgICAgIH07XHJcblxyXG4gICAgICAgICAgICB0aGlzLnNldEFjdGl2ZUVsZW1lbnQgPSBmdW5jdGlvbiAoZWwpIHtcclxuICAgICAgICAgICAgICAgICRzY29wZS5hY3RpdmVFbGVtZW50ID0gZWw7XHJcbiAgICAgICAgICAgIH07XHJcblxyXG4gICAgICAgICAgICB0aGlzLmlzVmVydGljYWwgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gJHNjb3BlLmlzVmVydGljYWw7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIHRoaXMuc2V0Um91dGUgPSBmdW5jdGlvbiAocm91dGUpIHtcclxuICAgICAgICAgICAgICAgICRyb290U2NvcGUuJGJyb2FkY2FzdCgnbmF2Y29uLW1lbnUtaXRlbS1zZWxlY3RlZC1ldmVudCcsXHJcbiAgICAgICAgICAgICAgICAgICAgeyByb3V0ZTogcm91dGUgfSk7XHJcbiAgICAgICAgICAgIH07XHJcblxyXG4gICAgICAgICAgICB0aGlzLnNldE9wZW5NZW51U2NvcGUgPSBmdW5jdGlvbiAoc2NvcGUpIHtcclxuICAgICAgICAgICAgICAgICRzY29wZS5vcGVuTWVudVNjb3BlID0gc2NvcGU7XHJcbiAgICAgICAgICAgIH07XHJcblxyXG4gICAgICAgICAgICAkc2NvcGUudG9nZ2xlTWVudU9yaWVudGF0aW9uID0gZnVuY3Rpb24gKCkge1xyXG5cclxuICAgICAgICAgICAgICAgIC8vIGNsb3NlIGFueSBvcGVuIG1lbnVcclxuICAgICAgICAgICAgICAgIGlmICgkc2NvcGUub3Blbk1lbnVTY29wZSlcclxuICAgICAgICAgICAgICAgICAgICAkc2NvcGUub3Blbk1lbnVTY29wZS5jbG9zZU1lbnUoKTtcclxuXHJcbiAgICAgICAgICAgICAgICAkc2NvcGUuaXNWZXJ0aWNhbCA9ICEkc2NvcGUuaXNWZXJ0aWNhbDtcclxuXHJcbiAgICAgICAgICAgICAgICAkcm9vdFNjb3BlLiRicm9hZGNhc3QoJ25hdmNvbi1tZW51LW9yaWVudGF0aW9uLWNoYW5nZWQtZXZlbnQnLFxyXG4gICAgICAgICAgICAgICAgICAgIHsgaXNNZW51VmVydGljYWw6ICRzY29wZS5pc1ZlcnRpY2FsIH0pO1xyXG4gICAgICAgICAgICB9O1xyXG5cclxuICAgICAgICAgICAgYW5ndWxhci5lbGVtZW50KGRvY3VtZW50KS5iaW5kKCdjbGljaycsIGZ1bmN0aW9uIChlKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoJHNjb3BlLm9wZW5NZW51U2NvcGUgJiYgISRzY29wZS5pc1ZlcnRpY2FsKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKCQoZS50YXJnZXQpLnBhcmVudCgpLmhhc0NsYXNzKCduYXZjb24tc2VsZWN0YWJsZS1pdGVtJykpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgICAgICAgICAkc2NvcGUuJGFwcGx5KGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgJHNjb3BlLm9wZW5NZW51U2NvcGUuY2xvc2VNZW51KCk7XHJcbiAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xyXG4gICAgICAgICAgICAgICAgICAgIGUuc3RvcFByb3BhZ2F0aW9uKCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgJHNjb3BlLiRvbignbmF2Y29uLW1lbnUtc2hvdycsIGZ1bmN0aW9uKGV2dCwgZGF0YSkge1xyXG4gICAgICAgICAgICAgICAgJHNjb3BlLnNob3dNZW51ID0gZGF0YS5zaG93O1xyXG4gICAgICAgICAgICAgICAgJHNjb3BlLmlzVmVydGljYWwgPSBkYXRhLmlzVmVydGljYWw7XHJcbiAgICAgICAgICAgICAgICAkc2NvcGUuYWxsb3dIb3Jpem9udGFsVG9nZ2xlID0gZGF0YS5hbGxvd0hvcml6b250YWxUb2dnbGU7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuICAgIF0pOyIsIlwidXNlIHN0cmljdFwiO1xyXG5cclxuYW5ndWxhci5tb2R1bGUoJ2FwcCcpLmRpcmVjdGl2ZSgnbmF2Y29uRGFzaGJvYXJkJywgWyckbG9jYWxTdG9yYWdlJywgJyRyb290U2NvcGUnLCAnbG9jYWxTdG9yYWdlU2VydmljZScsICdkYXRhc2VydmljZScsICduZ0F1dGhTZXR0aW5ncycsICdsb2dnZXInLCAnJHRpbWVvdXQnLCAnJGxvY2F0aW9uJywgJ2F1dGhTZXJ2aWNlJyxcclxuZnVuY3Rpb24gKCRsb2NhbFN0b3JhZ2UsICRyb290U2NvcGUsIGxvY2FsU3RvcmFnZVNlcnZpY2UsIGRhdGFzZXJ2aWNlLCBuZ0F1dGhTZXR0aW5ncywgbG9nZ2VyLCAkdGltZW91dCwgJGxvY2F0aW9uLCBhdXRoU2VydmljZSkge1xyXG4gICAgcmV0dXJuIHtcclxuICAgICAgICByZXN0cmljdDogJ0FFJyxcclxuICAgICAgICBzY29wZToge1xyXG4gICAgICAgICAgICBuYXZjb25EYXRhOiAnPScsXHJcbiAgICAgICAgICAgIHBhZ2VDb25maWc6ICc9J1xyXG4gICAgICAgIH0sXHJcbiAgICAgICAgdGVtcGxhdGU6ICc8bWFpbi1kYXNoYm9hcmQgPjwvbWFpbi1kYXNoYm9hcmQ+JyxcclxuICAgICAgICBsaW5rOiBmdW5jdGlvbiAoc2NvcGUsIGVsLCBhdHRycykge1xyXG4gICAgICAgICAgICAvL2VsLnRleHQoc2NvcGUucGFnZUNvbmZpZyk7XHJcbiAgICAgICAgICAgIHNjb3BlLmlzRGVsZXRlID0gZmFsc2U7XHJcbiAgICAgICAgICAgIHNjb3BlLmlzTmV3ID0gZmFsc2U7XHJcblxyXG4gICAgICAgICAgICBzY29wZS53aWRnZXREZWZpbml0aW9ucyA9IFtdO1xyXG4gICAgICAgICAgICBzY29wZS53aWRnZXRzID0gW107XHJcbiAgICAgICAgICAgIHNjb3BlLnVzZXJQcm9qZWN0ID0gW107XHJcblxyXG4gICAgICAgICAgICBzY29wZS5pc01vZHVsZUF2YWlsYWJsZSA9IGZhbHNlO1xyXG4gICAgICAgICAgICBzY29wZS5tb2R1bGVEYXRhID0gW1wiSGF6YXJkXCJdO1xyXG4gICAgICAgICAgICBzY29wZS5wcm9qZWN0RGF0YSA9IFt7IFwiUHJvamVjdElkXCI6IDAsIFwiUHJvamVjdE5hbWVcIjogXCJcIiB9XTtcclxuICAgICAgICAgICAgc2NvcGUucmVwb3J0RGF0YSA9IFt7IFwiUmVwb3J0Q29kZVwiOiBcIkhhemFyZFN1bW1hcnlcIiwgXCJSZXBvcnROYW1lXCI6IFwiSGF6YXJkIFN1bW1hcnlcIiB9XTtcclxuICAgICAgICAgICAgc2NvcGUubW9kdWxlSWQgPSBcIlwiO1xyXG4gICAgICAgICAgICBzY29wZS5wcm9qZWN0SWQgPSBcIlwiO1xyXG5cclxuICAgICAgICAgICAgdmFyIGF1dGhEYXRhID0gbG9jYWxTdG9yYWdlU2VydmljZS5nZXQoJ2F1dGhvcml6YXRpb25EYXRhJyk7XHJcbiAgICAgICAgICAgIGlmIChhdXRoRGF0YSAhPSB1bmRlZmluZWQgJiYgYXV0aERhdGEgIT09IG51bGwgJiYgYXV0aERhdGEudXNlcklkICE9PSBudWxsKSB7XHJcbiAgICAgICAgICAgICAgICBzY29wZS51c2VySWQgPSBhdXRoRGF0YS51c2VySWQ7XHJcbiAgICAgICAgICAgICAgICBzY29wZS51c2VyUmlnaHRzID0gYXV0aERhdGEudXNlclJpZ2h0cztcclxuICAgICAgICAgICAgfSBlbHNlIHsgLy9pZiAoIV9hdXRoZW50aWNhdGlvbi5pc0F1dGgpIHtcclxuICAgICAgICAgICAgICAgIC8qYXV0aFNlcnZpY2UuYXV0aGVudGljYXRpb24uaXNBdXRoID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICBhdXRoU2VydmljZS5sb2dPdXQoKTsqL1xyXG4gICAgICAgICAgICAgICAgJGxvY2F0aW9uLnBhdGgoJy9sb2dpbicpO1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBzY29wZS5maWx0ZXJTdGFydCA9IG1vbWVudCgpLnN0YXJ0T2YoJ3llYXInKTtcclxuICAgICAgICAgICAgc2NvcGUuZmlsdGVyRW5kID0gbW9tZW50KCk7XHJcblxyXG4gICAgICAgICAgICBzY29wZS53aWRnZXRNYWluQ29uZmlnID0gW1xyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIHRpdGxlOiAnRGFzaGJvYXJkIENvdW50JyxcclxuICAgICAgICAgICAgICAgICAgICBzZXR0aW5nczoge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBVc2VyV2lkZ2V0SWQ6IDAsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIE1vZHVsZUlkOiBzY29wZS5tb2R1bGVJZCxcclxuICAgICAgICAgICAgICAgICAgICAgICAgUHJvamVjdElkOiBzY29wZS5wcm9qZWN0SWQsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHdpZGdldElkOiBcIjFcIixcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmVwb3J0VHlwZTogLTEsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIEZpbHRlcklkOiBcIi0xXCIsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHNpemVYOiAxMixcclxuICAgICAgICAgICAgICAgICAgICAgICAgc2l6ZVk6IDEsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRpdGxlOiAnRGFzaGJvYXJkIENvdW50JyxcclxuICAgICAgICAgICAgICAgICAgICAgICAgc3ViVGl0bGU6IFwiXCIsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHdpZHRoOiB3aW5kb3cuc2NyZWVuLmF2YWlsV2lkdGgsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGhlaWdodDogd2luZG93LnNjcmVlbi5hdmFpbEhlaWdodCxcclxuICAgICAgICAgICAgICAgICAgICAgICAgZGF0YTogW10sXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRlbXBsYXRlOiAnPG5hdmNvbi1NeWNvdW50ID48L25hdmNvbi1NeWNvdW50PicsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbmZpZ05hbWU6IHNjb3BlLm1vZHVsZUlkLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAvL3JlcG9ydExpc3Q6IFtdLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBvcHRpb25zOiB7IGZpbHRlcjogZmFsc2UsIHJlcG9ydFNldHRpbmc6IGZhbHNlLCBjbG9zZTogZmFsc2UgfVxyXG4gICAgICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICAgICAgY29uZmlnTmFtZTogXCJkYXNoYm9hcmRDb3VudFwiXHJcbiAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIHRpdGxlOiAnSGF6YXJkIE1hbmFnZW1lbnQgU3VtbWFyeScsXHJcbiAgICAgICAgICAgICAgICAgICAgc2V0dGluZ3M6IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgVXNlcldpZGdldElkOiAwLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBNb2R1bGVJZDogc2NvcGUubW9kdWxlSWQsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIFByb2plY3RJZDogc2NvcGUucHJvamVjdElkLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICB3aWRnZXRJZDogXCIyXCIsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlcG9ydFR5cGU6IDEsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHNpemVYOiA3LFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBzaXplWTogNCxcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGl0bGU6ICcnLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBzdWJUaXRsZTogXCJKYW4gMjAxNiAtIFNlcCAyMDE2XCIsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHdpZHRoOiB3aW5kb3cuc2NyZWVuLmF2YWlsV2lkdGgsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGhlaWdodDogd2luZG93LnNjcmVlbi5hdmFpbEhlaWdodCxcclxuICAgICAgICAgICAgICAgICAgICAgICAgLy90ZW1wbGF0ZTogJzxuYXZjb24tbXlyaXNrbWF0cml4ID48L25hdmNvbi1teXJpc2ttYXRyaXg+JyxcclxuICAgICAgICAgICAgICAgICAgICAgICAgLy90ZW1wbGF0ZTogJzxuYXZjb24tY2hhcnQgPjwvbmF2Y29uLWNoYXJ0PicsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRlbXBsYXRlOiAnJyxcclxuICAgICAgICAgICAgICAgICAgICAgICAgY29uZmlnTmFtZTogc2NvcGUubW9kdWxlSWQsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vcG9wb3ZlclRlbXBsYXRlOiBcIjxzZWxlY3QgY2xhc3M9J2NvbC1tZC04IG1hcmdpbi1ib3R0b20tMTAnIG5nLW1vZGVsPSdzZWxlY3RlZFJlcG9ydCc+PG9wdGlvbiBuZy1zZWxlY3RlZD0nc2VsZWN0ZWRSZXBvcnQuaWQgPT0gaXRlbS5pZCcgbmctcmVwZWF0PSdpdGVtIGluIGl0ZW1zJz57e2l0ZW0udGl0bGV9fTwvb3B0aW9uPjwvc2VsZWN0PlwiLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAvL3BvcG92ZXJUZW1wbGF0ZTogXCI8c2VsZWN0IGNsYXNzPSdjb2wtbWQtOCBtYXJnaW4tYm90dG9tLTEwJyBzdHlsZT0nd2lkdGg6IDkwJTsnIG5nLW1vZGVsPSdzZWxlY3RlZFJlcG9ydCcgbmctb3B0aW9ucz0neC50aXRsZSBmb3IgeCBpbiBpdGVtcyc+PC9zZWxlY3Q+XCIsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHBvcG92ZXJUZW1wbGF0ZTogXCI8c2VsZWN0IGNsYXNzPSdjb2wtbWQtOCBtYXJnaW4tYm90dG9tLTEwJyBzdHlsZT0nd2lkdGg6IDkwJTsnIG5nLW1vZGVsPSdzZWxlY3RlZFJlcG9ydCc+PG9wdGlvbiBuZy1zZWxlY3RlZD0nc2VsZWN0ZWRSZXBvcnQuUmVwb3J0Q29kZSA9PSBpdGVtLlJlcG9ydENvZGUnIG5nLXJlcGVhdD0naXRlbSBpbiBpdGVtcycgdmFsdWU9e3tpdGVtfX0+e3tpdGVtLlJlcG9ydE5hbWV9fTwvb3B0aW9uPjwvc2VsZWN0PlwiLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXBvcnRMaXN0OiBzY29wZS5yZXBvcnREYXRhLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBGaWx0ZXJLZXk6IFwiUmVwb3J0Q29kZVwiLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBGaWx0ZXJJZDogXCJcIixcclxuICAgICAgICAgICAgICAgICAgICAgICAgZmlsdGVyU3RhcnQ6IHNjb3BlLmZpbHRlclN0YXJ0LFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBmaWx0ZXJFbmQ6IHNjb3BlLmZpbHRlckVuZCxcclxuICAgICAgICAgICAgICAgICAgICAgICAgb3B0aW9uczogeyBmaWx0ZXI6IHRydWUsIHJlcG9ydFNldHRpbmc6IHRydWUsIGNsb3NlOiBmYWxzZSB9XHJcbiAgICAgICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgICAgICBjb25maWdOYW1lOiBcIm15U2FwY2V0cmFpbmluZ3N1bW1hcnlcIlxyXG4gICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICB0aXRsZTogJ1Jpc2sgQ2xhc3MgU3VtbWFyeScsXHJcbiAgICAgICAgICAgICAgICAgICAgc2V0dGluZ3M6IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgVXNlcldpZGdldElkOiAwLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBNb2R1bGVJZDogc2NvcGUubW9kdWxlSWQsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIFByb2plY3RJZDogc2NvcGUucHJvamVjdElkLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICB3aWRnZXRJZDogXCIzXCIsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlcG9ydFR5cGU6IDIsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIEZpbHRlcklkOiBcIi0xXCIsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHNpemVYOiA1LFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBzaXplWTogNCxcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGl0bGU6ICdSaXNrIENsYXNzIFN1bW1hcnknLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBzdWJUaXRsZTogXCJKYW4gMjAxNiAtIFNlcCAyMDE2XCIsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vcmVwb3J0OiB7IFJlcG9ydE5hbWU6IFwiSGF6YXJkIE1hbmFnZW1lbnQgU3VtbWFyeVwiLCBzb3VyY2U6IFwiXCIsIFJlcG9ydERldGFpbElkOiBcIjM5XCIgfSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgd2lkdGg6IHdpbmRvdy5zY3JlZW4uYXZhaWxXaWR0aCxcclxuICAgICAgICAgICAgICAgICAgICAgICAgaGVpZ2h0OiB3aW5kb3cuc2NyZWVuLmF2YWlsSGVpZ2h0LFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAvL3RlbXBsYXRlOiAnPG5hdmNvbi1teXJlcG9ydCA+PC9uYXZjb24tbXlyZXBvcnQ+JyxcclxuICAgICAgICAgICAgICAgICAgICAgICAgLy93aWRnZXRJZDogXCIxMDAyXCIsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRlbXBsYXRlOiAnPG5hdmNvbi1jaGFydCA+PC9uYXZjb24tY2hhcnQ+JyxcclxuICAgICAgICAgICAgICAgICAgICAgICAgY29uZmlnTmFtZTogc2NvcGUubW9kdWxlSWQsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vcmVwb3J0TGlzdDogW10sXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG9wdGlvbnM6IHsgZmlsdGVyOiBmYWxzZSwgcmVwb3J0U2V0dGluZzogZmFsc2UsIGNsb3NlOiBmYWxzZSB9XHJcbiAgICAgICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgICAgICBjb25maWdOYW1lOiBcIm15U2FwY2VSaXNrQ2xhc3NTdW1tYXJ5XCIsXHJcbiAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIHRpdGxlOiAnU2FmZXR5IEJ1bGxldGluJyxcclxuICAgICAgICAgICAgICAgICAgICBzZXR0aW5nczoge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBVc2VyV2lkZ2V0SWQ6IDAsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIE1vZHVsZUlkOiBzY29wZS5tb2R1bGVJZCxcclxuICAgICAgICAgICAgICAgICAgICAgICAgUHJvamVjdElkOiBzY29wZS5wcm9qZWN0SWQsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHdpZGdldElkOiBcIjVcIixcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmVwb3J0VHlwZTogLTEsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIEZpbHRlcklkOiBcIi0xXCIsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHNpemVYOiAxMixcclxuICAgICAgICAgICAgICAgICAgICAgICAgc2l6ZVk6IDQsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRpdGxlOiAnU2FmZXR5IEJ1bGxldGluJyxcclxuICAgICAgICAgICAgICAgICAgICAgICAgZGF0YTogW10sXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHdpZHRoOiB3aW5kb3cuc2NyZWVuLmF2YWlsV2lkdGgsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGhlaWdodDogd2luZG93LnNjcmVlbi5hdmFpbEhlaWdodCxcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGVtcGxhdGU6ICc8bmF2Y29uLW15c3VtbWFyeSA+PC9uYXZjb24tbXlzdW1tYXJ5PicsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbmZpZ05hbWU6IHNjb3BlLm1vZHVsZUlkLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAvL3JlcG9ydExpc3Q6IFtdLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBvcHRpb25zOiB7IGZpbHRlcjogZmFsc2UsIHJlcG9ydFNldHRpbmc6IGZhbHNlLCBjbG9zZTogZmFsc2UgfVxyXG4gICAgICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICAgICAgY29uZmlnTmFtZTogXCJOZXdzQW5ub3VuY2VtZW50c1wiXHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIF07XHJcblxyXG4gICAgICAgICAgICBzY29wZS53aWRnZXRDb25maWcgPSBbXTtcclxuXHJcbiAgICAgICAgICAgIHNjb3BlLmdyaWRzdGVyT3B0cyA9IHtcclxuICAgICAgICAgICAgICAgIGNvbHVtbnM6IDEyLFxyXG4gICAgICAgICAgICAgICAgbWFyZ2luczogWzEwLCAxMF0sXHJcbiAgICAgICAgICAgICAgICByb3dIZWlnaHQ6ICdtYXRjaCcsXHJcbiAgICAgICAgICAgICAgICBvdXRlck1hcmdpbjogZmFsc2UsXHJcbiAgICAgICAgICAgICAgICBwdXNoaW5nOiB0cnVlLFxyXG4gICAgICAgICAgICAgICAgZmxvYXRpbmc6IGZhbHNlLFxyXG4gICAgICAgICAgICAgICAgc3dhcHBpbmc6IGZhbHNlLFxyXG4gICAgICAgICAgICAgICAgLyptYXhTaXplWDogNiwgLy8gbWF4aW11bSBjb2x1bW4gd2lkdGggb2YgYW4gaXRlbVxyXG4gICAgICAgICAgICAgICAgbWF4U2l6ZVk6IDQsIC8vIG1heGltdW0gcm93IGhlaWdodCBvZiBhbiBpdGVtKi9cclxuICAgICAgICAgICAgICAgIGRyYWdnYWJsZToge1xyXG4gICAgICAgICAgICAgICAgICAgIGVuYWJsZWQ6IGZhbHNlLFxyXG4gICAgICAgICAgICAgICAgICAgIGRyYWc6IGZ1bmN0aW9uIChldmVudCwgdWkpIHtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgICAgICBzdG9wOiBmdW5jdGlvbiAoZXZlbnQsIHVpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICghc2NvcGUuaXNEZWxldGUpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNjb3BlLnNhdmVXaWRnZXQoKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICBzY29wZS5pc0RlbGV0ZSA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICBzZXJpYWxpemVfcGFyYW1zOiBmdW5jdGlvbiAoJHcsIHdnZCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCd3aWRnZXQnICsgd2dkKTtcclxuICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICByZXNpemFibGU6IHtcclxuICAgICAgICAgICAgICAgICAgICBlbmFibGVkOiBmYWxzZSxcclxuICAgICAgICAgICAgICAgICAgICBoYW5kbGVzOiBbJ24nLCAnZScsICdzJywgJ3cnLCAnbmUnLCAnc2UnLCAnc3cnLCAnbncnXSxcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgLy8gb3B0aW9uYWwgY2FsbGJhY2sgZmlyZWQgd2hlbiByZXNpemUgaXMgc3RhcnRlZFxyXG4gICAgICAgICAgICAgICAgICAgIHN0YXJ0OiBmdW5jdGlvbiAoZXZlbnQsICRlbGVtZW50LCB3aWRnZXQpIHsgfSxcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgLy8gb3B0aW9uYWwgY2FsbGJhY2sgZmlyZWQgd2hlbiBpdGVtIGlzIHJlc2l6ZWQsXHJcbiAgICAgICAgICAgICAgICAgICAgcmVzaXplOiBmdW5jdGlvbiAoZXZlbnQsICRlbGVtZW50LCB3aWRnZXQpIHtcclxuICAgICAgICAgICAgICAgICAgICB9LFxyXG5cclxuICAgICAgICAgICAgICAgICAgICAvLyBvcHRpb25hbCBjYWxsYmFjayBmaXJlZCB3aGVuIGl0ZW0gaXMgZmluaXNoZWQgcmVzaXppbmcgXHJcbiAgICAgICAgICAgICAgICAgICAgc3RvcDogZnVuY3Rpb24gKGV2ZW50LCAkZWxlbWVudCwgd2lkZ2V0KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vJCgkZWxlbWVudCkuY3NzKFwiaGVpZ2h0XCIsXCJhdXRvXCIpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBzY29wZS5yZXNpemUoJCgkZWxlbWVudCkud2lkdGgoKSwgJCgkZWxlbWVudCkuaGVpZ2h0KCksIHdpZGdldC53aWRnZXRJZCwgJCgkZWxlbWVudCkpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGZvdW5kID0gbmF2Y29uLmdldEl0ZW1JbmRleEJ5S2V5VmFsdWUoc2NvcGUud2lkZ2V0cywgXCJ3aWRnZXRJZFwiLCB3aWRnZXQud2lkZ2V0SWQpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChmb3VuZCAhPT0gLTEpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNjb3BlLndpZGdldHNbZm91bmRdLndpZHRoID0gJCgkZWxlbWVudCkud2lkdGgoKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNjb3BlLndpZGdldHNbZm91bmRdLmhlaWdodCA9ICQoJGVsZW1lbnQpLmhlaWdodCgpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICBzY29wZS5zYXZlV2lkZ2V0KCk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgfTtcclxuXHJcbiAgICAgICAgICAgIGZ1bmN0aW9uIGdldFNlcnZlckRhdGEodHlwZSwgcm93SWQpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBkYXRhc2VydmljZS5nZXRTZXJ2ZXJEYXRhKHR5cGUsIHJvd0lkKS50aGVuKGZ1bmN0aW9uIChkYXRhKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGRhdGE7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfTtcclxuXHJcbiAgICAgICAgICAgIHNjb3BlLm15c3BhY2VEYXRhID0gW107XHJcbiAgICAgICAgICAgIHNjb3BlLmxvYWREYXRhID0gZmFsc2U7XHJcbiAgICAgICAgICAgIGZ1bmN0aW9uIGxvYWRBbGxEYXRhKHByb2plY3QsIG1vZHVsZSwgc3RhcnREYXRlLCBlbmREYXRlLCBjYWxsYmFjaykge1xyXG4gICAgICAgICAgICAgICAgZ2V0U2VydmVyRGF0YShcIm15c3BhY2VMb2FkQWxsUmVwb3J0XCIsIHByb2plY3QgKyBcIi9cIiArIG1vZHVsZSkudGhlbihmdW5jdGlvbiAoZGF0YSkge1xyXG5cclxuICAgICAgICAgICAgICAgICAgICB2YXIgbW9kdWxlRGF0YSA9IGFuZ3VsYXIuY29weShzY29wZS5tb2R1bGVEYXRhWzBdKTtcclxuICAgICAgICAgICAgICAgICAgICBzY29wZS5sb2FkRGF0YSA9IHRydWU7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGlmIChkYXRhICE9PSB1bmRlZmluZWQgJiYgZGF0YSAhPT0gbnVsbCAmJiBkYXRhLmxlbmd0aCAhPSAwKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vc2NvcGUuaXNOZXcgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgLy9zY29wZS5teXNwYWNlRGF0YSA9IGRhdGE7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAvL215cHJvZmlsZVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB0cnkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHVzZXJJbWFnZSA9IFwiLzlqLzRBQVFTa1pKUmdBQkFRQUFBUUFCQUFELzJ3Q0VBQWtHQmhBUUVSVVFFQkFWRlJBVUVob1lFQkVTRHhRU0VoVVNGUmdWSUJZVUVoY1lIQ2NmRnhzdkd4SVhIeThnSXljcUxEZ3RGUjR5TlRBcU5TWXJMQ29CQ1FvS0JRVUZEUVVGRFNrWUVoZ3BLU2twS1NrcEtTa3BLU2twS1NrcEtTa3BLU2twS1NrcEtTa3BLU2twS1NrcEtTa3BLU2twS1NrcEtTa3BLU2twS2YvQUFCRUlBTHdBa0FNQklnQUNFUUVERVFIL3hBQWJBQUVBQWdNQkFRQUFBQUFBQUFBQUFBQUFBZ1VCQkFZREIvL0VBRU1RQUFJQ0FRRURDQWNEQ2dRSEFBQUFBQUVDQUFNUkJCSWhNUVVHTWtGUllYR0JFeUlqUWxLUm9UTmlnaFJEY25PaXNiTEIwZkEwZEpMU0pGTmpvN1BDdy8vRUFCUUJBUUFBQUFBQUFBQUFBQUFBQUFBQUFBRC94QUFVRVFFQUFBQUFBQUFBQUFBQUFBQUFBQUFBLzlvQURBTUJBQUlSQXhFQVB3RDdobU16RVFNNWpNeEVET1l6TVJBem1NelE1VTVicDB3SHBXOVp1aFdxbDdIeHgyVUc4K1BDVnA1MlAxYUs0cjJsNkZieVUyZnZnZERtTXlnSE80ZTlwTlFQQkszL0FJWE1tdlBIUys5NlZQMDlOY0I1a0tSQXZNeG1WbW01eTZPdzRUVTFGdmg5S29iL0FFa2d5eWdaekdaaUlHY3htWWlCbk1abUlnWXpHWkhNWmdTekdaSE1aZ1N6S2psdmw4VSt5cUFzMVREMWE4K3FnUDV5NGpvcDlUd0hhTlhsemxweTUwMm1iRmcrM3V4a1VxUnVDamcxcEhBY0FONTZnZEhTYU5LZ1FnNG5Mc1NXZDI2MmRqdlk5NWdSMHVqMlMxanNYdWY3UzF1azNZb0h1b09wUnVIanZteEVqZGNxS1hZZ0tveXpFNEFBNGt3SlRNMXRCcmx1VGJVTVBXSUt1TmwxSVBCbE85VGpCd2UwVFlnUXUwNk9NT3FzT3hsREQ1R2VlaTE3YUVqSkxhSTdtVWtzMm4rK2hPODFkcSs3eEc3SW5yWmFxOUlnZUpBL2ZQQ3ZsS2gyOUd0MWJNUjBGdFJpUjE3Z1lIWWhnZDQ0ZFJtY3ptZWJXczlDL3dDUnNmVXdXMGhKejdNZEtuOE9RUjkwajRaMG1ZRXN4bVJ6R1lFc3htUnpHWUdNeG1SekdZRXN5cDV3Y3J0U3ExMDRPcHR5S2dSa0lvNlZyajRWeU4zV1NCMXkwek9WYjF0VnFYUEVPdGE5eUlpbkE3QnRPeDhUQWFQU0xVdXlDVHZKWm1PV2R6dlozUFdTZDg5b2lBa2VSdVQvQU1zY1hQOEE0V3R2WXIxWFdLZnRXN2F3UjZvNnlOcmdCUERsUFR0WlRaV3B3elZzcW52SU9QNzc1MUhJMnJTMmlxeXNCVWF0U3FnWUNqQTlUSFZqaGp1Z2ErdTVzNmU1ellWWmJHNlQxV1BXV3h3MnRrNFk5NW5nT1p1bDk3MHI5ejZtNGp6QWJmTHlJRlhWelcwUzhOSlRudE5LTTN6SUpucnIrUkticWpTVUNyeFVvQXJJNDZMb1FOekR0L3JOK0lIejdWWFdWZ213ZjhUbzdGc2JaR050QnhkQjJOVnRqSGJrZFU3bExBd0RLY3FSa0VjQ0R3SWxIenMwd1ZxZFNCdkRpbTNzYXEzaG50dyt5UjR0MnoyNXFPZnlTb0gzQTFmbFU3SVBvZ2dYR1l6STVqTUNXWXpJNWpNQ09Zekk1ak1DV1p5K01hblZEL3JLM2s5VlpIOC9sT216T1Y1VTFDMDZxNW16NjFkTEtxakxPeEwxaFZIV2RwUVBNUU5xSjVXVTZ4VjIyMG5xOWFwZXIyZ2ZvWXdUM0JqM1ptZE5xVnNVT2h5cDRIOTRJTzhISXhnd1BRbnJtN3pMWW5Uc1FENkkzMkdna0ViVlRITzB1ZmQybWJIZGlWT3BvRjFsT21QUXRjK2xBNjZxMUxNdmdUc3FlNWpPMFZRQmdEQUhBRGhpQm1JaUFpSWdVM1BEVFdXYUs1YWhtMEtIckFHVHQxc0dHQjE3MTRTWEl0VmFhZXBhVzI2aFdOaHg3NE84djRra2s5NWxucWJ4V2pPM1JWU3plQ2pKK2dsTnpmcVpkTlh0RERNRFl3SEFOY3pPVkhoNlRIbEFzOHhtUnpHWUVzeG1SekdZRWN4bVF6R1lFOHlsNVQwUWZYYUt3OEZOd0k2aTJ3R1RQZ2EySWx2bVVuTzViUFFwWlUyelpWcUttUmlNZ1piWU8wUGg5cGc5eE1Eckp5SExHa2ZTMldYN0FiUzJPck9WT0dxZHNLek1wNlNrNFlrYnhsdDNYT2g1RzVUR3BwVzBEWkp5SFRPU2xpa2gwSjdtQkUxdWQzK0MxSDZsdjNRS3JrcmZyMHoxYVcwanhObW5CK2s2eWNqb1gyZGJTZmlydVQ1K2liLzV6cm9DSWlBaUlnZU90MHdzcmVzOEhSbEo3bUJIODVVOGg2Z3ZwcVdQUzlFb2Nkam9ObHgvcVV5OG5QOEFJZjJUZjVpLy93QTFrQ3l6R1pETVpnVHpHWkRNWmdSekdaSE1aZ1N6UERYNlFYVlBTeHdMRUtrOVl5TnpEdkJ3ZktldVl6QTVma2ZsU3pUazM3SktFN092cFhlVXVUYzkxWTYrRzlldGRramVOL2F1bFdvcXdjUFRZbmlySXcrb0lNNWJscWowTC9sYTlEQUdxVWZBT2plTzllRGRxL296ZDVvMzdCdDB2dVY3TmxINnEwdjZvN2c2T0IzRllGam8rYldscGNXVjBxcnJuWllaSkdSZzR5ZXlXY1JBUkVRRVJFRHkxV29XdEdzWTRWRkxNZnVxQ1Q5QktQa09zcnA2ZzI1eW0yNCsvYVM3RDV1UjVUYTUxa25TV0lQem16VjVYT3FINk9aSmp2OEFPQkxNWmtjeG1CTE1aa2N4bUJITVprTXhtQlBNWmtNeG1CUCs5L0R6bE55VHljZExyYTlsczBXVldWMW9SNjFaR3k2cHRlOG9DdnM1M2dFamZ1bHRtVnZLZXVWTDlHaDZiNnIxY0Rnb3JkV1k5Z3pZcStMUU9zaUlnSWlJQ0lpQlQ4NVRrVXA4ZXFyK1NaYy9TdVp6S1hsdm5McHhyMHFkOWxhVWJMbjdNYWkwS0ZWendVaXN0dk83Mmc0UzN6L2ZkQW5tTXlHWXpBbm1NeUdZekFqbU15T1l6QWxtTXlJMzhKUzhvYzdOUFZsVUp1c0h1MUVGUWZ2MmRFZVdUM1FMbTY5VVV1N0JVVVpaMk9GVWRwTTVLalVMcld0dllNcTdZcm8zbFhWS2prT0NONnNYSmI1RHFsWHlseW5icVdCdUlDS2NwU21mUnFmaU9kN3QzbnlBbG56YUhzUEd5dy90bitrQys1TzUwV1VZVFY1ZXJxMVNyNnkvNWhCL0d1N3RBNHpyS3JsZFF5TUdVaktzcEJCQjRFRWNST0pubHBHdDB6RjlLUUZKeStuWWtVdWVzcmo3SnU4YnUwR0IzMFNrMFhQRFN1dnRMRm9zSFRxdmRLMkI3c25Eajd5a2lhUExYT25iOWpvckZaeVBhYWhHVjBxVS9DUmtOWWVvZFhFOVFJZS9MZk9aa2YwR21DdGFQdFhmSnFxSFVyQlNDem40UVJnYnlSdXpUMzZuVjJmYWF0d3ZXdEtMU1BudmY5cWVlbjA2MXFGWGgyazVKSjRzeE84a25lU2UyZXNEbGVWZEVsVit5aWdLOVFKSGF5c1F4T2VKSVpjazc1TGs3bE8vVGJxYk1KL3lYRzNWNURPVS9DUk5qbkg5clQrcnQvZlRLK0IwMm01OEQ4OXAzWDcxVHJhdnliWllmV1dlbTUwYU96Y05RcW40YmMwbi91QUQ2emhvSXp4Z2ZUUWNqSTNnOENONFBnZUJqTStZVTErak9heTFaN2FuYW8rZXlSbnpsalJ6aDFpY0w5c2RsMWF2OVJzdDlZSGN1NEFMRWdLQmxtWWhWQTdXSjNBZU1vTmR6eXFYZFFwdWI0c2xLUitNakxmaEI4Uk9ZMWQ5bDUycjdEWVFjZ05nVnFmdVZqMVI0NHozeU1EMzEvS1YrbzNYV1pRL21rR3hWNEVaeS80aVpycW9HNERBNmdOd21ZZ0pkODJUN0RIWmJZUDJqL1dVa3RlYkQ3clU3TGRyeWRWL21EOG9GM0VSQWl5QThRRDRqTXlxZ2NCandtWWdJaUlIUGM0VDdlc2RsVC9WNi84QWJOQ2JmTHB6cWZDaGZtejJmN1pxUUVSRUJFUkFSRVFFUkVCTnJrTzNaMUdPcXlzajhWWnlQMldmNVRWa0xiQ216YU9OYkJ3TzBEcER6VWtRT3ppUnJzREFNcHlDQVFlMEhnZmxKUUVSRUJFUkE1YmxWczZtenVXdGYyYy8rODhKaHJkdDdMT3ByV3g0TDZvL2htWUNJaUFpSWdJaUlDSWlBaUlnVzNOclZlcTFCNDFIMU8rcHM3UHlPVjhoTHFjY21vTkxyY1BjM09CMTFOMGg1WURmaG5ZSTRJQkJ5Q01namdRZUJFRE1SRUJOVGxYV2VocGV3ZElMNm5lNTNLUG1STnVjL3dBNDlUdE9sSTRMN1N6eDNpc0h6Mm0vQ0lGWlJWc3FGN0FCOHV1VGlJQ0lpQWlJZ0lpSUNJaUFpSWdKWmMyOVpzNTB6ZTZDMVBmWDFwK0VuNUVka3JaNDZ1MG92cFYzUFg2eUh2SFVlNGdrSHhnZHRFd0RNd1BQVWFoYTBaM09GVUVzZTRUa0VkbkxXUDA3RzJtSHdqM1Y4bEFIemx0em90UHNxL2NkeVhIYnNES2c5MmNIeUVySUNJaUFpSWdJaUlILzJRPT1cIjtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChkYXRhLm15UHJvZmlsZUdldEJ5SWQgIT09IHVuZGVmaW5lZCAmJiBkYXRhLm15UHJvZmlsZUdldEJ5SWQgIT09IG51bGwgJiYgZGF0YS5teVByb2ZpbGVHZXRCeUlkLmxlbmd0aCAhPT0gMCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChkYXRhLm15UHJvZmlsZUdldEJ5SWQuaW1nICE9PSB1bmRlZmluZWQgJiYgZGF0YS5teVByb2ZpbGVHZXRCeUlkLmltZyAhPT0gbnVsbCAmJiBkYXRhLm15UHJvZmlsZUdldEJ5SWQuaW1nICE9PSBcIlwiKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1c2VySW1hZ2UgPSBkYXRhLm15UHJvZmlsZUdldEJ5SWQuaW1nO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJHJvb3RTY29wZS51c2VyUHJvZmlsZUltYWdlID0gdXNlckltYWdlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9IGNhdGNoIChlKSB7IH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vTW9kdWxlXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChkYXRhLk15U3BhY2VSZXBvcnRMaXN0ICE9PSB1bmRlZmluZWQgJiYgZGF0YS5NeVNwYWNlUmVwb3J0TGlzdCAhPT0gbnVsbCAmJiBkYXRhLk15U3BhY2VSZXBvcnRMaXN0Lmxlbmd0aCAhPT0gMCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKG1vZHVsZS50b1N0cmluZygpID09PSBcIjBcIikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChkYXRhLk15U3BhY2VSZXBvcnRMaXN0Lk1vZHVsZXMubGVuZ3RoICE9PSAwKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNjb3BlLmlzTW9kdWxlQXZhaWxhYmxlID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2NvcGUubW9kdWxlRGF0YSA9IGRhdGEuTXlTcGFjZVJlcG9ydExpc3QuTW9kdWxlcztcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbW9kdWxlRGF0YSA9IGFuZ3VsYXIuY29weShzY29wZS5tb2R1bGVEYXRhWzBdKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2NvcGUud2lkZ2V0Q29uZmlnID0gYW5ndWxhci5jb3B5KHNjb3BlLndpZGdldE1haW5Db25maWcpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNjb3BlLmlzTW9kdWxlQXZhaWxhYmxlID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNjb3BlLndpZGdldENvbmZpZyA9IGFuZ3VsYXIuY29weShzY29wZS53aWRnZXRNYWluQ29uZmlnKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2NvcGUud2lkZ2V0Q29uZmlnLnNwbGljZSgwLCAzKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1vZHVsZURhdGEgPSBtb2R1bGU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc2NvcGUucHJvamVjdERhdGEgPSBkYXRhLk15U3BhY2VSZXBvcnRMaXN0LlByb2plY3RzO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChtb2R1bGUudG9TdHJpbmcoKSA9PT0gXCIwXCIgJiYgZGF0YS5NeVNwYWNlUmVwb3J0TGlzdC5EZWZhdWx0TW9kdWxlICE9PSB1bmRlZmluZWQgJiYgZGF0YS5NeVNwYWNlUmVwb3J0TGlzdC5EZWZhdWx0TW9kdWxlICE9PSBudWxsICYmXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGF0YS5NeVNwYWNlUmVwb3J0TGlzdC5EZWZhdWx0TW9kdWxlICE9PSAwICYmIGRhdGEuTXlTcGFjZVJlcG9ydExpc3QuRGVmYXVsdE1vZHVsZS5sZW5ndGggIT09IDApXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbW9kdWxlRGF0YSA9IGRhdGEuTXlTcGFjZVJlcG9ydExpc3QuRGVmYXVsdE1vZHVsZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgc2NvcGUudXNlck1vZHVsZSA9IG1vZHVsZURhdGE7XHJcbiAgICAgICAgICAgICAgICAgICAgc2NvcGUubW9kdWxlSWQgPSBtb2R1bGVEYXRhO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAvL1Byb2plY3RcclxuICAgICAgICAgICAgICAgICAgICBpZiAocHJvamVjdCAhPT0gdW5kZWZpbmVkICYmIHByb2plY3QgIT09IG51bGwgJiYgcHJvamVjdC50b1N0cmluZygpID09PSBcIjBcIiAmJiBzY29wZS5wcm9qZWN0RGF0YSAhPT0gdW5kZWZpbmVkICYmIHNjb3BlLnByb2plY3REYXRhICE9PSBudWxsICYmIHNjb3BlLnByb2plY3REYXRhLmxlbmd0aCAhPT0gMCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBzY29wZS5wcm9qZWN0SWQgPSBzY29wZS5wcm9qZWN0RGF0YVswXS5Qcm9qZWN0SWQ7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICAgICBpZiAocHJvamVjdCAhPT0gdW5kZWZpbmVkICYmIHByb2plY3QgIT09IG51bGwgJiYgcHJvamVjdC50b1N0cmluZygpID09PSBcIjBcIiAmJiBkYXRhICE9PSB1bmRlZmluZWQgJiYgZGF0YS5NeVNwYWNlUHJvamVjdExpc3QuRGVmYXVsdFByb2plY3QgIT09IHVuZGVmaW5lZCAmJiBkYXRhLk15U3BhY2VQcm9qZWN0TGlzdC5EZWZhdWx0UHJvamVjdCAhPT0gbnVsbCAmJlxyXG4gICAgICAgICAgICAgICAgICAgICAgICBkYXRhLk15U3BhY2VQcm9qZWN0TGlzdC5EZWZhdWx0UHJvamVjdCAhPT0gMCAmJiBkYXRhLk15U3BhY2VQcm9qZWN0TGlzdC5EZWZhdWx0UHJvamVjdCAhPT0gXCJcIikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBzY29wZS5wcm9qZWN0SWQgPSBkYXRhLk15U3BhY2VQcm9qZWN0TGlzdC5EZWZhdWx0UHJvamVjdDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcHJvamVjdCA9IGRhdGEuTXlTcGFjZVByb2plY3RMaXN0LkRlZmF1bHRQcm9qZWN0O1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHByb2plY3QgIT09IHVuZGVmaW5lZCAmJiBwcm9qZWN0ICE9PSBudWxsICYmIHByb2plY3QudG9TdHJpbmcoKSAhPT0gXCIwXCIpIHsvL3Njb3BlLnByb2plY3RJZCAhPT0gMCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgaXRlbUxpc3QgPSBuYXZjb24uZ2V0SXRlbUJ5S2V5VmFsdWUoc2NvcGUucHJvamVjdERhdGEsIFwiUHJvamVjdElkXCIsIHByb2plY3QpOy8vIHNjb3BlLnByb2plY3RJZCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChpdGVtTGlzdCAhPT0gdW5kZWZpbmVkICYmIGl0ZW1MaXN0ICE9PSBudWxsICYmIGl0ZW1MaXN0ICE9PSAtMSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNjb3BlLnVzZXJQcm9qZWN0ID0gaXRlbUxpc3Q7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2VcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNjb3BlLnVzZXJQcm9qZWN0ID0gc2NvcGUucHJvamVjdERhdGFbMF07XHJcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgc2NvcGUudXNlclByb2plY3QgPSBzY29wZS5wcm9qZWN0RGF0YVswXTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIC8vTG9hZCBDaGFydFxyXG4gICAgICAgICAgICAgICAgICAgIGlmIChkYXRhICE9PSB1bmRlZmluZWQgJiYgZGF0YSAhPT0gbnVsbCAmJiBkYXRhLk15U3BhY2VSZXBvcnRMaXN0QnlNb2R1bGUgIT09IHVuZGVmaW5lZCAmJiBkYXRhLk15U3BhY2VSZXBvcnRMaXN0QnlNb2R1bGUgIT09IG51bGwgJiYgZGF0YS5NeVNwYWNlUmVwb3J0TGlzdEJ5TW9kdWxlLmxlbmd0aCAhPT0gMCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBzY29wZS5yZXBvcnREYXRhID0gbmF2Y29uLmdldEl0ZW1zRmlsdGVyQnlLZXlWYWx1ZShkYXRhLk15U3BhY2VSZXBvcnRMaXN0QnlNb2R1bGUsIFwiUmVwb3J0VHlwZVwiLCBzY29wZS5tb2R1bGVJZCk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoZGF0YS5NeVNwYWNlUHJvamVjdExpc3QgIT09IHVuZGVmaW5lZCAmJiBkYXRhLk15U3BhY2VQcm9qZWN0TGlzdCAhPT0gbnVsbCAmJiBkYXRhLk15U3BhY2VQcm9qZWN0TGlzdC5sZW5ndGggIT0gMCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGRhdGEuTXlTcGFjZVByb2plY3RMaXN0LldpZGdldHMgIT09IG51bGwgJiYgZGF0YS5NeVNwYWNlUHJvamVjdExpc3QuV2lkZ2V0cy5sZW5ndGggIT09IDApIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzY29wZS5pc05ldyA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNjb3BlLndpZGdldERhdGEgPSBkYXRhLk15U3BhY2VQcm9qZWN0TGlzdC5XaWRnZXRzO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkLm1hcChkYXRhLk15U3BhY2VQcm9qZWN0TGlzdC5XaWRnZXRzLCBmdW5jdGlvbiAoaXRlbSwgaW5kZXgpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHdpZGdldEluZGV4ID0gLTE7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkLmdyZXAoc2NvcGUud2lkZ2V0Q29uZmlnLCBmdW5jdGlvbiAoZSwgaSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGUuc2V0dGluZ3Mud2lkZ2V0SWQgIT09IHVuZGVmaW5lZCAmJiBlLnNldHRpbmdzLndpZGdldElkICE9PSBudWxsICYmIGl0ZW0ud2lkZ2V0SWQgIT09IHVuZGVmaW5lZCAmJiBpdGVtLndpZGdldElkICE9PSBudWxsKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGUuc2V0dGluZ3Mud2lkZ2V0SWQudG9TdHJpbmcoKSA9PT0gaXRlbS53aWRnZXRJZC50b1N0cmluZygpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdpZGdldEluZGV4ID0gaTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAod2lkZ2V0SW5kZXggIT09IHVuZGVmaW5lZCAmJiB3aWRnZXRJbmRleCAhPT0gLTEgJiYgd2lkZ2V0SW5kZXgubGVuZ3RoICE9PSAwKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzY29wZS53aWRnZXRDb25maWdbd2lkZ2V0SW5kZXhdLnNldHRpbmdzLlVzZXJXaWRnZXRJZCA9IGl0ZW0uVXNlcldpZGdldElkO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGl0ZW0udGVtcGxhdGUgIT09IHVuZGVmaW5lZCAmJiBpdGVtLnRlbXBsYXRlICE9PSBudWxsKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2NvcGUud2lkZ2V0Q29uZmlnW3dpZGdldEluZGV4XS5zZXR0aW5ncy50ZW1wbGF0ZSA9IGl0ZW0udGVtcGxhdGU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2NvcGUud2lkZ2V0Q29uZmlnW3dpZGdldEluZGV4XS5zZXR0aW5ncy50aXRsZSA9IGl0ZW0udGl0bGU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGl0ZW0uRmlsdGVySWQgIT09IHVuZGVmaW5lZCAmJiBpdGVtLkZpbHRlcklkICE9PSBudWxsICYmIHNjb3BlLndpZGdldENvbmZpZ1t3aWRnZXRJbmRleF0uc2V0dGluZ3MuRmlsdGVySWQgIT09IC0xKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNjb3BlLndpZGdldENvbmZpZ1t3aWRnZXRJbmRleF0uc2V0dGluZ3MuRmlsdGVySWQgPSBpdGVtLkZpbHRlcklkO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNjb3BlLndpZGdldENvbmZpZ1t3aWRnZXRJbmRleF0uc2V0dGluZ3MuTW9kdWxlSWQgPSBzY29wZS5tb2R1bGVJZDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vc2NvcGUud2lkZ2V0Q29uZmlnW3dpZGdldEluZGV4XS5zZXR0aW5ncy5Nb2R1bGVJZCA9IG1vZHVsZURhdGE7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy9zY29wZS53aWRnZXRDb25maWdbd2lkZ2V0SW5kZXhdLnNldHRpbmdzLmNvbmZpZ05hbWUgPSBzY29wZS5tb2R1bGVJZDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNjb3BlLndpZGdldENvbmZpZ1t3aWRnZXRJbmRleF0uc2V0dGluZ3MuY29uZmlnTmFtZSA9IHNjb3BlLndpZGdldENvbmZpZ1t3aWRnZXRJbmRleF0uY29uZmlnTmFtZTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoc2NvcGUucHJvamVjdElkICE9PSAwKSBzY29wZS53aWRnZXRDb25maWdbd2lkZ2V0SW5kZXhdLnNldHRpbmdzLlByb2plY3RJZCA9IGFuZ3VsYXIuY29weShzY29wZS5wcm9qZWN0SWQpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy9pZiAocHJvamVjdC50b1N0cmluZygpICE9PSBcIjBcIikgc2NvcGUud2lkZ2V0Q29uZmlnW3dpZGdldEluZGV4XS5zZXR0aW5ncy5Qcm9qZWN0SWQgPSBhbmd1bGFyLmNvcHkocHJvamVjdCk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHNjb3BlLndpZGdldENvbmZpZ1t3aWRnZXRJbmRleF0uc2V0dGluZ3MucmVwb3J0TGlzdCAhPT0gdW5kZWZpbmVkICYmIHNjb3BlLndpZGdldENvbmZpZ1t3aWRnZXRJbmRleF0uc2V0dGluZ3MucmVwb3J0TGlzdCAhPT0gbnVsbFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICYmIHNjb3BlLndpZGdldENvbmZpZ1t3aWRnZXRJbmRleF0uc2V0dGluZ3MucmVwb3J0TGlzdCAhPT0gXCJcIiAmJiBzY29wZS53aWRnZXRDb25maWdbd2lkZ2V0SW5kZXhdLnNldHRpbmdzLnJlcG9ydExpc3QubGVuZ3RoICE9PSAwKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNjb3BlLndpZGdldENvbmZpZ1t3aWRnZXRJbmRleF0uc2V0dGluZ3MucmVwb3J0TGlzdCA9IHNjb3BlLnJlcG9ydERhdGE7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHNjb3BlLndpZGdldENvbmZpZ1t3aWRnZXRJbmRleF0uY29uZmlnTmFtZSA9PT0gXCJkYXNoYm9hcmRDb3VudFwiKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGRhdGEuTXlTcGFjZVJlcG9ydENvdW50LkNhdXNlc0lubmVyTGlzdCAhPT0gdW5kZWZpbmVkICYmIGRhdGEuTXlTcGFjZVJlcG9ydENvdW50LkNhdXNlc0lubmVyTGlzdC5sZW5ndGggIT09IDApXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNjb3BlLndpZGdldENvbmZpZ1t3aWRnZXRJbmRleF0uc2V0dGluZ3MuZGF0YSA9IGRhdGEuTXlTcGFjZVJlcG9ydENvdW50LkNhdXNlc0lubmVyTGlzdDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoc2NvcGUud2lkZ2V0Q29uZmlnW3dpZGdldEluZGV4XS5jb25maWdOYW1lID09PSBcIk5ld3NBbm5vdW5jZW1lbnRzXCIpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoZGF0YS5OZXdzQW5ub3VuY2VtZW50c0VmZmVjdGl2ZSAhPT0gdW5kZWZpbmVkICYmIGRhdGEuTmV3c0Fubm91bmNlbWVudHNFZmZlY3RpdmUubGVuZ3RoICE9PSAwKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzY29wZS53aWRnZXRDb25maWdbd2lkZ2V0SW5kZXhdLnNldHRpbmdzLmRhdGEgPSBkYXRhLk5ld3NBbm5vdW5jZW1lbnRzRWZmZWN0aXZlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChzY29wZS53aWRnZXRDb25maWdbd2lkZ2V0SW5kZXhdLmNvbmZpZ05hbWUgPT09IFwibXlTYXBjZXRyYWluaW5nc3VtbWFyeVwiKSB7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChkYXRhLk15U3BhY2VTdW1tYXJ5UmVwb3J0ICE9PSB1bmRlZmluZWQgJiYgZGF0YS5NeVNwYWNlU3VtbWFyeVJlcG9ydC5sZW5ndGggIT09IDApIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2NvcGUud2lkZ2V0Q29uZmlnW3dpZGdldEluZGV4XS5zZXR0aW5ncy5kYXRhID0gZGF0YS5NeVNwYWNlU3VtbWFyeVJlcG9ydC5kYXRhO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzY29wZS53aWRnZXRDb25maWdbd2lkZ2V0SW5kZXhdLnNldHRpbmdzLmRhdGEgPSBcIlwiO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvL2lmIChzY29wZS53aWRnZXRDb25maWdbd2lkZ2V0SW5kZXhdLnNldHRpbmdzLnRlbXBsYXRlID09PSBcIlwiKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHNjb3BlLm1vZHVsZUlkLnRvTG93ZXJDYXNlKCkgPT09IFwiaGF6YXJkXCIgJiYgKHNjb3BlLndpZGdldENvbmZpZ1t3aWRnZXRJbmRleF0uc2V0dGluZ3MuRmlsdGVySWQgPT09IFwiXCIgfHwgc2NvcGUud2lkZ2V0Q29uZmlnW3dpZGdldEluZGV4XS5zZXR0aW5ncy5GaWx0ZXJJZC50b1N0cmluZygpLnRvTG93ZXJDYXNlKCkuaW5kZXhPZihcInNvcnRcIikgPiAtMSkpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2NvcGUud2lkZ2V0Q29uZmlnW3dpZGdldEluZGV4XS5zZXR0aW5ncy5GaWx0ZXJJZCA9IFwiSGF6YXJkU3VtbWFyeVwiO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzY29wZS53aWRnZXRDb25maWdbd2lkZ2V0SW5kZXhdLnNldHRpbmdzLnRlbXBsYXRlID0gXCI8bmF2Y29uLWNoYXJ0ID48L25hdmNvbi1jaGFydD5cIjtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2NvcGUud2lkZ2V0Q29uZmlnW3dpZGdldEluZGV4XS5zZXR0aW5ncy50aXRsZSA9IFwiU09SVCBNYW5hZ2VtZW50IFN1bW1hcnlcIjtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHNjb3BlLm1vZHVsZUlkLnRvTG93ZXJDYXNlKCkgPT09IFwic29ydFwiICYmIChzY29wZS53aWRnZXRDb25maWdbd2lkZ2V0SW5kZXhdLnNldHRpbmdzLkZpbHRlcklkID09PSBcIlwiIHx8IHNjb3BlLndpZGdldENvbmZpZ1t3aWRnZXRJbmRleF0uc2V0dGluZ3MuRmlsdGVySWQudG9TdHJpbmcoKS50b0xvd2VyQ2FzZSgpLmluZGV4T2YoXCJoYXphcmRcIikgPiAtMSkpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2NvcGUud2lkZ2V0Q29uZmlnW3dpZGdldEluZGV4XS5zZXR0aW5ncy5GaWx0ZXJJZCA9IFwiU09SVFN1bW1hcnlcIjtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2NvcGUud2lkZ2V0Q29uZmlnW3dpZGdldEluZGV4XS5zZXR0aW5ncy50ZW1wbGF0ZSA9IFwiPG5hdmNvbi1jaGFydCA+PC9uYXZjb24tY2hhcnQ+XCI7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNjb3BlLndpZGdldENvbmZpZ1t3aWRnZXRJbmRleF0uc2V0dGluZ3MudGl0bGUgPSBcIlNPUlQgTWFuYWdlbWVudCBTdW1tYXJ5XCI7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChzY29wZS53aWRnZXRDb25maWdbd2lkZ2V0SW5kZXhdLmNvbmZpZ05hbWUgPT09IFwibXlTYXBjZVJpc2tDbGFzc1N1bW1hcnlcIikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChkYXRhLk15U3BhY2VSaXNrQ2xhc3NTdW1tYXJ5ICE9PSB1bmRlZmluZWQgJiYgZGF0YS5NeVNwYWNlUmlza0NsYXNzU3VtbWFyeS5sZW5ndGggIT09IDApIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy9zY29wZS53aWRnZXRDb25maWdbd2lkZ2V0SW5kZXhdLnNldHRpbmdzLmRhdGEgPSBkYXRhLk15U3BhY2VSaXNrQ2xhc3NTdW1tYXJ5LmRhdGE7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNjb3BlLndpZGdldENvbmZpZ1t3aWRnZXRJbmRleF0uc2V0dGluZ3MuZGF0YSA9IGRhdGEuTXlTcGFjZVJpc2tDbGFzc1N1bW1hcnk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNjb3BlLndpZGdldENvbmZpZ1t3aWRnZXRJbmRleF0uc2V0dGluZ3MudGl0bGUgPSBkYXRhLk15U3BhY2VSaXNrQ2xhc3NTdW1tYXJ5LnRpdGxlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzY29wZS53aWRnZXRDb25maWdbd2lkZ2V0SW5kZXhdLnNldHRpbmdzLmRhdGEgPSBcIlwiO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChzY29wZS53aWRnZXRDb25maWcgIT09IG51bGwgJiYgc2NvcGUud2lkZ2V0Q29uZmlnLmxlbmd0aCAhPT0gMCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNjb3BlLmlzTmV3ID0gdHJ1ZTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJC5tYXAoc2NvcGUud2lkZ2V0Q29uZmlnLCBmdW5jdGlvbiAoaXRlbSwgaW5kZXgpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaXRlbS5zZXR0aW5ncy5Vc2VyV2lkZ2V0SWQgPSBpdGVtLlVzZXJXaWRnZXRJZDtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChpdGVtLnRlbXBsYXRlICE9PSB1bmRlZmluZWQgJiYgaXRlbS50ZW1wbGF0ZSAhPT0gbnVsbCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaXRlbS5zZXR0aW5ncy50ZW1wbGF0ZSA9IGl0ZW0udGVtcGxhdGU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpdGVtLnNldHRpbmdzLnRpdGxlID0gaXRlbS50aXRsZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGl0ZW0uRmlsdGVySWQgIT09IHVuZGVmaW5lZCAmJiBpdGVtLkZpbHRlcklkICE9PSBudWxsICYmIGl0ZW0uRmlsdGVySWQgIT09IC0xKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaXRlbS5zZXR0aW5ncy5GaWx0ZXJJZCA9IGl0ZW0uRmlsdGVySWQ7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKGl0ZW0uc2V0dGluZ3MuRmlsdGVySWQgIT09IC0xKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoaXRlbS5zZXR0aW5ncy5GaWx0ZXJJZCAhPT0gdW5kZWZpbmVkICYmIHNjb3BlLm1vZHVsZUlkLnRvTG93ZXJDYXNlKCkgPT09IFwiaGF6YXJkXCIgJiYgKGl0ZW0uc2V0dGluZ3MuRmlsdGVySWQgPT09IFwiXCIgfHwgaXRlbS5zZXR0aW5ncy5GaWx0ZXJJZCA9PT0gXCJTb3J0U3VtbWFyeVwiKSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGl0ZW0uc2V0dGluZ3MuRmlsdGVySWQgPSBcIkhhemFyZFN1bW1hcnlcIjtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpdGVtLnNldHRpbmdzLnRlbXBsYXRlID0gXCI8bmF2Y29uLWNoYXJ0ID48L25hdmNvbi1jaGFydD5cIjtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpdGVtLnNldHRpbmdzLnRpdGxlID0gXCJTT1JUIE1hbmFnZW1lbnQgU3VtbWFyeVwiO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChpdGVtLnNldHRpbmdzLkZpbHRlcklkICE9PSB1bmRlZmluZWQgJiYgc2NvcGUubW9kdWxlSWQudG9Mb3dlckNhc2UoKSA9PT0gXCJzb3J0XCIgJiYgKGl0ZW0uc2V0dGluZ3MuRmlsdGVySWQgPT09IFwiXCIgfHwgaXRlbS5zZXR0aW5ncy5GaWx0ZXJJZCA9PT0gXCJIYXphcmRTdW1tYXJ5XCIpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaXRlbS5zZXR0aW5ncy5GaWx0ZXJJZCA9IFwiU09SVFN1bW1hcnlcIjtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpdGVtLnNldHRpbmdzLnRlbXBsYXRlID0gXCI8bmF2Y29uLWNoYXJ0ID48L25hdmNvbi1jaGFydD5cIjtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpdGVtLnNldHRpbmdzLnRpdGxlID0gXCJTT1JUIE1hbmFnZW1lbnQgU3VtbWFyeVwiO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpdGVtLnNldHRpbmdzLk1vZHVsZUlkID0gc2NvcGUubW9kdWxlSWQ7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vaXRlbS5zZXR0aW5ncy5Nb2R1bGVJZCA9IG1vZHVsZURhdGE7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvL2l0ZW0uc2V0dGluZ3MuY29uZmlnTmFtZSA9IHNjb3BlLm1vZHVsZUlkO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpdGVtLnNldHRpbmdzLmNvbmZpZ05hbWUgPSBpdGVtLmNvbmZpZ05hbWU7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoc2NvcGUucHJvamVjdElkICE9PSAwKSBpdGVtLnNldHRpbmdzLlByb2plY3RJZCA9IGFuZ3VsYXIuY29weShzY29wZS5wcm9qZWN0SWQpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvL2lmIChwcm9qZWN0LnRvU3RyaW5nKCkgIT09IFwiMFwiKSBpdGVtLnNldHRpbmdzLlByb2plY3RJZCA9IGFuZ3VsYXIuY29weShwcm9qZWN0KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBpZiAoY2FsbGJhY2sgIT09IHVuZGVmaW5lZCAmJiBkYXRhICE9PSB1bmRlZmluZWQgJiYgZGF0YSAhPT0gbnVsbCAmJiBkYXRhLk15U3BhY2VQcm9qZWN0TGlzdCAhPT0gdW5kZWZpbmVkICYmIGRhdGEuTXlTcGFjZVByb2plY3RMaXN0ICE9PSBudWxsKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICBjYWxsYmFjayhkYXRhLk15U3BhY2VQcm9qZWN0TGlzdC5XaWRnZXRzKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgd2lkZ2V0U2V0dGluZ3MoKTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBmdW5jdGlvbiBsb2FkTW9kdWxlKCkge1xyXG4gICAgICAgICAgICAgICAgZ2V0U2VydmVyRGF0YShcIm15U3BhY2VNb2R1bGVzXCIpLnRoZW4oZnVuY3Rpb24gKGRhdGEpIHtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgbW9kdWxlRGF0YSA9IGFuZ3VsYXIuY29weShzY29wZS5tb2R1bGVEYXRhWzBdKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGRhdGEgIT09IHVuZGVmaW5lZCAmJiBkYXRhICE9PSBudWxsICYmIGRhdGEubGVuZ3RoICE9IDApIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGRhdGEuTW9kdWxlcy5sZW5ndGggIT09IDApIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNjb3BlLmlzTW9kdWxlQXZhaWxhYmxlID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNjb3BlLm1vZHVsZURhdGEgPSBkYXRhLk1vZHVsZXM7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtb2R1bGVEYXRhID0gYW5ndWxhci5jb3B5KHNjb3BlLm1vZHVsZURhdGFbMF0pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc2NvcGUud2lkZ2V0Q29uZmlnID0gYW5ndWxhci5jb3B5KHNjb3BlLndpZGdldE1haW5Db25maWcpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc2NvcGUuaXNNb2R1bGVBdmFpbGFibGUgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNjb3BlLndpZGdldENvbmZpZyA9IGFuZ3VsYXIuY29weShzY29wZS53aWRnZXRNYWluQ29uZmlnKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNjb3BlLndpZGdldENvbmZpZy5zcGxpY2UoMCwgMyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHNjb3BlLnByb2plY3REYXRhID0gZGF0YS5Qcm9qZWN0cztcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChkYXRhLkRlZmF1bHRNb2R1bGUgIT09IHVuZGVmaW5lZCAmJiBkYXRhLkRlZmF1bHRNb2R1bGUgIT09IG51bGwgJiYgZGF0YS5EZWZhdWx0TW9kdWxlICE9PSAwICYmIGRhdGEuRGVmYXVsdE1vZHVsZS5sZW5ndGggIT09IDApXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtb2R1bGVEYXRhID0gZGF0YS5EZWZhdWx0TW9kdWxlO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgc2NvcGUudXNlck1vZHVsZSA9IG1vZHVsZURhdGE7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgc2NvcGUuJHdhdGNoKCd1c2VyTW9kdWxlJywgZnVuY3Rpb24gKG5ld1ZhbHVlLCBvbGRWYWx1ZSkge1xyXG4gICAgICAgICAgICAgICAgaWYgKG5ld1ZhbHVlICE9PSB1bmRlZmluZWQgJiYgbmV3VmFsdWUgIT09IG9sZFZhbHVlICYmIG9sZFZhbHVlICE9PSB1bmRlZmluZWQpIHsvLyAhc2NvcGUubG9hZERhdGEpIHtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgc2NvcGVVc2VyUHJvamVjdCA9IHNjb3BlLnVzZXJQcm9qZWN0O1xyXG4gICAgICAgICAgICAgICAgICAgIHNjb3BlLnVzZXJQcm9qZWN0ID0gW107XHJcbiAgICAgICAgICAgICAgICAgICAgc2NvcGUucHJvamVjdElkID0gXCJcIjtcclxuICAgICAgICAgICAgICAgICAgICBzY29wZS5tb2R1bGVJZCA9IG5ld1ZhbHVlO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAkdGltZW91dChmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChzY29wZVVzZXJQcm9qZWN0ID09PSB1bmRlZmluZWQgJiYgc2NvcGVVc2VyUHJvamVjdCA9PT0gbnVsbCB8fCBzY29wZVVzZXJQcm9qZWN0ID09PSBcIlwiIHx8IHNjb3BlVXNlclByb2plY3QubGVuZ3RoID09PSAwKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzY29wZS51c2VyUHJvamVjdCA9IGFuZ3VsYXIuY29weShzY29wZS5wcm9qZWN0RGF0YVswXSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzY29wZS51c2VyUHJvamVjdCA9IHNjb3BlVXNlclByb2plY3Q7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSwgdHJ1ZSk7XHJcblxyXG4gICAgICAgICAgICBzY29wZS4kd2F0Y2goJ3VzZXJQcm9qZWN0JywgZnVuY3Rpb24gKG5ld1ZhbHVlLCBvbGRWYWx1ZSkge1xyXG4gICAgICAgICAgICAgICAgaWYgKG5ld1ZhbHVlICE9PSB1bmRlZmluZWQgJiYgbmV3VmFsdWUgIT09IG9sZFZhbHVlICYmIG5ld1ZhbHVlLmxlbmd0aCAhPT0gMCAmJiBzY29wZS5wcm9qZWN0SWQgIT09IG5ld1ZhbHVlLlByb2plY3RJZCAmJiBvbGRWYWx1ZSAhPT0gdW5kZWZpbmVkKSB7Ly8gJiYgIXNjb3BlLmxvYWREYXRhKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgc2NvcGUucHJvamVjdElkID0gbmV3VmFsdWUuUHJvamVjdElkO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICBsb2FkQWxsRGF0YShuZXdWYWx1ZS5Qcm9qZWN0SWQsIHNjb3BlLm1vZHVsZUlkLCBuYXZjb24uZGF0ZUZyb21VVENUb0xvY2FsKHNjb3BlLmZpbHRlclN0YXJ0LCBcIk1NLURELVlZWVlcIiksIG5hdmNvbi5kYXRlRnJvbVVUQ1RvTG9jYWwoc2NvcGUuZmlsdGVyRW5kLCBcIk1NLURELVlZWVlcIiksXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGZ1bmN0aW9uIChkYXRhKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzY29wZS5pc05ldyA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9LCB0cnVlKTtcclxuXHJcbiAgICAgICAgICAgIHNjb3BlLiR3YXRjaCgndXNlclByb2plY3QxJywgZnVuY3Rpb24gKG5ld1ZhbHVlLCBvbGRWYWx1ZSkge1xyXG4gICAgICAgICAgICAgICAgaWYgKG5ld1ZhbHVlICE9PSB1bmRlZmluZWQgJiYgbmV3VmFsdWUgIT09IG9sZFZhbHVlICYmIG5ld1ZhbHVlLmxlbmd0aCAhPT0gMCAmJiBzY29wZS5wcm9qZWN0SWQgIT09IG5ld1ZhbHVlLlByb2plY3RJZCAmJiAhc2NvcGUubG9hZERhdGEpIHtcclxuICAgICAgICAgICAgICAgICAgICBzY29wZS5pc05ldyA9IHRydWU7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIHNjb3BlLmxvYWRQcm9qZWN0KHNjb3BlLm1vZHVsZUlkLCBuZXdWYWx1ZS5Qcm9qZWN0SWQsIGZ1bmN0aW9uIChwcm9qZWN0SWQsIGRhdGEpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgc2NvcGUucHJvamVjdElkID0gcHJvamVjdElkO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgc2NvcGUubW9kdWxlSWQgPSBzY29wZS51c2VyTW9kdWxlO1xyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9LCB0cnVlKTtcclxuXHJcbiAgICAgICAgICAgIC8vc2NvcGUuJHdhdGNoKCdwcm9qZWN0SWQnLCBmdW5jdGlvbiAobmV3VmFsdWUsIG9sZFZhbHVlKSB7XHJcbiAgICAgICAgICAgIC8vICAgIGlmIChuZXdWYWx1ZSAhPT0gdW5kZWZpbmVkICYmIG5ld1ZhbHVlICE9PSBcIlwiICYmIG5ld1ZhbHVlICE9PSBvbGRWYWx1ZSAmJiAhc2NvcGUubG9hZERhdGEpIHtcclxuICAgICAgICAgICAgLy8gICAgICAgIHdpZGdldFNldHRpbmdzKCk7XHJcbiAgICAgICAgICAgIC8vICAgICAgICAvL2dldERhc2hib2FyZFJlcG9ydHMoZGF0YSwgZnVuY3Rpb24gKGRhdGEpIHtcclxuICAgICAgICAgICAgLy8gICAgICAgIC8vICAgIHNjb3BlLndpZGdldERlZmluaXRpb25zID0gZGF0YTtcclxuICAgICAgICAgICAgLy8gICAgICAgIC8vICAgIHdpZGdldFNldHRpbmdzKCk7XHJcbiAgICAgICAgICAgIC8vICAgICAgICAvL30pXHJcbiAgICAgICAgICAgIC8vICAgIH1cclxuICAgICAgICAgICAgLy99LCB0cnVlKTtcclxuXHJcbiAgICAgICAgICAgIHNjb3BlLmxvYWRQcm9qZWN0ID0gZnVuY3Rpb24gKG1vZHVsZUlkLCBwcm9qZWN0SWQsIGNhbGxiYWNrKSB7XHJcbiAgICAgICAgICAgICAgICBzY29wZS53aWRnZXREYXRhID0gW107XHJcblxyXG4gICAgICAgICAgICAgICAgaWYgKHByb2plY3RJZCA9PT0gXCJcIikgcHJvamVjdElkID0gXCIwXCI7XHJcbiAgICAgICAgICAgICAgICBpZiAobW9kdWxlSWQgPT09IFwiXCIpIG1vZHVsZUlkID0gc2NvcGUudXNlck1vZHVsZSA9PT0gXCJcIiA/IFwiSGF6YXJkXCIgOiBzY29wZS51c2VyTW9kdWxlO1xyXG5cclxuICAgICAgICAgICAgICAgIGdldFNlcnZlckRhdGEoXCJteVNwYWNlUHJvamVjdExpc3RcIikudGhlbihmdW5jdGlvbiAoZGF0YSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChkYXRhICE9PSB1bmRlZmluZWQgJiYgZGF0YSAhPT0gbnVsbCAmJiBkYXRhLmxlbmd0aCAhPSAwKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vaWYgKGRhdGEuUHJvamVjdHMgIT09IHVuZGVmaW5lZCAmJiBkYXRhLlByb2plY3RzICE9PSBudWxsICYmIGRhdGEuUHJvamVjdHMubGVuZ3RoICE9PSAwKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyAgICBzY29wZS5wcm9qZWN0RGF0YSA9IGRhdGEuUHJvamVjdHM7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoc2NvcGUucHJvamVjdERhdGEgIT09IHVuZGVmaW5lZCAmJiBzY29wZS5wcm9qZWN0RGF0YSAhPT0gbnVsbCAmJiBzY29wZS5wcm9qZWN0RGF0YS5sZW5ndGggIT09IDAgJiYgcHJvamVjdElkID09PSBcIjBcIilcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHByb2plY3RJZCA9IHNjb3BlLnByb2plY3REYXRhWzBdLlByb2plY3RJZDtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChkYXRhLkRlZmF1bHRQcm9qZWN0ICE9PSB1bmRlZmluZWQgJiYgZGF0YS5EZWZhdWx0UHJvamVjdCAhPT0gbnVsbCAmJiBkYXRhLkRlZmF1bHRQcm9qZWN0ICE9PSAwICYmIHNjb3BlLnByb2plY3RJZCA9PT0gXCJcIilcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHByb2plY3RJZCA9IGRhdGEuRGVmYXVsdFByb2plY3Q7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoZGF0YS5EZWZhdWx0TW9kdWxlICE9PSB1bmRlZmluZWQgJiYgZGF0YS5EZWZhdWx0TW9kdWxlICE9PSBudWxsICYmIGRhdGEuRGVmYXVsdE1vZHVsZSAhPT0gMCAmJiBzY29wZS5tb2R1bGVJZCA9PT0gXCJcIilcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1vZHVsZUlkID0gZGF0YS5EZWZhdWx0TW9kdWxlO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGRhdGEuV2lkZ2V0cyAhPT0gbnVsbCAmJiBkYXRhLldpZGdldHMubGVuZ3RoICE9PSAwKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzY29wZS5pc05ldyA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc2NvcGUud2lkZ2V0RGF0YSA9IGRhdGEuV2lkZ2V0cztcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkLm1hcChkYXRhLldpZGdldHMsIGZ1bmN0aW9uIChpdGVtLCBpbmRleCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciB3aWRnZXRJbmRleCA9IC0xO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkLmdyZXAoc2NvcGUud2lkZ2V0Q29uZmlnLCBmdW5jdGlvbiAoZSwgaSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoZS5zZXR0aW5ncy53aWRnZXRJZCAhPT0gdW5kZWZpbmVkICYmIGUuc2V0dGluZ3Mud2lkZ2V0SWQgIT09IG51bGwgJiYgaXRlbS53aWRnZXRJZCAhPT0gdW5kZWZpbmVkICYmIGl0ZW0ud2lkZ2V0SWQgIT09IG51bGwpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChlLnNldHRpbmdzLndpZGdldElkLnRvU3RyaW5nKCkgPT09IGl0ZW0ud2lkZ2V0SWQudG9TdHJpbmcoKSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdpZGdldEluZGV4ID0gaTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHdpZGdldEluZGV4ICE9PSB1bmRlZmluZWQgJiYgd2lkZ2V0SW5kZXggIT09IC0xICYmIHdpZGdldEluZGV4Lmxlbmd0aCAhPT0gMCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzY29wZS53aWRnZXRDb25maWdbd2lkZ2V0SW5kZXhdLnNldHRpbmdzLlVzZXJXaWRnZXRJZCA9IGl0ZW0uVXNlcldpZGdldElkO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoaXRlbS50ZW1wbGF0ZSAhPT0gdW5kZWZpbmVkICYmIGl0ZW0udGVtcGxhdGUgIT09IG51bGwpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNjb3BlLndpZGdldENvbmZpZ1t3aWRnZXRJbmRleF0uc2V0dGluZ3MudGVtcGxhdGUgPSBpdGVtLnRlbXBsYXRlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2NvcGUud2lkZ2V0Q29uZmlnW3dpZGdldEluZGV4XS5zZXR0aW5ncy50aXRsZSA9IGl0ZW0udGl0bGU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChpdGVtLkZpbHRlcklkICE9PSB1bmRlZmluZWQgJiYgaXRlbS5GaWx0ZXJJZCAhPT0gbnVsbCAmJiBzY29wZS53aWRnZXRDb25maWdbd2lkZ2V0SW5kZXhdLnNldHRpbmdzLkZpbHRlcklkICE9PSAtMSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNjb3BlLndpZGdldENvbmZpZ1t3aWRnZXRJbmRleF0uc2V0dGluZ3MuRmlsdGVySWQgPSBpdGVtLkZpbHRlcklkO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy9pZiAoc2NvcGUud2lkZ2V0Q29uZmlnW3dpZGdldEluZGV4XS5zZXR0aW5ncy5GaWx0ZXJJZCAhPT0gdW5kZWZpbmVkICYmIG1vZHVsZUlkLnRvTG93ZXJDYXNlKCkgPT09IFwiaGF6YXJkXCIgJiYgKHNjb3BlLndpZGdldENvbmZpZ1t3aWRnZXRJbmRleF0uc2V0dGluZ3MuRmlsdGVySWQgPT09IFwiXCIgfHwgc2NvcGUud2lkZ2V0Q29uZmlnW3dpZGdldEluZGV4XS5zZXR0aW5ncy5GaWx0ZXJJZCA9PT0gXCJTb3J0U3VtbWFyeVwiKSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gICAgc2NvcGUud2lkZ2V0Q29uZmlnW3dpZGdldEluZGV4XS5zZXR0aW5ncy5GaWx0ZXJJZCA9IFwiSGF6YXJkU3VtbWFyeVwiO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvL2Vsc2UgaWYgKHNjb3BlLndpZGdldENvbmZpZ1t3aWRnZXRJbmRleF0uc2V0dGluZ3MuRmlsdGVySWQgIT09IHVuZGVmaW5lZCAmJiBtb2R1bGVJZC50b0xvd2VyQ2FzZSgpID09PSBcInNvcnRcIiAmJiAoc2NvcGUud2lkZ2V0Q29uZmlnW3dpZGdldEluZGV4XS5zZXR0aW5ncy5GaWx0ZXJJZCA9PT0gXCJcIiB8fCBzY29wZS53aWRnZXRDb25maWdbd2lkZ2V0SW5kZXhdLnNldHRpbmdzLkZpbHRlcklkID09PSBcIkhhemFyZFN1bW1hcnlcIikpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vICAgIHNjb3BlLndpZGdldENvbmZpZ1t3aWRnZXRJbmRleF0uc2V0dGluZ3MuRmlsdGVySWQgPSBcIlNPUlRTdW1tYXJ5XCI7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzY29wZS53aWRnZXRDb25maWdbd2lkZ2V0SW5kZXhdLnNldHRpbmdzLk1vZHVsZUlkID0gbW9kdWxlSWQ7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNjb3BlLndpZGdldENvbmZpZ1t3aWRnZXRJbmRleF0uc2V0dGluZ3MuY29uZmlnTmFtZSA9IG1vZHVsZUlkO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHByb2plY3RJZCAhPT0gMCkgc2NvcGUud2lkZ2V0Q29uZmlnW3dpZGdldEluZGV4XS5zZXR0aW5ncy5Qcm9qZWN0SWQgPSBhbmd1bGFyLmNvcHkocHJvamVjdElkKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoc2NvcGUud2lkZ2V0Q29uZmlnICE9PSBudWxsICYmIHNjb3BlLndpZGdldENvbmZpZy5sZW5ndGggIT09IDApIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNjb3BlLmlzTmV3ID0gdHJ1ZTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkLm1hcChzY29wZS53aWRnZXRDb25maWcsIGZ1bmN0aW9uIChpdGVtLCBpbmRleCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGl0ZW0uc2V0dGluZ3MuVXNlcldpZGdldElkID0gaXRlbS5Vc2VyV2lkZ2V0SWQ7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChpdGVtLnRlbXBsYXRlICE9PSB1bmRlZmluZWQgJiYgaXRlbS50ZW1wbGF0ZSAhPT0gbnVsbCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpdGVtLnNldHRpbmdzLnRlbXBsYXRlID0gaXRlbS50ZW1wbGF0ZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaXRlbS5zZXR0aW5ncy50aXRsZSA9IGl0ZW0udGl0bGU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoaXRlbS5GaWx0ZXJJZCAhPT0gdW5kZWZpbmVkICYmIGl0ZW0uRmlsdGVySWQgIT09IG51bGwgJiYgaXRlbS5GaWx0ZXJJZCAhPT0gLTEpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGl0ZW0uc2V0dGluZ3MuRmlsdGVySWQgPSBpdGVtLkZpbHRlcklkO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKGl0ZW0uc2V0dGluZ3MuRmlsdGVySWQgIT09IC0xKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChpdGVtLnNldHRpbmdzLkZpbHRlcklkICE9PSB1bmRlZmluZWQgJiYgbW9kdWxlSWQudG9Mb3dlckNhc2UoKSA9PT0gXCJoYXphcmRcIiAmJiAoaXRlbS5zZXR0aW5ncy5GaWx0ZXJJZCA9PT0gXCJcIiB8fCBpdGVtLnNldHRpbmdzLkZpbHRlcklkID09PSBcIlNvcnRTdW1tYXJ5XCIpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpdGVtLnNldHRpbmdzLkZpbHRlcklkID0gXCJIYXphcmRTdW1tYXJ5XCI7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpdGVtLnNldHRpbmdzLnRlbXBsYXRlID0gXCI8bmF2Y29uLWNoYXJ0ID48L25hdmNvbi1jaGFydD5cIjtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGl0ZW0uc2V0dGluZ3MudGl0bGUgPSBcIlNPUlQgTWFuYWdlbWVudCBTdW1tYXJ5XCI7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoaXRlbS5zZXR0aW5ncy5GaWx0ZXJJZCAhPT0gdW5kZWZpbmVkICYmIG1vZHVsZUlkLnRvTG93ZXJDYXNlKCkgPT09IFwic29ydFwiICYmIChpdGVtLnNldHRpbmdzLkZpbHRlcklkID09PSBcIlwiIHx8IGl0ZW0uc2V0dGluZ3MuRmlsdGVySWQgPT09IFwiSGF6YXJkU3VtbWFyeVwiKSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaXRlbS5zZXR0aW5ncy5GaWx0ZXJJZCA9IFwiU09SVFN1bW1hcnlcIjtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGl0ZW0uc2V0dGluZ3MudGVtcGxhdGUgPSBcIjxuYXZjb24tY2hhcnQgPjwvbmF2Y29uLWNoYXJ0PlwiO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaXRlbS5zZXR0aW5ncy50aXRsZSA9IFwiU09SVCBNYW5hZ2VtZW50IFN1bW1hcnlcIjtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaXRlbS5zZXR0aW5ncy5Nb2R1bGVJZCA9IG1vZHVsZUlkO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGl0ZW0uc2V0dGluZ3MuY29uZmlnTmFtZSA9IG1vZHVsZUlkO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAocHJvamVjdElkICE9PSAwKSBpdGVtLnNldHRpbmdzLlByb2plY3RJZCA9IGFuZ3VsYXIuY29weShwcm9qZWN0SWQpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChwcm9qZWN0SWQgIT09IDApIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBpdGVtTGlzdCA9IG5hdmNvbi5nZXRJdGVtQnlLZXlWYWx1ZShzY29wZS5wcm9qZWN0RGF0YSwgXCJQcm9qZWN0SWRcIiwgcHJvamVjdElkKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNjb3BlLnVzZXJQcm9qZWN0ID0gaXRlbUxpc3Q7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzY29wZS51c2VyUHJvamVjdCA9IHNjb3BlLnByb2plY3REYXRhWzBdO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoY2FsbGJhY2sgIT09IHVuZGVmaW5lZCkgY2FsbGJhY2socHJvamVjdElkLCBkYXRhKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgLy9nZXREYXNoYm9hcmRSZXBvcnRzKHdpZGdldGRlZiwgZnVuY3Rpb24gKGRhdGEpIHtcclxuICAgICAgICAgICAgLy8gICAgc2NvcGUud2lkZ2V0RGVmaW5pdGlvbnMgPSBkYXRhO1xyXG4gICAgICAgICAgICAvL30pXHJcblxyXG4gICAgICAgICAgICBmdW5jdGlvbiB3aWRnZXRTZXR0aW5ncygpIHtcclxuICAgICAgICAgICAgICAgIHNjb3BlLndpZGdldHMgPSBbXTtcclxuICAgICAgICAgICAgICAgIC8vbG9nZ2VyLndhcm5pbmcobmV3VmFsdWUpO1xyXG5cclxuICAgICAgICAgICAgICAgIHZhciB3aWRnZXRTZXQgPSBbXTtcclxuICAgICAgICAgICAgICAgIGFuZ3VsYXIuZm9yRWFjaChzY29wZS53aWRnZXRDb25maWcsIGZ1bmN0aW9uIChpdGVtLCBrZXkpIHtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgbmV3V2lkZ2V0ID0gYW5ndWxhci5jb3B5KGl0ZW0uc2V0dGluZ3MpO1xyXG4gICAgICAgICAgICAgICAgICAgIHdpZGdldFNldC5wdXNoKG5ld1dpZGdldCk7XHJcbiAgICAgICAgICAgICAgICAgICAgLy9zY29wZS4kYnJvYWRjYXN0KCdEQVNIQk9BUkQtV0lER0VULUFDVElPTicsICdhZGQnKTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgc2NvcGUud2lkZ2V0cyA9IHdpZGdldFNldDtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgc2NvcGUuc2F2ZVdpZGdldCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgIHZhciB3aWRnZXRzID0gW107XHJcblxyXG4gICAgICAgICAgICAgICAgdmFyIHNjb3BlV2lkZ2V0cyA9IGFuZ3VsYXIuY29weShzY29wZS53aWRnZXRzKTtcclxuICAgICAgICAgICAgICAgIGFuZ3VsYXIuZm9yRWFjaChzY29wZVdpZGdldHMsIGZ1bmN0aW9uIChpdGVtLCBrZXkpIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoaXRlbS5yb3cgIT09IHVuZGVmaW5lZCAmJiBpdGVtLmNvbCAhPT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChpdGVtW1wiVXNlcldpZGdldElkXCJdID09PSB1bmRlZmluZWQpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpdGVtW1wiVXNlcldpZGdldElkXCJdID0gMDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaXRlbVtcInVwZGF0ZVwiXSA9IHRydWU7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAvL2l0ZW1bXCJGaWx0ZXJJZFwiXSA9IHNjb3BlLmRlZmF1bHRSZXBvcnQ7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICB3aWRnZXRzLnB1c2goaXRlbSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICAgICAgLy8kcm9vdFNjb3BlLmRhc2hib2FyZFdpZGdldHMgPSB3aWRnZXRzO1xyXG5cclxuICAgICAgICAgICAgICAgIGlmICh3aWRnZXRzLmxlbmd0aCAhPT0gMCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGRhdGFzZXJ2aWNlLnB1dFNlcnZlckRhdGEoXCJteVNwYWNlVXBkYXRlXCIsIHdpZGdldHMpLnRoZW4oZnVuY3Rpb24gKGRhdGEpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgLy8kcm9vdFNjb3BlLmRhc2hib2FyZFdpZGdldHMgPSBzY29wZS53aWRnZXRzO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAvL2xvZ2dlci53YXJuaW5nKFwiTXkgc3BhY2UgZGF0YSBVcGRhdGVkXCIpO1xyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBzY29wZS4kd2F0Y2goJ3dpZGdldHMnLCBmdW5jdGlvbiAobmV3V2lkZ2V0LCBvbGRXaWRnZXQpIHtcclxuICAgICAgICAgICAgICAgIGlmIChuZXdXaWRnZXQgIT09IHVuZGVmaW5lZCAmJiBuZXdXaWRnZXQgIT09IG9sZFdpZGdldCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChzY29wZS5pc05ldyAmJiBuZXdXaWRnZXRbMF0ucm93ICE9PSB1bmRlZmluZWQgJiYgbmV3V2lkZ2V0WzBdLmNvbCAhPT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHNjb3BlLnNhdmVXaWRnZXQoKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgc2NvcGUuaXNOZXcgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKG9sZFdpZGdldCAhPT0gdW5kZWZpbmVkICYmIG5ld1dpZGdldC5sZW5ndGggPiAxICYmIG9sZFdpZGdldC5sZW5ndGggPiAxICYmIG5ld1dpZGdldFsxXS5GaWx0ZXJJZCAhPT0gdW5kZWZpbmVkICYmIG5ld1dpZGdldFsxXS5GaWx0ZXJJZCAhPT0gb2xkV2lkZ2V0WzFdLkZpbHRlcklkKSB7IC8vIFNlY29uZCBXaWRnZXRcclxuICAgICAgICAgICAgICAgICAgICAgICAgc2NvcGUuc2F2ZVdpZGdldCgpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSwgdHJ1ZSk7XHJcblxyXG4gICAgICAgICAgICBzY29wZS4kb24oJ0RBU0hCT0FSRC1XSURHRVQtQUNUSU9OJywgZnVuY3Rpb24gKGV2LCBhY3Rpb24sIGNhbGxiYWNrKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoYWN0aW9uICE9PSB1bmRlZmluZWQgJiYgYWN0aW9uLnRvTG93ZXJDYXNlKCkgPT09IFwiYWRkXCIpIHtcclxuICAgICAgICAgICAgICAgICAgICBzY29wZS5pc05ldyA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICAgLy9zY29wZS5zYXZlV2lkZ2V0KCk7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGFjdGlvbiAhPT0gdW5kZWZpbmVkICYmIGFjdGlvbi50b0xvd2VyQ2FzZSgpID09PSBcImRlbGV0ZVwiKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgc2NvcGUuaXNEZWxldGUgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgICAgICRyb290U2NvcGUuZGFzaGJvYXJkRGVsID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICBpZiAoY2FsbGJhY2sgIT09IHVuZGVmaW5lZClcclxuICAgICAgICAgICAgICAgICAgICBjYWxsYmFjaygpO1xyXG4gICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgIHNjb3BlLiR3YXRjaCgnZmV0Y2hpbmcnLCBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoIXNjb3BlLmZldGNoaW5nKSB7XHJcblxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgIHNjb3BlLnJlc2l6ZSA9IGZ1bmN0aW9uICh3aWR0aCwgaGVpZ2h0LCBpZCwgaXRlbU9iaikge1xyXG4gICAgICAgICAgICAgICAgJHJvb3RTY29wZS4kYnJvYWRjYXN0KCdEQVNIQk9BUkQtUkVTSVpFJywgd2lkdGgsIGhlaWdodCwgaWQsIGl0ZW1PYmopO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAvLyBXZSB3YW50IHRvIG1hbnVhbGx5IGhhbmRsZSBgd2luZG93LnJlc2l6ZWAgZXZlbnQgaW4gZWFjaCBkaXJlY3RpdmUuXHJcbiAgICAgICAgICAgIC8vIFNvIHRoYXQgd2UgZW11bGF0ZSBgcmVzaXplYCBldmVudCB1c2luZyAkYnJvYWRjYXN0IG1ldGhvZCBhbmQgaW50ZXJuYWxseSBzdWJzY3JpYmUgdG8gdGhpcyBldmVudCBpbiBlYWNoIGRpcmVjdGl2ZVxyXG4gICAgICAgICAgICAvLyBEZWZpbmUgZXZlbnQgaGFuZGxlclxyXG4gICAgICAgICAgICBzY29wZS5ldmVudHMgPSB7XHJcbiAgICAgICAgICAgICAgICBiZWZvcmVSZXNpemU6IGZ1bmN0aW9uIChlLCBzY29wZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBzY29wZS5hcGkudXBkYXRlKClcclxuICAgICAgICAgICAgICAgICAgICB9LCAyMDApXHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH07XHJcblxyXG4gICAgICAgICAgICBhbmd1bGFyLmVsZW1lbnQod2luZG93KS5vbigncmVzaXplJywgZnVuY3Rpb24gKGUpIHtcclxuXHJcbiAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgLy8gV2Ugd2FudCB0byBoaWRlIHRoZSBjaGFydHMgdW50aWwgdGhlIGdyaWQgd2lsbCBiZSBjcmVhdGVkIGFuZCBhbGwgd2lkdGhzIGFuZCBoZWlnaHRzIHdpbGwgYmUgZGVmaW5lZC5cclxuICAgICAgICAgICAgLy8gU28gdGhhdCB1c2UgYHZpc2libGVgIHByb3BlcnR5IGluIGNvbmZpZyBhdHRyaWJ1dGVcclxuICAgICAgICAgICAgc2NvcGUuY29uZmlnID0ge1xyXG4gICAgICAgICAgICAgICAgdmlzaWJsZTogZmFsc2VcclxuICAgICAgICAgICAgfTtcclxuXHJcbiAgICAgICAgICAgIGZ1bmN0aW9uIGdldFVzZXJQcm9maWxlKCkge1xyXG4gICAgICAgICAgICAgICAgdHJ5IHtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgZGF0YVVzZXIgPSBnZXRTZXJ2ZXJEYXRhKCd1c2VyUHJvZmlsZUlkJykudGhlbihmdW5jdGlvbiAoZGF0YVVzZXIpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGRhdGFVc2VyICE9PSB1bmRlZmluZWQgJiYgZGF0YVVzZXIgIT09IG51bGwpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciB1c2VySW1hZ2UgPSBkYXRhVXNlci5pbWc7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGRhdGFVc2VyLmltZyA9PT0gdW5kZWZpbmVkIHx8IGRhdGFVc2VyLmltZyA9PT0gbnVsbCB8fCBkYXRhVXNlci5pbWcgPT09IFwiXCIpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdXNlckltYWdlID0gXCIvOWovNEFBUVNrWkpSZ0FCQVFBQUFRQUJBQUQvMndDRUFBa0dCaEFRRVJVUUVCQVZGUkFVRWhvWUVCRVNEeFFTRWhVU0ZSZ1ZJQllVRWhjWUhDY2ZGeHN2R3hJWEh5OGdJeWNxTERndEZSNHlOVEFxTlNZckxDb0JDUW9LQlFVRkRRVUZEU2tZRWhncEtTa3BLU2twS1NrcEtTa3BLU2twS1NrcEtTa3BLU2twS1NrcEtTa3BLU2twS1NrcEtTa3BLU2twS1NrcEtTa3BLZi9BQUJFSUFMd0FrQU1CSWdBQ0VRRURFUUgveEFBYkFBRUFBZ01CQVFBQUFBQUFBQUFBQUFBQUFnVUJCQVlEQi8vRUFFTVFBQUlDQVFFRENBY0RDZ1FIQUFBQUFBRUNBQU1SQkJJaE1RVUdNa0ZSWVhHQkV5SWpRbEtSb1ROaWdoUkRjbk9pc2JMQjBmQTBkSkxTSkZOam83UEN3Ly9FQUJRQkFRQUFBQUFBQUFBQUFBQUFBQUFBQUFEL3hBQVVFUUVBQUFBQUFBQUFBQUFBQUFBQUFBQUEvOW9BREFNQkFBSVJBeEVBUHdEN2htTXpFUU01ak14RURPWXpNUkF6bU16UTVVNWJwMHdIcFc5WnVoV3FsN0h4eDJVRzgrUENWcDUyUDFhSzRyMmw2RmJ5VTJmdmdkRG1NeWdITzRlOXBOUVBCSzMvQUlYTW12UEhTKzk2VlAwOU5jQjVrS1JBdk14bVZtbTV5Nk93NFRVMUZ2aDlLb2IvQUVrZ3l5Z1p6R1ppSUdjeG1ZaUJuTVptSWdZekdaSE1aZ1N6R1pITVpnU3pLamx2bDhVK3lxQXMxVEQxYTgrcWdQNXk0am9wOVR3SGFOWGx6bHB5NTAybWJGZyszdXhrVXFSdUNqZzFwSEFjQU41NmdkSFNhTktnUWc0bkxzU1dkMjYyZGp2WTk1Z1IwdWoyUzFqc1h1ZjdTMXVrM1lvSHVvT3BSdUhqdm14RWpkY3FLWFlnS295ekU0QUE0a3dKVE0xdEJybHVUYlVNUFdJS3VObDFJUEJsTzlUakJ3ZTBUWWdRdTA2T01PcXNPeGxERDVHZWVpMTdhRWpKTGFJN21Va3MybisraE84MWRxKzd4RzdJbnJaYXE5SWdlSkEvZlBDdmxLaDI5R3QxYk1SMEZ0UmlSMTdnWUhZaGdkNDRkUm1jem1lYldzOUMvd0NSc2ZVd1cwaEp6N01kS244T1FSOTBqNFowbVlFc3htUnpHWUVzeG1SekdZR014bVJ6R1lFc3lwNXdjcnRTcTEwNE9wdHlLZ1JrSW82VnJqNFZ5TjNXU0IxeTB6T1ZiMXRWcVhQRU90YTl5SWluQTdCdE94OFRBYVBTTFV1eUNUdkpabU9XZHp2WjNQV1NkODlvaUFrZVJ1VC9BTXNjWFA4QTRXdHZZcjFYV0tmdFc3YXdSNm82eU5yZ0JQRGxQVHRaVFpXcHd6VnNxbnZJT1A3NzUxSEkyclMyaXF5c0JVYXRTcWdZQ2pBOVRIVmpoanVnYSt1NXM2ZTV6WVZaYkc2VDFXUFdXeHcydGs0WTk1bmdPWnVsOTcwcjl6Nm00anpBYmZMeUlGWFZ6VzBTOE5KVG50TktNM3pJSm5ycitSS2JxalNVQ3J4VW9Bckk0NkxvUU56RHQvck4rSUh6N1ZYV1ZnbXdmOFRvN0ZzYlpHTnRCeGRCMk5WdGpIYmtkVTdsTEF3REtjcVJrRWNDRHdJbEh6czB3VnFkU0J2RGltM3NhcTNobnR3K3lSNHQyejI1cU9meVNvSDNBMWZsVTdJUG9nZ1hHWXpJNWpNQ1dZekk1ak1DT1l6STVqTUNXWnkrTWFuVkQvckszazlWWkg4L2xPbXpPVjVVMUMwNnE1bXo2MWRMS3FqTE94TDFoVkhXZHBRUE1RTnFKNVdVNnhWMjIwbnE5YXBlcjJnZm9Zd1QzQmozWm1kTnFWc1VPaHlwNEg5NElPOEhJeGd3UFFucm03ekxZblRzUUQ2STMyR2drRWJWVEhPMHVmZDJtYkhkaVZPcG9GMWxPbVBRdGMrbEE2NnExTE12Z1RzcWU1ak8wVlFCZ0RBSEFEaGlCbUlpQWlJZ1UzUERUV1dhSzVhaG0wS0hyQUdUdDFzR0dCMTcxNFNYSXRWYWFlcGFXMjZoV05oeDc0Tzh2NGtrazk1bG5xYnhXak8zUlZTemVDakorZ2xOemZxWmROWHRERE1EWXdIQU5jek9WSGg2VEhsQXM4eG1SekdZRXN4bVJ6R1lFY3htUXpHWUU4eWw1VDBRZlhhS3c4Rk53STZpMndHVFBnYTJJbHZtVW5PNWJQUXBaVTJ6WlZxS21SaU1nWmJZTzBQaDlwZzl4TURySnlITEdrZlMyV1g3QWJTMk9yT1ZPR3Fkc0t6TXA2U2s0WWtieGx0M1hPaDVHNVRHcHBXMERaSnlIVE9TbGlraDBKN21CRTF1ZDMrQzFINmx2M1FLcmtyZnIwejFhVzBqeE5tbkIrazZ5Y2pvWDJkYlNmaXJ1VDUraWIvNXpyb0NJaUFpSWdlT3Qwd3NyZXM4SFJsSjdtQkg4NVU4aDZndnBxV1BTOUVvY2Rqb05seC9xVXk4blA4QUlmMlRmNWkvL3dBMWtDeXpHWkRNWmdUekdaRE1aZ1J6R1pITVpnU3pQRFg2UVhWUFN4d0xFS2s5WXlOekR2QndmS2V1WXpBNWZrZmxTelRrMzdKS0U3T3ZwWGVVdVRjOTFZNitHOWV0ZGtqZU4vYXVsV29xd2NQVFluaXJJdytvSU01YmxxajBML2xhOURBR3FVZkFPamVPOWVEZHEvb3pkNW8zN0J0MHZ1VjdObEg2cTB2Nm83ZzZPQjNGWUZqbytiV2xwY1dWMHFycm5aWVpKR1JnNHlleVdjUkFSRVFFUkVEeTFXb1d0R3NZNFZGTE1mdXFDVDlCS1BrT3NycDZnMjV5bTI0Ky9hUzdENXVSNVRhNTFrblNXSVB6bXpWNVhPcUg2T1pKanY4QU9CTE1aa2N4bUJMTVprY3htQkhNWmtNeG1CUE1aa014bUJQKzkvRHpsTnlUeWNkTHJhOWxzMFdWV1Yxb1I2MVpHeTZwdGU4b0N2czUzZ0VqZnVsdG1WdktldVZMOUdoNmI2cjFjRGdvcmRXWTlnellxK0xRT3NpSWdJaUlDSWlCVDg1VGtVcDhlcXIrU1pjL1N1WnpLWGx2bkxweHIwcWQ5bGFVYkxuN01haTBLRlZ6d1Vpc3R2TzcyZzRTM3ovZmRBbm1NeUdZekFubU15R1l6QWptTXlPWXpBbG1NeUkzOEpTOG9jN05QVmxVSnVzSHUxRUZRZnYyZEVlV1QzUUxtNjlVVXU3QlVVWloyT0ZVZHBNNUtqVUxyV3R2WU1xN1lybzNsWFZLamtPQ042c1hKYjVEcWxYeWx5bmJxV0J1SUNLY3BTbWZScWZpT2Q3dDNueUFsbnphSHNQR3l3L3RuK2tDKzVPNTBXVVlUVjVlcnExU3I2eS81aEIvR3U3dEE0enJLcmxkUXlNR1VqS3NwQkJCNEVFY1JPSm5scEd0MHpGOUtRRkp5K25Za1V1ZXNyajdKdThidTBHQjMwU2swWFBEU3V2dExGb3NIVHF2ZEsyQjdzbkRqN3lraWFQTFhPbmI5am9yRlp5UGFhaEdWMHFVL0NSa05ZZW9kWEU5UUllL0xmT1prZjBHbUN0YVB0WGZKcXFIVXJCU0N6bjRRUmdieVJ1elQzNm5WMmZhYXR3dld0S0xTUG52ZjlxZWVuMDYxcUZYaDJrNUpKNHN4TzhrbmVTZTJlc0RsZVZkRWxWK3lpZ0s5UUpIYXlzUXhPZUpJWmNrNzVMazdsTy9UYnFiTUoveVhHM1Y1RE9VL0NSTmpuSDlyVCtydC9mVEsrQjAybTU4RDg5cDNYNzFUcmF2eWJaWWZXV2VtNTBhT3pjTlFxbjRiYzBuL3VBRDZ6aG9JenhnZlRRY2pJM2c4Q040UGdlQmpNK1lVMStqT2F5MVo3YW5hbytleVJuemxqUnpoMWljTDlzZGwxYXY5UnN0OVlIY3U0QUxFZ0tCbG1ZaFZBN1dKM0FlTW9OZHp5cVhkUXB1YjRzbEtSK01qTGZoQjhST1kxZDlsNTJyN0RZUWNnTmdWcWZ1VmoxUjQ0ejN5TUQzMS9LVitvM1hXWlEvbWtHeFY0RVp5LzRpWnJxb0c0REE2Z053bVlnSmQ4MlQ3REhaYllQMmovV1VrdGViRDdyVTdMZHJ5ZFYvbUQ4b0YzRVJBaXlBOFFENGpNeXFnY0Jqd21ZZ0lpSUhQYzRUN2VzZGxUL1Y2LzhBYk5DYmZMcHpxZkNoZm16MmY3WnFRRVJFQkVSQVJFUUVSRUJOcmtPM1oxR09xeXNqOFZaeVAyV2Y1VFZrTGJDbXphT05iQndPMERwRHpVa1FPemlScnNEQU1weUNBUWUwSGdmbEpRRVJFQkVSQTVibFZzNm16dVd0ZjJjLys4OEpocmR0N0xPcHJXeDRMNm8vaG1ZQ0lpQWlJZ0lpSUNJaUFpSWdXM05yVmVxMUI0MUgxTytwczdQeU9WOGhMcWNjbW9OTHJjUGMzT0IxMU4waDVZRGZobllJNElCQnlDTWdqZ1FlQkVETVJFQk5UbFhXZWhwZXdkSUw2bmU1M0tQbVJOdWMvd0E0OVR0T2xJNEw3U3p4M2lzSHoybS9DSUZaUlZzcUY3QUI4dXVUaUlDSWlBaUlnSWlJQ0lpQWlJZ0paYzI5WnM1MHplNkMxUGZYMXArRW41RWRrclo0NnUwb3ZwVjNQWDZ5SHZIVWU0Z2tIeGdkdEV3RE13UFBVYWhhMFozT0ZVRXNlNFRrRWRuTFdQMDdHMm1Id2ozVjhsQUh6bHR6b3RQc3EvY2R5WEhic0RLZzkyY0h5RXJJQ0lpQWlJZ0lpSUgvMlE9PVwiO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICRyb290U2NvcGUudXNlclByb2ZpbGVJbWFnZSA9IHVzZXJJbWFnZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgfSBjYXRjaCAoZSkgeyB9XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGZ1bmN0aW9uIG1TY3JvbGxiYXIoKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoJChcIi5wYWdlLXNpZGViYXJcIikuaGFzQ2xhc3MoJ21DdXN0b21TY3JvbGxiYXInKSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmICgkKFwiLm1haW5fbWVudV9zaWRlIC5tZW51U2Nyb2xsYmFyXCIpLm1DdXN0b21TY3JvbGxiYXIubGVuZ3RoICE9PSAwKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vJChcIi5tYWluX21lbnVfc2lkZSAubWVudVNjcm9sbGJhclwiKS5tQ3VzdG9tU2Nyb2xsYmFyKCdzdG9wJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICQoXCIubWFpbl9tZW51X3NpZGUgLm1lbnVTY3JvbGxiYXJcIikubUN1c3RvbVNjcm9sbGJhcignZGVzdHJveScpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgJChcIi5wYWdlLXNpZGViYXJcIikubUN1c3RvbVNjcm9sbGJhcih7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGF1dG9IaWRlU2Nyb2xsYmFyOiB0cnVlLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBzY3JvbGxJbmVydGlhOiAwLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBzY3JvbGxiYXJQb3NpdGlvbjogXCJvdXRzaWRlXCJcclxuICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICBtU2Nyb2xsYmFyKCk7XHJcblxyXG4gICAgICAgICAgICAgICAgaWYgKCRyb290U2NvcGUuY29uZmlnSGVhZGVyTWVudSAhPT0gdW5kZWZpbmVkICYmICRyb290U2NvcGUuY29uZmlnSGVhZGVyTWVudSAhPT0gbnVsbCAmJiAkcm9vdFNjb3BlLmNvbmZpZ0hlYWRlck1lbnUgIT09IFwibG9naW5cIikge1xyXG4gICAgICAgICAgICAgICAgICAgIC8vZ2V0VXNlclByb2ZpbGUoKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIGN1cnJlbnRVcmwgPSBcIlwiO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmICgkbG9jYXRpb24uJCRwYXRoICE9PSB1bmRlZmluZWQpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGN1cnJlbnRVcmwgPSAkbG9jYXRpb24uJCRwYXRoLnN1YnN0cmluZygxLCAkbG9jYXRpb24uJCRwYXRoLmxlbmd0aCkudG9Mb3dlckNhc2UoKTtcclxuXHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGlmIChzY29wZS4kcGFyZW50ICE9PSB1bmRlZmluZWQgJiYgc2NvcGUuJHBhcmVudCAhPT0gbnVsbFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAmJiBzY29wZS4kcGFyZW50LiRwYXJlbnQgIT09IHVuZGVmaW5lZCAmJiBzY29wZS4kcGFyZW50LiRwYXJlbnQgIT09IG51bGxcclxuICAgICAgICAgICAgICAgICAgICAgICAgJiYgc2NvcGUuJHBhcmVudC4kcGFyZW50Lm1lbnVzICE9PSB1bmRlZmluZWQgJiYgc2NvcGUuJHBhcmVudC4kcGFyZW50Lm1lbnVzICE9PSBudWxsKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBhbGxNZW51cyA9IG5hdmNvbi5nZXREYXRhRnJvbVRyZWUoc2NvcGUuJHBhcmVudC4kcGFyZW50Lm1lbnVzLCAnJywgMCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBmaWx0ZXJNZW51cyA9ICQuZ3JlcChhbGxNZW51cywgZnVuY3Rpb24gKGUpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBlLkNvbmZpZ05hbWUgIT09IHVuZGVmaW5lZCAmJiBlLkNvbmZpZ05hbWUgIT09IG51bGwgJiYgZS5Db25maWdOYW1lICE9PSBcIlwiO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGZpbHRlck1lbnVzLmxlbmd0aCA+IDAgJiYgZmlsdGVyTWVudXNbMF0uQ29uZmlnTmFtZS50b0xvd2VyQ2FzZSgpICE9PSBcImRhc2hib2FyZFwiKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgbG9jYXRpb25QYXRoID0gZmlsdGVyTWVudXNbMF0uQ29uZmlnTmFtZS50b1N0cmluZygpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJGxvY2F0aW9uLnBhdGgoJy8nICsgbG9jYXRpb25QYXRoKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvYWRBbGxEYXRhKFwiMFwiLCBcIjBcIiwgbmF2Y29uLmRhdGVGcm9tVVRDVG9Mb2NhbChzY29wZS5maWx0ZXJTdGFydCwgXCJNTS1ERC1ZWVlZXCIpLCBuYXZjb24uZGF0ZUZyb21VVENUb0xvY2FsKHNjb3BlLmZpbHRlckVuZCwgXCJNTS1ERC1ZWVlZXCIpKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vbG9hZE1vZHVsZSgpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChjdXJyZW50VXJsLnRvTG93ZXJDYXNlKCkgPT09IFwiZGFzaGJvYXJkXCIpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgbG9hZEFsbERhdGEoXCIwXCIsIFwiMFwiLCBuYXZjb24uZGF0ZUZyb21VVENUb0xvY2FsKHNjb3BlLmZpbHRlclN0YXJ0LCBcIk1NLURELVlZWVlcIiksIG5hdmNvbi5kYXRlRnJvbVVUQ1RvTG9jYWwoc2NvcGUuZmlsdGVyRW5kLCBcIk1NLURELVlZWVlcIikpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAvL2xvYWRNb2R1bGUoKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgc2NvcGUuY29uZmlnLnZpc2libGUgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgaWYgKHdpbmRvdy5kaXNwYXRjaEV2ZW50Lmxlbmd0aCA+IDApXHJcbiAgICAgICAgICAgICAgICAgICAgd2luZG93LmRpc3BhdGNoRXZlbnQobmV3IEV2ZW50KCdyZXNpemUnKSk7XHJcbiAgICAgICAgICAgIH0sIDIwMCk7XHJcblxyXG4gICAgICAgICAgICAvKmFjdGl2YXRlKGZ1bmN0aW9uICh3aWRnZXRzKSB7XHJcbiAgICAgICAgICAgICAgICAvL3Njb3BlLmxvYWRQcm9qZWN0KCk7XHJcbiAgICAgICAgICAgIH0pOyovXHJcblxyXG4gICAgICAgICAgICBmdW5jdGlvbiBnZXREYXNoYm9hcmRSZXBvcnRzKHdpZGdldHMsIGNhbGxiYWNrKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgZGFzaGJvYXJkUmlnaHRzO1xyXG4gICAgICAgICAgICAgICAgdmFyIHZhbHVlID0gbmF2Y29uLmdldEl0ZW1CeUtleVZhbHVlKHNjb3BlLnVzZXJSaWdodHMsIFwiQ29uZmlnTmFtZVwiLCBcImRhc2hib2FyZFwiKTtcclxuICAgICAgICAgICAgICAgIGlmICh2YWx1ZSAhPT0gLTEpXHJcbiAgICAgICAgICAgICAgICAgICAgZGFzaGJvYXJkUmlnaHRzID0gdmFsdWU7XHJcbiAgICAgICAgICAgICAgICBpZiAoZGFzaGJvYXJkUmlnaHRzICE9PSB1bmRlZmluZWQgJiYgZGFzaGJvYXJkUmlnaHRzLmNoaWxkcmVuLmxlbmd0aCA9PT0gMCkgcmV0dXJuXHJcbiAgICAgICAgICAgICAgICB2YXIgd2lkZ2V0THN0ID0gW107XHJcbiAgICAgICAgICAgICAgICBhbmd1bGFyLmZvckVhY2goZGFzaGJvYXJkUmlnaHRzLmNoaWxkcmVuLCBmdW5jdGlvbiAoaXRlbSwga2V5KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGl0ZW0uQ29uZmlnTmFtZSAhPT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciB3aWRnZXQgPSB3aWRnZXRzLmluQXJyYXkoXCJjb25maWdOYW1lXCIsIGl0ZW0uQ29uZmlnTmFtZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh3aWRnZXQgIT09IC0xKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB3aWRnZXRMc3QucHVzaCh3aWRnZXQpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICBjYWxsYmFjayh3aWRnZXRMc3QpO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBmdW5jdGlvbiBhY3RpdmF0ZShjYWxsYmFjaykge1xyXG4gICAgICAgICAgICAgICAgaWYgKG5nQXV0aFNldHRpbmdzLndpZGdldFNldHRpbmcgIT09IHVuZGVmaW5lZCAmJiBuZ0F1dGhTZXR0aW5ncy53aWRnZXRTZXR0aW5nLmxlbmd0aCAhPT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgLy9zY29wZS53aWRnZXRzID0gbmdBdXRoU2V0dGluZ3Mud2lkZ2V0U2V0dGluZztcclxuICAgICAgICAgICAgICAgICAgICBjYWxsYmFjayhuZ0F1dGhTZXR0aW5ncy53aWRnZXRTZXR0aW5nKTtcclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKCRyb290U2NvcGUuZGFzaGJvYXJkV2lkZ2V0cyAhPT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vc2NvcGUud2lkZ2V0cyA9ICRyb290U2NvcGUuZGFzaGJvYXJkV2lkZ2V0cztcclxuICAgICAgICAgICAgICAgICAgICAgICAgY2FsbGJhY2soJHJvb3RTY29wZS5kYXNoYm9hcmRXaWRnZXRzKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgLy9yZXR1cm47XHJcbiAgICAgICAgICAgICAgICAgICAgfS8qZGF0YXNlcnZpY2UuZ2V0RGF0YShcIkhvbWUvV2lkZ2V0cy9HZXRBbGxcIikudGhlbihmdW5jdGlvbiAoZGF0YSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGRhdGEgIT09IHVuZGVmaW5lZCAmJiBkYXRhLmxlbmd0aCA+IDApIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvL3Njb3BlLndpZGdldHMgPSBkYXRhO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRyb290U2NvcGUuZGFzaGJvYXJkV2lkZ2V0cyA9IGRhdGE7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FsbGJhY2soZGF0YSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhbGxiYWNrKFtdKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgfSk7Ki9cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbn1dKTsiLCJcInVzZSBzdHJpY3RcIjtcclxuYW5ndWxhci5tb2R1bGUoJ2FwcCcpLmRpcmVjdGl2ZSgnbmF2Y29uTXljb3VudCcsIFsnJHJvb3RTY29wZScsICdkYXRhc2VydmljZScsICckdGltZW91dCcsXHJcbiAgICBmdW5jdGlvbigkcm9vdFNjb3BlLCBkYXRhc2VydmljZSwgJHRpbWVvdXQpIHtcclxuICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICByZXN0cmljdDogJ0FFJyxcclxuICAgICAgICAgICAgLy90ZW1wbGF0ZVVybDogJ2FwcC9kYXNoYm9hcmQvZGlyZWN0aXZlcy9teWNvdW50VGVtcGxhdGUuaHRtbCcsXHJcbiAgICAgICAgICAgIHRlbXBsYXRlVXJsOiBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBuYXZjb24uTWVudXJvdXRlLmdldFRlbXBsYXRlVXJsKFwibXljb3VudFRlbXBsYXRlXCIpO1xyXG4gICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICBjb250cm9sbGVyOiBmdW5jdGlvbigkc2NvcGUpIHtcclxuICAgICAgICAgICAgICAgICRzY29wZS5uYXZjb25EYXRhID0gJHNjb3BlO1xyXG4gICAgICAgICAgICAgICAgJHNjb3BlLm1vZHVsZUlkID0gJHNjb3BlLml0ZW0uTW9kdWxlSWQ7XHJcbiAgICAgICAgICAgICAgICAkc2NvcGUucHJvamVjdElkID0gJHNjb3BlLml0ZW0uUHJvamVjdElkO1xyXG4gICAgICAgICAgICAgICAgJHNjb3BlLnJlcG9ydCA9ICRzY29wZS5pdGVtLnJlcG9ydDtcclxuICAgICAgICAgICAgICAgICRzY29wZS50aXRsZSA9ICRzY29wZS5pdGVtLnRpdGxlLnRvU3RyaW5nKCk7XHJcbiAgICAgICAgICAgICAgICAkc2NvcGUuY2F1c2VzRGF0YSA9ICRzY29wZS5pdGVtLmRhdGE7XHJcblxyXG4gICAgICAgICAgICAgICAgZnVuY3Rpb24gZ2V0U2VydmVyRGF0YSh0eXBlLCByb3dJZCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBkYXRhc2VydmljZS5nZXRTZXJ2ZXJEYXRhKHR5cGUsIHJvd0lkKS50aGVuKGZ1bmN0aW9uKGRhdGEpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGRhdGE7XHJcbiAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICB9O1xyXG5cclxuICAgICAgICAgICAgICAgIC8vJHNjb3BlLmNhdXNlc0RhdGEgPSBbXTtcclxuXHJcbiAgICAgICAgICAgICAgICAkc2NvcGUuJHdhdGNoKCdwcm9qZWN0SWQnLCBmdW5jdGlvbihuZXdWYWx1ZSwgb2xkVmFsdWUpIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAobmV3VmFsdWUgIT09IHVuZGVmaW5lZCAmJiBuZXdWYWx1ZSAhPT0gXCJcIiAmJiAkc2NvcGUuY2F1c2VzRGF0YS5sZW5ndGggPT09IDApIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgZ2V0U2VydmVyRGF0YShcIm15U3BhY2VDb3VudFJlcG9ydFwiLCBuZXdWYWx1ZSArIFwiL1wiICsgJHNjb3BlLm1vZHVsZUlkKS50aGVuKGZ1bmN0aW9uKGRhdGEpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChkYXRhICE9PSB1bmRlZmluZWQgJiYgZGF0YSAhPT0gbnVsbCAmJiBkYXRhLkNhdXNlc0lubmVyTGlzdCAhPT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJHNjb3BlLmNhdXNlc0RhdGEgPSBkYXRhLkNhdXNlc0lubmVyTGlzdDtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8kdGltZW91dChmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gICAgJCgnLm5hdmNvbi1kYXNoYm9hcmQtdGlsZScpLnRvb2x0aXAoKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvL30pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9LCB0cnVlKTtcclxuXHJcbiAgICAgICAgICAgICAgICAvL2dldFNlcnZlckRhdGEoXCJteVNwYWNlQ291bnRSZXBvcnRcIiwgJHNjb3BlLnByb2plY3RJZCArIFwiL1wiICsgJHNjb3BlLm1vZHVsZUlkKS50aGVuKGZ1bmN0aW9uIChkYXRhKSB7XHJcbiAgICAgICAgICAgICAgICAvLyAgICBpZiAoZGF0YSAhPT0gdW5kZWZpbmVkICYmIGRhdGEgIT09IG51bGwgJiYgZGF0YS5DYXVzZXNJbm5lckxpc3QgIT09IHVuZGVmaW5lZCkge1xyXG4gICAgICAgICAgICAgICAgLy8gICAgICAgICRzY29wZS5jYXVzZXNEYXRhID0gZGF0YS5DYXVzZXNJbm5lckxpc3Q7XHJcbiAgICAgICAgICAgICAgICAvLyAgICB9XHJcbiAgICAgICAgICAgICAgICAvL30pO1xyXG4gICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICBsaW5rOiBmdW5jdGlvbihzY29wZSwgZWwsIGF0dHJzKSB7fVxyXG4gICAgICAgIH07XHJcbiAgICB9XHJcbl0pOyIsIlwidXNlIHN0cmljdFwiO1xyXG5hbmd1bGFyLm1vZHVsZSgnYXBwJykuZGlyZWN0aXZlKCduYXZjb25NeXJlcG9ydCcsIFsnJHJvb3RTY29wZScsICdkYXRhc2VydmljZScsXHJcbiAgICBmdW5jdGlvbigkcm9vdFNjb3BlLCBkYXRhc2VydmljZSkge1xyXG4gICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgIHJlc3RyaWN0OiAnRScsXHJcbiAgICAgICAgICAgIC8vdGVtcGxhdGVVcmw6ICdhcHAvZGFzaGJvYXJkL2RpcmVjdGl2ZXMvbXlyZXBvcnRUZW1wbGF0ZS5odG1sJyxcclxuICAgICAgICAgICAgdGVtcGxhdGVVcmw6IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIG5hdmNvbi5NZW51cm91dGUuZ2V0VGVtcGxhdGVVcmwoXCJteXJlcG9ydFRlbXBsYXRlXCIpO1xyXG4gICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICBjb250cm9sbGVyOiBmdW5jdGlvbigkc2NvcGUpIHtcclxuICAgICAgICAgICAgICAgICRzY29wZS5uYXZjb25EYXRhID0gJHNjb3BlO1xyXG4gICAgICAgICAgICAgICAgJHNjb3BlLnJlcG9ydCA9ICRzY29wZS5pdGVtLnJlcG9ydDtcclxuICAgICAgICAgICAgICAgICRzY29wZS50aXRsZSA9ICRzY29wZS5pdGVtLnRpdGxlLnRvU3RyaW5nKClcclxuXHJcbiAgICAgICAgICAgICAgICAvLyAgICBkYXRhc2VydmljZS5nZXREYXRhKCRzY29wZS5yZXBvcnRDYXRlZ29yeStcIi9HZXRBbGxSZXBvcnRzXCIpLnRoZW4oZnVuY3Rpb24gKGRhdGEpIHtcclxuICAgICAgICAgICAgICAgIC8vICAgICAgICAkc2NvcGUucmVwb3J0cyA9IGRhdGE7XHJcbiAgICAgICAgICAgICAgICAvLyAgICB9KTtcclxuICAgICAgICAgICAgICAgIC8vICAgICRzY29wZS5yZXBvcnQgPSB7fTtcclxuXHJcbiAgICAgICAgICAgICAgICAkKFwiI215RmF2IHVsXCIpLmNoaWxkcmVuKCkuZWFjaChmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgICAgICAgICAkKHRoaXMpLnJlbW92ZUNsYXNzKCdoaWdobGlnaHQnKTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgICAgICQoXCIjYWxsUmVwb3J0cyB1bFwiKS5jaGlsZHJlbigpLmVhY2goZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgJCh0aGlzKS5yZW1vdmVDbGFzcygnaGlnaGxpZ2h0Jyk7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgICAgICAvLyQoZXZlbnQuY3VycmVudFRhcmdldCkuYWRkQ2xhc3MoJ2hpZ2hsaWdodCcpO1xyXG4gICAgICAgICAgICAgICAgLy8kc2NvcGUucmVwb3J0LnRpdGxlID0gJHNjb3BlLnRpdGxlO1xyXG4gICAgICAgICAgICAgICAgLy8kc2NvcGUucnBvcnRJZCA9ICRzY29wZS5yZXBvcnQuUmVwb3J0RGV0YWlsSWQ7XHJcbiAgICAgICAgICAgICAgICAvLyRzY29wZS5yZXBvcnQuc291cmNlID0gXCJcIjtcclxuICAgICAgICAgICAgICAgIC8vJHNjb3BlLnJlcG9ydC5wcmV2aWV3SW1hZ2UgPSBcIlwiO1xyXG5cclxuICAgICAgICAgICAgICAgIG5hdmNvbi5jYWxsUHJpbnQoJHNjb3BlLnJlcG9ydCwgJHNjb3BlLnJlcG9ydC5SZXBvcnREZXRhaWxJZCwgZnVuY3Rpb24oKSB7XHJcblxyXG4gICAgICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICAgICAgLy8gICAgJHNjb3BlLmdlbmVyYXRlID0gZnVuY3Rpb24oKXtcclxuICAgICAgICAgICAgICAgIC8vICAgICAgICBuYXZjb24uY2FsbFByaW50KCRzY29wZS5yZXBvcnQsICRzY29wZS5ycG9ydElkLCBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICAvLyAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICAvLyAgICAgICAgJCgnI3JlcG9ydHByZXZpZXcnKS5oaWRlKCk7XHJcbiAgICAgICAgICAgICAgICAvLyAgICAgICAgJCgnI3JlcG9ydGdlbmVyYXRlJykuc2hvdygpO1xyXG4gICAgICAgICAgICAgICAgLy8gICAgfTtcclxuXHJcbiAgICAgICAgICAgICAgICAvLyAgICAkc2NvcGUucmV0dXJudG9yZXBvcnQgPSBmdW5jdGlvbigpe1xyXG4gICAgICAgICAgICAgICAgLy8gICAgICAgICQoJyNyZXBvcnRwcmV2aWV3Jykuc2hvdygpO1xyXG4gICAgICAgICAgICAgICAgLy8gICAgICAgICQoJyNyZXBvcnRnZW5lcmF0ZScpLmhpZGUoKTtcclxuXHJcbiAgICAgICAgICAgICAgICAvLyAgICB9O1xyXG5cclxuICAgICAgICAgICAgICAgIC8vICAgICRzY29wZS5jb21wYXJlID0gZnVuY3Rpb24oKXtcclxuICAgICAgICAgICAgICAgIC8vICAgICAgICBpZihzY29wZS5pc1NwbGl0KVxyXG4gICAgICAgICAgICAgICAgLy8gICAgICAgICAgICAkc2NvcGUuaXNTcGxpdCA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgLy8gICAgICAgIGVsc2VcclxuICAgICAgICAgICAgICAgIC8vICAgICAgICAgICAgJHNjb3BlLmlzU3BsaXQgPSB0cnVlO1xyXG5cclxuICAgICAgICAgICAgICAgIC8vICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAvLyAgICAkKFwiI215RmF2IHVsXCIpLmNoaWxkcmVuKCkuZWFjaChmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICAvLyAgICAgICAgJCh0aGlzKS5yZW1vdmVDbGFzcygnaGlnaGxpZ2h0Jyk7XHJcbiAgICAgICAgICAgICAgICAvLyAgICB9KTtcclxuICAgICAgICAgICAgICAgIC8vICAgICQoXCIjYWxsUmVwb3J0cyB1bFwiKS5jaGlsZHJlbigpLmVhY2goZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgLy8gICAgICAgICQodGhpcykucmVtb3ZlQ2xhc3MoJ2hpZ2hsaWdodCcpO1xyXG4gICAgICAgICAgICAgICAgLy8gICAgfSk7XHJcblxyXG4gICAgICAgICAgICAgICAgLy8gICAgJHNjb3BlLnJlcG9ydENsaWNrID0gZnVuY3Rpb24gKGV2ZW50LCByZXBvcnQpIHtcclxuXHJcbiAgICAgICAgICAgICAgICAvLyAgICAgICAgJChcIiNteUZhdiB1bFwiKS5jaGlsZHJlbigpLmVhY2goZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgLy8gICAgICAgICAgICAkKHRoaXMpLnJlbW92ZUNsYXNzKCdoaWdobGlnaHQnKTtcclxuICAgICAgICAgICAgICAgIC8vICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgICAgICAvLyAgICAgICAgJChcIiNhbGxSZXBvcnRzIHVsXCIpLmNoaWxkcmVuKCkuZWFjaChmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICAvLyAgICAgICAgICAgICQodGhpcykucmVtb3ZlQ2xhc3MoJ2hpZ2hsaWdodCcpO1xyXG4gICAgICAgICAgICAgICAgLy8gICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgICAgIC8vICAgICAgICAkKGV2ZW50LmN1cnJlbnRUYXJnZXQpLmFkZENsYXNzKCdoaWdobGlnaHQnKTtcclxuICAgICAgICAgICAgICAgIC8vICAgICAgICAkc2NvcGUucmVwb3J0LnRpdGxlID0gcmVwb3J0LlJlcG9ydE5hbWU7XHJcbiAgICAgICAgICAgICAgICAvLyAgICAgICAgJHNjb3BlLnJwb3J0SWQgPSByZXBvcnQuUmVwb3J0RGV0YWlsSWQ7XHJcbiAgICAgICAgICAgICAgICAvLyAgICAgICAgJHNjb3BlLnJlcG9ydC5zb3VyY2UgPSBcIlwiO1xyXG4gICAgICAgICAgICAgICAgLy8gICAgICAgICRzY29wZS5yZXBvcnQucHJldmlld0ltYWdlID0gXCJcIjtcclxuICAgICAgICAgICAgICAgIC8vICAgIH07XHJcbiAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgIGxpbms6IGZ1bmN0aW9uKHNjb3BlLCBlbCwgYXR0cnMpIHt9XHJcbiAgICAgICAgfTtcclxuICAgIH1cclxuXSk7IiwiXCJ1c2Ugc3RyaWN0XCI7XHJcbmFuZ3VsYXIubW9kdWxlKCdhcHAnKS5kaXJlY3RpdmUoJ25hdmNvbk15cmlza21hdHJpeCcsIFsnJHJvb3RTY29wZScsICdkYXRhc2VydmljZScsICckdGltZW91dCcsXHJcbiAgICBmdW5jdGlvbigkcm9vdFNjb3BlLCBkYXRhc2VydmljZSwgJHRpbWVvdXQpIHtcclxuICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICByZXN0cmljdDogJ0FFJyxcclxuICAgICAgICAgICAgLy90ZW1wbGF0ZVVybDogJ2FwcC9kYXNoYm9hcmQvZGlyZWN0aXZlcy9teXJpc2ttYXRyaXhUZW1wbGF0ZS5odG1sJyxcclxuICAgICAgICAgICAgdGVtcGxhdGVVcmw6IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIG5hdmNvbi5NZW51cm91dGUuZ2V0VGVtcGxhdGVVcmwoXCJteXJpc2ttYXRyaXhUZW1wbGF0ZVwiKTtcclxuICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgY29udHJvbGxlcjogZnVuY3Rpb24oJHNjb3BlKSB7XHJcbiAgICAgICAgICAgICAgICAkc2NvcGUucmVhZE9ubHkgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgJHNjb3BlLm5hdmNvbkRhdGEgPSAkc2NvcGU7XHJcbiAgICAgICAgICAgICAgICAkc2NvcGUucmlza01hdHJpeERhdGEgPSBbXTtcclxuXHJcbiAgICAgICAgICAgICAgICAkc2NvcGUudGl0bGUgPSAkc2NvcGUuaXRlbS50aXRsZS50b1N0cmluZygpO1xyXG4gICAgICAgICAgICAgICAgJHNjb3BlLnN1YlRpdGxlID0gJHNjb3BlLml0ZW0uc3ViVGl0bGUudG9TdHJpbmcoKTtcclxuICAgICAgICAgICAgICAgICRzY29wZS5tb2R1bGVJZCA9ICRzY29wZS5pdGVtLk1vZHVsZUlkO1xyXG4gICAgICAgICAgICAgICAgJHNjb3BlLnByb2plY3RJZCA9ICRzY29wZS5pdGVtLlByb2plY3RJZDtcclxuICAgICAgICAgICAgICAgICRzY29wZS53aWRnZXRJZCA9ICRzY29wZS5pdGVtLndpZGdldElkLnRvU3RyaW5nKCk7XHJcbiAgICAgICAgICAgICAgICAkc2NvcGUucmVwb3J0VHlwZSA9ICRzY29wZS5pdGVtLnJlcG9ydFR5cGU7XHJcblxyXG4gICAgICAgICAgICAgICAgJHNjb3BlLm9wdGlvbnMgPSAkc2NvcGUuaXRlbS5vcHRpb25zO1xyXG5cclxuICAgICAgICAgICAgICAgICRzY29wZS5yZXBvcnRJZCA9ICRzY29wZS5pdGVtLkZpbHRlcklkO1xyXG4gICAgICAgICAgICAgICAgJHNjb3BlLkZpbHRlcktleSA9ICRzY29wZS5pdGVtLkZpbHRlcktleTtcclxuXHJcbiAgICAgICAgICAgICAgICAkc2NvcGUuZmlsdGVyU3RhcnQgPSAkc2NvcGUuaXRlbS5maWx0ZXJTdGFydDtcclxuICAgICAgICAgICAgICAgICRzY29wZS5maWx0ZXJFbmQgPSAkc2NvcGUuaXRlbS5maWx0ZXJFbmQ7XHJcblxyXG4gICAgICAgICAgICAgICAgJHNjb3BlLmZpbHRlclBhcmFtZXRlciA9IFwiXCI7XHJcbiAgICAgICAgICAgICAgICBpZiAoJHNjb3BlLnRpdGxlLnRvTG93ZXJDYXNlKCkgPT09IFwiaGF6YXJkIHByZS1taXRpZ2F0aW9uIHJpc2sgY2xhc3NcIilcclxuICAgICAgICAgICAgICAgICAgICAkc2NvcGUuZmlsdGVyUGFyYW1ldGVyID0gXCJDYXVzZUFuYWx5c2lzL0dldFJpc2tNYXRyaXhQcmVQb3N0L1wiICsgJHNjb3BlLnByb2plY3RJZCArIFwiLzFcIjtcclxuICAgICAgICAgICAgICAgIGVsc2UgaWYgKCRzY29wZS50aXRsZS50b0xvd2VyQ2FzZSgpID09PSBcImhhemFyZCBwb3N0IG1pdGlnYXRpb24gcmlzayBjbGFzc1wiKVxyXG4gICAgICAgICAgICAgICAgICAgICRzY29wZS5maWx0ZXJQYXJhbWV0ZXIgPSBcIkNhdXNlQW5hbHlzaXMvR2V0Umlza01hdHJpeFByZVBvc3QvXCIgKyAkc2NvcGUucHJvamVjdElkICsgXCIvMlwiO1xyXG4gICAgICAgICAgICAgICAgZWxzZSBpZiAoJHNjb3BlLnRpdGxlLnRvTG93ZXJDYXNlKCkgPT09IFwiaGF6YXJkIHJpc2sgbWF0cml4IGFnZ3JlZ2F0aW9uXCIpXHJcbiAgICAgICAgICAgICAgICAgICAgJHNjb3BlLmZpbHRlclBhcmFtZXRlciA9IFwiQ2F1c2VBbmFseXNpcy9HZXRSaXNrTWF0cml4Rm9yQWdncmVnYXRpb24vXCIgKyAkc2NvcGUucHJvamVjdElkO1xyXG5cclxuICAgICAgICAgICAgICAgIC8vJHNjb3BlLnJlcG9ydCA9ICRzY29wZS5pdGVtLnJlcG9ydDtcclxuICAgICAgICAgICAgICAgIC8vJHNjb3BlLnRpdGxlID0gJHNjb3BlLml0ZW0udGl0bGUudG9TdHJpbmcoKTtcclxuICAgICAgICAgICAgICAgIC8vJHNjb3BlLmNhdXNlc0NvdW50ID0gJHNjb3BlLml0ZW0uZGF0YTtcclxuXHJcbiAgICAgICAgICAgICAgICBmdW5jdGlvbiBnZXRTZXJ2ZXJEYXRhKHR5cGUsIHJvd0lkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGRhdGFzZXJ2aWNlLmdldFNlcnZlckRhdGEodHlwZSwgcm93SWQpLnRoZW4oZnVuY3Rpb24oZGF0YSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZGF0YTtcclxuICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgIH07XHJcblxyXG4gICAgICAgICAgICAgICAgJHNjb3BlLiR3YXRjaCgncHJvamVjdElkJywgZnVuY3Rpb24obmV3VmFsdWUsIG9sZFZhbHVlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKG5ld1ZhbHVlICE9PSB1bmRlZmluZWQgJiYgbmV3VmFsdWUgIT09IFwiXCIgJiYgJHNjb3BlLmZpbHRlclBhcmFtZXRlciAhPT0gXCJcIikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBnZXRSaXNrTWF0cml4KG5ld1ZhbHVlKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9LCB0cnVlKTtcclxuXHJcbiAgICAgICAgICAgICAgICAvL2RhdGFzZXJ2aWNlLmdldERhdGEoXCJSaXNrTWF0cml4L0dldFJpc2tNYXRyaXhBTExcIikudGhlbihmdW5jdGlvbiAoZGF0YSkge1xyXG4gICAgICAgICAgICAgICAgLy8gICAgaWYgKGRhdGEgIT09IHVuZGVmaW5lZCAmJiBkYXRhICE9PSBudWxsKSB7XHJcbiAgICAgICAgICAgICAgICAvLyAgICAgICAgJHNjb3BlLnJpc2ttYXRyaXhUYWJsZS5kYXRhID0gZGF0YTtcclxuICAgICAgICAgICAgICAgIC8vICAgICAgICAkc2NvcGUucmVhZG9ubHkgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgLy8gICAgfVxyXG4gICAgICAgICAgICAgICAgLy99KTtcclxuXHJcbiAgICAgICAgICAgICAgICBmdW5jdGlvbiBnZXRSaXNrTWF0cml4KHByb2plY3RJZCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBzZXZlcml0eURhdGEgPSBbXTtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgcHJvYmFsaWxpdHlEYXRhID0gW107XHJcbiAgICAgICAgICAgICAgICAgICAgLy8gQ2hlY2sgd2hldGhlciBwcm9qZWN0IGhhcyBzZWNlcml0eSB0aGVuIG9ubHkgcmlzayBtYXRyaXggdG8gYmUgZm9ybWVkXHJcblxyXG4gICAgICAgICAgICAgICAgICAgIC8vZGF0YXNlcnZpY2UuZ2V0RGF0YShcIkNhdXNlQW5hbHlzaXMvR2V0Umlza01hdHJpeFByZVBvc3QvXCIgKyBwcm9qZWN0SWQgKyBcIi8xXCIpLnRoZW4oZnVuY3Rpb24gKGRhdGEpIHtcclxuICAgICAgICAgICAgICAgICAgICAvLyAgICB2YXIgY3VycmVudERhdGEgPSBkYXRhO1xyXG4gICAgICAgICAgICAgICAgICAgIC8vfSk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGRhdGFzZXJ2aWNlLmdldERhdGEoXCJTZXZlcml0eS9HZXRTZXZlcml0eUJ5UHJvamVjdElkL1wiICsgcHJvamVjdElkKS50aGVuKGZ1bmN0aW9uKGRhdGEpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGRhdGEgIT09IHVuZGVmaW5lZCAmJiBkYXRhLmxlbmd0aCAhPT0gMCAmJiBkYXRhICE9PSBudWxsKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZXZlcml0eURhdGEgPSBkYXRhO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZGF0YXNlcnZpY2UuZ2V0RGF0YShcIkNhdXNlRGV0YWlsL0dldFByb2JhYmlsaXR5QnlQcm9qZWN0SWQvXCIgKyBwcm9qZWN0SWQpLnRoZW4oZnVuY3Rpb24oZGF0YSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChkYXRhID09PSB1bmRlZmluZWQgfHwgZGF0YS5sZW5ndGggPT09IDApIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy9sb2dnZXIud2FybmluZyhcIlByb2JhYmlsaXR5IE5vdCBZZXQgQXNzaWduZWQgdG8gdGhpcyBwcm9qZWN0ICFcIiwgXCJcIiwgXCJcIik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRzY29wZS5zaG93Umlza01hdHJpeFRhYmxlID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcm9iYWxpbGl0eURhdGEgPSBkYXRhO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkYXRhc2VydmljZS5nZXREYXRhKFwiUmlza0NsYXNzL0dldFJpc2tDbGFzc0J5UHJvamVjdElkL1wiICsgcHJvamVjdElkKS50aGVuKGZ1bmN0aW9uKGRhdGEpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChkYXRhICE9PSB1bmRlZmluZWQgJiYgZGF0YSAhPT0gbnVsbCAmJiBkYXRhLmxlbmd0aCAhPT0gMCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRzY29wZS5yaXNrQ2xhc3NlcyA9IGRhdGE7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vbG9nZ2VyLndhcm5pbmcoXCJSaXNrIENsYXNzIE5vdCBZZXQgQXNzaWduZWQgdG8gdGhpcyBwcm9qZWN0ICFcIiwgXCJcIiwgXCJcIik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJHNjb3BlLnNob3dSaXNrTWF0cml4VGFibGUgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJHNjb3BlLnJpc2tNYXRyaXhEYXRhID0gW107XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy9kYXRhc2VydmljZS5nZXREYXRhKFwiQ2F1c2VBbmFseXNpcy9HZXRNYXBwaW5nUmlza1JlZ2lzdGVyL1wiICsgcHJvamVjdElkKS50aGVuKGZ1bmN0aW9uIChkYXRhKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGF0YXNlcnZpY2UuZ2V0RGF0YSgkc2NvcGUuZmlsdGVyUGFyYW1ldGVyKS50aGVuKGZ1bmN0aW9uKGRhdGEpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGRhdGEgIT09IHVuZGVmaW5lZCAmJiBkYXRhICE9PSBudWxsICYmIGRhdGEubGVuZ3RoICE9PSAwKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkc2NvcGUucmlza01hdHJpeERhdGEgPSBkYXRhO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGRhdGEgIT09IHVuZGVmaW5lZCAmJiBkYXRhWzBdICE9PSB1bmRlZmluZWQgJiYgZGF0YVswXS5saXN0ICE9PSB1bmRlZmluZWQgJiYgZGF0YVswXS5saXN0ICE9PSBudWxsICYmIGRhdGFbMF0ubGlzdC5sZW5ndGggIT09IDApIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkc2NvcGUubW9kZSA9IFwidXBkYXRlXCI7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJHNjb3BlLlNldmVyaXR5VGFibGUgPSBkYXRhWzBdLmxpc3Q7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJHNjb3BlLnNob3dSaXNrTWF0cml4VGFibGUgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChkYXRhWzBdLmxpc3QgIT09IHVuZGVmaW5lZCAmJiBkYXRhWzBdLmxpc3QgIT09IG51bGwgJiYgZGF0YVswXS5saXN0Lmxlbmd0aCA9PSAwKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJHNjb3BlLm1vZGUgPSBcInNhdmVcIjtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgb2JqID0ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcIlJpc0NsYXNzSWRcIjogMCxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJSaXNrTWF0cml4SWRcIjogMCxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJiYWNrZ3JvdW5kXCI6IFwiI2ZmZmZmZlwiLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcImNvbG9yXCI6IFwiIzAwMDAwMFwiLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcImxldmVsXCI6IFwiXCIsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwic2V2ZXJpdHlcIjogXCJcIixcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJzaWRcIjogMFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJHNjb3BlLlNldmVyaXR5VGFibGUgPSBbXTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJC5lYWNoKCRzY29wZS5yaXNrTWF0cml4RGF0YSwgZnVuY3Rpb24oaW5kZXgsIHZhbHVlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICQuZWFjaChzZXZlcml0eURhdGEsIGZ1bmN0aW9uKGtleSwgaXRlbSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gICBjb25zb2xlLmxvZyhzZXZlcml0eURhdGEpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gICAgIG9iai5zZXZlcml0eSA9IGl0ZW0uU2V2ZXJpdHlOYW1lO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gICBvYmouc2lkID0gaXRlbS5TZXZlcml0eUlkO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGluZGV4ID09IDApIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkc2NvcGUuU2V2ZXJpdHlUYWJsZS5wdXNoKHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJSaXNDbGFzc0lkXCI6IDAsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwiUmlza01hdHJpeElkXCI6IDAsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwiYmFja2dyb3VuZFwiOiBcIiNmZmZmZmZcIixcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJjb2xvclwiOiBcIiMwMDAwMDBcIixcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJsZXZlbFwiOiBcIlwiLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcInNldmVyaXR5XCI6IGl0ZW0uU2V2ZXJpdHlOYW1lLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcInNpZFwiOiBpdGVtLlNldmVyaXR5SWRcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlLmxpc3QucHVzaCh7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJSaXNDbGFzc0lkXCI6IDAsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJSaXNrTWF0cml4SWRcIjogMCxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcImJhY2tncm91bmRcIjogXCIjZmZmZmZmXCIsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJjb2xvclwiOiBcIiMwMDAwMDBcIixcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcImxldmVsXCI6IFwiXCIsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJzZXZlcml0eVwiOiBpdGVtLlNldmVyaXR5TmFtZSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcInNpZFwiOiBpdGVtLlNldmVyaXR5SWRcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSlcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRzY29wZS5tb2RlID0gXCJzYXZlXCI7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRzY29wZS5zaG93Umlza01hdHJpeFRhYmxlID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KVxyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJHNjb3BlLm1vZGUgPSBcInNhdmVcIjtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIG9iaiA9IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJSaXNDbGFzc0lkXCI6IDAsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwiUmlza01hdHJpeElkXCI6IDAsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwiYmFja2dyb3VuZFwiOiBcIiNmZmZmZmZcIixcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJjb2xvclwiOiBcIiMwMDAwMDBcIixcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJsZXZlbFwiOiBcIlwiLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcInNldmVyaXR5XCI6IFwiXCIsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwic2lkXCI6IDBcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vc2V2ZXJpdHlEYXRhXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJC5tYXAoc2V2ZXJpdHlEYXRhLCBmdW5jdGlvbihlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChlW1wiU2V2ZXJpdHlOYW1lXCJdICE9PSB1bmRlZmluZWQgJiYgZVtcIlNldmVyaXR5TmFtZVwiXSAhPT0gbnVsbCAmJiBlW1wiU2V2ZXJpdHlOYW1lXCJdICE9PSAnJykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb2JqLnNldmVyaXR5ID0gZVtcIlNldmVyaXR5TmFtZVwiXTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGVbXCJTZXZlcml0eUlkXCJdICE9PSB1bmRlZmluZWQgJiYgZVtcIlNldmVyaXR5SWRcIl0gIT09IG51bGwgJiYgZVtcIlNldmVyaXR5SWRcIl0gIT09ICcnKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvYmouc2lkID0gZVtcIlNldmVyaXR5SWRcIl07XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGF0YVswXS5saXN0LnB1c2gob2JqKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkc2NvcGUuU2V2ZXJpdHlUYWJsZSA9IGRhdGFbMF0ubGlzdDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkc2NvcGUuc2hvd1Jpc2tNYXRyaXhUYWJsZSA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvL2lmICgkc2NvcGUub3B0aW9ucy5maWx0ZXIgIT09IHVuZGVmaW5lZCAmJiAkc2NvcGUub3B0aW9ucy5maWx0ZXIpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vICAgIC8vZmlsdGVyU3RhcnQgPSBmaWx0ZXJTdGFydC5zdGFydE9mKCdtb250aCcpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gICAgZmlsdGVyU2V0dGluZygpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy99XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICBmdW5jdGlvbiBmaWx0ZXJTZXR0aW5nKCkge1xyXG4gICAgICAgICAgICAgICAgICAgIC8vdmFyIGZpbHRlclN0YXJ0ID0gbW9tZW50KCkuc3RhcnRPZigneWVhcicpO1xyXG4gICAgICAgICAgICAgICAgICAgIC8vdmFyIGZpbHRlckVuZCA9IG1vbWVudCgpO1xyXG4gICAgICAgICAgICAgICAgICAgICR0aW1lb3V0KGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAkKCcjcmVwb3J0cmFuZ2VfJyArICRzY29wZS53aWRnZXRJZCkuZGF0ZXJhbmdlcGlja2VyKHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGF1dG9VcGRhdGVJbnB1dDogdHJ1ZSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNob3dEcm9wZG93bnM6IHRydWUsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aW1lUGlja2VyOiBmYWxzZSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1pbkRhdGU6IG1vbWVudCgpLnN1YnRyYWN0KDI4MCwgJ21vbnRocycpLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbWF4RGF0ZTogbW9tZW50KCksXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGFydERhdGU6ICRzY29wZS5maWx0ZXJTdGFydCxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZERhdGU6ICRzY29wZS5maWx0ZXJFbmQsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBvcGVuczogJ2xlZnQnLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYnV0dG9uQ2xhc3NlczogWydidG4gYnRuLWRlZmF1bHQnXSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFwcGx5Q2xhc3M6ICdidG4tc21hbGwgYnRuLXByaW1hcnknLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FuY2VsQ2xhc3M6ICdidG4tc21hbGwnLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9ybWF0OiBuYXZjb24uZGVmYXVsdEZvcm1hdCgpLmRhdGV0aW1lLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VwYXJhdG9yOiAnIHRvICcsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvKmRhdGVMaW1pdDoge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRheXM6IDYwXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LCovXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByYW5nZXM6IHt9LFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9jYWxlOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9ybWF0OiBuYXZjb24uZGVmYXVsdEZvcm1hdCgpLmRhdGV0aW1lLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFwcGx5TGFiZWw6ICdTdWJtaXQnLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhbmNlbExhYmVsOiAnQ2xlYXInLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZyb21MYWJlbDogJ0Zyb20nLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRvTGFiZWw6ICdUbycsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY3VzdG9tUmFuZ2VMYWJlbDogJ0N1c3RvbScsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGF5c09mV2VlazogWydTdScsICdNbycsICdUdScsICdXZScsICdUaCcsICdGcicsICdTYSddLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1vbnRoTmFtZXM6IFsnSmFudWFyeScsICdGZWJydWFyeScsICdNYXJjaCcsICdBcHJpbCcsICdNYXknLCAnSnVuZScsICdKdWx5JywgJ0F1Z3VzdCcsICdTZXB0ZW1iZXInLCAnT2N0b2JlcicsICdOb3ZlbWJlcicsICdEZWNlbWJlciddLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpcnN0RGF5OiAxXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0sIGZ1bmN0aW9uKHN0YXJ0LCBlbmQsIGxhYmVsKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYihzdGFydCwgZW5kLCBsYWJlbCk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJHNjb3BlLmZpbHRlclN0YXJ0ID0gc3RhcnQ7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkc2NvcGUuZmlsdGVyRW5kID0gZW5kO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9hZENoYXJ0UmVwb3J0KCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgfTtcclxuXHJcbiAgICAgICAgICAgICAgICB2YXIgY2IgPSBmdW5jdGlvbihzdGFydER0LCBlbmREdCwgbGFiZWwpIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoc3RhcnREdCAhPT0gdW5kZWZpbmVkICYmIGVuZER0ICE9PSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgJHRpbWVvdXQoZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkKCcjcmVwb3J0cmFuZ2VfJyArICRzY29wZS53aWRnZXRJZCArICcgc3BhbicpLmh0bWwoc3RhcnREdC5mb3JtYXQobmF2Y29uLmRlZmF1bHRGb3JtYXQoKS5kYXRlRGlzcGxheSkgKyAnIC0gJyArIGVuZER0LmZvcm1hdChuYXZjb24uZGVmYXVsdEZvcm1hdCgpLmRhdGVEaXNwbGF5KSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkc2NvcGUuY2hhcnRGaWx0ZXJEYXRhID0gc3RhcnREdC5mb3JtYXQobmF2Y29uLmRlZmF1bHRGb3JtYXQoKS5kYXRlRGlzcGxheSkgKyAnIC0gJyArIGVuZER0LmZvcm1hdChuYXZjb24uZGVmYXVsdEZvcm1hdCgpLmRhdGVEaXNwbGF5KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgbGluazogZnVuY3Rpb24oc2NvcGUsIGVsLCBhdHRycykge31cclxuICAgICAgICB9O1xyXG4gICAgfVxyXG5dKTsiLCJcInVzZSBzdHJpY3RcIjtcclxuYW5ndWxhci5tb2R1bGUoJ2FwcCcpLmRpcmVjdGl2ZSgnbmF2Y29uTXlzdW1tYXJ5JywgWyckcm9vdFNjb3BlJywgJ2RhdGFzZXJ2aWNlJywgJyR0aW1lb3V0JywgJ25nQXV0aFNldHRpbmdzJyxcclxuICAgIGZ1bmN0aW9uKCRyb290U2NvcGUsIGRhdGFzZXJ2aWNlLCAkdGltZW91dCwgbmdBdXRoU2V0dGluZ3MpIHtcclxuICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICByZXN0cmljdDogJ0FFJyxcclxuICAgICAgICAgICAgLy90ZW1wbGF0ZVVybDogJ2FwcC9kYXNoYm9hcmQvZGlyZWN0aXZlcy9teXN1bW1hcnlUZW1wbGF0ZS5odG1sJyxcclxuICAgICAgICAgICAgdGVtcGxhdGVVcmw6IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIG5hdmNvbi5NZW51cm91dGUuZ2V0VGVtcGxhdGVVcmwoXCJteXN1bW1hcnlUZW1wbGF0ZVwiKTtcclxuICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgY29udHJvbGxlcjogZnVuY3Rpb24oJHNjb3BlKSB7XHJcbiAgICAgICAgICAgICAgICAkc2NvcGUudXBsb2FkQmFzZSA9IG5nQXV0aFNldHRpbmdzLnVwbG9hZFBhdGg7XHJcbiAgICAgICAgICAgICAgICAkc2NvcGUuc3VtbWFyeUlkID0gJHNjb3BlLml0ZW0ud2lkZ2V0SWQ7XHJcbiAgICAgICAgICAgICAgICAkc2NvcGUudGl0bGUgPSAkc2NvcGUuaXRlbS50aXRsZS50b1N0cmluZygpXHJcbiAgICAgICAgICAgICAgICAkc2NvcGUuc3ViVGl0bGUgPSAkc2NvcGUuaXRlbS50aXRsZS50b1N0cmluZygpXHJcbiAgICAgICAgICAgICAgICAkc2NvcGUuZGF0YSA9ICRzY29wZS5pdGVtLmRhdGE7XHJcblxyXG4gICAgICAgICAgICAgICAgLy8kc2NvcGUuZGF0YSA9IFtdO1xyXG4gICAgICAgICAgICAgICAgZnVuY3Rpb24gZ2V0U2VydmVyRGF0YSh0eXBlLCByb3dJZCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBkYXRhc2VydmljZS5nZXRTZXJ2ZXJEYXRhKHR5cGUsIHJvd0lkKS50aGVuKGZ1bmN0aW9uKGRhdGEpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGRhdGE7XHJcbiAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICB9O1xyXG5cclxuICAgICAgICAgICAgICAgIGFjdGl2YXRlKCk7XHJcblxyXG4gICAgICAgICAgICAgICAgZnVuY3Rpb24gYWN0aXZhdGUoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKCRzY29wZS5kYXRhLmxlbmd0aCA9PT0gMCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBnZXRTZXJ2ZXJEYXRhKFwibXlTcGFjZU5ld3NcIikudGhlbihmdW5jdGlvbihkYXRhKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoZGF0YSA9PT0gdW5kZWZpbmVkIHx8IGRhdGEubGVuZ3RoID09PSAwKSByZXR1cm47XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkc2NvcGUuZGF0YSA9IGRhdGE7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgbGluazogZnVuY3Rpb24oJHNjb3BlLCBlbCwgYXR0cnMpIHtcclxuXHJcbiAgICAgICAgICAgICAgICAkc2NvcGUub3BlbkltYWdlID0gZnVuY3Rpb24ob2JqKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgJHNjb3BlLk5ld3NUaXRsZSA9IG9iai5OZXdzVGl0bGU7XHJcbiAgICAgICAgICAgICAgICAgICAgJHNjb3BlLkNyZWF0ZURhdGUgPSBvYmouQ3JlYXRlRGF0ZTtcclxuICAgICAgICAgICAgICAgICAgICAkc2NvcGUuVXBkYXRlZEJ5TmFtZSA9IG9iai5VcGRhdGVkQnlOYW1lO1xyXG4gICAgICAgICAgICAgICAgICAgICRzY29wZS5TdW1tYXJ5ID0gb2JqLlN1bW1hcnkucmVwbGFjZSgvXFxiKGh0dHBzPzpcXC9cXC9bXlxcc1xcKFxcKVxcJ1xcXCJcXDxcXD5dKykvaWcsIFwiPGEgcmVmPSdub2ZvbGxvdycgaHJlZj0nJDEnIHRhcmdldD0nX2JsYW5rJz4kMTwvYT5cIik7XHJcbiAgICAgICAgICAgICAgICAgICAgJHNjb3BlLlN1bW1hcnkgPSAkc2NvcGUuU3VtbWFyeS5yZXBsYWNlKC8oPzpcXHJcXG58XFxyfFxcbikvZywgJzxiciAvPicpOztcclxuICAgICAgICAgICAgICAgICAgICAkc2NvcGUuQ29udGVudFR5cGUgPSBvYmouQ29udGVudFR5cGU7XHJcbiAgICAgICAgICAgICAgICAgICAgJHNjb3BlLmRvY3VtZW50SWQgPSBvYmouZG9jdW1lbnRJZDtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoJHNjb3BlLmRvY3VtZW50SWQgIT0gXCJcIiAmJiAkc2NvcGUuZG9jdW1lbnRJZCAhPSBudWxsKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGRhdGFzZXJ2aWNlLmdldERhdGEoJ015U3BhY2UvR2V0SW1hZ2Vmb3JCdWxsZXRpbi8nICsgb2JqLmRvY3VtZW50SWQpLnRoZW4oZnVuY3Rpb24oZGF0YSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJHNjb3BlLkltZyA9ICRzY29wZS5Db250ZW50VHlwZSArIGRhdGE7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkKCcjbW9kYWxJbWcnKS5tb2RhbCgnc2hvdycpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAkc2NvcGUuSW1nID0gXCJcIjtcclxuICAgICAgICAgICAgICAgICAgICAgICAgJCgnI21vZGFsSW1nJykubW9kYWwoJ3Nob3cnKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG5cclxuICAgICAgICAgICAgICAgIH1cclxuXHJcblxyXG4gICAgICAgICAgICAgICAgJHNjb3BlLiR3YXRjaCgnZGF0YScsIGZ1bmN0aW9uKG5ld1ZhbHVlLCBvbGRWYWx1ZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChuZXdWYWx1ZSAhPT0gdW5kZWZpbmVkKSB7IC8vJiYgbmV3VmFsdWUgIT09IG9sZFZhbHVlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICR0aW1lb3V0KGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCQoXCIuZGFzaGJvYXJkV2lkZ2V0X1wiICsgJHNjb3BlLnN1bW1hcnlJZCArIFwiXCIpLmxlbmd0aCAhPT0gMCAmJiAkKFwiW3R5cGU9bXlTcGFjZVN1bW1hcnlfXCIgKyAkc2NvcGUuc3VtbWFyeUlkICsgXCJdXCIpLmxlbmd0aCAhPT0gMCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciB3aWRnZXRIZWlnaHQgPSAkKFwiLmRhc2hib2FyZFdpZGdldF9cIiArICRzY29wZS5zdW1tYXJ5SWQgKyBcIlwiKS5oZWlnaHQoKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkKFwiW3R5cGU9bXlTcGFjZVN1bW1hcnlfXCIgKyAkc2NvcGUuc3VtbWFyeUlkICsgXCJdXCIpLmZpbmQoXCIucG9ydGxldC1ib2R5XCIpLmNzcyh7IFwib3ZlcmZsb3dcIjogXCJhdXRvXCIsIFwiaGVpZ2h0XCI6ICh3aWRnZXRIZWlnaHQgLSA1MCkgKyBcInB4XCIgfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8kLm1hcChuZXdWYWx1ZSwgZnVuY3Rpb24gKGl0ZW0sIGluZGV4KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyAgICBpZiAoJChcIi5zdW1tYXJ5Um93X1wiICsgaW5kZXggKyBcIlwiKS5sZW5ndGggIT09IDApIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vICAgICAgICBpZiAoaXRlbS5kb2N1bWVudHMgIT09IHVuZGVmaW5lZCAmJiBpdGVtLmRvY3VtZW50cyAhPT0gbnVsbCAmJiBpdGVtLmRvY3VtZW50cy5sZW5ndGggIT09IDApIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vICAgICAgICAgICAgdmFyIGltYWdlSGVpZ2h0ID0gJChcIi5zdW1tYXJ5VGVtcGxhdGUtaW1hZ2VcIikud2lkdGgoKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyAgICAgICAgICAgICQoXCIuc3VtbWFyeVJvd19cIiArIGluZGV4ICsgXCJcIikuY3NzKHsgXCJoZWlnaHRcIjogKGltYWdlSGVpZ2h0IC0gMzApICsgXCJweFwiIH0pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vICAgICAgICAgICAgJChcIi5zdW1tYXJ5Um93X1wiICsgaW5kZXggKyBcIlwiKS5jc3MoeyBcImhlaWdodFwiOiBcIlwiIH0pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vfSk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJChcIlt0eXBlPW15U3BhY2VTdW1tYXJ5X1wiICsgJHNjb3BlLnN1bW1hcnlJZCArIFwiXVwiKS5maW5kKFwiLnBvcnRsZXQtYm9keVwiKS5tQ3VzdG9tU2Nyb2xsYmFyKHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhdXRvSGlkZVNjcm9sbGJhcjogdHJ1ZSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGVtZTogXCIzZC1kYXJrXCIsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2Nyb2xsSW5lcnRpYTogMCxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzY3JvbGxiYXJQb3NpdGlvbjogXCJvdXRzaWRlXCJcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9LCB0cnVlKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH07XHJcbiAgICB9XHJcbl0pOyIsIlwidXNlIHN0cmljdFwiO1xyXG5hbmd1bGFyLm1vZHVsZSgnYXBwJykuZGlyZWN0aXZlKCduYXZjb25Mb2dpbicsIFsnJHJvb3RTY29wZScsICdkYXRhc2VydmljZScsICckbG9jYXRpb24nLCAnYXV0aFNlcnZpY2UnLCAnbmdBdXRoU2V0dGluZ3MnLFxyXG4gICAgICAgIGZ1bmN0aW9uKCRyb290U2NvcGUsIGRhdGFzZXJ2aWNlLCAkbG9jYXRpb24sIGF1dGhTZXJ2aWNlLCBuZ0F1dGhTZXR0aW5ncykge1xyXG5cclxuICAgICAgICAgICAgdm0gPSB0aGlzO1xyXG5cclxuICAgICAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgICAgIC8qRTogRGlyZWN0aXZlIGRlZmluZWQgYXMgYW4gZWxlbWVudC4gPG5hdmNvbi10YWJsZT48L25hdmNvbi10YWJsZT5cclxuICAgICAgICAgICAgICAgIEE6IERpcmVjdGl2ZSBhcHBsaWVkIGFzIGFuIGF0dHJpYnV0ZSBvbiBleGlzdGluZyBlbGVtZW50LiA8ZGl2IG5hdmNvbi10YWJsZT48L2Rpdj5cclxuICAgICAgICAgICAgICAgIEM6IERpcmVjdGl2ZSBhcHBsaWVkIGFzIGEgY3NzIGNsYXNzIHRvIGV4aXN0aW5nIGVsZW1lbnQgPGRpdiBjbGFzcz1cIm5hdmNvbi10YWJsZVwiPjwvZGl2PlxyXG4gICAgICAgICAgICAgICAgTTogRGlyZWN0aXZlIGFwcGxpZWQgYXMgY29tbWVudC4qL1xyXG4gICAgICAgICAgICAgICAgcmVzdHJpY3Q6ICdFJyxcclxuICAgICAgICAgICAgICAgIHRyYW5zY2x1ZGU6IHRydWUsXHJcbiAgICAgICAgICAgICAgICBzY29wZToge1xyXG4gICAgICAgICAgICAgICAgICAgIC8vQCByZWFkcyB0aGUgYXR0cmlidXRlIHZhbHVlLCA9IHByb3ZpZGVzIHR3by13YXkgYmluZGluZywgJiB3b3JrcyB3aXRoIGZ1bmN0aW9uc1xyXG4gICAgICAgICAgICAgICAgICAgIG5hdmNvbkRhdGE6ICc9JyxcclxuICAgICAgICAgICAgICAgICAgICBpdGVtczogJz1maWVsZERhdGEnXHJcbiAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgLy90ZW1wbGF0ZVVybDogJ2FwcC9sb2dpbi9kaXJlY3RpdmVzL2xvZ2luVGVtcGxhdGUuaHRtbCcsXHJcbiAgICAgICAgICAgICAgICB0ZW1wbGF0ZVVybDogZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG5hdmNvbi5NZW51cm91dGUuZ2V0VGVtcGxhdGVVcmwoXCJsb2dpblwiKTtcclxuICAgICAgICAgICAgICAgIH0sXHJcblxyXG4gICAgICAgICAgICAgICAgbGluazogZnVuY3Rpb24oc2NvcGUsIGVsLCBhdHRycykge1xyXG5cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgc2NvcGUubG9naW5EYXRhID0ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB1c2VyTmFtZTogXCJcIixcclxuICAgICAgICAgICAgICAgICAgICAgICAgcGFzc3dvcmQ6IGZ1bmN0aW9uKCkgeyByZXR1cm4gc2NvcGUubG9naW5maWVsZHNbMl0uZGF0YTsgfSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgdXNlUmVmcmVzaFRva2VuczogZmFsc2VcclxuICAgICAgICAgICAgICAgICAgICB9O1xyXG5cclxuICAgICAgICAgICAgICAgICAgICBmdW5jdGlvbiBnZXREYXRhKHR5cGUpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGRhdGFzZXJ2aWNlLmdldERhdGEodHlwZSkudGhlbihmdW5jdGlvbihkYXRhKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZGF0YTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgZnVuY3Rpb24gYWN0aXZhdGUoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHNjb3BlLnNob3dGb3Jnb3JQYXNzd29yZCA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBzY29wZS5zaG93TG9naW4gPSB0cnVlO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgZ2V0RGF0YSgnbG9naW5maWVsZHMnKS50aGVuKGZ1bmN0aW9uKGRhdGEpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChkYXRhID09PSB1bmRlZmluZWQgfHwgZGF0YS5sZW5ndGggPT09IDApIHJldHVybjtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNjb3BlLmxvZ2luZmllbGRzID0gZGF0YTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgc2NvcGUubWVzc2FnZSA9IFwiXCI7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICBzY29wZS5sb2dpbiA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc2NvcGUubG9naW5EYXRhLnVzZXJOYW1lID0gc2NvcGUubG9naW5maWVsZHNbMV0uZGF0YTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNjb3BlLmxvZ2luRGF0YS5wYXNzd29yZCA9IHNjb3BlLmxvZ2luZmllbGRzWzJdLmRhdGE7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhdXRoU2VydmljZS5sb2dpbihzY29wZS5sb2dpbkRhdGEpLnRoZW4oZnVuY3Rpb24ocmVzcG9uc2UpIHtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRsb2NhdGlvbi5wYXRoKCcvZGFzaGJvYXJkJyk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZnVuY3Rpb24oZXJyKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNjb3BlLm1lc3NhZ2UgPSBlcnIuZXJyb3JfZGVzY3JpcHRpb247XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH07XHJcblxyXG5cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHNjb3BlLmF1dGhFeHRlcm5hbFByb3ZpZGVyID0gZnVuY3Rpb24ocHJvdmlkZXIpIHtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgcmVkaXJlY3RVcmkgPSBsb2NhdGlvbi5wcm90b2NvbCArICcvLycgKyBsb2NhdGlvbi5ob3N0ICsgJy9hdXRoY29tcGxldGUuaHRtbCc7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGV4dGVybmFsUHJvdmlkZXJVcmwgPSBuZ0F1dGhTZXR0aW5ncy5hcGlTZXJ2aWNlQmFzZVVyaSArIFwiYXBpL0FjY291bnQvRXh0ZXJuYWxMb2dpbj9wcm92aWRlcj1cIiArIHByb3ZpZGVyICtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcIiZyZXNwb25zZV90eXBlPXRva2VuJmNsaWVudF9pZD1cIiArIG5nQXV0aFNldHRpbmdzLmNsaWVudElkICtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcIiZyZWRpcmVjdF91cmk9XCIgKyByZWRpcmVjdFVyaTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdpbmRvdy4kd2luZG93U2NvcGUgPSBzY29wZTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgb2F1dGhXaW5kb3cgPSB3aW5kb3cub3BlbihleHRlcm5hbFByb3ZpZGVyVXJsLCBcIkF1dGhlbnRpY2F0ZSBBY2NvdW50XCIsIFwibG9jYXRpb249MCxzdGF0dXM9MCx3aWR0aD02MDAsaGVpZ2h0PTc1MFwiKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHNjb3BlLmF1dGhDb21wbGV0ZWRDQiA9IGZ1bmN0aW9uKGZyYWdtZW50KSB7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc2NvcGUuJGFwcGx5KGZ1bmN0aW9uKCkge1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoZnJhZ21lbnQuaGFzbG9jYWxhY2NvdW50ID09ICdGYWxzZScpIHtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGF1dGhTZXJ2aWNlLmxvZ091dCgpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2dnZXIuc3VjY2VzcyhcIllvdSBoYXZlIHN1Y2Nlc3NmdWxseSBsb2cgb3V0Li4uXCIsIFwiXCIsIFwiXCIpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYXV0aFNlcnZpY2UuZXh0ZXJuYWxBdXRoRGF0YSA9IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHByb3ZpZGVyOiBmcmFnbWVudC5wcm92aWRlcixcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVzZXJOYW1lOiBmcmFnbWVudC5leHRlcm5hbF91c2VyX25hbWUsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBleHRlcm5hbEFjY2Vzc1Rva2VuOiBmcmFnbWVudC5leHRlcm5hbF9hY2Nlc3NfdG9rZW5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRsb2NhdGlvbi5wYXRoKCcvYXNzb2NpYXRlJyk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vT2J0YWluIGFjY2VzcyB0b2tlbiBhbmQgcmVkaXJlY3QgdG8gb3JkZXJzXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBleHRlcm5hbERhdGEgPSB7IHByb3ZpZGVyOiBmcmFnbWVudC5wcm92aWRlciwgZXh0ZXJuYWxBY2Nlc3NUb2tlbjogZnJhZ21lbnQuZXh0ZXJuYWxfYWNjZXNzX3Rva2VuIH07XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGF1dGhTZXJ2aWNlLm9idGFpbkFjY2Vzc1Rva2VuKGV4dGVybmFsRGF0YSkudGhlbihmdW5jdGlvbihyZXNwb25zZSkge1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkbG9jYXRpb24ucGF0aCgnL29yZGVycycpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmdW5jdGlvbihlcnIpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzY29wZS5tZXNzYWdlID0gZXJyLmVycm9yX2Rlc2NyaXB0aW9uO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG5cclxuICAgICAgICAgICAgICAgICAgICB9O1xyXG5cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgYWN0aXZhdGUoKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coc2NvcGUpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9O1xyXG4gICAgICAgIH1cclxuICAgIF0pXHJcbiAgICAuZGlyZWN0aXZlKCdsb2dpbkVudGVyJywgZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uKHNjb3BlLCBlbGVtZW50LCBhdHRycykge1xyXG4gICAgICAgICAgICBlbGVtZW50LmJpbmQoXCJrZXlkb3duIGtleXByZXNzXCIsIGZ1bmN0aW9uKGV2ZW50KSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoZXZlbnQud2hpY2ggPT09IDEzKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgc2NvcGUuJGFwcGx5KGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBzY29wZS4kZXZhbChhdHRycy5sb2dpbkVudGVyKTtcclxuICAgICAgICAgICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfTtcclxuICAgIH0pOyIsIlwidXNlIHN0cmljdFwiO1xyXG5hbmd1bGFyLm1vZHVsZSgnYXBwJykuZGlyZWN0aXZlKCduYXZjb25DaGFydCcsIFsnJGxvY2FsU3RvcmFnZScsICdkYXRhc2VydmljZScsICckdGltZW91dCcsICdsb2dnZXInLCAnJGNvbXBpbGUnLFxyXG4gICAgZnVuY3Rpb24oJGxvY2FsU3RvcmFnZSwgZGF0YXNlcnZpY2UsICR0aW1lb3V0LCBsb2dnZXIsICRjb21waWxlKSB7XHJcbiAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgcmVzdHJpY3Q6ICdBRScsXHJcbiAgICAgICAgICAgIC8vdGVtcGxhdGVVcmw6ICdhcHAvd2lkZ2V0cy9uYXZjb25DaGFydC9uYXZjb25DaGFydFRlbXBsYXRlLmh0bWwnLFxyXG4gICAgICAgICAgICB0ZW1wbGF0ZVVybDogZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gbmF2Y29uLk1lbnVyb3V0ZS5nZXRUZW1wbGF0ZVVybChcIm5hdmNvbkNoYXJ0XCIpO1xyXG4gICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICBjb250cm9sbGVyOiBmdW5jdGlvbigkc2NvcGUpIHtcclxuICAgICAgICAgICAgICAgICRzY29wZS5wYXJlbnRJdGVtID0gJHNjb3BlLml0ZW07XHJcbiAgICAgICAgICAgICAgICAkc2NvcGUudGl0bGUgPSAkc2NvcGUuaXRlbS50aXRsZS50b1N0cmluZygpO1xyXG4gICAgICAgICAgICAgICAgJHNjb3BlLnN1YlRpdGxlID0gJHNjb3BlLml0ZW0uc3ViVGl0bGUudG9TdHJpbmcoKTtcclxuICAgICAgICAgICAgICAgICRzY29wZS5tb2R1bGVJZCA9ICRzY29wZS5pdGVtLk1vZHVsZUlkO1xyXG4gICAgICAgICAgICAgICAgJHNjb3BlLnByb2plY3RJZCA9ICRzY29wZS5pdGVtLlByb2plY3RJZDtcclxuICAgICAgICAgICAgICAgICRzY29wZS53aWRnZXRJZCA9ICRzY29wZS5pdGVtLndpZGdldElkLnRvU3RyaW5nKCk7XHJcbiAgICAgICAgICAgICAgICAkc2NvcGUucmVwb3J0VHlwZSA9ICRzY29wZS5pdGVtLnJlcG9ydFR5cGU7XHJcbiAgICAgICAgICAgICAgICAkc2NvcGUuY2hhcnREYXRhID0gJHNjb3BlLml0ZW0uZGF0YTtcclxuXHJcbiAgICAgICAgICAgICAgICAkc2NvcGUub3B0aW9ucyA9ICRzY29wZS5pdGVtLm9wdGlvbnM7XHJcblxyXG4gICAgICAgICAgICAgICAgJHNjb3BlLnJlcG9ydElkID0gJHNjb3BlLml0ZW0uRmlsdGVySWQ7XHJcbiAgICAgICAgICAgICAgICAkc2NvcGUuRmlsdGVyS2V5ID0gJHNjb3BlLml0ZW0uRmlsdGVyS2V5O1xyXG5cclxuICAgICAgICAgICAgICAgIC8vJHNjb3BlLmZpbHRlclN0YXJ0ID0gbmF2Y29uLmRhdGVGb3JtYXQoXCIxMC8wNS8yMDEyXCIsIFwiXCIpO1xyXG4gICAgICAgICAgICAgICAgLy8kc2NvcGUuZmlsdGVyU3RhcnQgPSBtb21lbnQoKS5zdGFydE9mKCd5ZWFyJyk7XHJcbiAgICAgICAgICAgICAgICAvLyRzY29wZS5maWx0ZXJFbmQgPSBtb21lbnQoKTtcclxuXHJcbiAgICAgICAgICAgICAgICAkc2NvcGUuZmlsdGVyU3RhcnQgPSAkc2NvcGUuaXRlbS5maWx0ZXJTdGFydDtcclxuICAgICAgICAgICAgICAgICRzY29wZS5maWx0ZXJFbmQgPSAkc2NvcGUuaXRlbS5maWx0ZXJFbmQ7XHJcblxyXG4gICAgICAgICAgICAgICAgLy8kc2NvcGUuJG9uKCdQT1BPVkVSLVdJREdFVC1TRVRUSU5HJywgZnVuY3Rpb24gKGV2LCBzY29wZSwgZGF0YSwgY2FsbGJhY2spIHtcclxuICAgICAgICAgICAgICAgIC8vICAgIGlmIChkYXRhICE9PSB1bmRlZmluZWQgJiYgJHNjb3BlLndpZGdldElkID09PSBzY29wZS53aWRnZXRJZCkge1xyXG4gICAgICAgICAgICAgICAgLy8gICAgICAgICRzY29wZS5yZXBvcnRJZCA9IGRhdGFbJHNjb3BlLkZpbHRlcktleV07XHJcblxyXG4gICAgICAgICAgICAgICAgLy8gICAgICAgIGxvYWRDaGFydFJlcG9ydCgpO1xyXG5cclxuICAgICAgICAgICAgICAgIC8vICAgICAgICAkc2NvcGUuaXRlbVtcIkZpbHRlcklkXCJdID0gZGF0YVskc2NvcGUuRmlsdGVyS2V5XTtcclxuICAgICAgICAgICAgICAgIC8vICAgICAgICAvLyRzY29wZS5zYXZlV2lkZ2V0KCk7XHJcbiAgICAgICAgICAgICAgICAvLyAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgLy8gICAgLy9pZiAoY2FsbGJhY2sgIT09IHVuZGVmaW5lZCkgY2FsbGJhY2soKTtcclxuICAgICAgICAgICAgICAgIC8vfSk7XHJcblxyXG4gICAgICAgICAgICAgICAgJHNjb3BlLnNhdmVXaWRnZXQgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgd2lkZ2V0cyA9IFtdO1xyXG4gICAgICAgICAgICAgICAgICAgIC8qYW5ndWxhci5mb3JFYWNoKCRzY29wZS5pdGVtLCBmdW5jdGlvbiAoaXRlbSwga2V5KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChpdGVtW1wiVXNlcldpZGdldElkXCJdID09PSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGl0ZW1bXCJVc2VyV2lkZ2V0SWRcIl0gPSAwO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaXRlbVtcInVwZGF0ZVwiXSA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGl0ZW1bXCJGaWx0ZXJJZFwiXSA9ICRzY29wZS5yZXBvcnRJZDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICAgICAgICAgfSk7Ki9cclxuICAgICAgICAgICAgICAgICAgICAvLyRzY29wZS5pdGVtW1wiRmlsdGVySWRcIl0gPSAkc2NvcGUucmVwb3J0SWQ7XHJcbiAgICAgICAgICAgICAgICAgICAgd2lkZ2V0cy5wdXNoKCRzY29wZS5pdGVtKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHdpZGdldHMubGVuZ3RoICE9PSAwKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGRhdGFzZXJ2aWNlLnB1dFNlcnZlckRhdGEoXCJteVNwYWNlVXBkYXRlXCIsIHdpZGdldHMpLnRoZW4oZnVuY3Rpb24oZGF0YSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy9sb2dnZXIud2FybmluZyhcIk15IHNwYWNlIGRhdGEgVXBkYXRlZFwiKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vJHJvb3RTY29wZS5kYXNoYm9hcmRXaWRnZXRzID0gc2NvcGUud2lkZ2V0cztcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICRzY29wZS5kYXRhID0gXCJcIjtcclxuICAgICAgICAgICAgICAgIHZhciByZXR1cm5EYXRhID0gY2hhcnREYXRhLmdldENoYXJ0RGF0YSgkc2NvcGUucmVwb3J0VHlwZSk7XHJcbiAgICAgICAgICAgICAgICAvLyRzY29wZS5kYXRhID0gcmV0dXJuRGF0YTtcclxuXHJcbiAgICAgICAgICAgICAgICAkc2NvcGUuJHdhdGNoKCdwcm9qZWN0SWQnLCBmdW5jdGlvbihuZXdWYWx1ZSwgb2xkVmFsdWUpIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAobmV3VmFsdWUgIT09IHVuZGVmaW5lZCAmJiBuZXdWYWx1ZSAhPT0gXCJcIikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoJHNjb3BlLmNoYXJ0RGF0YSAhPT0gdW5kZWZpbmVkICYmICRzY29wZS5jaGFydERhdGEgIT09IFwiXCIgJiYgJHNjb3BlLmNoYXJ0RGF0YS5sZW5ndGggIT09IDApXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2FkQ2hhcnREYXRhUmVwb3J0KCRzY29wZS5yZXBvcnRUeXBlLnRvU3RyaW5nKCksICRzY29wZS5jaGFydERhdGEpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBlbHNlXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2FkQ2hhcnRSZXBvcnQoKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9LCB0cnVlKTtcclxuXHJcbiAgICAgICAgICAgICAgICBmdW5jdGlvbiBsb2FkQ2hhcnRSZXBvcnQoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKCRzY29wZS5yZXBvcnRJZCA9PT0gdW5kZWZpbmVkIHx8ICRzY29wZS5yZXBvcnRJZCA9PT0gbnVsbCB8fCAkc2NvcGUucmVwb3J0SWQgPT09IFwiXCIpIHJldHVybjtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoJHNjb3BlLm1vZHVsZUlkLnRvTG93ZXJDYXNlKCkgPT09IFwiaGF6YXJkXCIgJiYgJHNjb3BlLnJlcG9ydElkLnRvU3RyaW5nKCkudG9Mb3dlckNhc2UoKS5pbmRleE9mKFwic29ydFwiKSA+IC0xKSByZXR1cm47XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKCRzY29wZS5tb2R1bGVJZC50b0xvd2VyQ2FzZSgpID09PSBcInNvcnRcIiAmJiAkc2NvcGUucmVwb3J0SWQudG9TdHJpbmcoKS50b0xvd2VyQ2FzZSgpLmluZGV4T2YoXCJoYXphcmRcIikgPiAtMSkgcmV0dXJuO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICBjYigkc2NvcGUuZmlsdGVyU3RhcnQsICRzY29wZS5maWx0ZXJFbmQsIFwiXCIpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAkc2NvcGUuZGF0YSA9IFwiXCI7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIHZhciBjaGFydFZhcmlhYmxlcyA9IHsgXCIxXCI6IFwibXlTcGFjZUNvbHVtblJlcG9ydFwiLCBcIjJcIjogXCJteVNwYWNlRG91Z2hudXRSZXBvcnRcIiwgXCIzXCI6IFwibXlTcGFjZUNvbHVtblJlcG9ydFwiIH07XHJcbiAgICAgICAgICAgICAgICAgICAgLy92YXIgZmlsdGVyU3RhcnQgPSBuYXZjb24uZGF0ZUZvcm1hdChcIjEwLzA1LzIwMTJcIiwgXCJcIik7XHJcbiAgICAgICAgICAgICAgICAgICAgLy8vL3ZhciBmaWx0ZXJTdGFydCA9IG1vbWVudCgpO1xyXG4gICAgICAgICAgICAgICAgICAgIC8vdmFyIGZpbHRlckVuZCA9IG1vbWVudCgpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICB2YXIgcmVwb3J0VHlwZSA9ICRzY29wZS5yZXBvcnRUeXBlLnRvU3RyaW5nKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIGFwaU5hbWUgPSBjaGFydFZhcmlhYmxlc1tyZXBvcnRUeXBlXTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgLy9pZiAoJHNjb3BlLnJlcG9ydElkID09PSB1bmRlZmluZWQgfHwgJHNjb3BlLnJlcG9ydElkID09PSBudWxsKSAkc2NvcGUucmVwb3J0SWQgPSBcIkhhemFyZFN1bW1hcnlcIjtcclxuICAgICAgICAgICAgICAgICAgICAkc2NvcGUuaXRlbVtcIkZpbHRlcklkXCJdID0gJHNjb3BlLnJlcG9ydElkO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICB2YXIgcGFyYW1ldGVyTmFtZSA9IFwiXCI7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHJlcG9ydFR5cGUgPT09IFwiMVwiIHx8IHJlcG9ydFR5cGUgPT09IFwiM1wiKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICBwYXJhbWV0ZXJOYW1lID0gJHNjb3BlLnByb2plY3RJZCArIFwiL1wiICsgJHNjb3BlLnJlcG9ydElkICsgXCIvXCIgKyBuYXZjb24uZGF0ZUZyb21VVENUb0xvY2FsKCRzY29wZS5maWx0ZXJTdGFydCwgXCJNTS1ERC1ZWVlZXCIpICsgXCIvXCIgKyBuYXZjb24uZGF0ZUZyb21VVENUb0xvY2FsKCRzY29wZS5maWx0ZXJFbmQsIFwiTU0tREQtWVlZWVwiKTtcclxuICAgICAgICAgICAgICAgICAgICBlbHNlIGlmIChyZXBvcnRUeXBlID09PSBcIjJcIilcclxuICAgICAgICAgICAgICAgICAgICAgICAgcGFyYW1ldGVyTmFtZSA9ICRzY29wZS5wcm9qZWN0SWQgKyBcIi9cIiArICRzY29wZS5tb2R1bGVJZDtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgLy92YXIgY29sbGVjdGlvbkNoYXJ0RGF0YSA9IGFuZ3VsYXIuY29weShyZXR1cm5EYXRhKTtcclxuICAgICAgICAgICAgICAgICAgICBnZXRTZXJ2ZXJEYXRhKGFwaU5hbWUsIHBhcmFtZXRlck5hbWUpLnRoZW4oZnVuY3Rpb24oZGF0YSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoZGF0YSA9PT0gdW5kZWZpbmVkIHx8IGRhdGEgPT09IG51bGwgfHwgZGF0YS5sZW5ndGggPT09IDApIHJldHVybjtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGxvYWRDaGFydERhdGFSZXBvcnQocmVwb3J0VHlwZSwgZGF0YSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgZnVuY3Rpb24gbG9hZENoYXJ0RGF0YVJlcG9ydChyZXBvcnRUeXBlLCBkYXRhKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGRhdGEgIT09IHVuZGVmaW5lZCAmJiBkYXRhICE9PSBudWxsICYmIGRhdGEubGVuZ3RoICE9PSAwKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChkYXRhLnRpdGxlICE9PSB1bmRlZmluZWQgJiYgZGF0YS50aXRsZSAhPT0gbnVsbCkgJHNjb3BlLnRpdGxlID0gZGF0YS50aXRsZS50b1N0cmluZygpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoZGF0YS5zdWJUaXRsZSAhPT0gdW5kZWZpbmVkICYmIGRhdGEuc3ViVGl0bGUgIT09IG51bGwpICRzY29wZS5zdWJUaXRsZSA9IGRhdGEuc3ViVGl0bGUudG9TdHJpbmcoKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBwYWxldHRlQ29sb3JzQ29sbGVjdGlvbiA9IFwiXCI7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBkYXRhc2V0ID0gW107XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAocmVwb3J0VHlwZSA9PT0gXCIxXCIpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybkRhdGEuY2F0ZWdvcmllcyA9IGRhdGEuY2F0ZWdvcmllcztcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgc3BsQ29sb3IgPSByZXR1cm5EYXRhLmNoYXJ0LnBhbGV0dGVDb2xvcnMuc3BsaXQoXCIsXCIpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgaVNldCA9IDAsIGlMZW4gPSBkYXRhLmRhdGFzZXQubGVuZ3RoOyBpU2V0IDwgaUxlbjsgaVNldCsrKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy92YXIgc2VyaWVzQ29sb3IgPSBkYXRhLmRhdGFzZXRbaVNldF0uQ29sb3I7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy9wYWxldHRlQ29sb3JzQ29sbGVjdGlvbiArPSBpU2V0IDwgaUxlbiA/IHNlcmllc0NvbG9yICsgXCIsXCIgOiBzZXJpZXNDb2xvcjtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgakNhdCA9IDAsIGpMZW4gPSBkYXRhLmNhdGVnb3JpZXNbMF0uY2F0ZWdvcnkubGVuZ3RoOyBqQ2F0IDwgakxlbjsgakNhdCsrKSB7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgdG9vbFRleHQgPSBcIjxkaXYgY2xhc3M9J2NoYXJ0VG9vbFRpcCcgc3R5bGU9J3RleHQtYWxpZ246IGNlbnRlcjt2ZXJ0aWNhbC1hbGlnbjogbWlkZGxlOyc+XCI7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRvb2xUZXh0ICs9IFwiPGRpdiBjbGFzcz0nbWFyZ2luLWJvdHRvbS0xMCcgc3R5bGU9J2ZvbnQtd2VpZ2h0OiA2MDA7Jz5cIiArIGRhdGEuY2F0ZWdvcmllc1swXS5jYXRlZ29yeVtqQ2F0XS5sYWJlbCArIFwiPC9kaXY+XCI7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBpVGVtcCA9IDAsIGlUZW1wTGVuID0gZGF0YS5kYXRhc2V0Lmxlbmd0aDsgaVRlbXAgPCBpVGVtcExlbjsgaVRlbXArKykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHNlcmllc0NvbG9yID0gc3BsQ29sb3JbaVRlbXBdO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy92YXIgc2VyaWVzQ29sb3IgPSBkYXRhLmRhdGFzZXRbaVRlbXBdLkNvbG9yO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGRhdGEuZGF0YXNldFtpVGVtcF0uZGF0YSAhPT0gdW5kZWZpbmVkICYmIGRhdGEuZGF0YXNldFtpVGVtcF0uZGF0YS5sZW5ndGggPiBqQ2F0ICYmIGRhdGEuZGF0YXNldFtpVGVtcF0uZGF0YVtqQ2F0XS52YWx1ZSAhPT0gdW5kZWZpbmVkKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRvb2xUZXh0ICs9IFwiPGRpdiAgY2xhc3M9J21hcmdpbi1ib3R0b20tNScgc3R5bGU9J2NvbG9yOlwiICsgc2VyaWVzQ29sb3IgKyBcIic+XCIgKyBkYXRhLmRhdGFzZXRbaVRlbXBdLnNlcmllc25hbWUgKyBcIjogXCIgKyBkYXRhLmRhdGFzZXRbaVRlbXBdLmRhdGFbakNhdF0udmFsdWUgKyBcIjwvZGl2PlwiO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b29sVGV4dCArPSBcIjwvZGl2PlwiO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoZGF0YS5kYXRhc2V0W2lTZXRdLmRhdGEgIT09IHVuZGVmaW5lZCAmJiBkYXRhLmRhdGFzZXRbaVNldF0uZGF0YS5sZW5ndGggPiBqQ2F0KVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGF0YS5kYXRhc2V0W2lTZXRdLmRhdGFbakNhdF0udG9vbHRleHQgPSB0b29sVGV4dDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRhdGFzZXQucHVzaChkYXRhLmRhdGFzZXRbaVNldF0pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vcmV0dXJuRGF0YS5jaGFydC5wYWxldHRlQ29sb3JzID0gcGFsZXR0ZUNvbG9yc0NvbGxlY3Rpb247XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm5EYXRhLmRhdGFzZXQgPSBkYXRhc2V0O1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHJlcG9ydFR5cGUgPT09IFwiMlwiKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvL3JldHVybkRhdGEuZGF0YSA9IGRhdGEuZGF0YTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBpU2V0ID0gMCwgaUxlbiA9IGRhdGEuZGF0YS5sZW5ndGg7IGlTZXQgPCBpTGVuOyBpU2V0KyspIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvL2RhdGEuZGF0YVtpU2V0XS52YWx1ZSA9IGRhdGEuZGF0YVtpU2V0XS5WYWx1ZSA9PT0gXCIwXCIgPyBcIjFcIiA6IGRhdGEuZGF0YVtpU2V0XS5WYWx1ZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkYXRhc2V0LnB1c2goZGF0YS5kYXRhW2lTZXRdKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoZGF0YSAhPT0gdW5kZWZpbmVkICYmIGRhdGEuY2hhcnQgIT09IHVuZGVmaW5lZCAmJiBkYXRhLmNoYXJ0LnBhbGV0dGVDb2xvcnMgIT09IHVuZGVmaW5lZCAmJiBkYXRhLmNoYXJ0LnBhbGV0dGVDb2xvcnMgIT09IG51bGwpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuRGF0YS5jaGFydC5wYWxldHRlQ29sb3JzID0gZGF0YS5jaGFydC5wYWxldHRlQ29sb3JzXHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuRGF0YS5kYXRhID0gZGF0YXNldDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChyZXBvcnRUeXBlID09PSBcIjNcIikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy9yZXR1cm5EYXRhID0gY29sbGVjdGlvbkNoYXJ0RGF0YTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgJHNjb3BlLmRhdGEgPSByZXR1cm5EYXRhO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCRzY29wZS5vcHRpb25zLmZpbHRlciAhPT0gdW5kZWZpbmVkICYmICRzY29wZS5vcHRpb25zLmZpbHRlcikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy9maWx0ZXJTdGFydCA9IGZpbHRlclN0YXJ0LnN0YXJ0T2YoJ21vbnRoJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmaWx0ZXJTZXR0aW5nKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9O1xyXG5cclxuICAgICAgICAgICAgICAgIGZ1bmN0aW9uIGxvYWRDaGFydFJlcG9ydDEoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKCRzY29wZS5yZXBvcnRJZCA9PT0gdW5kZWZpbmVkIHx8ICRzY29wZS5yZXBvcnRJZCA9PT0gbnVsbCB8fCAkc2NvcGUucmVwb3J0SWQgPT09IFwiXCIpIHJldHVybjtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoJHNjb3BlLm1vZHVsZUlkLnRvTG93ZXJDYXNlKCkgPT09IFwiaGF6YXJkXCIgJiYgJHNjb3BlLnJlcG9ydElkLnRvU3RyaW5nKCkudG9Mb3dlckNhc2UoKS5pbmRleE9mKFwic29ydFwiKSA+IC0xKSByZXR1cm47XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKCRzY29wZS5tb2R1bGVJZC50b0xvd2VyQ2FzZSgpID09PSBcInNvcnRcIiAmJiAkc2NvcGUucmVwb3J0SWQudG9TdHJpbmcoKS50b0xvd2VyQ2FzZSgpLmluZGV4T2YoXCJoYXphcmRcIikgPiAtMSkgcmV0dXJuO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICBjYigkc2NvcGUuZmlsdGVyU3RhcnQsICRzY29wZS5maWx0ZXJFbmQsIFwiXCIpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAkc2NvcGUuZGF0YSA9IFwiXCI7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIHZhciBjaGFydFZhcmlhYmxlcyA9IHsgXCIxXCI6IFwibXlTcGFjZUNvbHVtblJlcG9ydFwiLCBcIjJcIjogXCJteVNwYWNlRG91Z2hudXRSZXBvcnRcIiwgXCIzXCI6IFwibXlTcGFjZUNvbHVtblJlcG9ydFwiIH07XHJcbiAgICAgICAgICAgICAgICAgICAgLy92YXIgZmlsdGVyU3RhcnQgPSBuYXZjb24uZGF0ZUZvcm1hdChcIjEwLzA1LzIwMTJcIiwgXCJcIik7XHJcbiAgICAgICAgICAgICAgICAgICAgLy8vL3ZhciBmaWx0ZXJTdGFydCA9IG1vbWVudCgpO1xyXG4gICAgICAgICAgICAgICAgICAgIC8vdmFyIGZpbHRlckVuZCA9IG1vbWVudCgpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICB2YXIgcmVwb3J0VHlwZSA9ICRzY29wZS5yZXBvcnRUeXBlLnRvU3RyaW5nKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIGFwaU5hbWUgPSBjaGFydFZhcmlhYmxlc1tyZXBvcnRUeXBlXTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgLy9pZiAoJHNjb3BlLnJlcG9ydElkID09PSB1bmRlZmluZWQgfHwgJHNjb3BlLnJlcG9ydElkID09PSBudWxsKSAkc2NvcGUucmVwb3J0SWQgPSBcIkhhemFyZFN1bW1hcnlcIjtcclxuICAgICAgICAgICAgICAgICAgICAkc2NvcGUuaXRlbVtcIkZpbHRlcklkXCJdID0gJHNjb3BlLnJlcG9ydElkO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICB2YXIgcGFyYW1ldGVyTmFtZSA9IFwiXCI7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHJlcG9ydFR5cGUgPT09IFwiMVwiIHx8IHJlcG9ydFR5cGUgPT09IFwiM1wiKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICBwYXJhbWV0ZXJOYW1lID0gJHNjb3BlLnByb2plY3RJZCArIFwiL1wiICsgJHNjb3BlLnJlcG9ydElkICsgXCIvXCIgKyBuYXZjb24uZGF0ZUZyb21VVENUb0xvY2FsKCRzY29wZS5maWx0ZXJTdGFydCwgXCJNTS1ERC1ZWVlZXCIpICsgXCIvXCIgKyBuYXZjb24uZGF0ZUZyb21VVENUb0xvY2FsKCRzY29wZS5maWx0ZXJFbmQsIFwiTU0tREQtWVlZWVwiKTtcclxuICAgICAgICAgICAgICAgICAgICBlbHNlIGlmIChyZXBvcnRUeXBlID09PSBcIjJcIilcclxuICAgICAgICAgICAgICAgICAgICAgICAgcGFyYW1ldGVyTmFtZSA9ICRzY29wZS5wcm9qZWN0SWQgKyBcIi9cIiArICRzY29wZS5tb2R1bGVJZDtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgLy92YXIgY29sbGVjdGlvbkNoYXJ0RGF0YSA9IGFuZ3VsYXIuY29weShyZXR1cm5EYXRhKTtcclxuICAgICAgICAgICAgICAgICAgICBnZXRTZXJ2ZXJEYXRhKGFwaU5hbWUsIHBhcmFtZXRlck5hbWUpLnRoZW4oZnVuY3Rpb24oZGF0YSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoZGF0YSA9PT0gdW5kZWZpbmVkIHx8IGRhdGEgPT09IG51bGwgfHwgZGF0YS5sZW5ndGggPT09IDApIHJldHVybjtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChkYXRhLnRpdGxlICE9PSB1bmRlZmluZWQgJiYgZGF0YS50aXRsZSAhPT0gbnVsbCkgJHNjb3BlLnRpdGxlID0gZGF0YS50aXRsZS50b1N0cmluZygpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoZGF0YS5zdWJUaXRsZSAhPT0gdW5kZWZpbmVkICYmIGRhdGEuc3ViVGl0bGUgIT09IG51bGwpICRzY29wZS5zdWJUaXRsZSA9IGRhdGEuc3ViVGl0bGUudG9TdHJpbmcoKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBwYWxldHRlQ29sb3JzQ29sbGVjdGlvbiA9IFwiXCI7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBkYXRhc2V0ID0gW107XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAocmVwb3J0VHlwZSA9PT0gXCIxXCIpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybkRhdGEuY2F0ZWdvcmllcyA9IGRhdGEuY2F0ZWdvcmllcztcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgc3BsQ29sb3IgPSByZXR1cm5EYXRhLmNoYXJ0LnBhbGV0dGVDb2xvcnMuc3BsaXQoXCIsXCIpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgaVNldCA9IDAsIGlMZW4gPSBkYXRhLmRhdGFzZXQubGVuZ3RoOyBpU2V0IDwgaUxlbjsgaVNldCsrKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy92YXIgc2VyaWVzQ29sb3IgPSBkYXRhLmRhdGFzZXRbaVNldF0uQ29sb3I7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy9wYWxldHRlQ29sb3JzQ29sbGVjdGlvbiArPSBpU2V0IDwgaUxlbiA/IHNlcmllc0NvbG9yICsgXCIsXCIgOiBzZXJpZXNDb2xvcjtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgakNhdCA9IDAsIGpMZW4gPSBkYXRhLmNhdGVnb3JpZXNbMF0uY2F0ZWdvcnkubGVuZ3RoOyBqQ2F0IDwgakxlbjsgakNhdCsrKSB7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgdG9vbFRleHQgPSBcIjxkaXYgY2xhc3M9J2NoYXJ0VG9vbFRpcCcgc3R5bGU9J3RleHQtYWxpZ246IGNlbnRlcjt2ZXJ0aWNhbC1hbGlnbjogbWlkZGxlOyc+XCI7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRvb2xUZXh0ICs9IFwiPGRpdiBjbGFzcz0nbWFyZ2luLWJvdHRvbS0xMCcgc3R5bGU9J2ZvbnQtd2VpZ2h0OiA2MDA7Jz5cIiArIGRhdGEuY2F0ZWdvcmllc1swXS5jYXRlZ29yeVtqQ2F0XS5sYWJlbCArIFwiPC9kaXY+XCI7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBpVGVtcCA9IDAsIGlUZW1wTGVuID0gZGF0YS5kYXRhc2V0Lmxlbmd0aDsgaVRlbXAgPCBpVGVtcExlbjsgaVRlbXArKykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHNlcmllc0NvbG9yID0gc3BsQ29sb3JbaVRlbXBdO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy92YXIgc2VyaWVzQ29sb3IgPSBkYXRhLmRhdGFzZXRbaVRlbXBdLkNvbG9yO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGRhdGEuZGF0YXNldFtpVGVtcF0uZGF0YSAhPT0gdW5kZWZpbmVkICYmIGRhdGEuZGF0YXNldFtpVGVtcF0uZGF0YS5sZW5ndGggPiBqQ2F0ICYmIGRhdGEuZGF0YXNldFtpVGVtcF0uZGF0YVtqQ2F0XS52YWx1ZSAhPT0gdW5kZWZpbmVkKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRvb2xUZXh0ICs9IFwiPGRpdiAgY2xhc3M9J21hcmdpbi1ib3R0b20tNScgc3R5bGU9J2NvbG9yOlwiICsgc2VyaWVzQ29sb3IgKyBcIic+XCIgKyBkYXRhLmRhdGFzZXRbaVRlbXBdLnNlcmllc25hbWUgKyBcIjogXCIgKyBkYXRhLmRhdGFzZXRbaVRlbXBdLmRhdGFbakNhdF0udmFsdWUgKyBcIjwvZGl2PlwiO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b29sVGV4dCArPSBcIjwvZGl2PlwiO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoZGF0YS5kYXRhc2V0W2lTZXRdLmRhdGEgIT09IHVuZGVmaW5lZCAmJiBkYXRhLmRhdGFzZXRbaVNldF0uZGF0YS5sZW5ndGggPiBqQ2F0KVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGF0YS5kYXRhc2V0W2lTZXRdLmRhdGFbakNhdF0udG9vbHRleHQgPSB0b29sVGV4dDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRhdGFzZXQucHVzaChkYXRhLmRhdGFzZXRbaVNldF0pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vcmV0dXJuRGF0YS5jaGFydC5wYWxldHRlQ29sb3JzID0gcGFsZXR0ZUNvbG9yc0NvbGxlY3Rpb247XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm5EYXRhLmRhdGFzZXQgPSBkYXRhc2V0O1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHJlcG9ydFR5cGUgPT09IFwiMlwiKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvL3JldHVybkRhdGEuZGF0YSA9IGRhdGEuZGF0YTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBpU2V0ID0gMCwgaUxlbiA9IGRhdGEuZGF0YS5sZW5ndGg7IGlTZXQgPCBpTGVuOyBpU2V0KyspIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvL2RhdGEuZGF0YVtpU2V0XS52YWx1ZSA9IGRhdGEuZGF0YVtpU2V0XS5WYWx1ZSA9PT0gXCIwXCIgPyBcIjFcIiA6IGRhdGEuZGF0YVtpU2V0XS5WYWx1ZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkYXRhc2V0LnB1c2goZGF0YS5kYXRhW2lTZXRdKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm5EYXRhLmRhdGEgPSBkYXRhc2V0O1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHJlcG9ydFR5cGUgPT09IFwiM1wiKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvL3JldHVybkRhdGEgPSBjb2xsZWN0aW9uQ2hhcnREYXRhO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAkc2NvcGUuZGF0YSA9IHJldHVybkRhdGE7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoJHNjb3BlLm9wdGlvbnMuZmlsdGVyICE9PSB1bmRlZmluZWQgJiYgJHNjb3BlLm9wdGlvbnMuZmlsdGVyKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvL2ZpbHRlclN0YXJ0ID0gZmlsdGVyU3RhcnQuc3RhcnRPZignbW9udGgnKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpbHRlclNldHRpbmcoKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgfTtcclxuXHJcbiAgICAgICAgICAgICAgICBmdW5jdGlvbiBnZXRTZXJ2ZXJEYXRhKHR5cGUsIHJvd0lkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGRhdGFzZXJ2aWNlLmdldFNlcnZlckRhdGEodHlwZSwgcm93SWQpLnRoZW4oZnVuY3Rpb24oZGF0YSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZGF0YTtcclxuICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgIH07XHJcblxyXG4gICAgICAgICAgICAgICAgZnVuY3Rpb24gZmlsdGVyU2V0dGluZygpIHtcclxuICAgICAgICAgICAgICAgICAgICAvL3ZhciBmaWx0ZXJTdGFydCA9IG1vbWVudCgpLnN0YXJ0T2YoJ3llYXInKTtcclxuICAgICAgICAgICAgICAgICAgICAvL3ZhciBmaWx0ZXJFbmQgPSBtb21lbnQoKTtcclxuICAgICAgICAgICAgICAgICAgICAkdGltZW91dChmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgLy8kKFwiLmNoYXJ0VG9vbFRpcFwiKS5vbihcIm1vdXNlbW92ZVwiLCBmdW5jdGlvbiAob2JqZWN0LCBldnQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gICAgYWxlcnQob2JqZWN0KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgLy99KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgJCgnI3JlcG9ydHJhbmdlXycgKyAkc2NvcGUud2lkZ2V0SWQpLmRhdGVyYW5nZXBpY2tlcih7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhdXRvVXBkYXRlSW5wdXQ6IHRydWUsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzaG93RHJvcGRvd25zOiB0cnVlLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGltZVBpY2tlcjogZmFsc2UsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtaW5EYXRlOiBtb21lbnQoKS5zdWJ0cmFjdCgyODAsICdtb250aHMnKSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1heERhdGU6IG1vbWVudCgpLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RhcnREYXRlOiAkc2NvcGUuZmlsdGVyU3RhcnQsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmREYXRlOiAkc2NvcGUuZmlsdGVyRW5kLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgb3BlbnM6ICdsZWZ0JyxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJ1dHRvbkNsYXNzZXM6IFsnYnRuIGJ0bi1kZWZhdWx0J10sXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhcHBseUNsYXNzOiAnYnRuLXNtYWxsIGJ0bi1wcmltYXJ5JyxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhbmNlbENsYXNzOiAnYnRuLXNtYWxsJyxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvcm1hdDogbmF2Y29uLmRlZmF1bHRGb3JtYXQoKS5kYXRldGltZSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlcGFyYXRvcjogJyB0byAnLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLypkYXRlTGltaXQ6IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkYXlzOiA2MFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSwqL1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmFuZ2VzOiB7fSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsZToge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvcm1hdDogbmF2Y29uLmRlZmF1bHRGb3JtYXQoKS5kYXRldGltZSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhcHBseUxhYmVsOiAnU3VibWl0JyxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYW5jZWxMYWJlbDogJ0NsZWFyJyxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmcm9tTGFiZWw6ICdGcm9tJyxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b0xhYmVsOiAnVG8nLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGN1c3RvbVJhbmdlTGFiZWw6ICdDdXN0b20nLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRheXNPZldlZWs6IFsnU3UnLCAnTW8nLCAnVHUnLCAnV2UnLCAnVGgnLCAnRnInLCAnU2EnXSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtb250aE5hbWVzOiBbJ0phbnVhcnknLCAnRmVicnVhcnknLCAnTWFyY2gnLCAnQXByaWwnLCAnTWF5JywgJ0p1bmUnLCAnSnVseScsICdBdWd1c3QnLCAnU2VwdGVtYmVyJywgJ09jdG9iZXInLCAnTm92ZW1iZXInLCAnRGVjZW1iZXInXSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmaXJzdERheTogMVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9LCBmdW5jdGlvbihzdGFydCwgZW5kLCBsYWJlbCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY2Ioc3RhcnQsIGVuZCwgbGFiZWwpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICRzY29wZS5maWx0ZXJTdGFydCA9IHN0YXJ0O1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJHNjb3BlLmZpbHRlckVuZCA9IGVuZDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvYWRDaGFydFJlcG9ydCgpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgIH07XHJcblxyXG4gICAgICAgICAgICAgICAgdmFyIGNiID0gZnVuY3Rpb24oc3RhcnREdCwgZW5kRHQsIGxhYmVsKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHN0YXJ0RHQgIT09IHVuZGVmaW5lZCAmJiBlbmREdCAhPT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICR0aW1lb3V0KGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJCgnI3JlcG9ydHJhbmdlXycgKyAkc2NvcGUud2lkZ2V0SWQgKyAnIHNwYW4nKS5odG1sKHN0YXJ0RHQuZm9ybWF0KG5hdmNvbi5kZWZhdWx0Rm9ybWF0KCkuZGF0ZURpc3BsYXkpICsgJyAtICcgKyBlbmREdC5mb3JtYXQobmF2Y29uLmRlZmF1bHRGb3JtYXQoKS5kYXRlRGlzcGxheSkpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJHNjb3BlLmNoYXJ0RmlsdGVyRGF0YSA9IHN0YXJ0RHQuZm9ybWF0KG5hdmNvbi5kZWZhdWx0Rm9ybWF0KCkuZGF0ZURpc3BsYXkpICsgJyAtICcgKyBlbmREdC5mb3JtYXQobmF2Y29uLmRlZmF1bHRGb3JtYXQoKS5kYXRlRGlzcGxheSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgIGxpbms6IGZ1bmN0aW9uKCRzY29wZSwgZWwsIGF0dHJzKSB7XHJcblxyXG4gICAgICAgICAgICAgICAgLyokc2NvcGUuJG9uKCdQT1BPVkVSLVdJREdFVC1TRVRUSU5HJywgZnVuY3Rpb24gKGV2LCBzY29wZSwgZGF0YSwgY2FsbGJhY2spIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoZGF0YSAhPT0gdW5kZWZpbmVkICYmICRzY29wZS53aWRnZXRJZCA9PT0gc2NvcGUud2lkZ2V0SWQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgLy9zY29wZS5pdGVtW1wiRmlsdGVySWRcIl0gPSBkYXRhW3Njb3BlLkZpbHRlcktleV07XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICRzY29wZS5yZXBvcnRJZCA9IGRhdGFbJHNjb3BlLkZpbHRlcktleV07XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAkc2NvcGUuaXRlbSA9ICRzY29wZS5wYXJlbnRJdGVtO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAkc2NvcGUuaXRlbS50ZW1wbGF0ZSA9IFwiPG5hdmNvbi1teXJpc2ttYXRyaXggPjwvbmF2Y29uLW15cmlza21hdHJpeD5cIjtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBuZXdFbGVtZW50ID0gYW5ndWxhci5lbGVtZW50KCRzY29wZS5pdGVtLnRlbXBsYXRlKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgZWwuaHRtbChuZXdFbGVtZW50KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgJGNvbXBpbGUobmV3RWxlbWVudCkoJHNjb3BlKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vbG9hZENoYXJ0UmVwb3J0KCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyRzY29wZS5zYXZlV2lkZ2V0KCk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICAgICAvL2lmIChjYWxsYmFjayAhPT0gdW5kZWZpbmVkKSBjYWxsYmFjaygpO1xyXG4gICAgICAgICAgICAgICAgfSk7Ki9cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH07XHJcbiAgICB9XHJcbl0pOyIsIi8vLyA8cmVmZXJlbmNlIHBhdGg9XCIuLi9wYWdlMS9wYWdlMS5odG1sXCIgLz5cclxuXCJ1c2Ugc3RyaWN0XCI7XHJcbmFuZ3VsYXIubW9kdWxlKCdhcHAnKS5kaXJlY3RpdmUoJ25hdmNvbkRlbGV0ZVJlbWFya3MnLCBbJyRyb290U2NvcGUnLCAnZGF0YXNlcnZpY2UnLFxyXG4gICAgZnVuY3Rpb24oJHJvb3RTY29wZSwgZGF0YXNlcnZpY2UpIHtcclxuICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICAvKkU6IERpcmVjdGl2ZSBkZWZpbmVkIGFzIGFuIGVsZW1lbnQuIDxuYXZjb24tdGFibGU+PC9uYXZjb24tdGFibGU+XHJcbiAgICAgICAgICAgICBBOiBEaXJlY3RpdmUgYXBwbGllZCBhcyBhbiBhdHRyaWJ1dGUgb24gZXhpc3RpbmcgZWxlbWVudC4gPGRpdiBuYXZjb24tdGFibGU+PC9kaXY+XHJcbiAgICAgICAgICAgICBDOiBEaXJlY3RpdmUgYXBwbGllZCBhcyBhIGNzcyBjbGFzcyB0byBleGlzdGluZyBlbGVtZW50IDxkaXYgY2xhc3M9XCJuYXZjb24tdGFibGVcIj48L2Rpdj5cclxuICAgICAgICAgICAgIE06IERpcmVjdGl2ZSBhcHBsaWVkIGFzIGNvbW1lbnQuKi9cclxuICAgICAgICAgICAgcmVzdHJpY3Q6ICdFJyxcclxuICAgICAgICAgICAgdHJhbnNjbHVkZTogdHJ1ZSxcclxuICAgICAgICAgICAgc2NvcGU6IHtcclxuICAgICAgICAgICAgICAgIC8vQCByZWFkcyB0aGUgYXR0cmlidXRlIHZhbHVlLCA9IHByb3ZpZGVzIHR3by13YXkgYmluZGluZywgJiB3b3JrcyB3aXRoIGZ1bmN0aW9uc1xyXG4gICAgICAgICAgICAgICAgbmF2Y29uRGF0YTogJz0nXHJcbiAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgIGNvbnRyb2xsZXI6IGZ1bmN0aW9uKCRzY29wZSwgJHJvb3RTY29wZSkge1xyXG4gICAgICAgICAgICAgICAgJHNjb3BlLmZvcm1NYW5hZ2UgPSB7fTtcclxuICAgICAgICAgICAgICAgICRzY29wZS5wYWdlQ29uZmlnID0ge307XHJcblxyXG4gICAgICAgICAgICAgICAgdmFyIElUQVJXYXJuaW5nSW5kZXg7XHJcblxyXG4gICAgICAgICAgICAgICAgJHNjb3BlLml0YXJ3YXJuaW5nID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICAvKlBhZ2UgQWN0aW9ucyovXHJcbiAgICAgICAgICAgICAgICBhY3RpdmF0ZSgpO1xyXG5cclxuICAgICAgICAgICAgICAgIC8qRmllbGRzKi9cclxuICAgICAgICAgICAgICAgIC8vICRzY29wZS5kZWxldGVSZW1hcmtzU3VibWl0RmllbGRzID0gJHNjb3BlLm5hdmNvbkRhdGEuZGVsZXRlUmVtYXJrc1N1Ym1pdEZpZWxkcztcclxuICAgICAgICAgICAgICAgIC8qVGFibGVzKi9cclxuXHJcblxyXG4gICAgICAgICAgICAgICAgLypicmVhZGNydW1icyovXHJcbiAgICAgICAgICAgICAgICAvKlZhcmlhYmxlIERlY2xhcmF0aW9uKi9cclxuICAgICAgICAgICAgICAgIC8qVmFyaWFibGUgRGVjbGFyYXRpb24qL1xyXG4gICAgICAgICAgICAgICAgLypQYWdlIEFjdGlvbnMqL1xyXG4gICAgICAgICAgICAgICAgLypBZGQgTmV3Ki9cclxuICAgICAgICAgICAgICAgIC8qVGFibGUgQWN0aW9uIENsaWNrKi9cclxuICAgICAgICAgICAgICAgIC8qRGVsZXRlKi9cclxuICAgICAgICAgICAgICAgIC8qVGFibGUgQWN0aW9ucyovXHJcblxyXG4gICAgICAgICAgICAgICAgLypQcml2YXQgZnVuY3Rpb25zKi9cclxuICAgICAgICAgICAgICAgIGZ1bmN0aW9uIGdldERhdGEodHlwZSwgcGFnZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBkYXRhc2VydmljZS5nZXREYXRhKHR5cGUsIHBhZ2UpLnRoZW4oZnVuY3Rpb24oZGF0YSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZGF0YTtcclxuICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgIH07XHJcblxyXG4gICAgICAgICAgICAgICAgZnVuY3Rpb24gZ2V0U2VydmVyRGF0YSh0eXBlLCByb3dJZCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBkYXRhc2VydmljZS5nZXRTZXJ2ZXJEYXRhKHR5cGUsIHJvd0lkKS50aGVuKGZ1bmN0aW9uKGRhdGEpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGRhdGE7XHJcbiAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICB9O1xyXG5cclxuXHJcbiAgICAgICAgICAgICAgICAkc2NvcGUuc2F2ZSA9IGZ1bmN0aW9uKHR5cGUsIGZpZWxkcykge1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBmaWVsZENvbmRpdGlvbiA9ICRzY29wZS5mb3JtTWFuYWdlLmZvcm1WYWxpZChmaWVsZHMpO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChmaWVsZENvbmRpdGlvbiAhPSB1bmRlZmluZWQgJiYgZmllbGRDb25kaXRpb24gPT0gdHJ1ZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAkc2NvcGUubmF2Y29uRGF0YS5kZWxldGVXaXRoUmVtYXJrcyhmaWVsZHMpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBuYXZjb24uY2xlYXJGaWVsZHNEYXRhKCRzY29wZS5kZWxldGVSZW1hcmtzU3VibWl0RmllbGRzKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9O1xyXG5cclxuICAgICAgICAgICAgICAgICRzY29wZS5jYW5jZWwgPSBmdW5jdGlvbih0eXBlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgLy8kc2NvcGUubmF2Y29uRGF0YS5jYW5jZWwodHlwZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgbmF2Y29uLmNsZWFyRmllbGRzRGF0YSgkc2NvcGUuZGVsZXRlUmVtYXJrc1N1Ym1pdEZpZWxkcyk7XHJcbiAgICAgICAgICAgICAgICAgICAgbmF2Y29uLmNsb3NlTW9kYWwodHlwZSk7XHJcbiAgICAgICAgICAgICAgICB9O1xyXG5cclxuICAgICAgICAgICAgICAgIGZ1bmN0aW9uIGdldEZpZWxkcygpIHtcclxuXHJcblxyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIGZ1bmN0aW9uIGFjdGl2YXRlKGNhbGxiYWNrKSB7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGRhdGFzZXJ2aWNlLmdldFNlcnZlckRhdGEoXCJkZWxldGVDb25maWdcIikudGhlbihmdW5jdGlvbihkYXRhKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICRzY29wZS5wYWdlQ29uZmlnID0gZGF0YTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgJHNjb3BlLmRlbGV0ZVJlbWFya3NTdWJtaXRGaWVsZHMgPSBhbmd1bGFyLmNvcHkoZGF0YS5maWVsZHMuZGVsZXRlUmVtYXJrc1N1Ym1pdEZpZWxkcyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIElUQVJXYXJuaW5nSW5kZXggPSBuYXZjb24uZ2V0SXRlbUluZGV4QnlQcm9wZXJ0eSgkc2NvcGUuZGVsZXRlUmVtYXJrc1N1Ym1pdEZpZWxkcywgXCJJVEFSV2FybmluZ1wiKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHdhdGNoQXR0cmlidXRlcygpO1xyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgICAgIH07XHJcblxyXG5cclxuICAgICAgICAgICAgICAgIGZ1bmN0aW9uIHdhdGNoQXR0cmlidXRlcygpIHtcclxuICAgICAgICAgICAgICAgICAgICAkc2NvcGUuJHdhdGNoKFwiZGVsZXRlUmVtYXJrc1N1Ym1pdEZpZWxkc1tcIiArIElUQVJXYXJuaW5nSW5kZXggKyBcIl0uZGF0YVwiLCBmdW5jdGlvbihuZXdWYWx1ZSwgb2xkVmFsdWUpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKG5ld1ZhbHVlICE9IHVuZGVmaW5lZCAmJiBuZXdWYWx1ZSAhPSAnJykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJHNjb3BlLml0YXJ3YXJuaW5nID0gbmV3VmFsdWU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkc2NvcGUuaXRhcndhcm5pbmcgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH0sIHRydWUpO1xyXG5cclxuICAgICAgICAgICAgICAgIH1cclxuXHJcblxyXG4gICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAvL3RlbXBsYXRlVXJsOiAnYXBwL2RlbGV0ZS9kZWxldGUuaHRtbCcsXHJcbiAgICAgICAgICAgIHRlbXBsYXRlVXJsOiBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBuYXZjb24uTWVudXJvdXRlLmdldFRlbXBsYXRlVXJsKFwiZGVsZXRlXCIpO1xyXG4gICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICBsaW5rOiBmdW5jdGlvbihzY29wZSwgZWwsIGF0dHJzKSB7XHJcbiAgICAgICAgICAgICAgICAvL2NvbnNvbGUubG9nKHNjb3BlKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH07XHJcbiAgICB9XHJcbl0pOyIsIlwidXNlIHN0cmljdFwiO1xyXG5hbmd1bGFyLm1vZHVsZSgnYXBwJykuZGlyZWN0aXZlKCduYXZjb25DYWxlbmRhcicsIFtcclxuZnVuY3Rpb24gKGRhdGFTZXJ2aWNlKSB7XHJcbiAgICByZXR1cm4ge1xyXG4gICAgICAgIC8qRTogRGlyZWN0aXZlIGRlZmluZWQgYXMgYW4gZWxlbWVudC4gPG5hdmNvbi10YWJsZT48L25hdmNvbi10YWJsZT5cclxuICAgICAgICBBOiBEaXJlY3RpdmUgYXBwbGllZCBhcyBhbiBhdHRyaWJ1dGUgb24gZXhpc3RpbmcgZWxlbWVudC4gPGRpdiBuYXZjb24tdGFibGU+PC9kaXY+XHJcbiAgICAgICAgQzogRGlyZWN0aXZlIGFwcGxpZWQgYXMgYSBjc3MgY2xhc3MgdG8gZXhpc3RpbmcgZWxlbWVudCA8ZGl2IGNsYXNzPVwibmF2Y29uLXRhYmxlXCI+PC9kaXY+XHJcbiAgICAgICAgTTogRGlyZWN0aXZlIGFwcGxpZWQgYXMgY29tbWVudC4qL1xyXG4gICAgICAgIHJlc3RyaWN0OiAnRScsXHJcbiAgICAgICAgc2NvcGU6IHtcclxuICAgICAgICAgICAgLy9AIHJlYWRzIHRoZSBhdHRyaWJ1dGUgdmFsdWUsID0gcHJvdmlkZXMgdHdvLXdheSBiaW5kaW5nLCAmIHdvcmtzIHdpdGggZnVuY3Rpb25zXHJcbiAgICAgICAgICAgIGNhbGVuZGFyU2V0dGluZzogJz0nLFxyXG4gICAgICAgICAgICBuYXZjb25EYXRhOiAnPSdcclxuICAgICAgICB9LFxyXG4gICAgICAgIHRlbXBsYXRlOiAnPGRpdiB0eXBlPVwiY2FsZW5kYXJcIj48L2Rpdj4nLFxyXG4gICAgICAgIGxpbms6IGZ1bmN0aW9uIChzY29wZSwgZWwsIGF0dHJzKSB7XHJcbiAgICAgICAgICAgIC8vbmF2Y29uLmNhbGVuZGFyU2V0dGluZyhlbCwgc2NvcGUuY2FsZW5kYXJTZXR0aW5nKTtcclxuXHJcbiAgICAgICAgICAgIHNjb3BlLiR3YXRjaCgnY2FsZW5kYXJTZXR0aW5nJywgZnVuY3Rpb24gKG5ld1ZhbHVlLCBvbGRWYWx1ZSkge1xyXG4gICAgICAgICAgICAgICAgbmF2Y29uLmNhbGVuZGFyU2V0dGluZyhlbCwgc2NvcGUuY2FsZW5kYXJTZXR0aW5nLCBzY29wZSk7XHJcbiAgICAgICAgICAgIH0sIHRydWUpO1xyXG5cclxuICAgICAgICAgICAgc2NvcGUuJHdhdGNoKCdjYWxlbmRhclNldHRpbmcuZGF0YScsIGZ1bmN0aW9uIChuZXdWYWx1ZSwgb2xkVmFsdWUpIHtcclxuICAgICAgICAgICAgICAgIGlmIChuZXdWYWx1ZSAhPT0gdW5kZWZpbmVkICYmIG5ld1ZhbHVlICE9PSBcIlwiKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgLy9pZiAobmV3VmFsdWUgIT09IG9sZFZhbHVlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKG5ld1ZhbHVlLnJlc291cmNlcyAhPT0gdW5kZWZpbmVkKSBzY29wZS5jYWxlbmRhclNldHRpbmcucmVzb3VyY2VzID0gbmV3VmFsdWUucmVzb3VyY2VzO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChuZXdWYWx1ZS5ldmVudHMgIT09IHVuZGVmaW5lZCkgc2NvcGUuY2FsZW5kYXJTZXR0aW5nLmV2ZW50cyA9IG5ld1ZhbHVlLmV2ZW50cztcclxuICAgICAgICAgICAgICAgICAgICAvL31cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSwgdHJ1ZSk7XHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxufV0pOyIsIlwidXNlIHN0cmljdFwiO1xyXG5hbmd1bGFyLm1vZHVsZSgnYXBwJykuZGlyZWN0aXZlKCduYXZjb25PcmdjaGFydCcsIFtcclxuZnVuY3Rpb24gKGRhdGFTZXJ2aWNlKSB7XHJcbiAgICByZXR1cm4ge1xyXG4gICAgICAgIC8qRTogRGlyZWN0aXZlIGRlZmluZWQgYXMgYW4gZWxlbWVudC4gPG5hdmNvbi10YWJsZT48L25hdmNvbi10YWJsZT5cclxuICAgICAgICBBOiBEaXJlY3RpdmUgYXBwbGllZCBhcyBhbiBhdHRyaWJ1dGUgb24gZXhpc3RpbmcgZWxlbWVudC4gPGRpdiBuYXZjb24tdGFibGU+PC9kaXY+XHJcbiAgICAgICAgQzogRGlyZWN0aXZlIGFwcGxpZWQgYXMgYSBjc3MgY2xhc3MgdG8gZXhpc3RpbmcgZWxlbWVudCA8ZGl2IGNsYXNzPVwibmF2Y29uLXRhYmxlXCI+PC9kaXY+XHJcbiAgICAgICAgTTogRGlyZWN0aXZlIGFwcGxpZWQgYXMgY29tbWVudC4qL1xyXG4gICAgICAgIHJlc3RyaWN0OiAnRScsXHJcbiAgICAgICAgc2NvcGU6IHtcclxuICAgICAgICAgICAgLy9AIHJlYWRzIHRoZSBhdHRyaWJ1dGUgdmFsdWUsID0gcHJvdmlkZXMgdHdvLXdheSBiaW5kaW5nLCAmIHdvcmtzIHdpdGggZnVuY3Rpb25zXHJcbiAgICAgICAgICAgIGNoYXJ0U2V0dGluZzogJz0nLFxyXG4gICAgICAgICAgICBuYXZjb25EYXRhOiAnPScsXHJcbiAgICAgICAgICAgIHR5cGU6ICdAJ1xyXG4gICAgICAgIH0sXHJcbiAgICAgICAgdGVtcGxhdGU6ICc8ZGl2IGlkPVwib3JnQ2hhcnRDb250YWluZXJcIj48ZGl2IGlkPVwib3JnQ2hhcnRcIiB0eXBlPVwib3JnQ2hhcnRcIj48L2Rpdj48L2Rpdj4nLFxyXG4gICAgICAgIGxpbms6IGZ1bmN0aW9uIChzY29wZSwgZWwsIGF0dHJzKSB7XHJcbiAgICAgICAgICAgIC8vJCgkKGVsKS5maW5kKFwiZGl2W3R5cGU9J2NoYXJ0J11cIilbMF0pO1xyXG5cclxuICAgICAgICAgICAgc2NvcGUuJHdhdGNoKCdjaGFydFNldHRpbmcnLCBmdW5jdGlvbiAobmV3VmFsdWUsIG9sZFZhbHVlKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAobmV3VmFsdWUgIT09IHVuZGVmaW5lZCAmJiBuZXdWYWx1ZSAhPT0gXCJcIikge1xyXG4gICAgICAgICAgICAgICAgICAgIG5hdmNvbi5jaGFydFNldHRpbmcoZWwsIHNjb3BlLmNoYXJ0U2V0dGluZywgc2NvcGUpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9LCB0cnVlKTtcclxuXHJcbiAgICAgICAgICAgIHNjb3BlLiR3YXRjaCgnY2hhcnRTZXR0aW5nLmRhdGEnLCBmdW5jdGlvbiAobmV3VmFsdWUsIG9sZFZhbHVlKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAobmV3VmFsdWUgIT09IHVuZGVmaW5lZCAmJiBuZXdWYWx1ZSAhPT0gXCJcIikge1xyXG4gICAgICAgICAgICAgICAgICAgIHNjb3BlLmNoYXJ0U2V0dGluZy5kYXRhID0gbmV3VmFsdWU7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0sIHRydWUpO1xyXG4gICAgICAgIH1cclxuICAgIH07XHJcbn1dKTsiLCJcInVzZSBzdHJpY3RcIjtcclxuXHJcbmFuZ3VsYXIubW9kdWxlKCduYXZjb25EYXNoYm9hcmQnKS5kaXJlY3RpdmUoJ21haW5EYXNoYm9hcmQnLCBbJyRyb290U2NvcGUnLCAnbG9nZ2VyJywgJ2RhdGFzZXJ2aWNlJywgZnVuY3Rpb24oJHJvb3RTY29wZSwgbG9nZ2VyLCBkYXRhc2VydmljZSkge1xyXG4gICAgcmV0dXJuIHtcclxuICAgICAgICByZXN0cmljdDogJ0FFJyxcclxuICAgICAgICAvKnNjb3BlOiB7XHJcbiAgICAgICAgICAgIHBhZ2VDb25maWc6ICc9J1xyXG4gICAgICAgIH0sKi9cclxuICAgICAgICAvL3RlbXBsYXRlVXJsOiAnZXh0LW1vZHVsZXMvbmF2Y29uRGFzaGJvYXJkL25hdmNvbkRhc2hib2FyZFRlbXBsYXRlLmh0bWwnLFxyXG4gICAgICAgIHRlbXBsYXRlVXJsOiBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgcmV0dXJuIG5hdmNvbi5NZW51cm91dGUuZ2V0VGVtcGxhdGVVcmwoXCJuYXZjb25EYXNoYm9hcmRcIik7XHJcbiAgICAgICAgfSxcclxuICAgICAgICBsaW5rOiBmdW5jdGlvbihzY29wZSwgZWxlbWVudCwgYXR0cnMpIHtcclxuICAgICAgICAgICAgZWxlbWVudC5iaW5kKCdibHVyJywgZnVuY3Rpb24oZSkge1xyXG4gICAgICAgICAgICAgICAgLy9kbyBzb21ldGhpbmdcclxuICAgICAgICAgICAgICAgIC8vY29uc29sZS5sb2coZSk7XHJcbiAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgLy9zY29wZS4kd2F0Y2goJ3Byb2plY3RJZCcsIGZ1bmN0aW9uIChuZXdWYWx1ZSwgb2xkVmFsdWUpIHtcclxuICAgICAgICAgICAgLy8gICAgaWYgKG5ld1ZhbHVlICE9PSB1bmRlZmluZWQgJiYgbmV3VmFsdWUgIT09IG9sZFZhbHVlKSB7XHJcbiAgICAgICAgICAgIC8vICAgICAgICAvL2xvZ2dlci53YXJuaW5nKG5ld1ZhbHVlKTtcclxuICAgICAgICAgICAgLy8gICAgfVxyXG4gICAgICAgICAgICAvL30sIHRydWUpO1xyXG5cclxuICAgICAgICAgICAgc2NvcGUuYWRkTmV3V2lkZ2V0ID0gZnVuY3Rpb24od2lkZ2V0KSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgbmV3V2lkZ2V0ID0gYW5ndWxhci5jb3B5KHdpZGdldC5zZXR0aW5ncyk7XHJcbiAgICAgICAgICAgICAgICB2YXIgZm91bmQgPSBuYXZjb24uZ2V0SXRlbUJ5S2V5VmFsdWUoc2NvcGUud2lkZ2V0cywgXCJ3aWRnZXRJZFwiLCB3aWRnZXQuc2V0dGluZ3Mud2lkZ2V0SWQpO1xyXG4gICAgICAgICAgICAgICAgaWYgKGZvdW5kICE9PSAtMSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGxvZ2dlci53YXJuaW5nKFwiSXQncyBhbHJlYWR5IGFkZGVkIS4uXCIpO1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIHNjb3BlLndpZGdldHMucHVzaChuZXdXaWRnZXQpO1xyXG4gICAgICAgICAgICAgICAgc2NvcGUuJGJyb2FkY2FzdCgnREFTSEJPQVJELVdJREdFVC1BQ1RJT04nLCAnYWRkJyk7XHJcbiAgICAgICAgICAgIH07XHJcblxyXG4gICAgICAgICAgICBzY29wZS5jbG9zZSA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICAgICAgJChcIiN0aGVtZXNldFwiKS5oaWRlKCk7XHJcbiAgICAgICAgICAgICAgICAkKFwiI3RoZW1lY2xvc2VcIikuaGlkZSgpO1xyXG4gICAgICAgICAgICB9O1xyXG5cclxuICAgICAgICAgICAgc2NvcGUudGhlbWVvcGVuID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgICAgICAkKFwiI3RoZW1lc2V0XCIpLnNob3coKTtcclxuICAgICAgICAgICAgfTtcclxuXHJcbiAgICAgICAgICAgIHNjb3BlLnRoZW1lY2hhbmdlID0gZnVuY3Rpb24odGhlbWUpIHtcclxuICAgICAgICAgICAgICAgICQoJ2xpbmtbaHJlZio9XCJmbHluYXN0aGVtZVwiXScpLmF0dHIoJ2hyZWYnLCAnY29udGVudC9mbHluYXN0aGVtZS0nICsgdGhlbWUgKyAnLmNzcycpO1xyXG4gICAgICAgICAgICAgICAgJCgnaW1nW3NyYyo9XCJsb2dvX1wiXScpLmF0dHIoJ3NyYycsICcuLi8uLi9Db250ZW50L2xheW91dC9pbWcvbG9nb18nICsgdGhlbWUgKyAnLnBuZycpO1xyXG4gICAgICAgICAgICAgICAgJChcIiN0aGVtZXNldFwiKS5oaWRlKCk7XHJcbiAgICAgICAgICAgIH07XHJcblxyXG4gICAgICAgICAgICAvL1BvcG92ZXIgdGVtcGxhdGVcclxuICAgICAgICAgICAgc2NvcGUuJHdhdGNoKCdwcm9qZWN0SWQnLCBmdW5jdGlvbihuZXdWYWx1ZSwgb2xkVmFsdWUpIHtcclxuICAgICAgICAgICAgICAgIGlmIChuZXdWYWx1ZSAhPT0gdW5kZWZpbmVkICYmIG5ld1ZhbHVlICE9PSBvbGRWYWx1ZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHNjb3BlLnBvcG92ZXJUZW1wbGF0ZSA9ICc8ZGl2IHN0eWxlPVwiY29sb3I6IGJsYWNrXCI+PHNlbGVjdCBjbGFzcz1cImNvbC1tZC04IG1hcmdpbi1ib3R0b20tMTBcIiBuZy1tb2RlbD1cInNlbGVjdGVkUHJvamVjdFwiIG5nLWNsaWNrPVwib25SZXBvcnRDbGljaygpXCIgbmctb3B0aW9ucz1cInguUHJvamVjdE5hbWUgZm9yIHggaW4gaXRlbXNcIiBuZy1oaWRlPVwiaXRlbXMubGVuZ3RoPT09MFwiPjwvc2VsZWN0PjwvZGl2Pic7XHJcbiAgICAgICAgICAgICAgICAgICAgLy9zY29wZS5wb3BvdmVyVGVtcGxhdGUgPSBhbmd1bGFyLmNvcHkoc2NvcGUuaXRlbS5wb3BvdmVyVGVtcGxhdGUpO1xyXG4gICAgICAgICAgICAgICAgICAgIHNjb3BlLnRlbXBsYXRlU2V0dGluZ3MgPSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHBsYWNlbWVudDogXCJib3R0b21cIixcclxuICAgICAgICAgICAgICAgICAgICAgICAgaHRtbDogdHJ1ZSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGl0bGU6IHNjb3BlLnRpdGxlLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICB0ZW1wbGF0ZUh0bWw6IHNjb3BlLnBvcG92ZXJUZW1wbGF0ZVxyXG4gICAgICAgICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0sIHRydWUpO1xyXG5cclxuICAgICAgICAgICAgc2NvcGUub25DbGljayA9IGZ1bmN0aW9uKGtleSwgc2VsZWN0ZWREYXRhLCBlKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoa2V5ID09PSBcIm1vZHVsZVwiICYmIHNlbGVjdGVkRGF0YSAhPT0gdW5kZWZpbmVkICYmIHNlbGVjdGVkRGF0YSAhPT0gbnVsbCAmJiBzY29wZS51c2VyTW9kdWxlICE9PSBzZWxlY3RlZERhdGEpIHtcclxuICAgICAgICAgICAgICAgICAgICBzY29wZS51c2VyTW9kdWxlID0gc2VsZWN0ZWREYXRhO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmIChrZXkgPT09IFwicHJvamVjdFwiICYmIHNlbGVjdGVkRGF0YSAhPT0gdW5kZWZpbmVkICYmIHNlbGVjdGVkRGF0YSAhPT0gbnVsbCAmJiBzY29wZS51c2VyUHJvamVjdCAhPT0gc2VsZWN0ZWREYXRhKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgc2NvcGUudXNlclByb2plY3QgPSBzZWxlY3RlZERhdGE7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH07XHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxufV0pOyIsIlwidXNlIHN0cmljdFwiO1xyXG5cclxuYW5ndWxhci5tb2R1bGUoJ25hdmNvbkRhc2hib2FyZCcpLmRpcmVjdGl2ZSgnbmF2Y29uV2lkZ2V0Qm9keScsIFsnJGNvbXBpbGUnLCAnJG1vZGFsJywgJ2RhdGFzZXJ2aWNlJywgJyRyb290U2NvcGUnLCAnJHRpbWVvdXQnLCAnbG9nZ2VyJyxcclxuICAgIGZ1bmN0aW9uKCRjb21waWxlLCAkbW9kYWwsIGRhdGFzZXJ2aWNlLCAkcm9vdFNjb3BlLCAkdGltZW91dCwgbG9nZ2VyKSB7XHJcbiAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgcmVzdHJpY3Q6ICdBRScsXHJcbiAgICAgICAgICAgIHNjb3BlOiB7XHJcbiAgICAgICAgICAgICAgICBwYWdlQ29uZmlnOiAnPScsXHJcbiAgICAgICAgICAgICAgICBpdGVtOiAnPScsXHJcbiAgICAgICAgICAgICAgICB3aWRnZXRzOiAnPSdcclxuICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgLy90ZW1wbGF0ZVVybDogJ2V4dC1tb2R1bGVzL25hdmNvbkRhc2hib2FyZC9uYXZjb25XaWRnZXRCb2R5VGVtcGxhdGUuaHRtbCcsXHJcbiAgICAgICAgICAgIHRlbXBsYXRlVXJsOiBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBuYXZjb24uTWVudXJvdXRlLmdldFRlbXBsYXRlVXJsKFwibmF2Y29uV2lkZ2V0Qm9keVwiKTtcclxuICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgbGluazogZnVuY3Rpb24oc2NvcGUsIGVsZW1lbnQsIGF0dHJzKSB7XHJcbiAgICAgICAgICAgICAgICBzY29wZS53aWRnZXRJZCA9IGFuZ3VsYXIuY29weShzY29wZS5pdGVtLndpZGdldElkKTtcclxuICAgICAgICAgICAgICAgIHNjb3BlLm1vZHVsZUlkID0gYW5ndWxhci5jb3B5KHNjb3BlLml0ZW0uTW9kdWxlSWQpO1xyXG4gICAgICAgICAgICAgICAgc2NvcGUucG9wb3ZlclRlbXBsYXRlID0gYW5ndWxhci5jb3B5KHNjb3BlLml0ZW0ucG9wb3ZlclRlbXBsYXRlKTtcclxuICAgICAgICAgICAgICAgIHNjb3BlLm9wdGlvbnMgPSBhbmd1bGFyLmNvcHkoc2NvcGUuaXRlbS5vcHRpb25zKTtcclxuXHJcbiAgICAgICAgICAgICAgICBpZiAoc2NvcGUuaXRlbSAhPT0gdW5kZWZpbmVkICYmIHNjb3BlLml0ZW0ucmVwb3J0U2V0dGluZyAhPT0gdW5kZWZpbmVkKVxyXG4gICAgICAgICAgICAgICAgICAgIHNjb3BlLnJlcG9ydFNldHRpbmcgPSBhbmd1bGFyLmNvcHkoc2NvcGUuaXRlbS5yZXBvcnRTZXR0aW5nKTtcclxuXHJcbiAgICAgICAgICAgICAgICAvL3Njb3BlLnJlcG9ydExpc3QgPSBbXTtcclxuICAgICAgICAgICAgICAgIHNjb3BlLmRlZmF1bHRSZXBvcnQgPSBbXTtcclxuXHJcbiAgICAgICAgICAgICAgICBmdW5jdGlvbiBnZXRTZXJ2ZXJEYXRhKHR5cGUsIHJvd0lkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGRhdGFzZXJ2aWNlLmdldFNlcnZlckRhdGEodHlwZSwgcm93SWQpLnRoZW4oZnVuY3Rpb24oZGF0YSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZGF0YTtcclxuICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgIH07XHJcblxyXG4gICAgICAgICAgICAgICAgaWYgKHNjb3BlLml0ZW0gIT09IHVuZGVmaW5lZCAmJiBzY29wZS5pdGVtLm9wdGlvbnMgIT09IHVuZGVmaW5lZCAmJiBzY29wZS5pdGVtLm9wdGlvbnMuZmlsdGVyKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHNjb3BlLml0ZW0ucmVwb3J0TGlzdCAhPT0gdW5kZWZpbmVkICYmIHNjb3BlLml0ZW0ucmVwb3J0TGlzdC5sZW5ndGggPT09IDApIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgZ2V0U2VydmVyRGF0YShcIm15U3BhY2VSZXBvcnRMaXN0XCIsIHNjb3BlLm1vZHVsZUlkKS50aGVuKGZ1bmN0aW9uKGRhdGEpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciByZXBvcnRMaXN0ID0gc2NvcGUuaXRlbS5yZXBvcnRMaXN0O1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGRhdGEgIT09IHVuZGVmaW5lZCAmJiBkYXRhICE9PSBudWxsICYmIGRhdGEubGVuZ3RoICE9IDApIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXBvcnRMaXN0ID0gZGF0YTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNjb3BlLnJlcG9ydExpc3QgPSByZXBvcnRMaXN0O1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBkZWZhdWx0UmVwb3J0ID0gc2NvcGUucmVwb3J0TGlzdFswXTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChzY29wZS5pdGVtLkZpbHRlcklkICE9PSB1bmRlZmluZWQgJiYgc2NvcGUuaXRlbS5GaWx0ZXJJZCAhPT0gbnVsbCAmJiBzY29wZS5pdGVtLkZpbHRlcklkICE9PSBcIlwiKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGtleUlkID0gc2NvcGUuaXRlbS5GaWx0ZXJLZXk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGNoZWNrVmFsdWUgPSBzY29wZS5pdGVtLkZpbHRlcklkLnRvU3RyaW5nKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGl0ZW1MaXN0ID0gbmF2Y29uLmdldEl0ZW1CeUtleVZhbHVlKHNjb3BlLnJlcG9ydExpc3QsIGtleUlkLCBjaGVja1ZhbHVlKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZWZhdWx0UmVwb3J0ID0gaXRlbUxpc3Q7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzY29wZS5kZWZhdWx0UmVwb3J0ID0gZGVmYXVsdFJlcG9ydDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChzY29wZS5pdGVtLnJlcG9ydExpc3QgIT09IHVuZGVmaW5lZCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAkdGltZW91dChmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNjb3BlLnJlcG9ydExpc3QgPSBhbmd1bGFyLmNvcHkoc2NvcGUuaXRlbS5yZXBvcnRMaXN0KTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgZGVmYXVsdFJlcG9ydCA9IHNjb3BlLnJlcG9ydExpc3RbMF07XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoc2NvcGUuaXRlbS5GaWx0ZXJJZCAhPT0gdW5kZWZpbmVkICYmIHNjb3BlLml0ZW0uRmlsdGVySWQgIT09IG51bGwgJiYgc2NvcGUuaXRlbS5GaWx0ZXJJZCAhPT0gXCJcIikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBrZXlJZCA9IHNjb3BlLml0ZW0uRmlsdGVyS2V5O1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBjaGVja1ZhbHVlID0gc2NvcGUuaXRlbS5GaWx0ZXJJZC50b1N0cmluZygpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBpdGVtTGlzdCA9IG5hdmNvbi5nZXRJdGVtQnlLZXlWYWx1ZShzY29wZS5yZXBvcnRMaXN0LCBrZXlJZCwgY2hlY2tWYWx1ZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGVmYXVsdFJlcG9ydCA9IGl0ZW1MaXN0O1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc2NvcGUuZGVmYXVsdFJlcG9ydCA9IGRlZmF1bHRSZXBvcnQ7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAvL3ZhciB0ZW1wbGF0ZURhdGEgPSAnXCI8c2VsZWN0IGNsYXNzPVwiY29sLW1kLTggbWFyZ2luLWJvdHRvbS0xMFwiIG5nLW1vZGVsPVwic2VsZWN0ZWRSZXBvcnRcIiBuZy1jbGljaz1cIm9uUmVwb3J0Q2xpY2soKVwiIG5nLW9wdGlvbnM9XCJ4LnRpdGxlIGZvciB4IGluIGl0ZW1zXCIgbmctaGlkZT1cInJlcG9ydExpc3QubGVuZ3RoPT09MFwiPjwvc2VsZWN0Pic7XHJcblxyXG4gICAgICAgICAgICAgICAgc2NvcGUudGVtcGxhdGVTZXR0aW5ncyA9IHtcclxuICAgICAgICAgICAgICAgICAgICBwbGFjZW1lbnQ6IFwibGVmdFwiLFxyXG4gICAgICAgICAgICAgICAgICAgIGh0bWw6IHRydWUsXHJcbiAgICAgICAgICAgICAgICAgICAgdGl0bGU6IHNjb3BlLnRpdGxlLFxyXG4gICAgICAgICAgICAgICAgICAgIHRlbXBsYXRlSHRtbDogc2NvcGUucG9wb3ZlclRlbXBsYXRlXHJcbiAgICAgICAgICAgICAgICB9O1xyXG5cclxuICAgICAgICAgICAgICAgIC8vc2NvcGUub25SZXBvcnRDbGljayA9IGZ1bmN0aW9uIChpdGVtKSB7XHJcbiAgICAgICAgICAgICAgICAvLyAgICBsb2dnZXIud2FybmluZyhpdGVtKTtcclxuICAgICAgICAgICAgICAgIC8vfTtcclxuXHJcbiAgICAgICAgICAgICAgICB2YXIgdGVtcGxhZ2UgPSBcIjxkaXY+PC9kaXY+XCI7XHJcbiAgICAgICAgICAgICAgICBpZiAoc2NvcGUuaXRlbS50ZW1wbGF0ZSAhPT0gdW5kZWZpbmVkICYmIHNjb3BlLml0ZW0udGVtcGxhdGUgIT09IFwiXCIpXHJcbiAgICAgICAgICAgICAgICAgICAgdGVtcGxhZ2UgPSBzY29wZS5pdGVtLnRlbXBsYXRlO1xyXG4gICAgICAgICAgICAgICAgdmFyIG5ld0VsZW1lbnQgPSBhbmd1bGFyLmVsZW1lbnQodGVtcGxhZ2UpO1xyXG4gICAgICAgICAgICAgICAgZWxlbWVudC5hcHBlbmQobmV3RWxlbWVudCk7XHJcbiAgICAgICAgICAgICAgICAkY29tcGlsZShuZXdFbGVtZW50KShzY29wZSk7XHJcblxyXG4gICAgICAgICAgICAgICAgc2NvcGUuJG9uKCdQT1BPVkVSLVdJREdFVC1TRVRUSU5HJywgZnVuY3Rpb24oZXYsIHBvcE92ZXJTY29wZSwgZGF0YSwgY2FsbGJhY2spIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoZGF0YSAhPT0gdW5kZWZpbmVkICYmIHNjb3BlLndpZGdldElkID09PSBwb3BPdmVyU2NvcGUud2lkZ2V0SWQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHNjb3BlLml0ZW0uRmlsdGVyS2V5ID09PSB1bmRlZmluZWQgfHwgc2NvcGUuaXRlbS5GaWx0ZXJLZXkgPT09IG51bGwgfHwgc2NvcGUuaXRlbS5GaWx0ZXJLZXkgPT09IFwiXCIpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzY29wZS5pdGVtLkZpbHRlcktleSA9IFwiUmVwb3J0Q29kZVwiO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgc2NvcGUuaXRlbVtcIkZpbHRlcklkXCJdID0gZGF0YVtzY29wZS5pdGVtLkZpbHRlcktleV07XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vc2NvcGUucmVwb3J0SWQgPSBkYXRhW3Njb3BlLml0ZW0uRmlsdGVyS2V5XTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vaWYgKHBhcnNlSW50KGRhdGEuTXlTcGFjZVJlcG9ydElkKSA+IDEpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgc2NvcGUuaXRlbS50aXRsZSA9IGRhdGEuUmVwb3J0TmFtZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgc2NvcGUuaXRlbS50ZW1wbGF0ZSA9IGRhdGEuVGVtcGxhdGU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vfVxyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIG5ld0VsZW1lbnQgPSBhbmd1bGFyLmVsZW1lbnQoc2NvcGUuaXRlbS50ZW1wbGF0ZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vZWxlbWVudC5hcHBlbmQobmV3RWxlbWVudCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICQoZWxlbWVudC5jaGlsZHJlbigpWzFdKS5odG1sKG5ld0VsZW1lbnQpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAkY29tcGlsZShuZXdFbGVtZW50KShzY29wZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICAgICAvL2lmIChjYWxsYmFjayAhPT0gdW5kZWZpbmVkKSBjYWxsYmFjaygpO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICAgICAgc2NvcGUuY2xvc2UgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgICAgICAgICAkcm9vdFNjb3BlLiRicm9hZGNhc3QoJ0RBU0hCT0FSRC1XSURHRVQtQUNUSU9OJywgJ2RlbGV0ZScsIGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgZGVsZXRlZEluZGV4ID0gc2NvcGUud2lkZ2V0cy5pbmRleE9mKHNjb3BlLml0ZW0pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgcHJldmlvdXNJZCA9IHNjb3BlLml0ZW0ud2lkZ2V0SWQ7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBwcmV2aW91c0xlZnQgPSAkKFwiLmRhc2hib2FyZFdpZGdldF9cIiArIHNjb3BlLml0ZW0ud2lkZ2V0SWQpLmNzcyhcImxlZnRcIikucmVwbGFjZShcInB4XCIsIFwiXCIpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgcHJldmlvdXNUb3AgPSAkKFwiLmRhc2hib2FyZFdpZGdldF9cIiArIHNjb3BlLml0ZW0ud2lkZ2V0SWQpLmNzcyhcInRvcFwiKS5yZXBsYWNlKFwicHhcIiwgXCJcIik7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICBzY29wZS53aWRnZXRzLnNwbGljZShkZWxldGVkSW5kZXgsIDEpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgLy92YXIgd2lkZ2V0cyA9IFtdO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAvL2FuZ3VsYXIuZm9yRWFjaChzY29wZS53aWRnZXRzLCBmdW5jdGlvbiAoaXRlbSwga2V5KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vICAgIGlmIChpdGVtW1widXNlcldpZGdldElkXCJdID09PSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gICAgICAgIGl0ZW1bXCJ1c2VyV2lkZ2V0SWRcIl0gPSAwO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyAgICAgICAgaXRlbVtcInVwZGF0ZVwiXSA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gICAgd2lkZ2V0cy5wdXNoKGl0ZW0pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAvL30pO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgLy9kYXRhc2VydmljZS5wdXRTZXJ2ZXJEYXRhKFwiSG9tZS9XaWRnZXRzL1VwZGF0ZVwiLCB3aWRnZXRzLCBcIkhvbWUvV2lkZ2V0cy9VcGRhdGVcIikudGhlbihmdW5jdGlvbiAoZGF0YSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyAgICAkcm9vdFNjb3BlLmRhc2hib2FyZFdpZGdldHMgPSBzY29wZS53aWRnZXRzO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAvL30pO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgc2NvcGUuc2F2ZVdpZGdldCgpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgJC5tYXAoc2NvcGUud2lkZ2V0cywgZnVuY3Rpb24oaXRlbSwgaW5kZXgpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChkZWxldGVkSW5kZXggPD0gaW5kZXgpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgY3VycmVudExlZnQgPSAkKFwiLmRhc2hib2FyZFdpZGdldF9cIiArIGl0ZW0ud2lkZ2V0SWQpLmNzcyhcImxlZnRcIikucmVwbGFjZShcInB4XCIsIFwiXCIpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBjdXJyZW50VG9wID0gJChcIi5kYXNoYm9hcmRXaWRnZXRfXCIgKyBpdGVtLndpZGdldElkKS5jc3MoXCJ0b3BcIikucmVwbGFjZShcInB4XCIsIFwiXCIpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcmV2aW91c0lkID0gaXRlbS53aWRnZXRJZDtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGl0ZW0uc2l6ZVggIT09IDEyICYmIHBhcnNlSW50KGN1cnJlbnRMZWZ0KSA+IDApIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJChcIi5kYXNoYm9hcmRXaWRnZXRfXCIgKyBpdGVtLndpZGdldElkKS5jc3MoXCJsZWZ0XCIsIHByZXZpb3VzTGVmdCArIFwicHhcIik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICQoXCIuZGFzaGJvYXJkV2lkZ2V0X1wiICsgaXRlbS53aWRnZXRJZCkuY3NzKFwidG9wXCIsIHByZXZpb3VzVG9wICsgXCJweFwiKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHByZXZpb3VzTGVmdCA9IFwiXCI7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHByZXZpb3VzVG9wID0gXCJcIjtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHByZXZpb3VzVG9wICE9PSBcIlwiKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICQoXCIuZGFzaGJvYXJkV2lkZ2V0X1wiICsgaXRlbS53aWRnZXRJZCkuY3NzKFwidG9wXCIsIHByZXZpb3VzVG9wICsgXCJweFwiKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJldmlvdXNUb3AgPSBjdXJyZW50VG9wO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHByZXZpb3VzTGVmdCA9IFwiXCI7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHByZXZpb3VzVG9wID0gXCJcIjtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgfTtcclxuXHJcbiAgICAgICAgICAgICAgICBzY29wZS5zZXR0aW5ncyA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICAgICAgICAgIC8qdmFyIG9wdGlvbnMgPSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRlbXBsYXRlVXJsOiBzY29wZS5pdGVtLnRlbXBsYXRlLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBjb250cm9sbGVyOiBzY29wZS5pdGVtLndpZGdldFNldHRpbmdzLmNvbnRyb2xsZXIsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlc29sdmU6IHNjb3BlLml0ZW0ud2lkZ2V0U2V0dGluZ3MucmVzb2x2ZSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgc2NvcGU6IHNjb3BlXHJcbiAgICAgICAgICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgICAgICAgICAkbW9kYWwub3BlbihvcHRpb25zKTsqL1xyXG4gICAgICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgICAgIC8vc2NvcGUuc2V0dGluZ3MoKTtcclxuICAgICAgICAgICAgICAgIHNjb3BlLmljb25DbGlja2VkID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgLy8gZW1wdHkgYm9keS5cclxuICAgICAgICAgICAgICAgICAgICAvLyB0aGlzIGZ1bmN0aW9uIGlzIHVzZWQgYnkgbmctY2xpY2sgaW4gdGhlIHRlbXBsYXRlXHJcbiAgICAgICAgICAgICAgICAgICAgLy8gc28gdGhhdCBpY29uIGNsaWNrcyBhcmVuJ3QgaW50ZXJjZXB0ZWQgYnkgd2lkZ2V0c1xyXG4gICAgICAgICAgICAgICAgfTtcclxuXHJcbiAgICAgICAgICAgICAgICBzY29wZS5vcGVuU2V0dGluZ3MgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgICAgICAgICAkKFwiLndpZGdldFNldHRpbmdzXCIpLmNzcyhcImRpc3BsYXlcIiwgXCJibG9ja1wiKTtcclxuICAgICAgICAgICAgICAgIH07XHJcblxyXG4gICAgICAgICAgICAgICAgc2NvcGUuc2F2ZVdpZGdldCA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciB3aWRnZXRzID0gW107XHJcbiAgICAgICAgICAgICAgICAgICAgYW5ndWxhci5mb3JFYWNoKHNjb3BlLndpZGdldHMsIGZ1bmN0aW9uKGl0ZW0sIGtleSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoaXRlbVtcIlVzZXJXaWRnZXRJZFwiXSA9PT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpdGVtW1wiVXNlcldpZGdldElkXCJdID0gMDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGl0ZW1bXCJ1cGRhdGVcIl0gPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICB3aWRnZXRzLnB1c2goaXRlbSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGlmICh3aWRnZXRzLmxlbmd0aCAhPT0gMCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBkYXRhc2VydmljZS5wdXRTZXJ2ZXJEYXRhKFwibXlTcGFjZVVwZGF0ZVwiLCB3aWRnZXRzKS50aGVuKGZ1bmN0aW9uKGRhdGEpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vbG9nZ2VyLndhcm5pbmcoXCJNeSBzcGFjZSBkYXRhIFVwZGF0ZWRcIik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyRyb290U2NvcGUuZGFzaGJvYXJkV2lkZ2V0cyA9IHNjb3BlLndpZGdldHM7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH07XHJcbiAgICB9XHJcbl0pOyIsIlwidXNlIHN0cmljdFwiO1xyXG5hbmd1bGFyLm1vZHVsZSgnYXBwJykuZGlyZWN0aXZlKCduYXZjb25Ecm9wZG93bicsIFtcclxuZnVuY3Rpb24gKGRhdGFTZXJ2aWNlKSB7XHJcbiAgICByZXR1cm4ge1xyXG4gICAgICAgIC8qRTogRGlyZWN0aXZlIGRlZmluZWQgYXMgYW4gZWxlbWVudC4gPG5hdmNvbi10YWJsZT48L25hdmNvbi10YWJsZT5cclxuICAgICAgICBBOiBEaXJlY3RpdmUgYXBwbGllZCBhcyBhbiBhdHRyaWJ1dGUgb24gZXhpc3RpbmcgZWxlbWVudC4gPGRpdiBuYXZjb24tdGFibGU+PC9kaXY+XHJcbiAgICAgICAgQzogRGlyZWN0aXZlIGFwcGxpZWQgYXMgYSBjc3MgY2xhc3MgdG8gZXhpc3RpbmcgZWxlbWVudCA8ZGl2IGNsYXNzPVwibmF2Y29uLXRhYmxlXCI+PC9kaXY+XHJcbiAgICAgICAgTTogRGlyZWN0aXZlIGFwcGxpZWQgYXMgY29tbWVudC4qL1xyXG4gICAgICAgIHJlc3RyaWN0OiAnRScsXHJcbiAgICAgICAgc2NvcGU6IHtcclxuICAgICAgICAgICAgLy9AIHJlYWRzIHRoZSBhdHRyaWJ1dGUgdmFsdWUsID0gcHJvdmlkZXMgdHdvLXdheSBiaW5kaW5nLCAmIHdvcmtzIHdpdGggZnVuY3Rpb25zXHJcbiAgICAgICAgICAgIHNlbGVjdE9wdGlvbnM6ICc9JyxcclxuICAgICAgICAgICAgc2VsZWN0ZWQ6J0AnLFxyXG4gICAgICAgICAgICBpdGVtczonQCdcclxuICAgICAgICB9LFxyXG4gICAgICAgIHRlbXBsYXRlOiAnPHVpLXNlbGVjdCBuZy1tb2RlbD1cInNlbGVjdGVkXCIgdGhlbWU9XCJzZWxlY3RpemVcIj4nICsgXHJcbiAgICAgICAgICAgICc8dWktc2VsZWN0LW1hdGNoIHBsYWNlaG9sZGVyPVwie3tzZWxlY3RPcHRpb25zLnBsYWNlaG9sZGVyfX1cIj57eyRzZWxlY3Quc2VsZWN0ZWQudGV4dH19PC91aS1zZWxlY3QtbWF0Y2g+JyArXHJcbiAgICAgICAgICAgICc8dWktc2VsZWN0LWNob2ljZXMgcmVwZWF0PVwiaXRlbSBpbiBpdGVtcyBcIj4nICtcclxuICAgICAgICAgICAgJzxkaXYgbmctYmluZC1odG1sPVwiaXRlbS50ZXh0IHwgaGlnaGxpZ2h0OiAkc2VsZWN0LnNlYXJjaFwiPjwvZGl2PicgK1xyXG4gICAgICAgICAgICAnPC91aS1zZWxlY3QtY2hvaWNlcz48L3VpLXNlbGVjdD4gJyxcclxuICAgICAgICBsaW5rOiBmdW5jdGlvbiAoc2NvcGUsIGVsLCBhdHRycykge1xyXG4gICAgICAgICAgICBzY29wZS5pdGVtcyA9IHNjb3BlLnNlbGVjdE9wdGlvbnMuaXRlbXM7XHJcbiAgICAgICAgICAgIC8vY29uc29sZS5sb2coc2NvcGUpOyAgICBcclxuICAgICAgICB9XHJcbiAgICB9O1xyXG59XSk7IiwiXCJ1c2Ugc3RyaWN0XCI7XHJcbmFuZ3VsYXIubW9kdWxlKCdhcHAnKS5kaXJlY3RpdmUoJ25hdmNvbkV2YWx1YXRpb24nLCBbJ2RhdGFzZXJ2aWNlJywgJ2xvZ2dlcicsICckdGltZW91dCcsICckY29tcGlsZScsXHJcbiAgICBmdW5jdGlvbihkYXRhc2VydmljZSwgbG9nZ2VyLCAkdGltZW91dCwgJGNvbXBpbGUpIHtcclxuICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICByZXN0cmljdDogJ0UnLFxyXG4gICAgICAgICAgICBzY29wZToge1xyXG4gICAgICAgICAgICAgICAgb3B0aW9uU2V0dGluZ3M6ICc9JyxcclxuICAgICAgICAgICAgICAgIG5hdmNvbkRhdGE6ICc9JyxcclxuICAgICAgICAgICAgICAgIHR5cGU6ICdAJyxcclxuICAgICAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnQCcsXHJcbiAgICAgICAgICAgICAgICBpc0V4cGFuZDogJ0AnXHJcbiAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgIC8vdGVtcGxhdGVVcmw6ICdleHQtbW9kdWxlcy9uYXZjb25FdmFsdWF0aW9uL25hdmNvbkV2YWx1YXRpb25UZW1wbGF0ZS5odG1sJyxcclxuICAgICAgICAgICAgdGVtcGxhdGVVcmw6IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIG5hdmNvbi5NZW51cm91dGUuZ2V0VGVtcGxhdGVVcmwoXCJuYXZjb25FdmFsdWF0aW9uXCIpO1xyXG4gICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICBjb250cm9sbGVyOiBmdW5jdGlvbigkc2NvcGUpIHtcclxuICAgICAgICAgICAgICAgICRzY29wZS5pdGVtcyA9IFtdO1xyXG4gICAgICAgICAgICAgICAgJHNjb3BlLnRleHRGaWVsZHMgPSBcInRleHRcIjtcclxuICAgICAgICAgICAgICAgICRzY29wZS5ncmFkZUZpZWxkcyA9IFwiRWZyb21SYXRpbmdJZFwiO1xyXG4gICAgICAgICAgICAgICAgJHNjb3BlLnJlbWFya3NGaWVsZHMgPSBcIlJlbWFya3NcIjtcclxuXHJcbiAgICAgICAgICAgICAgICAkc2NvcGUub3B0aW9uRGF0YSA9IFtdO1xyXG4gICAgICAgICAgICAgICAgJHNjb3BlLm9wdGlvbklkID0gXCJpZFwiO1xyXG4gICAgICAgICAgICAgICAgJHNjb3BlLm9wdGlvblRleHQgPSBcInRleHRcIjtcclxuXHJcbiAgICAgICAgICAgICAgICAkc2NvcGUudG9nZ2xlQ29sbGFwc2UgPSB0b2dnbGVDb2xsYXBzZTtcclxuXHJcbiAgICAgICAgICAgICAgICAkc2NvcGUuJHdhdGNoKCdpc0V4cGFuZCcsIGZ1bmN0aW9uKG5ld1ZhbHVlLCBvbGRWYWx1ZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICRzY29wZS50b2dnbGVDb2xsYXBzZSgkc2NvcGUuaXRlbXMpXHJcbiAgICAgICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgICAgICAkc2NvcGUuJHdhdGNoKCdvcHRpb25TZXR0aW5ncycsIGZ1bmN0aW9uKG5ld1ZhbHVlLCBvbGRWYWx1ZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChuZXdWYWx1ZSAhPT0gdW5kZWZpbmVkICYmIG5ld1ZhbHVlICE9PSBcIlwiKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICRzY29wZS50ZXh0RmllbGRzID0gbmV3VmFsdWUuZmllbGRLZXkudGV4dEZpZWxkO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAkc2NvcGUuZ3JhZGVGaWVsZHMgPSBuZXdWYWx1ZS5maWVsZEtleS5ncmFkZUZpZWxkO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAkc2NvcGUucmVtYXJrc0ZpZWxkcyA9IG5ld1ZhbHVlLmZpZWxkS2V5LnJlbWFya3NGaWVsZDtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICRzY29wZS5vcHRpb25JZCA9IG5ld1ZhbHVlLmZpZWxkS2V5Lm9wdGlvbkZpZWxkLmlkO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAkc2NvcGUub3B0aW9uVGV4dCA9IG5ld1ZhbHVlLmZpZWxkS2V5Lm9wdGlvbkZpZWxkLnRleHQ7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICRzY29wZS5vcHRpb25SZXF1aXJlZCA9IG5ld1ZhbHVlLmZpZWxkS2V5Lm9wdGlvbkZpZWxkLnJlcXVpcmVkO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgICAgICRzY29wZS4kd2F0Y2goJ29wdGlvblNldHRpbmdzLmNvcmUub3B0aW9uRGF0YScsIGZ1bmN0aW9uKG5ld1ZhbHVlLCBvbGRWYWx1ZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChuZXdWYWx1ZSAhPT0gdW5kZWZpbmVkICYmIG5ld1ZhbHVlICE9PSBcIlwiICYmIG5ld1ZhbHVlLmxlbmd0aCA+IDApIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCRzY29wZS5vcHRpb25TZXR0aW5ncyAhPT0gdW5kZWZpbmVkICYmICRzY29wZS5vcHRpb25TZXR0aW5ncyAhPT0gbnVsbClcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICRzY29wZS5vcHRpb25EYXRhID0gbmV3VmFsdWU7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICAgICAgJHNjb3BlLiR3YXRjaCgnb3B0aW9uU2V0dGluZ3MuY29yZS5kYXRhJywgZnVuY3Rpb24obmV3VmFsdWUsIG9sZFZhbHVlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKG5ld1ZhbHVlICE9PSB1bmRlZmluZWQgJiYgbmV3VmFsdWUgIT09IFwiXCIgJiYgbmV3VmFsdWUubGVuZ3RoID4gMCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAkc2NvcGUuaXRlbXMgPSBhZGREZXB0aFRvVHJlZShuZXdWYWx1ZSwgMSwgJHNjb3BlLmNvbGxhcHNlZCwgJHNjb3BlKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgICAgICAkc2NvcGUuZ3JhZGVDaGFuZ2UgPSBmdW5jdGlvbihkYXRhLCBpdGVtLCBjdHJsKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIGN0cmxJZCA9IGl0ZW0uaWQ7XHJcbiAgICAgICAgICAgICAgICAgICAgJChcIiNcIiArIGN0cmxJZCArIFwiX2dyYWRlXCIpLnJlbW92ZUNsYXNzKFwiZXZhbHVhdGlvbi1tYW5kYXRvcnlcIik7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIHZhciByZW1hcmtzID0gJChcIiNcIiArIGN0cmxJZCArIFwiX3JlbWFya3NcIik7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGRhdGEuRmFpbHVyZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpdGVtLmRhdGEuRmFpbHVyZSA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICQoXCIjXCIgKyBjdHJsSWQgKyBcIl9zcG5yZW1hcmtzXCIpLmFkZENsYXNzKFwiZXZhbHVhdGlvbi1SZW1hcmtzLUZhaWx1cmVcIik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChyZW1hcmtzICE9PSB1bmRlZmluZWQgJiYgcmVtYXJrc1swXS52YWx1ZSA9PT0gXCJcIikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9nZ2VyLndhcm5pbmcoXCJQbGVhc2UgZW50ZXIgcmVtYXJrc1wiKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlbWFya3MuYWRkQ2xhc3MoXCJldmFsdWF0aW9uLVJlbWFya3MtRmFpbHVyZVwiKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlbWFya3MuZm9jdXMoKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGl0ZW0uZGF0YS5GYWlsdXJlID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICQoXCIjXCIgKyBjdHJsSWQgKyBcIl9zcG5yZW1hcmtzXCIpLnJlbW92ZUNsYXNzKFwiZXZhbHVhdGlvbi1SZW1hcmtzLUZhaWx1cmVcIik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlbWFya3MucmVtb3ZlQ2xhc3MoXCJldmFsdWF0aW9uLVJlbWFya3MtRmFpbHVyZVwiKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9O1xyXG5cclxuICAgICAgICAgICAgICAgICRzY29wZS5SZW1hcmtDaGFuZ2UgPSBmdW5jdGlvbihkYXRhLCBjdHJsLCBjdHJsSWQpIHtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgcmVtYXJrcyA9ICQoXCIjXCIgKyBjdHJsSWQgKyBcIl9yZW1hcmtzXCIpO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChkYXRhICE9PSB1bmRlZmluZWQgJiYgZGF0YSAhPSBcIlwiKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlbWFya3MucmVtb3ZlQ2xhc3MoXCJldmFsdWF0aW9uLVJlbWFya3MtRmFpbHVyZVwiKTtcclxuICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGRhdGEgIT09IHVuZGVmaW5lZCAmJiBkYXRhID09IFwiXCIpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmVtYXJrcy5hZGRDbGFzcygkKFwiI1wiICsgY3RybElkICsgXCJfc3BucmVtYXJrc1wiKVswXS5jbGFzc05hbWUpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH07XHJcblxyXG4gICAgICAgICAgICAgICAgZnVuY3Rpb24gdG9nZ2xlQ29sbGFwc2Uob2JqKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIga2V5IGluIG9iaikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAob2JqW2tleV0gJiYgdHlwZW9mKG9ialtrZXldKSA9PSAnb2JqZWN0Jykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgb2JqW2tleV0uY29sbGFwc2VkID0gIW9ialtrZXldLmNvbGxhcHNlZDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRvZ2dsZUNvbGxhcHNlKG9ialtrZXldKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBvYmpcclxuICAgICAgICAgICAgICAgIH07XHJcblxyXG4gICAgICAgICAgICAgICAgZnVuY3Rpb24gYWRkRGVwdGhUb1RyZWUob2JqLCBkZXB0aCwgY29sbGFwc2VkLCAkc2NvcGUpIHtcclxuICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBrZXkgaW4gb2JqKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChvYmpba2V5XSAmJiBrZXkgPT09IFwiZGF0YVwiICYmIHR5cGVvZihvYmpba2V5XSkgPT0gJ29iamVjdCcpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBpdGVtTGlzdCA9IG5hdmNvbi5nZXRJdGVtQnlLZXlWYWx1ZSgkc2NvcGUub3B0aW9uRGF0YSwgJHNjb3BlLm9wdGlvbklkLCBvYmpba2V5XVskc2NvcGUuZ3JhZGVGaWVsZHNdKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChvYmouY2hpbGRyZW4gIT09IHVuZGVmaW5lZCAmJiBvYmouY2hpbGRyZW4gIT09IG51bGwpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb2JqW2tleV1bJHNjb3BlLmdyYWRlRmllbGRzXSA9IGl0ZW1MaXN0ICE9PSAtMSA/IGl0ZW1MaXN0IDogMDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2VcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvYmpba2V5XVskc2NvcGUuZ3JhZGVGaWVsZHNdID0gaXRlbUxpc3QgIT09IC0xID8gaXRlbUxpc3QgOiBbXTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAob2JqW2tleV0gJiYgdHlwZW9mKG9ialtrZXldKSA9PSAnb2JqZWN0Jykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgb2JqW2tleV0uZGVwdGggPSBkZXB0aDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9ialtrZXldLmNvbGxhcHNlZCA9IGNvbGxhcHNlZDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9ialtrZXldLkZhaWx1cmUgPSBuYXZjb24uZ2V0SXRlbUJ5S2V5VmFsdWUoJHNjb3BlLm9wdGlvbkRhdGEsICRzY29wZS5ncmFkZUZpZWxkcywgb2JqLkVGb3JtUmF0aW5nSWQpLkZhaWx1cmU7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYWRkRGVwdGhUb1RyZWUob2JqW2tleV0sIGtleSA9PT0gJ2NoaWxkcmVuJyA/ICsrZGVwdGggOiBkZXB0aCwgY29sbGFwc2VkLCAkc2NvcGUpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG9ialxyXG4gICAgICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgbGluazogZnVuY3Rpb24oJHNjb3BlLCBlbCwgYXR0cnMpIHtcclxuXHJcbiAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgIGNvbXBpbGU6IGZ1bmN0aW9uKGVsZW1lbnQsIGF0dHJzKSB7XHJcbiAgICAgICAgICAgICAgICBhdHRycy50ZW1wbGF0ZVVybCA9IGF0dHJzLnRlbXBsYXRlVXJsID8gYXR0cnMudGVtcGxhdGVVcmwgOiAnbmF2Y29uTm9kZURhdGEnO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfTtcclxuICAgIH1cclxuXSk7IiwiXCJ1c2Ugc3RyaWN0XCI7XHJcbmFuZ3VsYXIubW9kdWxlKCdhcHAnKS5kaXJlY3RpdmUoJ25hdmNvbkZjaGFydCcsIFsnZGF0YXNlcnZpY2UnLFxyXG5mdW5jdGlvbiAoZGF0YXNlcnZpY2UpIHtcclxuICAgIHJldHVybiB7XHJcbiAgICAgICAgLypFOiBEaXJlY3RpdmUgZGVmaW5lZCBhcyBhbiBlbGVtZW50LiA8bmF2Y29uLXRhYmxlPjwvbmF2Y29uLXRhYmxlPlxyXG4gICAgICAgIEE6IERpcmVjdGl2ZSBhcHBsaWVkIGFzIGFuIGF0dHJpYnV0ZSBvbiBleGlzdGluZyBlbGVtZW50LiA8ZGl2IG5hdmNvbi10YWJsZT48L2Rpdj5cclxuICAgICAgICBDOiBEaXJlY3RpdmUgYXBwbGllZCBhcyBhIGNzcyBjbGFzcyB0byBleGlzdGluZyBlbGVtZW50IDxkaXYgY2xhc3M9XCJuYXZjb24tdGFibGVcIj48L2Rpdj5cclxuICAgICAgICBNOiBEaXJlY3RpdmUgYXBwbGllZCBhcyBjb21tZW50LiovXHJcbiAgICAgICAgcmVzdHJpY3Q6ICdFJyxcclxuICAgICAgICBzY29wZToge1xyXG4gICAgICAgICAgICAvL0AgcmVhZHMgdGhlIGF0dHJpYnV0ZSB2YWx1ZSwgPSBwcm92aWRlcyB0d28td2F5IGJpbmRpbmcsICYgd29ya3Mgd2l0aCBmdW5jdGlvbnNcclxuICAgICAgICAgICAgdHlwZTogJ0AnLFxyXG4gICAgICAgICAgICBkYXRhOiAnPScsXHJcbiAgICAgICAgICAgIGlkOiAnQCcsXHJcbiAgICAgICAgICAgIGNoYXJ0OiAnQCdcclxuICAgICAgICB9LFxyXG4gICAgICAgIHRlbXBsYXRlOiAnPGRpdiBpZD1cInt7aWR9fVwiPjwvZGl2PicsXHJcbiAgICAgICAgbGluazogZnVuY3Rpb24gKHNjb3BlLCBlbCwgYXR0cnMpIHtcclxuICAgICAgICAgICAgc2NvcGUuJHdhdGNoKFwiZGF0YVwiLCBmdW5jdGlvbiAobmV3VmFsdWUsIG9sZFZhbHVlKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAobmV3VmFsdWUgIT0gdW5kZWZpbmVkICYmIG5ld1ZhbHVlICE9PSBcIlwiKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgc2NvcGUuaWQgPSBuZXdWYWx1ZS5pZDtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgc2NvcGUuJG9uKCdEQVNIQk9BUkQtUkVTSVpFJywgZnVuY3Rpb24gKGV2ZW50LCB3aWR0aCwgaGVpZ2h0LCBpZCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgY2hhcnQgPSBGdXNpb25DaGFydHMuaXRlbXNbZXZlbnQuY3VycmVudFNjb3BlLmNoYXJ0LmlkXTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGlkICE9PSB1bmRlZmluZWQgJiYgY2hhcnQgIT09IHVuZGVmaW5lZCAmJiBjaGFydC5vcHRpb25zLmRhdGFTb3VyY2UuaWQgPT09IGlkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjaGFydC5yZXNpemVUbyh3aWR0aCwgaGVpZ2h0KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICQoJC5maW5kKFwidHNwYW46Y29udGFpbnMoJ1hUIFRyaWFsJylcIikpLnJlbW92ZSgpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICBsb2FkRnVzaW9uKHNjb3BlLmRhdGEsIHNjb3BlLmlkLCBzY29wZS5kYXRhLnR5cGUsIHNjb3BlLCBlbCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAkKCQuZmluZChcInRzcGFuOmNvbnRhaW5zKCdYVCBUcmlhbCcpXCIpKS5yZW1vdmUoKTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxufV0pO1xyXG5cclxuZnVuY3Rpb24gbG9hZEZ1c2lvbihkYXRhc291cmNlLCBpZCwgdHlwZSwgc2NvcGUsIGVsKSB7XHJcbiAgICBGdXNpb25DaGFydHMucmVhZHkoZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIC8vdmFyIHdpZHRoID0gJChlbCkucGFyZW50KCkucGFyZW50KCkucGFyZW50KCkucGFyZW50KCkucGFyZW50KCkucGFyZW50KCkucGFyZW50KFwiLmdyaWRzdGVyLWl0ZW1cIikud2lkdGgoKTtcclxuICAgICAgICAvL3ZhciBoZWlnaHQgPSAkKGVsKS5wYXJlbnQoKS5wYXJlbnQoKS5wYXJlbnQoKS5wYXJlbnQoKS5wYXJlbnQoKS5wYXJlbnQoKS5wYXJlbnQoXCIuZ3JpZHN0ZXItaXRlbVwiKS5oZWlnaHQoKTtcclxuICAgICAgICB2YXIgd2lkdGggPSAkKGVsKS5wYXJlbnRzKFwiLmdyaWRzdGVyLWl0ZW1cIikud2lkdGgoKTtcclxuICAgICAgICB2YXIgaGVpZ2h0ID0gJChlbCkucGFyZW50cyhcIi5ncmlkc3Rlci1pdGVtXCIpLmhlaWdodCgpO1xyXG4gICAgICAgIHNjb3BlLmNoYXJ0ID0gbmV3IEZ1c2lvbkNoYXJ0cyh7XHJcbiAgICAgICAgICAgIHR5cGU6IHR5cGUsXHJcbiAgICAgICAgICAgIHJlbmRlckF0OiBpZCxcclxuICAgICAgICAgICAgd2lkdGg6IHdpZHRoLFxyXG4gICAgICAgICAgICBoZWlnaHQ6IChoZWlnaHQgLSA2MCksXHJcbiAgICAgICAgICAgIGRhdGFGb3JtYXQ6ICdqc29uJyxcclxuICAgICAgICAgICAgZGF0YVNvdXJjZTogZGF0YXNvdXJjZVxyXG4gICAgICAgIH0pLnJlbmRlcihmdW5jdGlvbiAoZXZ0KSB7XHJcbiAgICAgICAgICAgICQoJC5maW5kKFwidHNwYW46Y29udGFpbnMoJ1hUIFRyaWFsJylcIikpLnJlbW92ZSgpO1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICAvL0Z1c2lvbkNoYXJ0cy5hZGRFdmVudExpc3RlbmVyKCdEcmF3Q29tcGxldGUnLCBmdW5jdGlvbiAoZXZ0LCBhdCkge1xyXG4gICAgICAgIC8vICAgICQoJC5maW5kKFwidHNwYW46Y29udGFpbnMoJ1hUIFRyaWFsJylcIikpLnJlbW92ZSgpO1xyXG4gICAgICAgIC8vfSk7XHJcblxyXG4gICAgICAgIC8vRnVzaW9uQ2hhcnRzLmFkZEV2ZW50TGlzdGVuZXIoJ3JlbmRlckNvbXBsZXRlJywgZnVuY3Rpb24gKGV2dCwgYXQpIHtcclxuICAgICAgICAvLyAgICAkKCQuZmluZChcInRzcGFuOmNvbnRhaW5zKCdYVCBUcmlhbCcpXCIpKS5yZW1vdmUoKTtcclxuICAgICAgICAvLyAgICB2YXIgd2lkdGggPSAkKGV2dC5zZW5kZXIucmVmKS5wYXJlbnRzKFwiLmdyaWRzdGVyLWl0ZW1cIikud2lkdGgoKTtcclxuICAgICAgICAvLyAgICB2YXIgaGVpZ2h0ID0gJChldnQuc2VuZGVyLnJlZikucGFyZW50cyhcIi5ncmlkc3Rlci1pdGVtXCIpLmhlaWdodCgpO1xyXG4gICAgICAgIC8vICAgIGV2dC5zZW5kZXIucmVzaXplVG8od2lkdGgsIChoZWlnaHQgLSA2MCkpO1xyXG5cclxuICAgICAgICAvLyAgICAvLyQoZXZ0LnNlbmRlci5yZWYpLnBhcmVudHMoXCIuZ3JpZHN0ZXItaXRlbVwiKS53aWR0aChhdC53aWR0aCk7XHJcbiAgICAgICAgLy8gICAgLy8kKGV2dC5zZW5kZXIucmVmKS5wYXJlbnRzKFwiLmdyaWRzdGVyLWl0ZW1cIikuaGVpZ2h0KGF0LmhlaWdodCk7XHJcbiAgICAgICAgLy8gICAgLy9ldnQuc2VuZGVyLnJlc2l6ZVRvKGF0LndpZHRoLCAoYXQuaGVpZ2h0IC0gNDApKTtcclxuICAgICAgICAvL30pO1xyXG4gICAgfSk7XHJcbn07IiwiXCJ1c2Ugc3RyaWN0XCI7XHJcblxyXG5hbmd1bGFyLm1vZHVsZSgnYXBwJykuZGlyZWN0aXZlKCduYXZjb25GaWVsZCcsIFsnJHRpbWVvdXQnLCAnZGF0YXNlcnZpY2UnLCAnJGNvbXBpbGUnLCAnJGh0dHAnLCAnJHJvb3RTY29wZScsICduZ0F1dGhTZXR0aW5ncycsXHJcbmZ1bmN0aW9uICgkdGltZW91dCwgZGF0YXNlcnZpY2UsICRjb21waWxlLCAkaHR0cCwgJHJvb3RTY29wZSwgbmdBdXRoU2V0dGluZ3MpIHtcclxuICAgIHJldHVybiB7XHJcbiAgICAgICAgLypFOiBEaXJlY3RpdmUgZGVmaW5lZCBhcyBhbiBlbGVtZW50LiA8bmF2Y29uLWlucHV0PjwvbmF2Y29uLWlucHV0PlxyXG4gICAgICAgIEE6IERpcmVjdGl2ZSBhcHBsaWVkIGFzIGFuIGF0dHJpYnV0ZSBvbiBleGlzdGluZyBlbGVtZW50LiA8ZGl2IG5hdmNvbi1pbnB1dD48L2Rpdj5cclxuICAgICAgICBDOiBEaXJlY3RpdmUgYXBwbGllZCBhcyBhIGNzcyBjbGFzcyB0byBleGlzdGluZyBlbGVtZW50IDxkaXYgY2xhc3M9XCJuYXZjb24taW5wdXRcIj48L2Rpdj5cclxuICAgICAgICBNOiBEaXJlY3RpdmUgYXBwbGllZCBhcyBjb21tZW50LiovXHJcbiAgICAgICAgcmVzdHJpY3Q6ICdFJyxcclxuICAgICAgICByZXBsYWNlOiAndHJ1ZScsXHJcbiAgICAgICAgc2NvcGU6IHtcclxuICAgICAgICAgICAgLy9AIHJlYWRzIHRoZSBhdHRyaWJ1dGUgdmFsdWUsID0gcHJvdmlkZXMgdHdvLXdheSBiaW5kaW5nLCAmIHdvcmtzIHdpdGggZnVuY3Rpb25zXHJcbiAgICAgICAgICAgIC8vaXRlbXM6Jz1maWVsZERhdGEnLFxyXG4gICAgICAgICAgICBmaWVsZEtleTogJ0AnLFxyXG4gICAgICAgICAgICAvL25hdmNvbkRhdGE6ICc9JyxcclxuICAgICAgICAgICAgLy9maWVsZFR5cGU6J0AnLFxyXG4gICAgICAgICAgICAvL2ZpZWxkSW5kZXg6J0AnLFxyXG4gICAgICAgICAgICBzaG93TWVzc2FnZTogJ0AnLFxyXG4gICAgICAgICAgICBvbkNsaWNrOiAnQCcsXHJcbiAgICAgICAgICAgIG9uQmx1cjogJ0AnLFxyXG4gICAgICAgICAgICBvbkNoYW5nZTogJ0AnLFxyXG4gICAgICAgICAgICBpbnZhbGlkOiAnQCcsXHJcbiAgICAgICAgICAgIG9uS2V5UHJlc3M6ICdAJyxcclxuICAgICAgICAgICAgZmllbGRzOiAnPScsXHJcbiAgICAgICAgICAgIC8vZm9ybTogJ0AnLFxyXG4gICAgICAgICAgICBsYWJlbENsYXNzOiAnQCcsXHJcbiAgICAgICAgICAgIGZpZWxkQ2xhc3M6ICdAJyxcclxuICAgICAgICAgICAgZmllbGREYXRhOiAnPSdcclxuICAgICAgICB9LFxyXG4gICAgICAgIHJlcXVpcmU6IFsnXj9uYXZjb25Gb3JtJywgJ14/Zm9ybSddLFxyXG4gICAgICAgIGxpbms6IGZ1bmN0aW9uIChzY29wZSwgZWwsIGF0dHJzLCBjdHJsKSB7XHJcblxyXG4gICAgICAgICAgICBpZiAoY3RybFswXSAhPT0gbnVsbCkge1xyXG4gICAgICAgICAgICAgICAgaWYgKHNjb3BlLmZpZWxkRGF0YSAhPT0gdW5kZWZpbmVkKVxyXG4gICAgICAgICAgICAgICAgICAgIHNjb3BlLml0ZW1zID0gc2NvcGUuZmllbGREYXRhO1xyXG4gICAgICAgICAgICAgICAgZWxzZVxyXG4gICAgICAgICAgICAgICAgICAgIHNjb3BlLml0ZW1zID0gY3RybFswXS5nZXRGaWVsZEl0ZW1zKCk7XHJcbiAgICAgICAgICAgICAgICBzY29wZS5mb3JtID0gY3RybFsxXTtcclxuXHJcbiAgICAgICAgICAgICAgICBzY29wZS5uYXZjb25EYXRhID0gY3RybFswXS5nZXROYXZjb25EYXRhKCk7XHJcbiAgICAgICAgICAgICAgICBzY29wZS52YWxpZGF0ZSA9IGN0cmxbMF0uZ2V0VmFsaWRhdGUoKTtcclxuICAgICAgICAgICAgICAgIHNjb3BlLnJlYWRPbmx5ID0gY3RybFswXS5nZXRGb3JtUmVhZE9ubHkoKTtcclxuXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYgKHNjb3BlLml0ZW1zID09PSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgICAgICAgIGlmIChzY29wZS5maWVsZERhdGEgIT09IHVuZGVmaW5lZClcclxuICAgICAgICAgICAgICAgICAgICBzY29wZS5pdGVtcyA9IHNjb3BlLmZpZWxkRGF0YTtcclxuICAgICAgICAgICAgICAgIGVsc2VcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGlmIChzY29wZS52YWxpZGF0ZSA9PT0gdW5kZWZpbmVkKVxyXG4gICAgICAgICAgICAgICAgc2NvcGUudmFsaWRhdGUgPSB0cnVlO1xyXG5cclxuICAgICAgICAgICAgaWYgKHNjb3BlLnJlYWRPbmx5ID09PSB1bmRlZmluZWQpXHJcbiAgICAgICAgICAgICAgICBzY29wZS5yZWFkT25seSA9IGZhbHNlO1xyXG5cclxuICAgICAgICAgICAgaWYgKG5nQXV0aFNldHRpbmdzLmVuYWJsZUZpZWxkTGV2ZWxWYWxpZGF0aW9uICE9PSB1bmRlZmluZWQgJiYgIW5nQXV0aFNldHRpbmdzLmVuYWJsZUZpZWxkTGV2ZWxWYWxpZGF0aW9uKVxyXG4gICAgICAgICAgICAgICAgc2NvcGUuZW5hYmxlRmllbGRMZXZlbFZhbGlkYXRpb24gPSBmYWxzZTtcclxuICAgICAgICAgICAgZWxzZVxyXG4gICAgICAgICAgICAgICAgc2NvcGUuZW5hYmxlRmllbGRMZXZlbFZhbGlkYXRpb24gPSB0cnVlO1xyXG5cclxuXHJcbiAgICAgICAgICAgIHNjb3BlLmZpZWxkSW5kZXggPSBuYXZjb24uZ2V0SXRlbUluZGV4QnlQcm9wZXJ0eShzY29wZS5pdGVtcywgc2NvcGUuZmllbGRLZXkpO1xyXG4gICAgICAgICAgICBzY29wZS5maWVsZFR5cGUgPSBzY29wZS5pdGVtc1tzY29wZS5maWVsZEluZGV4XS50eXBlO1xyXG5cclxuICAgICAgICAgICAgdmFyIHRlbXBsYXRlRGF0YSA9ICQoJHJvb3RTY29wZS5maWVsZFRlbXBsYXRlKS5maW5kKFwic2NyaXB0W2lkID0nXCIgKyBzY29wZS5maWVsZFR5cGUgKyBcIiddXCIpLnRleHQoKTtcclxuICAgICAgICAgICAgZWwuaHRtbCh0ZW1wbGF0ZURhdGEpO1xyXG4gICAgICAgICAgICAkY29tcGlsZShlbC5jb250ZW50cygpKShzY29wZSk7XHJcbiAgICAgICAgICAgIGVsLmZpbmQoJ1tkYXRhLXRvZ2dsZT1cInRvb2x0aXBcIl0nKS50b29sdGlwKCk7XHJcbiAgICAgICAgICAgIHNjb3BlLnJlZGlyZWN0VVJMID0gZnVuY3Rpb24gKFVSTCkge1xyXG4gICAgICAgICAgICAgICAgaWYgKFVSTC5pbmRleE9mKCdodHRwJykgPT0gLTEpIHtcclxuICAgICAgICAgICAgICAgICAgICBVUkwgPSBcImh0dHA6Ly9cIiArIFVSTDtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIHdpbmRvdy5vcGVuKGVuY29kZVVSSShVUkwpLCAnX2JsYW5rJyk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgc2NvcGUub25DbGljayA9IGZ1bmN0aW9uIChrZXksIGUpIHtcclxuICAgICAgICAgICAgICAgIHNob3dNZXNzYWdnZVN0YXR1cyhzY29wZSwgJHRpbWVvdXQpO1xyXG5cclxuICAgICAgICAgICAgICAgIC8qaWYgKHNjb3BlLmZpZWxkVHlwZSA9PT0gXCJzZWxlY3RcIikge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChrZXkgIT09IHVuZGVmaW5lZCAmJiBzY29wZS5uYXZjb25EYXRhICE9PSB1bmRlZmluZWQgJiYgc2NvcGUubmF2Y29uRGF0YS5kcm9wZG93bmNoYW5nZSAhPT0gdW5kZWZpbmVkKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICBzY29wZS5uYXZjb25EYXRhLmRyb3Bkb3duY2hhbmdlKGtleSwgc2NvcGUsIHNjb3BlLml0ZW0uZGF0YSk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGlmIChzY29wZS5pdGVtLnNlbGVjdE9wdGlvbnMuaXRlbS5hZGROZXcgIT09IHVuZGVmaW5lZCAmJiBzY29wZS5pdGVtLnNlbGVjdE9wdGlvbnMuaXRlbS5hZGROZXcgPT09IFwieWVzXCIpIHtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vcmVtb3ZlIGxhc3QgdXNlciBpbnB1dFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBzY29wZS5pdGVtLnNlbGVjdE9wdGlvbnMuaXRlbXMgPSBzY29wZS5pdGVtLnNlbGVjdE9wdGlvbnMuaXRlbXMuZmlsdGVyKGZ1bmN0aW9uIChpdGVtKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoaXRlbVtcInVuZGVmaW5lZFwiXSAhPT0gdW5kZWZpbmVkICYmIGl0ZW1bXCJ1bmRlZmluZWRcIl0gPT09IFwiXCIpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSBpZihpdGVtWyhzY29wZS5pdGVtLnNlbGVjdE9wdGlvbnMuaXRlbS5kYXRhRmllbGQgfHwgXCJpZFwiKV0gPT09IC0xKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2VcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIH0gZWxzZSovIGlmIChzY29wZS5maWVsZFR5cGUgPT09IFwiYXV0b2NvbXBsZXRlXCIpIHtcclxuXHJcbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHNjb3BlLmZpZWxkVHlwZSA9PT0gXCJkYXRldGltZVwiKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgJChlLnRhcmdldCkucGFyZW50KCkuZGF0YSgnRGF0ZVRpbWVQaWNrZXInKS5zaG93KCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH07XHJcblxyXG5cclxuICAgICAgICAgICAgc2NvcGUuZHJvcGRvd25DbGljayA9IGZ1bmN0aW9uIChrZXksIGUpIHtcclxuICAgICAgICAgICAgICAgIHNob3dNZXNzYWdnZVN0YXR1cyhzY29wZSwgJHRpbWVvdXQpO1xyXG4gICAgICAgICAgICAgICAgaWYgKHNjb3BlLmZpZWxkVHlwZSA9PT0gXCJzZWxlY3RcIikge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChrZXkgIT09IHVuZGVmaW5lZCAmJiBzY29wZS5uYXZjb25EYXRhICE9PSB1bmRlZmluZWQgJiYgc2NvcGUubmF2Y29uRGF0YS5kcm9wZG93bmNoYW5nZSAhPT0gdW5kZWZpbmVkKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICBzY29wZS5uYXZjb25EYXRhLmRyb3Bkb3duY2hhbmdlKGtleSwgc2NvcGUsIHNjb3BlLml0ZW0uZGF0YSk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGlmIChzY29wZS5pdGVtLnNlbGVjdE9wdGlvbnMuaXRlbS5hZGROZXcgIT09IHVuZGVmaW5lZCAmJiBzY29wZS5pdGVtLnNlbGVjdE9wdGlvbnMuaXRlbS5hZGROZXcgPT09IFwieWVzXCIpIHtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vcmVtb3ZlIGxhc3QgdXNlciBpbnB1dFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBzY29wZS5pdGVtLnNlbGVjdE9wdGlvbnMuaXRlbXMgPSBzY29wZS5pdGVtLnNlbGVjdE9wdGlvbnMuaXRlbXMuZmlsdGVyKGZ1bmN0aW9uIChpdG0pIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChpdG1bXCJ1bmRlZmluZWRcIl0gIT09IHVuZGVmaW5lZCAmJiBpdG1bXCJ1bmRlZmluZWRcIl0gPT09IFwiXCIgJiYgc2NvcGUuaXRlbS5kYXRhICE9PSB1bmRlZmluZWQgJiYgc2NvcGUuaXRlbS5kYXRhWyhzY29wZS5pdGVtLnNlbGVjdE9wdGlvbnMuaXRlbS5kYXRhRmllbGQgfHwgXCJpZFwiKV0gIT09IGl0bVsoc2NvcGUuaXRlbS5zZWxlY3RPcHRpb25zLml0ZW0uZGF0YUZpZWxkIHx8IFwiaWRcIildKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKGl0bVsoc2NvcGUuaXRlbS5zZWxlY3RPcHRpb25zLml0ZW0uZGF0YUZpZWxkIHx8IFwiaWRcIildID09PSAtMSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIHNjb3BlLmNvbG9ycGlja2VyQmVmb3JlU2hvdyA9IGZ1bmN0aW9uICgpIHtcclxuXHJcbiAgICAgICAgICAgICAgICBjb2xvcnBpY2tlckV2ZW50Q2hhbmdlKCk7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIHNjb3BlLmNvbG9ycGlja2VyTW92ZSA9IGZ1bmN0aW9uICgpIHtcclxuXHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIHNjb3BlLmNvbG9ycGlja2VyU2hvdyA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgICQoJ2FbY2xhc3M9XCJzcC1jYW5jZWxcIl0nKS5yZXBsYWNlV2l0aCgnPGJ1dHRvbiB0eXBlPVwiYnV0dG9uXCIgb25jbGljaz1cIm5hdmNvbi5jb2xvcnBpY2tlckhpZGUoKTtcIj5DYW5jZWw8L2J1dHRvbj4nKTtcclxuXHJcbiAgICAgICAgICAgICAgICAkKCcuc3AtcGFsZXR0ZS10b2dnbGUnKS5vbihcImNsaWNrXCIsIGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgICAgICBjb2xvcnBpY2tlckV2ZW50Q2hhbmdlKCk7XHJcbiAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAgICAgY29sb3JwaWNrZXJFdmVudENoYW5nZSgpO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBzY29wZS5vbkNoYW5nZSA9IGZ1bmN0aW9uIChrZXksIGUpIHtcclxuICAgICAgICAgICAgICAgIHNjb3BlLml0ZW0uc2VsZWN0T3B0aW9ucy5pdGVtW1wiaXNTZWxlY3RcIl0gPSB0cnVlO1xyXG4gICAgICAgICAgICB9O1xyXG5cclxuICAgICAgICAgICAgdmFyIHJlcGxhY2VTcGVjaWFsQ2hhcmFjdGVyID0gZnVuY3Rpb24gKGl0ZW0pIHtcclxuICAgICAgICAgICAgICAgIGlmIChpdGVtICE9PSB1bmRlZmluZWQgJiYgdHlwZW9mIGl0ZW0gPT09IFwic3RyaW5nXCIgJiYgaXRlbSAhPT0gXCJcIikge1xyXG4gICAgICAgICAgICAgICAgICAgIHNjb3BlLml0ZW0uZGF0YSA9IGl0ZW0ucmVwbGFjZSgvXFx1MjAxM3xcXHUyMDE0L2csIFwiLVwiKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgc2NvcGUubGFiZWxEYXRhQ2xpY2sgPSBmdW5jdGlvbiAoaXRlbSkge1xyXG4gICAgICAgICAgICAgICAgaWYgKCFpdGVtLnRlbXBsYXRlT3B0aW9ucy5ocmVmKSByZXR1cm47XHJcbiAgICAgICAgICAgICAgICBpZiAoc2NvcGUubmF2Y29uRGF0YSAhPT0gdW5kZWZpbmVkICYmIHNjb3BlLm5hdmNvbkRhdGEubGFiZWxEYXRhQ2xpY2sgIT09IHVuZGVmaW5lZCAmJiAkLmlzRnVuY3Rpb24oc2NvcGUubmF2Y29uRGF0YS5sYWJlbERhdGFDbGljaykpXHJcbiAgICAgICAgICAgICAgICAgICAgc2NvcGUubmF2Y29uRGF0YS5sYWJlbERhdGFDbGljayhpdGVtKTtcclxuXHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIHNjb3BlLm9uUGFzdGUgPSBmdW5jdGlvbiAoZXZlbnQpIHtcclxuICAgICAgICAgICAgICAgICR0aW1lb3V0KGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgaXRlbSA9IGFuZ3VsYXIuZWxlbWVudChldmVudC5jdXJyZW50VGFyZ2V0KS52YWwoKTtcclxuICAgICAgICAgICAgICAgICAgICByZXBsYWNlU3BlY2lhbENoYXJhY3RlcihpdGVtKTtcclxuICAgICAgICAgICAgICAgIH0sIDEwMClcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgc2NvcGUudGFiQ2xpY2sgPSBmdW5jdGlvbiAoc2NvcGUsIHNlbGVjdEl0ZW0pIHtcclxuICAgICAgICAgICAgICAgIHNob3dNZXNzYWdnZVN0YXR1cyhzY29wZSwgJHRpbWVvdXQpO1xyXG4gICAgICAgICAgICAgICAgc2NvcGUuZGF0YSA9IHNlbGVjdEl0ZW1bc2NvcGUuc2VsZWN0T3B0aW9ucy5pdGVtLmRhdGFGaWVsZF07XHJcbiAgICAgICAgICAgIH07XHJcblxyXG4gICAgICAgICAgICBzY29wZS5vbkJsdXIgPSBmdW5jdGlvbiAoZXZ0KSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoKGV2dCAhPT0gdW5kZWZpbmVkICYmIGV2dC5yZWxhdGVkVGFyZ2V0ICE9PSBudWxsICYmIGV2dC5yZWxhdGVkVGFyZ2V0ICE9PSB1bmRlZmluZWQgJiYgJChldnQucmVsYXRlZFRhcmdldCkucHJvcChcInRhZ05hbWVcIikudG9Mb3dlckNhc2UoKSA9PT0gXCJidXR0b25cIikgJiYgKCQoZXZ0LnJlbGF0ZWRUYXJnZXQpLnRleHQoKS50b0xvd2VyQ2FzZSgpID09PSBcImNhbmNlbFwiIHx8ICQoZXZ0LnJlbGF0ZWRUYXJnZXQpLnRleHQoKS50b0xvd2VyQ2FzZSgpID09PSBcInNhdmVcIiB8fCAkKGV2dC5yZWxhdGVkVGFyZ2V0KS50ZXh0KCkudG9Mb3dlckNhc2UoKSA9PT0gXCJva1wiKSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGV2dC5wcmV2ZW50RGVmYXVsdCgpO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmICgkKGV2dC5yZWxhdGVkVGFyZ2V0KS50ZXh0KCkudG9Mb3dlckNhc2UoKSA9PT0gXCJzYXZlXCIpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHNjb3BlLml0ZW0uc2V0Rm9jdXMgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIHNob3dNZXNzYWdnZVN0YXR1cyhzY29wZSwgJHRpbWVvdXQpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgaWYgKHNjb3BlLml0ZW0uc2V0Rm9jdXNCbHVyID09PSB1bmRlZmluZWQgfHwgc2NvcGUuaXRlbS5zZXRGb2N1c0JsdXIgPT09IGZhbHNlKVxyXG4gICAgICAgICAgICAgICAgICAgIHNjb3BlLml0ZW0uc2V0Rm9jdXMgPSBmYWxzZTtcclxuICAgICAgICAgICAgfTtcclxuXHJcbiAgICAgICAgICAgIHNjb3BlLmNoZWNrYm94bGlzdEZpbHRlciA9IGZ1bmN0aW9uIChpdGVtKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoc2NvcGUuaXRlbS5ncm91cCAhPT0gdW5kZWZpbmVkICYmIHNjb3BlLml0ZW0uZ3JvdXAubGVuZ3RoID4gMCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSAwLCBsZW4gPSBzY29wZS5pdGVtLmdyb3VwLmxlbmd0aDsgaSA8IGxlbjsgaSsrKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBkYXRhID0gc2NvcGUuaXRlbS5ncm91cFtpXTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHBhcnNlSW50KGl0ZW0uRXZlbnRTZWN0aW9uKSA9PT0gcGFyc2VJbnQoZGF0YSkpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChzY29wZS5yZWFkT25seSAmJiBpdGVtLlBhcmVudElEICE9PSAwKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGl0ZW0udmFsdWUgIT09IHVuZGVmaW5lZCAmJiBpdGVtLnZhbHVlKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG5cclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHNjb3BlLnJlYWRPbmx5KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChpdGVtLnZhbHVlICE9PSB1bmRlZmluZWQgJiYgaXRlbS52YWx1ZSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBlbHNlXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9O1xyXG5cclxuICAgICAgICAgICAgc2NvcGUucmFkaW9DbGljayA9IGZ1bmN0aW9uIChldmVudCwgc2VsZWN0ZWRJdGVtKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoc2NvcGUubmF2Y29uRGF0YSAhPT0gdW5kZWZpbmVkICYmIHNjb3BlLm5hdmNvbkRhdGEucmFkaW9DbGljayAhPT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgc2NvcGUubmF2Y29uRGF0YS5yYWRpb0NsaWNrKGV2ZW50LCBzZWxlY3RlZEl0ZW0pO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9O1xyXG5cclxuICAgICAgICAgICAgc2NvcGUuZHJvcGRvd25TZWxlY3QgPSBmdW5jdGlvbiAoaXRlbSwgbW9kZWwpIHtcclxuICAgICAgICAgICAgICAgIGlmIChzY29wZS5pdGVtLnNlbGVjdE9wdGlvbnMuaXRlbS5hZGROZXcgIT09IHVuZGVmaW5lZCAmJiBzY29wZS5pdGVtLnNlbGVjdE9wdGlvbnMuaXRlbS5hZGROZXcgPT09IFwieWVzXCIpIHtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgLy9yZW1vdmUgbGFzdCB1c2VyIGlucHV0XHJcbiAgICAgICAgICAgICAgICAgICAgc2NvcGUuaXRlbS5zZWxlY3RPcHRpb25zLml0ZW1zID0gc2NvcGUuaXRlbS5zZWxlY3RPcHRpb25zLml0ZW1zLmZpbHRlcihmdW5jdGlvbiAoaXRtKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChpdG1bXCJ1bmRlZmluZWRcIl0gIT09IHVuZGVmaW5lZCAmJiBpdG1bXCJ1bmRlZmluZWRcIl0gPT09IFwiXCIgJiYgaXRlbVsoc2NvcGUuaXRlbS5zZWxlY3RPcHRpb25zLml0ZW0uZGF0YUZpZWxkIHx8IFwiaWRcIildICE9PSBpdG1bKHNjb3BlLml0ZW0uc2VsZWN0T3B0aW9ucy5pdGVtLmRhdGFGaWVsZCB8fCBcImlkXCIpXSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgZWxzZVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIHZhciBmb3VuZCA9IG5hdmNvbi5nZXRJdGVtQnlLZXlWYWx1ZShzY29wZS5pdGVtLnNlbGVjdE9wdGlvbnMuaXRlbXMsIChzY29wZS5pdGVtLnNlbGVjdE9wdGlvbnMuaXRlbS5kYXRhRmllbGQgfHwgXCJpZFwiKSwgaXRlbVtzY29wZS5pdGVtLnNlbGVjdE9wdGlvbnMuaXRlbS5kYXRhRmllbGQgfHwgaWRdKTtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoZm91bmQgIT09IC0xKSByZXR1cm47XHJcbiAgICAgICAgICAgICAgICAgICAgaXRlbVtzY29wZS5pdGVtLnNlbGVjdE9wdGlvbnMuaXRlbS5kYXRhRmllbGQgfHwgaWRdID0gaXRlbVtzY29wZS5pdGVtLnNlbGVjdE9wdGlvbnMuaXRlbS5kaXNwbGF5RmllbGRdO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICBpZiAoc2NvcGUubmF2Y29uRGF0YSAhPT0gdW5kZWZpbmVkICYmIHNjb3BlLm5hdmNvbkRhdGEuYWRkVmFsdWVUb1NlbGVjdCAhPT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHNjb3BlLm5hdmNvbkRhdGEuYWRkVmFsdWVUb1NlbGVjdChpdGVtLCBzY29wZS5maWVsZEtleSwgZnVuY3Rpb24gKHJldEl0ZW0pIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNjb3BlLiRhcHBseShmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2NvcGUuaXRlbS5zZWxlY3RPcHRpb25zLml0ZW1zID0gW3JldEl0ZW1dLmNvbmNhdChzY29wZS5pdGVtLnNlbGVjdE9wdGlvbnMuaXRlbXMpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgfTtcclxuXHJcbiAgICAgICAgICAgIHNjb3BlLnNlbGVjdFJlZnJlc2hSZXN1bHRzID0gZnVuY3Rpb24gKCRzZWxlY3QsIGl0ZW1MaXN0KSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoJHNlbGVjdC5zZWFyY2ggPT09IHVuZGVmaW5lZCB8fCAkc2VsZWN0LnNlYXJjaCA9PT0gXCJcIiB8fCAkc2VsZWN0LnNlYXJjaCA9PT0gbnVsbCkgcmV0dXJuO1xyXG4gICAgICAgICAgICAgICAgaWYgKCRzZWxlY3QuaXRlbXMubGVuZ3RoICE9PSAwKSByZXR1cm47XHJcbiAgICAgICAgICAgICAgICBpZiAoc2NvcGUuaXRlbS5zZWxlY3RPcHRpb25zLml0ZW0uYWRkTmV3ID09PSB1bmRlZmluZWQgfHwgc2NvcGUuaXRlbS5zZWxlY3RPcHRpb25zLml0ZW0uYWRkTmV3ICE9PSBcInllc1wiKSByZXR1cm47XHJcbiAgICAgICAgICAgICAgICB2YXIgc2VhcmNoID0gJHNlbGVjdC5zZWFyY2gsXHJcbiAgICAgICAgICAgICAgICAgIGxpc3QgPSBhbmd1bGFyLmNvcHkoJHNlbGVjdC5pdGVtcyksXHJcbiAgICAgICAgICAgICAgICAgIEZMQUcgPSAtMTtcclxuXHJcbiAgICAgICAgICAgICAgICAvL3JlbW92ZSBsYXN0IHVzZXIgaW5wdXRcclxuICAgICAgICAgICAgICAgIGxpc3QgPSBsaXN0LmZpbHRlcihmdW5jdGlvbiAoaXRlbSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBpdGVtWyhzY29wZS5pdGVtLnNlbGVjdE9wdGlvbnMuaXRlbS5kYXRhRmllbGQgfHwgXCJpZFwiKV0gIT09IEZMQUc7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgICAgICBpZiAoIXNlYXJjaCkge1xyXG4gICAgICAgICAgICAgICAgICAgIC8vdXNlIHRoZSBwcmVkZWZpbmVkIGxpc3RcclxuICAgICAgICAgICAgICAgICAgICAkc2VsZWN0Lml0ZW1zID0gbGlzdDtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIC8vbWFudWFsbHkgYWRkIHVzZXIgaW5wdXQgYW5kIHNldCBzZWxlY3Rpb25cclxuICAgICAgICAgICAgICAgICAgICB2YXIgdXNlcklucHV0SXRlbSA9IHt9O1xyXG4gICAgICAgICAgICAgICAgICAgIHVzZXJJbnB1dEl0ZW1bKHNjb3BlLml0ZW0uc2VsZWN0T3B0aW9ucy5pdGVtLmRhdGFGaWVsZCB8fCBcImlkXCIpXSA9IEZMQUc7XHJcbiAgICAgICAgICAgICAgICAgICAgdXNlcklucHV0SXRlbVsoc2NvcGUuaXRlbS5zZWxlY3RPcHRpb25zLml0ZW0uZGlzcGxheUZpZWxkIHx8IFwiaWRcIildID0gc2VhcmNoO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICBpZiAoJHNlbGVjdC5pc0dyb3VwZWQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdXNlcklucHV0SXRlbVtzY29wZS5pdGVtLnNlbGVjdE9wdGlvbnMuaXRlbS5ncm91cEJ5XSA9IFwiXCI7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICAgICAkc2VsZWN0Lml0ZW1zID0gW3VzZXJJbnB1dEl0ZW1dLmNvbmNhdChsaXN0KTtcclxuICAgICAgICAgICAgICAgICAgICAvLyRzZWxlY3Quc2VsZWN0ZWQgPSB1c2VySW5wdXRJdGVtO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICBzY29wZS4kYXBwbHkoZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBzY29wZS5pdGVtLnNlbGVjdE9wdGlvbnMuaXRlbXMgPSBbdXNlcklucHV0SXRlbV0uY29uY2F0KHNjb3BlLml0ZW0uc2VsZWN0T3B0aW9ucy5pdGVtcyk7XHJcbiAgICAgICAgICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9O1xyXG5cclxuICAgICAgICAgICAgc2NvcGUuJHdhdGNoKFwiaXRlbXNbXCIgKyBzY29wZS5maWVsZEluZGV4ICsgXCJdXCIsIGZ1bmN0aW9uIChuZXdWYWx1ZSwgb2xkVmFsdWUpIHtcclxuICAgICAgICAgICAgICAgIGlmIChuZXdWYWx1ZSAhPT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgc2NvcGUuaXRlbSA9IG5ld1ZhbHVlO1xyXG4gICAgICAgICAgICAgICAgICAgIHNjb3BlLml0ZW0uZm9ybSA9IHNjb3BlLmZvcm07XHJcbiAgICAgICAgICAgICAgICAgICAgc2NvcGUuaXRlbS5zaG93TWVzc2FnZSA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgICAgIHNjb3BlLml0ZW0uc2V0Rm9jdXMgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgICAgICBmaWVsZFNldHRpbmdzKHNjb3BlLCBlbCwgYXR0cnMsICRjb21waWxlKTtcclxuICAgICAgICAgICAgICAgICAgICBzY29wZS4kd2F0Y2goJ2Zvcm0uJyArIHNjb3BlLml0ZW0ua2V5ICsgJy4kdmFsaWQnLCBmdW5jdGlvbiAobmV3VmFsdWUsIG9sZFZhbHVlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChuZXdWYWx1ZSAhPT0gdW5kZWZpbmVkICYmIG5ld1ZhbHVlICE9PSBvbGRWYWx1ZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc2NvcGUuaXRlbS5zZXRGb2N1cyA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKG5ld1ZhbHVlID09PSBmYWxzZSAmJiBzY29wZS52YWxpZGF0ZSAmJiBzY29wZS5lbmFibGVGaWVsZExldmVsVmFsaWRhdGlvbikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNjb3BlLmludmFsaWQgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNjb3BlLml0ZW0udmFsaWQgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzaG93TWVzc2FnZ2VTdGF0dXMoc2NvcGUsICR0aW1lb3V0KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2NvcGUuaW52YWxpZCA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNjb3BlLml0ZW0udmFsaWQgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgc2NvcGUuJG9uKCdGT1JNLVJFQURPTkxZJywgZnVuY3Rpb24gKGV2ZW50LCBkYXRhKSB7XHJcbiAgICAgICAgICAgICAgICBzY29wZS5yZWFkT25seSA9IGRhdGE7XHJcbiAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgc2NvcGUuJHdhdGNoKFwiaXRlbXNbXCIgKyBzY29wZS5maWVsZEluZGV4ICsgXCJdLnJlYWRvbmx5XCIsIGZ1bmN0aW9uIChuZXdWYWx1ZSwgb2xkVmFsdWUpIHtcclxuICAgICAgICAgICAgICAgIGlmIChuZXdWYWx1ZSAhPT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgc2NvcGUucmVhZE9ubHkgPSBuZXdWYWx1ZTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSk7XHJcblxyXG5cclxuICAgICAgICAgICAgc2NvcGUuJHdhdGNoKFwiaXRlbXNbXCIgKyBzY29wZS5maWVsZEluZGV4ICsgXCJdLmRhdGFcIiwgZnVuY3Rpb24gKG5ld1ZhbHVlLCBvbGRWYWx1ZSkge1xyXG4gICAgICAgICAgICAgICAgLy8gIGlmIChuZXdWYWx1ZSAhPT0gdW5kZWZpbmVkICYmIG5ld1ZhbHVlICE9PSBvbGRWYWx1ZSkge1xyXG4gICAgICAgICAgICAgICAgaWYgKG5ld1ZhbHVlICE9PSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgICAgICAgICAgICBzY29wZS5pdGVtLnNob3dNZXNzYWdlID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHNjb3BlLnJlYWRPbmx5KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHNjb3BlLml0ZW0ucmVhZE9ubHlUZXh0ID0gc2NvcGUuZGlzcGxheVJlYWRPbmx5RmllbGQoc2NvcGUuaXRlbSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9LCB0aGlzKTtcclxuXHJcbiAgICAgICAgICAgIHNjb3BlLiRvbignRklFTEQtVkFMSUQnLCBmdW5jdGlvbiAoZXZlbnQsIHZhbHVlLCBrZXlJbmRleCkge1xyXG4gICAgICAgICAgICAgICAgaWYgKHNjb3BlLml0ZW1zLmxlbmd0aCA+PSBrZXlJbmRleCAmJiBzY29wZS5pdGVtc1trZXlJbmRleF0gIT09IHVuZGVmaW5lZCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmICh2YWx1ZSA9PT0gdHJ1ZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBzY29wZS5pdGVtc1trZXlJbmRleF0udmFsaWQgPSB0cnVlO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBzY29wZS5pdGVtc1trZXlJbmRleF0udmFsaWQgPSBmYWxzZTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KTtcclxuXHJcblxyXG4gICAgICAgICAgICBzY29wZS50YWJNb3VzZU92ZXIgPSBmdW5jdGlvbiAoZWwsIHNjb3BlLCBpdGVtKSB7XHJcbiAgICAgICAgICAgICAgICAkKGVsLnNyY0VsZW1lbnQpLmNzcygnY3Vyc29yJywgc2NvcGUudGVtcGxhdGVPcHRpb25zLmN1cnNvcik7XHJcbiAgICAgICAgICAgIH07XHJcblxyXG4gICAgICAgICAgICBzY29wZS5jb2xvcnBpY2tlck9wdGlvbnMgPSBnZXRDb2xvcnBpY2tlck9wdGlvbnMoKTtcclxuXHJcbiAgICAgICAgICAgIHNjb3BlLmRpc3BsYXlSZWFkT25seUZpZWxkID0gZnVuY3Rpb24gKGl0ZW0pIHtcclxuICAgICAgICAgICAgICAgIHZhciByZXR1cm5WYWx1ZSA9IGl0ZW0uZGF0YSAhPSBudWxsID8gaXRlbS5kYXRhIDogXCJcIjtcclxuICAgICAgICAgICAgICAgIGlmIChpdGVtLnR5cGUgPT09IFwic2VsZWN0XCIpIHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm5WYWx1ZSA9IGl0ZW0uZGF0YVtpdGVtLnNlbGVjdE9wdGlvbnMuaXRlbS5kaXNwbGF5RmllbGRdO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmIChpdGVtLnR5cGUgPT09IFwibXVsdGlzZWxlY3RcIiB8fCBpdGVtLnR5cGUgPT09IFwibXVsdGlzZWxlY3RjaGVja2JveFwiKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIGxpc3QgPSBbXTtcclxuICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBpID0gMCwgbGVuID0gaXRlbS5kYXRhLmxlbmd0aDsgaSA8IGxlbjsgaSsrKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBvYmogPSBpdGVtLmRhdGFbaV07XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChpdGVtLnNlbGVjdE9wdGlvbnMuaXRlbS5zZWNvbmREaXNwbGF5RmllbGQgIT09IHVuZGVmaW5lZCAmJiBpdGVtLnNlbGVjdE9wdGlvbnMuaXRlbS5zZWNvbmREaXNwbGF5RmllbGQgIT09IG51bGwgJiYgaXRlbS5zZWxlY3RPcHRpb25zLml0ZW0uc2Vjb25kRGlzcGxheUZpZWxkICE9PSBcIlwiKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbGlzdC5wdXNoKG9ialtpdGVtLnNlbGVjdE9wdGlvbnMuaXRlbS5kaXNwbGF5RmllbGRdICsgXCIgLyBcIiArIG9ialtpdGVtLnNlbGVjdE9wdGlvbnMuaXRlbS5zZWNvbmREaXNwbGF5RmllbGRdKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICBlbHNlXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsaXN0LnB1c2gob2JqW2l0ZW0uc2VsZWN0T3B0aW9ucy5pdGVtLmRpc3BsYXlGaWVsZF0pXHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIHJldHVyblZhbHVlID0gbGlzdC5qb2luKFwiOyBcIik7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGl0ZW0udHlwZSA9PT0gXCJjaGVja2JveFwiKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGl0ZW0uZGF0YSB8fCBpdGVtLmRhdGEgPT09IDEgfHwgaXRlbS5kYXRhID09PSBcInRydWVcIilcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuVmFsdWUgPSBpdGVtLnRlbXBsYXRlT3B0aW9ucy5zdWZmaXhMYWJlbDtcclxuICAgICAgICAgICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGl0ZW0udGVtcGxhdGVPcHRpb25zLnN1ZmZpeExhYmVsZmFsc2UgIT09IHVuZGVmaW5lZClcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVyblZhbHVlID0gaXRlbS50ZW1wbGF0ZU9wdGlvbnMuc3VmZml4TGFiZWxmYWxzZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgZWxzZVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuVmFsdWUgPSBcIk5vXCI7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmIChpdGVtLnR5cGUgPT09IFwicmFkaW9cIikge1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBpdGVtcyA9IGl0ZW0udGVtcGxhdGVPcHRpb25zLml0ZW1zO1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBmaW5kT2JqID0gbmF2Y29uLmdldEl0ZW1CeUtleVZhbHVlKGl0ZW1zLCBcInZhbHVlXCIsIGl0ZW0uZGF0YSk7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGZpbmRPYmogIT09IC0xKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChpdGVtLnRlbXBsYXRlT3B0aW9ucy5zdWZmaXhMYWJlbGZhbHNlICE9PSB1bmRlZmluZWQpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm5WYWx1ZSA9IGZpbmRPYmouc3VmZml4TGFiZWw7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2VcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVyblZhbHVlID0gZmluZE9iai5sYWJlbDtcclxuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoaXRlbS50ZW1wbGF0ZU9wdGlvbnMuc3VmZml4TGFiZWxmYWxzZSAhPT0gdW5kZWZpbmVkKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuVmFsdWUgPSBpdGVtc1swXS5zdWZmaXhMYWJlbDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgZWxzZVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuVmFsdWUgPSBpdGVtLmRhdGE7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuVmFsdWUgPSBpdGVtLmRhdGE7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gcmV0dXJuVmFsdWUgIT0gdW5kZWZpbmVkID8gKHJldHVyblZhbHVlICE9IG51bGwgPyByZXR1cm5WYWx1ZSA6IFwiXCIpIDogXCJcIjtcclxuICAgICAgICAgICAgfTtcclxuXHJcbiAgICAgICAgICAgIGZ1bmN0aW9uIGNvbG9ycGlja2VyRXZlbnRDaGFuZ2UoKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoJCgnLnNwLXBhbGV0dGUtdG9nZ2xlJykuaHRtbCgpICE9PSB1bmRlZmluZWQgJiYgJCgnLnNwLXBhbGV0dGUtdG9nZ2xlJykuaHRtbCgpLnRvTG93ZXJDYXNlKCkgIT09IFwiXCIpIHtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKCEkKCcuc3AtcGlja2VyLWNvbnRhaW5lcicpLmlzKFwiOnZpc2libGVcIikpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICQoJy5zcC1wYWxldHRlLXRvZ2dsZScpLmh0bWwoXCJNb3JlXCIpXHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGlmICgkKCcuc3AtcGlja2VyLWNvbnRhaW5lcicpLmlzKFwiOnZpc2libGVcIikpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICQoJy5zcC1wYWxldHRlLXRvZ2dsZScpLmh0bWwoXCJMZXNzXCIpXHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgaWYgKCQoJy5zcC1jaG9vc2UnKS5odG1sKCkgIT09IHVuZGVmaW5lZCAmJiAkKCcuc3AtY2hvb3NlJykuaHRtbCgpLnRvTG93ZXJDYXNlKCkgIT09IFwiXCIpXHJcbiAgICAgICAgICAgICAgICAgICAgJCgnLnNwLWNob29zZScpLmh0bWwoXCJDaG9vc2VcIilcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgZnVuY3Rpb24gZmllbGRTZXR0aW5ncyhzY29wZSwgZWwsIGF0dHJzLCAkY29tcGlsZSkge1xyXG5cclxuICAgICAgICAgICAgICAgIGlmIChzY29wZS5pdGVtLnR5cGUgPT09IFwiaW5wdXRcIikge1xyXG4gICAgICAgICAgICAgICAgICAgIGlucHV0U2V0dGluZyhzY29wZSwgZWwsIGF0dHJzKTtcclxuICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoc2NvcGUuaXRlbS50eXBlID09PSBcImRhdGVcIikge1xyXG4gICAgICAgICAgICAgICAgICAgIGRhdGVTZXR0aW5nKHNjb3BlLCBlbCwgYXR0cnMpO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmIChzY29wZS5pdGVtLnR5cGUgPT09IFwiY29sb3JwaWNrZXJcIikge1xyXG4gICAgICAgICAgICAgICAgICAgIC8vY29sb3JwaWNrZXJTZXR0aW5nKHNjb3BlLCBlbCwgYXR0cnMpO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmIChzY29wZS5pdGVtLnR5cGUgPT09IFwiZGF0ZXRpbWVcIikge1xyXG4gICAgICAgICAgICAgICAgICAgIGRhdGVUaW1lU2V0dGluZyhzY29wZSwgZWwsIGF0dHJzKTtcclxuICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoc2NvcGUuaXRlbS50eXBlID09PSBcInRhYmxlZWRpdG9yXCIpIHtcclxuICAgICAgICAgICAgICAgICAgICB0YWJsZWVkaXRvclNldHRpbmcoc2NvcGUsIGVsLCBhdHRycyk7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHNjb3BlLml0ZW0udHlwZSA9PT0gXCJzZWxlY3RcIikge1xyXG4gICAgICAgICAgICAgICAgICAgIHNlbGVjdFNldHRpbmcoc2NvcGUsIGVsLCBhdHRycyk7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHNjb3BlLml0ZW0udHlwZSA9PT0gXCJtdWx0aXNlbGVjdFwiIHx8IHNjb3BlLml0ZW0udHlwZSA9PT0gXCJtdWx0aXNlbGVjdGNoZWNrYm94XCIpIHtcclxuICAgICAgICAgICAgICAgICAgICBtdWx0aVNlbGVjdFNldHRpbmcoc2NvcGUsIGVsLCBhdHRycyk7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHNjb3BlLml0ZW0udHlwZSA9PT0gXCJ0YWJcIikge1xyXG4gICAgICAgICAgICAgICAgICAgIHRhYlNldHRpbmcoc2NvcGUsIGVsLCBhdHRycyk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBlbHNlIGlmIChzY29wZS5pdGVtLnR5cGUgPT09IFwic3dpdGNoXCIpIHtcclxuICAgICAgICAgICAgICAgICAgICBzd2l0Y2hTZXR0aW5nKHNjb3BlLCBlbCwgYXR0cnMpO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmIChzY29wZS5pdGVtLnR5cGUgPT09IFwiYXV0b2NvbXBsZXRlXCIpIHtcclxuICAgICAgICAgICAgICAgICAgICBhdXRvQ29tcGxldGVTZXR0aW5nKHNjb3BlLCBlbCwgYXR0cnMpO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmIChzY29wZS5pdGVtLnR5cGUgPT09IFwicmF0aW5nXCIpIHtcclxuICAgICAgICAgICAgICAgICAgICByYXRpbmdTZXR0aW5nKHNjb3BlLCBlbCwgYXR0cnMpO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmIChzY29wZS5pdGVtLnR5cGUgPT09IFwibGFiZWxkYXRhXCIpIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoc2NvcGUuaXRlbS50ZW1wbGF0ZU9wdGlvbnMuaHJlZiA9PT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHNjb3BlLml0ZW0udGVtcGxhdGVPcHRpb25zLmhyZWYgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHNjb3BlLml0ZW0udGVtcGxhdGVPcHRpb25zLmhyZWYpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIG9iaiA9ICQoZWwpLmZpbmQoJy5maWVsZC1ncm91cCBsYWJlbCcpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBvYmouY3NzKFwiY29sb3JcIiwgXCJibHVlXCIpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBvYmouY3NzKFwiY3Vyc29yXCIsIFwicG9pbnRlclwiKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHNjb3BlLml0ZW0udHlwZSA9PT0gXCJmaWxldXBsb2FkXCIgfHwgc2NvcGUuaXRlbS50eXBlID09PSBcInBob3RvdXBsb2FkXCIpIHtcclxuICAgICAgICAgICAgICAgICAgICB2YXIga2V5SW5kZXggPSBuYXZjb24uZ2V0SXRlbUluZGV4QnlQcm9wZXJ0eShzY29wZS5pdGVtcywgc2NvcGUuaXRlbS50ZW1wbGF0ZU9wdGlvbnMua2V5KTtcclxuICAgICAgICAgICAgICAgICAgICBzY29wZS4kd2F0Y2goXCJpdGVtc1tcIiArIGtleUluZGV4ICsgXCJdLmRhdGFcIiwgZnVuY3Rpb24gKG5ld1ZhbHVlLCBvbGRWYWx1ZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAobmV3VmFsdWUgIT09IHVuZGVmaW5lZCAmJiBuZXdWYWx1ZSAhPT0gb2xkVmFsdWUpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNjb3BlLmtleURhdGEgPSBuZXdWYWx1ZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICB2YXIga2V5U2hvd09ubHlJbmRleCA9IG5hdmNvbi5nZXRJdGVtSW5kZXhCeVByb3BlcnR5KHNjb3BlLml0ZW1zLCBzY29wZS5pdGVtLmtleSk7XHJcbiAgICAgICAgICAgICAgICAgICAgc2NvcGUuJHdhdGNoKFwiaXRlbXNbXCIgKyBrZXlTaG93T25seUluZGV4ICsgXCJdLnRlbXBsYXRlT3B0aW9ucy5zaG93T25seVwiLCBmdW5jdGlvbiAobmV3VmFsdWUsIG9sZFZhbHVlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChuZXdWYWx1ZSAhPT0gdW5kZWZpbmVkICYmIG5ld1ZhbHVlICE9PSBvbGRWYWx1ZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy9jb25zb2xlLmxvZyhuZXdWYWx1ZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIGtleU5hbWVJbmRleCA9IG5hdmNvbi5nZXRJdGVtSW5kZXhCeVByb3BlcnR5KHNjb3BlLml0ZW1zLCBzY29wZS5pdGVtLnRlbXBsYXRlT3B0aW9ucy5rZXlOYW1lKTtcclxuICAgICAgICAgICAgICAgICAgICBzY29wZS4kd2F0Y2goXCJpdGVtc1tcIiArIGtleU5hbWVJbmRleCArIFwiXS5kYXRhXCIsIGZ1bmN0aW9uIChuZXdWYWx1ZSwgb2xkVmFsdWUpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKG5ld1ZhbHVlICE9PSB1bmRlZmluZWQgJiYgbmV3VmFsdWUgIT09IG9sZFZhbHVlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzY29wZS5rZXlOYW1lID0gbmV3VmFsdWU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHNjb3BlLml0ZW0udGVtcGxhdGVPcHRpb25zLmZpbGVUeXBlID09PSB1bmRlZmluZWQgfHwgc2NvcGUuaXRlbS50ZW1wbGF0ZU9wdGlvbnMuZmlsZVR5cGUgPT09IFwiXCIpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHNjb3BlLml0ZW0udGVtcGxhdGVPcHRpb25zLmZpbGVUeXBlID0gW107XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGlmIChzY29wZS5pdGVtLnRlbXBsYXRlT3B0aW9ucy5maWxlU2l6ZSA9PT0gdW5kZWZpbmVkIHx8IHNjb3BlLml0ZW0udGVtcGxhdGVPcHRpb25zLmZpbGVTaXplID09PSBcIlwiKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICBzY29wZS5pdGVtLnRlbXBsYXRlT3B0aW9ucy5maWxlU2l6ZSA9IFwiMFwiO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICBpZiAoc2NvcGUuaXRlbS50ZW1wbGF0ZU9wdGlvbnMuc2FtZUZpbGUgPT09IHVuZGVmaW5lZCB8fCBzY29wZS5pdGVtLnRlbXBsYXRlT3B0aW9ucy5zYW1lRmlsZSA9PT0gXCJcIilcclxuICAgICAgICAgICAgICAgICAgICAgICAgc2NvcGUuaXRlbS50ZW1wbGF0ZU9wdGlvbnMuc2FtZUZpbGUgPSB0cnVlO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICBpZiAoc2NvcGUuaXRlbS50ZW1wbGF0ZU9wdGlvbnMuc2hvd09ubHkgPT09IHVuZGVmaW5lZCB8fCBzY29wZS5pdGVtLnRlbXBsYXRlT3B0aW9ucy5zaG93T25seSA9PT0gXCJcIilcclxuICAgICAgICAgICAgICAgICAgICAgICAgc2NvcGUuaXRlbS50ZW1wbGF0ZU9wdGlvbnMuc2hvd09ubHkgPSBmYWxzZTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHNjb3BlLml0ZW0udGVtcGxhdGVPcHRpb25zLmxhYmVsID09PSB1bmRlZmluZWQgfHwgc2NvcGUuaXRlbS50ZW1wbGF0ZU9wdGlvbnMubGFiZWwgPT09IFwiXCIpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHNjb3BlLml0ZW0udGVtcGxhdGVPcHRpb25zLmxhYmVsID0gXCJBdHRhY2htZW50c1wiO1xyXG5cclxuXHJcblxyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIGlmIChzY29wZS5pdGVtLnR5cGUgPT09IFwiaW5wdXRcIiB8fCBzY29wZS5pdGVtLnR5cGUgPT09IFwidGV4dGFyZWFcIikge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChzY29wZS5pdGVtLnRlbXBsYXRlT3B0aW9ucyAhPT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChzY29wZS5pdGVtLnRlbXBsYXRlT3B0aW9ucy5zcGVsbGNoZWNrID09PSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNjb3BlLml0ZW0udGVtcGxhdGVPcHRpb25zLnNwZWxsY2hlY2sgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIGlmICgkKGVsKS5pcygnW2NsYXNzKj1cImNvbC1zbVwiXScpKVxyXG4gICAgICAgICAgICAgICAgICAgICQoJzxkaXYgY2xhc3M9XCJjbGVhcmZpeCB2aXNpYmxlLXhzLWJsb2NrIHZpc2libGUtc20tYmxvY2tcIj48L2Rpdj4nKS5pbnNlcnRBZnRlcigkKGVsKSk7XHJcblxyXG4gICAgICAgICAgICAgICAgaWYgKHNjb3BlLml0ZW0udGVtcGxhdGVPcHRpb25zLmxhYmVsID09PSBcIlwiKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIGZpc3RPYmogPSAkKCQoZWwpLmZpbmQoXCJkaXZbbmctc2hvdyo9J1wiICsgc2NvcGUuaXRlbS50eXBlICsgXCInXVwiKVswXSkuZmluZCgnbGFiZWwnKS5maXJzdCgpO1xyXG4gICAgICAgICAgICAgICAgICAgIGZpc3RPYmouY3NzKFwiZGlzcGxheVwiLCBcIm5vbmVcIilcclxuICAgICAgICAgICAgICAgICAgICBmaXN0T2JqLm5leHQoKS5jc3MoXCJ3aWR0aFwiLCBcIjc5JVwiKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfTtcclxuXHJcbiAgICAgICAgICAgIGZ1bmN0aW9uIHNob3dNZXNzYWdnZVN0YXR1cyhzY29wZSwgJHRpbWVvdXQpIHtcclxuICAgICAgICAgICAgICAgIGlmIChzY29wZS5pbnZhbGlkID09PSB0cnVlICYmIChzY29wZS5pdGVtLnNob3dNZXNzYWdlID09PSB1bmRlZmluZWQgfHwgc2NvcGUuaXRlbS5zaG93TWVzc2FnZSA9PT0gZmFsc2UpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgc2NvcGUuaXRlbS5zaG93TWVzc2FnZSA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICAgJHRpbWVvdXQoZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBtZXNzYWdlKHNjb3BlKTtcclxuICAgICAgICAgICAgICAgICAgICB9LCA2MDAwKTtcclxuICAgICAgICAgICAgICAgIH07XHJcblxyXG4gICAgICAgICAgICAgICAgZnVuY3Rpb24gbWVzc2FnZShzY29wZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHNjb3BlLml0ZW0uc2hvd01lc3NhZ2UgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgIH07XHJcblxyXG5cclxuICAgICAgICAgICAgZnVuY3Rpb24gdGFiU2V0dGluZyhzY29wZSwgZWwsIGF0dHIpIHtcclxuICAgICAgICAgICAgICAgICQoZWwpLmZpbmQoJ2EnKS5jc3MoJ2N1cnNvcicsIHNjb3BlLml0ZW0udGVtcGxhdGVPcHRpb25zLmN1cnNvcik7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGZ1bmN0aW9uIGlucHV0U2V0dGluZyhzY29wZSwgZWwsIGF0dHIpIHtcclxuICAgICAgICAgICAgICAgIGlmIChzY29wZS5pdGVtLnRlbXBsYXRlT3B0aW9ucy5oaWRlTGFiZWwgPT09IHVuZGVmaW5lZCB8fCBzY29wZS5pdGVtLnRlbXBsYXRlT3B0aW9ucy5oaWRlTGFiZWwgPT09IGZhbHNlKVxyXG4gICAgICAgICAgICAgICAgICAgIHNjb3BlLml0ZW0udGVtcGxhdGVPcHRpb25zLmhpZGVMYWJlbCA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgZWxzZVxyXG4gICAgICAgICAgICAgICAgICAgIHNjb3BlLml0ZW0udGVtcGxhdGVPcHRpb25zLmhpZGVMYWJlbCA9IHRydWU7XHJcblxyXG4gICAgICAgICAgICAgICAgaWYgKHNjb3BlLml0ZW0udGVtcGxhdGVPcHRpb25zLmN1c3RvbUNsYXNzICE9PSB1bmRlZmluZWQpXHJcbiAgICAgICAgICAgICAgICAgICAgc2NvcGUuaXRlbS50ZW1wbGF0ZU9wdGlvbnMuY3VzdG9tQ2xhc3MgPSBcIlwiO1xyXG5cclxuICAgICAgICAgICAgfTtcclxuXHJcbiAgICAgICAgICAgIGZ1bmN0aW9uIGdldENvbG9ycGlja2VyT3B0aW9ucygpIHtcclxuICAgICAgICAgICAgICAgIC8vJChcIiNwaWNrZXJcIikub24oJ21vdmUuc3BlY3RydW0nLCBmdW5jdGlvbihlLCB0aW55Y29sb3IpIHsgfSk7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICAgICAgICAgIHNob3dQYWxldHRlT25seTogdHJ1ZSxcclxuICAgICAgICAgICAgICAgICAgICB0b2dnbGVQYWxldHRlT25seTogdHJ1ZSxcclxuICAgICAgICAgICAgICAgICAgICB0b2dnbGVQYWxldHRlTW9yZVRleHQ6ICdtb3JlJyxcclxuICAgICAgICAgICAgICAgICAgICB0b2dnbGVQYWxldHRlTGVzc1RleHQ6ICdsZXNzJyxcclxuICAgICAgICAgICAgICAgICAgICBzaG93SW5wdXQ6IHRydWUsXHJcbiAgICAgICAgICAgICAgICAgICAgcGFsZXR0ZTogW1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBbXCIjMDAwXCIsIFwiIzQ0NFwiLCBcIiM2NjZcIiwgXCIjOTk5XCIsIFwiI2NjY1wiLCBcIiNlZWVcIiwgXCIjZjNmM2YzXCIsIFwiI2ZmZlwiXSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgW1wiI2YwMFwiLCBcIiNmOTBcIiwgXCIjZmYwXCIsIFwiIzBmMFwiLCBcIiMwZmZcIiwgXCIjMDBmXCIsIFwiIzkwZlwiLCBcIiNmMGZcIl0sXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIFtcIiNmNGNjY2NcIiwgXCIjZmNlNWNkXCIsIFwiI2ZmZjJjY1wiLCBcIiNkOWVhZDNcIiwgXCIjZDBlMGUzXCIsIFwiI2NmZTJmM1wiLCBcIiNkOWQyZTlcIiwgXCIjZWFkMWRjXCJdLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBbXCIjZWE5OTk5XCIsIFwiI2Y5Y2I5Y1wiLCBcIiNmZmU1OTlcIiwgXCIjYjZkN2E4XCIsIFwiI2EyYzRjOVwiLCBcIiM5ZmM1ZThcIiwgXCIjYjRhN2Q2XCIsIFwiI2Q1YTZiZFwiXSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgW1wiI2UwNjY2NlwiLCBcIiNmNmIyNmJcIiwgXCIjZmZkOTY2XCIsIFwiIzkzYzQ3ZFwiLCBcIiM3NmE1YWZcIiwgXCIjNmZhOGRjXCIsIFwiIzhlN2NjM1wiLCBcIiNjMjdiYTBcIl0sXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIFtcIiNjMDBcIiwgXCIjZTY5MTM4XCIsIFwiI2YxYzIzMlwiLCBcIiM2YWE4NGZcIiwgXCIjNDU4MThlXCIsIFwiIzNkODVjNlwiLCBcIiM2NzRlYTdcIiwgXCIjYTY0ZDc5XCJdLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBbXCIjOTAwXCIsIFwiI2I0NWYwNlwiLCBcIiNiZjkwMDBcIiwgXCIjMzg3NjFkXCIsIFwiIzEzNGY1Y1wiLCBcIiMwYjUzOTRcIiwgXCIjMzUxYzc1XCIsIFwiIzc0MWI0N1wiXSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgW1wiIzYwMFwiLCBcIiM3ODNmMDRcIiwgXCIjN2Y2MDAwXCIsIFwiIzI3NGUxM1wiLCBcIiMwYzM0M2RcIiwgXCIjMDczNzYzXCIsIFwiIzIwMTI0ZFwiLCBcIiM0YzExMzBcIl1cclxuICAgICAgICAgICAgICAgICAgICBdXHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGZ1bmN0aW9uIGRhdGVTZXR0aW5nMTIzKHNjb3BlLCBlbCwgYXR0cikge1xyXG4gICAgICAgICAgICAgICAgdmFyIG9wdGlvbnMgPSB7fTtcclxuICAgICAgICAgICAgICAgIG9wdGlvbnMucnRsID0gTWV0cm9uaWMuaXNSVEwoKTtcclxuICAgICAgICAgICAgICAgIG9wdGlvbnMub3JpZW50YXRpb24gPSBcImxlZnRcIjtcclxuICAgICAgICAgICAgICAgIG9wdGlvbnMuYXV0b2Nsb3NlID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgIG9wdGlvbnMudG9kYXlIaWdobGlnaHQgPSB0cnVlO1xyXG5cclxuICAgICAgICAgICAgICAgIGlmIChzY29wZS5pdGVtLnRlbXBsYXRlT3B0aW9ucy5tb2RlICE9PSB1bmRlZmluZWQgJiYgc2NvcGUuaXRlbS50ZW1wbGF0ZU9wdGlvbnMubW9kZS50b0xvd2VyQ2FzZSgpID09PSBcInllYXJcIikge1xyXG4gICAgICAgICAgICAgICAgICAgIG9wdGlvbnMuZm9ybWF0ID0gXCJ5eXl5XCI7XHJcbiAgICAgICAgICAgICAgICAgICAgb3B0aW9ucy52aWV3TW9kZSA9IFwieWVhcnNcIjtcclxuICAgICAgICAgICAgICAgICAgICBvcHRpb25zLm1pblZpZXdNb2RlID0gXCJ5ZWFyc1wiO1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICQoZWwpLmZpbmQoJy5kYXRlLXBpY2tlcicpLmRhdGVwaWNrZXIob3B0aW9ucyk7XHJcblxyXG5cclxuICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgZnVuY3Rpb24gZGF0ZVNldHRpbmcoc2NvcGUsIGVsLCBhdHRyKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgb3B0aW9ucyA9IHt9O1xyXG4gICAgICAgICAgICAgICAgb3B0aW9ucy5ydGwgPSBNZXRyb25pYy5pc1JUTCgpO1xyXG4gICAgICAgICAgICAgICAgb3B0aW9ucy5vcmllbnRhdGlvbiA9IFwibGVmdFwiO1xyXG4gICAgICAgICAgICAgICAgb3B0aW9ucy5hdXRvY2xvc2UgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgb3B0aW9ucy50b2RheUhpZ2hsaWdodCA9IHRydWU7XHJcblxyXG5cclxuICAgICAgICAgICAgICAgIGlmIChzY29wZS5pdGVtLnRlbXBsYXRlT3B0aW9ucy5tb2RlICE9PSB1bmRlZmluZWQgJiYgc2NvcGUuaXRlbS50ZW1wbGF0ZU9wdGlvbnMubW9kZS50b0xvd2VyQ2FzZSgpID09PSBcInllYXJcIikge1xyXG4gICAgICAgICAgICAgICAgICAgIG9wdGlvbnMuZm9ybWF0ID0gXCJ5eXl5XCI7XHJcbiAgICAgICAgICAgICAgICAgICAgb3B0aW9ucy52aWV3TW9kZSA9IFwieWVhcnNcIjtcclxuICAgICAgICAgICAgICAgICAgICBvcHRpb25zLm1pblZpZXdNb2RlID0gXCJ5ZWFyc1wiO1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIGlmIChzY29wZS5pdGVtLnRlbXBsYXRlT3B0aW9ucy5mdXR1cmVEYXRlICE9PSB1bmRlZmluZWQgJiYgc2NvcGUuaXRlbS50ZW1wbGF0ZU9wdGlvbnMuZnV0dXJlRGF0ZSAhPT0gXCJcIilcclxuICAgICAgICAgICAgICAgICAgICBvcHRpb25zLmVuZERhdGUgPSBzY29wZS5pdGVtLnRlbXBsYXRlT3B0aW9ucy5mdXR1cmVEYXRlOyAvLycrMGQnXHJcblxyXG4gICAgICAgICAgICAgICAgJChlbCkuZmluZCgnLmRhdGUtcGlja2VyJykuZGF0ZXBpY2tlcihvcHRpb25zKTtcclxuXHJcbiAgICAgICAgICAgICAgICAkKGVsKS5maW5kKCcuZGF0ZS1waWNrZXInKS5kYXRlcGlja2VyKCkub24oJ2NoYW5nZURhdGUnLCBmdW5jdGlvbiAoZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIC8vIGBlYCBoZXJlIGNvbnRhaW5zIHRoZSBleHRyYSBhdHRyaWJ1dGVzXHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHNjb3BlLml0ZW1zW3Njb3BlLmZpZWxkSW5kZXhdLnRlbXBsYXRlT3B0aW9ucy5kYXRlZm9ybWF0ID09PSB1bmRlZmluZWQgfHxcclxuICAgICAgICAgICAgICAgICAgICAgICAgc2NvcGUuaXRlbXNbc2NvcGUuZmllbGRJbmRleF0udGVtcGxhdGVPcHRpb25zLmRhdGVmb3JtYXQgPT09IG51bGwgfHxcclxuICAgICAgICAgICAgICAgICAgICAgICAgc2NvcGUuaXRlbXNbc2NvcGUuZmllbGRJbmRleF0udGVtcGxhdGVPcHRpb25zLmRhdGVmb3JtYXQgPT09IFwiXCIpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHNjb3BlLml0ZW1zW3Njb3BlLmZpZWxkSW5kZXhdLmRhdGEgPSBtb21lbnQoZS5kYXRlKS5mb3JtYXQoXCJERC9NTS9ZWVlZXCIpO1xyXG4gICAgICAgICAgICAgICAgICAgIGVsc2VcclxuICAgICAgICAgICAgICAgICAgICAgICAgc2NvcGUuaXRlbXNbc2NvcGUuZmllbGRJbmRleF0uZGF0YSA9IG1vbWVudChlLmRhdGUpLmZvcm1hdChzY29wZS5pdGVtc1tzY29wZS5maWVsZEluZGV4XS50ZW1wbGF0ZU9wdGlvbnMuZGF0ZWZvcm1hdC50b1VwcGVyQ2FzZSgpKTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgICAgIHNjb3BlLiR3YXRjaChcIml0ZW0uZGlzcGxheURhdGFcIiwgZnVuY3Rpb24gKG5ld1ZhbHVlLCBvbGRWYWx1ZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChuZXdWYWx1ZSAhPT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICQoZWwpLmZpbmQoJy5kYXRlLXBpY2tlcicpLmRhdGVwaWNrZXIoJ3VwZGF0ZScsIG5ld1ZhbHVlKVxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH0pO1xyXG5cclxuXHJcbiAgICAgICAgICAgIH07XHJcblxyXG5cclxuICAgICAgICAgICAgZnVuY3Rpb24gZGF0ZVRpbWVTZXR0aW5nKHNjb3BlLCBlbCwgYXR0cikge1xyXG4gICAgICAgICAgICAgICAgdmFyIG9wdGlvbnMgPSB7IFwic2lkZUJ5U2lkZVwiOiB0cnVlIH07XHJcbiAgICAgICAgICAgICAgICBpZiAoc2NvcGUuaXRlbS50ZW1wbGF0ZU9wdGlvbnMgIT09IHVuZGVmaW5lZCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChzY29wZS5pdGVtLnRlbXBsYXRlT3B0aW9ucy50aW1lb25seSAhPT0gdW5kZWZpbmVkICYmIHNjb3BlLml0ZW0udGVtcGxhdGVPcHRpb25zLnRpbWVvbmx5KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG9wdGlvbnNbXCJmb3JtYXRcIl0gPSAnTFQnO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoc2NvcGUuaXRlbS50ZW1wbGF0ZU9wdGlvbnMuaG91cnMyNCAhPT0gdW5kZWZpbmVkICYmIHNjb3BlLml0ZW0udGVtcGxhdGVPcHRpb25zLmhvdXJzMjQpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBvcHRpb25zW1wiZm9ybWF0XCJdID0gXCJISDptbVwiO1xyXG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG9wdGlvbnNbXCJmb3JtYXRcIl0gPSAnTFQnO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoc2NvcGUuaXRlbS50ZW1wbGF0ZU9wdGlvbnMuaG91cnMyNCAhPT0gdW5kZWZpbmVkICYmIHNjb3BlLml0ZW0udGVtcGxhdGVPcHRpb25zLmhvdXJzMjQpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBvcHRpb25zW1wiZm9ybWF0XCJdID0gXCJERC9NTS9ZWVlZIEhIOm1tXCI7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2VcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9wdGlvbnNbXCJmb3JtYXRcIl0gPSBcIkREL01NL1lZWVkgaGg6bW0gQVwiO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBpZiAoc2NvcGUuaXRlbS50ZW1wbGF0ZU9wdGlvbnMuZnV0dXJlRGF0ZSAhPT0gdW5kZWZpbmVkICYmICFzY29wZS5pdGVtLnRlbXBsYXRlT3B0aW9ucy5mdXR1cmVEYXRlKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICBvcHRpb25zLm1heERhdGUgPSBuZXcgRGF0ZSgpO1xyXG5cclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAkKGVsKS5maW5kKCcuaW5wdXQtZ3JvdXAnKS5kYXRldGltZXBpY2tlcihvcHRpb25zKTtcclxuXHJcbiAgICAgICAgICAgICAgICAkKGVsKS5maW5kKCcuaW5wdXQtZ3JvdXAnKS5vbihcImRwLmNoYW5nZVwiLCBmdW5jdGlvbiAoZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChzY29wZS5pdGVtLnRlbXBsYXRlT3B0aW9ucy50aW1lb25seSAhPT0gdW5kZWZpbmVkICYmIHNjb3BlLml0ZW0udGVtcGxhdGVPcHRpb25zLnRpbWVvbmx5KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG9wdGlvbnNbXCJmb3JtYXRcIl0gPSAnTFQnO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoc2NvcGUuaXRlbS50ZW1wbGF0ZU9wdGlvbnMuaG91cnMyNCAhPT0gdW5kZWZpbmVkICYmIHNjb3BlLml0ZW0udGVtcGxhdGVPcHRpb25zLmhvdXJzMjQpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzY29wZS5pdGVtc1tzY29wZS5maWVsZEluZGV4XS5kYXRhID0gZS5kYXRlLmxvY2FsZSgnZW4nKS5mb3JtYXQoXCJISDptbVwiKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgZWxzZVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc2NvcGUuaXRlbXNbc2NvcGUuZmllbGRJbmRleF0uZGF0YSA9IGUuZGF0ZS5sb2NhbGUoJ2VuJykuZm9ybWF0KFwiaGg6bW0gQVwiKTtcclxuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoc2NvcGUuaXRlbS50ZW1wbGF0ZU9wdGlvbnMuaG91cnMyNCAhPT0gdW5kZWZpbmVkICYmIHNjb3BlLml0ZW0udGVtcGxhdGVPcHRpb25zLmhvdXJzMjQpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzY29wZS5pdGVtc1tzY29wZS5maWVsZEluZGV4XS5kYXRhID0gZS5kYXRlLmxvY2FsZSgnZW4nKS5mb3JtYXQoXCJERC9NTS9ZWVlZIEhIOm1tXCIpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBlbHNlXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzY29wZS5pdGVtc1tzY29wZS5maWVsZEluZGV4XS5kYXRhID0gZS5kYXRlLmxvY2FsZSgnZW4nKS5mb3JtYXQoXCJERC9NTS9ZWVlZIGhoOm1tIEFcIik7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH07XHJcblxyXG5cclxuICAgICAgICAgICAgZnVuY3Rpb24gYXV0b0NvbXBsZXRlU2V0dGluZyhzY29wZSwgZWwsIGF0dHIpIHtcclxuICAgICAgICAgICAgICAgIHZhciBzb3VyY2UgPSBuZXcgQmxvb2Rob3VuZCh7XHJcbiAgICAgICAgICAgICAgICAgICAgZGF0dW1Ub2tlbml6ZXI6IGZ1bmN0aW9uIChkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBCbG9vZGhvdW5kLnRva2VuaXplcnMud2hpdGVzcGFjZShkW3Njb3BlLml0ZW0uc2VsZWN0T3B0aW9ucy5pdGVtLmRpc3BsYXlGaWVsZF0pO1xyXG4gICAgICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICAgICAgcXVlcnlUb2tlbml6ZXI6IEJsb29kaG91bmQudG9rZW5pemVycy53aGl0ZXNwYWNlLFxyXG4gICAgICAgICAgICAgICAgICAgIGxvY2FsOiBzY29wZS5pdGVtLnNlbGVjdE9wdGlvbnMuaXRlbXNcclxuICAgICAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgICAgIHNvdXJjZS5pbml0aWFsaXplKCk7XHJcblxyXG4gICAgICAgICAgICAgICAgdmFyIGRlZmF1bHRzID0gZnVuY3Rpb24gKHEsIHN5bmMpIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAocSA9PT0gJycpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgc3luYyhzb3VyY2UuaW5kZXguYWxsKCkpO1xyXG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHNvdXJjZS5zZWFyY2gocSwgc3luYyk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICQoZWwpLmZpbmQoJy50eXBlYWhlYWQnKS50eXBlYWhlYWQoe1xyXG4gICAgICAgICAgICAgICAgICAgIG1pbkxlbmd0aDogMFxyXG4gICAgICAgICAgICAgICAgfSwge1xyXG4gICAgICAgICAgICAgICAgICAgIHNvdXJjZTogZGVmYXVsdHMsXHJcbiAgICAgICAgICAgICAgICAgICAgZGlzcGxheTogc2NvcGUuaXRlbS5zZWxlY3RPcHRpb25zLml0ZW0uZGlzcGxheUZpZWxkLFxyXG4gICAgICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICAgICAgJCgkKGVsKS5maW5kKCcudHlwZWFoZWFkJykpLmRhdGEoc2NvcGUuaXRlbSk7XHJcblxyXG4gICAgICAgICAgICAgICAgJChlbCkuZmluZCgnLnR5cGVhaGVhZCcpLm9uKCd0eXBlYWhlYWQ6c2VsZWN0ZWQnLCBmdW5jdGlvbiAoZSwgZGF0dW0sIG5hbWUsIHQpIHtcclxuICAgICAgICAgICAgICAgICAgICAkKGUudGFyZ2V0KS5kYXRhKCkuZGF0YSA9IGRhdHVtO1xyXG4gICAgICAgICAgICAgICAgICAgIHNjb3BlLml0ZW0uZGF0YSA9IGRhdHVtLnRleHQgIT09IHVuZGVmaW5lZCA/IGRhdHVtLnRleHQgOiBkYXR1bVtzY29wZS5pdGVtLnNlbGVjdE9wdGlvbnMuaXRlbS5kaXNwbGF5RmllbGRdO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICAgICAgc2NvcGUuJHdhdGNoKFwiaXRlbS5zZWxlY3RPcHRpb25zLml0ZW1zXCIsIGZ1bmN0aW9uIChuZXdWYWx1ZSwgb2xkVmFsdWUpIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAobmV3VmFsdWUgIT09IHVuZGVmaW5lZCAmJiBuZXdWYWx1ZS5sZW5ndGggIT09IDApIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgc291cmNlID0gbmV3IEJsb29kaG91bmQoe1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZGF0dW1Ub2tlbml6ZXI6IGZ1bmN0aW9uIChkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIEJsb29kaG91bmQudG9rZW5pemVycy53aGl0ZXNwYWNlKGRbc2NvcGUuaXRlbS5zZWxlY3RPcHRpb25zLml0ZW0uZGlzcGxheUZpZWxkXSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcXVlcnlUb2tlbml6ZXI6IEJsb29kaG91bmQudG9rZW5pemVycy53aGl0ZXNwYWNlLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9jYWw6IG5ld1ZhbHVlXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgc291cmNlLmluaXRpYWxpemUoKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfTtcclxuXHJcbiAgICAgICAgICAgIGZ1bmN0aW9uIHNlbGVjdFNldHRpbmcoc2NvcGUsIGVsLCBhdHRyKSB7XHJcblxyXG4gICAgICAgICAgICAgICAgaWYgKHNjb3BlLml0ZW0uc2VsZWN0T3B0aW9ucy5pc0N1c3RvbUZvcm1hdCA9PT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgc2NvcGUuaXRlbS5zZWxlY3RPcHRpb25zLmlzQ3VzdG9tRm9ybWF0ID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICAgICAgLy9zY29wZS5pdGVtLnNlbGVjdE9wdGlvbnMuY3VzdG9tRm9ybWF0ID0gXCJyZWFzb25DbG9zdXJlQ3VzdG9tRm9ybWF0XCI7XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgc2NvcGUuZ2V0Rm9ybWF0ID0gZnVuY3Rpb24gKHNlbGVjdGVkSXRlbSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciByZXRWYWwgPSBcIlwiO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChzZWxlY3RlZEl0ZW0gIT09IHVuZGVmaW5lZCAmJiBzZWxlY3RlZEl0ZW0gIT09IFwiXCIpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHNjb3BlLml0ZW0uc2VsZWN0T3B0aW9ucy5jdXN0b21Gb3JtYXQgIT09IHVuZGVmaW5lZCAmJiBzY29wZS5pdGVtLnNlbGVjdE9wdGlvbnMuY3VzdG9tRm9ybWF0ICE9PSBcIlwiICYmIHNjb3BlLml0ZW0uc2VsZWN0T3B0aW9ucy5pc0N1c3RvbUZvcm1hdCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHNjb3BlLm5hdmNvbkRhdGFbc2NvcGUuaXRlbS5zZWxlY3RPcHRpb25zLmN1c3RvbUZvcm1hdF0gIT09IHVuZGVmaW5lZClcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXRWYWwgPSBzY29wZS5uYXZjb25EYXRhW3Njb3BlLml0ZW0uc2VsZWN0T3B0aW9ucy5jdXN0b21Gb3JtYXRdKHNlbGVjdGVkSXRlbSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlIGlmIChzY29wZS5uYXZjb25EYXRhLiRwYXJlbnRbc2NvcGUuaXRlbS5zZWxlY3RPcHRpb25zLmN1c3RvbUZvcm1hdF0gIT09IHVuZGVmaW5lZClcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXRWYWwgPSBzY29wZS5uYXZjb25EYXRhLiRwYXJlbnRbc2NvcGUuaXRlbS5zZWxlY3RPcHRpb25zLmN1c3RvbUZvcm1hdF0oc2VsZWN0ZWRJdGVtKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2VcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXRWYWwgPSBzZWxlY3RlZEl0ZW1bc2NvcGUuaXRlbS5zZWxlY3RPcHRpb25zLml0ZW0uZGlzcGxheUZpZWxkXTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICBlbHNlIHtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoc2VsZWN0ZWRJdGVtW3Njb3BlLml0ZW0uc2VsZWN0T3B0aW9ucy5pdGVtLmRpc3BsYXlGaWVsZF0gIT09IHVuZGVmaW5lZClcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXRWYWwgPSBzZWxlY3RlZEl0ZW1bc2NvcGUuaXRlbS5zZWxlY3RPcHRpb25zLml0ZW0uZGlzcGxheUZpZWxkXTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmV0VmFsO1xyXG4gICAgICAgICAgICAgICAgfTtcclxuXHJcbiAgICAgICAgICAgICAgICB2YXIga2V5SW5kZXggPSBuYXZjb24uZ2V0SXRlbUluZGV4QnlQcm9wZXJ0eShzY29wZS5pdGVtcywgc2NvcGUuaXRlbS5rZXkpO1xyXG4gICAgICAgICAgICAgICAgc2NvcGUuJHdhdGNoKFwiaXRlbXNbXCIgKyBrZXlJbmRleCArIFwiXS5kaXNhYmxlZFwiLCBmdW5jdGlvbiAobmV3VmFsdWUsIG9sZFZhbHVlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKG5ld1ZhbHVlICE9PSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHNjb3BlLml0ZW0uZGlzYWJsZWQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICQoJy51aS1zZWxlY3QtY29udGFpbmVyIC5zZWxlY3RpemUtaW5wdXQnKS5jc3MoXCJiYWNrZ3JvdW5kXCIsIFwiYWxpY2VibHVlXCIpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJCgnLnVpLXNlbGVjdC1jb250YWluZXIgLnNlbGVjdGl6ZS1pbnB1dCcpLmNzcyhcImNvbG9yXCIsIFwicm95YWxibHVlXCIpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICB9O1xyXG5cclxuICAgICAgICAgICAgZnVuY3Rpb24gbXVsdGlTZWxlY3RTZXR0aW5nKHNjb3BlLCBlbCwgYXR0cikge1xyXG5cclxuXHJcbiAgICAgICAgICAgICAgICB2YXIga2V5SW5kZXggPSBuYXZjb24uZ2V0SXRlbUluZGV4QnlQcm9wZXJ0eShzY29wZS5pdGVtcywgc2NvcGUuaXRlbS5rZXkpO1xyXG4gICAgICAgICAgICAgICAgaWYgKHNjb3BlLml0ZW1zW2tleUluZGV4XS50eXBlID09PSBcIm11bHRpc2VsZWN0Y2hlY2tib3hcIilcclxuICAgICAgICAgICAgICAgICAgICBpZiAoc2NvcGUuaXRlbXNba2V5SW5kZXhdLmRhdGEgPT09IHVuZGVmaW5lZCB8fCBzY29wZS5pdGVtc1trZXlJbmRleF0uZGF0YSA9PT0gXCJcIikgc2NvcGUuaXRlbXNba2V5SW5kZXhdLmRhdGEgPSBbXTtcclxuXHJcbiAgICAgICAgICAgICAgICBzY29wZS4kd2F0Y2goXCJpdGVtc1tcIiArIGtleUluZGV4ICsgXCJdLmRpc2FibGVkXCIsIGZ1bmN0aW9uIChuZXdWYWx1ZSwgb2xkVmFsdWUpIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAobmV3VmFsdWUgIT09IHVuZGVmaW5lZCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoc2NvcGUuaXRlbS5kaXNhYmxlZCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJCgnLnNlbGVjdDItY2hvaWNlcycpLmNzcyhcImJhY2tncm91bmRcIiwgXCJhbGljZWJsdWVcIik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkKCcudWktc2VsZWN0LW1hdGNoLWl0ZW0nKS5jc3MoXCJiYWNrZ3JvdW5kXCIsIFwiYWxpY2VibHVlXCIpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJCgnLnNlbGVjdDItY2hvaWNlcycpLmNzcyhcImNvbG9yXCIsIFwicm95YWxibHVlXCIpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJCgnLnVpLXNlbGVjdC1tYXRjaC1pdGVtJykuY3NzKFwiY29sb3JcIiwgXCJyb3lhbGJsdWVcIik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgICAgICBzY29wZS5tdWx0aVNlbGVjdEdyb3VwQ29sb3IgPSBmdW5jdGlvbiAoaXRlbSwgc2VsZWN0ZWRJdGVtLCBwYXJlbnRJdGVtKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIHJldFZhbCA9IFwiIzAwMFwiO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChzY29wZS5pdGVtLmdyb3VwID09IHVuZGVmaW5lZCB8fCBzY29wZS5pdGVtLmdyb3VwLmtleSA9PSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIGtleUluZGV4ID0gbmF2Y29uLmdldEl0ZW1JbmRleEJ5UHJvcGVydHkoc2NvcGUuaXRlbXMsIHNjb3BlLml0ZW0uZ3JvdXAua2V5KTtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgcGFyZW50RGF0YSA9IHNjb3BlLml0ZW1zW2tleUluZGV4XS5kYXRhO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICBpZiAoc2NvcGUuaXRlbS5ncm91cC5maWVsZCAhPT0gdW5kZWZpbmVkICYmIHNjb3BlLml0ZW0uZ3JvdXAuZmllbGQgIT09IG51bGwpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHZhbHVlID0gJC5ncmVwKHNlbGVjdGVkSXRlbVtzY29wZS5pdGVtLmdyb3VwLm9iamVjdF0sIGZ1bmN0aW9uIChlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZVtzY29wZS5pdGVtLmdyb3VwLmZpZWxkXSA9PT0gcGFyZW50RGF0YVtzY29wZS5pdGVtLmdyb3VwLmZpZWxkXSAmJiBwYXJlbnREYXRhICE9PSB1bmRlZmluZWQ7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHZhbHVlICE9PSB1bmRlZmluZWQgJiYgdmFsdWUgIT09IG51bGwgJiYgdmFsdWUubGVuZ3RoICE9PSAwICYmIHZhbHVlICE9PSAtMSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldFZhbCA9IChzY29wZS5pdGVtLmdyb3VwLmNvbG9yIHx8IFwiI0ZGNDUwMFwiKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiByZXRWYWw7XHJcbiAgICAgICAgICAgICAgICB9O1xyXG5cclxuICAgICAgICAgICAgICAgIHNjb3BlLm11bHRpU2VsZWN0R3JvdXBCb2xkID0gZnVuY3Rpb24gKGl0ZW0sIHNlbGVjdGVkSXRlbSwgcGFyZW50SXRlbSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciByZXRWYWwgPSBcIm5vcm1hbFwiO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChzY29wZS5pdGVtLmdyb3VwID09IHVuZGVmaW5lZCB8fCBzY29wZS5pdGVtLmdyb3VwLmtleSA9PSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIGtleUluZGV4ID0gbmF2Y29uLmdldEl0ZW1JbmRleEJ5UHJvcGVydHkoc2NvcGUuaXRlbXMsIHNjb3BlLml0ZW0uZ3JvdXAua2V5KTtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgcGFyZW50RGF0YSA9IHNjb3BlLml0ZW1zW2tleUluZGV4XS5kYXRhO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICBpZiAoc2NvcGUuaXRlbS5ncm91cC5maWVsZCAhPT0gdW5kZWZpbmVkICYmIHNjb3BlLml0ZW0uZ3JvdXAuZmllbGQgIT09IG51bGwpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHZhbHVlID0gJC5ncmVwKHNlbGVjdGVkSXRlbVtzY29wZS5pdGVtLmdyb3VwLm9iamVjdF0sIGZ1bmN0aW9uIChlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZVtzY29wZS5pdGVtLmdyb3VwLmZpZWxkXSA9PT0gcGFyZW50RGF0YVtzY29wZS5pdGVtLmdyb3VwLmZpZWxkXSAmJiBwYXJlbnREYXRhICE9PSB1bmRlZmluZWQ7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHZhbHVlICE9PSB1bmRlZmluZWQgJiYgdmFsdWUgIT09IG51bGwgJiYgdmFsdWUubGVuZ3RoICE9PSAwICYmIHZhbHVlICE9PSAtMSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldFZhbCA9IFwiNjAwXCI7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmV0VmFsO1xyXG4gICAgICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgfTtcclxuXHJcbiAgICAgICAgICAgIGZ1bmN0aW9uIHN3aXRjaFNldHRpbmcoc2NvcGUsIGVsLCBhdHRyKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIga2V5SW5kZXggPSBuYXZjb24uZ2V0SXRlbUluZGV4QnlQcm9wZXJ0eShzY29wZS5pdGVtcywgc2NvcGUuaXRlbS5rZXkpO1xyXG4gICAgICAgICAgICAgICAgc2NvcGUuJHdhdGNoKFwiaXRlbXNbXCIgKyBrZXlJbmRleCArIFwiXS5kaXNhYmxlZFwiLCBmdW5jdGlvbiAobmV3VmFsdWUsIG9sZFZhbHVlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKG5ld1ZhbHVlICE9PSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHNjb3BlLml0ZW0uZGlzYWJsZWQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICQoZWwpLmZpbmQoXCIuYm9vdHN0cmFwLXN3aXRjaC1jb250YWluZXJcIikuY3NzKFwicG9pbnRlci1ldmVudHNcIiwgXCJub25lXCIpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJChlbCkuZmluZChcIi5ib290c3RyYXAtc3dpdGNoLXdyYXBwZXJcIikuY3NzKFwiY3Vyc29yXCIsIFwibm90LWFsbG93ZWRcIik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkKGVsKS5maW5kKFwiLmJvb3RzdHJhcC1zd2l0Y2gtY29udGFpbmVyXCIpLmNzcyhcInBvaW50ZXItZXZlbnRzXCIsIFwiXCIpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJChlbCkuZmluZChcIi5ib290c3RyYXAtc3dpdGNoLXdyYXBwZXJcIikuY3NzKFwicG9pbnRlci1ldmVudHNcIiwgXCJkZWZhdWx0XCIpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH07XHJcblxyXG4gICAgICAgICAgICBmdW5jdGlvbiB0YWJsZWVkaXRvclNldHRpbmcoc2NvcGUsIGVsLCBhdHRyKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoc2NvcGUuaXRlbS50ZW1wbGF0ZU9wdGlvbnMuc2V0dGluZ3MgIT09IHVuZGVmaW5lZCAmJiBzY29wZS5pdGVtLnRlbXBsYXRlT3B0aW9ucy5zZXR0aW5ncyAhPT0gXCJcIikge1xyXG4gICAgICAgICAgICAgICAgICAgIHNjb3BlLml0ZW0udGFibGVlZGl0b3JTZXR0aW5ncyA9IHNjb3BlLm5hdmNvbkRhdGFbc2NvcGUuaXRlbS50ZW1wbGF0ZU9wdGlvbnMuc2V0dGluZ3NdO1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIGlmIChzY29wZS5pdGVtLnRlbXBsYXRlT3B0aW9ucy5zaG93QWRkID09PSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgICAgICAgICAgICBzY29wZS5pdGVtLnRlbXBsYXRlT3B0aW9ucy5zaG93QWRkID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICBpZiAoc2NvcGUuaXRlbS50ZW1wbGF0ZU9wdGlvbnMuc2hvd0RlbCA9PT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgc2NvcGUuaXRlbS50ZW1wbGF0ZU9wdGlvbnMuc2hvd0RlbCA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgaWYgKHNjb3BlLml0ZW0udGVtcGxhdGVPcHRpb25zLnNob3dVcGRhdGUgPT09IHVuZGVmaW5lZCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHNjb3BlLml0ZW0udGVtcGxhdGVPcHRpb25zLnNob3dVcGRhdGUgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICBpZiAoc2NvcGUuaXRlbS50ZW1wbGF0ZU9wdGlvbnMuc2hvd292ZXJBbGxzYXZlID09PSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgICAgICAgICAgICBzY29wZS5pdGVtLnRlbXBsYXRlT3B0aW9ucy5zaG93b3ZlckFsbHNhdmUgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGlmIChzY29wZS5pdGVtLnRlbXBsYXRlT3B0aW9ucy5zaG93SXRhciA9PT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgc2NvcGUuaXRlbS50ZW1wbGF0ZU9wdGlvbnMuc2hvd0l0YXIgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGlmIChzY29wZS5pdGVtLnRlbXBsYXRlT3B0aW9ucy5TYXZlQnV0dG9uVGV4dCA9PT0gdW5kZWZpbmVkKVxyXG4gICAgICAgICAgICAgICAgICAgIHNjb3BlLml0ZW0udGVtcGxhdGVPcHRpb25zLlNhdmVCdXR0b25UZXh0ID0gXCJcIjtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgZnVuY3Rpb24gcGFyZW50SXRlbXMoaXRlbSkge1xyXG4gICAgICAgICAgICAgICAgZm9yICh2YXIga2V5IGluIGl0ZW0pIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoaXRlbVtcIiRwYXJlbnRcIl0uaXRlbXMgIT0gdW5kZWZpbmVkKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gaXRlbVtcIiRwYXJlbnRcIl0uaXRlbXM7XHJcbiAgICAgICAgICAgICAgICAgICAgZWxzZVxyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gcGFyZW50SXRlbXMoaXRlbVtcIiRwYXJlbnRcIl0pO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9O1xyXG5cclxuICAgICAgICAgICAgZnVuY3Rpb24gcmF0aW5nU2V0dGluZyhzY29wZSwgZWwsIGF0dHIpIHtcclxuICAgICAgICAgICAgICAgIC8qc2NvcGUuaXRlbS5kYXRhID0gMztcclxuICAgICAgICAgICAgICAgIGlmKHNjb3BlLml0ZW0ucmF0aW5nT3B0aW9ucyAhPT0gdW5kZWZpbmVkICYmIHNjb3BlLml0ZW0ucmF0aW5nT3B0aW9ucy5tYXggIT09IHVuZGVmaW5lZClcclxuICAgICAgICAgICAgICAgICAgICBzY29wZS5tYXggPSBzY29wZS5pdGVtLnJhdGluZ09wdGlvbnMubWF4O1xyXG4gICAgICAgICAgICAgICAgZWxzZVxyXG4gICAgICAgICAgICAgICAgICAgIHNjb3BlLm1heCA9IDU7XHJcbiAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICAgICBpZihzY29wZS5pdGVtLnJhdGluZ09wdGlvbnMgIT09IHVuZGVmaW5lZCAmJiBzY29wZS5pdGVtLnJhdGluZ09wdGlvbnMuaXNSZWFkb25seSAhPT0gdW5kZWZpbmVkKVxyXG4gICAgICAgICAgICAgICAgICAgIHNjb3BlLmlzUmVhZG9ubHkgPSBzY29wZS5pdGVtLnJhdGluZ09wdGlvbnMuaXNSZWFkb25seTtcclxuICAgICAgICAgICAgICAgIGVsc2VcclxuICAgICAgICAgICAgICAgICAgICBzY29wZS5pc1JlYWRvbmx5ID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICAgICBpZihzY29wZS5pdGVtLnJhdGluZ09wdGlvbnMgIT09IHVuZGVmaW5lZCAmJiBzY29wZS5pdGVtLnJhdGluZ09wdGlvbnMudGl0bGVzICE9PSB1bmRlZmluZWQpXHJcbiAgICAgICAgICAgICAgICAgICAgc2NvcGUudGl0bGVzID0gc2NvcGUuaXRlbS5yYXRpbmdPcHRpb25zLnRpdGxlcztcclxuICAgICAgICAgICAgICAgIGVsc2VcclxuICAgICAgICAgICAgICAgICAgICBzY29wZS50aXRsZXMgPSBbJ29uZScsJ3R3bycsJ3RocmVlJywgJ2ZvdXInLCAnZml2ZSddOyovXHJcblxyXG4gICAgICAgICAgICAgICAgc2NvcGUuaG92ZXJpbmdPdmVyID0gZnVuY3Rpb24gKHZhbHVlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgc2NvcGUub3ZlclN0YXIgPSB2YWx1ZTtcclxuICAgICAgICAgICAgICAgICAgICBzY29wZS5wZXJjZW50ID0gMTAwICogKHZhbHVlIC8gc2NvcGUubWF4KTtcclxuICAgICAgICAgICAgICAgIH07XHJcblxyXG4gICAgICAgICAgICAgICAgc2NvcGUucmF0aW5nU3RhdGVzID0gW1xyXG4gICAgICAgICAgICAgICAgICAgICAgeyBzdGF0ZU9uOiAnZ2x5cGhpY29uLW9rLXNpZ24nLCBzdGF0ZU9mZjogJ2dseXBoaWNvbi1vay1jaXJjbGUnIH0sXHJcbiAgICAgICAgICAgICAgICAgICAgICB7IHN0YXRlT246ICdnbHlwaGljb24tc3RhcicsIHN0YXRlT2ZmOiAnZ2x5cGhpY29uLXN0YXItZW1wdHknIH0sXHJcbiAgICAgICAgICAgICAgICAgICAgICB7IHN0YXRlT246ICdnbHlwaGljb24taGVhcnQnLCBzdGF0ZU9mZjogJ2dseXBoaWNvbi1iYW4tY2lyY2xlJyB9LFxyXG4gICAgICAgICAgICAgICAgICAgICAgeyBzdGF0ZU9uOiAnZ2x5cGhpY29uLWhlYXJ0JyB9LFxyXG4gICAgICAgICAgICAgICAgICAgICAgeyBzdGF0ZU9mZjogJ2dseXBoaWNvbi1vZmYnIH1cclxuICAgICAgICAgICAgICAgIF07XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9O1xyXG59XSkuZGlyZWN0aXZlKCduYXZjb25CdXR0b24nLCBbJyR0aW1lb3V0JywgJ2RhdGFzZXJ2aWNlJyxcclxuZnVuY3Rpb24gKCR0aW1lb3V0LCBkYXRhc2VydmljZSkge1xyXG4gICAgcmV0dXJuIHtcclxuICAgICAgICAvKkU6IERpcmVjdGl2ZSBkZWZpbmVkIGFzIGFuIGVsZW1lbnQuIDxuYXZjb24taW5wdXQ+PC9uYXZjb24taW5wdXQ+XHJcbiAgICAgICAgQTogRGlyZWN0aXZlIGFwcGxpZWQgYXMgYW4gYXR0cmlidXRlIG9uIGV4aXN0aW5nIGVsZW1lbnQuIDxkaXYgbmF2Y29uLWlucHV0PjwvZGl2PlxyXG4gICAgICAgIEM6IERpcmVjdGl2ZSBhcHBsaWVkIGFzIGEgY3NzIGNsYXNzIHRvIGV4aXN0aW5nIGVsZW1lbnQgPGRpdiBjbGFzcz1cIm5hdmNvbi1pbnB1dFwiPjwvZGl2PlxyXG4gICAgICAgIE06IERpcmVjdGl2ZSBhcHBsaWVkIGFzIGNvbW1lbnQuKi9cclxuICAgICAgICByZXN0cmljdDogJ0UnLFxyXG4gICAgICAgIHNjb3BlOiB7XHJcbiAgICAgICAgICAgIC8vQCByZWFkcyB0aGUgYXR0cmlidXRlIHZhbHVlLCA9IHByb3ZpZGVzIHR3by13YXkgYmluZGluZywgJiB3b3JrcyB3aXRoIGZ1bmN0aW9uc1xyXG4gICAgICAgICAgICBjdXN0b21DbGFzczogJ0AnLFxyXG4gICAgICAgICAgICBuYXZjb25EYXRhOiAnPScsXHJcbiAgICAgICAgICAgIHRleHQ6ICdAJyxcclxuICAgICAgICAgICAgaWNvbjogJ0AnLFxyXG4gICAgICAgICAgICB0YXJnZXQ6ICdAJyxcclxuICAgICAgICAgICAgZmllbGREaXNhYmxlZDogJz0nLFxyXG4gICAgICAgICAgICB0b29sdGlwVGV4dDogJ0AnXHJcbiAgICAgICAgfSxcclxuICAgICAgICB0ZW1wbGF0ZTogJzxhIGNsYXNzPVwie3tjdXN0b21DbGFzc319XCIgIGRhdGEtdGFyZ2V0PVwiI3t7dGFyZ2V0fX1cIiBkYXRhLXRvZ2dsZT1cIm1vZGFsXCI+PGRpdiBkYXRhLXRvZ2dsZT1cInRvb2x0aXBcIiBkYXRhLW9yaWdpbmFsLXRpdGxlPVwie3t0b29sdGlwVGV4dH19XCI+e3t0ZXh0fX0mbmJzcDs8c3BhbiBjbGFzcz1cInt7aWNvbn19XCI+PC9zcGFuPjwvZGl2PjwvYT4nLFxyXG4gICAgICAgIGxpbms6IGZ1bmN0aW9uIChzY29wZSwgZWwsIGF0dHJzKSB7XHJcbiAgICAgICAgICAgIC8vY29uc29sZS5sb2coc2NvcGUpO1xyXG4gICAgICAgICAgICBpZiAoc2NvcGUudG9vbHRpcFRleHQgPT0gdW5kZWZpbmVkIHx8IHNjb3BlLnRvb2x0aXBUZXh0ID09PSBudWxsKSBzY29wZS50b29sdGlwVGV4dCA9IFwiXCI7XHJcblxyXG4gICAgICAgICAgICBzY29wZS4kd2F0Y2goXCJmaWVsZERpc2FibGVkXCIsIGZ1bmN0aW9uIChuZXdWYWx1ZSwgb2xkVmFsdWUpIHtcclxuICAgICAgICAgICAgICAgIGlmIChuZXdWYWx1ZSAhPT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKG5ld1ZhbHVlID09PSBudWxsKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAkKGVsKS5maW5kKFwiYVwiKS5hdHRyKFwiZGlzYWJsZWRcIiwgXCJkaXNiYWxlZFwiKTtcclxuICAgICAgICAgICAgICAgICAgICBlbHNlXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICQoZWwpLmZpbmQoXCJhXCIpLnJlbW92ZUF0dHIoXCJkaXNhYmxlZFwiKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICAkKCdhID4gZGl2W2RhdGEtdG9nZ2xlPVwidG9vbHRpcFwiXScpLnRvb2x0aXAoKTtcclxuICAgICAgICB9XHJcbiAgICB9O1xyXG59XSkuZGlyZWN0aXZlKCduYXZjb25CdXR0b25Db2xsYXBzZScsIFsnJHRpbWVvdXQnLCAnZGF0YXNlcnZpY2UnLFxyXG5mdW5jdGlvbiAoJHRpbWVvdXQsIGRhdGFzZXJ2aWNlKSB7XHJcbiAgICByZXR1cm4ge1xyXG4gICAgICAgIC8qRTogRGlyZWN0aXZlIGRlZmluZWQgYXMgYW4gZWxlbWVudC4gPG5hdmNvbi1pbnB1dD48L25hdmNvbi1pbnB1dD5cclxuICAgICAgICBBOiBEaXJlY3RpdmUgYXBwbGllZCBhcyBhbiBhdHRyaWJ1dGUgb24gZXhpc3RpbmcgZWxlbWVudC4gPGRpdiBuYXZjb24taW5wdXQ+PC9kaXY+XHJcbiAgICAgICAgQzogRGlyZWN0aXZlIGFwcGxpZWQgYXMgYSBjc3MgY2xhc3MgdG8gZXhpc3RpbmcgZWxlbWVudCA8ZGl2IGNsYXNzPVwibmF2Y29uLWlucHV0XCI+PC9kaXY+XHJcbiAgICAgICAgTTogRGlyZWN0aXZlIGFwcGxpZWQgYXMgY29tbWVudC4qL1xyXG4gICAgICAgIHJlc3RyaWN0OiAnRScsXHJcbiAgICAgICAgc2NvcGU6IHtcclxuICAgICAgICAgICAgLy9AIHJlYWRzIHRoZSBhdHRyaWJ1dGUgdmFsdWUsID0gcHJvdmlkZXMgdHdvLXdheSBiaW5kaW5nLCAmIHdvcmtzIHdpdGggZnVuY3Rpb25zXHJcbiAgICAgICAgICAgIGN1c3RvbUNsYXNzOiAnQCcsXHJcbiAgICAgICAgICAgIG5hdmNvbkRhdGE6ICc9JyxcclxuICAgICAgICAgICAgdGV4dDogJ0AnLFxyXG4gICAgICAgICAgICBpY29uOiAnQCcsXHJcbiAgICAgICAgICAgIHRhcmdldDogJ0AnLFxyXG4gICAgICAgICAgICBmaWVsZERpc2FibGVkOiAnPSdcclxuICAgICAgICB9LFxyXG4gICAgICAgIHRlbXBsYXRlOiAnPGJ1dHRvbiBjbGFzcz1cInt7Y3VzdG9tQ2xhc3N9fVwiIGRhdGEtdG9nZ2xlPVwiY29sbGFwc2VcIiBkYXRhLXRhcmdldD1cIiN7e3RhcmdldH19XCI+e3t0ZXh0fX0mbmJzcDs8aSBjbGFzcz1cInt7aWNvbn19XCIgYXJpYS1oaWRkZW49XCJ0cnVlXCI+PC9pPjwvYnV0dG9uPicsXHJcbiAgICAgICAgbGluazogZnVuY3Rpb24gKHNjb3BlLCBlbCwgYXR0cnMpIHtcclxuICAgICAgICAgICAgLy9jb25zb2xlLmxvZyhzY29wZSk7XHJcblxyXG4gICAgICAgICAgICBzY29wZS4kd2F0Y2goXCJmaWVsZERpc2FibGVkXCIsIGZ1bmN0aW9uIChuZXdWYWx1ZSwgb2xkVmFsdWUpIHtcclxuICAgICAgICAgICAgICAgIGlmIChuZXdWYWx1ZSAhPT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKG5ld1ZhbHVlID09PSBudWxsKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAkKGVsKS5maW5kKFwiYVwiKS5hdHRyKFwiZGlzYWJsZWRcIiwgXCJkaXNiYWxlZFwiKTtcclxuICAgICAgICAgICAgICAgICAgICBlbHNlXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICQoZWwpLmZpbmQoXCJhXCIpLnJlbW92ZUF0dHIoXCJkaXNhYmxlZFwiKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxufV0pLmRpcmVjdGl2ZSgnbmdFbnRlcicsIGZ1bmN0aW9uICgpIHtcclxuICAgIHJldHVybiBmdW5jdGlvbiAoc2NvcGUsIGVsZW1lbnQsIGF0dHJzKSB7XHJcbiAgICAgICAgZWxlbWVudC5iaW5kKFwia2V5ZG93biBrZXlwcmVzc1wiLCBmdW5jdGlvbiAoZXZlbnQpIHtcclxuICAgICAgICAgICAgaWYgKGV2ZW50LndoaWNoID09PSAxMykge1xyXG4gICAgICAgICAgICAgICAgc2NvcGUuJGFwcGx5KGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgICAgICBzY29wZS4kZXZhbChhdHRycy5uZ0VudGVyKTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgIH07XHJcbn0pLmRpcmVjdGl2ZSgncmVxdWlyZU11bHRpcGxlJywgZnVuY3Rpb24gKCkge1xyXG4gICAgcmV0dXJuIHtcclxuICAgICAgICByZXF1aXJlOiAnbmdNb2RlbCcsXHJcbiAgICAgICAgbGluazogZnVuY3Rpb24gcG9zdExpbmsoc2NvcGUsIGVsZW1lbnQsIGF0dHJzLCBuZ01vZGVsKSB7XHJcbiAgICAgICAgICAgIG5nTW9kZWwuJHZhbGlkYXRvcnMucmVxdWlyZWQgPSBmdW5jdGlvbiAodmFsdWUpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBhbmd1bGFyLmlzQXJyYXkodmFsdWUpICYmIHZhbHVlLmxlbmd0aCA+IDA7XHJcbiAgICAgICAgICAgIH07XHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxufVxyXG4pLmRpcmVjdGl2ZSgnd2luZG93RXhpdCcsIFsnYXV0aFNlcnZpY2UnLCAnJHdpbmRvdycsICckbG9jYXRpb24nLCAnJHJvb3RTY29wZScsIGZ1bmN0aW9uIChhdXRoU2VydmljZSwgJHdpbmRvdywgJGxvY2F0aW9uLCAkcm9vdFNjb3BlKSB7XHJcbiAgICByZXR1cm4ge1xyXG4gICAgICAgIHJlc3RyaWN0OiAnQUUnLFxyXG4gICAgICAgIGxpbms6IGZ1bmN0aW9uIChlbGVtZW50LCBhdHRycykge1xyXG4gICAgICAgICAgICB2YXIgbXlFdmVudCA9ICR3aW5kb3cuYXR0YWNoRXZlbnQgfHwgJHdpbmRvdy5hZGRFdmVudExpc3RlbmVyLFxyXG4gICAgICAgICAgICBjaGtldmVudCA9ICR3aW5kb3cuYXR0YWNoRXZlbnQgPyAnb25iZWZvcmV1bmxvYWQnIDogJ2JlZm9yZXVubG9hZCc7IC8vLyBtYWtlIElFNywgSUU4IGNvbXBhdGFibGVcclxuXHJcbiAgICAgICAgICAgIG15RXZlbnQoJ3VubG9hZCcsIGZ1bmN0aW9uIChlKSB7XHJcbiAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICBteUV2ZW50KGNoa2V2ZW50LCBmdW5jdGlvbiAoZSkgeyAvLyBGb3IgPj1JRTcsIENocm9tZSwgRmlyZWZveFxyXG4gICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICAgICBpZiAoJGxvY2F0aW9uLiQkdXJsID09PSBcIi9sb2dpblwiIHx8ICgkcm9vdFNjb3BlLmlzRmVlZGJhY2sgIT09IHVuZGVmaW5lZCAmJiAkcm9vdFNjb3BlLmlzRmVlZGJhY2spKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgJHJvb3RTY29wZS5pc0ZlZWRiYWNrID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgaWYgKHdpbmRvdy5hcHBSZWxvYWQgIT09IHVuZGVmaW5lZCAmJiB3aW5kb3cuYXBwUmVsb2FkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgd2luZG93LmFwcFJlbG9hZCA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIHZhciBjb25maXJtYXRpb25NZXNzYWdlID0gJyc7ICAvLyBhIHNwYWNlXHJcbiAgICAgICAgICAgICAgICAoZSB8fCAkd2luZG93LmV2ZW50KS5yZXR1cm5WYWx1ZSA9IFwiQXJlIHlvdSBzdXJlIHRoYXQgeW91J2QgbGlrZSB0byBjbG9zZSB0aGUgYnJvd3Nlcj9cIjtcclxuICAgICAgICAgICAgICAgIHJldHVybiBjb25maXJtYXRpb25NZXNzYWdlO1xyXG4gICAgICAgICAgICB9KTtcclxuXHJcblxyXG5cclxuXHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxufV0pLmRpcmVjdGl2ZSgnZm9jdXNNZScsIGZ1bmN0aW9uICgkdGltZW91dCwgJHBhcnNlKSB7XHJcbiAgICByZXR1cm4ge1xyXG4gICAgICAgIGxpbms6IGZ1bmN0aW9uIChzY29wZSwgZWxlbWVudCwgYXR0cnMpIHtcclxuICAgICAgICAgICAgdmFyIG1vZGVsID0gJHBhcnNlKGF0dHJzLmZvY3VzTWUpO1xyXG4gICAgICAgICAgICBzY29wZS4kd2F0Y2gobW9kZWwsIGZ1bmN0aW9uICh2YWx1ZSkge1xyXG4gICAgICAgICAgICAgICAgdmFyIGl0ZW1Gb2N1cyA9IHNjb3BlLml0ZW1zW3Njb3BlLmZpZWxkSW5kZXhdLnRlbXBsYXRlT3B0aW9ucy5mb2N1cztcclxuICAgICAgICAgICAgICAgIGlmIChpdGVtRm9jdXMgIT09IHVuZGVmaW5lZCAmJiB2YWx1ZSA9PT0gdHJ1ZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIC8vIGVsZW1lbnRbMF0uZm9jdXMoKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSwgdHJ1ZSk7XHJcblxyXG4gICAgICAgICAgICBzY29wZS4kb24oJ1NFVC1GT0NVUycsIGZ1bmN0aW9uIChldmVudCwgdmFsdWUpIHtcclxuICAgICAgICAgICAgICAgIHZhciBpdGVtRm9jdXMgPSBzY29wZS5pdGVtc1tzY29wZS5maWVsZEluZGV4XS50ZW1wbGF0ZU9wdGlvbnMuZm9jdXM7XHJcbiAgICAgICAgICAgICAgICBpZiAoaXRlbUZvY3VzICE9PSB1bmRlZmluZWQgJiYgdmFsdWUgPT09IHRydWUpIHtcclxuICAgICAgICAgICAgICAgICAgICBzY29wZS5pdGVtLnNldEZvY3VzID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgICAgICBzY29wZS5pdGVtLnNldEZvY3VzQmx1ciA9IHRydWU7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGlmIChzY29wZS5pdGVtLnR5cGUgIT09IHVuZGVmaW5lZCAmJiBzY29wZS5pdGVtLnR5cGUudG9Mb3dlckNhc2UoKSA9PT0gJ3NlbGVjdCcpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICQoZWxlbWVudFswXSkuZmluZCgnaW5wdXQnKVswXS5mb2N1cygpO1xyXG4gICAgICAgICAgICAgICAgICAgIGVsc2VcclxuICAgICAgICAgICAgICAgICAgICAgICAgZWxlbWVudFswXS5mb2N1cygpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgc2NvcGUuaXRlbS5zZXRGb2N1c0JsdXIgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgICAgICB9LCAxMDApXHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgZWxlbWVudC5iaW5kKCdibHVyJywgZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgaWYgKHNjb3BlLml0ZW0udGVtcGxhdGVPcHRpb25zLmZvY3VzICE9PSB1bmRlZmluZWQpXHJcbiAgICAgICAgICAgICAgICAgICAgc2NvcGUuJGFwcGx5KG1vZGVsLmFzc2lnbihzY29wZSwgZmFsc2UpKTtcclxuICAgICAgICAgICAgfSlcclxuICAgICAgICB9XHJcbiAgICB9O1xyXG59KS5kaXJlY3RpdmUoJ25nRXNjJywgZnVuY3Rpb24gKCR0aW1lb3V0LCAkcGFyc2UpIHtcclxuICAgIHJldHVybiB7XHJcbiAgICAgICAgbGluazogZnVuY3Rpb24gKHNjb3BlLCBlbGVtZW50LCBhdHRycykge1xyXG4gICAgICAgICAgICBlbGVtZW50LmJpbmQoXCJrZXlkb3duIGtleXByZXNzIGtleXVwXCIsIGZ1bmN0aW9uIChldmVudCkge1xyXG4gICAgICAgICAgICAgICAgaWYgKGV2ZW50LndoaWNoID09PSAyNykge1xyXG4gICAgICAgICAgICAgICAgICAgIHNjb3BlLiRhcHBseShmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHNjb3BlLiRldmFsKGF0dHJzLm5nRXNjKTtcclxuICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KVxyXG4gICAgICAgIH1cclxuICAgIH07XHJcbn0pOyIsIlwidXNlIHN0cmljdFwiO1xyXG5hbmd1bGFyLm1vZHVsZSgnYXBwJykuZGlyZWN0aXZlKCdjb21wYXJlVG8nLCBbJyR0aW1lb3V0JywgJ2RhdGFzZXJ2aWNlJywgJyRjb21waWxlJywgJyRodHRwJywgJyRyb290U2NvcGUnLCAnJHBhcnNlJyxcclxuZnVuY3Rpb24gKCR0aW1lb3V0LCBkYXRhc2VydmljZSwgJGNvbXBpbGUsICRodHRwLCAkcm9vdFNjb3BlLCAkcGFyc2UpIHtcclxuICAgIHJldHVybiB7XHJcbiAgICAgICAgcmVxdWlyZTogWydeP25hdmNvbkZvcm0nLCAnXm5nTW9kZWwnXSxcclxuICAgICAgICBsaW5rOiBmdW5jdGlvbiAoc2NvcGUsIGVsZW1lbnQsIGF0dHJzLCBjdHJsKSB7XHJcbiAgICAgICAgICAgIHZhciBmaWVsZCA9IGN0cmxbMV07XHJcbiAgICAgICAgICAgIHZhciBtb2RlbCA9ICRwYXJzZShhdHRycy5jb21wYXJlVG8pO1xyXG5cclxuICAgICAgICAgICAgdmFyIGNvbXBhcmVUb0ZpZWxkID0gc2NvcGUuaXRlbXNbc2NvcGUuZmllbGRJbmRleF0udGVtcGxhdGVPcHRpb25zLmNvbXBhcmVUbztcclxuICAgICAgICAgICAgaWYgKGNvbXBhcmVUb0ZpZWxkID09PSB1bmRlZmluZWQpIHJldHVybjtcclxuICAgICAgICAgICAgc2NvcGUuY29tcGFyZVRvRmllbGQgPSBjb21wYXJlVG9GaWVsZDtcclxuICAgICAgICAgICAgdmFyIGNvbXBhcmVCeSA9IHNjb3BlLml0ZW1zW3Njb3BlLmZpZWxkSW5kZXhdLnRlbXBsYXRlT3B0aW9ucy5jb21wYXJlQnk7XHJcbiAgICAgICAgICAgIGlmIChjb21wYXJlQnkgPT09IHVuZGVmaW5lZCB8fCBjb21wYXJlQnkgPT09IFwiXCIpIGNvbXBhcmVCeSA9IFwiPVwiO1xyXG5cclxuICAgICAgICAgICAgdmFyIGNvbXBhcmVUb0ZpZWxkSW5kZXggPSBuYXZjb24uZ2V0SXRlbUluZGV4QnlQcm9wZXJ0eShzY29wZS5pdGVtcywgc2NvcGUuY29tcGFyZVRvRmllbGQpO1xyXG4gICAgICAgICAgICBlbGVtZW50LmJpbmQoJ2JsdXInLCBmdW5jdGlvbiAoZSkge1xyXG4gICAgICAgICAgICAgICAgdmFyIGN1cnJlbnRWYWx1ZSA9IGVsZW1lbnQudmFsKCk7XHJcbiAgICAgICAgICAgICAgICB2YXIgcmV0VmFsaWQgPSBjb21wYXJlVmFsaWRhdGUoc2NvcGUuaXRlbXNbY29tcGFyZVRvRmllbGRJbmRleF0uZGF0YSwgY3VycmVudFZhbHVlLCBjb21wYXJlQnkpXHJcbiAgICAgICAgICAgICAgICBmaWVsZC4kc2V0VmFsaWRpdHkoXCJjb21wYXJlVG9cIiwgcmV0VmFsaWQpO1xyXG4gICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgIHNjb3BlLiR3YXRjaChcIml0ZW1zW1wiICsgY29tcGFyZVRvRmllbGRJbmRleCArIFwiXS5kYXRhXCIsIGZ1bmN0aW9uICh2YWx1ZSkge1xyXG4gICAgICAgICAgICAgICAgaWYgKHNjb3BlLml0ZW1zW3Njb3BlLmZpZWxkSW5kZXhdLmRhdGEgPT09IFwiXCIpIHJldHVybjtcclxuICAgICAgICAgICAgICAgIHZhciBmcm9tID0gdmFsdWU7XHJcbiAgICAgICAgICAgICAgICB2YXIgdG8gPSBzY29wZS5pdGVtc1tzY29wZS5maWVsZEluZGV4XS5kYXRhO1xyXG4gICAgICAgICAgICAgICAgdmFyIHJldFZhbGlkID0gY29tcGFyZVZhbGlkYXRlKGZyb20sIHRvLCBjb21wYXJlQnkpXHJcbiAgICAgICAgICAgICAgICBmaWVsZC4kc2V0VmFsaWRpdHkoXCJjb21wYXJlVG9cIiwgcmV0VmFsaWQpO1xyXG4gICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgIGZ1bmN0aW9uIGNvbXBhcmVWYWxpZGF0ZShmcm9tLCB0bywgY29tcGFyZUJ5KSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgdmFsaWRpdHkgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgaWYgKGNvbXBhcmVCeSA9PT0gXCI8XCIpIHtcclxuICAgICAgICAgICAgICAgICAgICB2YWxpZGl0eSA9IChwYXJzZUludCh0bykgPCBwYXJzZUludChmcm9tKSA/IGZhbHNlIDogdHJ1ZSk7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGNvbXBhcmVCeSA9PT0gXCI+XCIpIHtcclxuICAgICAgICAgICAgICAgICAgICB2YWxpZGl0eSA9IChwYXJzZUludCh0bykgPiBwYXJzZUludChmcm9tKSA/IGZhbHNlIDogdHJ1ZSk7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGNvbXBhcmVCeSA9PT0gXCI+PVwiKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFsaWRpdHkgPSAocGFyc2VJbnQodG8pID49IHBhcnNlSW50KGZyb20pID8gZmFsc2UgOiB0cnVlKTtcclxuICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoY29tcGFyZUJ5ID09PSBcIjw9XCIpIHtcclxuICAgICAgICAgICAgICAgICAgICB2YWxpZGl0eSA9IChwYXJzZUludCh0bykgPD0gcGFyc2VJbnQoZnJvbSkgPyBmYWxzZSA6IHRydWUpO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmIChjb21wYXJlQnkgPT09IFwiIT1cIikge1xyXG4gICAgICAgICAgICAgICAgICAgIHZhbGlkaXR5ID0gKHRvICE9PSBmcm9tID8gZmFsc2UgOiB0cnVlKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIHZhbGlkaXR5ID0gKHRvID09PSBmcm9tID8gZmFsc2UgOiB0cnVlKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIHJldHVybiB2YWxpZGl0eTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH07XHJcbn1dKS5kaXJlY3RpdmUoXCJjb21wYXJlRGF0ZVwiLCBbJyR0aW1lb3V0JywgJ2RhdGFzZXJ2aWNlJywgJyRjb21waWxlJywgJyRodHRwJywgJyRyb290U2NvcGUnLCAnJHBhcnNlJywgZnVuY3Rpb24gKCR0aW1lb3V0LCBkYXRhc2VydmljZSwgJGNvbXBpbGUsICRodHRwLCAkcm9vdFNjb3BlLCAkcGFyc2UpIHtcclxuICAgIHJldHVybiB7XHJcbiAgICAgICAgcmVxdWlyZTogWydebmF2Y29uRm9ybScsICdebmdNb2RlbCddLFxyXG4gICAgICAgIGxpbms6IGZ1bmN0aW9uIChzY29wZSwgZWxlbWVudCwgYXR0cnMsIGN0cmwpIHtcclxuICAgICAgICAgICAgdmFyIGZpZWxkID0gY3RybFsxXTtcclxuICAgICAgICAgICAgc2NvcGUuaXRlbXMgPSBjdHJsWzBdLmdldEZpZWxkSXRlbXMoKTtcclxuXHJcbiAgICAgICAgICAgIHZhciBtb2RlbCA9ICRwYXJzZShhdHRycy5jb21wYXJlRGF0ZSk7XHJcblxyXG4gICAgICAgICAgICBzY29wZS5jb21wYXJlRGF0ZVRvID0gc2NvcGUuaXRlbXNbc2NvcGUuZmllbGRJbmRleF0udGVtcGxhdGVPcHRpb25zLmNvbXBhcmVEYXRlVG87XHJcbiAgICAgICAgICAgIHNjb3BlLmNvbXBhcmVEYXRlQnkgPSBzY29wZS5pdGVtc1tzY29wZS5maWVsZEluZGV4XS50ZW1wbGF0ZU9wdGlvbnMuY29tcGFyZURhdGVCeTtcclxuICAgICAgICAgICAgc2NvcGUuY29tcGFyZURhdGVUb2RheSA9IHNjb3BlLml0ZW1zW3Njb3BlLmZpZWxkSW5kZXhdLnRlbXBsYXRlT3B0aW9ucy5jb21wYXJlRGF0ZVRvZGF5O1xyXG5cclxuICAgICAgICAgICAgaWYgKHNjb3BlLmNvbXBhcmVEYXRlQnkgIT09IHVuZGVmaW5lZCAmJiBBcnJheS5pc0FycmF5KHNjb3BlLmNvbXBhcmVEYXRlQnkpKSB7XHJcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhcIm11bHRpcGxlXCIpO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgaWYgKHNjb3BlLmNvbXBhcmVEYXRlVG8gPT09IHVuZGVmaW5lZCAmJiAoc2NvcGUuY29tcGFyZURhdGVUb2RheSA9PT0gdW5kZWZpbmVkICYmICFzY29wZS5jb21wYXJlRGF0ZVRvZGF5KSkgcmV0dXJuO1xyXG4gICAgICAgICAgICAgICAgaWYgKHNjb3BlLmNvbXBhcmVEYXRlQnkgPT09IHVuZGVmaW5lZCkgcmV0dXJuO1xyXG4gICAgICAgICAgICAgICAgdmFyIGNvbXBhcmVEYXRlVG9JbmRleCA9IG5hdmNvbi5nZXRJdGVtSW5kZXhCeVByb3BlcnR5KHNjb3BlLml0ZW1zLCBzY29wZS5jb21wYXJlRGF0ZVRvKTtcclxuICAgICAgICAgICAgICAgIHZhciBjb21wYXJlRGF0ZUJ5SW5kZXggPSBuYXZjb24uZ2V0SXRlbUluZGV4QnlQcm9wZXJ0eShzY29wZS5pdGVtcywgc2NvcGUuY29tcGFyZURhdGVCeSk7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIHZhciBnZXRUaW1lRGF0ZSA9IGZ1bmN0aW9uICh2YWx1ZSkge1xyXG4gICAgICAgICAgICAgICAgaWYgKHZhbHVlID09PSB1bmRlZmluZWQpIHJldHVybjtcclxuICAgICAgICAgICAgICAgIHZhciB0b2RheSA9IG5hdmNvbi5kYXRlRm9ybWF0KG1vbWVudCgpLmZvcm1hdChcIkREL01NL1lZWVlcIikpO1xyXG4gICAgICAgICAgICAgICAgdmFyIGhycyA9IHZhbHVlLnRyaW0oKS5zdWJzdHIoMCwgMik7XHJcbiAgICAgICAgICAgICAgICB2YXIgbWlucyA9IHZhbHVlLnRyaW0oKS5zdWJzdHIoMywgMik7XHJcbiAgICAgICAgICAgICAgICB2YXIgZGF0ZSA9IG1vbWVudCh0b2RheSkuYWRkKGhycywgJ2hvdXJzJyk7XHJcbiAgICAgICAgICAgICAgICBkYXRlID0gbW9tZW50KGRhdGUpLmFkZChtaW5zLCAnbWludXRlcycpO1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGRhdGVcclxuICAgICAgICAgICAgfVxyXG5cclxuXHJcbiAgICAgICAgICAgIHNjb3BlLiR3YXRjaChtb2RlbCwgZnVuY3Rpb24gKHZhbHVlKSB7XHJcbiAgICAgICAgICAgICAgICBmaWVsZC4kdmFsaWRhdGUoKTtcclxuICAgICAgICAgICAgICAgIGZpZWxkLiR2YWxpZGF0b3JzLmNvbXBhcmVEYXRlID0gZnVuY3Rpb24gKG1vZGVsVmFsdWUpIHtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgZnJvbURhdGUgPSBuYXZjb24uZGF0ZUZvcm1hdChtb2RlbFZhbHVlKTtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgdG9EYXRlO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChzY29wZS5jb21wYXJlRGF0ZUJ5ICE9PSB1bmRlZmluZWQgJiYgQXJyYXkuaXNBcnJheShzY29wZS5jb21wYXJlRGF0ZUJ5KSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgcmV0VmFsdWUgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBpID0gMCwgbGVuID0gc2NvcGUuY29tcGFyZURhdGVCeS5sZW5ndGg7IGkgPCBsZW47IGkrKykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGl0ZW0gPSBzY29wZS5jb21wYXJlRGF0ZUJ5W2ldO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHNjb3BlLml0ZW0gIT09IHVuZGVmaW5lZCAmJiBpdGVtLmNvbmRpdGlvbiAhPT0gdW5kZWZpbmVkICYmIGl0ZW0udG8gIT09IHVuZGVmaW5lZCAmJiBpdGVtLm1lc3NhZ2UgIT09IHVuZGVmaW5lZCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciB0b0luZGV4ID0gbmF2Y29uLmdldEl0ZW1JbmRleEJ5UHJvcGVydHkoc2NvcGUuaXRlbXMsIGl0ZW0udG8pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNjb3BlLml0ZW0udGVtcGxhdGVPcHRpb25zLmNvbXBhcmVEYXRlTWVzc2FnZSA9IGl0ZW0ubWVzc2FnZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoaXRlbS50byA9PT0gXCJ0b2RheVwiKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b0RhdGUgPSBuYXZjb24uZGF0ZUZvcm1hdChtb21lbnQoKS5mb3JtYXQoXCJERC9NTS9ZWVlZXCIpKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlIGlmIChzY29wZS5pdGVtICE9PSB1bmRlZmluZWQgJiYgc2NvcGUuaXRlbS50eXBlICE9PSB1bmRlZmluZWQgJiYgc2NvcGUuaXRlbS50eXBlID09PSBcImRhdGV0aW1lXCIpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdG9EYXRlID0gZ2V0VGltZURhdGUoc2NvcGUuaXRlbXNbdG9JbmRleF0uZGF0YSk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRvRGF0ZSA9IG5hdmNvbi5kYXRlRm9ybWF0KHNjb3BlLml0ZW1zW3RvSW5kZXhdLmRhdGEpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZyb21EYXRlID0gbmF2Y29uLmRhdGVGb3JtYXQobW9kZWxWYWx1ZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHJldFZhbHVlID0gZGF0ZVZhbGlkYXRlKGZyb21EYXRlLCB0b0RhdGUsIGl0ZW0uY29uZGl0aW9uKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAocmV0VmFsdWUgPT09IGZhbHNlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgZmllbGRJdGVtID0gc2NvcGUuaXRlbXNbc2NvcGUuZmllbGRJbmRleF07XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChmaWVsZEl0ZW0gIT09IHVuZGVmaW5lZCAmJiBmaWVsZEl0ZW0uZm9ybSAhPT0gdW5kZWZpbmVkICYmIGZpZWxkSXRlbS5mb3JtW2ZpZWxkSXRlbS5rZXldICE9PSB1bmRlZmluZWQgJiYgZmllbGRJdGVtLmZvcm1bZmllbGRJdGVtLmtleV0uJHNldFZhbGlkaXR5ICE9PSB1bmRlZmluZWQgJiYgdHlwZW9mIGZpZWxkSXRlbS5mb3JtW2ZpZWxkSXRlbS5rZXldLiRzZXRWYWxpZGl0eSA9PT0gXCJmdW5jdGlvblwiKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkdGltZW91dChmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZmllbGRJdGVtLmZvcm1bZmllbGRJdGVtLmtleV0uJHNldFZhbGlkaXR5KCdjb21wYXJlRGF0ZScsIHJldFZhbHVlKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJldFZhbHVlO1xyXG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChzY29wZS5jb21wYXJlRGF0ZVRvZGF5ICE9PSB1bmRlZmluZWQgJiYgc2NvcGUuY29tcGFyZURhdGVUb2RheSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRvRGF0ZSA9IG5hdmNvbi5kYXRlRm9ybWF0KG1vbWVudCgpLmZvcm1hdChcIkREL01NL1lZWVlcIikpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBlbHNlIGlmIChzY29wZS5pdGVtICE9PSB1bmRlZmluZWQgJiYgc2NvcGUuaXRlbS50eXBlICE9PSB1bmRlZmluZWQgJiYgc2NvcGUuaXRlbS50eXBlID09PSBcImRhdGV0aW1lXCIpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRvRGF0ZSA9IGdldFRpbWVEYXRlKHNjb3BlLml0ZW1zW2NvbXBhcmVEYXRlVG9JbmRleF0uZGF0YSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmcm9tRGF0ZSA9IGdldFRpbWVEYXRlKG1vZGVsVmFsdWUpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2VcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRvRGF0ZSA9IG5hdmNvbi5kYXRlRm9ybWF0KHNjb3BlLml0ZW1zW2NvbXBhcmVEYXRlVG9JbmRleF0uZGF0YSk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgcmV0VmFsID0gZGF0ZVZhbGlkYXRlKGZyb21EYXRlLCB0b0RhdGUsIHNjb3BlLmNvbXBhcmVEYXRlQnkpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgZmllbGRJdGVtID0gc2NvcGUuaXRlbXNbc2NvcGUuZmllbGRJbmRleF07XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChmaWVsZEl0ZW0gIT09IHVuZGVmaW5lZCAmJiBmaWVsZEl0ZW0uZm9ybSAhPT0gdW5kZWZpbmVkICYmIGZpZWxkSXRlbS5mb3JtW2ZpZWxkSXRlbS5rZXldICE9PSB1bmRlZmluZWQgJiYgZmllbGRJdGVtLmZvcm1bZmllbGRJdGVtLmtleV0uJHNldFZhbGlkaXR5ICE9PSB1bmRlZmluZWQgJiYgdHlwZW9mIGZpZWxkSXRlbS5mb3JtW2ZpZWxkSXRlbS5rZXldLiRzZXRWYWxpZGl0eSA9PT0gXCJmdW5jdGlvblwiKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkdGltZW91dChmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGZpZWxkSXRlbS5mb3JtW2ZpZWxkSXRlbS5rZXldICE9IHVuZGVmaW5lZClcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZmllbGRJdGVtLmZvcm1bZmllbGRJdGVtLmtleV0uJHNldFZhbGlkaXR5KCdjb21wYXJlRGF0ZScsIHJldFZhbCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiByZXRWYWw7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgIHNjb3BlLiR3YXRjaChcIml0ZW1zW1wiICsgY29tcGFyZURhdGVUb0luZGV4ICsgXCJdLmRhdGFcIiwgZnVuY3Rpb24gKHZhbHVlKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoc2NvcGUuaXRlbXNbc2NvcGUuZmllbGRJbmRleF0uZGF0YSA9PT0gdW5kZWZpbmVkIHx8IHNjb3BlLml0ZW1zW3Njb3BlLmZpZWxkSW5kZXhdLmRhdGEgPT09IFwiXCIpIHJldHVybjtcclxuICAgICAgICAgICAgICAgIHZhciBmcm9tRGF0ZSA9IG5hdmNvbi5kYXRlRm9ybWF0KHNjb3BlLml0ZW1zW3Njb3BlLmZpZWxkSW5kZXhdLmRhdGEpO1xyXG4gICAgICAgICAgICAgICAgdmFyIHRvRGF0ZSA9IG5hdmNvbi5kYXRlRm9ybWF0KHZhbHVlKTtcclxuICAgICAgICAgICAgICAgIGlmIChzY29wZS5pdGVtICE9PSB1bmRlZmluZWQgJiYgc2NvcGUuaXRlbS50eXBlICE9PSB1bmRlZmluZWQgJiYgc2NvcGUuaXRlbS50eXBlID09PSBcImRhdGV0aW1lXCIpIHtcclxuICAgICAgICAgICAgICAgICAgICB0b0RhdGUgPSBnZXRUaW1lRGF0ZSh2YWx1ZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgZnJvbURhdGUgPSBnZXRUaW1lRGF0ZShzY29wZS5pdGVtc1tzY29wZS5maWVsZEluZGV4XS5kYXRhKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGZpZWxkLiRzZXRWYWxpZGl0eShcImNvbXBhcmVEYXRlXCIsIGRhdGVWYWxpZGF0ZShmcm9tRGF0ZSwgdG9EYXRlLCBzY29wZS5jb21wYXJlRGF0ZUJ5KSk7XHJcbiAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgZnVuY3Rpb24gZGF0ZVZhbGlkYXRlKGZyb21EYXRlLCB0b0RhdGUsIGNvbXBhcmVEYXRlQnkpIHtcclxuICAgICAgICAgICAgICAgIHZhciB2YWxpZGl0eSA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICBpZiAoZnJvbURhdGUuX2kgIT09IHVuZGVmaW5lZCAmJiBmcm9tRGF0ZS5faSA9PT0gXCJcIikgcmV0dXJuIHZhbGlkaXR5O1xyXG4gICAgICAgICAgICAgICAgaWYgKGNvbXBhcmVEYXRlQnkgPT09IFwiPFwiKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFsaWRpdHkgPSAobW9tZW50KGZyb21EYXRlKS5pc0JlZm9yZSh0b0RhdGUpID8gZmFsc2UgOiB0cnVlKTtcclxuICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoY29tcGFyZURhdGVCeSA9PT0gXCI+XCIpIHtcclxuICAgICAgICAgICAgICAgICAgICB2YWxpZGl0eSA9IChtb21lbnQoZnJvbURhdGUpLmlzQWZ0ZXIodG9EYXRlKSA/IGZhbHNlIDogdHJ1ZSk7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGNvbXBhcmVEYXRlQnkgPT09IFwidG9kYXlcIikge1xyXG4gICAgICAgICAgICAgICAgICAgIHZhbGlkaXR5ID0gKG1vbWVudCgpLmRpZmYoZnJvbURhdGUsICdkYXknKSA+IDAgPyBmYWxzZSA6IHRydWUpO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmIChjb21wYXJlRGF0ZUJ5ID09PSBcIjw9XCIpIHtcclxuICAgICAgICAgICAgICAgICAgICB2YWxpZGl0eSA9IChtb21lbnQoZnJvbURhdGUpLmlzU2FtZSh0b0RhdGUpIHx8IG1vbWVudChmcm9tRGF0ZSkuaXNCZWZvcmUodG9EYXRlKSkgPyBmYWxzZSA6IHRydWU7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGNvbXBhcmVEYXRlQnkgPT09IFwiPj1cIikge1xyXG4gICAgICAgICAgICAgICAgICAgIHZhbGlkaXR5ID0gKG1vbWVudChmcm9tRGF0ZSkuaXNTYW1lKHRvRGF0ZSkgfHwgbW9tZW50KGZyb21EYXRlKS5pc0FmdGVyKHRvRGF0ZSkpID8gZmFsc2UgOiB0cnVlO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgZWxzZSB7XHJcblxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHZhbGlkaXR5O1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgIH1cclxuICAgIH07XHJcbn1dKS5kaXJlY3RpdmUoXCJpc0V4aXN0XCIsIFsnJHRpbWVvdXQnLCAnZGF0YXNlcnZpY2UnLCAnJGNvbXBpbGUnLCAnJGh0dHAnLCAnJHJvb3RTY29wZScsICckcGFyc2UnLCBmdW5jdGlvbiAoJHRpbWVvdXQsIGRhdGFzZXJ2aWNlLCAkY29tcGlsZSwgJGh0dHAsICRyb290U2NvcGUsICRwYXJzZSkge1xyXG4gICAgcmV0dXJuIHtcclxuICAgICAgICByZXF1aXJlOiBbJ15uYXZjb25Gb3JtJywgJ15uZ01vZGVsJ10sXHJcbiAgICAgICAgbGluazogZnVuY3Rpb24gKHNjb3BlLCBlbGVtZW50LCBhdHRycywgY3RybCkge1xyXG4gICAgICAgICAgICBlbGVtZW50LmJpbmQoJ2JsdXInLCBmdW5jdGlvbiAoZSkge1xyXG4gICAgICAgICAgICAgICAgdmFyIGZpZWxkID0gY3RybFsxXTtcclxuXHJcbiAgICAgICAgICAgICAgICBpZiAoY3RybFswXSAhPT0gbnVsbCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHNjb3BlLml0ZW1zID0gY3RybFswXS5nZXRGaWVsZEl0ZW1zKCk7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChzY29wZS5maWVsZERhdGEgIT09IHVuZGVmaW5lZClcclxuICAgICAgICAgICAgICAgICAgICAgICAgc2NvcGUuaXRlbXMgPSBzY29wZS5maWVsZERhdGE7XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgdmFyIG1vZGVsID0gJHBhcnNlKGF0dHJzLklzRXhpc3QpO1xyXG4gICAgICAgICAgICAgICAgdmFyIGN1cnJlbnRWYWx1ZSA9IGVsZW1lbnQudmFsKCk7XHJcbiAgICAgICAgICAgICAgICBzY29wZS5Jc0V4aXN0S2V5ID0gc2NvcGUuaXRlbXNbc2NvcGUuZmllbGRJbmRleF0ua2V5O1xyXG4gICAgICAgICAgICAgICAgc2NvcGUuSXNFeGlzdERhdGEgPSBzY29wZS5pdGVtc1tzY29wZS5maWVsZEluZGV4XS50ZW1wbGF0ZU9wdGlvbnMuaXNFeGlzdERhdGE7XHJcbiAgICAgICAgICAgICAgICBzY29wZS5Jc0V4aXN0VHJlZUlkID0gc2NvcGUuaXRlbXNbc2NvcGUuZmllbGRJbmRleF0udGVtcGxhdGVPcHRpb25zLmlzRXhpc3RUcmVlSWQ7XHJcblxyXG4gICAgICAgICAgICAgICAgaWYgKHNjb3BlLml0ZW1zW3Njb3BlLmZpZWxkSW5kZXhdLnRlbXBsYXRlT3B0aW9ucy5kZXBlbmRGaWVsZEtleSAhPT0gdW5kZWZpbmVkICYmIHNjb3BlLml0ZW1zW3Njb3BlLmZpZWxkSW5kZXhdLnRlbXBsYXRlT3B0aW9ucy5kZXBlbmRGaWVsZEtleSAhPT0gXCJcIilcclxuICAgICAgICAgICAgICAgICAgICBzY29wZS5kZXBlbmRGaWVsZEtleSA9IHNjb3BlLml0ZW1zW3Njb3BlLmZpZWxkSW5kZXhdLnRlbXBsYXRlT3B0aW9ucy5kZXBlbmRGaWVsZEtleTtcclxuXHJcbiAgICAgICAgICAgICAgICBpZiAoc2NvcGUuSXNFeGlzdEtleSA9PT0gdW5kZWZpbmVkKSByZXR1cm47XHJcbiAgICAgICAgICAgICAgICBpZiAoc2NvcGUuSXNFeGlzdERhdGEgPT09IHVuZGVmaW5lZCkgcmV0dXJuO1xyXG4gICAgICAgICAgICAgICAgaWYgKGN1cnJlbnRWYWx1ZSA9PT0gdW5kZWZpbmVkIHx8IGN1cnJlbnRWYWx1ZSA9PT0gXCJcIikgcmV0dXJuIHRydWU7XHJcblxyXG4gICAgICAgICAgICAgICAgc2NvcGUuZGF0YSA9IGN0cmxbMF0uZ2V0SXRlbSgoc2NvcGUuSXNFeGlzdERhdGEpKTtcclxuXHJcbiAgICAgICAgICAgICAgICBpZiAoc2NvcGUuaXRlbXMuZ2V0QnlJZCAhPT0gdW5kZWZpbmVkICYmIHNjb3BlLml0ZW1zLmdldEJ5SWQgIT09IG51bGwgJiYgKHNjb3BlLmRhdGEgPT09IHVuZGVmaW5lZCB8fCBzY29wZS5kYXRhID09PSBudWxsKSkgc2NvcGUuZGF0YSA9IHNjb3BlLml0ZW1zLmdldEJ5SWQ7XHJcbiAgICAgICAgICAgICAgICBpZiAoc2NvcGUuSXNFeGlzdFRyZWVJZCAhPT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIHBhcmVudCA9IGN0cmxbMF0uZ2V0SXRlbSgoc2NvcGUuSXNFeGlzdFRyZWVJZCkpO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChwYXJlbnQucGFyZW50ICE9PSB1bmRlZmluZWQgJiYgcGFyZW50LnBhcmVudCAhPT0gXCJcIiAmJiBwYXJlbnQucGFyZW50ICE9PSBcIjBcIikgey8vICYmIHBhcmVudC5wYXJlbnQgIT09IFwiI1wiKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAocGFyZW50LnBhcmVudCA9PT0gXCIjXCIpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgY2hpbGREYXRhID0gc2NvcGUuZGF0YTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgZWxzZVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy92YXIgY2hpbGREYXRhID0gbmF2Y29uLmdldFRyZWVEYXRhQnlJZChzY29wZS5kYXRhLCBwYXJlbnQucGFyZW50LCBcImNoaWxkXCIpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGNoaWxkRGF0YSA9IG5hdmNvbi5nZXRUcmVlRGF0YUJ5SWQoc2NvcGUuZGF0YSwgcGFyZW50LmlkLCBcImNoaWxkXCIpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBpZiAoY2hpbGREYXRhICE9PSB1bmRlZmluZWQgJiYgY2hpbGREYXRhICE9PSBudWxsKSBzY29wZS5kYXRhID0gY2hpbGREYXRhO1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIHZhciByZXRWYWwgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgdmFyIG9sZFNEYXRhVmFsdWUgPSBcIlwiO1xyXG5cclxuXHJcbiAgICAgICAgICAgICAgICBpZiAoc2NvcGUuaXRlbXNbc2NvcGUuZmllbGRJbmRleF0udHlwZSA9PSBcIm51bWJlclwiKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgY3VycmVudFZhbHVlID0gcGFyc2VJbnQoY3VycmVudFZhbHVlLnRvU3RyaW5nKCkudHJpbSgpKTtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoc2NvcGUuaXRlbXNbc2NvcGUuZmllbGRJbmRleF0ub2xkRGF0YSA9PSB1bmRlZmluZWQgfHwgc2NvcGUuaXRlbXNbc2NvcGUuZmllbGRJbmRleF0ub2xkRGF0YSA9PSBudWxsIHx8IHNjb3BlLml0ZW1zW3Njb3BlLmZpZWxkSW5kZXhdLm9sZERhdGEgPT0gXCJcIikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBvbGRTRGF0YVZhbHVlID0gMDtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgZWxzZVxyXG4gICAgICAgICAgICAgICAgICAgICAgICBvbGRTRGF0YVZhbHVlID0gcGFyc2VJbnQoc2NvcGUuaXRlbXNbc2NvcGUuZmllbGRJbmRleF0ub2xkRGF0YSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICBjdXJyZW50VmFsdWUgPSBjdXJyZW50VmFsdWUudG9TdHJpbmcoKS50b0xvd2VyQ2FzZSgpLnRyaW0oKTtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoc2NvcGUuaXRlbXNbc2NvcGUuZmllbGRJbmRleF0ub2xkRGF0YSA9PSB1bmRlZmluZWQgfHwgc2NvcGUuaXRlbXNbc2NvcGUuZmllbGRJbmRleF0ub2xkRGF0YSA9PSBudWxsIHx8IHNjb3BlLml0ZW1zW3Njb3BlLmZpZWxkSW5kZXhdLm9sZERhdGEgPT0gXCJcIilcclxuICAgICAgICAgICAgICAgICAgICAgICAgb2xkU0RhdGFWYWx1ZSA9IFwiXCI7XHJcbiAgICAgICAgICAgICAgICAgICAgZWxzZVxyXG4gICAgICAgICAgICAgICAgICAgICAgICBvbGRTRGF0YVZhbHVlID0gc2NvcGUuaXRlbXNbc2NvcGUuZmllbGRJbmRleF0ub2xkRGF0YS50b1N0cmluZygpLnRvTG93ZXJDYXNlKCkudHJpbSgpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuXHJcbiAgICAgICAgICAgICAgICBpZiAoc2NvcGUuaXRlbXMubW9kZSAhPT0gdW5kZWZpbmVkICYmIHNjb3BlLml0ZW1zLm1vZGUudG9Mb3dlckNhc2UoKSAhPT0gJ3NhdmUnICYmIGN1cnJlbnRWYWx1ZSA9PT0gb2xkU0RhdGFWYWx1ZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldFZhbCA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChzY29wZS5kZXBlbmRGaWVsZEtleSAhPT0gdW5kZWZpbmVkICYmIHNjb3BlLmRlcGVuZEZpZWxkS2V5ICE9PSBcIlwiKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBkZXBlbmRGaWVsZEtleUluZGV4ID0gbmF2Y29uLmdldEl0ZW1JbmRleEJ5UHJvcGVydHkoc2NvcGUuaXRlbXMsIHNjb3BlLmRlcGVuZEZpZWxkS2V5KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGRlcGVuZEZpZWxkS2V5SW5kZXggIT09IC0xKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgZGVwZW5kSXRlbSA9IHNjb3BlLml0ZW1zW2RlcGVuZEZpZWxkS2V5SW5kZXhdO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGRlcGVuZERhdGEgPSBkZXBlbmRJdGVtLmRhdGE7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoZGVwZW5kSXRlbS50eXBlID09PSBcInNlbGVjdFwiKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHNlbGVjdGVkRGF0YSA9IChkZXBlbmRJdGVtLmRhdGFbZGVwZW5kSXRlbS5zZWxlY3RPcHRpb25zLml0ZW0uZGF0YUZpZWxkXSB8fCBkZXBlbmRJdGVtLmRhdGEuSWQgfHwgZGVwZW5kSXRlbS5kYXRhLmlkKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZXBlbmREYXRhID0gKHNlbGVjdGVkRGF0YSAhPT0gdW5kZWZpbmVkICYmIHNlbGVjdGVkRGF0YSAhPT0gXCJcIiA/IHNlbGVjdGVkRGF0YSA6IG51bGwpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIG9iaiA9IHt9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHNjb3BlLml0ZW1zW3Njb3BlLmZpZWxkSW5kZXhdLnR5cGUgPT0gXCJudW1iZXJcIilcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvYmpbc2NvcGUuSXNFeGlzdEtleV0gPSBwYXJzZUludChjdXJyZW50VmFsdWUudG9TdHJpbmcoKS50cmltKCkpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9ialtzY29wZS5Jc0V4aXN0S2V5XSA9IGN1cnJlbnRWYWx1ZS50b1N0cmluZygpLnRyaW0oKTtcclxuXHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgb2JqW3Njb3BlLmRlcGVuZEZpZWxkS2V5XSA9IGRlcGVuZERhdGE7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0VmFsID0gbmF2Y29uLmdldEl0ZW1zRmlsdGVyQnlPYmplY3Qoc2NvcGUuZGF0YSwgb2JqKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAocmV0VmFsICE9PSB1bmRlZmluZWQgJiYgcmV0VmFsLmxlbmd0aCA+IDApXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0VmFsID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0VmFsID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBfY3VycmVudFZhbHVlID0gJyc7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoc2NvcGUuaXRlbXNbc2NvcGUuZmllbGRJbmRleF0udHlwZSA9PSBcIm51bWJlclwiKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBfY3VycmVudFZhbHVlID0gcGFyc2VJbnQoY3VycmVudFZhbHVlLnRvU3RyaW5nKCkudHJpbSgpKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldFZhbCA9IG5hdmNvbi5nZXRJdGVtQnlLZXlWYWx1ZShzY29wZS5kYXRhLCBzY29wZS5Jc0V4aXN0S2V5LCBfY3VycmVudFZhbHVlKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIF9jdXJyZW50VmFsdWUgPSBjdXJyZW50VmFsdWUudG9TdHJpbmcoKS50cmltKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXRWYWwgPSBuYXZjb24uZ2V0SXRlbUJ5S2V5VmFsdWUoc2NvcGUuZGF0YSwgc2NvcGUuSXNFeGlzdEtleSwgX2N1cnJlbnRWYWx1ZS50b0xvd2VyQ2FzZSgpLCB0cnVlKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChyZXRWYWwgIT09IC0xKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0VmFsID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2VcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldFZhbCA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGZpZWxkLiRzZXRWYWxpZGl0eSgnaXNFeGlzdCcsIHJldFZhbCk7XHJcbiAgICAgICAgICAgIH0pXHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxufV0pLmRpcmVjdGl2ZShcImNoZWNrUmVxdWlyZWRcIiwgWyckdGltZW91dCcsICdkYXRhc2VydmljZScsICckY29tcGlsZScsICckaHR0cCcsICckcm9vdFNjb3BlJywgJyRwYXJzZScsIGZ1bmN0aW9uICgkdGltZW91dCwgZGF0YXNlcnZpY2UsICRjb21waWxlLCAkaHR0cCwgJHJvb3RTY29wZSwgJHBhcnNlKSB7XHJcbiAgICByZXR1cm4ge1xyXG4gICAgICAgIHJlcXVpcmU6IFsnXj9uYXZjb25Gb3JtJywgJ15uZ01vZGVsJ10sXHJcbiAgICAgICAgbGluazogZnVuY3Rpb24gKHNjb3BlLCBlbGVtZW50LCBhdHRycywgY3RybCkge1xyXG4gICAgICAgICAgICB2YXIgbmdNb2RlbCA9IGN0cmxbMV07XHJcbiAgICAgICAgICAgIGlmIChjdHJsWzBdICE9PSBudWxsKSB7XHJcbiAgICAgICAgICAgICAgICBzY29wZS5pdGVtcyA9IGN0cmxbMF0uZ2V0RmllbGRJdGVtcygpO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgaWYgKHNjb3BlLmZpZWxkRGF0YSAhPT0gdW5kZWZpbmVkKVxyXG4gICAgICAgICAgICAgICAgICAgIHNjb3BlLml0ZW1zID0gc2NvcGUuZmllbGREYXRhO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIG5nTW9kZWwuJHZhbGlkYXRvcnMuY2hlY2tSZXF1aXJlZCA9IGZ1bmN0aW9uIChtb2RlbFZhbHVlLCB2aWV3VmFsdWUpIHtcclxuICAgICAgICAgICAgICAgIHZhciByZXF1aXJlZCA9IHNjb3BlLml0ZW1zW3Njb3BlLmZpZWxkSW5kZXhdLnRlbXBsYXRlT3B0aW9ucy5yZXF1aXJlZCB8fCBmYWxzZTtcclxuICAgICAgICAgICAgICAgIHZhciB2YWx1ZSA9IG1vZGVsVmFsdWUgfHwgdmlld1ZhbHVlO1xyXG4gICAgICAgICAgICAgICAgdmFyIG1hdGNoID0gc2NvcGUuJGV2YWwoYXR0cnMubmdUcnVlVmFsdWUpIHx8IHRydWU7XHJcbiAgICAgICAgICAgICAgICBpZiAocmVxdWlyZWQgPT09IGZhbHNlIHx8IHJlcXVpcmVkID09PSAnbm8nIHx8IHZhbHVlID09PSBtYXRjaClcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgICAgICAgICAgICAgIGVsc2VcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgICAgIH07XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG59XSkuZGlyZWN0aXZlKFwiZmllbGRSZXF1aXJlZFwiLCBbJyR0aW1lb3V0JywgJ2RhdGFzZXJ2aWNlJywgJyRjb21waWxlJywgJyRodHRwJywgJyRyb290U2NvcGUnLCAnJHBhcnNlJywgZnVuY3Rpb24gKCR0aW1lb3V0LCBkYXRhc2VydmljZSwgJGNvbXBpbGUsICRodHRwLCAkcm9vdFNjb3BlLCAkcGFyc2UpIHtcclxuICAgIHJldHVybiB7XHJcbiAgICAgICAgcmVxdWlyZTogWydeP25hdmNvbkZvcm0nLCAnXm5nTW9kZWwnXSxcclxuICAgICAgICBsaW5rOiBmdW5jdGlvbiAoc2NvcGUsIGVsZW1lbnQsIGF0dHJzLCBjdHJsKSB7XHJcbiAgICAgICAgICAgIHZhciBuZ01vZGVsID0gY3RybFsxXTtcclxuICAgICAgICAgICAgaWYgKGN0cmxbMF0gIT09IG51bGwpIHtcclxuICAgICAgICAgICAgICAgIHNjb3BlLml0ZW1zID0gY3RybFswXS5nZXRGaWVsZEl0ZW1zKCk7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoc2NvcGUuZmllbGREYXRhICE9PSB1bmRlZmluZWQpXHJcbiAgICAgICAgICAgICAgICAgICAgc2NvcGUuaXRlbXMgPSBzY29wZS5maWVsZERhdGE7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgbmdNb2RlbC4kdmFsaWRhdG9ycy5maWVsZFJlcXVpcmVkID0gZnVuY3Rpb24gKG1vZGVsVmFsdWUsIHZpZXdWYWx1ZSkge1xyXG4gICAgICAgICAgICAgICAgdmFyIHJlcXVpcmVkID0gc2NvcGUuaXRlbXNbc2NvcGUuZmllbGRJbmRleCA9PSB1bmRlZmluZWQgPyBzY29wZS4kcGFyZW50LmZpZWxkSW5kZXggOiBzY29wZS5maWVsZEluZGV4XS50ZW1wbGF0ZU9wdGlvbnMucmVxdWlyZWQgfHwgZmFsc2U7XHJcbiAgICAgICAgICAgICAgICB2YXIgdmFsdWUgPSBtb2RlbFZhbHVlIHx8IHZpZXdWYWx1ZTtcclxuXHJcbiAgICAgICAgICAgICAgICBpZiAoKHJlcXVpcmVkID09PSB0cnVlIHx8IHJlcXVpcmVkID09PSAneWVzJykgJiYgKHZhbHVlID09PSB1bmRlZmluZWQgfHwgdmFsdWUubGVuZ3RoID09PSAwKSlcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICBlbHNlXHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICAgICAgICAgIH07XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG59XSk7IiwiXCJ1c2Ugc3RyaWN0XCI7XHJcblxyXG5hbmd1bGFyLm1vZHVsZSgnYXBwJykuZGlyZWN0aXZlKCduYXZjb25EZWxldGUnLCBbJ2RhdGFzZXJ2aWNlJywgJ2xvZ2dlcicsXHJcbiAgICBmdW5jdGlvbihkYXRhc2VydmljZSwgbG9nZ2VyKSB7XHJcbiAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgLypFOiBEaXJlY3RpdmUgZGVmaW5lZCBhcyBhbiBlbGVtZW50LiA8bmF2Y29uLXRhYmxlPjwvbmF2Y29uLXRhYmxlPlxyXG4gICAgICAgICAgICBBOiBEaXJlY3RpdmUgYXBwbGllZCBhcyBhbiBhdHRyaWJ1dGUgb24gZXhpc3RpbmcgZWxlbWVudC4gPGRpdiBuYXZjb24tdGFibGU+PC9kaXY+XHJcbiAgICAgICAgICAgIEM6IERpcmVjdGl2ZSBhcHBsaWVkIGFzIGEgY3NzIGNsYXNzIHRvIGV4aXN0aW5nIGVsZW1lbnQgPGRpdiBjbGFzcz1cIm5hdmNvbi10YWJsZVwiPjwvZGl2PlxyXG4gICAgICAgICAgICBNOiBEaXJlY3RpdmUgYXBwbGllZCBhcyBjb21tZW50LiovXHJcbiAgICAgICAgICAgIHJlc3RyaWN0OiAnRScsXHJcbiAgICAgICAgICAgIHJlcGxhY2U6IHRydWUsXHJcbiAgICAgICAgICAgIHRyYW5zY2x1ZGU6ICd0cnVlJyxcclxuICAgICAgICAgICAgc2NvcGU6IHtcclxuICAgICAgICAgICAgICAgIC8vQCByZWFkcyB0aGUgYXR0cmlidXRlIHZhbHVlLCA9IHByb3ZpZGVzIHR3by13YXkgYmluZGluZywgJiB3b3JrcyB3aXRoIGZ1bmN0aW9uc1xyXG4gICAgICAgICAgICAgICAgdGl0bGU6ICdAJyxcclxuICAgICAgICAgICAgICAgIHR5cGU6ICdAJyxcclxuICAgICAgICAgICAgICAgIGlkOiAnQCcsXHJcbiAgICAgICAgICAgICAgICBuYXZjb25EYXRhOiAnPScsXHJcbiAgICAgICAgICAgICAgICBmb290ZXI6ICdAJyxcclxuICAgICAgICAgICAgICAgIGljb246ICdAJyxcclxuICAgICAgICAgICAgICAgIHNpemU6ICdAJyxcclxuICAgICAgICAgICAgICAgIGRlbGV0ZTogJ0AnXHJcbiAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgIC8vdGVtcGxhdGVVcmw6ICdleHQtbW9kdWxlcy9uYXZjb25EZWxldGUvbmF2Y29uRGVsZXRlVGVtcGxhdGUuaHRtbCcsXHJcbiAgICAgICAgICAgIHRlbXBsYXRlVXJsOiBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBuYXZjb24uTWVudXJvdXRlLmdldFRlbXBsYXRlVXJsKFwibmF2Y29uRGVsZXRlXCIpO1xyXG4gICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICBsaW5rOiBmdW5jdGlvbihzY29wZSwgZWwsIGF0dHJzKSB7XHJcbiAgICAgICAgICAgICAgICAkKGVsKS5kcmFnZ2FibGUoe1xyXG4gICAgICAgICAgICAgICAgICAgIGhhbmRsZTogXCIubW9kYWwtaGVhZGVyXCIsXHJcbiAgICAgICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgICAgICAkKGVsKS5hdHRyKFwiaWRcIiwgYXR0cnMudHlwZSArIFwiZGVsZXRlXCIpO1xyXG5cclxuICAgICAgICAgICAgICAgICQoZWwpLmFkZENsYXNzKHNjb3BlLnNpemUpO1xyXG5cclxuICAgICAgICAgICAgICAgIHNjb3BlLmRlbGV0ZSA9IGZ1bmN0aW9uKHR5cGUsIHR5cGVkZWwpIHtcclxuICAgICAgICAgICAgICAgICAgICBzY29wZS5uYXZjb25EYXRhLnRhYmxlUm93RGVsZXRlKHR5cGUsIHR5cGUgKyAnZGVsZXRlJywgZnVuY3Rpb24oZGF0YSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoZGF0YSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvZ2dlci5zdWNjZXNzKFwiRW50cmllcyBhcmUgZGVsZXRlZCBzdWNjZXNzZnVsbHkuLi5cIiwgXCJcIiwgXCJcIik7XHJcbiAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfTtcclxuICAgIH1cclxuXSk7IiwiXCJ1c2Ugc3RyaWN0XCI7XHJcblxyXG5hbmd1bGFyLm1vZHVsZSgnYXBwJykuZGlyZWN0aXZlKCduYXZjb25Gb3JtJywgWydkYXRhc2VydmljZScsICdsb2dnZXInLCAnJHRpbWVvdXQnLCAnJGNvbXBpbGUnLCAnJHJvb3RTY29wZScsXHJcbiAgICBmdW5jdGlvbihkYXRhc2VydmljZSwgbG9nZ2VyLCAkdGltZW91dCwgJGNvbXBpbGUsICRyb290U2NvcGUpIHtcclxuICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICAvKkU6IERpcmVjdGl2ZSBkZWZpbmVkIGFzIGFuIGVsZW1lbnQuIDxuYXZjb24tdGFibGU+PC9uYXZjb24tdGFibGU+XHJcbiAgICAgICAgICAgIEE6IERpcmVjdGl2ZSBhcHBsaWVkIGFzIGFuIGF0dHJpYnV0ZSBvbiBleGlzdGluZyBlbGVtZW50LiA8ZGl2IG5hdmNvbi10YWJsZT48L2Rpdj5cclxuICAgICAgICAgICAgQzogRGlyZWN0aXZlIGFwcGxpZWQgYXMgYSBjc3MgY2xhc3MgdG8gZXhpc3RpbmcgZWxlbWVudCA8ZGl2IGNsYXNzPVwibmF2Y29uLXRhYmxlXCI+PC9kaXY+XHJcbiAgICAgICAgICAgIE06IERpcmVjdGl2ZSBhcHBsaWVkIGFzIGNvbW1lbnQuKi9cclxuICAgICAgICAgICAgcmVzdHJpY3Q6ICdFJyxcclxuICAgICAgICAgICAgcmVwbGFjZTogdHJ1ZSxcclxuICAgICAgICAgICAgdHJhbnNjbHVkZTogJ2VsZW1lbnQnLFxyXG4gICAgICAgICAgICBzY29wZToge1xyXG4gICAgICAgICAgICAgICAgLy9AIHJlYWRzIHRoZSBhdHRyaWJ1dGUgdmFsdWUsID0gcHJvdmlkZXMgdHdvLXdheSBiaW5kaW5nLCAmIHdvcmtzIHdpdGggZnVuY3Rpb25zXHJcbiAgICAgICAgICAgICAgICBuYXZjb25EYXRhOiAnPScsXHJcbiAgICAgICAgICAgICAgICBuYXZjb25Nb2RlbDogJ0AnLFxyXG4gICAgICAgICAgICAgICAgaXRlbXM6ICc9ZmllbGREYXRhJyxcclxuICAgICAgICAgICAgICAgIHRpdGxlOiAnQCcsXHJcbiAgICAgICAgICAgICAgICBpY29uOiAnQCcsXHJcbiAgICAgICAgICAgICAgICBmb290ZXI6ICdAJyxcclxuICAgICAgICAgICAgICAgIHR5cGU6ICdAJyxcclxuICAgICAgICAgICAgICAgIHNhdmU6ICdAJyxcclxuICAgICAgICAgICAgICAgIGNhbmNlbDogJ0AnLFxyXG4gICAgICAgICAgICAgICAgYXBwcm92YWxLZXk6ICdAJyxcclxuICAgICAgICAgICAgICAgIGFwcHJvdmFsQ29uZmlnOiAnQCcsXHJcbiAgICAgICAgICAgICAgICBhcHByb3ZhbFRpdGxlOiAnPScsXHJcbiAgICAgICAgICAgICAgICBmb3JtTmFtZTogJ0AnLFxyXG4gICAgICAgICAgICAgICAgZm9ybU1hbmFnZTogJz0nLFxyXG4gICAgICAgICAgICAgICAgcmVhZE9ubHk6ICc9JyxcclxuICAgICAgICAgICAgICAgIHZhbGlkYXRlOiAnQCdcclxuICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgY29udHJvbGxlcjogZnVuY3Rpb24oJHNjb3BlKSB7XHJcblxyXG4gICAgICAgICAgICAgICAgdGhpcy5nZXRGaWVsZEl0ZW1zID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRzY29wZS5pdGVtcztcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIHRoaXMuZ2V0Rm9ybVR5cGUgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHNjb3BlLnR5cGU7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB0aGlzLmdldEl0ZW0gPSBmdW5jdGlvbihpdGVtKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRzY29wZS5uYXZjb25EYXRhW2l0ZW1dO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgdGhpcy5nZXRGb3JtTmFtZSA9IGZ1bmN0aW9uKGl0ZW0pIHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHNjb3BlLmZvcm07XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB0aGlzLmdldE5hdmNvbkRhdGEgPSBmdW5jdGlvbihpdGVtKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRzY29wZS5uYXZjb25EYXRhO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgdGhpcy5nZXRWYWxpZGF0ZSA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiAkc2NvcGUudmFsaWRhdGU7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB0aGlzLmdldEZvcm1SZWFkT25seSA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiAkc2NvcGUucmVhZE9ubHk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgIC8vdGVtcGxhdGVVcmw6ICdleHQtbW9kdWxlcy9uYXZjb25Gb3JtL25hdmNvbkZvcm1UZW1wbGF0ZS5odG1sJyxcclxuICAgICAgICAgICAgdGVtcGxhdGVVcmw6IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIG5hdmNvbi5NZW51cm91dGUuZ2V0VGVtcGxhdGVVcmwoXCJuYXZjb25Gb3JtXCIpO1xyXG4gICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICBsaW5rOiBmdW5jdGlvbihzY29wZSwgZWwsIGF0dHJzKSB7XHJcbiAgICAgICAgICAgICAgICBzY29wZS5mb3JtID0gXCJwYWdlXCI7XHJcblxyXG4gICAgICAgICAgICAgICAgaWYgKHNjb3BlLmZvcm1NYW5hZ2UgIT09IHVuZGVmaW5lZCAmJiBzY29wZS5mb3JtTWFuYWdlICE9PSBudWxsKVxyXG4gICAgICAgICAgICAgICAgICAgIHNjb3BlLm1hbmFnZSA9IHNjb3BlLmZvcm1NYW5hZ2VcclxuICAgICAgICAgICAgICAgIGVsc2VcclxuICAgICAgICAgICAgICAgICAgICBzY29wZS5tYW5hZ2UgPSB7fTtcclxuXHJcbiAgICAgICAgICAgICAgICBpZiAoc2NvcGUudmFsaWRhdGUgPT09IHVuZGVmaW5lZClcclxuICAgICAgICAgICAgICAgICAgICBzY29wZS52YWxpZGF0ZSA9IHRydWU7XHJcblxyXG4gICAgICAgICAgICAgICAgc2NvcGUuJHdhdGNoKFwicmVhZE9ubHlcIiwgZnVuY3Rpb24obmV3VmFsdWUsIG9sZFZhbHVlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKG5ld1ZhbHVlICE9PSB1bmRlZmluZWQgJiYgbmV3VmFsdWUgIT09IG9sZFZhbHVlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHNjb3BlLiRicm9hZGNhc3QoJ0ZPUk0tUkVBRE9OTFknLCBuZXdWYWx1ZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfSwgdGhpcyk7XHJcblxyXG4gICAgICAgICAgICAgICAgaWYgKHNjb3BlLmFwcHJvdmFsS2V5ICE9PSB1bmRlZmluZWQgJiYgc2NvcGUuYXBwcm92YWxLZXkgIT09IFwiXCIpIHtcclxuICAgICAgICAgICAgICAgICAgICB2YXIga2V5SW5kZXggPSBuYXZjb24uZ2V0SXRlbUluZGV4QnlQcm9wZXJ0eShzY29wZS5pdGVtcywgc2NvcGUuYXBwcm92YWxLZXkpO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChrZXlJbmRleCAhPT0gdW5kZWZpbmVkICYmIGtleUluZGV4ICE9PSAtMSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBzY29wZS5hcHByb3ZhbFBhZ2UgPSBzY29wZS5pdGVtc1trZXlJbmRleF0ucGFnZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgc2NvcGUubW9kYWxJZCA9IHNjb3BlLml0ZW1zW2tleUluZGV4XS5tb2RhbElkO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBzY29wZS5pdGVtSWQgPSBzY29wZS5pdGVtc1trZXlJbmRleF0uaXRlbUlkO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBzY29wZS5hcHByb3ZhbElkID0gc2NvcGUuaXRlbXNba2V5SW5kZXhdLmFwcHJvdmFsSWQ7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHNjb3BlLnNvdXJjZSA9IHNjb3BlLml0ZW1zW2tleUluZGV4XS5zb3VyY2U7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoc2NvcGUuaXRlbXNba2V5SW5kZXhdLnBhZ2VDb25maWcgIT09IHVuZGVmaW5lZCAmJiBzY29wZS5pdGVtc1trZXlJbmRleF0ucGFnZUNvbmZpZyAhPT0gXCJcIikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHNjb3BlLmFwcHJvdmFsQ29uZmlnICE9PSB1bmRlZmluZWQgJiYgc2NvcGUuYXBwcm92YWxDb25maWcgIT09IG51bGwgJiYgc2NvcGUuYXBwcm92YWxDb25maWdbc2NvcGUuaXRlbXNba2V5SW5kZXhdLnBhZ2VDb25maWddICE9PSB1bmRlZmluZWQgJiYgc2NvcGUuYXBwcm92YWxDb25maWdbc2NvcGUuaXRlbXNba2V5SW5kZXhdLnBhZ2VDb25maWddICE9PSBudWxsKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNjb3BlLmFwcHJvdmFsQ29uZmlnID0gc2NvcGUuYXBwcm92YWxDb25maWdbc2NvcGUuaXRlbXNba2V5SW5kZXhdLnBhZ2VDb25maWddO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSBpZiAoc2NvcGUubmF2Y29uRGF0YSAhPT0gdW5kZWZpbmVkICYmIHNjb3BlLm5hdmNvbkRhdGEgIT09IG51bGwgJiYgc2NvcGUubmF2Y29uRGF0YVtzY29wZS5pdGVtc1trZXlJbmRleF0ucGFnZUNvbmZpZ10gIT09IHVuZGVmaW5lZCAmJiBzY29wZS5uYXZjb25EYXRhW3Njb3BlLml0ZW1zW2tleUluZGV4XS5wYWdlQ29uZmlnXSAhPT0gbnVsbClcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzY29wZS5hcHByb3ZhbENvbmZpZyA9IHNjb3BlLm5hdmNvbkRhdGFbc2NvcGUuaXRlbXNba2V5SW5kZXhdLnBhZ2VDb25maWddO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSBpZiAoc2NvcGUuJHBhcmVudC4kcGFyZW50ICE9PSB1bmRlZmluZWQgJiYgc2NvcGUuJHBhcmVudC4kcGFyZW50Lm5hdmNvbkRhdGEgIT09IHVuZGVmaW5lZCAmJiBzY29wZS4kcGFyZW50LiRwYXJlbnQubmF2Y29uRGF0YVtzY29wZS5pdGVtc1trZXlJbmRleF0ucGFnZUNvbmZpZ10gIT09IHVuZGVmaW5lZCAmJiBzY29wZS4kcGFyZW50LiRwYXJlbnQubmF2Y29uRGF0YVtzY29wZS5pdGVtc1trZXlJbmRleF0ucGFnZUNvbmZpZ10gIT09IG51bGwpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2NvcGUuYXBwcm92YWxDb25maWcgPSBzY29wZS4kcGFyZW50LiRwYXJlbnQubmF2Y29uRGF0YVtzY29wZS5pdGVtc1trZXlJbmRleF0ucGFnZUNvbmZpZ107XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciB0ZW1wbGF0ZURhdGEgPSAkKCQoZWwpLmZpbmQoXCJzY3JpcHRbaWQgPSdBcHByb3ZhbCddXCIpKS50ZXh0KCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICQoJChlbCkuZmluZChcInNwYW5baWQ9J0FwcHJvdmFsJ11cIikpLmh0bWwodGVtcGxhdGVEYXRhKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgJGNvbXBpbGUoJCgkKGVsKS5maW5kKFwic3BhbltpZD0nQXBwcm92YWwnXVwiKSkuY29udGVudHMoKSkoc2NvcGUpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIHNjb3BlLm1hbmFnZS5jYW5jZWwgPSBmdW5jdGlvbih0eXBlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgLyogaWYoc2NvcGUubmF2Y29uRGF0YS5kaXJlY3RpdmUuY2FuY2VsICE9PSB1bmRlZmluZWQpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHNjb3BlLm5hdmNvbkRhdGEuZGlyZWN0aXZlLmNhbmNlbCh0eXBlKTtcclxuICAgICAgICAgICAgICAgICAgICAgZWxzZSovXHJcblxyXG4gICAgICAgICAgICAgICAgICAgIC8vc2NvcGUuYXBwcm92YWxUaXRsZSA9IFwiXCI7XHJcbiAgICAgICAgICAgICAgICAgICAgbmF2Y29uLnNldFZpZXdDb250ZW50RGlzYWJsZWQoXCJcIik7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIHNjb3BlLm5hdmNvbkRhdGEuY2FuY2VsKHR5cGUpO1xyXG4gICAgICAgICAgICAgICAgICAgIHNjb3BlLmZvcm1SZXNldCgpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIHNjb3BlLmZvcm1SZXNldCA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChzY29wZS5pdGVtcyA9PT0gdW5kZWZpbmVkIHx8IHNjb3BlLml0ZW1zLmxlbmd0aCA9PT0gdW5kZWZpbmVkKSByZXR1cm4gdHJ1ZTtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgcmV0VmFsID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBpID0gMCwgbGVuID0gc2NvcGUuaXRlbXMubGVuZ3RoOyBpIDwgbGVuOyBpKyspIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHNjb3BlLml0ZW1zW2ldLmZvcm0gIT09IHVuZGVmaW5lZCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHNjb3BlLml0ZW1zW2ldLmZvcm0uJHNldFByaXN0aW5lICE9PSB1bmRlZmluZWQgJiYgdHlwZW9mIHNjb3BlLml0ZW1zW2ldLmZvcm0uJHNldFByaXN0aW5lID09PSBcImZ1bmN0aW9uXCIpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2NvcGUuaXRlbXNbaV0uZm9ybS4kc2V0UHJpc3RpbmUoKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoc2NvcGUuaXRlbXNbaV0uZm9ybS4kc2V0VW50b3VjaGVkICE9PSB1bmRlZmluZWQgJiYgdHlwZW9mIHNjb3BlLml0ZW1zW2ldLmZvcm0uJHNldFVudG91Y2hlZCA9PT0gXCJmdW5jdGlvblwiKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNjb3BlLml0ZW1zW2ldLmZvcm0uJHNldFVudG91Y2hlZCgpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfTtcclxuXHJcbiAgICAgICAgICAgICAgICBzY29wZS5tYW5hZ2UuY29udGludWUgPSBmdW5jdGlvbih0eXBlLCBwYWdlLCBtb2RhbCwgZmllbGRzZXQpIHtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHNjb3BlLm1hbmFnZS5mb3JtVmFsaWQoZmllbGRzZXQpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHNjb3BlLm5hdmNvbkRhdGEuZm9ybUFjdGlvbnMuY29udGludWUodHlwZSwgcGFnZSwgbW9kYWwsIGZpZWxkc2V0KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gIHNjb3BlLm5hdmNvbkRhdGEuY29udGludWUodHlwZSwgcGFnZSwgbW9kYWwsIGZpZWxkc2V0KTsvLywgc2F2ZUNhbGxCYWNrXHJcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgbG9nZ2VyLndhcm5pbmcoXCJJbnZhbGlkIGVudHJpZXMuLi5cIiwgXCJcIiwgXCJcIik7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfTtcclxuXHJcbiAgICAgICAgICAgICAgICBzY29wZS5tYW5hZ2Uuc2F2ZSA9IGZ1bmN0aW9uKHR5cGUsIGNhdGVnb3J5KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgLy9pZiAoc2NvcGUuZm9ybVZhbGlkKCkgJiYgdGFibGVFZGl0b3JWYWxpZCgpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGNhdGVnb3J5ID09IHVuZGVmaW5lZCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjYXRlZ29yeSA9IHNjb3BlLml0ZW1zO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBpZiAoc2NvcGUubWFuYWdlLmZvcm1WYWxpZChjYXRlZ29yeSkpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgc2NvcGUubmF2Y29uRGF0YS5zYXZlKHR5cGUsIGNhdGVnb3J5LCBzYXZlQ2FsbEJhY2spO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgZnVuY3Rpb24gc2F2ZUNhbGxCYWNrKGRhdGEpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChkYXRhKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIG1zZyA9IFwiRW50cmllcyBhcmUgc2F2ZWQgc3VjY2Vzc2Z1bGx5Li4uXCI7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHNjb3BlLm5hdmNvbkRhdGEgIT09IHVuZGVmaW5lZCAmJiBzY29wZS5pdGVtcy5tb2RlICE9PSB1bmRlZmluZWQgJiYgc2NvcGUuaXRlbXMubW9kZSA9PT0gXCJVcGRhdGVcIilcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbXNnID0gXCJFbnRyaWVzIGFyZSB1cGRhdGVkIHN1Y2Nlc3NmdWxseS4uLlwiO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChzY29wZS5uYXZjb25EYXRhICE9PSB1bmRlZmluZWQgJiYgc2NvcGUuaXRlbXMubW9kZSAhPT0gdW5kZWZpbmVkICYmIHNjb3BlLml0ZW1zLm1vZGUgIT09IFwiRGVsZXRlXCIpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvZ2dlci5zdWNjZXNzKG1zZywgXCJcIiwgXCJcIik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gc2NvcGUuZm9ybVJlc2V0KCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBsb2dnZXIud2FybmluZyhcIkludmFsaWQgZW50cmllcy4uLlwiLCBcIlwiLCBcIlwiKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9O1xyXG5cclxuICAgICAgICAgICAgICAgIC8vc2NvcGUuZm9ybVZhbGlkID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgLy8gICAgaWYgKHNjb3BlLml0ZW1zID09PSB1bmRlZmluZWQgfHwgc2NvcGUuaXRlbXMubGVuZ3RoID09PSB1bmRlZmluZWQgfHwgIXNjb3BlLnZhbGlkYXRlKSByZXR1cm4gdHJ1ZTtcclxuICAgICAgICAgICAgICAgIC8vICAgIHZhciByZXRWYWwgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgLy8gICAgZm9yICh2YXIgaSA9IDAsIGxlbiA9IHNjb3BlLml0ZW1zLmxlbmd0aDsgaSA8IGxlbjsgaSsrKSB7XHJcbiAgICAgICAgICAgICAgICAvLyAgICAgICAgaWYgKHNjb3BlLml0ZW1zW2ldLnR5cGUgIT09IHVuZGVmaW5lZCAmJiBzY29wZS5pdGVtc1tpXS50eXBlID09PSBcInRhYmxlZWRpdG9yXCIpIHRhYmxlRWRpdG9yVmFsaWQoKTtcclxuICAgICAgICAgICAgICAgIC8vICAgICAgICBpZiAoc2NvcGUuaXRlbXNbaV0uZm9ybSAhPT0gdW5kZWZpbmVkICYmIHR5cGVvZiBzY29wZS5pdGVtc1tpXS5mb3JtID09PSBcIm9iamVjdFwiKSB7XHJcbiAgICAgICAgICAgICAgICAvLyAgICAgICAgICAgIGlmIChzY29wZS5pdGVtc1tpXS5mb3JtLiRpbnZhbGlkKSB7IC8vJiYgIXNjb3BlLml0ZW1zW2ldLnZhbGlkXHJcbiAgICAgICAgICAgICAgICAvLyAgICAgICAgICAgICAgICBzY29wZS5pdGVtc1tpXS5zZXRGb2N1cyA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgLy8gICAgICAgICAgICAgICAgYW5ndWxhci5mb3JFYWNoKHNjb3BlLml0ZW1zW2ldLmZvcm0uJGVycm9yLCBmdW5jdGlvbiAoZmllbGQpIHtcclxuICAgICAgICAgICAgICAgIC8vICAgICAgICAgICAgICAgICAgICBhbmd1bGFyLmZvckVhY2goZmllbGQsIGZ1bmN0aW9uIChlcnJvckZpZWxkKSB7XHJcbiAgICAgICAgICAgICAgICAvLyAgICAgICAgICAgICAgICAgICAgICAgIGlmIChlcnJvckZpZWxkLiRuYW1lID09PSBcImZvcm1cIikge1xyXG4gICAgICAgICAgICAgICAgLy8gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgLy8gICAgICAgICAgICAgICAgICAgICAgICAgICAgZXJyb3JGaWVsZC4kc2V0VG91Y2hlZCgpO1xyXG4gICAgICAgICAgICAgICAgLy8gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAvLyAgICAgICAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgICAgIC8vICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgLy8gICAgICAgICAgICAgICAgcmV0VmFsID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICAvLyAgICAgICAgICAgICAgICBpZiAoc2NvcGUuaXRlbXNbaV0uc2hvd01lc3NhZ2UgIT09IHVuZGVmaW5lZCkge1xyXG4gICAgICAgICAgICAgICAgLy8gICAgICAgICAgICAgICAgICAgIHNjb3BlLml0ZW1zW2ldLnNob3dNZXNzYWdlID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgIC8vICAgICAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uIChuKSB7XHJcbiAgICAgICAgICAgICAgICAvLyAgICAgICAgICAgICAgICAgICAgICAgIGlmIChzY29wZS5pdGVtc1tuXS5zaG93TWVzc2FnZSAhPT0gdW5kZWZpbmVkKVxyXG4gICAgICAgICAgICAgICAgLy8gICAgICAgICAgICAgICAgICAgICAgICAgICAgc2NvcGUuaXRlbXNbbl0uc2hvd01lc3NhZ2UgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgIC8vICAgICAgICAgICAgICAgICAgICB9LCA2MDAwLCBpKTtcclxuICAgICAgICAgICAgICAgIC8vICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIC8vICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgLy8gICAgICAgIH1cclxuICAgICAgICAgICAgICAgIC8vICAgIH1cclxuICAgICAgICAgICAgICAgIC8vICAgIHJldHVybiByZXRWYWw7XHJcbiAgICAgICAgICAgICAgICAvL307XHJcblxyXG4gICAgICAgICAgICAgICAgc2NvcGUubWFuYWdlLmZvcm1WYWxpZCA9IGZ1bmN0aW9uKGl0ZW1zKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGl0ZW1zID09PSB1bmRlZmluZWQgfHwgaXRlbXMubGVuZ3RoID09PSB1bmRlZmluZWQgfHwgIXNjb3BlLnZhbGlkYXRlKSByZXR1cm4gdHJ1ZTtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgcmV0VmFsID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBpID0gMCwgbGVuID0gaXRlbXMubGVuZ3RoOyBpIDwgbGVuOyBpKyspIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGl0ZW1zW2ldLnR5cGUgIT09IHVuZGVmaW5lZCAmJiBpdGVtc1tpXS50eXBlID09PSBcInRhYmxlZWRpdG9yXCIpIHRhYmxlRWRpdG9yVmFsaWQoaXRlbXNbaV0pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoaXRlbXNbaV0uZm9ybSAhPT0gdW5kZWZpbmVkICYmIHR5cGVvZiBpdGVtc1tpXS5mb3JtID09PSBcIm9iamVjdFwiKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoaXRlbXNbaV0uZm9ybS4kaW52YWxpZCAmJiAoaXRlbXNbaV0udmFsaWRhdGUgPT09IHVuZGVmaW5lZCB8fCBpdGVtc1tpXS52YWxpZGF0ZSkpIHsgLy8mJiAhaXRlbXNbaV0udmFsaWRcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgaXNEcmFmdFZhbGlkYXRlID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGlzRHJhZnQgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoc2NvcGUubmF2Y29uRGF0YSAhPT0gdW5kZWZpbmVkICYmIHNjb3BlLm5hdmNvbkRhdGEuc2F2ZVN0YXR1cyAhPT0gdW5kZWZpbmVkICYmIHNjb3BlLm5hdmNvbkRhdGEuc2F2ZVN0YXR1cyA9PT0gXCJkcmFmdFwiKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlzRHJhZnQgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoaXRlbXNbaV0udGVtcGxhdGVPcHRpb25zICE9PSB1bmRlZmluZWQgJiYgaXRlbXNbaV0udGVtcGxhdGVPcHRpb25zLmRyYWZ0VmFsaWRhdGUgIT09IHVuZGVmaW5lZCAmJiBpdGVtc1tpXS50ZW1wbGF0ZU9wdGlvbnMuZHJhZnRWYWxpZGF0ZSA9PT0gdHJ1ZSAmJiAhaXRlbXNbaV0uZm9ybVtpdGVtc1tpXS5rZXldLiR2YWxpZCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0VmFsID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpc0RyYWZ0VmFsaWRhdGUgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGl0ZW1zW2ldLmZvcm1baXRlbXNbaV0ua2V5XSAhPT0gdW5kZWZpbmVkICYmIGl0ZW1zW2ldLmZvcm1baXRlbXNbaV0ua2V5XS4kdmFsaWQgIT09IHVuZGVmaW5lZCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFpdGVtc1tpXS5mb3JtW2l0ZW1zW2ldLmtleV0uJHZhbGlkKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldFZhbCA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0VmFsID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGlzRHJhZnQgJiYgIWlzRHJhZnRWYWxpZGF0ZSkgY29udGludWU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaXRlbXNbaV0uc2V0Rm9jdXMgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhbmd1bGFyLmZvckVhY2goaXRlbXNbaV0uZm9ybS4kZXJyb3IsIGZ1bmN0aW9uKGZpZWxkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFuZ3VsYXIuZm9yRWFjaChmaWVsZCwgZnVuY3Rpb24oZXJyb3JGaWVsZCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGVycm9yRmllbGQuJG5hbWUgPT09IFwiZm9ybVwiKSB7fSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlcnJvckZpZWxkLiRzZXRUb3VjaGVkKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGl0ZW1zW2ldLnNob3dNZXNzYWdlICE9PSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaXRlbXNbaV0uc2hvd01lc3NhZ2UgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uKG4pIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChpdGVtc1tuXS5zaG93TWVzc2FnZSAhPT0gdW5kZWZpbmVkKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGl0ZW1zW25dLnNob3dNZXNzYWdlID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sIDYwMDAsIGkpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmV0VmFsO1xyXG4gICAgICAgICAgICAgICAgfTtcclxuXHJcbiAgICAgICAgICAgICAgICAvL2Z1bmN0aW9uIHRhYmxlRWRpdG9yVmFsaWQoKSB7XHJcbiAgICAgICAgICAgICAgICAvLyAgICBpZiAoc2NvcGUuaXRlbXMgPT09IHVuZGVmaW5lZCB8fCBzY29wZS5pdGVtcy5sZW5ndGggPT09IHVuZGVmaW5lZCkgcmV0dXJuIHRydWU7XHJcbiAgICAgICAgICAgICAgICAvLyAgICB2YXIgcmV0VmFsID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgIC8vICAgIGZvciAodmFyIGwgPSAwLCBsZW4gPSBzY29wZS5pdGVtcy5sZW5ndGg7IGwgPCBsZW47IGwrKykge1xyXG4gICAgICAgICAgICAgICAgLy8gICAgICAgIGlmIChzY29wZS5pdGVtc1tsXS50eXBlICE9PSB1bmRlZmluZWQgJiYgc2NvcGUuaXRlbXNbbF0udHlwZSA9PT0gXCJ0YWJsZWVkaXRvclwiKSB7XHJcbiAgICAgICAgICAgICAgICAvLyAgICAgICAgICAgIGlmIChzY29wZS5pdGVtc1tsXS5kYXRhLmxlbmd0aCA+IDApIHtcclxuICAgICAgICAgICAgICAgIC8vICAgICAgICAgICAgICAgIHZhciBpdGVtcyA9IHNjb3BlLml0ZW1zW2xdLmRhdGFbMF0uZmllbGRzO1xyXG4gICAgICAgICAgICAgICAgLy8gICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDAsIGxlbiA9IGl0ZW1zLmxlbmd0aDsgaSA8IGxlbjsgaSsrKSB7XHJcbiAgICAgICAgICAgICAgICAvLyAgICAgICAgICAgICAgICAgICAgaWYgKGl0ZW1zW2ldLmZvcm0gIT09IHVuZGVmaW5lZCAmJiB0eXBlb2YgaXRlbXNbaV0uZm9ybSA9PT0gXCJvYmplY3RcIikge1xyXG4gICAgICAgICAgICAgICAgLy8gICAgICAgICAgICAgICAgICAgICAgICBpZiAoaXRlbXNbaV0uZm9ybS4kaW52YWxpZCkgey8vJiYgIWl0ZW1zW2ldLnZhbGlkXHJcbiAgICAgICAgICAgICAgICAvLyAgICAgICAgICAgICAgICAgICAgICAgICAgICBpdGVtc1tpXS5zZXRGb2N1cyA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgLy8gICAgICAgICAgICAgICAgICAgICAgICAgICAgYW5ndWxhci5mb3JFYWNoKGl0ZW1zW2ldLmZvcm0uJGVycm9yLCBmdW5jdGlvbiAoZmllbGQpIHtcclxuICAgICAgICAgICAgICAgIC8vICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhbmd1bGFyLmZvckVhY2goZmllbGQsIGZ1bmN0aW9uIChlcnJvckZpZWxkKSB7XHJcbiAgICAgICAgICAgICAgICAvLyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChlcnJvckZpZWxkLiRuYW1lID09PSBcImZvcm1cIikge1xyXG4gICAgICAgICAgICAgICAgLy8gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy9jb25zb2xlLmxvZyhzY29wZS5pdGVtc1tpXSk7XHJcbiAgICAgICAgICAgICAgICAvLyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAvLyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlcnJvckZpZWxkLiRzZXRUb3VjaGVkKCk7XHJcbiAgICAgICAgICAgICAgICAvLyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIC8vICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAgICAgLy8gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICAvLyAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXRWYWwgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgIC8vICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChpdGVtc1tpXS5zaG93TWVzc2FnZSAhPT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgICAgICAgICAvLyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaXRlbXNbaV0uc2hvd01lc3NhZ2UgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgLy8gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gKG4pIHtcclxuICAgICAgICAgICAgICAgIC8vICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGl0ZW1zW25dLnNob3dNZXNzYWdlICE9PSB1bmRlZmluZWQpXHJcbiAgICAgICAgICAgICAgICAvLyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpdGVtc1tuXS5zaG93TWVzc2FnZSA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgLy8gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sIDYwMDAsIGkpO1xyXG4gICAgICAgICAgICAgICAgLy8gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgLy8gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAvLyAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgLy8gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgLy8gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAvLyAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgLy8gICAgfVxyXG4gICAgICAgICAgICAgICAgLy8gICAgcmV0dXJuIHJldFZhbDtcclxuICAgICAgICAgICAgICAgIC8vfTtcclxuXHJcblxyXG4gICAgICAgICAgICAgICAgZnVuY3Rpb24gdGFibGVFZGl0b3JWYWxpZChpdGVtcykge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChpdGVtcyA9PT0gdW5kZWZpbmVkKSByZXR1cm4gdHJ1ZTtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgcmV0VmFsID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgICAgICAkLmVhY2goaXRlbXMuZGF0YSwgZnVuY3Rpb24oaW5kZXgsIHZhbHVlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldFZhbCA9IHNjb3BlLm1hbmFnZS5mb3JtVmFsaWQodmFsdWUuZmllbGRzKVxyXG4gICAgICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJldFZhbDtcclxuICAgICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9O1xyXG4gICAgfVxyXG5dKTsiLCJcInVzZSBzdHJpY3RcIjtcclxuXHJcbmFuZ3VsYXIubW9kdWxlKFwibmF2Y29uRnJhbWV3b3JrXCIpLmRpcmVjdGl2ZShcIm5hdmNvbkZyYW1ld29ya1wiLCBmdW5jdGlvbigpIHtcclxuICAgIHJldHVybiB7XHJcbiAgICAgICAgcmVzdHJpY3Q6ICdBRScsXHJcbiAgICAgICAgcmVwbGFjZTogZmFsc2UsXHJcbiAgICAgICAgdHJhbnNjbHVkZTogZmFsc2UsXHJcbiAgICAgICAgc2NvcGU6IHtcclxuICAgICAgICAgICAgdGl0bGU6ICdAJyxcclxuICAgICAgICAgICAgc3VidGl0bGU6ICdAJyxcclxuICAgICAgICAgICAgaWNvbkZpbGU6ICdAJ1xyXG4gICAgICAgIH0sXHJcbiAgICAgICAgY29udHJvbGxlcjogXCJuYXZjb25GcmFtZXdvcmtDb250cm9sbGVyXCIsXHJcbiAgICAgICAgLy90ZW1wbGF0ZVVybDogXCJleHQtbW9kdWxlcy9uYXZjb25GcmFtZXdvcmsvbmF2Y29uRnJhbWV3b3JrVGVtcGxhdGUuaHRtbFwiXHJcbiAgICAgICAgdGVtcGxhdGVVcmw6IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICByZXR1cm4gbmF2Y29uLk1lbnVyb3V0ZS5nZXRUZW1wbGF0ZVVybChcIm5hdmNvbkZyYW1ld29ya1wiKTtcclxuICAgICAgICB9LFxyXG5cclxuICAgIH07XHJcbn0pOyIsIlwidXNlIHN0cmljdFwiO1xyXG5cclxuYW5ndWxhci5tb2R1bGUoJ2FwcCcpLmRpcmVjdGl2ZSgnbmF2Y29uS2VuZG9maWVsZCcsIFsnJHRpbWVvdXQnLCAnZGF0YXNlcnZpY2UnLCAnJGNvbXBpbGUnLCAnJGh0dHAnLCAnJHJvb3RTY29wZScsICduZ0F1dGhTZXR0aW5ncycsXHJcbmZ1bmN0aW9uICgkdGltZW91dCwgZGF0YXNlcnZpY2UsICRjb21waWxlLCAkaHR0cCwgJHJvb3RTY29wZSwgbmdBdXRoU2V0dGluZ3MpIHtcclxuICAgIHJldHVybiB7XHJcbiAgICAgICAgLypFOiBEaXJlY3RpdmUgZGVmaW5lZCBhcyBhbiBlbGVtZW50LiA8bmF2Y29uLWlucHV0PjwvbmF2Y29uLWlucHV0PlxyXG4gICAgICAgIEE6IERpcmVjdGl2ZSBhcHBsaWVkIGFzIGFuIGF0dHJpYnV0ZSBvbiBleGlzdGluZyBlbGVtZW50LiA8ZGl2IG5hdmNvbi1pbnB1dD48L2Rpdj5cclxuICAgICAgICBDOiBEaXJlY3RpdmUgYXBwbGllZCBhcyBhIGNzcyBjbGFzcyB0byBleGlzdGluZyBlbGVtZW50IDxkaXYgY2xhc3M9XCJuYXZjb24taW5wdXRcIj48L2Rpdj5cclxuICAgICAgICBNOiBEaXJlY3RpdmUgYXBwbGllZCBhcyBjb21tZW50LiovXHJcbiAgICAgICAgcmVzdHJpY3Q6ICdFJyxcclxuICAgICAgICByZXBsYWNlOiAndHJ1ZScsXHJcbiAgICAgICAgc2NvcGU6IHtcclxuICAgICAgICAgICAgLy9AIHJlYWRzIHRoZSBhdHRyaWJ1dGUgdmFsdWUsID0gcHJvdmlkZXMgdHdvLXdheSBiaW5kaW5nLCAmIHdvcmtzIHdpdGggZnVuY3Rpb25zXHJcbiAgICAgICAgICAgIC8vaXRlbXM6Jz1maWVsZERhdGEnLFxyXG4gICAgICAgICAgICBmaWVsZEtleTogJ0AnLFxyXG4gICAgICAgICAgICAvL25hdmNvbkRhdGE6ICc9JyxcclxuICAgICAgICAgICAgLy9maWVsZFR5cGU6J0AnLFxyXG4gICAgICAgICAgICAvL2ZpZWxkSW5kZXg6J0AnLFxyXG4gICAgICAgICAgICBzaG93TWVzc2FnZTogJ0AnLFxyXG4gICAgICAgICAgICBvbkNsaWNrOiAnQCcsXHJcbiAgICAgICAgICAgIG9uQmx1cjogJ0AnLFxyXG4gICAgICAgICAgICBvbkNoYW5nZTogJ0AnLFxyXG4gICAgICAgICAgICBpbnZhbGlkOiAnQCcsXHJcbiAgICAgICAgICAgIG9uS2V5UHJlc3M6ICdAJyxcclxuICAgICAgICAgICAgZmllbGRzOiAnPScsXHJcbiAgICAgICAgICAgIC8vZm9ybTogJ0AnLFxyXG4gICAgICAgICAgICBsYWJlbENsYXNzOiAnQCcsXHJcbiAgICAgICAgICAgIGZpZWxkQ2xhc3M6ICdAJyxcclxuICAgICAgICAgICAgZmllbGREYXRhOiAnPSdcclxuICAgICAgICB9LFxyXG4gICAgICAgIHJlcXVpcmU6IFsnXj9uYXZjb25Gb3JtJywgJ14/Zm9ybSddLFxyXG4gICAgICAgIGxpbms6IGZ1bmN0aW9uIChzY29wZSwgZWwsIGF0dHJzLCBjdHJsKSB7XHJcblxyXG4gICAgICAgICAgICBpZiAoY3RybFswXSAhPT0gbnVsbCkge1xyXG4gICAgICAgICAgICAgICAgaWYgKHNjb3BlLmZpZWxkRGF0YSAhPT0gdW5kZWZpbmVkKVxyXG4gICAgICAgICAgICAgICAgICAgIHNjb3BlLml0ZW1zID0gc2NvcGUuZmllbGREYXRhO1xyXG4gICAgICAgICAgICAgICAgZWxzZVxyXG4gICAgICAgICAgICAgICAgICAgIHNjb3BlLml0ZW1zID0gY3RybFswXS5nZXRGaWVsZEl0ZW1zKCk7XHJcbiAgICAgICAgICAgICAgICBzY29wZS5mb3JtID0gY3RybFsxXTtcclxuXHJcbiAgICAgICAgICAgICAgICBzY29wZS5uYXZjb25EYXRhID0gY3RybFswXS5nZXROYXZjb25EYXRhKCk7XHJcbiAgICAgICAgICAgICAgICBzY29wZS52YWxpZGF0ZSA9IGN0cmxbMF0uZ2V0VmFsaWRhdGUoKTtcclxuICAgICAgICAgICAgICAgIHNjb3BlLnJlYWRPbmx5ID0gY3RybFswXS5nZXRGb3JtUmVhZE9ubHkoKTtcclxuXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYgKHNjb3BlLml0ZW1zID09PSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgICAgICAgIGlmIChzY29wZS5maWVsZERhdGEgIT09IHVuZGVmaW5lZClcclxuICAgICAgICAgICAgICAgICAgICBzY29wZS5pdGVtcyA9IHNjb3BlLmZpZWxkRGF0YTtcclxuICAgICAgICAgICAgICAgIGVsc2VcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGlmIChzY29wZS52YWxpZGF0ZSA9PT0gdW5kZWZpbmVkKVxyXG4gICAgICAgICAgICAgICAgc2NvcGUudmFsaWRhdGUgPSB0cnVlO1xyXG5cclxuICAgICAgICAgICAgaWYgKHNjb3BlLnJlYWRPbmx5ID09PSB1bmRlZmluZWQpXHJcbiAgICAgICAgICAgICAgICBzY29wZS5yZWFkT25seSA9IGZhbHNlO1xyXG5cclxuICAgICAgICAgICAgaWYgKG5nQXV0aFNldHRpbmdzLmVuYWJsZUZpZWxkTGV2ZWxWYWxpZGF0aW9uICE9PSB1bmRlZmluZWQgJiYgIW5nQXV0aFNldHRpbmdzLmVuYWJsZUZpZWxkTGV2ZWxWYWxpZGF0aW9uKVxyXG4gICAgICAgICAgICAgICAgc2NvcGUuZW5hYmxlRmllbGRMZXZlbFZhbGlkYXRpb24gPSBmYWxzZTtcclxuICAgICAgICAgICAgZWxzZVxyXG4gICAgICAgICAgICAgICAgc2NvcGUuZW5hYmxlRmllbGRMZXZlbFZhbGlkYXRpb24gPSB0cnVlO1xyXG5cclxuXHJcbiAgICAgICAgICAgIHNjb3BlLmZpZWxkSW5kZXggPSBuYXZjb24uZ2V0SXRlbUluZGV4QnlQcm9wZXJ0eShzY29wZS5pdGVtcywgc2NvcGUuZmllbGRLZXkpO1xyXG4gICAgICAgICAgICBzY29wZS5maWVsZFR5cGUgPSBzY29wZS5pdGVtc1tzY29wZS5maWVsZEluZGV4XS50eXBlO1xyXG5cclxuICAgICAgICAgICAgdmFyIHRlbXBsYXRlRGF0YSA9ICQoJHJvb3RTY29wZS5maWVsZFRlbXBsYXRlKS5maW5kKFwic2NyaXB0W2lkID0nXCIgKyBzY29wZS5maWVsZFR5cGUgKyBcIiddXCIpLnRleHQoKTtcclxuICAgICAgICAgICAgZWwuaHRtbCh0ZW1wbGF0ZURhdGEpO1xyXG4gICAgICAgICAgICAkY29tcGlsZShlbC5jb250ZW50cygpKShzY29wZSk7XHJcbiAgICAgICAgICAgIGVsLmZpbmQoJ1tkYXRhLXRvZ2dsZT1cInRvb2x0aXBcIl0nKS50b29sdGlwKCk7XHJcbiAgICAgICAgICAgIHNjb3BlLnJlZGlyZWN0VVJMID0gZnVuY3Rpb24gKFVSTCkge1xyXG4gICAgICAgICAgICAgICAgaWYgKFVSTC5pbmRleE9mKCdodHRwJykgPT0gLTEpIHtcclxuICAgICAgICAgICAgICAgICAgICBVUkwgPSBcImh0dHA6Ly9cIiArIFVSTDtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIHdpbmRvdy5vcGVuKGVuY29kZVVSSShVUkwpLCAnX2JsYW5rJyk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgc2NvcGUub25DbGljayA9IGZ1bmN0aW9uIChrZXksIGUpIHtcclxuICAgICAgICAgICAgICAgIHNob3dNZXNzYWdnZVN0YXR1cyhzY29wZSwgJHRpbWVvdXQpO1xyXG5cclxuICAgICAgICAgICAgfTtcclxuXHJcblxyXG5cclxuXHJcbiAgICAgICAgICAgIHNjb3BlLm9uQ2hhbmdlID0gZnVuY3Rpb24gKGtleSwgZSkge1xyXG4gICAgICAgICAgICAgICAgc2NvcGUuaXRlbS5zZWxlY3RPcHRpb25zLml0ZW1bXCJpc1NlbGVjdFwiXSA9IHRydWU7XHJcbiAgICAgICAgICAgIH07XHJcblxyXG4gICAgICAgICAgICB2YXIgcmVwbGFjZVNwZWNpYWxDaGFyYWN0ZXIgPSBmdW5jdGlvbiAoaXRlbSkge1xyXG4gICAgICAgICAgICAgICAgaWYgKGl0ZW0gIT09IHVuZGVmaW5lZCAmJiB0eXBlb2YgaXRlbSA9PT0gXCJzdHJpbmdcIiAmJiBpdGVtICE9PSBcIlwiKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgc2NvcGUuaXRlbS5kYXRhID0gaXRlbS5yZXBsYWNlKC9cXHUyMDEzfFxcdTIwMTQvZywgXCItXCIpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcblxyXG5cclxuXHJcbiAgICAgICAgICAgIHNjb3BlLiR3YXRjaChcIml0ZW1zW1wiICsgc2NvcGUuZmllbGRJbmRleCArIFwiXVwiLCBmdW5jdGlvbiAobmV3VmFsdWUsIG9sZFZhbHVlKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAobmV3VmFsdWUgIT09IHVuZGVmaW5lZCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHNjb3BlLml0ZW0gPSBuZXdWYWx1ZTtcclxuICAgICAgICAgICAgICAgICAgICBzY29wZS5pdGVtLmZvcm0gPSBzY29wZS5mb3JtO1xyXG4gICAgICAgICAgICAgICAgICAgIHNjb3BlLml0ZW0uc2hvd01lc3NhZ2UgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgICAgICBzY29wZS5pdGVtLnNldEZvY3VzID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICAgICAgZmllbGRTZXR0aW5ncyhzY29wZSwgZWwsIGF0dHJzLCAkY29tcGlsZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgc2NvcGUuJHdhdGNoKCdmb3JtLicgKyBzY29wZS5pdGVtLmtleSArICcuJHZhbGlkJywgZnVuY3Rpb24gKG5ld1ZhbHVlLCBvbGRWYWx1ZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAobmV3VmFsdWUgIT09IHVuZGVmaW5lZCAmJiBuZXdWYWx1ZSAhPT0gb2xkVmFsdWUpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNjb3BlLml0ZW0uc2V0Rm9jdXMgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChuZXdWYWx1ZSA9PT0gZmFsc2UgJiYgc2NvcGUudmFsaWRhdGUgJiYgc2NvcGUuZW5hYmxlRmllbGRMZXZlbFZhbGlkYXRpb24pIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzY29wZS5pbnZhbGlkID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzY29wZS5pdGVtLnZhbGlkID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2hvd01lc3NhZ2dlU3RhdHVzKHNjb3BlLCAkdGltZW91dCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNjb3BlLmludmFsaWQgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzY29wZS5pdGVtLnZhbGlkID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgIHNjb3BlLiRvbignRk9STS1SRUFET05MWScsIGZ1bmN0aW9uIChldmVudCwgZGF0YSkge1xyXG4gICAgICAgICAgICAgICAgc2NvcGUucmVhZE9ubHkgPSBkYXRhO1xyXG4gICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgIHNjb3BlLiR3YXRjaChcIml0ZW1zW1wiICsgc2NvcGUuZmllbGRJbmRleCArIFwiXS5yZWFkb25seVwiLCBmdW5jdGlvbiAobmV3VmFsdWUsIG9sZFZhbHVlKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAobmV3VmFsdWUgIT09IHVuZGVmaW5lZCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHNjb3BlLnJlYWRPbmx5ID0gbmV3VmFsdWU7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pO1xyXG5cclxuXHJcbiAgICAgICAgICAgIC8vc2NvcGUuJHdhdGNoKFwiaXRlbXNbXCIgKyBzY29wZS5maWVsZEluZGV4ICsgXCJdLmRhdGFcIiwgZnVuY3Rpb24gKG5ld1ZhbHVlLCBvbGRWYWx1ZSkge1xyXG4gICAgICAgICAgICAvLyAgICAvLyAgaWYgKG5ld1ZhbHVlICE9PSB1bmRlZmluZWQgJiYgbmV3VmFsdWUgIT09IG9sZFZhbHVlKSB7XHJcbiAgICAgICAgICAgIC8vICAgIGlmIChuZXdWYWx1ZSAhPT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgICAgIC8vICAgICAgICBzY29wZS5pdGVtLnNob3dNZXNzYWdlID0gZmFsc2U7XHJcbiAgICAgICAgICAgIC8vICAgICAgICBpZiAoc2NvcGUucmVhZE9ubHkpIHtcclxuICAgICAgICAgICAgLy8gICAgICAgICAgICBzY29wZS5pdGVtLnJlYWRPbmx5VGV4dCA9IHNjb3BlLmRpc3BsYXlSZWFkT25seUZpZWxkKHNjb3BlLml0ZW0pO1xyXG4gICAgICAgICAgICAvLyAgICAgICAgfVxyXG4gICAgICAgICAgICAvLyAgICB9XHJcbiAgICAgICAgICAgIC8vfSwgdGhpcyk7XHJcblxyXG4gICAgICAgICAgICBzY29wZS4kb24oJ0ZJRUxELVZBTElEJywgZnVuY3Rpb24gKGV2ZW50LCB2YWx1ZSwga2V5SW5kZXgpIHtcclxuICAgICAgICAgICAgICAgIGlmIChzY29wZS5pdGVtcy5sZW5ndGggPj0ga2V5SW5kZXggJiYgc2NvcGUuaXRlbXNba2V5SW5kZXhdICE9PSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAodmFsdWUgPT09IHRydWUpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgc2NvcGUuaXRlbXNba2V5SW5kZXhdLnZhbGlkID0gdHJ1ZTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgc2NvcGUuaXRlbXNba2V5SW5kZXhdLnZhbGlkID0gZmFsc2U7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSk7XHJcblxyXG5cclxuICAgICAgICAgICAgc2NvcGUudGFiTW91c2VPdmVyID0gZnVuY3Rpb24gKGVsLCBzY29wZSwgaXRlbSkge1xyXG4gICAgICAgICAgICAgICAgJChlbC5zcmNFbGVtZW50KS5jc3MoJ2N1cnNvcicsIHNjb3BlLnRlbXBsYXRlT3B0aW9ucy5jdXJzb3IpO1xyXG4gICAgICAgICAgICB9O1xyXG5cclxuXHJcblxyXG4gICAgICAgICAgICBzY29wZS5kaXNwbGF5UmVhZE9ubHlGaWVsZCA9IGZ1bmN0aW9uIChpdGVtKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgcmV0dXJuVmFsdWUgPSBpdGVtLmRhdGEgIT0gbnVsbCA/IGl0ZW0uZGF0YSA6IFwiXCI7XHJcbiAgICAgICAgICAgICAgICBpZiAoaXRlbS50eXBlID09PSBcInNlbGVjdFwiIHx8IGl0ZW0udHlwZSA9PT0gXCJrZW5kb3NlbGVjdFwiIHx8IGl0ZW0udHlwZSA9PT0gXCJrZW5kb2NvbWJvYm94XCIpIHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm5WYWx1ZSA9IGl0ZW0uZGF0YVtpdGVtLnNlbGVjdE9wdGlvbnMuaXRlbS5kaXNwbGF5RmllbGRdO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmIChpdGVtLnR5cGUgPT09IFwibXVsdGlzZWxlY3RcIiB8fCBpdGVtLnR5cGUgPT09IFwibXVsdGlzZWxlY3RjaGVja2JveFwiIHx8IGl0ZW0udHlwZSA9PT0gXCJrZW5kb211bHRpc2VsZWN0XCIpIHtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgbGlzdCA9IFtdO1xyXG4gICAgICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSAwLCBsZW4gPSBpdGVtLmRhdGEubGVuZ3RoOyBpIDwgbGVuOyBpKyspIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIG9iaiA9IGl0ZW0uZGF0YVtpXTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGl0ZW0uc2VsZWN0T3B0aW9ucy5pdGVtLnNlY29uZERpc3BsYXlGaWVsZCAhPT0gdW5kZWZpbmVkICYmIGl0ZW0uc2VsZWN0T3B0aW9ucy5pdGVtLnNlY29uZERpc3BsYXlGaWVsZCAhPT0gbnVsbCAmJiBpdGVtLnNlbGVjdE9wdGlvbnMuaXRlbS5zZWNvbmREaXNwbGF5RmllbGQgIT09IFwiXCIpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsaXN0LnB1c2gob2JqW2l0ZW0uc2VsZWN0T3B0aW9ucy5pdGVtLmRpc3BsYXlGaWVsZF0gKyBcIiAvIFwiICsgb2JqW2l0ZW0uc2VsZWN0T3B0aW9ucy5pdGVtLnNlY29uZERpc3BsYXlGaWVsZF0pXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2VcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxpc3QucHVzaChvYmpbaXRlbS5zZWxlY3RPcHRpb25zLml0ZW0uZGlzcGxheUZpZWxkXSlcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuVmFsdWUgPSBsaXN0LmpvaW4oXCI7IFwiKTtcclxuICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoaXRlbS50eXBlID09PSBcImNoZWNrYm94XCIpIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoaXRlbS5kYXRhIHx8IGl0ZW0uZGF0YSA9PT0gMSB8fCBpdGVtLmRhdGEgPT09IFwidHJ1ZVwiKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm5WYWx1ZSA9IGl0ZW0udGVtcGxhdGVPcHRpb25zLnN1ZmZpeExhYmVsO1xyXG4gICAgICAgICAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoaXRlbS50ZW1wbGF0ZU9wdGlvbnMuc3VmZml4TGFiZWxmYWxzZSAhPT0gdW5kZWZpbmVkKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuVmFsdWUgPSBpdGVtLnRlbXBsYXRlT3B0aW9ucy5zdWZmaXhMYWJlbGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBlbHNlXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm5WYWx1ZSA9IFwiTm9cIjtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGl0ZW0udHlwZSA9PT0gXCJyYWRpb1wiKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIGl0ZW1zID0gaXRlbS50ZW1wbGF0ZU9wdGlvbnMuaXRlbXM7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIGZpbmRPYmogPSBuYXZjb24uZ2V0SXRlbUJ5S2V5VmFsdWUoaXRlbXMsIFwidmFsdWVcIiwgaXRlbS5kYXRhKTtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoZmluZE9iaiAhPT0gLTEpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGl0ZW0udGVtcGxhdGVPcHRpb25zLnN1ZmZpeExhYmVsZmFsc2UgIT09IHVuZGVmaW5lZClcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVyblZhbHVlID0gZmluZE9iai5zdWZmaXhMYWJlbDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgZWxzZVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuVmFsdWUgPSBmaW5kT2JqLmxhYmVsO1xyXG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChpdGVtLnRlbXBsYXRlT3B0aW9ucy5zdWZmaXhMYWJlbGZhbHNlICE9PSB1bmRlZmluZWQpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm5WYWx1ZSA9IGl0ZW1zWzBdLnN1ZmZpeExhYmVsO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBlbHNlXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm5WYWx1ZSA9IGl0ZW0uZGF0YTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm5WYWx1ZSA9IGl0ZW0uZGF0YTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIHJldHVybiByZXR1cm5WYWx1ZSAhPSB1bmRlZmluZWQgPyAocmV0dXJuVmFsdWUgIT0gbnVsbCA/IHJldHVyblZhbHVlIDogXCJcIikgOiBcIlwiO1xyXG4gICAgICAgICAgICB9O1xyXG5cclxuXHJcblxyXG4gICAgICAgICAgICBmdW5jdGlvbiBmaWVsZFNldHRpbmdzKHNjb3BlLCBlbCwgYXR0cnMsICRjb21waWxlKSB7XHJcblxyXG4gICAgICAgICAgICAgICAgaWYgKHNjb3BlLml0ZW0udHlwZSA9PT0gXCJrZW5kb2RhdGVcIikge1xyXG4gICAgICAgICAgICAgICAgICAgIGtlbmRvZGF0ZVNldHRpbmcoc2NvcGUsIGVsLCBhdHRycyk7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHNjb3BlLml0ZW0udHlwZSA9PT0gXCJrZW5kb2NvbWJvYm94XCIpIHtcclxuICAgICAgICAgICAgICAgICAgICBrZW5kb2NvbWJvYm94U2V0dGluZyhzY29wZSwgZWwsIGF0dHJzKTtcclxuICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoc2NvcGUuaXRlbS50eXBlID09PSBcImtlbmRvbnVtZXJpY3RleHRib3hcIikge1xyXG4gICAgICAgICAgICAgICAgICAgIGtlbmRvbnVtZXJpY3RleHRib3hTZXR0aW5nKHNjb3BlLCBlbCwgYXR0cnMpO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmIChzY29wZS5pdGVtLnR5cGUgPT09IFwia2VuZG9tYXNrZWR0ZXh0Ym94XCIpIHtcclxuICAgICAgICAgICAgICAgICAgICBrZW5kb21hc2tlZHRleHRib3hTZXR0aW5nKHNjb3BlLCBlbCwgYXR0cnMpO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmIChzY29wZS5pdGVtLnR5cGUgPT09IFwia2VuZG9jb2xvcnBpY2tlclwiKSB7XHJcbiAgICAgICAgICAgICAgICAgICAga2VuZG9jb2xvcnBpY2tlclNldHRpbmcoc2NvcGUsIGVsLCBhdHRycyk7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHNjb3BlLml0ZW0udHlwZSA9PT0gXCJrZW5kb3N3aXRjaFwiKSB7XHJcbiAgICAgICAgICAgICAgICAgICAga2VuZG9zd2l0Y2hTZXR0aW5nKHNjb3BlLCBlbCwgYXR0cnMpO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmIChzY29wZS5pdGVtLnR5cGUgPT09IFwia2VuZG9kYXRldGltZVwiKSB7XHJcbiAgICAgICAgICAgICAgICAgICAga2VuZG9kYXRldGltZVNldHRpbmcoc2NvcGUsIGVsLCBhdHRycyk7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHNjb3BlLml0ZW0udHlwZSA9PT0gXCJrZW5kb3RpbWVcIikge1xyXG4gICAgICAgICAgICAgICAgICAgIGtlbmRvdGltZVNldHRpbmcoc2NvcGUsIGVsLCBhdHRycyk7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHNjb3BlLml0ZW0udHlwZSA9PT0gXCJrZW5kb3NlbGVjdFwiKSB7XHJcbiAgICAgICAgICAgICAgICAgICAga2VuZG9zZWxlY3RTZXR0aW5nKHNjb3BlLCBlbCwgYXR0cnMpO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmIChzY29wZS5pdGVtLnR5cGUgPT09IFwia2VuZG9tdWx0aXNlbGVjdFwiKSB7XHJcbiAgICAgICAgICAgICAgICAgICAga2VuZG9tdWx0aVNlbGVjdFNldHRpbmcoc2NvcGUsIGVsLCBhdHRycyk7XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG5cclxuICAgICAgICAgICAgICAgIGlmICgkKGVsKS5pcygnW2NsYXNzKj1cImNvbC1zbVwiXScpKVxyXG4gICAgICAgICAgICAgICAgICAgICQoJzxkaXYgY2xhc3M9XCJjbGVhcmZpeCB2aXNpYmxlLXhzLWJsb2NrIHZpc2libGUtc20tYmxvY2tcIj48L2Rpdj4nKS5pbnNlcnRBZnRlcigkKGVsKSk7XHJcblxyXG4gICAgICAgICAgICAgICAgaWYgKHNjb3BlLml0ZW0udGVtcGxhdGVPcHRpb25zLmxhYmVsID09PSBcIlwiKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIGZpc3RPYmogPSAkKCQoZWwpLmZpbmQoXCJkaXZbbmctc2hvdyo9J1wiICsgc2NvcGUuaXRlbS50eXBlICsgXCInXVwiKVswXSkuZmluZCgnbGFiZWwnKS5maXJzdCgpO1xyXG4gICAgICAgICAgICAgICAgICAgIGZpc3RPYmouY3NzKFwiZGlzcGxheVwiLCBcIm5vbmVcIilcclxuICAgICAgICAgICAgICAgICAgICBmaXN0T2JqLm5leHQoKS5jc3MoXCJ3aWR0aFwiLCBcIjc5JVwiKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfTtcclxuXHJcbiAgICAgICAgICAgIGZ1bmN0aW9uIHNob3dNZXNzYWdnZVN0YXR1cyhzY29wZSwgJHRpbWVvdXQpIHtcclxuICAgICAgICAgICAgICAgIGlmIChzY29wZS5pbnZhbGlkID09PSB0cnVlICYmIChzY29wZS5pdGVtLnNob3dNZXNzYWdlID09PSB1bmRlZmluZWQgfHwgc2NvcGUuaXRlbS5zaG93TWVzc2FnZSA9PT0gZmFsc2UpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgc2NvcGUuaXRlbS5zaG93TWVzc2FnZSA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICAgJHRpbWVvdXQoZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBtZXNzYWdlKHNjb3BlKTtcclxuICAgICAgICAgICAgICAgICAgICB9LCA2MDAwKTtcclxuICAgICAgICAgICAgICAgIH07XHJcblxyXG4gICAgICAgICAgICAgICAgZnVuY3Rpb24gbWVzc2FnZShzY29wZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHNjb3BlLml0ZW0uc2hvd01lc3NhZ2UgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgIH07XHJcblxyXG5cclxuICAgICAgICAgICAgZnVuY3Rpb24gdGFiU2V0dGluZyhzY29wZSwgZWwsIGF0dHIpIHtcclxuICAgICAgICAgICAgICAgICQoZWwpLmZpbmQoJ2EnKS5jc3MoJ2N1cnNvcicsIHNjb3BlLml0ZW0udGVtcGxhdGVPcHRpb25zLmN1cnNvcik7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGZ1bmN0aW9uIGtlbmRvZGF0ZVNldHRpbmcoc2NvcGUsIGVsLCBhdHRyKSB7XHJcblxyXG5cclxuICAgICAgICAgICAgICAgIHZhciBvcHRpb25zID0ge307XHJcbiAgICAgICAgICAgICAgICBpZiAoc2NvcGUuaXRlbS50ZW1wbGF0ZU9wdGlvbnMgIT09IHVuZGVmaW5lZCkge1xyXG4gICAgICAgICAgICAgICAgICAgIG9wdGlvbnNbXCJmb3JtYXRcIl0gPSBcImRkL01NL3l5eXlcIjtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoc2NvcGUuaXRlbXNbc2NvcGUuZmllbGRJbmRleF0udGVtcGxhdGVPcHRpb25zLmRhdGVmb3JtYXQgIT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG9wdGlvbnNbXCJmb3JtYXRcIl0gPSBzY29wZS5pdGVtc1tzY29wZS5maWVsZEluZGV4XS50ZW1wbGF0ZU9wdGlvbnMuZGF0ZWZvcm1hdDtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgb3B0aW9uc1tcImRpc2FibGVEYXRlc1wiXSA9IGZ1bmN0aW9uIChkYXRlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChzY29wZS5pdGVtLnRlbXBsYXRlT3B0aW9ucy5mdXR1cmVEYXRlICE9PSB1bmRlZmluZWQgJiYgc2NvcGUuaXRlbS50ZW1wbGF0ZU9wdGlvbnMuZnV0dXJlRGF0ZSAhPT0gXCJcIiAmJiBzY29wZS5pdGVtLnRlbXBsYXRlT3B0aW9ucy5mdXR1cmVEYXRlKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGRhdGUgPCBuZXcgRGF0ZSgpO1xyXG4gICAgICAgICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHNjb3BlLml0ZW1zW3Njb3BlLmZpZWxkSW5kZXhdLnRlbXBsYXRlT3B0aW9ucy5wYXJzZUZvcm1hdHMgIT0gdW5kZWZpbmVkKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICBvcHRpb25zW1wicGFyc2VGb3JtYXRzXCJdID0gc2NvcGUuaXRlbXNbc2NvcGUuZmllbGRJbmRleF0udGVtcGxhdGVPcHRpb25zLnBhcnNlRm9ybWF0c1xyXG4gICAgICAgICAgICAgICAgICAgIG9wdGlvbnNbXCJjaGFuZ2VcIl0gPSBvbmtlbmRvZGF0ZUNoYW5nZTtcclxuICAgICAgICAgICAgICAgIH1cclxuXHJcblxyXG4gICAgICAgICAgICAgICAgdmFyIGVsZW1lbnQgPSAkKGVsKTtcclxuICAgICAgICAgICAgICAgIGVsZW1lbnQuZmluZChcImlucHV0XCIpLmtlbmRvRGF0ZVBpY2tlcihvcHRpb25zKTtcclxuXHJcbiAgICAgICAgICAgICAgICBpZiAoc2NvcGUuaXRlbS5kaXNhYmxlZCAhPT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIGRhdGVlbGVtZW50ID0gZWxlbWVudC5kYXRhKFwia2VuZG9EYXRlUGlja2VyXCIpO1xyXG4gICAgICAgICAgICAgICAgICAgIGRhdGVlbGVtZW50LmVuYWJsZSghKHNjb3BlLml0ZW0uZGlzYWJsZWQpKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfTtcclxuXHJcbiAgICAgICAgICAgIGZ1bmN0aW9uIG9ua2VuZG9kYXRlQ2hhbmdlKCkge1xyXG4gICAgICAgICAgICAgICAgc2NvcGUuaXRlbS5kYXRhID0gW107XHJcblxyXG4gICAgICAgICAgICAgICAgc2NvcGUuaXRlbS5kYXRhID0gdGhpcy5fb2xkVGV4dDtcclxuICAgICAgICAgICAgfVxyXG5cclxuXHJcbiAgICAgICAgICAgIGZ1bmN0aW9uIGtlbmRvc3dpdGNoU2V0dGluZyhzY29wZSwgZWwsIGF0dHIpIHtcclxuXHJcbiAgICAgICAgICAgICAgICB2YXIgb3B0aW9ucyA9IHt9O1xyXG4gICAgICAgICAgICAgICAgaWYgKHNjb3BlLml0ZW0udGVtcGxhdGVPcHRpb25zICE9PSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoc2NvcGUuaXRlbS50ZW1wbGF0ZU9wdGlvbnMub25MYWJlbCAhPT0gdW5kZWZpbmVkKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICBvcHRpb25zW1wib25MYWJlbFwiXSA9IHNjb3BlLml0ZW1zW3Njb3BlLmZpZWxkSW5kZXhdLnRlbXBsYXRlT3B0aW9ucy5vbkxhYmVsO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICBpZiAoc2NvcGUuaXRlbXNbc2NvcGUuZmllbGRJbmRleF0udGVtcGxhdGVPcHRpb25zLm9mZkxhYmVsICE9IHVuZGVmaW5lZCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBvcHRpb25zW1wib2ZmTGFiZWxcIl0gPSBzY29wZS5pdGVtc1tzY29wZS5maWVsZEluZGV4XS50ZW1wbGF0ZU9wdGlvbnMub2ZmTGFiZWw7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICAgICBvcHRpb25zW1wiY2hhbmdlXCJdID0gb25rZW5kb3N3aXRjaENoYW5nZTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIHZhciBlbGVtZW50ID0gJChlbCk7XHJcbiAgICAgICAgICAgICAgICBlbGVtZW50LmZpbmQoXCJpbnB1dFwiKS5rZW5kb01vYmlsZVN3aXRjaChvcHRpb25zKTtcclxuXHJcbiAgICAgICAgICAgICAgICBpZiAoc2NvcGUuaXRlbS5kaXNhYmxlZCAhPT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIGRhdGVlbGVtZW50ID0gZWxlbWVudC5kYXRhKFwia2VuZG9Nb2JpbGVTd2l0Y2hcIik7XHJcbiAgICAgICAgICAgICAgICAgICAgZGF0ZWVsZW1lbnQuZW5hYmxlKCEoc2NvcGUuaXRlbS5kaXNhYmxlZCkpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9O1xyXG5cclxuICAgICAgICAgICAgZnVuY3Rpb24gb25rZW5kb3N3aXRjaENoYW5nZShlKSB7XHJcbiAgICAgICAgICAgICAgICBzY29wZS5pdGVtLmRhdGEgPSBbXTtcclxuXHJcbiAgICAgICAgICAgICAgICBzY29wZS5pdGVtLmRhdGEgPSBlLmNoZWNrZWQ7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGZ1bmN0aW9uIGtlbmRvZGF0ZXRpbWVTZXR0aW5nKHNjb3BlLCBlbCwgYXR0cikge1xyXG5cclxuICAgICAgICAgICAgICAgIHZhciBvcHRpb25zID0ge307XHJcbiAgICAgICAgICAgICAgICBpZiAoc2NvcGUuaXRlbS50ZW1wbGF0ZU9wdGlvbnMgIT09IHVuZGVmaW5lZCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChzY29wZS5pdGVtLnRlbXBsYXRlT3B0aW9ucy5ob3VyczI0ICE9PSB1bmRlZmluZWQgJiYgc2NvcGUuaXRlbS50ZW1wbGF0ZU9wdGlvbnMuaG91cnMyNClcclxuICAgICAgICAgICAgICAgICAgICAgICAgb3B0aW9uc1tcInRpbWVGb3JtYXRcIl0gPSBcIkhIOm1tXCI7XHJcbiAgICAgICAgICAgICAgICAgICAgb3B0aW9uc1tcImZvcm1hdFwiXSA9IFwiZGQvTU0veXl5eSBISDptbVwiO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChzY29wZS5pdGVtc1tzY29wZS5maWVsZEluZGV4XS50ZW1wbGF0ZU9wdGlvbnMuZGF0ZWZvcm1hdCAhPSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgb3B0aW9uc1tcImZvcm1hdFwiXSA9IHNjb3BlLml0ZW1zW3Njb3BlLmZpZWxkSW5kZXhdLnRlbXBsYXRlT3B0aW9ucy5kYXRlZm9ybWF0O1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBvcHRpb25zW1wiZGlzYWJsZURhdGVzXCJdID0gZnVuY3Rpb24gKGRhdGUpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHNjb3BlLml0ZW0udGVtcGxhdGVPcHRpb25zLmZ1dHVyZURhdGUgIT09IHVuZGVmaW5lZCAmJiBzY29wZS5pdGVtLnRlbXBsYXRlT3B0aW9ucy5mdXR1cmVEYXRlICE9PSBcIlwiICYmIHNjb3BlLml0ZW0udGVtcGxhdGVPcHRpb25zLmZ1dHVyZURhdGUpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZGF0ZSA8IG5ldyBEYXRlKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoc2NvcGUuaXRlbXNbc2NvcGUuZmllbGRJbmRleF0udGVtcGxhdGVPcHRpb25zLnBhcnNlRm9ybWF0cyAhPSB1bmRlZmluZWQpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG9wdGlvbnNbXCJwYXJzZUZvcm1hdHNcIl0gPSBzY29wZS5pdGVtc1tzY29wZS5maWVsZEluZGV4XS50ZW1wbGF0ZU9wdGlvbnMucGFyc2VGb3JtYXRzXHJcbiAgICAgICAgICAgICAgICAgICAgb3B0aW9uc1tcImNoYW5nZVwiXSA9IG9ua2VuZG9kYXRldGltZUNoYW5nZTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIHZhciBlbGVtZW50ID0gJChlbCk7XHJcbiAgICAgICAgICAgICAgICBlbGVtZW50LmZpbmQoXCJpbnB1dFwiKS5rZW5kb0RhdGVUaW1lUGlja2VyKG9wdGlvbnMpO1xyXG5cclxuICAgICAgICAgICAgICAgIGlmIChzY29wZS5pdGVtLmRpc2FibGVkICE9PSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgZGF0ZWVsZW1lbnQgPSBlbGVtZW50LmRhdGEoXCJrZW5kb0RhdGVUaW1lUGlja2VyXCIpO1xyXG4gICAgICAgICAgICAgICAgICAgIGRhdGVlbGVtZW50LmVuYWJsZSghKHNjb3BlLml0ZW0uZGlzYWJsZWQpKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfTtcclxuXHJcbiAgICAgICAgICAgIGZ1bmN0aW9uIG9ua2VuZG9kYXRldGltZUNoYW5nZSgpIHtcclxuICAgICAgICAgICAgICAgIHNjb3BlLml0ZW0uZGF0YSA9IFtdO1xyXG5cclxuICAgICAgICAgICAgICAgIHNjb3BlLml0ZW0uZGF0YSA9IHRoaXMuX29sZFRleHQ7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGZ1bmN0aW9uIGtlbmRvdGltZVNldHRpbmcoc2NvcGUsIGVsLCBhdHRyKSB7XHJcblxyXG4gICAgICAgICAgICAgICAgdmFyIG9wdGlvbnMgPSB7fTtcclxuICAgICAgICAgICAgICAgIGlmIChzY29wZS5pdGVtLnRlbXBsYXRlT3B0aW9ucyAhPT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHNjb3BlLml0ZW0udGVtcGxhdGVPcHRpb25zLmhvdXJzMjQgIT09IHVuZGVmaW5lZCAmJiBzY29wZS5pdGVtLnRlbXBsYXRlT3B0aW9ucy5ob3VyczI0KVxyXG4gICAgICAgICAgICAgICAgICAgICAgICBvcHRpb25zW1widGltZUZvcm1hdFwiXSA9IFwiSEg6bW1cIjtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHNjb3BlLml0ZW1zW3Njb3BlLmZpZWxkSW5kZXhdLnRlbXBsYXRlT3B0aW9ucy5wYXJzZUZvcm1hdHMgIT0gdW5kZWZpbmVkKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICBvcHRpb25zW1wicGFyc2VGb3JtYXRzXCJdID0gc2NvcGUuaXRlbXNbc2NvcGUuZmllbGRJbmRleF0udGVtcGxhdGVPcHRpb25zLnBhcnNlRm9ybWF0c1xyXG4gICAgICAgICAgICAgICAgICAgIG9wdGlvbnNbXCJjaGFuZ2VcIl0gPSBvbmtlbmRvdGltZUNoYW5nZTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIHZhciBlbGVtZW50ID0gJChlbCk7XHJcbiAgICAgICAgICAgICAgICBlbGVtZW50LmZpbmQoXCJpbnB1dFwiKS5rZW5kb1RpbWVQaWNrZXIob3B0aW9ucyk7XHJcblxyXG4gICAgICAgICAgICAgICAgaWYgKHNjb3BlLml0ZW0uZGlzYWJsZWQgIT09IHVuZGVmaW5lZCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBkYXRlZWxlbWVudCA9IGVsZW1lbnQuZGF0YShcImtlbmRvVGltZVBpY2tlclwiKTtcclxuICAgICAgICAgICAgICAgICAgICBkYXRlZWxlbWVudC5lbmFibGUoIShzY29wZS5pdGVtLmRpc2FibGVkKSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH07XHJcblxyXG4gICAgICAgICAgICBmdW5jdGlvbiBvbmtlbmRvdGltZUNoYW5nZSgpIHtcclxuICAgICAgICAgICAgICAgIHNjb3BlLml0ZW0uZGF0YSA9IFtdO1xyXG5cclxuICAgICAgICAgICAgICAgIHNjb3BlLml0ZW0uZGF0YSA9IHRoaXMuX29sZFRleHQ7XHJcbiAgICAgICAgICAgIH1cclxuXHJcblxyXG5cclxuICAgICAgICAgICAgZnVuY3Rpb24ga2VuZG9jb2xvcnBpY2tlclNldHRpbmcoc2NvcGUsIGVsLCBhdHRyKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIga2V5SW5kZXggPSBuYXZjb24uZ2V0SXRlbUluZGV4QnlQcm9wZXJ0eShzY29wZS5pdGVtcywgc2NvcGUuaXRlbS5rZXkpO1xyXG4gICAgICAgICAgICAgICAgaWYgKHNjb3BlLml0ZW1zW2tleUluZGV4XS50eXBlID09PSBcImtlbmRvY29sb3JwaWNrZXJcIilcclxuICAgICAgICAgICAgICAgICAgICBpZiAoc2NvcGUuaXRlbXNba2V5SW5kZXhdLmRhdGEgPT09IHVuZGVmaW5lZCB8fCBzY29wZS5pdGVtc1trZXlJbmRleF0uZGF0YSA9PT0gXCJcIikgc2NvcGUuaXRlbXNba2V5SW5kZXhdLmRhdGEgPSBbXTtcclxuXHJcbiAgICAgICAgICAgICAgICB2YXIgb3B0aW9ucyA9IHt9O1xyXG4gICAgICAgICAgICAgICAgaWYgKHNjb3BlLml0ZW0udGVtcGxhdGVPcHRpb25zICE9PSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoc2NvcGUuaXRlbS50ZW1wbGF0ZU9wdGlvbnMuYnV0dG9ucyAhPT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG9wdGlvbnNbXCJidXR0b25zXCJdID0gc2NvcGUuaXRlbS50ZW1wbGF0ZU9wdGlvbnMuYnV0dG9ucztcclxuICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG5cclxuICAgICAgICAgICAgICAgICAgICBvcHRpb25zW1wic2VsZWN0XCJdID0gb25rZW5kb2NvbG9ycGlja2VyU2VsZWN0O1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuXHJcblxyXG5cclxuICAgICAgICAgICAgICAgIHZhciBlbGVtZW50ID0gJCgkKGVsKS5maW5kKCdpbnB1dCcpKTtcclxuICAgICAgICAgICAgICAgIGVsZW1lbnQua2VuZG9Db2xvclBpY2tlcihvcHRpb25zKTtcclxuXHJcbiAgICAgICAgICAgICAgICBpZiAoc2NvcGUuaXRlbS5kaXNhYmxlZCAhPT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIGNvbG9yYm94RmllbGQgPSBlbGVtZW50LmRhdGEoXCJrZW5kb0NvbG9yUGlja2VyXCIpO1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbG9yYm94RmllbGQuZW5hYmxlKCEoc2NvcGUuaXRlbS5kaXNhYmxlZCkpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuXHJcbiAgICAgICAgICAgICAgICBzY29wZS4kd2F0Y2goXCJpdGVtc1tcIiArIGtleUluZGV4ICsgXCJdLmRhdGFcIiwgZnVuY3Rpb24gKG5ld1ZhbHVlLCBvbGRWYWx1ZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChuZXdWYWx1ZSAhPT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBjb2xvcmJveEZpZWxkID0gZWxlbWVudC5kYXRhKFwia2VuZG9Db2xvclBpY2tlclwiKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY29sb3Jib3hGaWVsZC52YWx1ZShuZXdWYWx1ZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBmdW5jdGlvbiBvbmtlbmRvY29sb3JwaWNrZXJTZWxlY3QoKSB7XHJcbiAgICAgICAgICAgICAgICBzY29wZS5pdGVtLmRhdGEgPSB0aGlzLnZhbHVlKCk7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGZ1bmN0aW9uIGtlbmRvbWFza2VkdGV4dGJveFNldHRpbmcoc2NvcGUsIGVsLCBhdHRyKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIga2V5SW5kZXggPSBuYXZjb24uZ2V0SXRlbUluZGV4QnlQcm9wZXJ0eShzY29wZS5pdGVtcywgc2NvcGUuaXRlbS5rZXkpO1xyXG4gICAgICAgICAgICAgICAgaWYgKHNjb3BlLml0ZW1zW2tleUluZGV4XS50eXBlID09PSBcImtlbmRvbWFza2VkdGV4dGJveFwiKVxyXG4gICAgICAgICAgICAgICAgICAgIGlmIChzY29wZS5pdGVtc1trZXlJbmRleF0uZGF0YSA9PT0gdW5kZWZpbmVkIHx8IHNjb3BlLml0ZW1zW2tleUluZGV4XS5kYXRhID09PSBcIlwiKSBzY29wZS5pdGVtc1trZXlJbmRleF0uZGF0YSA9IFtdO1xyXG5cclxuICAgICAgICAgICAgICAgIHZhciBvcHRpb25zID0ge307XHJcbiAgICAgICAgICAgICAgICBpZiAoc2NvcGUuaXRlbS50ZW1wbGF0ZU9wdGlvbnMgIT09IHVuZGVmaW5lZCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChzY29wZS5pdGVtLnRlbXBsYXRlT3B0aW9ucy5tYXNrICE9PSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgb3B0aW9uc1tcIm1hc2tcIl0gPSBzY29wZS5pdGVtLnRlbXBsYXRlT3B0aW9ucy5tYXNrO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuXHJcblxyXG4gICAgICAgICAgICAgICAgICAgIG9wdGlvbnNbXCJjaGFuZ2VcIl0gPSBvbmtlbmRvbWFza2VkdGV4dGJveENoYW5nZTtcclxuICAgICAgICAgICAgICAgIH1cclxuXHJcblxyXG5cclxuXHJcbiAgICAgICAgICAgICAgICB2YXIgZWxlbWVudCA9ICQoJChlbCkuZmluZCgnaW5wdXQnKSk7XHJcbiAgICAgICAgICAgICAgICBlbGVtZW50LmtlbmRvTWFza2VkVGV4dEJveChvcHRpb25zKTtcclxuXHJcbiAgICAgICAgICAgICAgICBpZiAoc2NvcGUuaXRlbS5kaXNhYmxlZCAhPT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIHRleHRib3hGaWVsZCA9IGVsZW1lbnQuZGF0YShcImtlbmRvTWFza2VkVGV4dEJveFwiKTtcclxuICAgICAgICAgICAgICAgICAgICB0ZXh0Ym94RmllbGQuZW5hYmxlKCEoc2NvcGUuaXRlbS5kaXNhYmxlZCkpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuXHJcblxyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBmdW5jdGlvbiBvbmtlbmRvbWFza2VkdGV4dGJveENoYW5nZSgpIHtcclxuICAgICAgICAgICAgICAgIHNjb3BlLml0ZW0uZGF0YSA9IHRoaXMudmFsdWUoKS5yZXBsYWNlKC9bLSAoKV0vZywgJycpO1xyXG4gICAgICAgICAgICB9XHJcblxyXG5cclxuICAgICAgICAgICAgZnVuY3Rpb24ga2VuZG9udW1lcmljdGV4dGJveFNldHRpbmcoc2NvcGUsIGVsLCBhdHRyKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIga2V5SW5kZXggPSBuYXZjb24uZ2V0SXRlbUluZGV4QnlQcm9wZXJ0eShzY29wZS5pdGVtcywgc2NvcGUuaXRlbS5rZXkpO1xyXG4gICAgICAgICAgICAgICAgaWYgKHNjb3BlLml0ZW1zW2tleUluZGV4XS50eXBlID09PSBcImtlbmRvbnVtZXJpY3RleHRib3hcIilcclxuICAgICAgICAgICAgICAgICAgICBpZiAoc2NvcGUuaXRlbXNba2V5SW5kZXhdLmRhdGEgPT09IHVuZGVmaW5lZCB8fCBzY29wZS5pdGVtc1trZXlJbmRleF0uZGF0YSA9PT0gXCJcIikgc2NvcGUuaXRlbXNba2V5SW5kZXhdLmRhdGEgPSBbXTtcclxuXHJcbiAgICAgICAgICAgICAgICB2YXIgb3B0aW9ucyA9IHt9O1xyXG4gICAgICAgICAgICAgICAgaWYgKHNjb3BlLml0ZW0udGVtcGxhdGVPcHRpb25zICE9PSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoc2NvcGUuaXRlbS50ZW1wbGF0ZU9wdGlvbnMuZm9ybWF0ICE9PSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgb3B0aW9uc1tcImZvcm1hdFwiXSA9IHNjb3BlLml0ZW0udGVtcGxhdGVPcHRpb25zLmZvcm1hdDtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHNjb3BlLml0ZW0udGVtcGxhdGVPcHRpb25zLmRlY2ltYWxzICE9PSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgb3B0aW9uc1tcImRlY2ltYWxzXCJdID0gc2NvcGUuaXRlbS50ZW1wbGF0ZU9wdGlvbnMuZGVjaW1hbHM7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICAgICBpZiAoc2NvcGUuaXRlbS50ZW1wbGF0ZU9wdGlvbnMubWluICE9PSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgb3B0aW9uc1tcIm1pblwiXSA9IHNjb3BlLml0ZW0udGVtcGxhdGVPcHRpb25zLm1pbjtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGlmIChzY29wZS5pdGVtLnRlbXBsYXRlT3B0aW9ucy5tYXggIT09IHVuZGVmaW5lZCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBvcHRpb25zW1wibWF4XCJdID0gc2NvcGUuaXRlbS50ZW1wbGF0ZU9wdGlvbnMubWF4O1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHNjb3BlLml0ZW0udGVtcGxhdGVPcHRpb25zLnN0ZXAgIT09IHVuZGVmaW5lZCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBvcHRpb25zW1wic3RlcFwiXSA9IHNjb3BlLml0ZW0udGVtcGxhdGVPcHRpb25zLnN0ZXA7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICAgICBpZiAoc2NvcGUuaXRlbS50ZW1wbGF0ZU9wdGlvbnMucm91bmQgIT09IHVuZGVmaW5lZCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBvcHRpb25zW1wicm91bmRcIl0gPSBzY29wZS5pdGVtLnRlbXBsYXRlT3B0aW9ucy5yb3VuZDtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGlmIChzY29wZS5pdGVtLnRlbXBsYXRlT3B0aW9ucy5yZXN0cmljdERlY2ltYWxzICE9PSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgb3B0aW9uc1tcInJlc3RyaWN0RGVjaW1hbHNcIl0gPSBzY29wZS5pdGVtLnRlbXBsYXRlT3B0aW9ucy5yZXN0cmljdERlY2ltYWxzO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHNjb3BlLml0ZW0udGVtcGxhdGVPcHRpb25zLnBsYWNlaG9sZGVyICE9PSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgb3B0aW9uc1tcInBsYWNlaG9sZGVyXCJdID0gc2NvcGUuaXRlbS50ZW1wbGF0ZU9wdGlvbnMucGxhY2Vob2xkZXI7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICAgICBvcHRpb25zW1wiY2hhbmdlXCJdID0gb25rZW5kb251bWVyaWN0ZXh0Ym94Q2hhbmdlO1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuXHJcblxyXG5cclxuICAgICAgICAgICAgICAgIHZhciBlbGVtZW50ID0gJCgkKGVsKS5maW5kKCdpbnB1dCcpKTtcclxuICAgICAgICAgICAgICAgIGVsZW1lbnQua2VuZG9OdW1lcmljVGV4dEJveChvcHRpb25zKTtcclxuXHJcbiAgICAgICAgICAgICAgICBpZiAoc2NvcGUuaXRlbS5kaXNhYmxlZCAhPT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIHRleHRib3hGaWVsZCA9IGVsZW1lbnQuZGF0YShcImtlbmRvTnVtZXJpY1RleHRCb3hcIik7XHJcbiAgICAgICAgICAgICAgICAgICAgdGV4dGJveEZpZWxkLmVuYWJsZSghKHNjb3BlLml0ZW0uZGlzYWJsZWQpKTtcclxuICAgICAgICAgICAgICAgIH1cclxuXHJcblxyXG5cclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgZnVuY3Rpb24gb25rZW5kb251bWVyaWN0ZXh0Ym94Q2hhbmdlKCkge1xyXG4gICAgICAgICAgICAgICAgc2NvcGUuaXRlbS5kYXRhID0gdGhpcy52YWx1ZSgpO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBmdW5jdGlvbiBrZW5kb2NvbWJvYm94U2V0dGluZyhzY29wZSwgZWwsIGF0dHIpIHtcclxuICAgICAgICAgICAgICAgIHZhciBrZXlJbmRleCA9IG5hdmNvbi5nZXRJdGVtSW5kZXhCeVByb3BlcnR5KHNjb3BlLml0ZW1zLCBzY29wZS5pdGVtLmtleSk7XHJcbiAgICAgICAgICAgICAgICBpZiAoc2NvcGUuaXRlbXNba2V5SW5kZXhdLnR5cGUgPT09IFwia2VuZG9jb21ib2JveFwiKVxyXG4gICAgICAgICAgICAgICAgICAgIGlmIChzY29wZS5pdGVtc1trZXlJbmRleF0uZGF0YSA9PT0gdW5kZWZpbmVkIHx8IHNjb3BlLml0ZW1zW2tleUluZGV4XS5kYXRhID09PSBcIlwiKSBzY29wZS5pdGVtc1trZXlJbmRleF0uZGF0YSA9IFtdO1xyXG5cclxuICAgICAgICAgICAgICAgIHZhciBvcHRpb25zID0ge307XHJcbiAgICAgICAgICAgICAgICBpZiAoc2NvcGUuaXRlbS50ZW1wbGF0ZU9wdGlvbnMgIT09IHVuZGVmaW5lZCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChzY29wZS5pdGVtLnNlbGVjdE9wdGlvbnMuaXRlbS5maWx0ZXIgIT09IHVuZGVmaW5lZCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBvcHRpb25zW1wiZmlsdGVyXCJdID0gc2NvcGUuaXRlbS5zZWxlY3RPcHRpb25zLml0ZW0uZmlsdGVyO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBpZiAoc2NvcGUuaXRlbS5zZWxlY3RPcHRpb25zLml0ZW0uYXV0b0JpbmQgIT09IHVuZGVmaW5lZCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBvcHRpb25zW1wiYXV0b0JpbmRcIl0gPSBzY29wZS5pdGVtLnNlbGVjdE9wdGlvbnMuaXRlbS5hdXRvQmluZDtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHNjb3BlLml0ZW0uc2VsZWN0T3B0aW9ucy5pdGVtLmF1dG9CaW5kICE9PSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgb3B0aW9uc1tcImF1dG9CaW5kXCJdID0gc2NvcGUuaXRlbS5zZWxlY3RPcHRpb25zLml0ZW0uYXV0b0JpbmQ7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIGlmIChzY29wZS5pdGVtLnNlbGVjdE9wdGlvbnMuaXRlbS5taW5MZW5ndGggIT09IHVuZGVmaW5lZCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBvcHRpb25zW1wibWluTGVuZ3RoXCJdID0gc2NvcGUuaXRlbS5zZWxlY3RPcHRpb25zLml0ZW0ubWluTGVuZ3RoO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBpZiAoc2NvcGUuaXRlbS5zZWxlY3RPcHRpb25zLml0ZW0uZGlzcGxheUZpZWxkICE9PSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgb3B0aW9uc1tcImRhdGFUZXh0RmllbGRcIl0gPSBzY29wZS5pdGVtLnNlbGVjdE9wdGlvbnMuaXRlbS5kaXNwbGF5RmllbGQ7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIGlmIChzY29wZS5pdGVtLnNlbGVjdE9wdGlvbnMuaXRlbS5kYXRhRmllbGQgIT09IHVuZGVmaW5lZCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBvcHRpb25zW1wiZGF0YVZhbHVlRmllbGRcIl0gPSBzY29wZS5pdGVtLnNlbGVjdE9wdGlvbnMuaXRlbS5kYXRhRmllbGQ7XHJcbiAgICAgICAgICAgICAgICAgICAgfSBpZiAoc2NvcGUuaXRlbS5zZWxlY3RPcHRpb25zLnBsYWNlaG9sZGVyICE9PSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgb3B0aW9uc1tcInBsYWNlaG9sZGVyXCJdID0gc2NvcGUuaXRlbS50ZW1wbGF0ZU9wdGlvbnMucGxhY2Vob2xkZXI7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIGlmIChzY29wZS5pdGVtLnNlbGVjdE9wdGlvbnMuaXRlbS5ncm91cCAhPT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG9wdGlvbnNbXCJkYXRhU291cmNlXCJdID0geyBkYXRhOiBzY29wZS5pdGVtLnNlbGVjdE9wdGlvbnMuaXRlbXMsIGdyb3VwOiB7IGZpZWxkOiBzY29wZS5pdGVtLnNlbGVjdE9wdGlvbnMuaXRlbS5ncm91cEZpZWxkIH0gfVxyXG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG9wdGlvbnNbXCJkYXRhU291cmNlXCJdID0geyBkYXRhOiBzY29wZS5pdGVtLnNlbGVjdE9wdGlvbnMuaXRlbXMgfVxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHNjb3BlLml0ZW0uc2VsZWN0T3B0aW9ucy5pdGVtLmhlYWRlclRlbXBsYXRlICE9PSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgb3B0aW9uc1tcImhlYWRlclRlbXBsYXRlXCJdID0gc2NvcGUuaXRlbS5zZWxlY3RPcHRpb25zLml0ZW0uaGVhZGVyVGVtcGxhdGU7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIGlmIChzY29wZS5pdGVtLnNlbGVjdE9wdGlvbnMuaXRlbS5mb290ZXJUZW1wbGF0ZSAhPT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG9wdGlvbnNbXCJmb290ZXJUZW1wbGF0ZVwiXSA9IHNjb3BlLml0ZW0uc2VsZWN0T3B0aW9ucy5pdGVtLmZvb3RlclRlbXBsYXRlO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBpZiAoc2NvcGUuaXRlbS5zZWxlY3RPcHRpb25zLml0ZW0udGVtcGxhdGUgIT09IHVuZGVmaW5lZCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBvcHRpb25zW1widGVtcGxhdGVcIl0gPSBzY29wZS5pdGVtLnNlbGVjdE9wdGlvbnMuaXRlbS50ZW1wbGF0ZTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgb3B0aW9uc1tcInNlbGVjdFwiXSA9IG9ua2VuZG9jb21ib0JveHNlbGVjdDtcclxuICAgICAgICAgICAgICAgIH1cclxuXHJcblxyXG5cclxuXHJcbiAgICAgICAgICAgICAgICB2YXIgZWxlbWVudCA9ICQoJChlbCkuZmluZCgnaW5wdXQnKSk7XHJcbiAgICAgICAgICAgICAgICBlbGVtZW50LmtlbmRvQ29tYm9Cb3gob3B0aW9ucyk7XHJcblxyXG4gICAgICAgICAgICAgICAgaWYgKHNjb3BlLml0ZW0uZGlzYWJsZWQgIT09IHVuZGVmaW5lZCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBkcm9wc2VsZWN0ID0gZWxlbWVudC5kYXRhKFwia2VuZG9Db21ib0JveFwiKTtcclxuICAgICAgICAgICAgICAgICAgICBkcm9wc2VsZWN0LmVuYWJsZSghKHNjb3BlLml0ZW0uZGlzYWJsZWQpKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIHNjb3BlLiR3YXRjaChcIml0ZW1zW1wiICsga2V5SW5kZXggKyBcIl0uc2VsZWN0T3B0aW9ucy5pdGVtc1wiLCBmdW5jdGlvbiAobmV3VmFsdWUsIG9sZFZhbHVlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKG5ld1ZhbHVlICE9PSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHNpbmdsZXNlbGVjdCA9IGVsZW1lbnQuZGF0YShcImtlbmRvQ29tYm9Cb3hcIik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHNpbmdsZXNlbGVjdC5kYXRhU291cmNlLmRhdGEobmV3VmFsdWUpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyQobXVsdGlzZWxlY3Qud3JhcHBlcikuYWRkQ2xhc3Moc2NvcGUuZmllbGRDbGFzcyk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICAgICAgc2NvcGUuJHdhdGNoKFwiaXRlbXNbXCIgKyBrZXlJbmRleCArIFwiXS5kYXRhXCIsIGZ1bmN0aW9uIChuZXdWYWx1ZSwgb2xkVmFsdWUpIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAobmV3VmFsdWUgIT09IHVuZGVmaW5lZCAmJiBuZXdWYWx1ZVtzY29wZS5pdGVtLnNlbGVjdE9wdGlvbnMuaXRlbS5kYXRhRmllbGRdICE9IHVuZGVmaW5lZCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgZHJvcHNlbGVjdCA9IGVsZW1lbnQuZGF0YShcImtlbmRvQ29tYm9Cb3hcIik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGRyb3BzZWxlY3QudmFsdWUobmV3VmFsdWVbc2NvcGUuaXRlbS5zZWxlY3RPcHRpb25zLml0ZW0uZGF0YUZpZWxkXSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGRyb3BzZWxlY3QgPSBlbGVtZW50LmRhdGEoXCJrZW5kb0NvbWJvQm94XCIpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBkcm9wc2VsZWN0LnZhbHVlKFwiXCIpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGZ1bmN0aW9uIG9ua2VuZG9jb21ib0JveHNlbGVjdChlKSB7XHJcbiAgICAgICAgICAgICAgICBzY29wZS5pdGVtLmRhdGEgPSBbXTtcclxuXHJcbiAgICAgICAgICAgICAgICBzY29wZS5pdGVtLmRhdGEgPSBlLmRhdGFJdGVtO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBmdW5jdGlvbiBrZW5kb3NlbGVjdFNldHRpbmcoc2NvcGUsIGVsLCBhdHRyKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIga2V5SW5kZXggPSBuYXZjb24uZ2V0SXRlbUluZGV4QnlQcm9wZXJ0eShzY29wZS5pdGVtcywgc2NvcGUuaXRlbS5rZXkpO1xyXG4gICAgICAgICAgICAgICAgaWYgKHNjb3BlLml0ZW1zW2tleUluZGV4XS50eXBlID09PSBcImtlbmRvc2VsZWN0XCIpXHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHNjb3BlLml0ZW1zW2tleUluZGV4XS5kYXRhID09PSB1bmRlZmluZWQgfHwgc2NvcGUuaXRlbXNba2V5SW5kZXhdLmRhdGEgPT09IFwiXCIpIHNjb3BlLml0ZW1zW2tleUluZGV4XS5kYXRhID0gW107XHJcblxyXG4gICAgICAgICAgICAgICAgdmFyIG9wdGlvbnMgPSB7fTtcclxuICAgICAgICAgICAgICAgIGlmIChzY29wZS5pdGVtLnRlbXBsYXRlT3B0aW9ucyAhPT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHNjb3BlLml0ZW0uc2VsZWN0T3B0aW9ucy5pdGVtLmRpc3BsYXlGaWVsZCAhPT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG9wdGlvbnNbXCJkYXRhVGV4dEZpZWxkXCJdID0gc2NvcGUuaXRlbS5zZWxlY3RPcHRpb25zLml0ZW0uZGlzcGxheUZpZWxkO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBpZiAoc2NvcGUuaXRlbS5zZWxlY3RPcHRpb25zLml0ZW0uZGF0YUZpZWxkICE9PSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgb3B0aW9uc1tcImRhdGFWYWx1ZUZpZWxkXCJdID0gc2NvcGUuaXRlbS5zZWxlY3RPcHRpb25zLml0ZW0uZGF0YUZpZWxkO1xyXG4gICAgICAgICAgICAgICAgICAgIH0gaWYgKHNjb3BlLml0ZW0uc2VsZWN0T3B0aW9ucy5wbGFjZWhvbGRlciAhPT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG9wdGlvbnNbXCJwbGFjZWhvbGRlclwiXSA9IHNjb3BlLml0ZW0udGVtcGxhdGVPcHRpb25zLnBsYWNlaG9sZGVyO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBvcHRpb25zW1wiZGF0YVNvdXJjZVwiXSA9IHsgZGF0YTogc2NvcGUuaXRlbS5zZWxlY3RPcHRpb25zLml0ZW1zIH1cclxuICAgICAgICAgICAgICAgICAgICBvcHRpb25zW1wic2VsZWN0XCJdID0gb25rZW5kb3NlbGVjdDtcclxuICAgICAgICAgICAgICAgIH1cclxuXHJcblxyXG5cclxuXHJcbiAgICAgICAgICAgICAgICB2YXIgZWxlbWVudCA9ICQoJChlbCkuZmluZCgnc2VsZWN0JykpO1xyXG4gICAgICAgICAgICAgICAgZWxlbWVudC5rZW5kb0Ryb3BEb3duTGlzdChvcHRpb25zKTtcclxuXHJcbiAgICAgICAgICAgICAgICBpZiAoc2NvcGUuaXRlbS5kaXNhYmxlZCAhPT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIGRyb3BzZWxlY3QgPSBlbGVtZW50LmRhdGEoXCJrZW5kb0Ryb3BEb3duTGlzdFwiKTtcclxuICAgICAgICAgICAgICAgICAgICBkcm9wc2VsZWN0LmVuYWJsZSghKHNjb3BlLml0ZW0uZGlzYWJsZWQpKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIHNjb3BlLiR3YXRjaChcIml0ZW1zW1wiICsga2V5SW5kZXggKyBcIl0uc2VsZWN0T3B0aW9ucy5pdGVtc1wiLCBmdW5jdGlvbiAobmV3VmFsdWUsIG9sZFZhbHVlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKG5ld1ZhbHVlICE9PSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHNpbmdsZXNlbGVjdCA9IGVsZW1lbnQuZGF0YShcImtlbmRvRHJvcERvd25MaXN0XCIpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBzaW5nbGVzZWxlY3QuZGF0YVNvdXJjZS5kYXRhKG5ld1ZhbHVlKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgLy8kKG11bHRpc2VsZWN0LndyYXBwZXIpLmFkZENsYXNzKHNjb3BlLmZpZWxkQ2xhc3MpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgICAgIC8vc2NvcGUuJHdhdGNoKFwiaXRlbXNbXCIgKyBrZXlJbmRleCArIFwiXS5kYXRhXCIsIGZ1bmN0aW9uIChuZXdWYWx1ZSwgb2xkVmFsdWUpIHtcclxuICAgICAgICAgICAgICAgIC8vICAgIGlmIChuZXdWYWx1ZSAhPT0gdW5kZWZpbmVkICYmIG5ld1ZhbHVlW3Njb3BlLml0ZW0uc2VsZWN0T3B0aW9ucy5pdGVtLmRhdGFGaWVsZF0gIT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgICAgICAgICAvLyAgICAgICAgdmFyIGRyb3BzZWxlY3QgPSBlbGVtZW50LmRhdGEoXCJrZW5kb0Ryb3BEb3duTGlzdFwiKTtcclxuICAgICAgICAgICAgICAgIC8vICAgICAgICBkcm9wc2VsZWN0LnZhbHVlKG5ld1ZhbHVlW3Njb3BlLml0ZW0uc2VsZWN0T3B0aW9ucy5pdGVtLmRhdGFGaWVsZF0pO1xyXG4gICAgICAgICAgICAgICAgLy8gICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIC8vICAgICAgICB2YXIgZHJvcHNlbGVjdCA9IGVsZW1lbnQuZGF0YShcImtlbmRvRHJvcERvd25MaXN0XCIpO1xyXG4gICAgICAgICAgICAgICAgLy8gICAgICAgIGRyb3BzZWxlY3QudmFsdWUoXCJcIik7XHJcbiAgICAgICAgICAgICAgICAvLyAgICB9XHJcbiAgICAgICAgICAgICAgICAvL30pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGZ1bmN0aW9uIG9ua2VuZG9zZWxlY3QoZSkge1xyXG4gICAgICAgICAgICAgICAgc2NvcGUuaXRlbS5kYXRhID0gW107XHJcblxyXG4gICAgICAgICAgICAgICAgc2NvcGUuaXRlbS5kYXRhID0gZS5kYXRhSXRlbTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgZnVuY3Rpb24ga2VuZG9tdWx0aVNlbGVjdFNldHRpbmcoc2NvcGUsIGVsLCBhdHRyKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIga2V5SW5kZXggPSBuYXZjb24uZ2V0SXRlbUluZGV4QnlQcm9wZXJ0eShzY29wZS5pdGVtcywgc2NvcGUuaXRlbS5rZXkpO1xyXG4gICAgICAgICAgICAgICAgaWYgKHNjb3BlLml0ZW1zW2tleUluZGV4XS50eXBlID09PSBcImtlbmRvbXVsdGlzZWxlY3RcIilcclxuICAgICAgICAgICAgICAgICAgICBpZiAoc2NvcGUuaXRlbXNba2V5SW5kZXhdLmRhdGEgPT09IHVuZGVmaW5lZCB8fCBzY29wZS5pdGVtc1trZXlJbmRleF0uZGF0YSA9PT0gXCJcIikgc2NvcGUuaXRlbXNba2V5SW5kZXhdLmRhdGEgPSBbXTtcclxuICAgICAgICAgICAgICAgIHZhciBlbGVtZW50ID0gJCgkKGVsKS5maW5kKCdzZWxlY3QnKSk7XHJcblxyXG4gICAgICAgICAgICAgICAgdmFyIG9wdGlvbnMgPSB7fTtcclxuICAgICAgICAgICAgICAgIGlmIChzY29wZS5pdGVtLnRlbXBsYXRlT3B0aW9ucyAhPT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHNjb3BlLml0ZW0uc2VsZWN0T3B0aW9ucy5pdGVtLmRpc3BsYXlGaWVsZCAhPT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG9wdGlvbnNbXCJkYXRhVGV4dEZpZWxkXCJdID0gc2NvcGUuaXRlbS5zZWxlY3RPcHRpb25zLml0ZW0uZGlzcGxheUZpZWxkO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBpZiAoc2NvcGUuaXRlbS5zZWxlY3RPcHRpb25zLnRhZ1RlbXBsYXRlICE9PSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgb3B0aW9uc1tcInRhZ1RlbXBsYXRlXCJdID0gc2NvcGUuaXRlbS5zZWxlY3RPcHRpb25zLnRhZ1RlbXBsYXRlO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBpZiAoc2NvcGUuaXRlbS5zZWxlY3RPcHRpb25zLml0ZW1UZW1wbGF0ZSAhPT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG9wdGlvbnNbXCJpdGVtVGVtcGxhdGVcIl0gPSBzY29wZS5pdGVtLnNlbGVjdE9wdGlvbnMuaXRlbVRlbXBsYXRlO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBpZiAoc2NvcGUuaXRlbS5zZWxlY3RPcHRpb25zLmhlYWRlclRlbXBsYXRlICE9PSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgb3B0aW9uc1tcImhlYWRlclRlbXBsYXRlXCJdID0gc2NvcGUuaXRlbS5zZWxlY3RPcHRpb25zLmhlYWRlclRlbXBsYXRlO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBpZiAoc2NvcGUuaXRlbS5zZWxlY3RPcHRpb25zLmZvb3RlclRlbXBsYXRlICE9PSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgb3B0aW9uc1tcImZvb3RlclRlbXBsYXRlXCJdID0gc2NvcGUuaXRlbS5zZWxlY3RPcHRpb25zLmZvb3RlclRlbXBsYXRlO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBpZiAoc2NvcGUuaXRlbS5zZWxlY3RPcHRpb25zLnRhZ01vZGUgIT09IHVuZGVmaW5lZCAmJiBzY29wZS5pdGVtLnNlbGVjdE9wdGlvbnMudGFnTW9kZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBvcHRpb25zW1widGFnTW9kZVwiXSA9IFwic2luZ2xlXCI7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIGlmIChzY29wZS5pdGVtLnNlbGVjdE9wdGlvbnMuaXRlbS5kYXRhRmllbGQgIT09IHVuZGVmaW5lZCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBvcHRpb25zW1wiZGF0YVZhbHVlRmllbGRcIl0gPSBzY29wZS5pdGVtLnNlbGVjdE9wdGlvbnMuaXRlbS5kYXRhRmllbGQ7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIGlmIChzY29wZS5pdGVtLnNlbGVjdE9wdGlvbnMucGxhY2Vob2xkZXIgIT09IHVuZGVmaW5lZCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBvcHRpb25zW1wicGxhY2Vob2xkZXJcIl0gPSBzY29wZS5pdGVtLnRlbXBsYXRlT3B0aW9ucy5wbGFjZWhvbGRlcjtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgb3B0aW9uc1tcImRhdGFTb3VyY2VcIl0gPSB7IGRhdGE6IHNjb3BlLml0ZW0uc2VsZWN0T3B0aW9ucy5pdGVtcyB9XHJcbiAgICAgICAgICAgICAgICAgICAgb3B0aW9uc1tcInNlbGVjdFwiXSA9IG9uU2VsZWN0S2VuZG9tdWx0aXNlbGVjdDtcclxuICAgICAgICAgICAgICAgICAgICBvcHRpb25zW1wiZGVzZWxlY3RcIl0gPSBvbkRlc2VsZWN0S2VuZG9tdWx0aXNlbGVjdDtcclxuICAgICAgICAgICAgICAgIH1cclxuXHJcblxyXG5cclxuICAgICAgICAgICAgICAgIGVsZW1lbnQua2VuZG9NdWx0aVNlbGVjdChvcHRpb25zKS5kYXRhKCdrZW5kb011bHRpU2VsZWN0Jyk7XHJcblxyXG4gICAgICAgICAgICAgICAgaWYgKHNjb3BlLml0ZW0uZGlzYWJsZWQgIT09IHVuZGVmaW5lZCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBkcm9wc2VsZWN0ID0gZWxlbWVudC5kYXRhKFwia2VuZG9NdWx0aVNlbGVjdFwiKTtcclxuICAgICAgICAgICAgICAgICAgICBkcm9wc2VsZWN0LmVuYWJsZSghKHNjb3BlLml0ZW0uZGlzYWJsZWQpKTtcclxuICAgICAgICAgICAgICAgIH1cclxuXHJcblxyXG4gICAgICAgICAgICAgICAgc2NvcGUuJHdhdGNoKFwiaXRlbXNbXCIgKyBrZXlJbmRleCArIFwiXS5zZWxlY3RPcHRpb25zLml0ZW1zXCIsIGZ1bmN0aW9uIChuZXdWYWx1ZSwgb2xkVmFsdWUpIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAobmV3VmFsdWUgIT09IHVuZGVmaW5lZCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgbXVsdGlzZWxlY3QgPSBlbGVtZW50LmRhdGEoXCJrZW5kb011bHRpU2VsZWN0XCIpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBtdWx0aXNlbGVjdC5kYXRhU291cmNlLmRhdGEobmV3VmFsdWUpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAkKG11bHRpc2VsZWN0LndyYXBwZXIpLmFkZENsYXNzKHNjb3BlLmZpZWxkQ2xhc3MpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgLy9zY29wZS4kd2F0Y2goXCJpdGVtc1tcIiArIGtleUluZGV4ICsgXCJdLmRhdGFcIiwgZnVuY3Rpb24gKG5ld1ZhbHVlLCBvbGRWYWx1ZSkge1xyXG4gICAgICAgICAgICAgICAgLy8gICAgaWYgKG5ld1ZhbHVlICE9PSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgICAgICAgIC8vICAgICAgICB2YXIgc2VsZWN0ZWRWYWx1ZXMgPSBbXTtcclxuICAgICAgICAgICAgICAgIC8vICAgICAgICAkLmVhY2gobmV3VmFsdWUsIGZ1bmN0aW9uIChpbmRleCwgaXRlbSkge1xyXG4gICAgICAgICAgICAgICAgLy8gICAgICAgICAgICBzZWxlY3RlZFZhbHVlcy5wdXNoKGl0ZW1bc2NvcGUuaXRlbS5zZWxlY3RPcHRpb25zLml0ZW0uZGF0YUZpZWxkXSk7XHJcbiAgICAgICAgICAgICAgICAvLyAgICAgICAgfSlcclxuICAgICAgICAgICAgICAgIC8vICAgICAgICB2YXIgbXVsdGlzZWxlY3QgPSBlbGVtZW50LmRhdGEoXCJrZW5kb011bHRpU2VsZWN0XCIpO1xyXG4gICAgICAgICAgICAgICAgLy8gICAgICAgIG11bHRpc2VsZWN0LnZhbHVlKHNlbGVjdGVkVmFsdWVzKTtcclxuICAgICAgICAgICAgICAgIC8vICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAvLyAgICAgICAgdmFyIHNlbGVjdGVkVmFsdWVzID0gW107XHJcbiAgICAgICAgICAgICAgICAvLyAgICAgICAgdmFyIG11bHRpc2VsZWN0ID0gZWxlbWVudC5kYXRhKFwia2VuZG9NdWx0aVNlbGVjdFwiKTtcclxuICAgICAgICAgICAgICAgIC8vICAgICAgICBtdWx0aXNlbGVjdC52YWx1ZShzZWxlY3RlZFZhbHVlcyk7XHJcbiAgICAgICAgICAgICAgICAvLyAgICB9XHJcbiAgICAgICAgICAgICAgICAvL30pO1xyXG5cclxuXHJcblxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGZ1bmN0aW9uIG9uU2VsZWN0S2VuZG9tdWx0aXNlbGVjdChlKSB7XHJcblxyXG4gICAgICAgICAgICAgICAgc2NvcGUuaXRlbS5kYXRhLnB1c2goZS5kYXRhSXRlbSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZnVuY3Rpb24gb25EZXNlbGVjdEtlbmRvbXVsdGlzZWxlY3QoZSkge1xyXG4gICAgICAgICAgICAgICAgc2NvcGUuaXRlbS5kYXRhID0gJChzY29wZS5pdGVtLmRhdGEpLmZpbHRlcihmdW5jdGlvbiAoaSwgbikge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBuW3Njb3BlLml0ZW0uc2VsZWN0T3B0aW9ucy5pdGVtLmRhdGFGaWVsZF0gIT0gZS5kYXRhSXRlbVtzY29wZS5pdGVtLnNlbGVjdE9wdGlvbnMuaXRlbS5kYXRhRmllbGRdO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICB9XHJcblxyXG5cclxuICAgICAgICAgICAgZnVuY3Rpb24gcGFyZW50SXRlbXMoaXRlbSkge1xyXG4gICAgICAgICAgICAgICAgZm9yICh2YXIga2V5IGluIGl0ZW0pIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoaXRlbVtcIiRwYXJlbnRcIl0uaXRlbXMgIT0gdW5kZWZpbmVkKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gaXRlbVtcIiRwYXJlbnRcIl0uaXRlbXM7XHJcbiAgICAgICAgICAgICAgICAgICAgZWxzZVxyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gcGFyZW50SXRlbXMoaXRlbVtcIiRwYXJlbnRcIl0pO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9O1xyXG5cclxuXHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxufV0pOyIsIlwidXNlIHN0cmljdFwiO1xyXG5hbmd1bGFyLm1vZHVsZSgnYXBwJykuZGlyZWN0aXZlKCduYXZjb25LZW5kb1NjaGVkdWxlJywgWyckdGltZW91dCcsXHJcbmZ1bmN0aW9uICgkdGltZW91dCkge1xyXG4gICAgcmV0dXJuIHtcclxuICAgICAgICAvKkU6IERpcmVjdGl2ZSBkZWZpbmVkIGFzIGFuIGVsZW1lbnQuIDxuYXZjb24tdGFibGU+PC9uYXZjb24tdGFibGU+XHJcbiAgICAgICAgQTogRGlyZWN0aXZlIGFwcGxpZWQgYXMgYW4gYXR0cmlidXRlIG9uIGV4aXN0aW5nIGVsZW1lbnQuIDxkaXYgbmF2Y29uLXRhYmxlPjwvZGl2PlxyXG4gICAgICAgIEM6IERpcmVjdGl2ZSBhcHBsaWVkIGFzIGEgY3NzIGNsYXNzIHRvIGV4aXN0aW5nIGVsZW1lbnQgPGRpdiBjbGFzcz1cIm5hdmNvbi10YWJsZVwiPjwvZGl2PlxyXG4gICAgICAgIE06IERpcmVjdGl2ZSBhcHBsaWVkIGFzIGNvbW1lbnQuKi9cclxuICAgICAgICByZXN0cmljdDogJ0UnLFxyXG4gICAgICAgIHNjb3BlOiB7XHJcbiAgICAgICAgICAgIC8vQCByZWFkcyB0aGUgYXR0cmlidXRlIHZhbHVlLCA9IHByb3ZpZGVzIHR3by13YXkgYmluZGluZywgJiB3b3JrcyB3aXRoIGZ1bmN0aW9uc1xyXG4gICAgICAgICAgICBjYWxlbmRhclNldHRpbmc6ICc9JyxcclxuICAgICAgICAgICAgbmF2Y29uRGF0YTogJz0nLFxyXG4gICAgICAgICAgICBmaWVsZHM6ICc9JyxcclxuICAgICAgICAgICAgdHlwZTogJ0AnXHJcbiAgICAgICAgfSxcclxuICAgICAgICB0ZW1wbGF0ZVVybDogZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICByZXR1cm4gbmF2Y29uLk1lbnVyb3V0ZS5nZXRUZW1wbGF0ZVVybChcIm5hdmNvbktlbmRvU2NoZWR1bGVcIik7XHJcbiAgICAgICAgfSxcclxuICAgICAgICBsaW5rOiBmdW5jdGlvbiAoc2NvcGUsIGVsLCBhdHRycykge1xyXG4gICAgICAgICAgICBzY29wZS5zY2hlZHVsZXJQYWdlID0ge307XHJcbiAgICAgICAgICAgIHNjb3BlLnNjaGVkdWxlckdyb3VwID0ge307XHJcblxyXG4gICAgICAgICAgICBzY29wZS5jdXJyZW50X3BhZ2UgPSAxO1xyXG4gICAgICAgICAgICBzY29wZS5vYmpKc29uID0gYW5ndWxhci5jb3B5KHNjb3BlLmNhbGVuZGFyU2V0dGluZy5yZXNvdXJjZXNbMF0uZGF0YVNvdXJjZSk7XHJcbiAgICAgICAgICAgIC8vc2NvcGUub2JqSnNvbiA9IGFuZ3VsYXIuY29weShzY29wZS5jYWxlbmRhclNldHRpbmcuZXZlbnRzKTtcclxuICAgICAgICAgICAgc2NvcGUucmVjb3Jkc19wZXJfcGFnZSA9IGFuZ3VsYXIuY29weShzY29wZS5jYWxlbmRhclNldHRpbmcucGFnZUxlbmd0aCAhPT0gdW5kZWZpbmVkICYmIHNjb3BlLmNhbGVuZGFyU2V0dGluZy5wYWdlTGVuZ3RoICE9PSBcIkFsbFwiID8gc2NvcGUuY2FsZW5kYXJTZXR0aW5nLnBhZ2VMZW5ndGggOiBzY29wZS5vYmpKc29uLmxlbmd0aCk7XHJcblxyXG4gICAgICAgICAgICB2YXIgb2JqUmVzb3VyY2VzID0gYW5ndWxhci5jb3B5KHNjb3BlLmNhbGVuZGFyU2V0dGluZy5yZXNvdXJjZXMpO1xyXG4gICAgICAgICAgICAvL3ZhciBvYmpSZXNvdXJjZXMgPSBhbmd1bGFyLmNvcHkoc2NvcGUuY2FsZW5kYXJTZXR0aW5nLmV2ZW50cyk7XHJcblxyXG4gICAgICAgICAgICAkdGltZW91dChmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgc2NoZWR1bGVyUGFnZSA9ICQoJChlbCkuZmluZCgnLnNjaGVkdWxlclBhZ2UnKVswXSk7XHJcbiAgICAgICAgICAgICAgICAkKHNjaGVkdWxlclBhZ2UpLmtlbmRvRHJvcERvd25MaXN0KHtcclxuICAgICAgICAgICAgICAgICAgICAvL2RhdGFUZXh0RmllbGQ6IFwidmFsdWVcIixcclxuICAgICAgICAgICAgICAgICAgICAvL2RhdGFWYWx1ZUZpZWxkOiBcInZhbHVlXCIsXHJcbiAgICAgICAgICAgICAgICAgICAgLy9maWx0ZXI6IFwiY29udGFpbnNcIixcclxuICAgICAgICAgICAgICAgICAgICAvL3N1Z2dlc3Q6IHRydWUsXHJcbiAgICAgICAgICAgICAgICAgICAgZGVsYXk6IDgwMDAsXHJcbiAgICAgICAgICAgICAgICAgICAgZGF0YVNvdXJjZToge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiBcIm9kYXRhXCIsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGRhdGE6IHNjb3BlLmNhbGVuZGFyU2V0dGluZy5sZW5ndGhNZW51XHJcbiAgICAgICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgICAgICBpbmRleDogJC5pbkFycmF5KHNjb3BlLmNhbGVuZGFyU2V0dGluZy5wYWdlTGVuZ3RoLCBzY29wZS5jYWxlbmRhclNldHRpbmcubGVuZ3RoTWVudSksXHJcbiAgICAgICAgICAgICAgICAgICAgLy9jaGFuZ2U6IG5hdmNvbi5rZW5kby5zY2hlZHVsZS5pdGVtUGFnZUNoYW5nZShlbCwgc2NvcGUsIHNjaGVkdWxlclBhZ2UpXHJcbiAgICAgICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgICAgICB2YXIgc2NoZWR1bGVyTVMgPSAkKCQoZWwpLmZpbmQoJy5zY2hlZHVsZXJNUycpWzBdKTtcclxuICAgICAgICAgICAgICAgIHNjaGVkdWxlck1TLmtlbmRvTXVsdGlTZWxlY3Qoe1xyXG4gICAgICAgICAgICAgICAgICAgIGRlbGF5OiAxMDAwLCAvLyB3YWl0IDEgc2Vjb25kIGJlZm9yZSBjbGVhcmluZyB0aGUgdXNlciBpbnB1dFxyXG4gICAgICAgICAgICAgICAgICAgIGRhdGFUZXh0RmllbGQ6IFwidGV4dFwiLFxyXG4gICAgICAgICAgICAgICAgICAgIGRhdGFWYWx1ZUZpZWxkOiBcInZhbHVlXCIsXHJcbiAgICAgICAgICAgICAgICAgICAgZGF0YVNvdXJjZToge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiBcIm9kYXRhXCIsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGRhdGE6IHNjb3BlLmNhbGVuZGFyU2V0dGluZy5yZXNvdXJjZXNbMF0uZGF0YVNvdXJjZVxyXG4gICAgICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICAgICAgLy92YWx1ZTogWyQoc2NoZWR1bGVyKS5nZXRLZW5kb1NjaGVkdWxlcigpLnJlc291cmNlc1swXS5kYXRhU291cmNlLmF0KDApLnZhbHVlXSxcclxuICAgICAgICAgICAgICAgICAgICAvL2NoYW5nZTogbmF2Y29uLmtlbmRvLnNjaGVkdWxlLm11bHRpc2VsZWN0Q2hhbmdlKGVsLCBzY2hlZHVsZXIsIHRoaXMudmFsdWUoKSksXHJcbiAgICAgICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgICAgICBpZiAoc2NvcGUuY2FsZW5kYXJTZXR0aW5nLnZpZXdzLmxlbmd0aCAhPT0gMClcclxuICAgICAgICAgICAgICAgICAgICBzY29wZS5pbml0RnVuY3Rpb24oKTtcclxuICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICBzY29wZS4kd2F0Y2goJ3NjaGVkdWxlclBhZ2UuZGF0YScsIGZ1bmN0aW9uIChuZXdWYWx1ZSwgb2xkVmFsdWUpIHtcclxuICAgICAgICAgICAgICAgIGlmIChuZXdWYWx1ZSAhPT0gdW5kZWZpbmVkICYmIG5ld1ZhbHVlICE9PSBvbGRWYWx1ZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIG5hdmNvbi5rZW5kby5zY2hlZHVsZS5pdGVtUGFnZUNoYW5nZShlbCwgc2NvcGUsIG5ld1ZhbHVlKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSwgdHJ1ZSk7XHJcblxyXG4gICAgICAgICAgICBzY29wZS4kd2F0Y2goJ3NjaGVkdWxlckdyb3VwLmRhdGEnLCBmdW5jdGlvbiAobmV3VmFsdWUsIG9sZFZhbHVlKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAobmV3VmFsdWUgIT09IHVuZGVmaW5lZCAmJiBuZXdWYWx1ZSAhPT0gb2xkVmFsdWUpIHtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgc2NoZWR1bGVyID0gJCgkKGVsKS5maW5kKCcua2VuZG9TY2hlZHVsZScpWzBdKTtcclxuICAgICAgICAgICAgICAgICAgICBuYXZjb24ua2VuZG8uc2NoZWR1bGUubXVsdGlzZWxlY3RDaGFuZ2UoZWwsIHNjb3BlLHNjaGVkdWxlciwgbmV3VmFsdWUpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9LCB0cnVlKTtcclxuXHJcbiAgICAgICAgICAgIHNjb3BlLm11bHRpc2VsZWN0R3JvdXAgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICBuYXZjb24ua2VuZG8uc2NoZWR1bGUubXVsdGlzZWxlY3RHcm91cChlbCwgc2NvcGUpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIC8vc2NvcGUuJHdhdGNoKCdjYWxlbmRhclNldHRpbmcnLCBmdW5jdGlvbiAobmV3VmFsdWUsIG9sZFZhbHVlKSB7XHJcbiAgICAgICAgICAgIC8vICAgIGlmIChuZXdWYWx1ZSAhPT0gdW5kZWZpbmVkICYmIG5ld1ZhbHVlICE9PSBvbGRWYWx1ZSkge1xyXG4gICAgICAgICAgICAvLyAgICAgICAgc2NvcGUuaW5pdEZ1bmN0aW9uKCk7XHJcbiAgICAgICAgICAgIC8vICAgIH1cclxuICAgICAgICAgICAgLy99LCB0cnVlKTtcclxuXHJcbiAgICAgICAgICAgIHNjb3BlLiR3YXRjaCgnY2FsZW5kYXJTZXR0aW5nLmRhdGEnLCBmdW5jdGlvbiAobmV3VmFsdWUsIG9sZFZhbHVlKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAobmV3VmFsdWUgIT09IHVuZGVmaW5lZCAmJiBuZXdWYWx1ZSAhPT0gXCJcIikge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChuZXdWYWx1ZS5yZXNvdXJjZXMgIT09IHVuZGVmaW5lZCkgc2NvcGUuY2FsZW5kYXJTZXR0aW5nLnJlc291cmNlcyA9IG5ld1ZhbHVlLnJlc291cmNlcztcclxuICAgICAgICAgICAgICAgICAgICBpZiAobmV3VmFsdWUuZXZlbnRzICE9PSB1bmRlZmluZWQpIHNjb3BlLmNhbGVuZGFyU2V0dGluZy5ldmVudHMgPSBuZXdWYWx1ZS5ldmVudHM7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0sIHRydWUpO1xyXG5cclxuICAgICAgICAgICAgLy8gY2FsY3VsYXRlIG51bWJlciBvZiBwYWdlcyBcclxuICAgICAgICAgICAgZnVuY3Rpb24gbnVtUGFnZXMoKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gTWF0aC5jZWlsKHNjb3BlLm9iakpzb24ubGVuZ3RoIC8gc2NvcGUucmVjb3Jkc19wZXJfcGFnZSk7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIC8vIGdvIHRvIHByZXZpb3VzIHBhZ2VcclxuICAgICAgICAgICAgc2NvcGUucHJldlBhZ2UgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoc2NvcGUuY3VycmVudF9wYWdlID4gMSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHNjb3BlLmN1cnJlbnRfcGFnZS0tO1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciB4ID0gc2NvcGUuY2hhbmdlUGFnZShzY29wZS5jdXJyZW50X3BhZ2UpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICBvYmpSZXNvdXJjZXNbMF0uZGF0YVNvdXJjZSA9IFtdO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHgubGVuZ3RoOyBpKyspIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgb2JqUmVzb3VyY2VzWzBdLmRhdGFTb3VyY2UucHVzaCh4W2ldKTtcclxuICAgICAgICAgICAgICAgICAgICB9O1xyXG5cclxuICAgICAgICAgICAgICAgICAgICBuYXZjb24ua2VuZG8uc2NoZWR1bGUuc2V0dGluZyhlbCwgc2NvcGUuY2FsZW5kYXJTZXR0aW5nLCBzY29wZSwgeyByZXNvdXJjZXM6IG9ialJlc291cmNlcyB9KTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgLy8gZ28gdG8gbmV4dCBwYWdlXHJcbiAgICAgICAgICAgIHNjb3BlLm5leHRQYWdlID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgaWYgKHNjb3BlLmN1cnJlbnRfcGFnZSA8IG51bVBhZ2VzKCkpIHtcclxuICAgICAgICAgICAgICAgICAgICBzY29wZS5jdXJyZW50X3BhZ2UrKztcclxuICAgICAgICAgICAgICAgICAgICB2YXIgeCA9IHNjb3BlLmNoYW5nZVBhZ2Uoc2NvcGUuY3VycmVudF9wYWdlKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgb2JqUmVzb3VyY2VzWzBdLmRhdGFTb3VyY2UgPSBbXTtcclxuICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHgubGVuZ3RoOyBpKyspIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgb2JqUmVzb3VyY2VzWzBdLmRhdGFTb3VyY2UucHVzaCh4W2ldKTtcclxuICAgICAgICAgICAgICAgICAgICB9O1xyXG5cclxuICAgICAgICAgICAgICAgICAgICBuYXZjb24ua2VuZG8uc2NoZWR1bGUuc2V0dGluZyhlbCwgc2NvcGUuY2FsZW5kYXJTZXR0aW5nLCBzY29wZSwgeyByZXNvdXJjZXM6IG9ialJlc291cmNlcyB9KTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgLy8gb24gY2xpY2sgZWl0aGVyIG5leHQvcHJldiB3aGF0IGhhcHBlbmQgdG8gY2hhbmdlIHBhZ2VcclxuICAgICAgICAgICAgc2NvcGUuY2hhbmdlUGFnZSA9IGZ1bmN0aW9uIChwYWdlKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgYnRuX25leHQgPSAkKFwiLmJ0bk5leHRcIik7XHJcbiAgICAgICAgICAgICAgICB2YXIgYnRuX3ByZXYgPSAkKFwiLmJ0blByZXZcIik7XHJcbiAgICAgICAgICAgICAgICAvLyB2YXIgbGlzdGluZ190YWJsZSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwibGlzdGluZ1RhYmxlXCIpO1xyXG4gICAgICAgICAgICAgICAgLy8gdmFyIHBhZ2Vfc3BhbiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwicGFnZVwiKTtcclxuICAgICAgICAgICAgICAgIC8vIGFsZXJ0KG51bVBhZ2VzKCkpO1xyXG4gICAgICAgICAgICAgICAgLy8gVmFsaWRhdGUgcGFnZVxyXG4gICAgICAgICAgICAgICAgaWYgKHBhZ2UgPCAxKSBwYWdlID0gMTtcclxuICAgICAgICAgICAgICAgIGlmIChwYWdlID4gbnVtUGFnZXMoKSkgcGFnZSA9IG51bVBhZ2VzKCk7XHJcblxyXG4gICAgICAgICAgICAgICAgLy8gbGlzdGluZ190YWJsZS5pbm5lckhUTUwgPSBcIlwiO1xyXG5cclxuICAgICAgICAgICAgICAgIHNjb3BlLnR4dDIgPSBbXTtcclxuICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSAocGFnZSAtIDEpICogc2NvcGUucmVjb3Jkc19wZXJfcGFnZTsgaSA8IChwYWdlICogc2NvcGUucmVjb3Jkc19wZXJfcGFnZSkgOyBpKyspIHtcclxuICAgICAgICAgICAgICAgICAgICAvLyBsaXN0aW5nX3RhYmxlLmlubmVySFRNTCArPSBzY29wZS5vYmpKc29uW2ldLnRleHQgKyBcIjxicj5cIjtcclxuICAgICAgICAgICAgICAgICAgICBzY29wZS50eHQyLnB1c2goc2NvcGUub2JqSnNvbltpXSk7XHJcbiAgICAgICAgICAgICAgICAgICAgLy8gYWxlcnQoc2NvcGUub2JqSnNvbltpXSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAvLyBwYWdlX3NwYW4uaW5uZXJIVE1MID0gcGFnZTtcclxuXHJcbiAgICAgICAgICAgICAgICBpZiAocGFnZSA9PSAxKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgJChidG5fcHJldikuY3NzKHsgXCJ2aXNpYmlsaXR5XCI6IFwiaGlkZGVuXCIgfSk7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICQoYnRuX3ByZXYpLmNzcyh7IFwidmlzaWJpbGl0eVwiOiBcInZpc2libGVcIiB9KTtcclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICBpZiAocGFnZSA9PSBudW1QYWdlcygpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgJChidG5fbmV4dCkuY3NzKHsgXCJ2aXNpYmlsaXR5XCI6IFwiaGlkZGVuXCIgfSk7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICQoYnRuX25leHQpLmNzcyh7IFwidmlzaWJpbGl0eVwiOiBcInZpc2libGVcIiB9KTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIHJldHVybiBzY29wZS50eHQyO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBzY29wZS5pbml0RnVuY3Rpb24gPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICAvLyBjb25zb2xlLmxvZygkc2NvcGUuc2NoZWR1bGVyT3B0aW9ucy5kYXRhU291cmNlLmRhdGEpO1xyXG4gICAgICAgICAgICAgICAgLy8ga2VuZG8uYmluZChhbmd1bGFyLmVsZW1lbnQoXCIjdGVzdEl0ZW1zXCIpLCB0ZXN0Vk0pO1xyXG4gICAgICAgICAgICAgICAgdmFyIHggPSBzY29wZS5jaGFuZ2VQYWdlKDEpO1xyXG5cclxuICAgICAgICAgICAgICAgIG9ialJlc291cmNlc1swXS5kYXRhU291cmNlID0gW107XHJcblxyXG5cclxuICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgeC5sZW5ndGg7IGkrKykge1xyXG4gICAgICAgICAgICAgICAgICAgIG9ialJlc291cmNlc1swXS5kYXRhU291cmNlLnB1c2goeFtpXSk7XHJcbiAgICAgICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICAgICAgbmF2Y29uLmtlbmRvLnNjaGVkdWxlLnNldHRpbmcoZWwsIHNjb3BlLmNhbGVuZGFyU2V0dGluZywgc2NvcGUsIHsgcmVzb3VyY2VzOiBvYmpSZXNvdXJjZXMgfSk7XHJcblxyXG4gICAgICAgICAgICAgICAgLy8kdGltZW91dChmdW5jdGlvbiAoKSB7IHNjb3BlLiRhcHBseSgpOyB9LCA1MDApO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxufV0pOyIsIlwidXNlIHN0cmljdFwiO1xyXG5hbmd1bGFyLm1vZHVsZSgnYXBwJykuZGlyZWN0aXZlKCduYXZjb25LZW5kb1RhYmxlJywgWyckdGltZW91dCcsXHJcbmZ1bmN0aW9uICgkdGltZW91dCkge1xyXG4gICAgcmV0dXJuIHtcclxuICAgICAgICAvKkU6IERpcmVjdGl2ZSBkZWZpbmVkIGFzIGFuIGVsZW1lbnQuIDxuYXZjb24tdGFibGU+PC9uYXZjb24tdGFibGU+XHJcbiAgICAgICAgQTogRGlyZWN0aXZlIGFwcGxpZWQgYXMgYW4gYXR0cmlidXRlIG9uIGV4aXN0aW5nIGVsZW1lbnQuIDxkaXYgbmF2Y29uLXRhYmxlPjwvZGl2PlxyXG4gICAgICAgIEM6IERpcmVjdGl2ZSBhcHBsaWVkIGFzIGEgY3NzIGNsYXNzIHRvIGV4aXN0aW5nIGVsZW1lbnQgPGRpdiBjbGFzcz1cIm5hdmNvbi10YWJsZVwiPjwvZGl2PlxyXG4gICAgICAgIE06IERpcmVjdGl2ZSBhcHBsaWVkIGFzIGNvbW1lbnQuKi9cclxuICAgICAgICByZXN0cmljdDogJ0UnLFxyXG4gICAgICAgIHNjb3BlOiB7XHJcbiAgICAgICAgICAgIC8vQCByZWFkcyB0aGUgYXR0cmlidXRlIHZhbHVlLCA9IHByb3ZpZGVzIHR3by13YXkgYmluZGluZywgJiB3b3JrcyB3aXRoIGZ1bmN0aW9uc1xyXG4gICAgICAgICAgICB0YWJsZVNldHRpbmdzOiAnPScsXHJcbiAgICAgICAgICAgIG5hdmNvbkRhdGE6ICc9JyxcclxuICAgICAgICAgICAgZmllbGRzOiAnPScsXHJcbiAgICAgICAgICAgIHR5cGU6ICdAJ1xyXG4gICAgICAgIH0sXHJcbiAgICAgICAgdGVtcGxhdGVVcmw6IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgcmV0dXJuIG5hdmNvbi5NZW51cm91dGUuZ2V0VGVtcGxhdGVVcmwoXCJuYXZjb25LZW5kb1RhYmxlXCIpO1xyXG4gICAgICAgIH0sXHJcbiAgICAgICAgbGluazogZnVuY3Rpb24gKHNjb3BlLCBlbCwgYXR0cnMpIHtcclxuICAgICAgICAgICAgLy9pZiAoc2NvcGUudGFibGVTZXR0aW5ncy5jb2x1bW5zLmxlbmd0aCAhPT0gMClcclxuICAgICAgICAgICAgLy8gICAgbmF2Y29uLmtlbmRvLnRhYmxlLnNldHRpbmcoZWwsIHNjb3BlLnRhYmxlU2V0dGluZ3MsIHNjb3BlKTtcclxuXHJcbiAgICAgICAgICAgIHNjb3BlLiR3YXRjaCgndGFibGVTZXR0aW5ncy5kYXRhJywgZnVuY3Rpb24gKG5ld1ZhbHVlLCBvbGRWYWx1ZSkge1xyXG4gICAgICAgICAgICAgICAgaWYgKG5ld1ZhbHVlICE9PSB1bmRlZmluZWQgJiYgbmV3VmFsdWUgIT09IG9sZFZhbHVlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHNjb3BlLnRhYmxlU2V0dGluZ3MuY29sdW1ucy5sZW5ndGggIT09IDApIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgLy92YXIgaXRlbXMgPSBuYXZjb24udGFibGUua2VuZG8ubWFuYWdlRGF0YShzY29wZS50YWJsZVNldHRpbmdzLmNvbHVtbnMsIHNjb3BlLnRhYmxlU2V0dGluZ3MuZGF0YSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vbmF2Y29uLmtlbmRvLnRhYmxlLnJlZnJlc2goZWwsIHNjb3BlLnRhYmxlU2V0dGluZ3MsIHNjb3BlKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgbmF2Y29uLmtlbmRvLnRhYmxlLnNldHRpbmcoZWwsIHNjb3BlLnRhYmxlU2V0dGluZ3MsIHNjb3BlKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0sIHRydWUpO1xyXG5cclxuICAgICAgICAgICAgLy9zY29wZS4kd2F0Y2goJ3RhYmxlU2V0dGluZ3MuY29sdW1ucycsIGZ1bmN0aW9uIChuZXdWYWx1ZSwgb2xkVmFsdWUpIHtcclxuICAgICAgICAgICAgLy8gICAgaWYgKG5ld1ZhbHVlICE9PSB1bmRlZmluZWQgJiYgbmV3VmFsdWUgIT09IG9sZFZhbHVlKSB7XHJcbiAgICAgICAgICAgIC8vICAgICAgICBpZiAoc2NvcGUudGFibGVTZXR0aW5ncy5jb2x1bW5zLmxlbmd0aCAhPT0gMClcclxuICAgICAgICAgICAgLy8gICAgICAgICAgICBuYXZjb24ua2VuZG8udGFibGUuc2V0dGluZyhlbCwgc2NvcGUudGFibGVTZXR0aW5ncywgc2NvcGUpO1xyXG4gICAgICAgICAgICAvLyAgICB9XHJcbiAgICAgICAgICAgIC8vfSwgdHJ1ZSk7ICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAvLyR0aW1lb3V0KGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgLy8gICAgZWwuZmluZChcIi5rLWdyaWQtdG9vbGJhclwiKS5pbnNlcnRBZnRlcihlbC5maW5kKFwiLmstZ3JpZC1wYWdlclwiKS5sZW5ndGggPT09IDEgPyBlbC5maW5kKFwiLmstZ3JpZC1wYWdlclwiKSA6IGVsLmZpbmQoXCIuay1ncmlkLWNvbnRlbnRcIikpO1xyXG4gICAgICAgICAgICAvL30pO1xyXG4gICAgICAgIH1cclxuICAgIH07XHJcbn1dKTsiLCJcInVzZSBzdHJpY3RcIjtcclxuXHJcbmFuZ3VsYXIubW9kdWxlKCdhcHAnKS5kaXJlY3RpdmUoJ25hdmNvbktlbmRvVGVtcGxhdGUnLCBbJ2RhdGFzZXJ2aWNlJywgJ25nQXV0aFNldHRpbmdzJywgJyR0aW1lb3V0JywgJyRjb21waWxlJyxcclxuZnVuY3Rpb24gKGRhdGFzZXJ2aWNlLCBuZ0F1dGhTZXR0aW5ncywgJHRpbWVvdXQsICRjb21waWxlKSB7XHJcbiAgICByZXR1cm4ge1xyXG4gICAgICAgIC8qRTogRGlyZWN0aXZlIGRlZmluZWQgYXMgYW4gZWxlbWVudC4gPG5hdmNvbi10YWJsZT48L25hdmNvbi10YWJsZT5cclxuICAgICAgICBBOiBEaXJlY3RpdmUgYXBwbGllZCBhcyBhbiBhdHRyaWJ1dGUgb24gZXhpc3RpbmcgZWxlbWVudC4gPGRpdiBuYXZjb24tdGFibGU+PC9kaXY+XHJcbiAgICAgICAgQzogRGlyZWN0aXZlIGFwcGxpZWQgYXMgYSBjc3MgY2xhc3MgdG8gZXhpc3RpbmcgZWxlbWVudCA8ZGl2IGNsYXNzPVwibmF2Y29uLXRhYmxlXCI+PC9kaXY+XHJcbiAgICAgICAgTTogRGlyZWN0aXZlIGFwcGxpZWQgYXMgY29tbWVudC4qL1xyXG4gICAgICAgIHJlc3RyaWN0OiAnRScsXHJcbiAgICAgICAgcmVwbGFjZTogdHJ1ZSxcclxuICAgICAgICB0cmFuc2NsdWRlOiAnZWxlbWVudCcsXHJcbiAgICAgICAgc2NvcGU6IHtcclxuICAgICAgICAgICAgLy9AIHJlYWRzIHRoZSBhdHRyaWJ1dGUgdmFsdWUsID0gcHJvdmlkZXMgdHdvLXdheSBiaW5kaW5nLCAmIHdvcmtzIHdpdGggZnVuY3Rpb25zXHJcbiAgICAgICAgICAgIG5hdmNvbkRhdGE6ICc9JyxcclxuICAgICAgICAgICAgaGVhZGVyVGl0bGU6ICdAJyxcclxuICAgICAgICAgICAgdGVtcGxhdGVUeXBlOiAnQCdcclxuICAgICAgICB9LFxyXG4gICAgICAgIHRlbXBsYXRlVXJsOiBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBuYXZjb24uTWVudXJvdXRlLmdldFRlbXBsYXRlVXJsKFwibmF2Y29uS2VuZG9UZW1wbGF0ZVwiKTtcclxuICAgICAgICB9LFxyXG4gICAgICAgIGxpbms6IGZ1bmN0aW9uIChzY29wZSwgZWwsIGF0dHJzLCBjdHJsLCB0cmFuc2NsdWRlKSB7XHJcbiAgICAgICAgICAgIC8vJChlbCkuYXR0cihcImlkXCIsIGF0dHJzLnRlbXBsYXRlVHlwZSArIFwiLWVkaXRvclwiKTtcclxuICAgICAgICAgICAgLy8kKCQoZWwpLmZpbmQoXCJkaXZbdHlwZSA9J3RleHQveC1rZW5kby10ZW1wbGF0ZSddXCIpKS5hdHRyKFwiaWRcIiwgYXR0cnMudGVtcGxhdGVUeXBlICsgXCItZWRpdG9yXCIpO1xyXG5cclxuICAgICAgICAgICAgLy92YXIgdGVtcGxhdGVEYXRhID0gJCgkKGVsKS5maW5kKFwic2NyaXB0W2lkID0nQXBwcm92YWwnXVwiKSkudGV4dCgpO1xyXG4gICAgICAgICAgICAvLyQoJChlbCkuZmluZChcInNwYW5baWQ9J0FwcHJvdmFsJ11cIikpLmh0bWwodGVtcGxhdGVEYXRhKTtcclxuICAgICAgICAgICAgLy8kY29tcGlsZSgkKCQoZWwpLmZpbmQoXCJzcGFuW2lkPSdBcHByb3ZhbCddXCIpKS5jb250ZW50cygpKShzY29wZSk7XHJcblxyXG4gICAgICAgICAgICAvL3ZhciB0ZW1wbGF0ZT0nPHNjcmlwdCB0eXBlPVwidGV4dC94LWtlbmRvLXRlbXBsYXRlXCI+PC9zY3JpcHQ+J1xyXG4gICAgICAgICAgICAvLyQoJChlbCkuZmluZChcInNwYW5baWQ9J0FwcHJvdmFsJ11cIikpLmh0bWwodGVtcGxhdGVEYXRhKTtcclxuICAgICAgICAgICAgLy8kY29tcGlsZSgkKCQoZWwpLmZpbmQoXCJzcGFuW2lkPSdBcHByb3ZhbCddXCIpKS5jb250ZW50cygpKShzY29wZSk7XHJcblxyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgLyp2YXIgZGF0YSA9ICQoJChlbCkuZmluZChcImRpdltjbGFzcyA9J2tlbmRvdGVtcGxhdGVJbmNsdWRlJ11cIikpLmNoaWxkcmVuKCkuaHRtbCgpO1xyXG4gICAgICAgICAgICB2YXIgdGVtcGxhdGUgPSAnPHNjcmlwdCB0eXBlPVwidGV4dC94LWtlbmRvLXRlbXBsYXRlXCIgaWQ9XCInICsgYXR0cnMudGVtcGxhdGVUeXBlICsgJy1lZGl0b3JcIj4nICsgZGF0YSArICc8L3NjcmlwdD4nO1xyXG4gICAgICAgICAgICAvLyRjb21waWxlKHRlbXBsYXRlKShzY29wZSlcclxuICAgICAgICAgICAgLy92YXIgdGVtcGxhdGUgPSAkKCQoZWwpLmZpbmQoXCJzY3JpcHRbdHlwZT0ndGV4dC94LWtlbmRvLXRlbXBsYXRlJ11cIikpLmFwcGVuZChkYXRhKS5odG1sKCk7XHJcbiAgICAgICAgICAgIC8vJChlbCkuYXBwZW5kKCRjb21waWxlKHRlbXBsYXRlKShzY29wZSkpO1xyXG4gICAgICAgICAgICAkKGVsKS5hcHBlbmQodGVtcGxhdGUpO1xyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgJGNvbXBpbGUoJCgkKGVsKS5maW5kKFwic2NyaXB0W2lkPSdcIiArIGF0dHJzLnRlbXBsYXRlVHlwZSArIFwiLWVkaXRvciddXCIpKS5odG1sKCkpKHNjb3BlKTsqL1xyXG5cclxuICAgICAgICAgICAgLy92YXIgZnV0dXJlUGFyZW50ID0gZWxlbWVudC5jaGlsZHJlbigpLmVxKDApO1xyXG4gICAgICAgICAgICB0cmFuc2NsdWRlKGZ1bmN0aW9uIChjbG9uZSkge1xyXG4gICAgICAgICAgICAgICAgLy92YXIgdGVtcGxhdGUgPSAnPHNjcmlwdCB0eXBlPVwidGV4dC94LWtlbmRvLXRlbXBsYXRlXCIgaWQ9XCInICsgYXR0cnMudGVtcGxhdGVUeXBlICsgJy1lZGl0b3JcIj4nICsgY2xvbmUgKyAnPC9zY3JpcHQ+JztcclxuICAgICAgICAgICAgICAgIC8vZWwuYXBwZW5kKHRlbXBsYXRlKTtcclxuXHJcbiAgICAgICAgICAgICAgICAvL2VsLmZpbmQoXCJzY3JpcHRbdHlwZT0ndGV4dC94LWtlbmRvLXRlbXBsYXRlJ11cIikuYXR0cihcImlkXCIsIGF0dHJzLnRlbXBsYXRlVHlwZSArIFwiLWVkaXRvclwiKTtcclxuICAgICAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAgICAgZWwuZmluZChcInNjcmlwdFt0eXBlPSd0ZXh0L2h0bWwnXVwiKS5hcHBlbmQoY2xvbmUpO1xyXG4gICAgICAgICAgICAgICAgLy8kY29tcGlsZShlbC5maW5kKFwic2NyaXB0W3R5cGU9J3RleHQvaHRtbCddXCIpLmNvbnRlbnRzKCkpKHNjb3BlKTtcclxuICAgICAgICAgICAgfSwgZWwpO1xyXG4gICAgICAgIH0vKixcclxuICAgICAgICBjb21waWxlOiBmdW5jdGlvbiAoZWwsIGF0dHJzLCB0cmFuc2NsdWRlKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBmdW5jdGlvbiAoc2NvcGUsIGxFbGVtLCBsQXR0cnMpIHtcclxuICAgICAgICAgICAgICAgIC8vIGRvIHRoZSB0cmFuc2NsdXNpb24uXHJcbiAgICAgICAgICAgICAgICB0cmFuc2NsdWRlKHNjb3BlLCBmdW5jdGlvbiAoY2xvbmUsIGlubmVyU2NvcGUpIHtcclxuICAgICAgICAgICAgICAgICAgICAvL2Nsb25lIGlzIGEgY29weSBvZiB0aGUgdHJhbnNjbHVkZWQgRE9NIGVsZW1lbnQgY29udGVudC5cclxuICAgICAgICAgICAgICAgICAgICAvLyQoZWwpLmF0dHIoXCJpZFwiLCBhdHRycy50ZW1wbGF0ZVR5cGUgKyBcIi1lZGl0b3JcIik7XHJcbiAgICAgICAgICAgICAgICAgICAgLy8kY29tcGlsZSgkKGVsKS5jb250ZW50cygpKShzY29wZSk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIC8vdmFyIHRlbXBsYXRlRGF0YSA9IGNsb25lLmh0bWwoKTtcclxuICAgICAgICAgICAgICAgICAgICAvLyQoJChlbCkuZmluZChcInNjcmlwdFt0eXBlID0ndGV4dC94LWtlbmRvLXRlbXBsYXRlJ11cIikpLmF0dHIoXCJpZFwiLCBhdHRycy50ZW1wbGF0ZVR5cGUgKyBcIi1lZGl0b3JcIik7XHJcbiAgICAgICAgICAgICAgICAgICAgLy8kKCQoZWwpLmZpbmQoXCJzY3JpcHRbdHlwZSA9J3RleHQveC1rZW5kby10ZW1wbGF0ZSddXCIpLmZpbmQoXCJkaXZbY2xhc3M9J2tlbmRvdGVtcGxhdGVJbmNsdWRlJ11cIikpLmh0bWwodGVtcGxhdGVEYXRhKTtcclxuICAgICAgICAgICAgICAgICAgICAvLyRjb21waWxlKCQoJChlbCkuZmluZChcInNjcmlwdFt0eXBlID0ndGV4dC94LWtlbmRvLXRlbXBsYXRlJ11cIikuZmluZChcImRpdltjbGFzcz0na2VuZG90ZW1wbGF0ZUluY2x1ZGUnXVwiKSkuY29udGVudHMoKSkoaW5uZXJTY29wZSk7XHJcblxyXG5cclxuICAgICAgICAgICAgICAgICAgICB2YXIgdGVtcGxhdGUgPSAnPHNjcmlwdCB0eXBlPVwidGV4dC94LWtlbmRvLXRlbXBsYXRlXCIgaWQ9XCInICsgYXR0cnMudGVtcGxhdGVUeXBlICsgJ1wiLWVkaXRvclwiPicgKyBjbG9uZS5odG1sKCkgKyAnPC9zY3JpcHQ+JztcclxuICAgICAgICAgICAgICAgICAgICAkKGVsKS5hcHBlbmQoJGNvbXBpbGUodGVtcGxhdGUpKHNjb3BlKSk7XHJcbiAgICAgICAgICAgICAgICAgICAgLy8kKGVsKS5hcHBlbmQodGVtcGxhdGUpO1xyXG4gICAgICAgICAgICAgICAgICAgICRjb21waWxlKCQoZWwpLmNvbnRlbnRzKCkpKHNjb3BlKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coXCJjaGFuXCIpO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9Ki9cclxuICAgIH07XHJcbn1dKTsiLCJcInVzZSBzdHJpY3RcIjtcclxuXHJcbmFuZ3VsYXIubW9kdWxlKCduYXZjb25NZW51JykuZGlyZWN0aXZlKCduYXZjb25NZW51JywgWyckdGltZW91dCcsIGZ1bmN0aW9uKCR0aW1lb3V0KSB7XHJcbiAgICByZXR1cm4ge1xyXG4gICAgICAgIHNjb3BlOiB7XHJcblxyXG4gICAgICAgIH0sXHJcbiAgICAgICAgdHJhbnNjbHVkZTogdHJ1ZSxcclxuICAgICAgICAvL3RlbXBsYXRlVXJsOiAnZXh0LW1vZHVsZXMvbmF2Y29uTWVudS9uYXZjb25NZW51VGVtcGxhdGUuaHRtbCcsXHJcbiAgICAgICAgdGVtcGxhdGVVcmw6IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICByZXR1cm4gbmF2Y29uLk1lbnVyb3V0ZS5nZXRUZW1wbGF0ZVVybChcIm5hdmNvbk1lbnVcIik7XHJcbiAgICAgICAgfSxcclxuICAgICAgICBjb250cm9sbGVyOiAnbmF2Y29uTWVudUNvbnRyb2xsZXInLFxyXG4gICAgICAgIGxpbms6IGZ1bmN0aW9uKHNjb3BlLCBlbCwgYXR0cikge1xyXG4gICAgICAgICAgICB2YXIgaXRlbSA9IGVsLmZpbmQoJy5uYXZjb24tc2VsZWN0YWJsZS1pdGVtOmZpcnN0Jyk7XHJcbiAgICAgICAgICAgICR0aW1lb3V0KGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICAgICAgaXRlbS50cmlnZ2VyKCdjbGljaycpO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcbiAgICB9O1xyXG59XSk7IiwiXCJ1c2Ugc3RyaWN0XCI7XHJcblxyXG5hbmd1bGFyLm1vZHVsZSgnbmF2Y29uTWVudScpLmRpcmVjdGl2ZSgnbmF2Y29uTWVudUdyb3VwJywgZnVuY3Rpb24oKSB7XHJcbiAgICByZXR1cm4ge1xyXG4gICAgICAgIHJlcXVpcmU6ICdebmF2Y29uTWVudScsXHJcbiAgICAgICAgdHJhbnNjbHVkZTogdHJ1ZSxcclxuICAgICAgICBzY29wZToge1xyXG4gICAgICAgICAgICBsYWJlbDogJ0AnLFxyXG4gICAgICAgICAgICBpY29uOiAnQCdcclxuICAgICAgICB9LFxyXG4gICAgICAgIC8vdGVtcGxhdGVVcmw6ICdleHQtbW9kdWxlcy9uYXZjb25NZW51L25hdmNvbk1lbnVHcm91cFRlbXBsYXRlLmh0bWwnLFxyXG4gICAgICAgIHRlbXBsYXRlVXJsOiBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgcmV0dXJuIG5hdmNvbi5NZW51cm91dGUuZ2V0VGVtcGxhdGVVcmwoXCJuYXZjb25NZW51R3JvdXBcIik7XHJcbiAgICAgICAgfSxcclxuICAgICAgICBsaW5rOiBmdW5jdGlvbihzY29wZSwgZWwsIGF0dHJzLCBjdHJsKSB7XHJcbiAgICAgICAgICAgIHNjb3BlLmlzT3BlbiA9IGZhbHNlO1xyXG4gICAgICAgICAgICBzY29wZS5jbG9zZU1lbnUgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgICAgIHNjb3BlLmlzT3BlbiA9IGZhbHNlO1xyXG4gICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICBzY29wZS5jbGlja2VkID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgICAgICBzY29wZS5pc09wZW4gPSAhc2NvcGUuaXNPcGVuO1xyXG5cclxuICAgICAgICAgICAgICAgIGlmIChlbC5wYXJlbnRzKCcubmF2Y29uLXN1Yml0ZW0tc2VjdGlvbicpLmxlbmd0aCA9PSAwKVxyXG4gICAgICAgICAgICAgICAgICAgIHNjb3BlLnNldFN1Ym1lbnVQb3NpdGlvbigpO1xyXG5cclxuICAgICAgICAgICAgICAgIGN0cmwuc2V0T3Blbk1lbnVTY29wZShzY29wZSk7XHJcbiAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgIHNjb3BlLmlzVmVydGljYWwgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBjdHJsLmlzVmVydGljYWwoKSB8fCBlbC5wYXJlbnRzKCcubmF2Y29uLXN1Yml0ZW0tc2VjdGlvbicpLmxlbmd0aCA+IDA7XHJcbiAgICAgICAgICAgIH07XHJcblxyXG4gICAgICAgICAgICBzY29wZS5zZXRTdWJtZW51UG9zaXRpb24gPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgICAgIHZhciBwb3MgPSBlbC5vZmZzZXQoKTtcclxuICAgICAgICAgICAgICAgICQoJy5uYXZjb24tc3ViaXRlbS1zZWN0aW9uJykuY3NzKHsgJ2xlZnQnOiBwb3MubGVmdCArIDIwLCAndG9wJzogMzYgfSk7XHJcbiAgICAgICAgICAgIH07XHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxufSk7IiwiXCJ1c2Ugc3RyaWN0XCI7XHJcblxyXG5hbmd1bGFyLm1vZHVsZSgnbmF2Y29uTWVudScpLmRpcmVjdGl2ZSgnbmF2Y29uTWVudUl0ZW0nLCBmdW5jdGlvbigpIHtcclxuICAgIHJldHVybiB7XHJcbiAgICAgICAgcmVxdWlyZTogJ15uYXZjb25NZW51JyxcclxuICAgICAgICBzY29wZToge1xyXG4gICAgICAgICAgICBsYWJlbDogJ0AnLFxyXG4gICAgICAgICAgICBpY29uOiAnQCcsXHJcbiAgICAgICAgICAgIHJvdXRlOiAnQCdcclxuICAgICAgICB9LFxyXG4gICAgICAgIC8vdGVtcGxhdGVVcmw6ICdleHQtbW9kdWxlcy9uYXZjb25NZW51L25hdmNvbk1lbnVJdGVtVGVtcGxhdGUuaHRtbCcsXHJcbiAgICAgICAgdGVtcGxhdGVVcmw6IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICByZXR1cm4gbmF2Y29uLk1lbnVyb3V0ZS5nZXRUZW1wbGF0ZVVybChcIm5hdmNvbk1lbnVJdGVtXCIpO1xyXG4gICAgICAgIH0sXHJcbiAgICAgICAgbGluazogZnVuY3Rpb24oc2NvcGUsIGVsLCBhdHRyLCBjdHJsKSB7XHJcblxyXG4gICAgICAgICAgICBzY29wZS5pc0FjdGl2ZSA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGVsID09PSBjdHJsLmdldEFjdGl2ZUVsZW1lbnQoKTtcclxuICAgICAgICAgICAgfTtcclxuXHJcbiAgICAgICAgICAgIHNjb3BlLmlzVmVydGljYWwgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBjdHJsLmlzVmVydGljYWwoKSB8fCBlbC5wYXJlbnRzKCcubmF2Y29uLXN1Yml0ZW0tc2VjdGlvbicpLmxlbmd0aCA+IDA7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGVsLm9uKCdjbGljaycsIGZ1bmN0aW9uKGV2dCkge1xyXG4gICAgICAgICAgICAgICAgZXZ0LnN0b3BQcm9wYWdhdGlvbigpO1xyXG4gICAgICAgICAgICAgICAgZXZ0LnByZXZlbnREZWZhdWx0KCk7XHJcbiAgICAgICAgICAgICAgICBzY29wZS4kYXBwbHkoZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgY3RybC5zZXRBY3RpdmVFbGVtZW50KGVsKTtcclxuICAgICAgICAgICAgICAgICAgICBjdHJsLnNldFJvdXRlKHNjb3BlLnJvdXRlKTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcbiAgICB9O1xyXG59KTsiLCJcInVzZSBzdHJpY3RcIjtcclxuXHJcbmFuZ3VsYXIubW9kdWxlKCdhcHAnKS5kaXJlY3RpdmUoJ25hdmNvbk1vZGFsJywgWydkYXRhc2VydmljZScsICdsb2dnZXInLFxyXG4gICAgZnVuY3Rpb24oZGF0YXNlcnZpY2UsIGxvZ2dlcikge1xyXG4gICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgIC8qRTogRGlyZWN0aXZlIGRlZmluZWQgYXMgYW4gZWxlbWVudC4gPG5hdmNvbi10YWJsZT48L25hdmNvbi10YWJsZT5cclxuICAgICAgICAgICAgQTogRGlyZWN0aXZlIGFwcGxpZWQgYXMgYW4gYXR0cmlidXRlIG9uIGV4aXN0aW5nIGVsZW1lbnQuIDxkaXYgbmF2Y29uLXRhYmxlPjwvZGl2PlxyXG4gICAgICAgICAgICBDOiBEaXJlY3RpdmUgYXBwbGllZCBhcyBhIGNzcyBjbGFzcyB0byBleGlzdGluZyBlbGVtZW50IDxkaXYgY2xhc3M9XCJuYXZjb24tdGFibGVcIj48L2Rpdj5cclxuICAgICAgICAgICAgTTogRGlyZWN0aXZlIGFwcGxpZWQgYXMgY29tbWVudC4qL1xyXG4gICAgICAgICAgICByZXN0cmljdDogJ0UnLFxyXG4gICAgICAgICAgICByZXBsYWNlOiB0cnVlLFxyXG4gICAgICAgICAgICB0cmFuc2NsdWRlOiAnZWxlbWVudCcsXHJcbiAgICAgICAgICAgIHNjb3BlOiB7XHJcbiAgICAgICAgICAgICAgICAvL0AgcmVhZHMgdGhlIGF0dHJpYnV0ZSB2YWx1ZSwgPSBwcm92aWRlcyB0d28td2F5IGJpbmRpbmcsICYgd29ya3Mgd2l0aCBmdW5jdGlvbnNcclxuICAgICAgICAgICAgICAgIG5hdmNvbkRhdGE6ICc9JyxcclxuICAgICAgICAgICAgICAgIHRpdGxlOiAnQCcsXHJcbiAgICAgICAgICAgICAgICBpY29uOiAnQCcsXHJcbiAgICAgICAgICAgICAgICBmb290ZXI6ICdAJyxcclxuICAgICAgICAgICAgICAgIHR5cGU6ICdAaWQnLFxyXG4gICAgICAgICAgICAgICAgc2l6ZTogJ0AnLFxyXG4gICAgICAgICAgICAgICAgc2F2ZTogJ0AnLFxyXG4gICAgICAgICAgICAgICAgZm9ybVZhbGlkOiAnQCcsXHJcbiAgICAgICAgICAgICAgICBmaWVsZERhdGE6ICc9JyxcclxuICAgICAgICAgICAgICAgIGNhbmNlbDogJ0AnLFxyXG4gICAgICAgICAgICAgICAgb3ZlcmZsb3c6ICdAJ1xyXG4gICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAvL3RlbXBsYXRlVXJsOiAnZXh0LW1vZHVsZXMvbmF2Y29uTW9kYWwvbmF2Y29uTW9kYWxUZW1wbGF0ZS5odG1sJyxcclxuICAgICAgICAgICAgdGVtcGxhdGVVcmw6IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIG5hdmNvbi5NZW51cm91dGUuZ2V0VGVtcGxhdGVVcmwoXCJuYXZjb25Nb2RhbFwiKTtcclxuICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgbGluazogZnVuY3Rpb24oc2NvcGUsIGVsLCBhdHRycykge1xyXG5cclxuXHJcbiAgICAgICAgICAgICAgICBzY29wZS5maWVsZHMgPSB7fTtcclxuXHJcbiAgICAgICAgICAgICAgICBzY29wZS5jYW5jZWwgPSBmdW5jdGlvbih0eXBlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgbmF2Y29uLnNldFZpZXdDb250ZW50RGlzYWJsZWQoXCJcIik7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGlmIChzY29wZS5uYXZjb25EYXRhICE9PSB1bmRlZmluZWQgJiYgc2NvcGUubmF2Y29uRGF0YS5jYW5jZWwgIT09IHVuZGVmaW5lZClcclxuICAgICAgICAgICAgICAgICAgICAgICAgc2NvcGUubmF2Y29uRGF0YS5jYW5jZWwodHlwZSk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIHNjb3BlLmZvcm1SZXNldCgpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIHNjb3BlLmZvcm1SZXNldCA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChzY29wZS5maWVsZERhdGEgPT09IHVuZGVmaW5lZCB8fCBzY29wZS5maWVsZERhdGEubGVuZ3RoID09PSB1bmRlZmluZWQpIHJldHVybiB0cnVlO1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciByZXRWYWwgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSAwLCBsZW4gPSBzY29wZS5maWVsZERhdGEubGVuZ3RoOyBpIDwgbGVuOyBpKyspIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHNjb3BlLmZpZWxkRGF0YVtpXS5mb3JtICE9PSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChzY29wZS5maWVsZERhdGFbaV0uZm9ybS4kc2V0UHJpc3RpbmUgIT09IHVuZGVmaW5lZCAmJiB0eXBlb2Ygc2NvcGUuZmllbGREYXRhW2ldLmZvcm0uJHNldFByaXN0aW5lID09PSBcImZ1bmN0aW9uXCIpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2NvcGUuZmllbGREYXRhW2ldLmZvcm0uJHNldFByaXN0aW5lKCk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHNjb3BlLmZpZWxkRGF0YVtpXS5mb3JtLiRzZXRVbnRvdWNoZWQgIT09IHVuZGVmaW5lZCAmJiB0eXBlb2Ygc2NvcGUuZmllbGREYXRhW2ldLmZvcm0uJHNldFVudG91Y2hlZCA9PT0gXCJmdW5jdGlvblwiKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNjb3BlLmZpZWxkRGF0YVtpXS5mb3JtLiRzZXRVbnRvdWNoZWQoKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH07XHJcblxyXG5cclxuICAgICAgICAgICAgICAgIHNjb3BlLnNhdmUgPSBmdW5jdGlvbih0eXBlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHNjb3BlLmZvcm1WYWxpZCgpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHNjb3BlLm5hdmNvbkRhdGEuc2F2ZSh0eXBlKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIG1zZyA9IFwiRW50cmllcyBhcmUgc2F2ZWQgc3VjY2Vzc2Z1bGx5Li4uXCI7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChzY29wZS5uYXZjb25EYXRhICE9PSB1bmRlZmluZWQgJiYgc2NvcGUubmF2Y29uRGF0YS5tb2RlICE9PSB1bmRlZmluZWQgJiYgc2NvcGUubmF2Y29uRGF0YS5tb2RlID09PSBcIlVwZGF0ZVwiKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbXNnID0gXCJFbnRyaWVzIGFyZSB1cGRhdGVkIHN1Y2Nlc3NmdWxseS4uLlwiO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHNjb3BlLm5hdmNvbkRhdGEgIT09IHVuZGVmaW5lZCAmJiBzY29wZS5uYXZjb25EYXRhLm1vZGUgIT09IHVuZGVmaW5lZCAmJiBzY29wZS5uYXZjb25EYXRhLm1vZGUgIT09IFwiRGVsZXRlXCIpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2dnZXIuc3VjY2Vzcyhtc2csIFwiXCIsIFwiXCIpO1xyXG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGxvZ2dlci53YXJuaW5nKFwiSW52YWxpZCBlbnRyaWVzLi4uXCIsIFwiXCIsIFwiXCIpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH07XHJcblxyXG4gICAgICAgICAgICAgICAgc2NvcGUuZm9ybVZhbGlkID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHNjb3BlLmZpZWxkRGF0YSA9PT0gdW5kZWZpbmVkIHx8IHNjb3BlLmZpZWxkRGF0YS5sZW5ndGggPT09IHVuZGVmaW5lZCkgcmV0dXJuIHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIHJldFZhbCA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDAsIGxlbiA9IHNjb3BlLmZpZWxkRGF0YS5sZW5ndGg7IGkgPCBsZW47IGkrKykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoc2NvcGUuZmllbGREYXRhW2ldLnZhbGlkICE9PSB1bmRlZmluZWQgJiYgc2NvcGUuZmllbGREYXRhW2ldLnZhbGlkID09PSBmYWxzZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJldFZhbDtcclxuICAgICAgICAgICAgICAgIH07XHJcblxyXG4gICAgICAgICAgICAgICAgJChlbCkuZHJhZ2dhYmxlKHtcclxuICAgICAgICAgICAgICAgICAgICBoYW5kbGU6IFwiLmNvbnRlbnRcIixcclxuICAgICAgICAgICAgICAgICAgICBjYW5jZWw6IFwiLm1vZGFsLWJvZHlcIlxyXG4gICAgICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICAgICAgJChlbCkuYWRkQ2xhc3Moc2NvcGUuc2l6ZSk7XHJcblxyXG4gICAgICAgICAgICAgICAgJChlbCkub24oJ3Nob3duLmJzLm1vZGFsJywgZnVuY3Rpb24oZXZlbnQpIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoc2NvcGUub3ZlcmZsb3cgIT09IHVuZGVmaW5lZCAmJiBzY29wZS5vdmVyZmxvdyA9PT0gJ2hpZGUnKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICQoJChldmVudC50YXJnZXQpLmZpbmQoJ2RpdicpWzBdKS5jc3MoXCJvdmVyZmxvd1wiLCBcImhpZGRlblwiKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgLy8kKCQoZXZlbnQudGFyZ2V0KS5maW5kKFwiZGl2W3R5cGU9J2NhbGVuZGFyJ11cIikpLmZ1bGxDYWxlbmRhcigncmVuZGVyJyk7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH07XHJcbiAgICB9XHJcbl0pOyIsIlwidXNlIHN0cmljdFwiO1xyXG5cclxuYW5ndWxhci5tb2R1bGUoJ2FwcCcpLmRpcmVjdGl2ZSgnbmF2Y29uUGFnZWJhcicsIFtcclxuICAgIGZ1bmN0aW9uKGRhdGFTZXJ2aWNlKSB7XHJcbiAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgLypFOiBEaXJlY3RpdmUgZGVmaW5lZCBhcyBhbiBlbGVtZW50LiA8bmF2Y29uLXRhYmxlPjwvbmF2Y29uLXRhYmxlPlxyXG4gICAgICAgICAgICBBOiBEaXJlY3RpdmUgYXBwbGllZCBhcyBhbiBhdHRyaWJ1dGUgb24gZXhpc3RpbmcgZWxlbWVudC4gPGRpdiBuYXZjb24tdGFibGU+PC9kaXY+XHJcbiAgICAgICAgICAgIEM6IERpcmVjdGl2ZSBhcHBsaWVkIGFzIGEgY3NzIGNsYXNzIHRvIGV4aXN0aW5nIGVsZW1lbnQgPGRpdiBjbGFzcz1cIm5hdmNvbi10YWJsZVwiPjwvZGl2PlxyXG4gICAgICAgICAgICBNOiBEaXJlY3RpdmUgYXBwbGllZCBhcyBjb21tZW50LiovXHJcbiAgICAgICAgICAgIHJlc3RyaWN0OiAnRScsXHJcbiAgICAgICAgICAgIHNjb3BlOiB7XHJcbiAgICAgICAgICAgICAgICAvL0AgcmVhZHMgdGhlIGF0dHJpYnV0ZSB2YWx1ZSwgPSBwcm92aWRlcyB0d28td2F5IGJpbmRpbmcsICYgd29ya3Mgd2l0aCBmdW5jdGlvbnNcclxuICAgICAgICAgICAgICAgIGJyZWFkY3J1bWJzOiAnPSdcclxuICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgLy90ZW1wbGF0ZVVybDogJ2V4dC1tb2R1bGVzL25hdmNvblBhZ2ViYXIvbmF2Y29uUGFnZWJhclRlbXBsYXRlLmh0bWwnLFxyXG4gICAgICAgICAgICB0ZW1wbGF0ZVVybDogZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gbmF2Y29uLk1lbnVyb3V0ZS5nZXRUZW1wbGF0ZVVybChcIm5hdmNvblBhZ2ViYXJcIik7XHJcbiAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgIGxpbms6IGZ1bmN0aW9uKHNjb3BlLCBlbCwgYXR0cnMpIHtcclxuICAgICAgICAgICAgICAgIC8vY29uc29sZS5sb2coc2NvcGUpOyAgICBcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH07XHJcbiAgICB9XHJcbl0pOyIsIlwidXNlIHN0cmljdFwiO1xyXG5hbmd1bGFyLm1vZHVsZSgnYXBwJykuZGlyZWN0aXZlKCduYXZjb25SYXRpbmcnLCBbJ2RhdGFzZXJ2aWNlJywgJ2FwcEluZm8nLCAncGhvdG9NYW5hZ2VyJywgJ2xvZ2dlcicsICduZ0F1dGhTZXR0aW5ncycsXHJcbiAgICBmdW5jdGlvbihkYXRhc2VydmljZSwgYXBwSW5mbywgcGhvdG9NYW5hZ2VyLCBsb2dnZXIsIG5nQXV0aFNldHRpbmdzKSB7XHJcbiAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgLypFOiBEaXJlY3RpdmUgZGVmaW5lZCBhcyBhbiBlbGVtZW50LiA8bmF2Y29uLXRhYmxlPjwvbmF2Y29uLXRhYmxlPlxyXG4gICAgICAgICAgICBBOiBEaXJlY3RpdmUgYXBwbGllZCBhcyBhbiBhdHRyaWJ1dGUgb24gZXhpc3RpbmcgZWxlbWVudC4gPGRpdiBuYXZjb24tdGFibGU+PC9kaXY+XHJcbiAgICAgICAgICAgIEM6IERpcmVjdGl2ZSBhcHBsaWVkIGFzIGEgY3NzIGNsYXNzIHRvIGV4aXN0aW5nIGVsZW1lbnQgPGRpdiBjbGFzcz1cIm5hdmNvbi10YWJsZVwiPjwvZGl2PlxyXG4gICAgICAgICAgICBNOiBEaXJlY3RpdmUgYXBwbGllZCBhcyBjb21tZW50LiovXHJcbiAgICAgICAgICAgIHJlc3RyaWN0OiAnRScsXHJcbiAgICAgICAgICAgIHNjb3BlOiB7XHJcbiAgICAgICAgICAgICAgICBuZ1JhdGluZzogJz0nLFxyXG4gICAgICAgICAgICAgICAgbWF4UmF0aW5nOiAnPScsXHJcbiAgICAgICAgICAgICAgICByZWFkT25seTogJz0nXHJcbiAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgIC8vdGVtcGxhdGVVcmw6ICdleHQtbW9kdWxlcy9uYXZjb25SYXRpbmcvbmF2Y29uUmF0aW5nVGVtcGxhdGUuaHRtbCcsXHJcbiAgICAgICAgICAgIHRlbXBsYXRlVXJsOiBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBuYXZjb24uTWVudXJvdXRlLmdldFRlbXBsYXRlVXJsKFwibmF2Y29uUmF0aW5nXCIpO1xyXG4gICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICBsaW5rOiBmdW5jdGlvbihzY29wZSwgZWwsIGF0dHJzKSB7XHJcblxyXG4gICAgICAgICAgICAgICAgc2NvcGUubWF4UmF0aW5ncyA9IFtdO1xyXG4gICAgICAgICAgICAgICAgaWYgKHNjb3BlLm1heFJhdGluZyA9PT0gdW5kZWZpbmVkKSBzY29wZS5tYXhSYXRpbmcgPSA1O1xyXG4gICAgICAgICAgICAgICAgaWYgKHNjb3BlLm5nUmF0aW5nID09PSB1bmRlZmluZWQpIHNjb3BlLm5nUmF0aW5nID0gMDtcclxuICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSAxOyBpIDw9IHNjb3BlLm1heFJhdGluZzsgaSsrKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgc2NvcGUubWF4UmF0aW5ncy5wdXNoKHt9KTtcclxuICAgICAgICAgICAgICAgIH07XHJcblxyXG4gICAgICAgICAgICAgICAgc2NvcGUuX3JhdGluZyA9IHNjb3BlLm5nUmF0aW5nO1xyXG5cclxuXHJcbiAgICAgICAgICAgICAgICBzY29wZS5jbGljayA9IGZ1bmN0aW9uKHBhcmFtKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHNjb3BlLnJlYWRPbmx5IHx8IHNjb3BlLnJlYWRPbmx5ID09ICd0cnVlJykgcmV0dXJuO1xyXG4gICAgICAgICAgICAgICAgICAgIHNjb3BlLm5nUmF0aW5nID0gc2NvcGUuX3JhdGluZyA9IHBhcmFtO1xyXG4gICAgICAgICAgICAgICAgICAgIHNjb3BlLmhvdmVyVmFsdWUgPSAwO1xyXG4gICAgICAgICAgICAgICAgfTtcclxuXHJcbiAgICAgICAgICAgICAgICBzY29wZS5tb3VzZUhvdmVyID0gZnVuY3Rpb24ocGFyYW0pIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoc2NvcGUucmVhZE9ubHkgfHwgc2NvcGUucmVhZE9ubHkgPT0gJ3RydWUnKSByZXR1cm47XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIHNjb3BlLl9yYXRpbmcgPSAwO1xyXG4gICAgICAgICAgICAgICAgICAgIHNjb3BlLmhvdmVyVmFsdWUgPSBwYXJhbTtcclxuICAgICAgICAgICAgICAgIH07XHJcblxyXG4gICAgICAgICAgICAgICAgc2NvcGUubW91c2VMZWF2ZSA9IGZ1bmN0aW9uKHBhcmFtKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHNjb3BlLnJlYWRPbmx5IHx8IHNjb3BlLnJlYWRPbmx5ID09ICd0cnVlJykgcmV0dXJuO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICBzY29wZS5fcmF0aW5nID0gc2NvcGUubmdSYXRpbmc7XHJcbiAgICAgICAgICAgICAgICAgICAgc2NvcGUuaG92ZXJWYWx1ZSA9IDA7XHJcbiAgICAgICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfTtcclxuICAgIH1cclxuXSk7IiwiXCJ1c2Ugc3RyaWN0XCI7XHJcblxyXG5hbmd1bGFyLm1vZHVsZSgnYXBwJykuZGlyZWN0aXZlKCduYXZjb25Qb3BvdmVyJywgWydkYXRhc2VydmljZScsICckY29tcGlsZScsICdsb2dnZXInLCAnJHJvb3RTY29wZScsICckdGltZW91dCcsXHJcbmZ1bmN0aW9uIChkYXRhc2VydmljZSwgJGNvbXBpbGUsIGxvZ2dlciwgJHJvb3RTY29wZSwgJHRpbWVvdXQpIHtcclxuICAgIHJldHVybiB7XHJcbiAgICAgICAgLypFOiBEaXJlY3RpdmUgZGVmaW5lZCBhcyBhbiBlbGVtZW50LiA8bmF2Y29uLXRhYmxlPjwvbmF2Y29uLXRhYmxlPlxyXG4gICAgICAgIEE6IERpcmVjdGl2ZSBhcHBsaWVkIGFzIGFuIGF0dHJpYnV0ZSBvbiBleGlzdGluZyBlbGVtZW50LiA8ZGl2IG5hdmNvbi10YWJsZT48L2Rpdj5cclxuICAgICAgICBDOiBEaXJlY3RpdmUgYXBwbGllZCBhcyBhIGNzcyBjbGFzcyB0byBleGlzdGluZyBlbGVtZW50IDxkaXYgY2xhc3M9XCJuYXZjb24tdGFibGVcIj48L2Rpdj5cclxuICAgICAgICBNOiBEaXJlY3RpdmUgYXBwbGllZCBhcyBjb21tZW50LiovXHJcbiAgICAgICAgcmVzdHJpY3Q6ICdBJyxcclxuICAgICAgICB0cmFuc2NsdWRlOiB0cnVlLFxyXG4gICAgICAgIHNjb3BlOiB7XHJcbiAgICAgICAgICAgIC8vQCByZWFkcyB0aGUgYXR0cmlidXRlIHZhbHVlLCA9IHByb3ZpZGVzIHR3by13YXkgYmluZGluZywgJiB3b3JrcyB3aXRoIGZ1bmN0aW9uc1xyXG4gICAgICAgICAgICB3aWRnZXRJZDogJz0nLFxyXG4gICAgICAgICAgICB0aXRsZTogJ0AnLFxyXG4gICAgICAgICAgICB0ZW1wbGF0ZVNldHRpbmdzOiAnPScsXHJcbiAgICAgICAgICAgIHJlcG9ydERhdGE6ICc9JyxcclxuICAgICAgICAgICAgZGVmYXVsdFJlcG9ydDogJz0nXHJcbiAgICAgICAgfSxcclxuICAgICAgICB0ZW1wbGF0ZTogJzxzcGFuIG5nLXRyYW5zY2x1ZGU+PC9zcGFuPicsXHJcbiAgICAgICAgbGluazogZnVuY3Rpb24gKHNjb3BlLCBlbGVtZW50LCBhdHRycykge1xyXG4gICAgICAgICAgICAvL3Njb3BlLnNlbGVjdGVkUmVwb3J0ID0gc2NvcGUuZGVmYXVsdFJlcG9ydDtcclxuXHJcbiAgICAgICAgICAgIGVsZW1lbnQuYmluZCgnZm9jdXMnLCBmdW5jdGlvbiAoZSkge1xyXG4gICAgICAgICAgICAgICAgdmFyIHBvcHVwSWQgPSAkKGVsZW1lbnQpLmF0dHIoXCJhcmlhLWRlc2NyaWJlZGJ5XCIpO1xyXG4gICAgICAgICAgICAgICAgJCgnIycgKyBwb3B1cElkKS5jc3MoJ2xlZnQnLCAnLTI1MXB4Jyk7XHJcbiAgICAgICAgICAgICAgICAkKCcjJyArIHBvcHVwSWQpLmZpbmQoXCIuYXJyb3dcIikuY3NzKCdsZWZ0JywgJzk1JScpO1xyXG4gICAgICAgICAgICAgICAgJCgnIycgKyBwb3B1cElkKS5zaG93KCk7XHJcbiAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgc2NvcGUuaXRlbXMgPSBbXTtcclxuICAgICAgICAgICAgc2NvcGUuJHdhdGNoKCdyZXBvcnREYXRhJywgZnVuY3Rpb24gKG5ld1ZhbHVlLCBvbGRWYWx1ZSkge1xyXG4gICAgICAgICAgICAgICAgaWYgKG5ld1ZhbHVlICE9PSB1bmRlZmluZWQgJiYgbmV3VmFsdWUgIT09IG9sZFZhbHVlICYmIG5ld1ZhbHVlLmxlbmd0aCAhPT0gMCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHNjb3BlLml0ZW1zID0gbmV3VmFsdWU7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGlmIChzY29wZS5kZWZhdWx0UmVwb3J0ID09IHVuZGVmaW5lZCB8fCBzY29wZS5kZWZhdWx0UmVwb3J0ID09IG51bGwgfHwgc2NvcGUuZGVmYXVsdFJlcG9ydCA9PT0gLTEpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgc2NvcGUuc2VsZWN0ZWRSZXBvcnQgPSBzY29wZS5pdGVtc1swXTtcclxuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBzY29wZS5zZWxlY3RlZFJlcG9ydCA9IHNjb3BlLmRlZmF1bHRSZXBvcnQ7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9LCB0cnVlKTtcclxuXHJcbiAgICAgICAgICAgIHZhciBwb3BPdmVyQ29udGVudDtcclxuXHJcbiAgICAgICAgICAgIHNjb3BlLiR3YXRjaCgndGVtcGxhdGVTZXR0aW5ncycsIGZ1bmN0aW9uIChuZXdWYWx1ZSwgb2xkVmFsdWUpIHtcclxuICAgICAgICAgICAgICAgIGlmIChuZXdWYWx1ZSAhPT0gdW5kZWZpbmVkKSB7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGlmIChzY29wZS5pdGVtcykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgaHRtbCA9IG5ld1ZhbHVlLnRlbXBsYXRlSHRtbDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcG9wT3ZlckNvbnRlbnQgPSAkY29tcGlsZShodG1sKShzY29wZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIG5ld1ZhbHVlLmNvbnRlbnQgPSBwb3BPdmVyQ29udGVudDtcclxuICAgICAgICAgICAgICAgICAgICAkKGVsZW1lbnQpLnBvcG92ZXIobmV3VmFsdWUpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgIHNjb3BlLiR3YXRjaCgnc2VsZWN0ZWRSZXBvcnQnLCBmdW5jdGlvbiAobmV3VmFsdWUsIG9sZFZhbHVlKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAobmV3VmFsdWUgIT09IHVuZGVmaW5lZCAmJiBvbGRWYWx1ZSAhPT0gdW5kZWZpbmVkICYmIG5ld1ZhbHVlLmxlbmd0aCAhPT0gMCAmJiBuZXdWYWx1ZSAhPT0gb2xkVmFsdWUpIHtcclxuICAgICAgICAgICAgICAgICAgICAkcm9vdFNjb3BlLiRicm9hZGNhc3QoJ1BPUE9WRVItV0lER0VULVNFVFRJTkcnLCBzY29wZSwgYW5ndWxhci5mcm9tSnNvbihuZXdWYWx1ZSksIGZ1bmN0aW9uICgpIHsgfSk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIHZhciBhdHRyID0gJChlbGVtZW50KS5hdHRyKCdhcmlhLWRlc2NyaWJlZGJ5Jyk7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHR5cGVvZiBhdHRyICE9PSB0eXBlb2YgdW5kZWZpbmVkICYmIGF0dHIgIT09IFwiXCIpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgJChlbGVtZW50KS5wb3BvdmVyKFwiaGlkZVwiKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuICAgIH07XHJcbn1dKTsiLCJcInVzZSBzdHJpY3RcIjtcclxuYW5ndWxhci5tb2R1bGUoJ2FwcCcpLmRpcmVjdGl2ZSgnbmF2Y29uUmVhZG1vcmUnLCBbJ2RhdGFzZXJ2aWNlJywgJyRjb21waWxlJywgJ2xvZ2dlcicsICckcm9vdFNjb3BlJyxcclxuZnVuY3Rpb24gKGRhdGFzZXJ2aWNlLCAkY29tcGlsZSwgbG9nZ2VyLCAkcm9vdFNjb3BlKSB7XHJcbiAgICByZXR1cm4ge1xyXG4gICAgICAgIHJlc3RyaWN0OiAnQScsXHJcbiAgICAgICAgdHJhbnNjbHVkZTogdHJ1ZSxcclxuICAgICAgICByZXBsYWNlOiBmYWxzZSxcbiAgICAgICAgdGVtcGxhdGU6ICc8cD48L3A+JyxcclxuICAgICAgICBzY29wZToge1xyXG4gICAgICAgICAgICBtb3JlVGV4dDogJ0AnLFxuICAgICAgICAgICAgbGVzc1RleHQ6ICdAJyxcbiAgICAgICAgICAgIHdvcmRzOiAnQCcsXG4gICAgICAgICAgICBlbGxpcHNpczogJ0AnLFxuICAgICAgICAgICAgY2hhcjogJ0AnLFxuICAgICAgICAgICAgbGltaXQ6ICdAJyxcbiAgICAgICAgICAgIGNvbnRlbnQ6ICdAJ1xyXG4gICAgICAgIH0sXG4gICAgICAgIGxpbms6IGZ1bmN0aW9uIChzY29wZSwgZWxlbSwgYXR0ciwgY3RybCwgdHJhbnNjbHVkZSkge1xyXG4gICAgICAgICAgICB2YXIgbW9yZVRleHQgPSBhbmd1bGFyLmlzVW5kZWZpbmVkKHNjb3BlLm1vcmVUZXh0KSA/ICcgPGEgY2xhc3M9XCJyZWFkLW1vcmVcIj5SZWFkIE1vcmUuLi48L2E+JyA6ICcgPGEgY2xhc3M9XCJyZWFkLW1vcmVcIj4nICsgc2NvcGUubW9yZVRleHQgKyAnPC9hPicsXG4gICAgICAgICAgICAgICAgbGVzc1RleHQgPSBhbmd1bGFyLmlzVW5kZWZpbmVkKHNjb3BlLmxlc3NUZXh0KSA/ICcgPGEgY2xhc3M9XCJyZWFkLWxlc3NcIj5MZXNzIF48L2E+JyA6ICcgPGEgY2xhc3M9XCJyZWFkLWxlc3NcIj4nICsgc2NvcGUubGVzc1RleHQgKyAnPC9hPicsXG4gICAgICAgICAgICAgICAgZWxsaXBzaXMgPSBhbmd1bGFyLmlzVW5kZWZpbmVkKHNjb3BlLmVsbGlwc2lzKSA/ICcnIDogc2NvcGUuZWxsaXBzaXMsXG4gICAgICAgICAgICAgICAgbGltaXQgPSBhbmd1bGFyLmlzVW5kZWZpbmVkKHNjb3BlLmxpbWl0KSA/IDE1MCA6IHNjb3BlLmxpbWl0O1xuXG4gICAgICAgICAgICBhdHRyLiRvYnNlcnZlKCdjb250ZW50JywgZnVuY3Rpb24gKHN0cikge1xyXG4gICAgICAgICAgICAgICAgcmVhZG1vcmUoc3RyKTtcclxuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIC8qdHJhbnNjbHVkZShzY29wZS4kcGFyZW50LCBmdW5jdGlvbiAoY2xvbmUsIHNjb3BlKSB7XHJcbiAgICAgICAgICAgICAgICByZWFkbW9yZShjbG9uZS50ZXh0KCkudHJpbSgpKTtcclxuICAgICAgICAgICAgfSk7Ki9cblxuICAgICAgICAgICAgZnVuY3Rpb24gcmVhZG1vcmUodGV4dCkge1xuICAgICAgICAgICAgICAgIHZhciB0ZXh0ID0gdGV4dCxcbiAgICAgICAgICAgICAgICAgIG9yaWcgPSB0ZXh0LFxuICAgICAgICAgICAgICAgICAgcmVnZXggPSAvXFxzKy9naSxcbiAgICAgICAgICAgICAgICAgIGNoYXJDb3VudCA9IHRleHQubGVuZ3RoLFxuICAgICAgICAgICAgICAgICAgd29yZENvdW50ID0gdGV4dC50cmltKCkucmVwbGFjZShyZWdleCwgJyAnKS5zcGxpdCgnICcpLmxlbmd0aCxcbiAgICAgICAgICAgICAgICAgIGNvdW50QnkgPSAnY2hhcicsXG4gICAgICAgICAgICAgICAgICBjb3VudCA9IGNoYXJDb3VudCxcbiAgICAgICAgICAgICAgICAgIGZvdW5kV29yZHMgPSBbXSxcbiAgICAgICAgICAgICAgICAgIG1hcmt1cCA9IHRleHQsXG4gICAgICAgICAgICAgICAgICBtb3JlID0gJyc7XG5cbiAgICAgICAgICAgICAgICBpZiAoIWFuZ3VsYXIuaXNVbmRlZmluZWQoYXR0ci53b3JkcykpIHtcclxuICAgICAgICAgICAgICAgICAgICBjb3VudEJ5ID0gJ3dvcmRzJztcbiAgICAgICAgICAgICAgICAgICAgY291bnQgPSB3b3JkQ291bnQ7XHJcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBpZiAoY291bnRCeSA9PT0gJ3dvcmRzJykgeyAvLyBDb3VudCB3b3Jkc1xuXG4gICAgICAgICAgICAgICAgICAgIGZvdW5kV29yZHMgPSB0ZXh0LnNwbGl0KC9cXHMrLyk7XG5cbiAgICAgICAgICAgICAgICAgICAgaWYgKGZvdW5kV29yZHMubGVuZ3RoID4gbGltaXQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGV4dCA9IGZvdW5kV29yZHMuc2xpY2UoMCwgbGltaXQpLmpvaW4oJyAnKSArIGVsbGlwc2lzO1xuICAgICAgICAgICAgICAgICAgICAgICAgbW9yZSA9IGZvdW5kV29yZHMuc2xpY2UobGltaXQsIGNvdW50KS5qb2luKCcgJyk7XG4gICAgICAgICAgICAgICAgICAgICAgICBtYXJrdXAgPSB0ZXh0ICsgbW9yZVRleHQgKyAnPHNwYW4gY2xhc3M9XCJtb3JlLXRleHRcIj4nICsgbW9yZSArIGxlc3NUZXh0ICsgJzwvc3Bhbj4nO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuXG4gICAgICAgICAgICAgICAgfSBlbHNlIHsgLy8gQ291bnQgY2hhcmFjdGVyc1xuXG4gICAgICAgICAgICAgICAgICAgIGlmIChjb3VudCA+IGxpbWl0KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRleHQgPSBvcmlnLnNsaWNlKDAsIGxpbWl0KSArIGVsbGlwc2lzO1xuICAgICAgICAgICAgICAgICAgICAgICAgbW9yZSA9IG9yaWcuc2xpY2UobGltaXQsIGNvdW50KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIG1hcmt1cCA9IHRleHQgKyBtb3JlVGV4dCArICc8c3BhbiBjbGFzcz1cIm1vcmUtdGV4dFwiPicgKyBtb3JlICsgbGVzc1RleHQgKyAnPC9zcGFuPic7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG5cbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBlbGVtLmFwcGVuZChtYXJrdXApO1xuICAgICAgICAgICAgICAgIGVsZW0uZmluZCgnLnJlYWQtbW9yZScpLm9uKCdjbGljaycsIGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgICAgICAkKHRoaXMpLmhpZGUoKTtcbiAgICAgICAgICAgICAgICAgICAgZWxlbS5maW5kKCcubW9yZS10ZXh0JykuYWRkQ2xhc3MoJ3Nob3cnKS5zbGlkZURvd24oKTtcclxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIGVsZW0uZmluZCgnLnJlYWQtbGVzcycpLm9uKCdjbGljaycsIGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgICAgICBlbGVtLmZpbmQoJy5yZWFkLW1vcmUnKS5zaG93KCk7XG4gICAgICAgICAgICAgICAgICAgIGVsZW0uZmluZCgnLm1vcmUtdGV4dCcpLmhpZGUoKS5yZW1vdmVDbGFzcygnc2hvdycpO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcblxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH07XHJcbn1dKTsiLCJcInVzZSBzdHJpY3RcIjtcclxuXHJcbmFuZ3VsYXIubW9kdWxlKCdhcHAnKS5kaXJlY3RpdmUoJ25hdmNvblBvcnRsZXQnLCBbXHJcbiAgICBmdW5jdGlvbihkYXRhU2VydmljZSkge1xyXG4gICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgIC8qRTogRGlyZWN0aXZlIGRlZmluZWQgYXMgYW4gZWxlbWVudC4gPG5hdmNvbi10YWJsZT48L25hdmNvbi10YWJsZT5cclxuICAgICAgICAgICAgQTogRGlyZWN0aXZlIGFwcGxpZWQgYXMgYW4gYXR0cmlidXRlIG9uIGV4aXN0aW5nIGVsZW1lbnQuIDxkaXYgbmF2Y29uLXRhYmxlPjwvZGl2PlxyXG4gICAgICAgICAgICBDOiBEaXJlY3RpdmUgYXBwbGllZCBhcyBhIGNzcyBjbGFzcyB0byBleGlzdGluZyBlbGVtZW50IDxkaXYgY2xhc3M9XCJuYXZjb24tdGFibGVcIj48L2Rpdj5cclxuICAgICAgICAgICAgTTogRGlyZWN0aXZlIGFwcGxpZWQgYXMgY29tbWVudC4qL1xyXG4gICAgICAgICAgICByZXN0cmljdDogJ0UnLFxyXG4gICAgICAgICAgICByZXBsYWNlOiB0cnVlLFxyXG4gICAgICAgICAgICB0cmFuc2NsdWRlOiAnZWxlbWVudCcsXHJcbiAgICAgICAgICAgIHNjb3BlOiB7XHJcbiAgICAgICAgICAgICAgICAvL0AgcmVhZHMgdGhlIGF0dHJpYnV0ZSB2YWx1ZSwgPSBwcm92aWRlcyB0d28td2F5IGJpbmRpbmcsICYgd29ya3Mgd2l0aCBmdW5jdGlvbnNcclxuICAgICAgICAgICAgICAgIHRpdGxlOiAnQCcsXHJcbiAgICAgICAgICAgICAgICBjbGFzczogJ0AnLFxyXG4gICAgICAgICAgICAgICAgbmF2Y29uRGF0YTogJz0nLFxyXG4gICAgICAgICAgICAgICAgdG9vbHNEaXNwOiAnQCcsXHJcbiAgICAgICAgICAgICAgICBpY29uOiAnQCcsXHJcbiAgICAgICAgICAgICAgICB0b29sQ29sbGFwc2U6ICc9JyxcclxuICAgICAgICAgICAgICAgIHJlZnJlc2g6ICdAJyxcclxuICAgICAgICAgICAgICAgIGlzVGl0bGU6ICdAJyxcclxuICAgICAgICAgICAgICAgIHN1YlRpdGxlOiAnQCcsXHJcbiAgICAgICAgICAgICAgICBzaG93Q2FwdGlvbjogJ0AnXHJcbiAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgIC8vdGVtcGxhdGVVcmw6ICdleHQtbW9kdWxlcy9uYXZjb25Qb3J0bGV0L25hdmNvblBvcnRsZXRUZW1wbGF0ZS5odG1sJyxcclxuICAgICAgICAgICAgdGVtcGxhdGVVcmw6IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIG5hdmNvbi5NZW51cm91dGUuZ2V0VGVtcGxhdGVVcmwoXCJuYXZjb25Qb3J0bGV0XCIpO1xyXG4gICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICBsaW5rOiBmdW5jdGlvbihzY29wZSwgZWwsIGF0dHJzKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoc2NvcGUuc2hvd0NhcHRpb24gPT09IHVuZGVmaW5lZCB8fCBzY29wZS5zaG93Q2FwdGlvbiA9PT0gXCJcIikgc2NvcGUuc2hvd0NhcHRpb24gPSAnZmFsc2UnO1xyXG5cclxuICAgICAgICAgICAgICAgIGlmIChzY29wZS5pc1RpdGxlID09PSB1bmRlZmluZWQpIHNjb3BlLmlzVGl0bGUgPSAndHJ1ZSc7XHJcblxyXG4gICAgICAgICAgICAgICAgaWYgKHNjb3BlLnRvb2xDb2xsYXBzZSAhPT0gdW5kZWZpbmVkICYmIHNjb3BlLnRvb2xDb2xsYXBzZSA9PT0gdHJ1ZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICQoZWwpLmZpbmQoXCIucG9ydGxldC1ib2R5XCIpLmZpcnN0KCkuY3NzKFwiZGlzcGxheVwiLCBcIm5vbmVcIik7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICQoZWwpLmZpbmQoXCIucG9ydGxldC1ib2R5XCIpLmZpcnN0KCkuY3NzKFwiZGlzcGxheVwiLCBcImJsb2NrXCIpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIHNjb3BlLnJlZnJlc2ggPSBmdW5jdGlvbihldmVudCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciB0YWJsZVR5cGUgPSAkKGV2ZW50LnNyY0VsZW1lbnQpLnBhcmVudHMoXCIucG9ydGxldDpmaXJzdFwiKS5maW5kKFwidGFibGU6Zmlyc3RcIikucGFyZW50cygnbmF2Y29uLXRhYmxlOmZpcnN0JykuYXR0cihcInR5cGVcIik7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHRhYmxlVHlwZSAhPT0gdW5kZWZpbmVkICYmIHNjb3BlLm5hdmNvbkRhdGEudGFibGVSZWZyZXNoICE9PSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgc2NvcGUubmF2Y29uRGF0YS50YWJsZVJlZnJlc2godGFibGVUeXBlKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIHZhciB0cmVlVHlwZSA9ICQoZXZlbnQuc3JjRWxlbWVudCkucGFyZW50cyhcIi5wb3J0bGV0OmZpcnN0XCIpLmZpbmQoXCJkaXZbdHlwZT0ndHJlZSddOmZpcnN0XCIpLnBhcmVudHMoJ25hdmNvbi10cmVlOmZpcnN0JykuYXR0cihcInR5cGVcIik7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGlmICh0cmVlVHlwZSAhPT0gdW5kZWZpbmVkICYmIHNjb3BlLm5hdmNvbkRhdGEudHJlZVJlZnJlc2ggIT09IHVuZGVmaW5lZCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBzY29wZS5uYXZjb25EYXRhLnRyZWVSZWZyZXNoKHRyZWVUeXBlKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG5cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIHNjb3BlLnByaW50ID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHNjb3BlLm5hdmNvbkRhdGEucHJpbnQgIT09IHVuZGVmaW5lZClcclxuICAgICAgICAgICAgICAgICAgICAgICAgc2NvcGUubmF2Y29uRGF0YS5wcmludCgpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfTtcclxuICAgIH1cclxuXSk7IiwiXCJ1c2Ugc3RyaWN0XCI7XHJcbmFuZ3VsYXIubW9kdWxlKCdhcHAnKS5kaXJlY3RpdmUoJ25hdmNvblJlcG9ydCcsIFsnZGF0YXNlcnZpY2UnLCAndXRpbGl0aWVzJywgJyRjb21waWxlJywgJyR3aW5kb3cnLCAnJHRpbWVvdXQnLFxyXG4gICAgZnVuY3Rpb24oZGF0YXNlcnZpY2UsIHV0aWxpdGllcywgJGNvbXBpbGUsICR3aW5kb3csICR0aW1lb3V0KSB7XHJcbiAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgLypFOiBEaXJlY3RpdmUgZGVmaW5lZCBhcyBhbiBlbGVtZW50LiA8bmF2Y29uLXRhYmxlPjwvbmF2Y29uLXRhYmxlPlxyXG4gICAgICAgICAgICBBOiBEaXJlY3RpdmUgYXBwbGllZCBhcyBhbiBhdHRyaWJ1dGUgb24gZXhpc3RpbmcgZWxlbWVudC4gPGRpdiBuYXZjb24tdGFibGU+PC9kaXY+XHJcbiAgICAgICAgICAgIEM6IERpcmVjdGl2ZSBhcHBsaWVkIGFzIGEgY3NzIGNsYXNzIHRvIGV4aXN0aW5nIGVsZW1lbnQgPGRpdiBjbGFzcz1cIm5hdmNvbi10YWJsZVwiPjwvZGl2PlxyXG4gICAgICAgICAgICBNOiBEaXJlY3RpdmUgYXBwbGllZCBhcyBjb21tZW50LiovXHJcbiAgICAgICAgICAgIHJlc3RyaWN0OiAnRScsXHJcbiAgICAgICAgICAgIHNjb3BlOiB7XHJcbiAgICAgICAgICAgICAgICAvL0AgcmVhZHMgdGhlIGF0dHJpYnV0ZSB2YWx1ZSwgPSBwcm92aWRlcyB0d28td2F5IGJpbmRpbmcsICYgd29ya3Mgd2l0aCBmdW5jdGlvbnNcclxuICAgICAgICAgICAgICAgIG5hdmNvbkRhdGE6ICc9JyxcclxuICAgICAgICAgICAgICAgIHJlcG9ydFNvdXJjZTogJz0nLFxyXG4gICAgICAgICAgICAgICAgcmVwb3J0VGl0bGU6ICc9JyxcclxuICAgICAgICAgICAgICAgIHJlcG9ydElkOiAnQCcsXHJcbiAgICAgICAgICAgICAgICBwYWdlOiAnQCcsXHJcbiAgICAgICAgICAgICAgICBleHBvcnQ6ICdAJyxcclxuICAgICAgICAgICAgICAgIHJlcG9ydFNldHRpbmc6ICc9J1xyXG4gICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAvL3RlbXBsYXRlVXJsOiAnZXh0LW1vZHVsZXMvbmF2Y29uUmVwb3J0L25hdmNvblJlcG9ydFRlbXBsYXRlLmh0bWwnLFxyXG4gICAgICAgICAgICB0ZW1wbGF0ZVVybDogZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gbmF2Y29uLk1lbnVyb3V0ZS5nZXRUZW1wbGF0ZVVybChcIm5hdmNvblJlcG9ydFwiKTtcclxuICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgbGluazogZnVuY3Rpb24oc2NvcGUsIGVsLCBhdHRycykge1xyXG4gICAgICAgICAgICAgICAgaWYgKHNjb3BlLnJlcG9ydElkID09PSB1bmRlZmluZWQgfHwgc2NvcGUucmVwb3J0SWQgPT09IG51bGwgfHwgc2NvcGUucmVwb3J0SWQgPT09IFwiXCIpIHNjb3BlLnJlcG9ydElkID0gXCJtb2RlbFwiO1xyXG4gICAgICAgICAgICAgICAgaWYgKHNjb3BlLnBhZ2UgPT09IHVuZGVmaW5lZCB8fCBzY29wZS5wYWdlID09PSBudWxsIHx8IHNjb3BlLnBhZ2UgPT09IFwiXCIpIHNjb3BlLnBhZ2UgPSBcIm5vXCI7XHJcbiAgICAgICAgICAgICAgICAvLyQoZWwpLmZpbmQoXCJuYXZjb24tbW9kYWxcIikuYXR0cihcImlkXCIsIFwicmVwb3J0c19cIiArIGF0dHJzLnR5cGUpO1xyXG5cclxuICAgICAgICAgICAgICAgIGlmIChzY29wZS5leHBvcnQgPT09IHVuZGVmaW5lZClcclxuICAgICAgICAgICAgICAgICAgICBzY29wZS5leHBvcnQgPSBcImZhbHNlXCI7XHJcblxyXG5cclxuICAgICAgICAgICAgICAgIC8qc2NvcGUuJHdhdGNoKCdyZXBvcnRTZXR0aW5nLmV4cG9ydCcsIGZ1bmN0aW9uIChuZXdWYWx1ZSwgb2xkVmFsdWUpIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAobmV3VmFsdWUgIT0gdW5kZWZpbmVkICYmIG5ld1ZhbHVlICE9PSBcIlwiKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHNjb3BlLmV4cG9ydCA9IG5ld1ZhbHVlO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH0sIHRydWUpOyovXHJcblxyXG5cclxuICAgICAgICAgICAgICAgIC8vZWwuaHRtbCgnPG5hdmNvbi1tb2RhbCBuYXZjb24tZGF0YT1cInZtXCIgZmllbGQtZGF0YT1cIlwiIHRpdGxlPVwiXCIgaWNvbj1cImZhIGZhLWZsYXNrXCIgZm9vdGVyPVwiXCIgaWQ9XCJyZXBvcnRzXycgKyBzY29wZS5yZXBvcnRJZCArICdcIj48ZGl2PjxpZnJhbWUgc3R5bGU9XCJib3JkZXI6IHRyYW5zcGFyZW50O1wiPjwvaWZyYW1lPjwvZGl2PjwvbmF2Y29uLW1vZGFsPicpO1xyXG4gICAgICAgICAgICAgICAgLy8kY29tcGlsZShlbC5jb250ZW50cygpKShzY29wZSk7XHJcblxyXG4gICAgICAgICAgICAgICAgc2NvcGUuJHdhdGNoKCdyZXBvcnRTb3VyY2UnLCBmdW5jdGlvbihuZXdWYWx1ZSwgb2xkVmFsdWUpIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAobmV3VmFsdWUgIT0gdW5kZWZpbmVkICYmIG5ld1ZhbHVlICE9PSBcIlwiKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBmcmFtZSA9IGVsLmZpbmQoJ2lmcmFtZScpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBmcmFtZS5hdHRyKCdzcmMnLCBuZXdWYWx1ZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlc2l6ZUh0bWxEaWFsb2coZWwpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBuYXZjb24ub3Blbk1vZGFsKFwicmVwb3J0c19cIiArIHNjb3BlLnJlcG9ydElkKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuXHJcblxyXG4gICAgICAgICAgICAgICAgdmFyIHJlc2l6ZUh0bWxEaWFsb2cgPSBmdW5jdGlvbihlbGVtZW50KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIGhlaWdodCA9IGFuZ3VsYXIuZWxlbWVudCgkd2luZG93KS5oZWlnaHQoKSAqIDAuODtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgd2lkdGggPSBhbmd1bGFyLmVsZW1lbnQoJHdpbmRvdykud2lkdGgoKSAqIDAuODtcclxuICAgICAgICAgICAgICAgICAgICAkKGVsKS5maW5kKCcubW9kYWwtZGlhbG9nJykuY3NzKCd3aWR0aCcsIHdpZHRoLnRvU3RyaW5nKCkgKyAncHgnKTtcclxuICAgICAgICAgICAgICAgICAgICAkKGVsKS5maW5kKCcubW9kYWwtZGlhbG9nJykuY3NzKCdoZWlnaHQnLCBoZWlnaHQudG9TdHJpbmcoKSArICdweCcpO1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBkaWFsb2cgPSBhbmd1bGFyLmVsZW1lbnQoJyNnbG9iYWxNZXNzYWdlRGlhbG9nIC5tb2RhbC1kaWFsb2cnKTtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgbWFyZ2luID0gKGFuZ3VsYXIuZWxlbWVudCgkd2luZG93KS5oZWlnaHQoKSAtIGRpYWxvZy5oZWlnaHQoKSkgLyAyIC0gcGFyc2VJbnQoZGlhbG9nLmNzcygncGFkZGluZy10b3AnKSk7XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2cobWFyZ2luKTtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgZnJhbWUgPSBlbC5maW5kKCdpZnJhbWUnKTtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoZnJhbWUubGVuZ3RoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGZyYW1lLmF0dHIoXCJ3aWR0aFwiLCBcIjk4JVwiKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgZnJhbWUuYXR0cihcImhlaWdodFwiLCBoZWlnaHQgLyogLSAxMDAgLSBwYXJzZUludChhbmd1bGFyLmVsZW1lbnQoJy5tb2RhbC1kaWFsb2cnKS5jc3MoJ21hcmdpbi10b3AnKSkgLyAyKi8gKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICR0aW1lb3V0KGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJChmcmFtZVswXS5jb250ZW50V2luZG93LmRvY3VtZW50KS5yZWFkeShmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkKGZyYW1lWzBdKS5jb250ZW50cygpLmZpbmQoJ2hlYWQnKS5hcHBlbmQoJzxsaW5rIGhyZWY9XCIuLi9Db250ZW50L25hdmNvbi1zdHlsZS5jc3NcIiByZWw9XCJzdHlsZXNoZWV0XCIgdHlwZT1cInRleHQvY3NzXCIgLz4nKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9LCAxMjAwKVxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH07XHJcblxyXG4gICAgICAgICAgICAgICAgc2NvcGUuY2xvc2VSZXBvcnQgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgICAgICAgICBuYXZjb24uY2xvc2VNb2RhbChcInJlcG9ydHNfXCIgKyBzY29wZS5yZXBvcnRJZCk7XHJcbiAgICAgICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICAgICAgc2NvcGUuY2FuY2VsID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgbmF2Y29uLmNsb3NlTW9kYWwoXCJyZXBvcnRzX1wiICsgc2NvcGUucmVwb3J0SWQpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9O1xyXG4gICAgfVxyXG5dKTsiLCJcInVzZSBzdHJpY3RcIjtcclxuYW5ndWxhci5tb2R1bGUoJ2FwcCcpLmRpcmVjdGl2ZSgnbmF2Y29uUmVwb3J0UGFnZScsIFsnZGF0YXNlcnZpY2UnLCAndXRpbGl0aWVzJywgJyRjb21waWxlJywgJyR3aW5kb3cnLCAnYXV0aFNlcnZpY2UnLCAnbmdBdXRoU2V0dGluZ3MnLCAnJHRpbWVvdXQnLFxyXG4gICAgZnVuY3Rpb24oZGF0YXNlcnZpY2UsIHV0aWxpdGllcywgJGNvbXBpbGUsICR3aW5kb3csIGF1dGhTZXJ2aWNlLCBuZ0F1dGhTZXR0aW5ncywgJHRpbWVvdXQpIHtcclxuICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICAvKkU6IERpcmVjdGl2ZSBkZWZpbmVkIGFzIGFuIGVsZW1lbnQuIDxuYXZjb24tdGFibGU+PC9uYXZjb24tdGFibGU+XHJcbiAgICAgICAgICAgIEE6IERpcmVjdGl2ZSBhcHBsaWVkIGFzIGFuIGF0dHJpYnV0ZSBvbiBleGlzdGluZyBlbGVtZW50LiA8ZGl2IG5hdmNvbi10YWJsZT48L2Rpdj5cclxuICAgICAgICAgICAgQzogRGlyZWN0aXZlIGFwcGxpZWQgYXMgYSBjc3MgY2xhc3MgdG8gZXhpc3RpbmcgZWxlbWVudCA8ZGl2IGNsYXNzPVwibmF2Y29uLXRhYmxlXCI+PC9kaXY+XHJcbiAgICAgICAgICAgIE06IERpcmVjdGl2ZSBhcHBsaWVkIGFzIGNvbW1lbnQuKi9cclxuICAgICAgICAgICAgcmVzdHJpY3Q6ICdFJyxcclxuICAgICAgICAgICAgc2NvcGU6IHtcclxuICAgICAgICAgICAgICAgIC8vQCByZWFkcyB0aGUgYXR0cmlidXRlIHZhbHVlLCA9IHByb3ZpZGVzIHR3by13YXkgYmluZGluZywgJiB3b3JrcyB3aXRoIGZ1bmN0aW9uc1xyXG4gICAgICAgICAgICAgICAgbmF2Y29uRGF0YTogJz0nLFxyXG4gICAgICAgICAgICAgICAgcmVwb3J0Q2F0ZWdvcnk6ICdAJ1xyXG4gICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAvL3RlbXBsYXRlVXJsOiAnZXh0LW1vZHVsZXMvbmF2Y29uUmVwb3J0L25hdmNvblJlcG9ydFBhZ2VUZW1wbGF0ZS5odG1sJyxcclxuICAgICAgICAgICAgdGVtcGxhdGVVcmw6IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIG5hdmNvbi5NZW51cm91dGUuZ2V0VGVtcGxhdGVVcmwoXCJuYXZjb25SZXBvcnRQYWdlXCIpO1xyXG4gICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICBsaW5rOiBmdW5jdGlvbihzY29wZSwgZWwsIGF0dHJzKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgcmVwb3J0QmFzZSA9IG5nQXV0aFNldHRpbmdzLnJlcG9ydEJhc2VVcmk7XHJcbiAgICAgICAgICAgICAgICB2YXIgZGVmYXVsdEltYWdlID0gXCJyZXBvcnQtcHJldmlldy5wbmdcIjtcclxuICAgICAgICAgICAgICAgIHZhciBub1JlY29yZEltYWdlID0gXCJyZXBvcnQtcHJldmlldy5wbmdcIjtcclxuXHJcbiAgICAgICAgICAgICAgICBzY29wZS51c2VySWQgPSBhdXRoU2VydmljZS5hdXRoZW50aWNhdGlvbi51c2VySWQ7XHJcblxyXG4gICAgICAgICAgICAgICAgZnVuY3Rpb24gbG9hZEZhdm9yaXRlcygpIHtcclxuICAgICAgICAgICAgICAgICAgICBzY29wZS5mYXZvcml0ZXMgPSBbXTtcclxuICAgICAgICAgICAgICAgICAgICBkYXRhc2VydmljZS5nZXREYXRhKHNjb3BlLnJlcG9ydENhdGVnb3J5ICsgXCIvR2V0QWxsUmVwb3J0RmF2b3JpdGVzL1wiICsgc2NvcGUudXNlcklkLnRvU3RyaW5nKCkpLnRoZW4oZnVuY3Rpb24oZGF0YSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBzY29wZS5mYXZvcml0ZXMgPSBkYXRhO1xyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIGRhdGFzZXJ2aWNlLmdldERhdGEoc2NvcGUucmVwb3J0Q2F0ZWdvcnkgKyBcIi9HZXRBbGxSZXBvcnRzXCIpLnRoZW4oZnVuY3Rpb24oZGF0YSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHNjb3BlLnJlcG9ydHMgPSBkYXRhO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICAgICAgc2NvcGUuZmF2b3JpdGVzID0gW107XHJcbiAgICAgICAgICAgICAgICBzY29wZS5pc1NwbGl0ID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICBzY29wZS5yZXBvcnQgPSB7fTtcclxuICAgICAgICAgICAgICAgIHNjb3BlLnJlcG9ydC5wcmV2aWV3SW1hZ2UgPSByZXBvcnRCYXNlICsgZGVmYXVsdEltYWdlO1xyXG5cclxuICAgICAgICAgICAgICAgIGxvYWRGYXZvcml0ZXMoKTtcclxuXHJcbiAgICAgICAgICAgICAgICBzY29wZS5leHBhbmRDb2xsYXBzZSA9IGZ1bmN0aW9uKGlkMSwgaWQyLCBpZDMpIHtcclxuICAgICAgICAgICAgICAgICAgICAkdGltZW91dChmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCQoJyMnICsgaWQxKS5oYXNDbGFzcyhcImNvbGxhcHNlZFwiKSAmJiAhJCgnIycgKyBpZDMpLmhhc0NsYXNzKFwiaW5cIikpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICQoJyMnICsgaWQyKS5hZGRDbGFzcyhcImNvbGxhcHNlZFwiKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJCgnIycgKyBpZDIpLnJlbW92ZUNsYXNzKFwiY29sbGFwc2VkXCIpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9LCA0MzApO1xyXG4gICAgICAgICAgICAgICAgfTtcclxuXHJcbiAgICAgICAgICAgICAgICBzY29wZS5nZW5lcmF0ZSA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHNjb3BlLnJlcG9ydC5yZXBvcnRGcm9tID0gXCJyZXBvcnRcIjtcclxuICAgICAgICAgICAgICAgICAgICBuYXZjb24uY2FsbFByaW50KHNjb3BlLnJlcG9ydCwgc2NvcGUucnBvcnRJZCwgZnVuY3Rpb24oKSB7fSk7XHJcbiAgICAgICAgICAgICAgICAgICAgJCgnI3JlcG9ydHByZXZpZXcnKS5oaWRlKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgJCgnI3JlcG9ydGdlbmVyYXRlJykuc2hvdygpO1xyXG4gICAgICAgICAgICAgICAgfTtcclxuXHJcbiAgICAgICAgICAgICAgICBzY29wZS5yZXR1cm50b3JlcG9ydCA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICAgICAgICAgICQoJyNyZXBvcnRwcmV2aWV3Jykuc2hvdygpO1xyXG4gICAgICAgICAgICAgICAgICAgICQoJyNyZXBvcnRnZW5lcmF0ZScpLmhpZGUoKTtcclxuXHJcbiAgICAgICAgICAgICAgICB9O1xyXG5cclxuICAgICAgICAgICAgICAgIHNjb3BlLmNvbXBhcmUgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoc2NvcGUuaXNTcGxpdClcclxuICAgICAgICAgICAgICAgICAgICAgICAgc2NvcGUuaXNTcGxpdCA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgICAgIGVsc2VcclxuICAgICAgICAgICAgICAgICAgICAgICAgc2NvcGUuaXNTcGxpdCA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgJChcIiNteUZhdiB1bFwiKS5jaGlsZHJlbigpLmVhY2goZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgJCh0aGlzKS5yZW1vdmVDbGFzcygnaGlnaGxpZ2h0Jyk7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgICAgICAkKFwiI2FsbFJlcG9ydHMgdWxcIikuY2hpbGRyZW4oKS5lYWNoKGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICAgICAgICAgICQodGhpcykucmVtb3ZlQ2xhc3MoJ2hpZ2hsaWdodCcpO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcblxyXG5cclxuICAgICAgICAgICAgICAgIHNjb3BlLmZhdm9yaXRlQ2xpY2sgPSBmdW5jdGlvbihldmVudCkge1xyXG4gICAgICAgICAgICAgICAgICAgICQoZXZlbnQuY3VycmVudFRhcmdldCkudG9nZ2xlQ2xhc3MoXCJnbHlwaGljb24tc3RhciBnbHlwaGljb24tc3Rhci1lbXB0eVwiKTtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoJChldmVudC5jdXJyZW50VGFyZ2V0KS5oYXNDbGFzcygnZ2x5cGhpY29uLXN0YXItZW1wdHknKSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgc2NvcGUuaXNGYXZvcml0ZSA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgICAgIGVsc2VcclxuICAgICAgICAgICAgICAgICAgICAgICAgc2NvcGUuaXNGYXZvcml0ZSA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICAgZmF2b3JpdGVTYXZlKCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG5cclxuICAgICAgICAgICAgICAgIGZ1bmN0aW9uIGZhdm9yaXRlU2F2ZSgpIHtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIGZpbmRPYmogPSBuYXZjb24uZ2V0SXRlbUJ5S2V5VmFsdWUoc2NvcGUuZmF2b3JpdGVzLCBcIlJlcG9ydERldGFpbElkXCIsIHNjb3BlLnJwb3J0SWQpO1xyXG5cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIG9iamVjdFN0YXRlID0gMTtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgcmVwb3J0RmF2b3JpdGVJZCA9IDA7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGlmIChmaW5kT2JqICE9PSAtMSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBvYmplY3RTdGF0ZSA9IDM7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlcG9ydEZhdm9yaXRlSWQgPSBmaW5kT2JqW1wiUmVwb3J0RmF2b3JpdGVJZFwiXTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIHZhciBzYXZlT2JqID0ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBcIlJlcG9ydEZhdm9yaXRlSWRcIjogcmVwb3J0RmF2b3JpdGVJZCxcclxuICAgICAgICAgICAgICAgICAgICAgICAgXCJSZXBvcnRDYXRlZ29yeUlkXCI6IHNjb3BlLnJlcG9ydENhdGVnb3J5SWQsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIFwiUmVwb3J0RGV0YWlsSWRcIjogc2NvcGUucnBvcnRJZCxcclxuICAgICAgICAgICAgICAgICAgICAgICAgXCJVc2VySWRcIjogc2NvcGUudXNlcklkLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBcIk9iamVjdFN0YXRlXCI6IG9iamVjdFN0YXRlXHJcbiAgICAgICAgICAgICAgICAgICAgfTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKG9iamVjdFN0YXRlID09IDEpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgZGF0YXNlcnZpY2UucG9zdFNlcnZlckRhdGEoXCJcIiwgc2F2ZU9iaiwgZmFsc2UsICcnLCBzY29wZS5yZXBvcnRDYXRlZ29yeSArIFwiL0NyZWF0ZVJlcG9ydEZhdm9yaXRlcy9cIikudGhlbihmdW5jdGlvbihkYXRhKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2FkRmF2b3JpdGVzKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgZGF0YXNlcnZpY2UucHV0RGF0YShcIlwiLCBzYXZlT2JqLCBzY29wZS5yZXBvcnRDYXRlZ29yeSArIFwiL1VwZGF0ZVJlcG9ydEZhdm9yaXRlcy9cIikudGhlbihmdW5jdGlvbihkYXRhKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2FkRmF2b3JpdGVzKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIH1cclxuXHJcblxyXG4gICAgICAgICAgICAgICAgc2NvcGUucmVwb3J0Q2xpY2sgPSBmdW5jdGlvbihldmVudCwgcmVwb3J0KSB7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIHZhciBmaW5kSW5kZXggPSBuYXZjb24uZ2V0SXRlbUluZGV4QnlLZXlWYWx1ZShzY29wZS5mYXZvcml0ZXMsIFwiUmVwb3J0RGV0YWlsSWRcIiwgcmVwb3J0LlJlcG9ydERldGFpbElkKTtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoZmluZEluZGV4ICE9PSAtMSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgc2NvcGUuaXNGYXZvcml0ZSA9IHRydWVcclxuICAgICAgICAgICAgICAgICAgICBlbHNlXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHNjb3BlLmlzRmF2b3JpdGUgPSBmYWxzZTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgJChcIiNteUZhdiB1bFwiKS5jaGlsZHJlbigpLmVhY2goZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICQodGhpcykucmVtb3ZlQ2xhc3MoJ2hpZ2hsaWdodCcpO1xyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAkKFwiI2FsbFJlcG9ydHMgdWxcIikuY2hpbGRyZW4oKS5lYWNoKGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAkKHRoaXMpLnJlbW92ZUNsYXNzKCdoaWdobGlnaHQnKTtcclxuICAgICAgICAgICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgJChldmVudC5jdXJyZW50VGFyZ2V0KS5hZGRDbGFzcygnaGlnaGxpZ2h0Jyk7XHJcbiAgICAgICAgICAgICAgICAgICAgc2NvcGUucmVwb3J0LmV4cG9ydCA9IFwiZmFsc2VcIjtcclxuICAgICAgICAgICAgICAgICAgICBzY29wZS5yZXBvcnQudGl0bGUgPSByZXBvcnQuUmVwb3J0TmFtZTtcclxuICAgICAgICAgICAgICAgICAgICBzY29wZS5ycG9ydElkID0gcmVwb3J0LlJlcG9ydERldGFpbElkO1xyXG4gICAgICAgICAgICAgICAgICAgIHNjb3BlLnJlcG9ydENhdGVnb3J5SWQgPSByZXBvcnQuUmVwb3J0Q2F0ZWdvcnlJZDtcclxuICAgICAgICAgICAgICAgICAgICBzY29wZS5yZXBvcnQuc291cmNlID0gXCJcIjtcclxuICAgICAgICAgICAgICAgICAgICAvL3Njb3BlLnJlcG9ydC5wcmV2aWV3SW1hZ2UgPSBcIlwiO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICBpZiAocmVwb3J0LlBhZ2VWaWV3ICE9PSB1bmRlZmluZWQgJiYgcmVwb3J0LlBhZ2VWaWV3ICE9PSBudWxsICYmIHJlcG9ydC5QYWdlVmlldyAhPT0gXCJcIilcclxuICAgICAgICAgICAgICAgICAgICAgICAgc2NvcGUucmVwb3J0LnByZXZpZXdJbWFnZSA9IHJlcG9ydEJhc2UgKyByZXBvcnQuUGFnZVZpZXc7XHJcbiAgICAgICAgICAgICAgICAgICAgZWxzZVxyXG4gICAgICAgICAgICAgICAgICAgICAgICBzY29wZS5yZXBvcnQucHJldmlld0ltYWdlID0gcmVwb3J0QmFzZSArIG5vUmVjb3JkSW1hZ2U7XHJcbiAgICAgICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfTtcclxuICAgIH1cclxuXSk7IiwiXCJ1c2Ugc3RyaWN0XCI7XHJcbmFuZ3VsYXIubW9kdWxlKCdhcHAnKS5kaXJlY3RpdmUoJ25hdmNvblRhYmxlJywgWydkYXRhc2VydmljZScsICckdGltZW91dCcsXHJcbiAgICBmdW5jdGlvbihkYXRhc2VydmljZSwgJHRpbWVvdXQpIHtcclxuICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICAvKkU6IERpcmVjdGl2ZSBkZWZpbmVkIGFzIGFuIGVsZW1lbnQuIDxuYXZjb24tdGFibGU+PC9uYXZjb24tdGFibGU+XHJcbiAgICAgICAgICAgIEE6IERpcmVjdGl2ZSBhcHBsaWVkIGFzIGFuIGF0dHJpYnV0ZSBvbiBleGlzdGluZyBlbGVtZW50LiA8ZGl2IG5hdmNvbi10YWJsZT48L2Rpdj5cclxuICAgICAgICAgICAgQzogRGlyZWN0aXZlIGFwcGxpZWQgYXMgYSBjc3MgY2xhc3MgdG8gZXhpc3RpbmcgZWxlbWVudCA8ZGl2IGNsYXNzPVwibmF2Y29uLXRhYmxlXCI+PC9kaXY+XHJcbiAgICAgICAgICAgIE06IERpcmVjdGl2ZSBhcHBsaWVkIGFzIGNvbW1lbnQuKi9cclxuICAgICAgICAgICAgcmVzdHJpY3Q6ICdFJyxcclxuICAgICAgICAgICAgc2NvcGU6IHtcclxuICAgICAgICAgICAgICAgIC8vQCByZWFkcyB0aGUgYXR0cmlidXRlIHZhbHVlLCA9IHByb3ZpZGVzIHR3by13YXkgYmluZGluZywgJiB3b3JrcyB3aXRoIGZ1bmN0aW9uc1xyXG4gICAgICAgICAgICAgICAgdGFibGVTZXR0aW5nczogJz0nLFxyXG4gICAgICAgICAgICAgICAgbmF2Y29uRGF0YTogJz0nLFxyXG4gICAgICAgICAgICAgICAgdHlwZTogJ0AnLFxyXG4gICAgICAgICAgICAgICAgcmVhZE9ubHk6ICc9JyxcclxuICAgICAgICAgICAgICAgIGNzc0NsYXNzOiAnQCdcclxuICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgLy90ZW1wbGF0ZVVybDogJ2V4dC1tb2R1bGVzL25hdmNvblRhYmxlL25hdmNvblRhYmxlVGVtcGxhdGUuaHRtbCcsXHJcbiAgICAgICAgICAgIHRlbXBsYXRlVXJsOiBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBuYXZjb24uTWVudXJvdXRlLmdldFRlbXBsYXRlVXJsKFwibmF2Y29uVGFibGVcIik7XHJcbiAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgIGxpbms6IGZ1bmN0aW9uKHNjb3BlLCBlbCwgYXR0cnMpIHtcclxuICAgICAgICAgICAgICAgIGlmIChzY29wZS5jc3NDbGFzcyA9PSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgICAgICAgICAgICBzY29wZS5jc3NDbGFzcyA9IFwiXCI7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBpZiAoc2NvcGUudGFibGVTZXR0aW5ncy5jb2x1bW5zLmxlbmd0aCAhPT0gMClcclxuICAgICAgICAgICAgICAgICAgICBuYXZjb24uc2V0VGFibGVTZXR0aW5nKGVsLCBzY29wZS50YWJsZVNldHRpbmdzLCBzY29wZSk7XHJcbiAgICAgICAgICAgICAgICBzY29wZS4kd2F0Y2goJ3RhYmxlU2V0dGluZ3MuZGF0YScsIGZ1bmN0aW9uKG5ld1ZhbHVlLCBvbGRWYWx1ZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChuZXdWYWx1ZSAhPT0gdW5kZWZpbmVkICYmIG5ld1ZhbHVlICE9PSBvbGRWYWx1ZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoc2NvcGUudGFibGVTZXR0aW5ncy5jb2x1bW5zLmxlbmd0aCAhPT0gMCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGl0ZW1zID0gdGFibGVNYW5hZ2VEYXRhKHNjb3BlLnRhYmxlU2V0dGluZ3MuY29sdW1ucywgc2NvcGUudGFibGVTZXR0aW5ncy5kYXRhKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5hdmNvbi50YWJsZVJlZnJlc2goZWwsIHNjb3BlLnRhYmxlU2V0dGluZ3MsIHNjb3BlKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChzY29wZS5yZWFkT25seSAhPT0gdW5kZWZpbmVkICYmIHNjb3BlLnRhYmxlU2V0dGluZ3MuZGF0YS5sZW5ndGggPiAwKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJHRpbWVvdXQoZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGhpZGVTaG93Q29sdW1uSW5SZWFkb25seShzY29wZS5yZWFkT25seSwgZWwpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sIDI1MClcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH0sIHRydWUpXHJcblxyXG4gICAgICAgICAgICAgICAgc2NvcGUuJHdhdGNoKFwicmVhZE9ubHlcIiwgZnVuY3Rpb24obmV3VmFsdWUsIG9sZFZhbHVlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKG5ld1ZhbHVlICE9PSB1bmRlZmluZWQgJiYgc2NvcGUudGFibGVTZXR0aW5ncy5kYXRhLmxlbmd0aCA+IDApIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgJHRpbWVvdXQoZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBoaWRlU2hvd0NvbHVtbkluUmVhZG9ubHkobmV3VmFsdWUsIGVsKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSwgMjUwKVxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH0sIHRydWUpO1xyXG5cclxuICAgICAgICAgICAgICAgIHNjb3BlLiR3YXRjaChcIiRwYXJlbnQucmVhZE9ubHlcIiwgZnVuY3Rpb24obmV3VmFsdWUsIG9sZFZhbHVlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKG5ld1ZhbHVlICE9PSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgJCgnLnRhYmxlLmRhdGFUYWJsZSB0aGVhZCAuc29ydGluZycpLmNzcyhcImJhY2tncm91bmQtaW1hZ2VcIiwgXCJcIik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChuZXdWYWx1ZSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICQoJy50YWJsZS5kYXRhVGFibGUgdGhlYWQgLnNvcnRpbmcnKS5jc3MoXCJiYWNrZ3JvdW5kLWltYWdlXCIsIFwibm9uZVwiKVxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH0sIHRydWUpO1xyXG5cclxuXHJcbiAgICAgICAgICAgICAgICBmdW5jdGlvbiBoaWRlU2hvd0NvbHVtbkluUmVhZG9ubHkodmFsdWUsIGVsKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIGNvbHVtbk5hbWVzID0gWydBZGQnLCAnRWRpdCcsICdEZWxldGUnXTtcclxuICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBpID0gMCwgbGVuID0gY29sdW1uTmFtZXMubGVuZ3RoOyBpIDwgbGVuOyBpKyspIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGhlYWRlciA9IGNvbHVtbk5hbWVzW2ldO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgY29sSW5kZXggPSAkKGVsKS5maW5kKFwidGg6Y29udGFpbnMoJ1wiICsgaGVhZGVyICsgXCInKVwiKS5pbmRleCgpICsgMTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHZhbHVlKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJChlbCkuZmluZChcInRkOm50aC1jaGlsZChcIiArIGNvbEluZGV4LnRvU3RyaW5nKCkgKyBcIiksdGg6bnRoLWNoaWxkKFwiICsgY29sSW5kZXgudG9TdHJpbmcoKSArIFwiKVwiKS5oaWRlKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2VcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICQoZWwpLmZpbmQoXCJ0ZDpudGgtY2hpbGQoXCIgKyBjb2xJbmRleC50b1N0cmluZygpICsgXCIpLHRoOm50aC1jaGlsZChcIiArIGNvbEluZGV4LnRvU3RyaW5nKCkgKyBcIilcIikuc2hvdygpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICBmdW5jdGlvbiB0YWJsZU1hbmFnZURhdGEoY29sdW1ucywgaXRlbXMpIHtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgaW5kZXggaW4gaXRlbXMpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGl0ZW0gPSBpdGVtc1tpbmRleF07XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGZvciAodmFyIHAgaW4gaXRlbSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGl0ZW0uaGFzT3duUHJvcGVydHkocCkpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgcHJvcFZhbCA9IGl0ZW1bcF07XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIG9wdGlvbnMgPSBnZXRDb2x1bW5PcHRpb25zKGNvbHVtbnMsIHApO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChvcHRpb25zICE9PSAtMSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAob3B0aW9ucy50eXBlICE9PSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciByZXRWYWwgPSBuYXZjb24uaW5zZXJ0Q29udHJvbChvcHRpb25zLnR5cGUsIHByb3BWYWwpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaXRlbVtwXSA9IHJldFZhbDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgZnVuY3Rpb24gZ2V0Q29sdW1uT3B0aW9ucyhjb2x1bW5zLCBwcm9wKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGZvciAoaW5kZXggaW4gY29sdW1ucykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGNvbCA9IGNvbHVtbnNbaW5kZXhdO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGNvbC5kYXRhICE9PSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoY29sLmRhdGEgPT09IHByb3ApIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGNvbC5vcHRpb25zIHx8IC0xO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gLTE7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gaXRlbXM7XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfTtcclxuICAgIH1cclxuXSk7IiwiXCJ1c2Ugc3RyaWN0XCI7XHJcbmFuZ3VsYXIubW9kdWxlKCdhcHAnKS5kaXJlY3RpdmUoJ25hdmNvblRhYmxlRWRpdG9yJywgWydkYXRhc2VydmljZScsICckY29tcGlsZScsICckd2luZG93JyxcclxuICAgIGZ1bmN0aW9uKGRhdGFzZXJ2aWNlLCAkY29tcGlsZSwgJHdpbmRvdykge1xyXG4gICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgIC8qRTogRGlyZWN0aXZlIGRlZmluZWQgYXMgYW4gZWxlbWVudC4gPG5hdmNvbi10YWJsZT48L25hdmNvbi10YWJsZT5cclxuICAgICAgICAgICAgQTogRGlyZWN0aXZlIGFwcGxpZWQgYXMgYW4gYXR0cmlidXRlIG9uIGV4aXN0aW5nIGVsZW1lbnQuIDxkaXYgbmF2Y29uLXRhYmxlPjwvZGl2PlxyXG4gICAgICAgICAgICBDOiBEaXJlY3RpdmUgYXBwbGllZCBhcyBhIGNzcyBjbGFzcyB0byBleGlzdGluZyBlbGVtZW50IDxkaXYgY2xhc3M9XCJuYXZjb24tdGFibGVcIj48L2Rpdj5cclxuICAgICAgICAgICAgTTogRGlyZWN0aXZlIGFwcGxpZWQgYXMgY29tbWVudC4qL1xyXG4gICAgICAgICAgICByZXN0cmljdDogJ0UnLFxyXG4gICAgICAgICAgICBzY29wZToge1xyXG4gICAgICAgICAgICAgICAgLy9AIHJlYWRzIHRoZSBhdHRyaWJ1dGUgdmFsdWUsID0gcHJvdmlkZXMgdHdvLXdheSBiaW5kaW5nLCAmIHdvcmtzIHdpdGggZnVuY3Rpb25zXHJcbiAgICAgICAgICAgICAgICBuYXZjb25EYXRhOiAnPScsXHJcbiAgICAgICAgICAgICAgICBzZXR0aW5nczogJz0nLFxyXG4gICAgICAgICAgICAgICAgZGF0YTogJz0nLFxyXG4gICAgICAgICAgICAgICAgc2hvd0RlbDogJz0nLFxyXG4gICAgICAgICAgICAgICAgc2hvd0FkZDogJz0nLFxyXG4gICAgICAgICAgICAgICAgc2hvd1VwZGF0ZTogJz0nLFxyXG4gICAgICAgICAgICAgICAgc2hvd292ZXJBbGxzYXZlOiAnPScsXHJcbiAgICAgICAgICAgICAgICBzaG93SXRhcjogJz0nLFxyXG4gICAgICAgICAgICAgICAgc2hvd1Nsbm86ICc9JyxcclxuICAgICAgICAgICAgICAgIHNhdmVCdXR0b250ZXh0OiAnPSdcclxuICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgLy90ZW1wbGF0ZVVybDogJ2V4dC1tb2R1bGVzL25hdmNvblRhYmxlRWRpdG9yL25hdmNvblRhYmxlRWRpdG9yVGVtcGxhdGUuaHRtbCcsXHJcbiAgICAgICAgICAgIHRlbXBsYXRlVXJsOiBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBuYXZjb24uTWVudXJvdXRlLmdldFRlbXBsYXRlVXJsKFwibmF2Y29uVGFibGVFZGl0b3JcIik7XHJcbiAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgIGxpbms6IGZ1bmN0aW9uKHNjb3BlLCBlbCwgYXR0cnMpIHtcclxuICAgICAgICAgICAgICAgIGlmIChzY29wZS5zaG93U2xubyA9PT0gdW5kZWZpbmVkIHx8IHNjb3BlLnNob3dTbG5vID09PSBudWxsKSBzY29wZS5zaG93U2xubyA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICBzY29wZS5yb3cgPSAxO1xyXG4gICAgICAgICAgICAgICAgc2NvcGUucmVhZE9ubHkgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgIGlmIChzY29wZS5uYXZjb25EYXRhICE9IHVuZGVmaW5lZCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChzY29wZS5uYXZjb25EYXRhLnJlYWRPbmx5ICE9IHVuZGVmaW5lZCkge1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgc2NvcGUuJHdhdGNoKFwibmF2Y29uRGF0YS5yZWFkT25seVwiLCBmdW5jdGlvbihuZXd2YWx1ZSwgb2xkdmFsdWUpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNjb3BlLnJlYWRPbmx5ID0gbmV3dmFsdWU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgc2NvcGUucmVhZE9ubHkgPSBzY29wZS5uYXZjb25EYXRhLnJlYWRPbmx5O1xyXG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChzY29wZS5uYXZjb25EYXRhLnJlYWRvbmx5ICE9IHVuZGVmaW5lZCkge1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNjb3BlLiR3YXRjaChcIm5hdmNvbkRhdGEucmVhZG9ubHlcIiwgZnVuY3Rpb24obmV3dmFsdWUsIG9sZHZhbHVlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2NvcGUucmVhZE9ubHkgPSBuZXd2YWx1ZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc2NvcGUucmVhZE9ubHkgPSBzY29wZS5uYXZjb25EYXRhLnJlYWRvbmx5O1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc2NvcGUucmVhZE9ubHkgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgaWYgKHNjb3BlLnNob3dEZWwgPT09IHVuZGVmaW5lZClcclxuICAgICAgICAgICAgICAgICAgICBzY29wZS5zaG93RGVsID0gdHJ1ZTtcclxuXHJcbiAgICAgICAgICAgICAgICBpZiAoc2NvcGUuc2hvd0FkZCA9PT0gdW5kZWZpbmVkKVxyXG4gICAgICAgICAgICAgICAgICAgIHNjb3BlLnNob3dBZGQgPSB0cnVlO1xyXG5cclxuICAgICAgICAgICAgICAgIGlmIChzY29wZS5zaG93VXBkYXRlID09PSB1bmRlZmluZWQpXHJcbiAgICAgICAgICAgICAgICAgICAgc2NvcGUuc2hvd1VwZGF0ZSA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgaWYgKHNjb3BlLnNob3dvdmVyQWxsc2F2ZSA9PT0gdW5kZWZpbmVkKVxyXG4gICAgICAgICAgICAgICAgICAgIHNjb3BlLnNob3dvdmVyQWxsc2F2ZSA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgaWYgKHNjb3BlLnNob3dJdGFyID09PSB1bmRlZmluZWQpXHJcbiAgICAgICAgICAgICAgICAgICAgc2NvcGUuc2hvd0l0YXIgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgIGlmIChzY29wZS5zYXZlQnV0dG9udGV4dCA9PT0gdW5kZWZpbmVkKVxyXG4gICAgICAgICAgICAgICAgICAgIHNjb3BlLnNhdmVCdXR0b250ZXh0ID0gXCJcIjtcclxuXHJcbiAgICAgICAgICAgICAgICBzY29wZS4kd2F0Y2goJ3NldHRpbmdzLmZpZWxkcycsIGZ1bmN0aW9uKG5ld1ZhbHVlLCBvbGRWYWx1ZSkge1xyXG5cclxuICAgICAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgICAgIC8vc2NvcGUuJHdhdGNoKCdzZXR0aW5ncy5kYXRhJywgZnVuY3Rpb24gKG5ld1ZhbHVlLCBvbGRWYWx1ZSkge1xyXG4gICAgICAgICAgICAgICAgLy8gICAgaWYgKG5ld1ZhbHVlICE9PSB1bmRlZmluZWQgJiYgbmV3VmFsdWUgIT09IG51bGwgJiYgbmV3VmFsdWUgIT09IFwiXCIgJiYgbmV3VmFsdWUubGVuZ3RoICE9PSAwKSB7XHJcbiAgICAgICAgICAgICAgICAvLyAgICAgICAgc2NvcGUuZGF0YSA9IFtdO1xyXG4gICAgICAgICAgICAgICAgLy8gICAgICAgIHZhciBvYmogPSB7fTtcclxuXHJcbiAgICAgICAgICAgICAgICAvLyAgICAgICAgb2JqLmZpZWxkcyA9IGFuZ3VsYXIuY29weShzY29wZS5zZXR0aW5ncy5maWVsZHMpO1xyXG5cclxuICAgICAgICAgICAgICAgIC8vICAgICAgICAkLm1hcChvYmouZmllbGRzLCBmdW5jdGlvbiAoaXRlbSwgaW5kZXgpIHtcclxuICAgICAgICAgICAgICAgIC8vICAgICAgICAgICAgaWYgKG5ld1ZhbHVlW2l0ZW0ua2V5XSAhPT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgICAgICAgICAvLyAgICAgICAgICAgICAgICBpdGVtLmRhdGEgPSBuZXdWYWx1ZVtpdGVtLmtleV07XHJcbiAgICAgICAgICAgICAgICAvLyAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIC8vICAgICAgICB9KVxyXG5cclxuICAgICAgICAgICAgICAgIC8vICAgICAgICBvYmouZmllbGRzLnNubyA9IDE7XHJcblxyXG4gICAgICAgICAgICAgICAgLy8gICAgICAgIHNjb3BlLmRhdGEucHVzaChvYmopO1xyXG4gICAgICAgICAgICAgICAgLy8gICAgfVxyXG4gICAgICAgICAgICAgICAgLy99LGZhbHNlKTtcclxuXHJcbiAgICAgICAgICAgICAgICB2YXIgbG9hZEV4aXN0aW5nRGF0YSA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciByb3cgPSAxO1xyXG4gICAgICAgICAgICAgICAgICAgICQubWFwKHNjb3BlLnNldHRpbmdzLmRhdGEsIGZ1bmN0aW9uKGRhdGFJdGVtLCBpbmRleCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgb2JqID0ge307XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG9iai5maWVsZHMgPSBhbmd1bGFyLmNvcHkoc2NvcGUuc2V0dGluZ3MuZmllbGRzKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICQubWFwKG9iai5maWVsZHMsIGZ1bmN0aW9uKGl0ZW0sIGluZGV4KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoZGF0YUl0ZW1baXRlbS5rZXldICE9PSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpdGVtLmRhdGEgPSBkYXRhSXRlbVtpdGVtLmtleV07XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG9iai5maWVsZHMuc25vID0gc2NvcGUuZGF0YS5sZW5ndGggKyAxO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBzY29wZS5kYXRhLnB1c2gob2JqKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcm93Kys7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIH0pXHJcblxyXG4gICAgICAgICAgICAgICAgfTtcclxuXHJcbiAgICAgICAgICAgICAgICAvKkNhbmNlbCovXHJcbiAgICAgICAgICAgICAgICBzY29wZS5jYW5jZWwgPSBmdW5jdGlvbih0eXBlKSB7fTtcclxuXHJcbiAgICAgICAgICAgICAgICBzY29wZS5jbG9zZVJlcG9ydCA9IGZ1bmN0aW9uKCkge307XHJcblxyXG4gICAgICAgICAgICAgICAgc2NvcGUuZ2V0RmllbGRzRGF0YSA9IGZ1bmN0aW9uKGRhdGEpIHtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgb2JqID0ge307XHJcbiAgICAgICAgICAgICAgICAgICAgJC5tYXAoc2NvcGUuc2V0dGluZ3MuZmllbGRzLCBmdW5jdGlvbihpdGVtLCBpbmRleCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoZGF0YVtpdGVtLmtleV0gIT09IHVuZGVmaW5lZCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaXRlbS5kYXRhID0gZGF0YVtpdGVtLmtleV07XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBzY29wZS5zZXR0aW5ncy5maWVsZHM7XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgc2NvcGUuYXNzaWduU25vID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIHNubyA9IDE7XHJcbiAgICAgICAgICAgICAgICAgICAgJC5tYXAoc2NvcGUuZGF0YSwgZnVuY3Rpb24oaXRlbSwgaW5kZXgpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaXRlbS5maWVsZHMuc25vID0gc25vO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBzbm8rKztcclxuICAgICAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgICAgIHNjb3BlLmFjdGlvbiA9IHt9O1xyXG4gICAgICAgICAgICAgICAgc2NvcGUuYWN0aW9uLmFkZE5ldyA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBvYmogPSB7fTtcclxuICAgICAgICAgICAgICAgICAgICBvYmouZmllbGRzID0gYW5ndWxhci5jb3B5KHNjb3BlLnNldHRpbmdzLmZpZWxkcyk7XHJcbiAgICAgICAgICAgICAgICAgICAgb2JqLmZpZWxkcy5zbm8gPSAoc2NvcGUuZGF0YS5sZW5ndGggKyAxKTtcclxuICAgICAgICAgICAgICAgICAgICBzY29wZS5kYXRhLnB1c2gob2JqKTtcclxuICAgICAgICAgICAgICAgICAgICBzY29wZS5yb3crKztcclxuICAgICAgICAgICAgICAgICAgICAkKCdbZGF0YS10b2dnbGU9XCJ0b29sdGlwXCJdJykudG9vbHRpcCgpO1xyXG4gICAgICAgICAgICAgICAgfTtcclxuXHJcbiAgICAgICAgICAgICAgICBzY29wZS5hY3Rpb24uY2xlYXIgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgICAgICAgICBzY29wZS5kYXRhID0gW107XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgc2NvcGUuZGVsZXRlID0gZnVuY3Rpb24oaW5kZXgpIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoc2NvcGUuZGF0YS5sZW5ndGggPiAxKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHNjb3BlLmRhdGEuc3BsaWNlKGluZGV4LCAxKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgc2NvcGUuYXNzaWduU25vKCk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoc2NvcGUuc2V0dGluZ3MudGVtcGxhdGVPcHRpb25zICE9PSB1bmRlZmluZWQgJiYgc2NvcGUuc2V0dGluZ3MudGVtcGxhdGVPcHRpb25zLnR5cGUgIT09IHVuZGVmaW5lZCAmJiBzY29wZS5uYXZjb25EYXRhLiRwYXJlbnQudGFibGVSb3dEZWxldGUgIT09IHVuZGVmaW5lZClcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNjb3BlLm5hdmNvbkRhdGEuJHBhcmVudC50YWJsZVJvd0RlbGV0ZShzY29wZS5zZXR0aW5ncy50ZW1wbGF0ZU9wdGlvbnMudHlwZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIGxvYWRFeGlzdGluZ0RhdGEoKTtcclxuICAgICAgICAgICAgICAgIGlmIChzY29wZS5kYXRhLmxlbmd0aCA8IDEpXHJcbiAgICAgICAgICAgICAgICAgICAgc2NvcGUuYWN0aW9uLmFkZE5ldygpO1xyXG5cclxuICAgICAgICAgICAgICAgIGlmIChzY29wZS5zZXR0aW5ncy50YWJsZUFjdGlvbiAhPT0gdW5kZWZpbmVkKVxyXG4gICAgICAgICAgICAgICAgICAgIHNjb3BlLnNldHRpbmdzLnRhYmxlQWN0aW9uID0gc2NvcGUuYWN0aW9uO1xyXG5cclxuICAgICAgICAgICAgICAgIHNjb3BlLnNhdmUgPSBmdW5jdGlvbihpbmRleCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChzY29wZS5zZXR0aW5ncy50ZW1wbGF0ZU9wdGlvbnMgIT09IHVuZGVmaW5lZCAmJiBzY29wZS5zZXR0aW5ncy50ZW1wbGF0ZU9wdGlvbnMudHlwZSAhPT0gdW5kZWZpbmVkICYmIHNjb3BlLm5hdmNvbkRhdGEuJHBhcmVudC5zYXZlICE9PSB1bmRlZmluZWQgJiYgc2NvcGUubmF2Y29uRGF0YS4kcGFyZW50LmZvcm1NYW5hZ2UgIT09IHVuZGVmaW5lZClcclxuICAgICAgICAgICAgICAgICAgICAgICAgc2NvcGUubmF2Y29uRGF0YS4kcGFyZW50LmZvcm1NYW5hZ2Uuc2F2ZShzY29wZS5zZXR0aW5ncy50ZW1wbGF0ZU9wdGlvbnMudHlwZSk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIC8vaWYgKHNjb3BlLmZvcm1WYWxpZCgpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgLy8gICAgaWYgKHNjb3BlLnNldHRpbmdzLnRlbXBsYXRlT3B0aW9ucyAhPT0gdW5kZWZpbmVkICYmIHNjb3BlLnNldHRpbmdzLnRlbXBsYXRlT3B0aW9ucy50eXBlICE9PSB1bmRlZmluZWQgJiYgc2NvcGUubmF2Y29uRGF0YS4kcGFyZW50LnNhdmUgIT09IHVuZGVmaW5lZClcclxuICAgICAgICAgICAgICAgICAgICAvLyAgICAgICAgc2NvcGUubmF2Y29uRGF0YS4kcGFyZW50LnNhdmUoc2NvcGUuc2V0dGluZ3MudGVtcGxhdGVPcHRpb25zLnR5cGUpO1xyXG4gICAgICAgICAgICAgICAgICAgIC8vfVxyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIHNjb3BlLmZvcm1WYWxpZCA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHNjb3BlLnZhbGlkYXRlID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgICAgICBzY29wZS5pdGVtcyA9IHNjb3BlLnNldHRpbmdzLmZpZWxkcztcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHNjb3BlLml0ZW1zID09PSB1bmRlZmluZWQgfHwgc2NvcGUuaXRlbXMubGVuZ3RoID09PSB1bmRlZmluZWQgfHwgIXNjb3BlLnZhbGlkYXRlKSByZXR1cm4gdHJ1ZTtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgcmV0VmFsID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBpID0gMCwgbGVuID0gc2NvcGUuaXRlbXMubGVuZ3RoOyBpIDwgbGVuOyBpKyspIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHNjb3BlLml0ZW1zW2ldLnR5cGUgIT09IHVuZGVmaW5lZCAmJiBzY29wZS5pdGVtc1tpXS50eXBlID09PSBcInRhYmxlZWRpdG9yXCIpIGNvbnRpbnVlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoc2NvcGUuaXRlbXNbaV0uZm9ybSAhPT0gdW5kZWZpbmVkICYmIHR5cGVvZiBzY29wZS5pdGVtc1tpXS5mb3JtID09PSBcIm9iamVjdFwiKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoc2NvcGUuaXRlbXNbaV0uZm9ybS4kaW52YWxpZCAmJiAhc2NvcGUuaXRlbXNbaV0udmFsaWQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzY29wZS5pdGVtc1tpXS5zZXRGb2N1cyA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFuZ3VsYXIuZm9yRWFjaChzY29wZS5pdGVtc1tpXS5mb3JtLiRlcnJvciwgZnVuY3Rpb24oZmllbGQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYW5ndWxhci5mb3JFYWNoKGZpZWxkLCBmdW5jdGlvbihlcnJvckZpZWxkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoZXJyb3JGaWVsZC4kbmFtZSA9PT0gXCJmb3JtXCIpIHt9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVycm9yRmllbGQuJHNldFRvdWNoZWQoKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXRWYWwgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoc2NvcGUuaXRlbXNbaV0uc2hvd01lc3NhZ2UgIT09IHVuZGVmaW5lZCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzY29wZS5pdGVtc1tpXS5zaG93TWVzc2FnZSA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24obikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHNjb3BlLml0ZW1zW25dLnNob3dNZXNzYWdlICE9PSB1bmRlZmluZWQpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2NvcGUuaXRlbXNbbl0uc2hvd01lc3NhZ2UgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSwgNjAwMCwgaSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiByZXRWYWw7XHJcbiAgICAgICAgICAgICAgICB9O1xyXG5cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH07XHJcbiAgICB9XHJcbl0pOyIsIlwidXNlIHN0cmljdFwiO1xyXG5hbmd1bGFyLm1vZHVsZSgnYXBwJykuZGlyZWN0aXZlKCduYXZjb25UcmVlJywgWydkYXRhc2VydmljZScsICckdGltZW91dCcsXHJcbiAgICBmdW5jdGlvbihkYXRhc2VydmljZSwgJHRpbWVvdXQpIHtcclxuICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICAvKkU6IERpcmVjdGl2ZSBkZWZpbmVkIGFzIGFuIGVsZW1lbnQuIDxuYXZjb24tdGFibGU+PC9uYXZjb24tdGFibGU+XHJcbiAgICAgICAgICAgIEE6IERpcmVjdGl2ZSBhcHBsaWVkIGFzIGFuIGF0dHJpYnV0ZSBvbiBleGlzdGluZyBlbGVtZW50LiA8ZGl2IG5hdmNvbi10YWJsZT48L2Rpdj5cclxuICAgICAgICAgICAgQzogRGlyZWN0aXZlIGFwcGxpZWQgYXMgYSBjc3MgY2xhc3MgdG8gZXhpc3RpbmcgZWxlbWVudCA8ZGl2IGNsYXNzPVwibmF2Y29uLXRhYmxlXCI+PC9kaXY+XHJcbiAgICAgICAgICAgIE06IERpcmVjdGl2ZSBhcHBsaWVkIGFzIGNvbW1lbnQuKi9cclxuICAgICAgICAgICAgcmVzdHJpY3Q6ICdFJyxcclxuICAgICAgICAgICAgc2NvcGU6IHtcclxuICAgICAgICAgICAgICAgIC8vQCByZWFkcyB0aGUgYXR0cmlidXRlIHZhbHVlLCA9IHByb3ZpZGVzIHR3by13YXkgYmluZGluZywgJiB3b3JrcyB3aXRoIGZ1bmN0aW9uc1xyXG4gICAgICAgICAgICAgICAgdHJlZVNldHRpbmdzOiAnPScsXHJcbiAgICAgICAgICAgICAgICBuYXZjb25EYXRhOiAnPScsXHJcbiAgICAgICAgICAgICAgICB0eXBlOiAnQCcsXHJcbiAgICAgICAgICAgICAgICBmaWVsZFNldDogJ0AnLFxyXG4gICAgICAgICAgICAgICAgaXNFeHBhbmQ6ICdAJ1xyXG4gICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAvL3RlbXBsYXRlVXJsOiAnZXh0LW1vZHVsZXMvbmF2Y29uVHJlZS9uYXZjb25UcmVlVGVtcGxhdGUuaHRtbCcsXHJcbiAgICAgICAgICAgIHRlbXBsYXRlVXJsOiBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBuYXZjb24uTWVudXJvdXRlLmdldFRlbXBsYXRlVXJsKFwibmF2Y29uVHJlZVwiKTtcclxuICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgbGluazogZnVuY3Rpb24oc2NvcGUsIGVsLCBhdHRycykge1xyXG4gICAgICAgICAgICAgICAgdmFyIG9iakVsID0gJChlbCk7XHJcbiAgICAgICAgICAgICAgICB2YXIgdHJlZSA9IG9iakVsLmZpbmQoJ2Rpdlt0eXBlPVwidHJlZVwiXScpLmZpcnN0KCk7XHJcbiAgICAgICAgICAgICAgICBpZiAoc2NvcGUuaXNFeHBhbmQgPT09IHVuZGVmaW5lZCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHNjb3BlLmlzRXhwYW5kID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBzY29wZS50eXBlVGV4dCA9ICdDb2xsYXBzZWQnXHJcblxyXG4gICAgICAgICAgICAgICAgc2NvcGUuJHdhdGNoKCd0cmVlU2V0dGluZ3MnLCBmdW5jdGlvbihuZXdWYWx1ZSwgb2xkVmFsdWUpIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAobmV3VmFsdWUgIT09IHVuZGVmaW5lZCAmJiBuZXdWYWx1ZSAhPT0gXCJcIikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIga2V5SW5kZXggPSBuYXZjb24uZ2V0SXRlbUluZGV4QnlQcm9wZXJ0eShzY29wZS5uYXZjb25EYXRhW3Njb3BlLmZpZWxkU2V0XSwgc2NvcGUudHlwZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG5hdmNvbi5zZXRUcmVlU2V0dGluZyhlbCwgc2NvcGUudHJlZVNldHRpbmdzLCBzY29wZSwgc2NvcGUubmF2Y29uRGF0YVtzY29wZS5maWVsZFNldF1ba2V5SW5kZXhdLCBzY29wZS5pc0V4cGFuZCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHNjb3BlLiR3YXRjaCgndHJlZVNldHRpbmdzLmNvcmUuZGF0YScsIGZ1bmN0aW9uKG5ld1ZhbHVlLCBvbGRWYWx1ZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKG5ld1ZhbHVlICE9PSB1bmRlZmluZWQgJiYgbmV3VmFsdWUgIT09IFwiXCIgJiYgbmV3VmFsdWUubGVuZ3RoID4gMCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChuZXdWYWx1ZSAhPT0gb2xkVmFsdWUpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHRyZWVUeXBlID0gc2NvcGUudHlwZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHNjb3BlLnRyZWVTZXR0aW5ncy5jb3JlLnRyZWVUeXBlICE9PSB1bmRlZmluZWQgJiYgc2NvcGUudHJlZVNldHRpbmdzLmNvcmUudHJlZVR5cGUgIT09IFwiXCIpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0cmVlVHlwZSA9IHNjb3BlLnRyZWVTZXR0aW5ncy5jb3JlLnRyZWVUeXBlO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbmF2Y29uLnRyZWVEYXRhUmVmcmVzaChuZXdWYWx1ZSwgdHJlZVR5cGUsIGZ1bmN0aW9uKGRhdGEpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8qaWYoc2NvcGUuJGFwcGxheSA9PT0gdW5kZWZpbmVkKSByZXR1cm47XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2NvcGUuJGFwcGxheShmdW5jdGlvbigpe1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2NvcGUuaXNFeHBhbmQgPSBmYWxzZTsgXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTsgKi9cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH0sIHRydWUpXHJcblxyXG4gICAgICAgICAgICAgICAgc2NvcGUuJHdhdGNoKCdpc0V4cGFuZCcsIGZ1bmN0aW9uKG5ld1ZhbHVlLCBvbGRWYWx1ZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBvYmpFbCA9ICQoZWwpO1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciB0cmVlID0gb2JqRWwuZmluZCgnZGl2W3R5cGU9XCJ0cmVlXCJdJykuZmlyc3QoKTtcclxuICAgICAgICAgICAgICAgICAgICBpZiAobmV3VmFsdWUgIT09IHVuZGVmaW5lZCAmJiBuZXdWYWx1ZSAhPT0gXCJcIikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgc2VhcmNoID0gb2JqRWwuZmluZCgnI3RyZWVfZmlsdGVyJykuZmlyc3QoKS5maW5kKCdpbnB1dCcpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBzZWFyY2gudmFsKFwiXCIpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBzZWFyY2gua2V5dXAoKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKG5ld1ZhbHVlID09PSB0cnVlIHx8IG5ld1ZhbHVlID09PSBcInRydWVcIikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdHJlZS5qc3RyZWUoJ29wZW5fYWxsJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzY29wZS50eXBlVGV4dCA9ICdFeHBhbmRlZCc7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzY29wZS5pc0V4cGFuZCA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0cmVlLmpzdHJlZSgnY2xvc2VfYWxsJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzY29wZS50eXBlVGV4dCA9ICdDb2xsYXBzZWQnO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc2NvcGUuaXNFeHBhbmQgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9LCB0cnVlKTtcclxuXHJcbiAgICAgICAgICAgICAgICB2YXIgdHJlZVNlYXJjaCA9IGZ1bmN0aW9uKGVsKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIHRvID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIHNlYXJjaCA9IG9iakVsLmZpbmQoJyN0cmVlX2ZpbHRlcicpLmZpcnN0KCkuZmluZCgnaW5wdXQnKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgc2VhcmNoLmNsaWNrKGZ1bmN0aW9uKGVsKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBjb2xsYXBzZSA9ICQoJChlbC50YXJnZXQpLnBhcmVudHMoJy5wb3J0bGV0JykuZmlyc3QoKS5maW5kKCdpbnB1dFt0eXBlPVwiY2hlY2tib3hcIl0nKSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChjb2xsYXBzZS5hdHRyKFwiY2hlY2tlZFwiKSA9PT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0cmVlLmpzdHJlZSgnb3Blbl9hbGwnKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICR0aW1lb3V0KGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNjb3BlLiRhcHBseShmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2NvcGUudHlwZVRleHQgPSAnRXhwYW5kZWQnO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzY29wZS5pc0V4cGFuZCA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICBzZWFyY2gua2V5dXAoZnVuY3Rpb24oZWwpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRvKSB7IGNsZWFyVGltZW91dCh0byk7IH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgdG8gPSBzZXRUaW1lb3V0KGZ1bmN0aW9uKGVsKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgdHJlZU9iaiA9ICQoZWwpLnBhcmVudCgpLnBhcmVudCgpLnBhcmVudCgpLm5leHQoKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciB2ID0gc2VhcmNoLnZhbCgpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdHJlZS5qc3RyZWUodHJ1ZSkuc2VhcmNoKHYpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vaGlkZS9zaG93IGdyaWQgdmFsdWVzIGZvciBub2RlcyBhZmZlY3RlZCBieSBzZWFyY2hpbmdcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBoaWRkZW4gPSB0cmVlT2JqLmZpbmQoJ3VsIGxpOmhpZGRlbicpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHZpc2libGUgPSB0cmVlT2JqLmZpbmQoJ3VsIGxpOnZpc2libGUnKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkLmVhY2goaGlkZGVuLCBmdW5jdGlvbihpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFjaGVja0lkKHZpc2libGUsIGhpZGRlbltpXS5pZCkpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRyZWVPYmouZmluZCgnZGl2W2lkKj0nICsgaGlkZGVuW2ldLmlkICsgJ10nKS5oaWRlKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgZmluYWxWaXNpYmxlID0gdHJlZU9iai5maW5kKCd1bCBsaTp2aXNpYmxlJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkLmVhY2goZmluYWxWaXNpYmxlLCBmdW5jdGlvbihpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHJlZU9iai5maW5kKCdkaXZbaWRePWpzZ3JpZF8nICsgdmlzaWJsZVtpXS5pZCArICdfY29sXScpLnNob3coKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgfSwgNTAwLCB0aGlzKTtcclxuICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICB2YXIgY2hlY2tJZCA9IGZ1bmN0aW9uKHZpc2libGUsIGlkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDAsIGxlbiA9IHZpc2libGUubGVuZ3RoOyBpIDwgbGVuOyBpKyspIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGl0ZW0gPSB2aXNpYmxlW2ldO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoaXRlbS5pZCA9PT0gaWQpIHJldHVybiB0cnVlO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgdHJlZVNlYXJjaChlbCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9O1xyXG4gICAgfVxyXG5dKTtcclxuXHJcblxyXG52YXIgbWFuYWdlRGF0YSA9IGZ1bmN0aW9uKGNvbHVtbnMsIGl0ZW1zKSB7XHJcbiAgICBmb3IgKHZhciBpID0gMCwgbGVuID0gaXRlbXMubGVuZ3RoOyBpIDwgbGVuOyBpKyspIHtcclxuICAgICAgICB2YXIgaXRlbSA9IGl0ZW1zW2ldO1xyXG4gICAgICAgIGlmIChpdGVtLmRhdGEgIT09IHVuZGVmaW5lZCkge1xyXG4gICAgICAgICAgICBmb3IgKHZhciBwIGluIGl0ZW0uZGF0YSkge1xyXG4gICAgICAgICAgICAgICAgaWYgKGl0ZW0uZGF0YS5oYXNPd25Qcm9wZXJ0eShwKSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBwcm9wVmFsID0gaXRlbS5kYXRhW3BdO1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBvcHRpb25zID0gZ2V0Q29sdW1uT3B0aW9ucyhjb2x1bW5zLCBwKTtcclxuICAgICAgICAgICAgICAgICAgICBpZiAob3B0aW9ucyAhPT0gLTEpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKG9wdGlvbnMudHlwZSAhPT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgcmV0VmFsID0gbmF2Y29uLmluc2VydENvbnRyb2wob3B0aW9ucy50eXBlLCBwcm9wVmFsKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGl0ZW0uZGF0YVtwXSA9IHJldFZhbDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZiAoaXRlbS5jaGlsZHJlbiAhPT0gdW5kZWZpbmVkICYmIGl0ZW0uY2hpbGRyZW4ubGVuZ3RoID4gMCkge1xyXG4gICAgICAgICAgICAgICAgdmFyIGZvdW5kID0gbWFuYWdlRGF0YShjb2x1bW5zLCBpdGVtLmNoaWxkcmVuKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBmdW5jdGlvbiBnZXRDb2x1bW5PcHRpb25zKGNvbHVtbnMsIHByb3ApIHtcclxuICAgICAgICBmb3IgKHZhciBpbmRleCBpbiBjb2x1bW5zKSB7XHJcbiAgICAgICAgICAgIHZhciBjb2wgPSBjb2x1bW5zW2luZGV4XTtcclxuICAgICAgICAgICAgaWYgKGNvbC52YWx1ZSAhPT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoY29sLnZhbHVlID09PSBwcm9wKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGNvbC5vcHRpb25zIHx8IC0xO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiAtMTtcclxuICAgIH1cclxuXHJcbiAgICByZXR1cm4gaXRlbXM7XHJcbn07IiwiXCJ1c2Ugc3RyaWN0XCI7XHJcbmFuZ3VsYXIubW9kdWxlKCdhcHAnKS5kaXJlY3RpdmUoJ25hdmNvbkZpbGVVcGxvYWQnLCBbJ2RhdGFzZXJ2aWNlJywgJ2FwcEluZm8nLCAncGhvdG9NYW5hZ2VyJywgJ2xvZ2dlcicsICduZ0F1dGhTZXR0aW5ncycsICckdGltZW91dCcsXHJcbiAgICBmdW5jdGlvbihkYXRhc2VydmljZSwgYXBwSW5mbywgcGhvdG9NYW5hZ2VyLCBsb2dnZXIsIG5nQXV0aFNldHRpbmdzLCAkdGltZW91dCkge1xyXG4gICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgIC8qRTogRGlyZWN0aXZlIGRlZmluZWQgYXMgYW4gZWxlbWVudC4gPG5hdmNvbi10YWJsZT48L25hdmNvbi10YWJsZT5cclxuICAgICAgICAgICAgQTogRGlyZWN0aXZlIGFwcGxpZWQgYXMgYW4gYXR0cmlidXRlIG9uIGV4aXN0aW5nIGVsZW1lbnQuIDxkaXYgbmF2Y29uLXRhYmxlPjwvZGl2PlxyXG4gICAgICAgICAgICBDOiBEaXJlY3RpdmUgYXBwbGllZCBhcyBhIGNzcyBjbGFzcyB0byBleGlzdGluZyBlbGVtZW50IDxkaXYgY2xhc3M9XCJuYXZjb24tdGFibGVcIj48L2Rpdj5cclxuICAgICAgICAgICAgTTogRGlyZWN0aXZlIGFwcGxpZWQgYXMgY29tbWVudC4qL1xyXG4gICAgICAgICAgICByZXN0cmljdDogJ0UnLFxyXG4gICAgICAgICAgICBzY29wZToge1xyXG4gICAgICAgICAgICAgICAgbXlGaWxlczogJz0nLFxyXG4gICAgICAgICAgICAgICAgbW9kZTogJz0nLFxyXG4gICAgICAgICAgICAgICAgdHlwZTogJz0nLFxyXG4gICAgICAgICAgICAgICAga2V5RGF0YTogJz0nLFxyXG4gICAgICAgICAgICAgICAga2V5TmFtZTogJz0nLFxyXG4gICAgICAgICAgICAgICAga2V5UmV0dXJuOiAnPScsXHJcbiAgICAgICAgICAgICAgICBtdWx0aXBsZUZpbGU6ICc9JyxcclxuICAgICAgICAgICAgICAgIHBob3RvQ2hhbmdlYWJsZTogJz0nLFxyXG4gICAgICAgICAgICAgICAgYWdyZWVUZXh0OiAnPScsXHJcbiAgICAgICAgICAgICAgICBmaWxlU2l6ZTogJz0nLFxyXG4gICAgICAgICAgICAgICAgZmlsZVR5cGU6ICc9JyxcclxuICAgICAgICAgICAgICAgIHNhbWVGaWxlOiAnPScsXHJcbiAgICAgICAgICAgICAgICBzaG93T25seTogJz0nXHJcbiAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgIC8vdGVtcGxhdGVVcmw6ICdleHQtbW9kdWxlcy9uYXZjb25VcGxvYWQvbmF2Y29uRmlsZVVwbG9hZFRlbXBsYXRlLmh0bWwnLFxyXG4gICAgICAgICAgICB0ZW1wbGF0ZVVybDogZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gbmF2Y29uLk1lbnVyb3V0ZS5nZXRUZW1wbGF0ZVVybChcIm5hdmNvbkZpbGVVcGxvYWRcIik7XHJcbiAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgIGxpbms6IGZ1bmN0aW9uKHNjb3BlLCBlbCwgYXR0cnMpIHtcclxuICAgICAgICAgICAgICAgIHNjb3BlLnRpdGxlID0gXCJ0ZXN0XCI7XHJcbiAgICAgICAgICAgICAgICBzY29wZS5oYXNGaWxlcyA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgc2NvcGUucGhvdG9zID0gW107XHJcbiAgICAgICAgICAgICAgICBzY29wZS51cGxvYWQgPSBwaG90b01hbmFnZXIudXBsb2FkO1xyXG4gICAgICAgICAgICAgICAgc2NvcGUuYXBwU3RhdHVzID0gYXBwSW5mby5zdGF0dXM7XHJcbiAgICAgICAgICAgICAgICBzY29wZS5waG90b01hbmFnZXJTdGF0dXMgPSBwaG90b01hbmFnZXIuc3RhdHVzO1xyXG4gICAgICAgICAgICAgICAgc2NvcGUuaXNBZ3JlZSA9IFwibm9cIjtcclxuICAgICAgICAgICAgICAgIHNjb3BlLnJlYWRvbmx5ID0gc2NvcGUuJHBhcmVudC5yZWFkT25seSAhPSB1bmRlZmluZWQgPyBzY29wZS4kcGFyZW50LnJlYWRPbmx5IDogKHNjb3BlLiRwYXJlbnQucmVhZG9ubHkgIT0gdW5kZWZpbmVkID8gc2NvcGUuJHBhcmVudC5yZWFkb25seSA6IGZhbHNlKTtcclxuXHJcbiAgICAgICAgICAgICAgICBzY29wZS4kd2F0Y2goXCIkcGFyZW50LnJlYWRPbmx5XCIsIGZ1bmN0aW9uKG5ld1ZhbHVlLCBvbGRWYWx1ZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChuZXdWYWx1ZSAhPSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgc2NvcGUucmVhZG9ubHkgPSBuZXdWYWx1ZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgLyppZihzY29wZS5yZWFkb25seSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNjb3BlLnNob3dPbmx5ID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgZWxzZVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc2NvcGUuc2hvd09ubHkgPSBmYWxzZTsqL1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgICAgIHNjb3BlLiR3YXRjaChcIiRwYXJlbnQucmVhZG9ubHlcIiwgZnVuY3Rpb24obmV3VmFsdWUsIG9sZFZhbHVlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKG5ld1ZhbHVlICE9IHVuZGVmaW5lZClcclxuICAgICAgICAgICAgICAgICAgICAgICAgc2NvcGUucmVhZG9ubHkgPSBuZXdWYWx1ZTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgICAgIHNjb3BlLiR3YXRjaChcInNob3dPbmx5XCIsIGZ1bmN0aW9uKG5ld1ZhbHVlLCBvbGRWYWx1ZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChuZXdWYWx1ZSAhPSB1bmRlZmluZWQpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHNjb3BlLnJlYWRvbmx5ID0gbmV3VmFsdWU7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgICAgICBpZiAoc2NvcGUuZmlsZVNpemUgPT09IHVuZGVmaW5lZClcclxuICAgICAgICAgICAgICAgICAgICBzY29wZS5maWxlU2l6ZSA9IDA7XHJcblxyXG4gICAgICAgICAgICAgICAgaWYgKHNjb3BlLmZpbGVUeXBlID09PSB1bmRlZmluZWQpXHJcbiAgICAgICAgICAgICAgICAgICAgc2NvcGUuZmlsZVR5cGUgPSBbXTtcclxuXHJcbiAgICAgICAgICAgICAgICBpZiAoc2NvcGUuc2FtZUZpbGUgPT09IHVuZGVmaW5lZClcclxuICAgICAgICAgICAgICAgICAgICBzY29wZS5zYW1lRmlsZSA9IGZhbHNlO1xyXG5cclxuICAgICAgICAgICAgICAgIGlmIChzY29wZS5zaG93T25seSA9PT0gdW5kZWZpbmVkKVxyXG4gICAgICAgICAgICAgICAgICAgIHNjb3BlLnNob3dPbmx5ID0gZmFsc2U7XHJcblxyXG4gICAgICAgICAgICAgICAgLyppZiAoc2NvcGUuYWdyZWVUZXh0ICE9PSB1bmRlZmluZWQgJiYgc2NvcGUuYWdyZWVUZXh0ICE9PSBcIlwiKVxyXG4gICAgICAgICAgICAgICAgICAgIHNjb3BlLmlzQWdyZWVWaXNpYmxlID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIHNjb3BlLmlzQWdyZWVWaXNpYmxlID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICAgICAgc2NvcGUuaXNBZ3JlZSA9IFwieWVzXCI7XHJcbiAgICAgICAgICAgICAgICB9Ki9cclxuICAgICAgICAgICAgICAgIHNjb3BlLiR3YXRjaChcImFncmVlVGV4dFwiLCBmdW5jdGlvbihuZXdWYWx1ZSwgb2xkVmFsdWUpIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAobmV3VmFsdWUgIT09IHVuZGVmaW5lZCAmJiBuZXdWYWx1ZSAhPT0gXCJcIilcclxuICAgICAgICAgICAgICAgICAgICAgICAgc2NvcGUuaXNBZ3JlZVZpc2libGUgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBzY29wZS5pc0FncmVlVmlzaWJsZSA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBzY29wZS5pc0FncmVlID0gXCJ5ZXNcIjtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgICAgICBzY29wZS5yZW1vdmUgPSBmdW5jdGlvbihmaWxlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGZpbGUuc3RhdHVzID09PSB1bmRlZmluZWQgfHwgZmlsZS5zdGF0dXMgPT09ICcnKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlbW92ZUZpbGUoZmlsZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGRhdGFzZXJ2aWNlLmZpbGVEZWxldGUoXCJkb3dubG9hZC9EZWxldGVcIiwgZmlsZS5pZCkudGhlbihmdW5jdGlvbihzdGF0dXMpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlbW92ZUZpbGUoZmlsZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2dnZXIuc3VjY2VzcyhcIkZpbGUoXCIgKyBmaWxlLm5hbWUgKyBcIikgaXMgcmVtb3ZlZCBzdWNjZXNzZnVsbHkuLi5cIiwgXCJcIiwgXCJcIik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlbW92ZUZpbGUoZmlsZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfTtcclxuXHJcbiAgICAgICAgICAgICAgICBzY29wZS5jYW5jZWwgPSBmdW5jdGlvbihmaWxlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIHJldFZhbHVlID0gXCJDYW5jZWxcIjtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoZmlsZS5zdGF0dXMgPT09IHVuZGVmaW5lZCB8fCBmaWxlLnN0YXR1cyA9PT0gJycpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldFZhbHVlID0gJ1JlbW92ZSc7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJldFZhbHVlO1xyXG4gICAgICAgICAgICAgICAgfTtcclxuXHJcbiAgICAgICAgICAgICAgICBzY29wZS5vcGVuU3RhdHVzID0gZnVuY3Rpb24oZmlsZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciByZXRWYWx1ZSA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGZpbGUuc3RhdHVzID09PSB1bmRlZmluZWQgfHwgZmlsZS5zdGF0dXMgPT09ICcnKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXRWYWx1ZSA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiByZXRWYWx1ZTtcclxuICAgICAgICAgICAgICAgIH07XHJcblxyXG4gICAgICAgICAgICAgICAgc2NvcGUub3BlbkNsaWNrID0gZnVuY3Rpb24oZmlsZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGRhdGFzZXJ2aWNlLmdldEZpbGVzKFwiXCIsIFwiXCIsIFwiZG93bmxvYWQvR2V0QnlJZC9cIiArIGZpbGUuaWQpLnRoZW4oZnVuY3Rpb24ocmVzcG9uc2UpIHtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBibG9iID0gbmV3IEJsb2IoW3Jlc3BvbnNlXSwgeyB0eXBlOiBcImFwcGxpY2F0aW9uL29jdGV0LXN0cmVhbVwiIH0pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgdXJsID0gd2luZG93LlVSTC5jcmVhdGVPYmplY3RVUkwoYmxvYik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vZm9yIG1pY3Jvc29mdCBJRVxyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAod2luZG93Lm5hdmlnYXRvciAmJiB3aW5kb3cubmF2aWdhdG9yLm1zU2F2ZU9yT3BlbkJsb2IpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdpbmRvdy5uYXZpZ2F0b3IubXNTYXZlT3JPcGVuQmxvYihibG9iLCBmaWxlLm5hbWUpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgeyAvL290aGVyIGJyb3dzZXJzXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgYSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2EnKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGEuc3R5bGUgPSBcImRpc3BsYXk6bm9uZVwiO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYS5ocmVmID0gdXJsO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYS5kb3dubG9hZCA9IGZpbGUubmFtZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGEuY2xpY2soKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdpbmRvdy5VUkwucmV2b2tlT2JqZWN0VVJMKHVybCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuXHJcblxyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgICAgIH07XHJcblxyXG4gICAgICAgICAgICAgICAgc2NvcGUuY2hvb3NlQ2xpY2sgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoc2NvcGUubXVsdGlwbGVGaWxlID09PSB1bmRlZmluZWQgfHwgIXNjb3BlLm11bHRpcGxlRmlsZSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgc2NvcGUubXlGaWxlcyA9IFtdO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAkKGVsKS5maW5kKFwiI2ZpbGVVcGxvYWRcIikuY2xpY2soKTtcclxuICAgICAgICAgICAgICAgIH07XHJcblxyXG5cclxuICAgICAgICAgICAgICAgIHNjb3BlLmhpZGVVcGxvYWQgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgbmV3Q291bnQgPSAwO1xyXG4gICAgICAgICAgICAgICAgICAgIGFuZ3VsYXIuZm9yRWFjaChzY29wZS5teUZpbGVzLCBmdW5jdGlvbihmaWxlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChmaWxlLnN0YXR1cyAhPT0gdW5kZWZpbmVkICYmIGZpbGUuc3RhdHVzID09PSBcIm5ld1wiKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBuZXdDb3VudCsrO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGlmIChzY29wZS5rZXlEYXRhID09PSB1bmRlZmluZWQgfHwgc2NvcGUua2V5RGF0YS50b1N0cmluZygpID09PSBcIjBcIilcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICAgZWxzZSBpZiAobmV3Q291bnQgPT09IDAgfHwgKHNjb3BlLm1vZGUgIT09IHVuZGVmaW5lZCAmJiAoc2NvcGUubW9kZS50b0xvd2VyQ2FzZSgpID09PSAnc2F2ZScgfHwgc2NvcGUubW9kZS50b0xvd2VyQ2FzZSgpID09PSAnc2F2ZWFzJykpKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgICAgICAgICAgICAgICAgICBlbHNlXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICBzY29wZS51cGxvYWQgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgZm9ybURhdGEgPSBuZXcgRm9ybURhdGEoKTtcclxuICAgICAgICAgICAgICAgICAgICBhbmd1bGFyLmZvckVhY2goc2NvcGUubXlGaWxlcywgZnVuY3Rpb24oZmlsZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoZmlsZS5zdGF0dXMgIT09IHVuZGVmaW5lZCAmJiBmaWxlLnN0YXR1cyA9PT0gXCJuZXdcIikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9ybURhdGEuYXBwZW5kKGZpbGUubmFtZSwgZmlsZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHNjb3BlLmtleURhdGEgPT09IHVuZGVmaW5lZCB8fCBzY29wZS5rZXlEYXRhID09PSBcIlwiIHx8IHNjb3BlLmtleURhdGEgPT09IFwiMFwiKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHNjb3BlLmtleVJldHVybiA9IHsgXCJlcnJvclwiOiBcIk5vIGtleURhdGFcIiB9O1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoc2NvcGUuJHBhcmVudCAhPT0gdW5kZWZpbmVkICYmIHNjb3BlLiRwYXJlbnQuaXRlbSAhPT0gdW5kZWZpbmVkICYmIHNjb3BlLiRwYXJlbnQuaXRlbS50ZW1wbGF0ZU9wdGlvbnMgIT09IHVuZGVmaW5lZClcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNjb3BlLiRwYXJlbnQuaXRlbS50ZW1wbGF0ZU9wdGlvbnMua2V5UmV0dXJuID0gc2NvcGUua2V5UmV0dXJuO1xyXG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBkYXRhSW5mbyA9IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvbGRlcjogc2NvcGUudHlwZSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlkOiBzY29wZS5rZXlEYXRhLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogKHNjb3BlLmtleU5hbWUgIT09IHVuZGVmaW5lZCAmJiBzY29wZS5rZXlOYW1lICE9PSAnJyA/IHNjb3BlLmtleU5hbWUgOiAnJylcclxuICAgICAgICAgICAgICAgICAgICAgICAgfTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGZvcm1EYXRhLmFwcGVuZChcImRhdGFcIiwgSlNPTi5zdHJpbmdpZnkoZGF0YUluZm8pKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgZGF0YXNlcnZpY2UuZmlsZVVwbG9hZChmb3JtRGF0YSkudGhlbihmdW5jdGlvbih1cGxvYWREYXRhKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodXBsb2FkRGF0YS5GaWxlcyAhPT0gdW5kZWZpbmVkICYmIHVwbG9hZERhdGEuRmlsZXMgIT09IFwiXCIgJiYgdXBsb2FkRGF0YS5GaWxlcyAhPT0gbnVsbCAmJiB1cGxvYWREYXRhLkZpbGVzLmxlbmd0aCA+IDApXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2NvcGUubXlGaWxlcyA9IHVwbG9hZERhdGEuRmlsZXM7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9nZ2VyLnN1Y2Nlc3MoXCJGaWxlcyBhcmUgdXBsb2FkZWQgc3VjY2Vzc2Z1bGx5Li4uXCIsIFwiXCIsIFwiXCIpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc2NvcGUua2V5UmV0dXJuID0geyBcInVwbG9hZGVkXCI6IHNjb3BlLm15RmlsZXMgfTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChzY29wZS4kcGFyZW50ICE9PSB1bmRlZmluZWQgJiYgc2NvcGUuJHBhcmVudC5pdGVtICE9PSB1bmRlZmluZWQgJiYgc2NvcGUuJHBhcmVudC5pdGVtLnRlbXBsYXRlT3B0aW9ucyAhPT0gdW5kZWZpbmVkKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNjb3BlLiRwYXJlbnQuaXRlbS50ZW1wbGF0ZU9wdGlvbnMua2V5UmV0dXJuID0gc2NvcGUua2V5UmV0dXJuO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9O1xyXG5cclxuICAgICAgICAgICAgICAgIGlmIChzY29wZS5tdWx0aXBsZUZpbGUgIT09IHVuZGVmaW5lZCAmJiBzY29wZS5tdWx0aXBsZUZpbGUpXHJcbiAgICAgICAgICAgICAgICAgICAgJChlbCkuZmluZChcIiNmaWxlVXBsb2FkXCIpLmF0dHIoXCJtdWx0aXBsZVwiLCBcIm11bHRpcGxlXCIpO1xyXG4gICAgICAgICAgICAgICAgZWxzZVxyXG4gICAgICAgICAgICAgICAgICAgICQoZWwpLmZpbmQoXCIjZmlsZVVwbG9hZFwiKS5yZW1vdmVBdHRyKFwibXVsdGlwbGVcIik7XHJcblxyXG4gICAgICAgICAgICAgICAgZnVuY3Rpb24gcmVtb3ZlRmlsZShmaWxlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIGluZGV4ID0gbmF2Y29uLmdldEl0ZW1JbmRleEJ5S2V5VmFsdWUoc2NvcGUubXlGaWxlcywgXCJuYW1lXCIsIGZpbGUubmFtZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGluZGV4ICE9PSAtMSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBzY29wZS5teUZpbGVzLnNwbGljZShpbmRleCwgMSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHNjb3BlLmtleVJldHVybiA9IHsgXCJyZW1vdmVkXCI6IHNjb3BlLm15RmlsZXMgfTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHNjb3BlLiRwYXJlbnQgIT09IHVuZGVmaW5lZCAmJiBzY29wZS4kcGFyZW50Lml0ZW0gIT09IHVuZGVmaW5lZCAmJiBzY29wZS4kcGFyZW50Lml0ZW0udGVtcGxhdGVPcHRpb25zICE9PSB1bmRlZmluZWQpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzY29wZS4kcGFyZW50Lml0ZW0udGVtcGxhdGVPcHRpb25zLmtleVJldHVybiA9IHsgXCJyZW1vdmVkXCI6IHNjb3BlLm15RmlsZXMgfTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9O1xyXG5cclxuXHJcbiAgICAgICAgICAgICAgICBzY29wZS4kb24oJ0ZJTEVVUExPQUQtQ0xFQVInLCBmdW5jdGlvbihldmVudCwgYXJncywgdXBsb2FkQ2xlYXIpIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoYXJncyAmJiB1cGxvYWRDbGVhcilcclxuICAgICAgICAgICAgICAgICAgICAgICAgY2xlYXJGaWxlcygpO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICAgICAgdmFyIGNsZWFyRmlsZXMgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgICAgICAgICAkdGltZW91dChmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgc2NvcGUuJGFwcGx5KGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc2NvcGUubXlGaWxlcyA9IFtdO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgIH07XHJcblxyXG5cclxuXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9O1xyXG4gICAgfVxyXG5dKS5kaXJlY3RpdmUoJ25hdmNvblBob3RvVXBsb2FkJywgWydkYXRhc2VydmljZScsICdhcHBJbmZvJywgJ3Bob3RvTWFuYWdlcicsICdsb2dnZXInLCAnbmdBdXRoU2V0dGluZ3MnLCAnJHRpbWVvdXQnLFxyXG4gICAgZnVuY3Rpb24oZGF0YXNlcnZpY2UsIGFwcEluZm8sIHBob3RvTWFuYWdlciwgbG9nZ2VyLCBuZ0F1dGhTZXR0aW5ncywgJHRpbWVvdXQpIHtcclxuICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICAvKkU6IERpcmVjdGl2ZSBkZWZpbmVkIGFzIGFuIGVsZW1lbnQuIDxuYXZjb24tdGFibGU+PC9uYXZjb24tdGFibGU+XHJcbiAgICAgICAgICAgIEE6IERpcmVjdGl2ZSBhcHBsaWVkIGFzIGFuIGF0dHJpYnV0ZSBvbiBleGlzdGluZyBlbGVtZW50LiA8ZGl2IG5hdmNvbi10YWJsZT48L2Rpdj5cclxuICAgICAgICAgICAgQzogRGlyZWN0aXZlIGFwcGxpZWQgYXMgYSBjc3MgY2xhc3MgdG8gZXhpc3RpbmcgZWxlbWVudCA8ZGl2IGNsYXNzPVwibmF2Y29uLXRhYmxlXCI+PC9kaXY+XHJcbiAgICAgICAgICAgIE06IERpcmVjdGl2ZSBhcHBsaWVkIGFzIGNvbW1lbnQuKi9cclxuICAgICAgICAgICAgcmVzdHJpY3Q6ICdFJyxcclxuICAgICAgICAgICAgc2NvcGU6IHtcclxuICAgICAgICAgICAgICAgIG15SW1hZ2U6ICc9JyxcclxuICAgICAgICAgICAgICAgIG1vZGU6ICc9JyxcclxuICAgICAgICAgICAgICAgIHR5cGU6ICc9JyxcclxuICAgICAgICAgICAgICAgIGtleURhdGE6ICc9JyxcclxuICAgICAgICAgICAgICAgIGtleU5hbWU6ICc9JyxcclxuICAgICAgICAgICAgICAgIHBob3RvQ2hhbmdlYWJsZTogJz0nLFxyXG4gICAgICAgICAgICAgICAgZmlsZVNpemU6ICc9JyxcclxuICAgICAgICAgICAgICAgIGZpbGVUeXBlOiAnPScsXHJcbiAgICAgICAgICAgICAgICBhZ3JlZVRleHQ6ICc9J1xyXG4gICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAvL3RlbXBsYXRlVXJsOiAnZXh0LW1vZHVsZXMvbmF2Y29uVXBsb2FkL25hdmNvblBob3RvVXBsb2FkVGVtcGxhdGUuaHRtbCcsXHJcbiAgICAgICAgICAgIHRlbXBsYXRlVXJsOiBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBuYXZjb24uTWVudXJvdXRlLmdldFRlbXBsYXRlVXJsKFwibmF2Y29uUGhvdG9VcGxvYWRcIik7XHJcbiAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgIGxpbms6IGZ1bmN0aW9uKHNjb3BlLCBlbCwgYXR0cnMpIHtcclxuICAgICAgICAgICAgICAgIHNjb3BlLnRpdGxlID0gXCJ0ZXN0XCI7XHJcbiAgICAgICAgICAgICAgICBzY29wZS5oYXNGaWxlcyA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgc2NvcGUucGhvdG9zID0gW107XHJcbiAgICAgICAgICAgICAgICBzY29wZS51cGxvYWQgPSBwaG90b01hbmFnZXIudXBsb2FkO1xyXG4gICAgICAgICAgICAgICAgc2NvcGUuYXBwU3RhdHVzID0gYXBwSW5mby5zdGF0dXM7XHJcbiAgICAgICAgICAgICAgICBzY29wZS5waG90b01hbmFnZXJTdGF0dXMgPSBwaG90b01hbmFnZXIuc3RhdHVzO1xyXG5cclxuICAgICAgICAgICAgICAgIGlmIChzY29wZS5maWxlU2l6ZSA9PT0gdW5kZWZpbmVkKVxyXG4gICAgICAgICAgICAgICAgICAgIHNjb3BlLmZpbGVTaXplID0gMDtcclxuXHJcbiAgICAgICAgICAgICAgICBpZiAoc2NvcGUuZmlsZVR5cGUgPT09IHVuZGVmaW5lZClcclxuICAgICAgICAgICAgICAgICAgICBzY29wZS5maWxlVHlwZSA9IFtdO1xyXG5cclxuICAgICAgICAgICAgICAgIHNjb3BlLmlzQWdyZWUgPSBcIm5vXCI7XHJcbiAgICAgICAgICAgICAgICAvKmlmIChzY29wZS5hZ3JlZVRleHQgIT09IHVuZGVmaW5lZCAmJiBzY29wZS5hZ3JlZVRleHQgIT09IFwiXCIpXHJcbiAgICAgICAgICAgICAgICAgICAgc2NvcGUuaXNBZ3JlZVZpc2libGUgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgc2NvcGUuaXNBZ3JlZVZpc2libGUgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgICAgICBzY29wZS5pc0FncmVlID0gXCJ5ZXNcIjtcclxuICAgICAgICAgICAgICAgIH0qL1xyXG4gICAgICAgICAgICAgICAgc2NvcGUuJHdhdGNoKFwiYWdyZWVUZXh0XCIsIGZ1bmN0aW9uKG5ld1ZhbHVlLCBvbGRWYWx1ZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChuZXdWYWx1ZSAhPT0gdW5kZWZpbmVkICYmIG5ld1ZhbHVlICE9PSBcIlwiKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICBzY29wZS5pc0FncmVlVmlzaWJsZSA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHNjb3BlLmlzQWdyZWVWaXNpYmxlID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHNjb3BlLmlzQWdyZWUgPSBcInllc1wiO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgICAgIHNjb3BlLnJlYWRvbmx5ID0gc2NvcGUuJHBhcmVudC5yZWFkT25seSAhPSB1bmRlZmluZWQgPyBzY29wZS4kcGFyZW50LnJlYWRPbmx5IDogKHNjb3BlLiRwYXJlbnQucmVhZG9ubHkgIT0gdW5kZWZpbmVkID8gc2NvcGUuJHBhcmVudC5yZWFkb25seSA6IGZhbHNlKTtcclxuICAgICAgICAgICAgICAgIHNjb3BlLiR3YXRjaChcIiRwYXJlbnQucmVhZE9ubHlcIiwgZnVuY3Rpb24obmV3VmFsdWUsIG9sZFZhbHVlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKG5ld1ZhbHVlICE9IHVuZGVmaW5lZClcclxuICAgICAgICAgICAgICAgICAgICAgICAgc2NvcGUucmVhZG9ubHkgPSBuZXdWYWx1ZTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgc2NvcGUuJHdhdGNoKFwiJHBhcmVudC5yZWFkb25seVwiLCBmdW5jdGlvbihuZXdWYWx1ZSwgb2xkVmFsdWUpIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAobmV3VmFsdWUgIT0gdW5kZWZpbmVkKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICBzY29wZS5yZWFkb25seSA9IG5ld1ZhbHVlO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICAgICAgc2NvcGUucmVtb3ZlID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgc2NvcGUuY2xlYXJJbWFnZSgpO1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBmaWxlID0gc2NvcGUubXlJbWFnZVswXTtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoZmlsZS5zdGF0dXMgPT09IHVuZGVmaW5lZCB8fCBmaWxlLnN0YXR1cyA9PT0gJycpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgLy9kYXRhc2VydmljZS5maWxlRGVsZXRlKHNjb3BlLnR5cGUsIGZpbGUuaWQpLnRoZW4oZnVuY3Rpb24gKHN0YXR1cykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgaWQgPSBmaWxlLmlkO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoaWQgPT09IHVuZGVmaW5lZCkgaWQgPSBzY29wZS5rZXlEYXRhO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBkYXRhc2VydmljZS5maWxlRGVsZXRlKFwiZG93bmxvYWQvRGVsZXRlXCIsIGlkKS50aGVuKGZ1bmN0aW9uKHN0YXR1cykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGZpbGVOYW1lID0gZmlsZS5uYW1lO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGZpbGVOYW1lID09PSB1bmRlZmluZWQpIGZpbGVOYW1lID0gc2NvcGUua2V5TmFtZTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzY29wZS5rZXlSZXR1cm4gPSB7IFwicmVtb3ZlZFwiOiBzY29wZS5teUltYWdlIH07XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoc2NvcGUuJHBhcmVudCAhPT0gdW5kZWZpbmVkICYmIHNjb3BlLiRwYXJlbnQuaXRlbSAhPT0gdW5kZWZpbmVkICYmIHNjb3BlLiRwYXJlbnQuaXRlbS50ZW1wbGF0ZU9wdGlvbnMgIT09IHVuZGVmaW5lZClcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzY29wZS4kcGFyZW50Lml0ZW0udGVtcGxhdGVPcHRpb25zLmtleVJldHVybiA9IHNjb3BlLmtleVJldHVybjtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2dnZXIuc3VjY2VzcyhcIkZpbGUoXCIgKyBmaWxlTmFtZSArIFwiKSBpcyByZW1vdmVkIHN1Y2Nlc3NmdWxseS4uLlwiLCBcIlwiLCBcIlwiKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNjb3BlLm15SW1hZ2UgPSBbXTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGluZGV4ID0gbmF2Y29uLmdldEl0ZW1JbmRleEJ5S2V5VmFsdWUoc2NvcGUubXlJbWFnZSwgXCJuYW1lXCIsIGZpbGUubmFtZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChpbmRleCAhPT0gLTEpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNjb3BlLm15SW1hZ2Uuc3BsaWNlKGluZGV4LCAxKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNjb3BlLmtleVJldHVybiA9IHsgXCJyZW1vdmVkXCI6IHNjb3BlLm15SW1hZ2UgfTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChzY29wZS4kcGFyZW50ICE9PSB1bmRlZmluZWQgJiYgc2NvcGUuJHBhcmVudC5pdGVtICE9PSB1bmRlZmluZWQgJiYgc2NvcGUuJHBhcmVudC5pdGVtLnRlbXBsYXRlT3B0aW9ucyAhPT0gdW5kZWZpbmVkKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNjb3BlLiRwYXJlbnQuaXRlbS50ZW1wbGF0ZU9wdGlvbnMua2V5UmV0dXJuID0gc2NvcGUua2V5UmV0dXJuO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfTtcclxuXHJcbiAgICAgICAgICAgICAgICBzY29wZS5jYW5jZWwgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgICAgICAgICAvL2NsZWFySW1hZ2UoKTtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgcmV0VmFsdWUgPSBcIkNhbmNlbFwiO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChzY29wZS5teUltYWdlID09PSB1bmRlZmluZWQpIHJldHVybiByZXRWYWx1ZTtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoc2NvcGUubXlJbWFnZSAhPT0gdW5kZWZpbmVkICYmIHNjb3BlLm15SW1hZ2UubGVuZ3RoIDwgMSkgcmV0dXJuIHJldFZhbHVlO1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBmaWxlID0gc2NvcGUubXlJbWFnZVswXTtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoc2NvcGUubXlJbWFnZVswXS5VUkwgIT09IG51bGwgJiYgKGZpbGUuc3RhdHVzID09PSB1bmRlZmluZWQgfHwgZmlsZS5zdGF0dXMgPT09ICcnKSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0VmFsdWUgPSAnUmVtb3ZlJztcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmV0VmFsdWU7XHJcbiAgICAgICAgICAgICAgICB9O1xyXG5cclxuICAgICAgICAgICAgICAgIHNjb3BlLmNsZWFySW1hZ2UgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgICAgICAgICAkdGltZW91dChmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgc2NvcGUuJGFwcGx5KGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc2NvcGUuc3JjID0gXCJkYXRhOmltYWdlL2dpZjtiYXNlNjQsUjBsR09EbGhBUUFCQUlBQUFBQUFBUC8vL3l3QUFBQUFBUUFCQUFBQ0FVd0FPdz09XCI7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgc2NvcGUuc3JjID0gXCJkYXRhOmltYWdlL2dpZjtiYXNlNjQsUjBsR09EbGhBUUFCQUlBQUFBQUFBUC8vL3l3QUFBQUFBUUFCQUFBQ0FVd0FPdz09XCI7XHJcblxyXG4gICAgICAgICAgICAgICAgc2NvcGUub3BlblN0YXR1cyA9IGZ1bmN0aW9uKGZpbGUpIHtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgcmV0VmFsdWUgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChmaWxlLnN0YXR1cyA9PT0gdW5kZWZpbmVkIHx8IGZpbGUuc3RhdHVzID09PSAnJylcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0VmFsdWUgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmV0VmFsdWU7XHJcbiAgICAgICAgICAgICAgICB9O1xyXG5cclxuICAgICAgICAgICAgICAgIHNjb3BlLmxvYWRTcmMgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgdXBsb2FkQmFzZSA9IG5nQXV0aFNldHRpbmdzLnVwbG9hZFBhdGg7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHNjb3BlLm15SW1hZ2UgIT09IHVuZGVmaW5lZCkgLy8mJiBzY29wZS5teUltYWdlLmxlbmd0aCA+IDAgJiYgc2NvcGUubXlJbWFnZVswXS5VUkwgIT09IHVuZGVmaW5lZCAmJiBzY29wZS5teUltYWdlWzBdLlVSTCAhPT0gJydcclxuICAgICAgICAgICAgICAgICAgICAgICAgc2NvcGUuc3JjID0gJ2RhdGE6aW1hZ2UvanBlZztiYXNlNjQsJyArIHNjb3BlLm15SW1hZ2U7IC8vdXBsb2FkQmFzZSArIHNjb3BlLm15SW1hZ2VbMF0uVVJMO1xyXG4gICAgICAgICAgICAgICAgICAgIGVsc2VcclxuICAgICAgICAgICAgICAgICAgICAgICAgc2NvcGUuc3JjID0gJ2RhdGE6aW1hZ2UvZ2lmO2Jhc2U2NCxSMGxHT0RsaEFRQUJBSUFBQUFBQUFQLy8veXdBQUFBQUFRQUJBQUFDQVV3QU93PT0nO1xyXG4gICAgICAgICAgICAgICAgfTtcclxuXHJcbiAgICAgICAgICAgICAgICBzY29wZS5jaG9vc2VDbGljayA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHNjb3BlLm15SW1hZ2UgPSBbXTtcclxuICAgICAgICAgICAgICAgICAgICAkKGVsKS5maW5kKFwiI3Bob3RvVXBsb2FkXCIpLmNsaWNrKCk7XHJcbiAgICAgICAgICAgICAgICB9O1xyXG5cclxuICAgICAgICAgICAgICAgIHZhciBiYXNlNjRUb0Jsb2IgPSBmdW5jdGlvbihiNjREYXRhLCBjb250ZW50VHlwZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBieXRlQ2hhcmFjdGVycyA9IGF0b2IoYjY0RGF0YS5zcGxpdCgnLCcpWzFdKTtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgYnl0ZU51bWJlcnMgPSBuZXcgQXJyYXkoYnl0ZUNoYXJhY3RlcnMubGVuZ3RoKTtcclxuICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGJ5dGVDaGFyYWN0ZXJzLmxlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGJ5dGVOdW1iZXJzW2ldID0gYnl0ZUNoYXJhY3RlcnMuY2hhckNvZGVBdChpKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIGJ5dGVBcnJheSA9IG5ldyBVaW50OEFycmF5KGJ5dGVOdW1iZXJzKTtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgYmxvYiA9IG5ldyBCbG9iKFtieXRlQXJyYXldLCB7IHR5cGU6IGNvbnRlbnRUeXBlIH0pO1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBibG9iO1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIHNjb3BlLnVwbG9hZCA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBmb3JtRGF0YSA9IG5ldyBGb3JtRGF0YSgpO1xyXG4gICAgICAgICAgICAgICAgICAgIGFuZ3VsYXIuZm9yRWFjaChzY29wZS5teUltYWdlLCBmdW5jdGlvbihmaWxlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChmaWxlLnN0YXR1cyAhPT0gdW5kZWZpbmVkICYmIGZpbGUuc3RhdHVzID09PSBcIm5ld1wiKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgYmxvYiA9IGJhc2U2NFRvQmxvYihmaWxlLmJhc2U2NCwgZmlsZS50eXBlKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvcm1EYXRhLmFwcGVuZChcImJsb2JcIiwgYmxvYiwgZmlsZS5uYW1lKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNjb3BlLmtleU5hbWUgPSBmaWxlLm5hbWU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHNjb3BlLmtleURhdGEgPT09IHVuZGVmaW5lZCB8fCBzY29wZS5rZXlEYXRhID09PSBcIlwiIHx8IHNjb3BlLmtleURhdGEgPT09IFwiMFwiKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHNjb3BlLmtleVJldHVybiA9IHsgXCJlcnJvclwiOiBcIk5vIGtleURhdGFcIiB9O1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoc2NvcGUuJHBhcmVudCAhPT0gdW5kZWZpbmVkICYmIHNjb3BlLiRwYXJlbnQuaXRlbSAhPT0gdW5kZWZpbmVkICYmIHNjb3BlLiRwYXJlbnQuaXRlbS50ZW1wbGF0ZU9wdGlvbnMgIT09IHVuZGVmaW5lZClcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNjb3BlLiRwYXJlbnQuaXRlbS50ZW1wbGF0ZU9wdGlvbnMua2V5UmV0dXJuID0gc2NvcGUua2V5UmV0dXJuO1xyXG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBkYXRhSW5mbyA9IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvbGRlcjogc2NvcGUudHlwZSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlkOiBzY29wZS5rZXlEYXRhLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogKHNjb3BlLmtleU5hbWUgIT09IHVuZGVmaW5lZCAmJiBzY29wZS5rZXlOYW1lICE9PSAnJyA/IHNjb3BlLmtleU5hbWUgOiAnJylcclxuICAgICAgICAgICAgICAgICAgICAgICAgfTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGZvcm1EYXRhLmFwcGVuZChcImRhdGFcIiwgSlNPTi5zdHJpbmdpZnkoZGF0YUluZm8pKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgZGF0YXNlcnZpY2UuZmlsZVVwbG9hZChmb3JtRGF0YSkudGhlbihmdW5jdGlvbih1cGxvYWREYXRhKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzY29wZS5teUltYWdlID0gdXBsb2FkRGF0YS5GaWxlcztcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvZ2dlci5zdWNjZXNzKFwiRmlsZXMgYXJlIHVwbG9hZGVkIHN1Y2Nlc3NmdWxseS4uLlwiLCBcIlwiLCBcIlwiKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNjb3BlLmtleVJldHVybiA9IHsgXCJ1cGxvYWRlZFwiOiBzY29wZS5teUltYWdlIH07XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoc2NvcGUuJHBhcmVudCAhPT0gdW5kZWZpbmVkICYmIHNjb3BlLiRwYXJlbnQuaXRlbSAhPT0gdW5kZWZpbmVkICYmIHNjb3BlLiRwYXJlbnQuaXRlbS50ZW1wbGF0ZU9wdGlvbnMgIT09IHVuZGVmaW5lZClcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzY29wZS4kcGFyZW50Lml0ZW0udGVtcGxhdGVPcHRpb25zLmtleVJldHVybiA9IHNjb3BlLmtleVJldHVybjtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfTtcclxuXHJcbiAgICAgICAgICAgICAgICBzY29wZS4kd2F0Y2goJ215SW1hZ2UnLCBmdW5jdGlvbihuZXdWYWx1ZSwgb2xkVmFsdWUpIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAobmV3VmFsdWUgIT09IHVuZGVmaW5lZCAmJiBuZXdWYWx1ZS5sZW5ndGggPT09IDApXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHNjb3BlLmNsZWFySW1hZ2UoKTtcclxuICAgICAgICAgICAgICAgICAgICBlbHNlKG5ld1ZhbHVlICE9PSB1bmRlZmluZWQgJiYgbmV3VmFsdWUubGVuZ3RoID4gMClcclxuICAgICAgICAgICAgICAgICAgICBzY29wZS5sb2FkU3JjKCk7XHJcblxyXG4gICAgICAgICAgICAgICAgfSlcclxuXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9O1xyXG4gICAgfVxyXG5dKS5kaXJlY3RpdmUoJ2ZpbGVNb2RlbCcsIFsnJHBhcnNlJywgJyR0aW1lb3V0JywgJ2xvZ2dlcicsICdibG9ja1VJJywgZnVuY3Rpb24oJHBhcnNlLCAkdGltZW91dCwgbG9nZ2VyLCBibG9ja1VJKSB7XHJcbiAgICByZXR1cm4ge1xyXG4gICAgICAgIHJlc3RyaWN0OiAnQScsXHJcbiAgICAgICAgbGluazogZnVuY3Rpb24oc2NvcGUsIGVsZW1lbnQsIGF0dHJzKSB7XHJcbiAgICAgICAgICAgIHZhciBtb2RlbCA9ICRwYXJzZShhdHRycy5maWxlTW9kZWwpO1xyXG5cclxuICAgICAgICAgICAgdmFyIGlkID0gJChlbGVtZW50KS5hdHRyKFwiaWRcIik7XHJcbiAgICAgICAgICAgIHZhciBtb2RlbFNldHRlciA9IG1vZGVsLmFzc2lnbjtcclxuICAgICAgICAgICAgdmFyIGV4dExpc3QgPSBbeyBleHQ6ICdleGUnIH0sIHsgZXh0OiAnemlwJyB9LCB7IGV4dDogJ2JhdCcgfV1cclxuICAgICAgICAgICAgdmFyIGFsbG93RXh0ID0gc2NvcGUuZmlsZVR5cGU7XHJcbiAgICAgICAgICAgIGVsZW1lbnQuYmluZCgnY2hhbmdlJywgZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoJChlbGVtZW50KS52YWwoKSA9PSBcIlwiKVxyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcclxuXHJcbiAgICAgICAgICAgICAgICBpZiAoc2NvcGUuaXNBZ3JlZVZpc2libGUpXHJcbiAgICAgICAgICAgICAgICAgICAgc2NvcGUuaXNBZ3JlZSA9ICdubyc7XHJcblxyXG4gICAgICAgICAgICAgICAgLy9ibG9ja1VJLnN0YXJ0KCk7ICAgXHJcblxyXG4gICAgICAgICAgICAgICAgJHRpbWVvdXQoZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgc2NvcGUuJGFwcGx5KGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoZWxlbWVudFswXS5maWxlcykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYW5ndWxhci5mb3JFYWNoKGVsZW1lbnRbMF0uZmlsZXMsIGZ1bmN0aW9uKGYpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoZi5zaXplICE9PSB1bmRlZmluZWQgJiYgZi5zaXplID4gMCAmJiBzY29wZS5maWxlU2l6ZSA+IDApIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKChmLnNpemUgLyAxMDAwKSA+IHNjb3BlLmZpbGVTaXplKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2dnZXIud2FybmluZyhcIkZpbGUgc2l6ZSBzaG91bGQgYmUgbGVzcyB0aGFuIFwiICsgc2NvcGUuZmlsZVNpemUudG9TdHJpbmcoKSArIFwiIGtiXCIpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIDA7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICgoZi5zaXplIC8gMTAwMCkgPiAyMDAwICYmIHNjb3BlLmZpbGVTaXplID09PSBcIjBcIikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2dnZXIud2FybmluZyhcIkZpbGUgc2l6ZSBzaG91bGQgYmUgbGVzcyB0aGFuIDJtYlwiKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIDA7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoc2NvcGUuc2FtZUZpbGUgIT09IHVuZGVmaW5lZCAmJiAhc2NvcGUuc2FtZUZpbGUgJiYgbmF2Y29uLmdldEl0ZW1CeUtleVZhbHVlKHNjb3BlLm15RmlsZXMsIFwibmFtZVwiLCBmLm5hbWUpICE9PSAtMSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2dnZXIud2FybmluZyhcIkNhbiBub3QgdXBsb2FkIHRoZSBzYW1lIGZpbGUgbmFtZSAoXCIgKyBmLm5hbWUgKyBcIilcIik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAwO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZltcInN0YXR1c1wiXSA9IFwibmV3XCI7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHNjb3BlLm15RmlsZXMgPT0gXCJcIilcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2NvcGUubXlGaWxlcyA9IFtdO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBleHQgPSBmLm5hbWUuc3BsaXQoJy4nKS5wb3AoKS50b0xvd2VyQ2FzZSgpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoc2NvcGUuZmlsZVR5cGUubGVuZ3RoID4gMCAmJiBzY29wZS5maWxlVHlwZS5pbmRleE9mKGV4dCkgPT09IC0xKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvZ2dlci53YXJuaW5nKFwiRmlsZSBmb3JtYXQgXCIgKyBzY29wZS5maWxlVHlwZS5qb2luKCcsJykgKyBcIiBvbmx5IHN1cHBvcnRlZFwiKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIDA7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChuYXZjb24uZ2V0SXRlbUJ5S2V5VmFsdWUoZXh0TGlzdCwgXCJleHRcIiwgZXh0KSA9PT0gLTEpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGlkLnRvTG93ZXJDYXNlKCkgPT09IFwicGhvdG91cGxvYWRcIikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZ2V0QmFzZTY0KGYsIGZ1bmN0aW9uKGJhc2U2NCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBmaWxlRGF0YSA9IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGFzdE1vZGlmaWVkOiBmLmxhc3RNb2RpZmllZCxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGFzdE1vZGlmaWVkRGF0ZTogZi5sYXN0TW9kaWZpZWREYXRlLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiBmLm5hbWUsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNpemU6IGYuc2l6ZSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogZi50eXBlLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB3ZWJraXRSZWxhdGl2ZVBhdGg6IGYud2Via2l0UmVsYXRpdmVQYXRoLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBiYXNlNjQ6IGJhc2U2NCxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RhdHVzOiBmLnN0YXR1cyB8fCAnbmV3J1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkdGltZW91dChmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2NvcGUubXlJbWFnZS5wdXNoKGZpbGVEYXRhKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVhZFVSTChmKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdldEJhc2U2NChmLCBmdW5jdGlvbihiYXNlNjQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgZmlsZURhdGEgPSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxhc3RNb2RpZmllZDogZi5sYXN0TW9kaWZpZWQsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxhc3RNb2RpZmllZERhdGU6IGYubGFzdE1vZGlmaWVkRGF0ZSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogZi5uYW1lLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzaXplOiBmLnNpemUsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6IGYudHlwZSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgd2Via2l0UmVsYXRpdmVQYXRoOiBmLndlYmtpdFJlbGF0aXZlUGF0aCxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYmFzZTY0OiBiYXNlNjQsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0YXR1czogZi5zdGF0dXMgfHwgJ25ldydcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJHRpbWVvdXQoZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNjb3BlLm15RmlsZXMucHVzaChmaWxlRGF0YSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9nZ2VyLndhcm5pbmcoXCJGaWxlIGZvcm1hdCAnLlwiICsgZXh0ICsgXCInIG5vdCBzdXBwb3J0ZWQuXCIpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc2NvcGUuaGFzRmlsZXMgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICQoZWxlbWVudCkudmFsKFwiXCIpO1xyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICBmdW5jdGlvbiBibG9iVG9EYXRhVVJMKGYsIHR5cGUsIGNhbGxiYWNrKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgZmlsZVJlYWRlciA9IG5ldyBGaWxlUmVhZGVyKCk7XHJcbiAgICAgICAgICAgICAgICBmaWxlUmVhZGVyLnJlYWRBc0FycmF5QnVmZmVyKGYpO1xyXG4gICAgICAgICAgICAgICAgZmlsZVJlYWRlci5vbmxvYWRlbmQgPSBmdW5jdGlvbihlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIGFiID0gZS50YXJnZXQucmVzdWx0O1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBibG9iID0gbmV3IEJsb2IoW2FiXSwgeyB0eXBlOiB0eXBlIH0pO1xyXG4gICAgICAgICAgICAgICAgICAgIGNhbGxiYWNrKGJsb2IpO1xyXG4gICAgICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgfVxyXG5cclxuXHJcbiAgICAgICAgICAgIGZ1bmN0aW9uIGdldEJhc2U2NChmaWxlLCBjYWxsYmFjaykge1xyXG4gICAgICAgICAgICAgICAgdmFyIHJlYWRlciA9IG5ldyBGaWxlUmVhZGVyKCk7XHJcbiAgICAgICAgICAgICAgICByZWFkZXIucmVhZEFzRGF0YVVSTChmaWxlKTtcclxuICAgICAgICAgICAgICAgIHJlYWRlci5vbmxvYWQgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgICAgICAgICBjYWxsYmFjayhyZWFkZXIucmVzdWx0KTtcclxuICAgICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgICAgICByZWFkZXIub25lcnJvciA9IGZ1bmN0aW9uKGVycm9yKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ0Vycm9yOiAnLCBlcnJvcik7XHJcbiAgICAgICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICB9XHJcblxyXG5cclxuICAgICAgICAgICAgZnVuY3Rpb24gcmVhZFVSTChmaWxlKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoZmlsZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciByZWFkZXIgPSBuZXcgRmlsZVJlYWRlcigpO1xyXG4gICAgICAgICAgICAgICAgICAgIHJlYWRlci5vbmxvYWQgPSBmdW5jdGlvbihlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICR0aW1lb3V0KGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc2NvcGUuJGFwcGx5KGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNjb3BlLnNyYyA9IGUudGFyZ2V0LnJlc3VsdDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgICAgICAgICAgcmVhZGVyLnJlYWRBc0RhdGFVUkwoZmlsZSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxufV0pOyIsIlwidXNlIHN0cmljdFwiO1xyXG5cclxuYW5ndWxhci5tb2R1bGUoJ25hdmNvbkZyYW1ld29yaycpLmRpcmVjdGl2ZSgnbmF2Y29uVXNlclByb2ZpbGUnLCBmdW5jdGlvbigpIHtcclxuICAgIHJldHVybiB7XHJcbiAgICAgICAgLy90ZW1wbGF0ZVVybDogJ2V4dC1tb2R1bGVzL25hdmNvbkZyYW1ld29yay9uYXZjb25Vc2VyUHJvZmlsZS9uYXZjb25Vc2VyUHJvZmlsZVRlbXBsYXRlLmh0bWwnXHJcbiAgICAgICAgdGVtcGxhdGVVcmw6IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICByZXR1cm4gbmF2Y29uLk1lbnVyb3V0ZS5nZXRUZW1wbGF0ZVVybChcIm5hdmNvblVzZXJQcm9maWxlXCIpO1xyXG4gICAgICAgIH0sXHJcbiAgICB9O1xyXG59KTsiLCJcInVzZSBzdHJpY3RcIjtcclxuXHJcbmFuZ3VsYXIubW9kdWxlKCduYXZjb25GcmFtZXdvcmsnKS5kaXJlY3RpdmUoJ25hdmNvblVzZXJQcm9maWxlU21hbGwnLCBmdW5jdGlvbigpIHtcclxuICAgIHJldHVybiB7XHJcbiAgICAgICAgLy90ZW1wbGF0ZVVybDogJ2V4dC1tb2R1bGVzL25hdmNvbkZyYW1ld29yay9uYXZjb25Vc2VyUHJvZmlsZS9uYXZjb25Vc2VyUHJvZmlsZVNtYWxsVGVtcGxhdGUuaHRtbCdcclxuICAgICAgICB0ZW1wbGF0ZVVybDogZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBuYXZjb24uTWVudXJvdXRlLmdldFRlbXBsYXRlVXJsKFwibmF2Y29uVXNlclByb2ZpbGVTbWFsbFwiKTtcclxuICAgICAgICB9LFxyXG4gICAgfTtcclxufSk7IiwiYW5ndWxhci5tb2R1bGUoJ2FwcCcpLmRpcmVjdGl2ZSgnbWZEcm9wZG93blN0YXRpY0luY2x1ZGUnLCBbJyRjb21waWxlJywgZnVuY3Rpb24gKCRjb21waWxlKSB7XHJcbiAgICByZXR1cm4gZnVuY3Rpb24gKHNjb3BlLCBlbGVtZW50LCBhdHRycykge1xyXG4gICAgICAgIHZhciB0ZW1wbGF0ZSA9IGF0dHJzLm1mRHJvcGRvd25TdGF0aWNJbmNsdWRlO1xyXG4gICAgICAgIHZhciBjb250ZW50cyA9IGVsZW1lbnQuaHRtbCh0ZW1wbGF0ZSkuY29udGVudHMoKTtcclxuICAgICAgICAkY29tcGlsZShjb250ZW50cykoc2NvcGUpO1xyXG4gICAgfTtcclxufV0pLmRpcmVjdGl2ZSgnbmdEcm9wZG93bk11bHRpc2VsZWN0JywgWyckZmlsdGVyJywgJyRkb2N1bWVudCcsICckY29tcGlsZScsICckcGFyc2UnLCBmdW5jdGlvbiAoJGZpbHRlciwgJGRvY3VtZW50LCAkY29tcGlsZSwgJHBhcnNlKSB7XHJcbiAgICByZXR1cm4ge1xyXG4gICAgICAgIHJlc3RyaWN0OiAnRUEnLFxyXG4gICAgICAgIHNjb3BlOiB7XHJcbiAgICAgICAgICAgIHNlbGVjdGVkTW9kZWw6ICc9JyxcclxuICAgICAgICAgICAgb3B0aW9uczogJz0nLFxyXG4gICAgICAgICAgICBleHRyYVNldHRpbmdzOiAnPScsXHJcbiAgICAgICAgICAgIGV2ZW50czogJz0nLFxyXG4gICAgICAgICAgICBzZWFyY2hGaWx0ZXI6ICc9PycsXHJcbiAgICAgICAgICAgIHRyYW5zbGF0aW9uVGV4dHM6ICc9JyxcclxuICAgICAgICAgICAgZ3JvdXBCeTogJ0AnLFxyXG4gICAgICAgICAgICBkaXNhYmxlZDogXCI9XCIsXHJcbiAgICAgICAgICAgIHBhcmVudExpc3Q6IFwiPVwiXHJcbiAgICAgICAgfSxcclxuICAgICAgICB0ZW1wbGF0ZTogZnVuY3Rpb24gKGVsZW1lbnQsIGF0dHJzLCAkc2NvcGUpIHtcclxuICAgICAgICAgICAgdmFyIGNoZWNrYm94ZXMgPSBhdHRycy5jaGVja2JveGVzID8gdHJ1ZSA6IGZhbHNlO1xyXG4gICAgICAgICAgICB2YXIgZ3JvdXBzID0gYXR0cnMuZ3JvdXBCeSA/IHRydWUgOiBmYWxzZTtcclxuXHJcbiAgICAgICAgICAgIHZhciB0ZW1wbGF0ZSA9ICc8ZGl2ICBuYW1lPVwie3skcGFyZW50Lml0ZW0ua2V5fX1cIiBjbGFzcz1cIm11bHRpc2VsZWN0LXBhcmVudCBidG4tZ3JvdXAgZHJvcGRvd24tbXVsdGlzZWxlY3RcIiBzdHlsZT1cImZsb2F0OmxlZnQ7d2lkdGg6MTAwJVwiIG5nLWNsYXNzPVwie29wZW46IG9wZW59XCIgbmctbW9kZWw9XCJzZWxlY3RlZE1vZGVsXCIgZmllbGQtcmVxdWlyZWQ9XCIkcGFyZW50Lml0ZW0udGVtcGxhdGVPcHRpb25zLnJlcXVpcmVkXCI+JztcclxuICAgICAgICAgICAgdGVtcGxhdGUgKz0gJzxidXR0b24gaWQ9XCJ7e3RleHRzLm5hbWV9fVwiIG5nLWRpc2FibGVkPVwiZGlzYWJsZWRcIiB0eXBlPVwiYnV0dG9uXCIgY2xhc3M9XCJkcm9wZG93bi10b2dnbGVcIiBuZy1jbGFzcz1cInNldHRpbmdzLmJ1dHRvbkNsYXNzZXNcIiBuZy1jbGljaz1cInRvZ2dsZURyb3Bkb3duKClcIiBzdHlsZT1cIndpZHRoOjEwMCU7dGV4dC1hbGlnbjpsZWZ0O3RleHQtb3ZlcmZsb3c6IGVsbGlwc2lzO3BhZGRpbmc6IDRweDtcIj48c3BhbiBzdHlsZT1cInRleHQtb3ZlcmZsb3c6IGVsbGlwc2lzO3dpZHRoOjg1JTtkaXNwbGF5OmlubGluZS1ibG9jaztvdmVyZmxvdzpoaWRkZW47XCI+e3tnZXRCdXR0b25UZXh0KCl9fTwvc3Bhbj4mbmJzcDs8c3BhbiBjbGFzcz1cImNhcmV0XCIgc3R5bGU9XCJmbG9hdDpyaWdodDttYXJnaW4tdG9wOjhweDtcIj48L3NwYW4+PC9idXR0b24+JztcclxuICAgICAgICAgICAgdGVtcGxhdGUgKz0gJzx1bCBjbGFzcz1cImRyb3Bkb3duLW1lbnUgZHJvcGRvd24tbWVudS1mb3JtXCIgbmctaWY9XCJvcGVuXCIgbmctc3R5bGU9XCJ7ZGlzcGxheTogb3BlbiA/IFxcJ2Jsb2NrXFwnIDogXFwnbm9uZVxcJywgaGVpZ2h0IDogIFxcJzI1MHB4XFwnLCBvdmVyZmxvdzogXFwnYXV0b1xcJyB9XCIgc3R5bGU9XCJ3aWR0aDoxMDAlO21hcmdpbi10b3A6MFwiID4nO1xyXG4gICAgICAgICAgICB0ZW1wbGF0ZSArPSAnPGxpIG5nLWlmPVwic2V0dGluZ3Muc2hvd0NoZWNrQWxsICYmIHNldHRpbmdzLnNlbGVjdGlvbkxpbWl0ICE9PSAxXCIgc3R5bGU9XCJmbG9hdDpsZWZ0O1wiPjxhIG5nLWtleWRvd249XCJrZXlEb3duTGluaygkZXZlbnQpXCIgZGF0YS1uZy1jbGljaz1cInNlbGVjdEFsbCgpXCIgdGFiaW5kZXg9XCItMVwiIGlkPVwic2VsZWN0QWxsXCI+PHNwYW4gY2xhc3M9XCJnbHlwaGljb24gZ2x5cGhpY29uLW9rXCI+PC9zcGFuPiAge3t0ZXh0cy5jaGVja0FsbH19PC9hPic7XHJcbiAgICAgICAgICAgIHRlbXBsYXRlICs9ICc8bGkgbmctaWY9XCJzZXR0aW5ncy5zaG93VW5jaGVja0FsbFwiIHN0eWxlPVwiZmxvYXQ6cmlnaHQ7XCI+PGEgbmcta2V5ZG93bj1cImtleURvd25MaW5rKCRldmVudClcIiBkYXRhLW5nLWNsaWNrPVwiZGVzZWxlY3RBbGwoKTtcIiB0YWJpbmRleD1cIi0xXCIgaWQ9XCJkZXNlbGVjdEFsbFwiPjxzcGFuIGNsYXNzPVwiZ2x5cGhpY29uIGdseXBoaWNvbi1yZW1vdmVcIj48L3NwYW4+ICAge3t0ZXh0cy51bmNoZWNrQWxsfX08L2E+PC9saT4nO1xyXG4gICAgICAgICAgICB0ZW1wbGF0ZSArPSAnPGxpIG5nLWlmPVwic2V0dGluZ3Muc2VsZWN0QnlHcm91cHMgJiYgKChzZXR0aW5ncy5zaG93Q2hlY2tBbGwgJiYgc2V0dGluZ3Muc2VsZWN0aW9uTGltaXQgPiAwKSB8fCBzZXR0aW5ncy5zaG93VW5jaGVja0FsbClcIiBjbGFzcz1cImRpdmlkZXJcIiBzdHlsZT1cImNsZWFyOmJvdGg7XCI+PC9saT4nO1xyXG4gICAgICAgICAgICB0ZW1wbGF0ZSArPSAnPGxpIG5nLWlmPVwic2V0dGluZ3Muc2VsZWN0QnlHcm91cHMgJiYgKChzZXR0aW5ncy5zaG93Q2hlY2tBbGwgJiYgc2V0dGluZ3Muc2VsZWN0aW9uTGltaXQgPiAwKSB8fCBzZXR0aW5ncy5zaG93VW5jaGVja0FsbClcIiBjbGFzcz1cImRpdmlkZXJcIiBzdHlsZT1cImNsZWFyOmJvdGg7XCI+PC9saT4nO1xyXG4gICAgICAgICAgICB0ZW1wbGF0ZSArPSAnPGxpIG5nLXJlcGVhdD1cImN1cnJlbnRHcm91cCBpbiBzZXR0aW5ncy5zZWxlY3RCeUdyb3VwcyB0cmFjayBieSAkaW5kZXhcIiBuZy1jbGljaz1cInNlbGVjdEN1cnJlbnRHcm91cChjdXJyZW50R3JvdXApXCI+PGEgbmctY2xhc3M9XCJ7XFwnZHJvcGRvd24tc2VsZWN0ZWQtZ3JvdXBcXCc6IHNlbGVjdGVkR3JvdXAgPT09IGN1cnJlbnRHcm91cH1cIiB0YWJpbmRleD1cIi0xXCI+e3s6OnRleHRzLnNlbGVjdEdyb3VwfX0ge3s6OmdldEdyb3VwTGFiZWwoY3VycmVudEdyb3VwKX19PC9hPjwvbGk+JztcclxuICAgICAgICAgICAgdGVtcGxhdGUgKz0gJzxsaSBuZy1pZj1cInNldHRpbmdzLnNlbGVjdEJ5R3JvdXBzICYmIHNldHRpbmdzLnNob3dFbmFibGVTZWFyY2hCdXR0b25cIiBjbGFzcz1cImRpdmlkZXJcIiBzdHlsZT1cImNsZWFyOmJvdGg7XCI+PC9saT4nO1xyXG4gICAgICAgICAgICB0ZW1wbGF0ZSArPSAnPGxpIG5nLWlmPVwic2V0dGluZ3Muc2hvd0VuYWJsZVNlYXJjaEJ1dHRvbiAmJiBzZXR0aW5ncy5lbmFibGVTZWFyY2hcIj48YSBuZy1rZXlkb3duPVwia2V5RG93bkxpbmsoJGV2ZW50KTsga2V5RG93blRvZ2dsZVNlYXJjaCgpO1wiIG5nLWNsaWNrPVwidG9nZ2xlU2VhcmNoKCRldmVudCk7XCIgdGFiaW5kZXg9XCItMVwiPnt7dGV4dHMuZGlzYWJsZVNlYXJjaH19PC9hPjwvbGk+JztcclxuICAgICAgICAgICAgdGVtcGxhdGUgKz0gJzxsaSBuZy1pZj1cInNldHRpbmdzLnNob3dFbmFibGVTZWFyY2hCdXR0b24gJiYgIXNldHRpbmdzLmVuYWJsZVNlYXJjaFwiPjxhIG5nLWtleWRvd249XCJrZXlEb3duTGluaygkZXZlbnQpOyBrZXlEb3duVG9nZ2xlU2VhcmNoKCk7XCIgbmctY2xpY2s9XCJ0b2dnbGVTZWFyY2goJGV2ZW50KTtcIiB0YWJpbmRleD1cIi0xXCI+e3t0ZXh0cy5lbmFibGVTZWFyY2h9fTwvYT48L2xpPic7XHJcbiAgICAgICAgICAgIHRlbXBsYXRlICs9ICc8bGkgbmctaWY9XCIoc2V0dGluZ3Muc2hvd0NoZWNrQWxsICYmIHNldHRpbmdzLnNlbGVjdGlvbkxpbWl0ID4gMCkgfHwgc2V0dGluZ3Muc2hvd1VuY2hlY2tBbGwgfHwgc2V0dGluZ3Muc2hvd0VuYWJsZVNlYXJjaEJ1dHRvblwiIGNsYXNzPVwiZGl2aWRlclwiIHN0eWxlPVwiY2xlYXI6Ym90aDsge3tzZXR0aW5ncy5pc0N1c3RvbUZvcm1hdCA/IFxcJ21hcmdpbi1ib3R0b206IDIycHg7XFwnOlxcJ1xcJ319XCI+PC9saT4nO1xyXG4gICAgICAgICAgICB0ZW1wbGF0ZSArPSAnPGxpIG5nLWlmPVwic2V0dGluZ3MuZW5hYmxlU2VhcmNoXCI+PGRpdiBjbGFzcz1cImRyb3Bkb3duLWhlYWRlclwiPjxpbnB1dCB0eXBlPVwidGV4dFwiIGNsYXNzPVwiZm9ybS1jb250cm9sIHNlYXJjaEZpZWxkXCIgbmcta2V5ZG93bj1cImtleURvd25TZWFyY2hEZWZhdWx0KCRldmVudCk7IGtleURvd25TZWFyY2goJGV2ZW50LCBpbnB1dC5zZWFyY2hGaWx0ZXIpO1wiIG5nLXN0eWxlPVwie3dpZHRoOiBcXCcxMDAlXFwnfVwiIG5nLW1vZGVsPVwiaW5wdXQuc2VhcmNoRmlsdGVyXCIgcGxhY2Vob2xkZXI9XCJ7e3RleHRzLnNlYXJjaFBsYWNlaG9sZGVyfX1cIiAvPjwvbGk+JztcclxuICAgICAgICAgICAgdGVtcGxhdGUgKz0gJzxsaSBuZy1pZj1cInNldHRpbmdzLmVuYWJsZVNlYXJjaFwiIGNsYXNzPVwiZGl2aWRlclwiIHN0eWxlPVwiY2xlYXI6Ym90aDtcIj48L2xpPic7XHJcblxyXG4gICAgICAgICAgICBpZiAoZ3JvdXBzKSB7XHJcbiAgICAgICAgICAgICAgICB0ZW1wbGF0ZSArPSAnPGxpIG5nLXJlcGVhdC1zdGFydD1cIm9wdGlvbiBpbiBvcmRlcmVkSXRlbXMgfCBmaWx0ZXI6Z2V0RmlsdGVyKGlucHV0LnNlYXJjaEZpbHRlcilcIiBuZy1zaG93PVwiZ2V0UHJvcGVydHlGb3JPYmplY3Qob3B0aW9uLCBzZXR0aW5ncy5ncm91cEJ5KSAhPT0gZ2V0UHJvcGVydHlGb3JPYmplY3Qob3JkZXJlZEl0ZW1zWyRpbmRleCAtIDFdLCBzZXR0aW5ncy5ncm91cEJ5KVwiIHJvbGU9XCJwcmVzZW50YXRpb25cIiBjbGFzcz1cImRyb3Bkb3duLWhlYWRlclwiPnt7IGdldEdyb3VwTGFiZWwoZ2V0UHJvcGVydHlGb3JPYmplY3Qob3B0aW9uLCBzZXR0aW5ncy5ncm91cEJ5KSkgfX08L2xpPic7XHJcbiAgICAgICAgICAgICAgICB0ZW1wbGF0ZSArPSAnPGxpIG5nLWNsYXNzPVwie1xcJ2FjdGl2ZVxcJzogaXNDaGVja2VkKGdldFByb3BlcnR5Rm9yT2JqZWN0KG9wdGlvbixzZXR0aW5ncy5pZFByb3ApKSAmJiBzZXR0aW5ncy5zdHlsZUFjdGl2ZX1cIiBuZy1yZXBlYXQtZW5kIHJvbGU9XCJwcmVzZW50YXRpb25cIj4nO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgdGVtcGxhdGUgKz0gJzxsaSBuZy1jbGFzcz1cIntcXCdhY3RpdmVcXCc6IGlzQ2hlY2tlZChnZXRQcm9wZXJ0eUZvck9iamVjdChvcHRpb24sc2V0dGluZ3MuaWRQcm9wKSkgJiYgc2V0dGluZ3Muc3R5bGVBY3RpdmV9XCIgcm9sZT1cInByZXNlbnRhdGlvblwiIG5nLXJlcGVhdD1cIm9wdGlvbiBpbiBvcHRpb25zIHwgZmlsdGVyOmdldEZpbHRlcihpbnB1dC5zZWFyY2hGaWx0ZXIpXCI+JztcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgdGVtcGxhdGUgKz0gJzxhIG5nLWtleWRvd249XCJvcHRpb24uZGlzYWJsZWQgfHwga2V5RG93bkxpbmsoJGV2ZW50KVwiIHJvbGU9XCJtZW51aXRlbVwiIGNsYXNzPVwib3B0aW9uXCIgdGFiaW5kZXg9XCItMVwiIG5nLWNsaWNrPVwib3B0aW9uLmRpc2FibGVkIHx8IHNldFNlbGVjdGVkSXRlbShnZXRQcm9wZXJ0eUZvck9iamVjdChvcHRpb24sc2V0dGluZ3MuaWRQcm9wKSwgZmFsc2UsIHRydWUpXCIgbmctZGlzYWJsZWQ9XCJvcHRpb24uZGlzYWJsZWRcIj4nO1xyXG5cclxuICAgICAgICAgICAgaWYgKGNoZWNrYm94ZXMpIHtcclxuICAgICAgICAgICAgICAgIHRlbXBsYXRlICs9ICc8ZGl2ID48bGFiZWw+PGlucHV0IGNsYXNzPVwiY2hlY2tib3hJbnB1dFwiIHR5cGU9XCJjaGVja2JveFwiIG5nLWNsaWNrPVwiY2hlY2tib3hDbGljaygkZXZlbnQsIGdldFByb3BlcnR5Rm9yT2JqZWN0KG9wdGlvbixzZXR0aW5ncy5pZFByb3ApKVwiIG5nLWNoZWNrZWQ9XCJpc0NoZWNrZWQoZ2V0UHJvcGVydHlGb3JPYmplY3Qob3B0aW9uLHNldHRpbmdzLmlkUHJvcCkpXCIgLz4gPHNwYW4gbWYtZHJvcGRvd24tc3RhdGljLWluY2x1ZGU9XCJ7e3NldHRpbmdzLnRlbXBsYXRlfX1cIj48L2Rpdj48L2xhYmVsPjwvc3Bhbj48L2E+JztcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIHRlbXBsYXRlICs9ICc8c3BhbiBkYXRhLW5nLWNsYXNzPVwie1xcJ2dseXBoaWNvbiBnbHlwaGljb24tb2tcXCc6IGlzQ2hlY2tlZChnZXRQcm9wZXJ0eUZvck9iamVjdChvcHRpb24sc2V0dGluZ3MuaWRQcm9wKSl9XCI+IDwvc3Bhbj4gPHNwYW4gbWYtZHJvcGRvd24tc3RhdGljLWluY2x1ZGU9XCJ7e3NldHRpbmdzLnRlbXBsYXRlfX1cIj48L3NwYW4+PC9hPic7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIHRlbXBsYXRlICs9ICc8L2xpPic7XHJcblxyXG4gICAgICAgICAgICB0ZW1wbGF0ZSArPSAnPGxpIGNsYXNzPVwiZGl2aWRlclwiIG5nLXNob3c9XCJzZXR0aW5ncy5zZWxlY3Rpb25MaW1pdCA+IDFcIj48L2xpPic7XHJcbiAgICAgICAgICAgIHRlbXBsYXRlICs9ICc8bGkgcm9sZT1cInByZXNlbnRhdGlvblwiIG5nLXNob3c9XCJzZXR0aW5ncy5zZWxlY3Rpb25MaW1pdCA+IDFcIj48YSByb2xlPVwibWVudWl0ZW1cIj57e3NlbGVjdGVkTW9kZWwubGVuZ3RofX0ge3t0ZXh0cy5zZWxlY3Rpb25PZn19IHt7c2V0dGluZ3Muc2VsZWN0aW9uTGltaXR9fSB7e3RleHRzLnNlbGVjdGlvbkNvdW50fX08L2E+PC9saT4nO1xyXG5cclxuICAgICAgICAgICAgdGVtcGxhdGUgKz0gJzwvdWw+JztcclxuICAgICAgICAgICAgdGVtcGxhdGUgKz0gJzwvZGl2Pic7XHJcbiAgICAgICAgICAgIC8vdGVtcGxhdGUgKz0gJzxkaXYgbmFtZT1cInt7JHBhcmVudC5pdGVtLmtleX19XCIgY2xhc3M9XCJlcnJvci1tZXNzYWdlcyBlcnJvci1tYXJnaW4gbmctYWN0aXZlXCIgc3R5bGU9XCJjbGVhcjpib3RoXCIgbmctaWY9XCJzZWxlY3RlZE1vZGVsLmxlbmd0aDwxICYmIHNob3dUZXh0XCIgbmctaWY9XCIkcGFyZW50Lml0ZW0uc2hvd01lc3NhZ2VcIiA+JztcclxuICAgICAgICAgICAgLy90ZW1wbGF0ZSArPSAnPGRpdiBuZy1zdHlsZT1cInt3aWR0aDogKCRwYXJlbnQuaXRlbS50ZW1wbGF0ZU9wdGlvbnMucmVxdWlyZWRNZXNzYWdlLmxlbmd0aCo3KStcXCdweFxcJ31cIiBuZy1pZj1cInNlbGVjdGVkTW9kZWwubGVuZ3RoPDEgJiYgc2hvd1RleHRcIiA+e3tzZXR0aW5ncy5pbnZhbGlkTWVzc2FnZXx8IFxcJ1Nob3VsZG5cXFxcXFwndCBiZSBlbXB0eS4uLlxcJ319PC9kaXY+J1xyXG4gICAgICAgICAgICAvL3RlbXBsYXRlICs9ICc8L2Rpdj4nO1xyXG5cclxuICAgICAgICAgICAgZWxlbWVudC5odG1sKHRlbXBsYXRlKTtcclxuICAgICAgICB9LFxyXG4gICAgICAgIGxpbms6IGZ1bmN0aW9uICgkc2NvcGUsICRlbGVtZW50LCAkYXR0cnMpIHtcclxuICAgICAgICAgICAgdmFyICRkcm9wZG93blRyaWdnZXIgPSAkZWxlbWVudC5jaGlsZHJlbigpWzBdO1xyXG4gICAgICAgICAgICAkc2NvcGUuc2VsZWN0ZWRNb2RlbCA9PSB1bmRlZmluZWQgPyBbXSA6ICRzY29wZS5zZWxlY3RlZE1vZGVsO1xyXG4gICAgICAgICAgICAkc2NvcGUudG9nZ2xlRHJvcGRvd24gPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoJHNjb3BlLm9wZW4pIHtcclxuICAgICAgICAgICAgICAgICAgICAkc2NvcGUuY2xvc2UoKVxyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHsgJHNjb3BlLm9wZW4gPSB0cnVlIH1cclxuICAgICAgICAgICAgICAgIGlmICgkc2NvcGUuc2V0dGluZ3Mua2V5Ym9hcmRDb250cm9scykge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmICgkc2NvcGUub3Blbikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoJHNjb3BlLnNldHRpbmdzLnNlbGVjdGlvbkxpbWl0ID09PSAxICYmICRzY29wZS5zZXR0aW5ncy5lbmFibGVTZWFyY2gpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFuZ3VsYXIuZWxlbWVudCgkZWxlbWVudClbMF0ucXVlcnlTZWxlY3RvcignLnNlYXJjaEZpZWxkJykuZm9jdXMoKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sIDApO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYW5ndWxhci5lbGVtZW50KCRlbGVtZW50KVswXS5xdWVyeVNlbGVjdG9yKCcub3B0aW9uJykuZm9jdXMoKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sIDApO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICAkc2NvcGUuc2hvd1RleHQgPSBmYWxzZTtcclxuICAgICAgICAgICAgJHNjb3BlLmNoZWNrYm94Q2xpY2sgPSBmdW5jdGlvbiAoJGV2ZW50LCBpZCkge1xyXG5cclxuICAgICAgICAgICAgICAgICRzY29wZS5zZXRTZWxlY3RlZEl0ZW0oaWQsIGZhbHNlLCB0cnVlKTtcclxuICAgICAgICAgICAgICAgICRldmVudC5zdG9wSW1tZWRpYXRlUHJvcGFnYXRpb24oKTtcclxuICAgICAgICAgICAgfTtcclxuXHJcbiAgICAgICAgICAgICRzY29wZS5leHRlcm5hbEV2ZW50cyA9IHtcclxuICAgICAgICAgICAgICAgIG9uSXRlbVNlbGVjdDogYW5ndWxhci5ub29wLFxyXG4gICAgICAgICAgICAgICAgb25JdGVtRGVzZWxlY3Q6IGFuZ3VsYXIubm9vcCxcclxuICAgICAgICAgICAgICAgIG9uU2VsZWN0QWxsOiBhbmd1bGFyLm5vb3AsXHJcbiAgICAgICAgICAgICAgICBvbkRlc2VsZWN0QWxsOiBhbmd1bGFyLm5vb3AsXHJcbiAgICAgICAgICAgICAgICBvbkluaXREb25lOiBhbmd1bGFyLm5vb3AsXHJcbiAgICAgICAgICAgICAgICBvbk1heFNlbGVjdGlvblJlYWNoZWQ6IGFuZ3VsYXIubm9vcCxcclxuICAgICAgICAgICAgICAgIG9uU2VsZWN0aW9uQ2hhbmdlZDogYW5ndWxhci5ub29wLFxyXG4gICAgICAgICAgICAgICAgb25DbG9zZTogYW5ndWxhci5ub29wXHJcbiAgICAgICAgICAgIH07XHJcblxyXG4gICAgICAgICAgICAkc2NvcGUuc2V0dGluZ3MgPSB7XHJcbiAgICAgICAgICAgICAgICBkeW5hbWljVGl0bGU6IHRydWUsXHJcbiAgICAgICAgICAgICAgICBzY3JvbGxhYmxlOiBmYWxzZSxcclxuICAgICAgICAgICAgICAgIHNjcm9sbGFibGVIZWlnaHQ6ICcyNTBweCcsXHJcbiAgICAgICAgICAgICAgICBjbG9zZU9uQmx1cjogdHJ1ZSxcclxuICAgICAgICAgICAgICAgIGlzQ3VzdG9tRm9ybWF0OiAkc2NvcGUucGFyZW50TGlzdC5zZWxlY3RPcHRpb25zLmlzQ3VzdG9tRm9ybWF0LFxyXG4gICAgICAgICAgICAgICAgZGlzcGxheVByb3A6ICRzY29wZS5wYXJlbnRMaXN0LnNlbGVjdE9wdGlvbnMuaXRlbS5kaXNwbGF5RmllbGQsXHJcbiAgICAgICAgICAgICAgICBzZWNvbmREaXNwbGF5UHJvcDogJHNjb3BlLnBhcmVudExpc3Quc2VsZWN0T3B0aW9ucy5pdGVtLnNlY29uZERpc3BsYXlGaWVsZCxcclxuICAgICAgICAgICAgICAgIGlkUHJvcDogJHNjb3BlLnBhcmVudExpc3Quc2VsZWN0T3B0aW9ucy5pdGVtLmRhdGFGaWVsZCxcclxuICAgICAgICAgICAgICAgIGV4dGVybmFsSWRQcm9wOiAkc2NvcGUucGFyZW50TGlzdC5zZWxlY3RPcHRpb25zLml0ZW0uZGF0YUZpZWxkLFxyXG4gICAgICAgICAgICAgICAgaW52YWxpZE1lc3NhZ2U6ICRzY29wZS4kcGFyZW50Lml0ZW0udGVtcGxhdGVPcHRpb25zLnJlcXVpcmVkTWVzc2FnZSxcclxuICAgICAgICAgICAgICAgIGVuYWJsZVNlYXJjaDogZmFsc2UsXHJcbiAgICAgICAgICAgICAgICBzZWxlY3Rpb25MaW1pdDogMCxcclxuICAgICAgICAgICAgICAgIHNob3dDaGVja0FsbDogdHJ1ZSxcclxuICAgICAgICAgICAgICAgIHNob3dVbmNoZWNrQWxsOiB0cnVlLFxyXG4gICAgICAgICAgICAgICAgc2hvd0VuYWJsZVNlYXJjaEJ1dHRvbjogZmFsc2UsXHJcbiAgICAgICAgICAgICAgICBjbG9zZU9uU2VsZWN0OiBmYWxzZSxcclxuICAgICAgICAgICAgICAgIGJ1dHRvbkNsYXNzZXM6ICdidG4gYnRuLWRlZmF1bHQnLFxyXG4gICAgICAgICAgICAgICAgY2xvc2VPbkRlc2VsZWN0OiBmYWxzZSxcclxuICAgICAgICAgICAgICAgIGdyb3VwQnk6ICRhdHRycy5ncm91cEJ5IHx8IHVuZGVmaW5lZCxcclxuICAgICAgICAgICAgICAgIGdyb3VwQnlUZXh0UHJvdmlkZXI6IG51bGwsXHJcbiAgICAgICAgICAgICAgICBzbWFydEJ1dHRvbk1heEl0ZW1zOiA3LFxyXG4gICAgICAgICAgICAgICAgc21hcnRCdXR0b25UZXh0Q29udmVydGVyOiBhbmd1bGFyLm5vb3AsXHJcbiAgICAgICAgICAgICAgICBzdHlsZUFjdGl2ZTogZmFsc2UsXHJcbiAgICAgICAgICAgICAgICBrZXlib2FyZENvbnRyb2xzOiBmYWxzZSxcclxuICAgICAgICAgICAgICAgIHRlbXBsYXRlOiAne3tnZXRQcm9wZXJ0eUZvck9iamVjdChvcHRpb24sIHNldHRpbmdzLmRpc3BsYXlQcm9wKX19JyxcclxuICAgICAgICAgICAgICAgIHNlYXJjaEZpZWxkOiAnJCdcclxuICAgICAgICAgICAgfTtcclxuXHJcbiAgICAgICAgICAgICRzY29wZS50ZXh0cyA9IHtcclxuICAgICAgICAgICAgICAgIGNoZWNrQWxsOiAnQ2hlY2sgQWxsJyxcclxuICAgICAgICAgICAgICAgIHVuY2hlY2tBbGw6ICdVbmNoZWNrIEFsbCcsXHJcbiAgICAgICAgICAgICAgICBzZWxlY3Rpb25Db3VudDogJ2NoZWNrZWQnLFxyXG4gICAgICAgICAgICAgICAgc2VsZWN0aW9uT2Y6ICcvJyxcclxuICAgICAgICAgICAgICAgIHNlYXJjaFBsYWNlaG9sZGVyOiAnU2VhcmNoLi4uJyxcclxuICAgICAgICAgICAgICAgIGJ1dHRvbkRlZmF1bHRUZXh0OiAnU2VsZWN0JyxcclxuICAgICAgICAgICAgICAgIGR5bmFtaWNCdXR0b25UZXh0U3VmZml4OiAnY2hlY2tlZCcsXHJcbiAgICAgICAgICAgICAgICBkaXNhYmxlU2VhcmNoOiAnRGlzYWJsZSBzZWFyY2gnLFxyXG4gICAgICAgICAgICAgICAgZW5hYmxlU2VhcmNoOiAnRW5hYmxlIHNlYXJjaCcsXHJcbiAgICAgICAgICAgICAgICBzZWxlY3RHcm91cDogJ1NlbGVjdCBhbGw6JyxcclxuICAgICAgICAgICAgICAgIG5hbWU6ICRzY29wZS5wYXJlbnRMaXN0Lm5hbWVcclxuICAgICAgICAgICAgfTtcclxuXHJcbiAgICAgICAgICAgICRzY29wZS5pbnB1dCA9IHtcclxuICAgICAgICAgICAgICAgIHNlYXJjaEZpbHRlcjogJHNjb3BlLnNlYXJjaEZpbHRlciB8fCAnJ1xyXG4gICAgICAgICAgICB9O1xyXG5cclxuICAgICAgICAgICAgaWYgKGFuZ3VsYXIuaXNEZWZpbmVkKCRzY29wZS5zZXR0aW5ncy5ncm91cEJ5KSkge1xyXG4gICAgICAgICAgICAgICAgJHNjb3BlLiR3YXRjaCgnb3B0aW9ucycsIGZ1bmN0aW9uIChuZXdWYWx1ZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChhbmd1bGFyLmlzRGVmaW5lZChuZXdWYWx1ZSkpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgJHNjb3BlLm9yZGVyZWRJdGVtcyA9ICRmaWx0ZXIoJ29yZGVyQnknKShuZXdWYWx1ZSwgJHNjb3BlLnNldHRpbmdzLmdyb3VwQnkpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAkc2NvcGUuJHdhdGNoKCdzZWxlY3RlZE1vZGVsJywgZnVuY3Rpb24gKG5ld1ZhbHVlKSB7XHJcbiAgICAgICAgICAgICAgICAvL2lmKG5ld1ZhbHVlID09PSB1bmRlZmluZWQgfHwgbmV3VmFsdWUgPT09IFwiXCIpIG5ld1ZhbHVlID0gW107XHJcbiAgICAgICAgICAgICAgICBpZiAoIUFycmF5LmlzQXJyYXkobmV3VmFsdWUpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgJHNjb3BlLnNpbmdsZVNlbGVjdGlvbiA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICRzY29wZS5zaW5nbGVTZWxlY3Rpb24gPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICAkc2NvcGUuJHdhdGNoKCckcGFyZW50Lml0ZW0uc2hvd01lc3NhZ2UnLCBmdW5jdGlvbiAob2xkVmFsdWUsIG5ld1ZhbHVlKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAob2xkVmFsdWUpIHtcclxuICAgICAgICAgICAgICAgICAgICAkc2NvcGUuc2hvd1RleHQgPSBvbGRWYWx1ZTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICRzY29wZS5zaG93VGV4dCA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgICRzY29wZS5jbG9zZSA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgICRzY29wZS5vcGVuID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICAkc2NvcGUuZXh0ZXJuYWxFdmVudHMub25DbG9zZSgpO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAkc2NvcGUuc2VsZWN0Q3VycmVudEdyb3VwID0gZnVuY3Rpb24gKGN1cnJlbnRHcm91cCkge1xyXG4gICAgICAgICAgICAgICAgJHNjb3BlLnNlbGVjdGVkTW9kZWwuc3BsaWNlKDAsICRzY29wZS5zZWxlY3RlZE1vZGVsLmxlbmd0aCk7XHJcbiAgICAgICAgICAgICAgICBpZiAoJHNjb3BlLm9yZGVyZWRJdGVtcykge1xyXG4gICAgICAgICAgICAgICAgICAgICRzY29wZS5vcmRlcmVkSXRlbXMuZm9yRWFjaChmdW5jdGlvbiAoaXRlbSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoaXRlbVskc2NvcGUuZ3JvdXBCeV0gPT09IGN1cnJlbnRHcm91cCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJHNjb3BlLnNldFNlbGVjdGVkSXRlbSgkc2NvcGUuZ2V0UHJvcGVydHlGb3JPYmplY3QoaXRlbSwgJHNjb3BlLnNldHRpbmdzLmlkUHJvcCksIGZhbHNlLCBmYWxzZSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgJHNjb3BlLmV4dGVybmFsRXZlbnRzLm9uU2VsZWN0aW9uQ2hhbmdlZCgpO1xyXG4gICAgICAgICAgICB9O1xyXG5cclxuICAgICAgICAgICAgYW5ndWxhci5leHRlbmQoJHNjb3BlLnNldHRpbmdzLCAkc2NvcGUuZXh0cmFTZXR0aW5ncyB8fCBbXSk7XHJcbiAgICAgICAgICAgIGFuZ3VsYXIuZXh0ZW5kKCRzY29wZS5leHRlcm5hbEV2ZW50cywgJHNjb3BlLmV2ZW50cyB8fCBbXSk7XHJcbiAgICAgICAgICAgIGFuZ3VsYXIuZXh0ZW5kKCRzY29wZS50ZXh0cywgJHNjb3BlLnRyYW5zbGF0aW9uVGV4dHMpO1xyXG5cclxuICAgICAgICAgICAgJHNjb3BlLnNpbmdsZVNlbGVjdGlvbiA9ICRzY29wZS5zZXR0aW5ncy5zZWxlY3Rpb25MaW1pdCA9PT0gMTtcclxuXHJcbiAgICAgICAgICAgIGZ1bmN0aW9uIGdldEZpbmRPYmooaWQpIHtcclxuICAgICAgICAgICAgICAgIHZhciBmaW5kT2JqID0ge307XHJcblxyXG4gICAgICAgICAgICAgICAgLy9pZiAoJHNjb3BlLnNldHRpbmdzLmV4dGVybmFsSWRQcm9wID09PSAnJykge1xyXG4gICAgICAgICAgICAgICAgLy8gICAgZmluZE9ialskc2NvcGUuc2V0dGluZ3MuaWRQcm9wXSA9IGlkO1xyXG4gICAgICAgICAgICAgICAgLy99IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgLy8gICAgZmluZE9ialskc2NvcGUuc2V0dGluZ3MuZXh0ZXJuYWxJZFByb3BdID0gaWQ7XHJcbiAgICAgICAgICAgICAgICAvL31cclxuXHJcbiAgICAgICAgICAgICAgICAkLmVhY2goJHNjb3BlLnBhcmVudExpc3Quc2VsZWN0T3B0aW9ucy5pdGVtcywgZnVuY3Rpb24gKGluZGV4LCB2YWx1ZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmICh2YWx1ZVskc2NvcGUuc2V0dGluZ3MuZXh0ZXJuYWxJZFByb3BdID09IGlkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGZpbmRPYmogPSB2YWx1ZTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9KVxyXG5cclxuICAgICAgICAgICAgICAgIHJldHVybiBmaW5kT2JqO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBmdW5jdGlvbiBjbGVhck9iamVjdChvYmplY3QpIHtcclxuICAgICAgICAgICAgICAgIGlmIChvYmplY3QgPT0gXCJcIiB8fCBvYmplY3QgPT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgJHNjb3BlLnNlbGVjdGVkTW9kZWwgPSBbXTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGZvciAodmFyIHByb3AgaW4gb2JqZWN0KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgZGVsZXRlIG9iamVjdFtwcm9wXTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgaWYgKCRzY29wZS5zaW5nbGVTZWxlY3Rpb24pIHtcclxuICAgICAgICAgICAgICAgIGlmIChhbmd1bGFyLmlzQXJyYXkoJHNjb3BlLnNlbGVjdGVkTW9kZWwpICYmICRzY29wZS5zZWxlY3RlZE1vZGVsLmxlbmd0aCA9PT0gMCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGNsZWFyT2JqZWN0KCRzY29wZS5zZWxlY3RlZE1vZGVsKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgaWYgKCRzY29wZS5zZXR0aW5ncy5jbG9zZU9uQmx1cikge1xyXG4gICAgICAgICAgICAgICAgJGRvY3VtZW50Lm9uKCdjbGljaycsIGZ1bmN0aW9uIChlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKCRzY29wZS5vcGVuKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciB0YXJnZXQgPSBlLnRhcmdldC5wYXJlbnRFbGVtZW50O1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgcGFyZW50Rm91bmQgPSBmYWxzZTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHdoaWxlIChhbmd1bGFyLmlzRGVmaW5lZCh0YXJnZXQpICYmIHRhcmdldCAhPT0gbnVsbCAmJiAhcGFyZW50Rm91bmQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICghIXRhcmdldC5jbGFzc05hbWUuc3BsaXQgJiYgY29udGFpbnModGFyZ2V0LmNsYXNzTmFtZS5zcGxpdCgnICcpLCAnbXVsdGlzZWxlY3QtcGFyZW50JykgJiYgIXBhcmVudEZvdW5kKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRhcmdldCA9PT0gJGRyb3Bkb3duVHJpZ2dlcikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYXJlbnRGb3VuZCA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGFyZ2V0ID0gdGFyZ2V0LnBhcmVudEVsZW1lbnQ7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICghcGFyZW50Rm91bmQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICRzY29wZS4kYXBwbHkoZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRzY29wZS5jbG9zZSgpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgJHNjb3BlLmdldEdyb3VwTGFiZWwgPSBmdW5jdGlvbiAoZ3JvdXBWYWx1ZSkge1xyXG4gICAgICAgICAgICAgICAgaWYgKCRzY29wZS5zZXR0aW5ncy5ncm91cEJ5VGV4dFByb3ZpZGVyICE9PSBudWxsKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRzY29wZS5zZXR0aW5ncy5ncm91cEJ5VGV4dFByb3ZpZGVyKGdyb3VwVmFsdWUpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIHJldHVybiBncm91cFZhbHVlO1xyXG4gICAgICAgICAgICB9O1xyXG5cclxuICAgICAgICAgICAgJHNjb3BlLmdldEJ1dHRvblRleHQgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoJHNjb3BlLnNlbGVjdGVkTW9kZWwgIT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKCRzY29wZS5zZXR0aW5ncy5keW5hbWljVGl0bGUgJiYgKCRzY29wZS5zZWxlY3RlZE1vZGVsLmxlbmd0aCA+IDAgfHwgKGFuZ3VsYXIuaXNPYmplY3QoJHNjb3BlLnNlbGVjdGVkTW9kZWwpICYmIE9iamVjdC5rZXlzKCRzY29wZS5zZWxlY3RlZE1vZGVsKS5sZW5ndGggPiAwKSkpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCRzY29wZS5zZXR0aW5ncy5zbWFydEJ1dHRvbk1heEl0ZW1zID4gMCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGl0ZW1zVGV4dCA9IFtdO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFuZ3VsYXIuZm9yRWFjaCgkc2NvcGUub3B0aW9ucywgZnVuY3Rpb24gKG9wdGlvbkl0ZW0pIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoJHNjb3BlLmlzQ2hlY2tlZCgkc2NvcGUuZ2V0UHJvcGVydHlGb3JPYmplY3Qob3B0aW9uSXRlbSwgJHNjb3BlLnNldHRpbmdzLmlkUHJvcCkpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBkaXNwbGF5VGV4dCA9ICRzY29wZS5nZXRQcm9wZXJ0eUZvck9iamVjdChvcHRpb25JdGVtLCAkc2NvcGUuc2V0dGluZ3MuZGlzcGxheVByb3ApO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoJHNjb3BlLnNldHRpbmdzLnNlY29uZERpc3BsYXlQcm9wICE9PSB1bmRlZmluZWQgJiYgJHNjb3BlLnNldHRpbmdzLnNlY29uZERpc3BsYXlQcm9wICE9PSBudWxsICYmICRzY29wZS5zZXR0aW5ncy5zZWNvbmREaXNwbGF5UHJvcCAhPT0gXCJcIilcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRpc3BsYXlUZXh0ICs9IFwiIC8gXCIgKyAgJHNjb3BlLmdldFByb3BlcnR5Rm9yT2JqZWN0KG9wdGlvbkl0ZW0sICRzY29wZS5zZXR0aW5ncy5zZWNvbmREaXNwbGF5UHJvcCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBjb252ZXJ0ZXJSZXNwb25zZSA9ICRzY29wZS5zZXR0aW5ncy5zbWFydEJ1dHRvblRleHRDb252ZXJ0ZXIoZGlzcGxheVRleHQsIG9wdGlvbkl0ZW0pO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaXRlbXNUZXh0LnB1c2goY29udmVydGVyUmVzcG9uc2UgPyBjb252ZXJ0ZXJSZXNwb25zZSA6IGRpc3BsYXlUZXh0KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoJHNjb3BlLnNlbGVjdGVkTW9kZWwubGVuZ3RoID4gJHNjb3BlLnNldHRpbmdzLnNtYXJ0QnV0dG9uTWF4SXRlbXMpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpdGVtc1RleHQgPSBpdGVtc1RleHQuc2xpY2UoMCwgJHNjb3BlLnNldHRpbmdzLnNtYXJ0QnV0dG9uTWF4SXRlbXMpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGl0ZW1zVGV4dC5wdXNoKCcuLi4nKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gaXRlbXNUZXh0LmpvaW4oJywgJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgdG90YWxTZWxlY3RlZDtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoJHNjb3BlLnNpbmdsZVNlbGVjdGlvbikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRvdGFsU2VsZWN0ZWQgPSAoJHNjb3BlLnNlbGVjdGVkTW9kZWwgIT09IG51bGwgJiYgYW5ndWxhci5pc0RlZmluZWQoJHNjb3BlLnNlbGVjdGVkTW9kZWxbJHNjb3BlLnNldHRpbmdzLmlkUHJvcF0pKSA/IDEgOiAwO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b3RhbFNlbGVjdGVkID0gYW5ndWxhci5pc0RlZmluZWQoJHNjb3BlLnNlbGVjdGVkTW9kZWwpID8gJHNjb3BlLnNlbGVjdGVkTW9kZWwubGVuZ3RoIDogMDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodG90YWxTZWxlY3RlZCA9PT0gMCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAkc2NvcGUudGV4dHMuYnV0dG9uRGVmYXVsdFRleHQ7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB0b3RhbFNlbGVjdGVkICsgJyAnICsgJHNjb3BlLnRleHRzLmR5bmFtaWNCdXR0b25UZXh0U3VmZml4O1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRzY29wZS50ZXh0cy5idXR0b25EZWZhdWx0VGV4dDtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH07XHJcblxyXG4gICAgICAgICAgICAkc2NvcGUuZ2V0UHJvcGVydHlGb3JPYmplY3QgPSBmdW5jdGlvbiAob2JqZWN0LCBwcm9wZXJ0eSkge1xyXG4gICAgICAgICAgICAgICAgaWYgKGFuZ3VsYXIuaXNEZWZpbmVkKG9iamVjdCkgJiYgb2JqZWN0Lmhhc093blByb3BlcnR5KHByb3BlcnR5KSkge1xyXG4gICAgICAgICAgICAgICAgICAgIC8vICAkc2NvcGUuc2luZ2xlU2VsZWN0aW9uID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gb2JqZWN0W3Byb3BlcnR5XTtcclxuXHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAvLyAgJHNjb3BlLnNpbmdsZVNlbGVjdGlvbiA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHVuZGVmaW5lZDtcclxuICAgICAgICAgICAgfTtcclxuXHJcbiAgICAgICAgICAgICRzY29wZS5zZWxlY3RBbGwgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgc2VhcmNoUmVzdWx0O1xyXG4gICAgICAgICAgICAgICAgJHNjb3BlLmRlc2VsZWN0QWxsKHRydWUpO1xyXG4gICAgICAgICAgICAgICAgJHNjb3BlLmV4dGVybmFsRXZlbnRzLm9uU2VsZWN0QWxsKCk7XHJcblxyXG4gICAgICAgICAgICAgICAgc2VhcmNoUmVzdWx0ID0gJGZpbHRlcignZmlsdGVyJykoJHNjb3BlLm9wdGlvbnMsICRzY29wZS5nZXRGaWx0ZXIoJHNjb3BlLmlucHV0LnNlYXJjaEZpbHRlcikpO1xyXG4gICAgICAgICAgICAgICAgYW5ndWxhci5mb3JFYWNoKHNlYXJjaFJlc3VsdCwgZnVuY3Rpb24gKHZhbHVlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgJHNjb3BlLnNldFNlbGVjdGVkSXRlbSh2YWx1ZVskc2NvcGUuc2V0dGluZ3MuaWRQcm9wXSwgdHJ1ZSwgZmFsc2UpO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICAkc2NvcGUuZXh0ZXJuYWxFdmVudHMub25TZWxlY3Rpb25DaGFuZ2VkKCk7XHJcbiAgICAgICAgICAgICAgICAkc2NvcGUuc2VsZWN0ZWRHcm91cCA9IG51bGw7XHJcbiAgICAgICAgICAgIH07XHJcblxyXG4gICAgICAgICAgICAkc2NvcGUuZGVzZWxlY3RBbGwgPSBmdW5jdGlvbiAoZG9udFNlbmRFdmVudCkge1xyXG4gICAgICAgICAgICAgICAgZG9udFNlbmRFdmVudCA9IGRvbnRTZW5kRXZlbnQgfHwgZmFsc2U7XHJcblxyXG4gICAgICAgICAgICAgICAgaWYgKCFkb250U2VuZEV2ZW50KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgJHNjb3BlLmV4dGVybmFsRXZlbnRzLm9uRGVzZWxlY3RBbGwoKTtcclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICBpZiAoJHNjb3BlLnNpbmdsZVNlbGVjdGlvbikge1xyXG4gICAgICAgICAgICAgICAgICAgIGNsZWFyT2JqZWN0KCRzY29wZS5zZWxlY3RlZE1vZGVsKTtcclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgLy8kc2NvcGUuc2VsZWN0ZWRNb2RlbC5zcGxpY2UoMCwgJHNjb3BlLnNlbGVjdGVkTW9kZWwubGVuZ3RoKTtcclxuICAgICAgICAgICAgICAgICAgICAkc2NvcGUuc2VsZWN0ZWRNb2RlbCA9IFtdO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgaWYgKCFkb250U2VuZEV2ZW50KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgJHNjb3BlLmV4dGVybmFsRXZlbnRzLm9uU2VsZWN0aW9uQ2hhbmdlZCgpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgJHNjb3BlLnNlbGVjdGVkR3JvdXAgPSBudWxsO1xyXG4gICAgICAgICAgICAgICAgJHNjb3BlLnNlbGVjdGVkTW9kZWwgPSAkc2NvcGUuc2VsZWN0ZWRNb2RlbDtcclxuICAgICAgICAgICAgfTtcclxuXHJcbiAgICAgICAgICAgICRzY29wZS5zZXRTZWxlY3RlZEl0ZW0gPSBmdW5jdGlvbiAoaWQsIGRvbnRSZW1vdmUsIGZpcmVTZWxlY3Rpb25DaGFuZ2UpIHtcclxuICAgICAgICAgICAgICAgICRzY29wZS5zZWxlY3RlZE1vZGVsID0gICgoJHNjb3BlLnNlbGVjdGVkTW9kZWwgPT09IHVuZGVmaW5lZCB8fCAkc2NvcGUuc2VsZWN0ZWRNb2RlbCA9PT0gXCJcIikgPyBbXSA6ICRzY29wZS5zZWxlY3RlZE1vZGVsKTtcclxuICAgICAgICAgICAgICAgIHZhciBmaW5kT2JqID0gZ2V0RmluZE9iaihpZCk7XHJcbiAgICAgICAgICAgICAgICB2YXIgZmluYWxPYmogPSBudWxsO1xyXG5cclxuICAgICAgICAgICAgICAgIGlmICgkc2NvcGUuc2V0dGluZ3MuZXh0ZXJuYWxJZFByb3AgPT09ICcnKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgZmluYWxPYmogPSBmaW5kKCRzY29wZS5vcHRpb25zLCBmaW5kT2JqKTtcclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgZmluYWxPYmogPSBmaW5kT2JqO1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIGlmICgkc2NvcGUuc2luZ2xlU2VsZWN0aW9uKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgY2xlYXJPYmplY3QoJHNjb3BlLnNlbGVjdGVkTW9kZWwpO1xyXG4gICAgICAgICAgICAgICAgICAgIGFuZ3VsYXIuZXh0ZW5kKCRzY29wZS5zZWxlY3RlZE1vZGVsLCBmaW5hbE9iaik7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGZpcmVTZWxlY3Rpb25DaGFuZ2UpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgJHNjb3BlLmV4dGVybmFsRXZlbnRzLm9uSXRlbVNlbGVjdChmaW5hbE9iaik7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIGlmICgkc2NvcGUuc2V0dGluZ3MuY2xvc2VPblNlbGVjdCB8fCAkc2NvcGUuc2V0dGluZ3MuY2xvc2VPbkRlc2VsZWN0KSAkc2NvcGUuY2xvc2UoKTtcclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgZG9udFJlbW92ZSA9IGRvbnRSZW1vdmUgfHwgZmFsc2U7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKCRzY29wZS5zZWxlY3RlZE1vZGVsID09IFwiXCIpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgJHNjb3BlLnNlbGVjdGVkTW9kZWwgPSBbXTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIHZhciBleGlzdHMgPSBmaW5kSW5kZXgoJHNjb3BlLnNlbGVjdGVkTW9kZWwsIGZpbmRPYmopICE9PSAtMTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKCFkb250UmVtb3ZlICYmIGV4aXN0cykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAkc2NvcGUuc2VsZWN0ZWRNb2RlbC5zcGxpY2UoZmluZEluZGV4KCRzY29wZS5zZWxlY3RlZE1vZGVsLCBmaW5kT2JqKSwgMSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICgkc2NvcGUuc2VsZWN0ZWRNb2RlbC5sZW5ndGggPT0gMCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJHNjb3BlLnNlbGVjdGVkTW9kZWwgPSBbXTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAkc2NvcGUuZXh0ZXJuYWxFdmVudHMub25JdGVtRGVzZWxlY3QoZmluZE9iaik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICgkc2NvcGUuc2V0dGluZ3MuY2xvc2VPbkRlc2VsZWN0KSAkc2NvcGUuY2xvc2UoKTtcclxuICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKCFleGlzdHMgJiYgKCRzY29wZS5zZXR0aW5ncy5zZWxlY3Rpb25MaW1pdCA9PT0gMCB8fCAkc2NvcGUuc2VsZWN0ZWRNb2RlbC5sZW5ndGggPCAkc2NvcGUuc2V0dGluZ3Muc2VsZWN0aW9uTGltaXQpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICghZXhpc3RzKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJHNjb3BlLnNlbGVjdGVkTW9kZWwucHVzaChmaW5hbE9iaik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChmaXJlU2VsZWN0aW9uQ2hhbmdlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkc2NvcGUuZXh0ZXJuYWxFdmVudHMub25JdGVtU2VsZWN0KGZpbmFsT2JqKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoJHNjb3BlLnNldHRpbmdzLmNsb3NlT25TZWxlY3QpICRzY29wZS5jbG9zZSgpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoJHNjb3BlLnNldHRpbmdzLnNlbGVjdGlvbkxpbWl0ID4gMCAmJiAkc2NvcGUuc2VsZWN0ZWRNb2RlbC5sZW5ndGggPT09ICRzY29wZS5zZXR0aW5ncy5zZWxlY3Rpb25MaW1pdCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJHNjb3BlLmV4dGVybmFsRXZlbnRzLm9uTWF4U2VsZWN0aW9uUmVhY2hlZCgpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgaWYgKGZpcmVTZWxlY3Rpb25DaGFuZ2UpIHtcclxuICAgICAgICAgICAgICAgICAgICAkc2NvcGUuZXh0ZXJuYWxFdmVudHMub25TZWxlY3Rpb25DaGFuZ2VkKCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAkc2NvcGUuc2VsZWN0ZWRHcm91cCA9IG51bGw7XHJcbiAgICAgICAgICAgIH07XHJcblxyXG4gICAgICAgICAgICAkc2NvcGUuaXNDaGVja2VkID0gZnVuY3Rpb24gKGlkKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoJHNjb3BlLnNlbGVjdGVkTW9kZWwgIT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKCRzY29wZS5zaW5nbGVTZWxlY3Rpb24pIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRzY29wZS5zZWxlY3RlZE1vZGVsICE9PSBudWxsICYmIGFuZ3VsYXIuaXNEZWZpbmVkKCRzY29wZS5zZWxlY3RlZE1vZGVsWyRzY29wZS5zZXR0aW5ncy5leHRlcm5hbElkUHJvcF0pICYmICRzY29wZS5zZWxlY3RlZE1vZGVsWyRzY29wZS5zZXR0aW5ncy5leHRlcm5hbElkUHJvcF0gPT09IGdldEZpbmRPYmooaWQpWyRzY29wZS5zZXR0aW5ncy5leHRlcm5hbElkUHJvcF07XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmluZEluZGV4KCRzY29wZS5zZWxlY3RlZE1vZGVsLCBnZXRGaW5kT2JqKGlkKSkgIT09IC0xO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9O1xyXG5cclxuICAgICAgICAgICAgJHNjb3BlLmV4dGVybmFsRXZlbnRzLm9uSW5pdERvbmUoKTtcclxuXHJcbiAgICAgICAgICAgICRzY29wZS5rZXlEb3duTGluayA9IGZ1bmN0aW9uIChldmVudCkge1xyXG4gICAgICAgICAgICAgICAgdmFyIHNvdXJjZVNjb3BlID0gYW5ndWxhci5lbGVtZW50KGV2ZW50LnRhcmdldCkuc2NvcGUoKTtcclxuICAgICAgICAgICAgICAgIHZhciBuZXh0T3B0aW9uO1xyXG4gICAgICAgICAgICAgICAgdmFyIHBhcmVudCA9IGV2ZW50LnRhcmdldC5wYXJlbnROb2RlO1xyXG4gICAgICAgICAgICAgICAgaWYgKCEkc2NvcGUuc2V0dGluZ3Mua2V5Ym9hcmRDb250cm9scykge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGlmIChldmVudC5rZXlDb2RlID09PSAxMyB8fCBldmVudC5rZXlDb2RlID09PSAzMikgeyAvLyBlbnRlclxyXG4gICAgICAgICAgICAgICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKCEhc291cmNlU2NvcGUub3B0aW9uKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICRzY29wZS5zZXRTZWxlY3RlZEl0ZW0oJHNjb3BlLmdldFByb3BlcnR5Rm9yT2JqZWN0KHNvdXJjZVNjb3BlLm9wdGlvbiwgJHNjb3BlLnNldHRpbmdzLmlkUHJvcCksIGZhbHNlLCB0cnVlKTtcclxuICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGV2ZW50LnRhcmdldC5pZCA9PT0gJ2Rlc2VsZWN0QWxsJykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAkc2NvcGUuZGVzZWxlY3RBbGwoKTtcclxuICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGV2ZW50LnRhcmdldC5pZCA9PT0gJ3NlbGVjdEFsbCcpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgJHNjb3BlLnNlbGVjdEFsbCgpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoZXZlbnQua2V5Q29kZSA9PT0gMzgpIHsgLy8gdXAgYXJyb3dcclxuICAgICAgICAgICAgICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmICghIXBhcmVudC5wcmV2aW91c0VsZW1lbnRTaWJsaW5nKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG5leHRPcHRpb24gPSBwYXJlbnQucHJldmlvdXNFbGVtZW50U2libGluZy5xdWVyeVNlbGVjdG9yKCdhJykgfHwgcGFyZW50LnByZXZpb3VzRWxlbWVudFNpYmxpbmcucXVlcnlTZWxlY3RvcignaW5wdXQnKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgd2hpbGUgKCFuZXh0T3B0aW9uICYmICEhcGFyZW50KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHBhcmVudCA9IHBhcmVudC5wcmV2aW91c0VsZW1lbnRTaWJsaW5nO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoISFwYXJlbnQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5leHRPcHRpb24gPSBwYXJlbnQucXVlcnlTZWxlY3RvcignYScpIHx8IHBhcmVudC5xdWVyeVNlbGVjdG9yKCdpbnB1dCcpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIGlmICghIW5leHRPcHRpb24pIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgbmV4dE9wdGlvbi5mb2N1cygpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoZXZlbnQua2V5Q29kZSA9PT0gNDApIHsgLy8gZG93biBhcnJvd1xyXG4gICAgICAgICAgICAgICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKCEhcGFyZW50Lm5leHRFbGVtZW50U2libGluZykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBuZXh0T3B0aW9uID0gcGFyZW50Lm5leHRFbGVtZW50U2libGluZy5xdWVyeVNlbGVjdG9yKCdhJykgfHwgcGFyZW50Lm5leHRFbGVtZW50U2libGluZy5xdWVyeVNlbGVjdG9yKCdpbnB1dCcpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB3aGlsZSAoIW5leHRPcHRpb24gJiYgISFwYXJlbnQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcGFyZW50ID0gcGFyZW50Lm5leHRFbGVtZW50U2libGluZztcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCEhcGFyZW50KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBuZXh0T3B0aW9uID0gcGFyZW50LnF1ZXJ5U2VsZWN0b3IoJ2EnKSB8fCBwYXJlbnQucXVlcnlTZWxlY3RvcignaW5wdXQnKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBpZiAoISFuZXh0T3B0aW9uKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG5leHRPcHRpb24uZm9jdXMoKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGV2ZW50LmtleUNvZGUgPT09IDI3KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgJHNjb3BlLnRvZ2dsZURyb3Bkb3duKCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH07XHJcblxyXG4gICAgICAgICAgICAkc2NvcGUua2V5RG93blNlYXJjaERlZmF1bHQgPSBmdW5jdGlvbiAoZXZlbnQpIHtcclxuICAgICAgICAgICAgICAgIHZhciBwYXJlbnQgPSBldmVudC50YXJnZXQucGFyZW50Tm9kZS5wYXJlbnROb2RlO1xyXG4gICAgICAgICAgICAgICAgdmFyIG5leHRPcHRpb247XHJcbiAgICAgICAgICAgICAgICBpZiAoISRzY29wZS5zZXR0aW5ncy5rZXlib2FyZENvbnRyb2xzKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgaWYgKGV2ZW50LmtleUNvZGUgPT09IDkgfHwgZXZlbnQua2V5Q29kZSA9PT0gNDApIHsgLy90YWJcclxuICAgICAgICAgICAgICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xyXG4gICAgICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBhbmd1bGFyLmVsZW1lbnQoJGVsZW1lbnQpWzBdLnF1ZXJ5U2VsZWN0b3IoJy5vcHRpb24nKS5mb2N1cygpO1xyXG4gICAgICAgICAgICAgICAgICAgIH0sIDApO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmIChldmVudC5rZXlDb2RlID09PSAzOCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKCEhcGFyZW50LnByZXZpb3VzRWxlbWVudFNpYmxpbmcpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgbmV4dE9wdGlvbiA9IHBhcmVudC5wcmV2aW91c0VsZW1lbnRTaWJsaW5nLnF1ZXJ5U2VsZWN0b3IoJ2EnKSB8fCBwYXJlbnQucHJldmlvdXNFbGVtZW50U2libGluZy5xdWVyeVNlbGVjdG9yKCdpbnB1dCcpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB3aGlsZSAoIW5leHRPcHRpb24gJiYgISFwYXJlbnQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcGFyZW50ID0gcGFyZW50LnByZXZpb3VzRWxlbWVudFNpYmxpbmc7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICghIXBhcmVudCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbmV4dE9wdGlvbiA9IHBhcmVudC5xdWVyeVNlbGVjdG9yKCdhJykgfHwgcGFyZW50LnF1ZXJ5U2VsZWN0b3IoJ2lucHV0Jyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKCEhbmV4dE9wdGlvbikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBuZXh0T3B0aW9uLmZvY3VzKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmIChldmVudC5rZXlDb2RlID09PSAyNykge1xyXG4gICAgICAgICAgICAgICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICRzY29wZS50b2dnbGVEcm9wZG93bigpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9O1xyXG5cclxuICAgICAgICAgICAgJHNjb3BlLmtleURvd25TZWFyY2ggPSBmdW5jdGlvbiAoZXZlbnQsIHNlYXJjaEZpbHRlcikge1xyXG4gICAgICAgICAgICAgICAgdmFyIHNlYXJjaFJlc3VsdDtcclxuICAgICAgICAgICAgICAgIGlmICghJHNjb3BlLnNldHRpbmdzLmtleWJvYXJkQ29udHJvbHMpIHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBpZiAoZXZlbnQua2V5Q29kZSA9PT0gMTMpIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoJHNjb3BlLnNldHRpbmdzLnNlbGVjdGlvbkxpbWl0ID09PSAxICYmICRzY29wZS5zZXR0aW5ncy5lbmFibGVTZWFyY2gpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgc2VhcmNoUmVzdWx0ID0gJGZpbHRlcignZmlsdGVyJykoJHNjb3BlLm9wdGlvbnMsICRzY29wZS5nZXRGaWx0ZXIoc2VhcmNoRmlsdGVyKSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChzZWFyY2hSZXN1bHQubGVuZ3RoID09PSAxKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkc2NvcGUuc2V0U2VsZWN0ZWRJdGVtKCRzY29wZS5nZXRQcm9wZXJ0eUZvck9iamVjdChzZWFyY2hSZXN1bHRbMF0sICRzY29wZS5zZXR0aW5ncy5pZFByb3ApLCBmYWxzZSwgdHJ1ZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKCRzY29wZS5zZXR0aW5ncy5lbmFibGVTZWFyY2gpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgJHNjb3BlLnNlbGVjdEFsbCgpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfTtcclxuXHJcbiAgICAgICAgICAgICRzY29wZS5nZXRGaWx0ZXIgPSBmdW5jdGlvbiAoc2VhcmNoRmlsdGVyKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgZmlsdGVyID0ge307XHJcbiAgICAgICAgICAgICAgICBmaWx0ZXJbJHNjb3BlLnNldHRpbmdzLnNlYXJjaEZpZWxkXSA9IHNlYXJjaEZpbHRlcjtcclxuICAgICAgICAgICAgICAgIHJldHVybiBmaWx0ZXI7XHJcbiAgICAgICAgICAgIH07XHJcblxyXG4gICAgICAgICAgICAkc2NvcGUudG9nZ2xlU2VhcmNoID0gZnVuY3Rpb24gKCRldmVudCkge1xyXG4gICAgICAgICAgICAgICAgaWYgKCRldmVudCkge1xyXG4gICAgICAgICAgICAgICAgICAgICRldmVudC5zdG9wUHJvcGFnYXRpb24oKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICRzY29wZS5zZXR0aW5ncy5lbmFibGVTZWFyY2ggPSAhJHNjb3BlLnNldHRpbmdzLmVuYWJsZVNlYXJjaDtcclxuICAgICAgICAgICAgICAgIGlmICghJHNjb3BlLnNldHRpbmdzLmVuYWJsZVNlYXJjaCkge1xyXG4gICAgICAgICAgICAgICAgICAgICRzY29wZS5pbnB1dC5zZWFyY2hGaWx0ZXIgPSAnJztcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfTtcclxuXHJcbiAgICAgICAgICAgICRzY29wZS5rZXlEb3duVG9nZ2xlU2VhcmNoID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgaWYgKCEkc2NvcGUuc2V0dGluZ3Mua2V5Ym9hcmRDb250cm9scykge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGlmIChldmVudC5rZXlDb2RlID09PSAxMykge1xyXG4gICAgICAgICAgICAgICAgICAgICRzY29wZS50b2dnbGVTZWFyY2goKTtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoJHNjb3BlLnNldHRpbmdzLmVuYWJsZVNlYXJjaCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KFxyXG5cdFx0XHRcdFx0XHRcdGZ1bmN0aW9uICgpIHtcclxuXHRcdFx0XHRcdFx0XHQgICAgYW5ndWxhci5lbGVtZW50KCRlbGVtZW50KVswXS5xdWVyeVNlbGVjdG9yKCcuc2VhcmNoRmllbGQnKS5mb2N1cygpO1xyXG5cdFx0XHRcdFx0XHRcdH0sIDBcclxuXHRcdFx0XHRcdFx0KTtcclxuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBhbmd1bGFyLmVsZW1lbnQoJGVsZW1lbnQpWzBdLnF1ZXJ5U2VsZWN0b3IoJy5vcHRpb24nKS5mb2N1cygpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfTtcclxuICAgICAgICB9XHJcbiAgICB9O1xyXG59XSk7XHJcblxyXG5mdW5jdGlvbiBjb250YWlucyhjb2xsZWN0aW9uLCB0YXJnZXQpIHtcclxuICAgIHZhciBjb250YWluc1RhcmdldCA9IGZhbHNlO1xyXG4gICAgY29sbGVjdGlvbi5zb21lKGZ1bmN0aW9uIChvYmplY3QpIHtcclxuICAgICAgICBpZiAob2JqZWN0ID09PSB0YXJnZXQpIHtcclxuICAgICAgICAgICAgY29udGFpbnNUYXJnZXQgPSB0cnVlO1xyXG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgICAgICB9XHJcbiAgICB9KTtcclxuICAgIHJldHVybiBjb250YWluc1RhcmdldDtcclxufVxyXG5cclxuZnVuY3Rpb24gZmluZChjb2xsZWN0aW9uLCBwcm9wZXJ0aWVzKSB7XHJcbiAgICB2YXIgdGFyZ2V0O1xyXG5cclxuICAgIGNvbGxlY3Rpb24uc29tZShmdW5jdGlvbiAob2JqZWN0KSB7XHJcbiAgICAgICAgdmFyIGhhc0FsbFNhbWVQcm9wZXJ0aWVzID0gdHJ1ZTtcclxuICAgICAgICBPYmplY3Qua2V5cyhwcm9wZXJ0aWVzKS5mb3JFYWNoKGZ1bmN0aW9uIChrZXkpIHtcclxuICAgICAgICAgICAgaWYgKG9iamVjdFtrZXldICE9PSBwcm9wZXJ0aWVzW2tleV0pIHtcclxuICAgICAgICAgICAgICAgIGhhc0FsbFNhbWVQcm9wZXJ0aWVzID0gZmFsc2U7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgICAgICBpZiAoaGFzQWxsU2FtZVByb3BlcnRpZXMpIHtcclxuICAgICAgICAgICAgdGFyZ2V0ID0gb2JqZWN0O1xyXG4gICAgICAgICAgICByZXR1cm4gdHJ1ZVxyXG4gICAgICAgIH1cclxuICAgIH0pO1xyXG5cclxuICAgIHJldHVybiB0YXJnZXQ7XHJcbn1cclxuXHJcbmZ1bmN0aW9uIGZpbmRJbmRleChjb2xsZWN0aW9uLCBwcm9wZXJ0aWVzKSB7XHJcbiAgICB2YXIgaW5kZXggPSAtMTtcclxuICAgIHZhciBjb3VudGVyID0gLTE7XHJcblxyXG4gICAgY29sbGVjdGlvbi5zb21lKGZ1bmN0aW9uIChvYmplY3QpIHtcclxuICAgICAgICB2YXIgaGFzQWxsU2FtZVByb3BlcnRpZXMgPSB0cnVlO1xyXG4gICAgICAgIGNvdW50ZXIgKz0gMTtcclxuICAgICAgICBPYmplY3Qua2V5cyhwcm9wZXJ0aWVzKS5mb3JFYWNoKGZ1bmN0aW9uIChrZXkpIHtcclxuICAgICAgICAgICAgaWYgKG9iamVjdFtrZXldICE9PSBwcm9wZXJ0aWVzW2tleV0pIHtcclxuICAgICAgICAgICAgICAgIGhhc0FsbFNhbWVQcm9wZXJ0aWVzID0gZmFsc2U7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgICAgICBpZiAoaGFzQWxsU2FtZVByb3BlcnRpZXMpIHtcclxuICAgICAgICAgICAgaW5kZXggPSBjb3VudGVyO1xyXG4gICAgICAgICAgICByZXR1cm4gdHJ1ZVxyXG4gICAgICAgIH1cclxuICAgIH0pO1xyXG5cclxuICAgIHJldHVybiBpbmRleDtcclxufSJdLCJzb3VyY2VSb290IjoiL3NvdXJjZS8ifQ==